(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[411075],{850242:(e,t,n)=>{"use strict";n.r(t),n.d(t,{simpleCollabStore:()=>r,isDiscoverSurfaceSelectedAtom:()=>s,selectedHiddenChannelIdAtom:()=>l,selectedConversationIdAtom:()=>v,selectedTeamIdAtom:()=>S,selectedHiddenChannelIdReadOnlyAtom:()=>u,selectedAppIdAtom:()=>m});var i=n(918640),a=n(403329),o=n(12978);const r=(0,i.MT)(),s=(0,i.cn)(!1);r.set(s,!1);const l=(c=void 0,d=(e,t)=>e===t,(0,a.w0)(c,((e,t)=>d(e,t)?e:t)));var c,d;r.set(l,void 0);const u=(0,i.cn)((e=>e(l))),m=(0,i.cn)("");r.set(m,"");const p=(0,i.cn)(""),g=(0,i.cn)(""),h=(0,i.cn)(""),y=(0,i.cn)((e=>{const t=e(m);return t===o.py.simplecollabchats?e(p):t===o.py.simplecollabchannels?e(g):e(h)}),((e,t,n)=>{const i=e(m);i===o.py.simplecollabchats?t(p,n):i===o.py.simplecollabchannels?t(g,n):t(h,n)}));r.set(y,"");const v=(0,i.cn)((e=>e(s)?"":f(e)),((e,t,n)=>{t(s,!1),t(y,n)})),f=e=>{const t=e(y);return t?JSON.parse(t)?.id:""},S=(0,i.cn)((e=>e(s)?"":(e=>{const t=e(y);return t?JSON.parse(t)?.teamId:""})(e)),((e,t,n)=>{t(s,!1),t(y,n)}))},62996:(e,t,n)=>{"use strict";n.d(t,{e:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"toggleActivityRead"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isRead"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toggleActivityRead"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"isRead"},value:{kind:"Variable",name:{kind:"Name",value:"isRead"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FeedActivity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isRead"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivityReadStatusUpdateError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"errorFaced"}}]}}]}}]}}]}},996181:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"updateActivitySettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"settingsUpdate"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActivitySettingsUpdate"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateActivitySettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"settingsUpdate"},value:{kind:"Variable",name:{kind:"Name",value:"settingsUpdate"}}},{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"subCategoryPageId"},value:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"error"}},{kind:"Field",name:{kind:"Name",value:"settingsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]}},749476:(e,t,n)=>{"use strict";n.d(t,{KL:()=>a,zA:()=>r,h8:()=>s});var i=n(23279);const a=()=>Promise.all([n.e(586535),n.e(457535),n.e(129609),n.e(240446),n.e(896963),n.e(758547),n.e(309102),n.e(120197)]).then(n.bind(n,57493)),o=()=>n.e(979630).then(n.t.bind(n,319110,23)),r=()=>(0,i.mT)(a,"search-answer-v2"),s=()=>(0,i.mT)(o,"search-answer-v2-override")},680864:(e,t,n)=>{"use strict";n.d(t,{tY:()=>a,jx:()=>r,lS:()=>s});var i=n(23279);const a=()=>Promise.all([n.e(187946),n.e(182149),n.e(412452),n.e(778422),n.e(303977),n.e(611629),n.e(561167),n.e(942475)]).then(n.bind(n,610299)),o=()=>Promise.all([n.e(303977),n.e(223490)]).then(n.t.bind(n,633103,23)),r=()=>(0,i.mT)(a,"search-answer"),s=()=>(0,i.mT)(o,"search-answer-override")},331155:(e,t,n)=>{"use strict";var i,a,o,r;n.d(t,{H$:()=>i,a6:()=>a,P$:()=>o,cd:()=>r}),function(e){e.Outlook="Outlook",e.Google="Google"}(i||(i={})),function(e){e.Connect="Connect",e.Disconnect="Disconnect"}(a||(a={})),function(e){e.Default="Default",e.Connect="Connect",e.Disconnect="Disconnect"}(o||(o={})),function(e){e.Error="Error",e.Syncing="Syncing"}(r||(r={}))},257710:(e,t,n)=>{"use strict";n.d(t,{l:()=>u,S:()=>s});var i=n(308918),a=n(72742);const o="ðŸ“· GIF",r=e=>!!e&&e.split("giphy.com").length>1;function s(e,t){(0,i.addHook)("uponSanitizeElement",c),(0,i.addHook)("uponSanitizeElement",l),t&&(0,i.addHook)("uponSanitizeElement",d);const n=(0,i.sanitize)(e,{ALLOWED_TAGS:[]});return(0,i.removeHooks)("uponSanitizeElement"),n}function l(e){"BR"===e.tagName&&e.replaceWith(" ")}function c(e){"BLOCKQUOTE"===e.tagName&&e.remove()}function d(e){if("IMG"!==e.tagName)return;const t=e.getAttribute("src")??"";if(r(t))return void e.replaceWith(o);const n=e.getAttribute("alt");if(!n)return;switch(e.getAttribute("itemtype")){case a.T.emoji:e.replaceWith(n);break;case a.T.customEmoji:e.replaceWith(`(${n})`)}}function u(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')}},8643:(e,t,n)=>{"use strict";n.d(t,{J:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"createNewChat"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNewChat"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"conversation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}}]}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"membersLimited"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"givenName"}}]}},{kind:"Field",name:{kind:"Name",value:"memberDisplayNamesLimited"}},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"}},{kind:"Field",name:{kind:"Name",value:"disabledReason"}},{kind:"Field",name:{kind:"Name",value:"extendedData"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"hasIBPolicyRejectedUsers"}}]}}]}}]}},864860:(e,t,n)=>{"use strict";n.d(t,{i1:()=>i,t3:()=>s,tT:()=>l,BN:()=>c,vc:()=>d,HT:()=>u});var i,a=n(629494),o=n(683184),r=n(981917);function s(e){const{allowUserChat:t,messagingPolicy:n}=e;return"boolean"==typeof t||!!n?t?i.Enabled:i.Disabled:i.Unknown}function l(){const e=(0,a.NC)(o.J.Messaging);return e.enableComposeDisabledBasedOnPolicy?s(e):i.Enabled}function c(e){const t=l();return e===r.k2.Meeting||e===r.k2.Channel?i.Enabled:t}function d(e,t){const n=c(e),{enablePinMessageToChat:r}=(0,a.NC)(o.J.Messaging,["enablePinMessageToChat"]);return t&&!!r&&n!==i.Disabled}function u(){const{teamsUserPhoneNumbers:e}=(0,a.NC)(o.J.Messaging,["teamsUserPhoneNumbers"]);return!!e?.phoneNumbers?.find((e=>"Primary"===e?.assignmentCategory&&e?.acquiredCapabilities?.includes("InboundA2PSms")&&e?.acquiredCapabilities?.includes("OutboundA2PSms")))}!function(e){e.Enabled="Enabled",e.Disabled="Disabled",e.Unknown="Unknown"}(i||(i={}))},225990:(e,t,n)=>{"use strict";n.d(t,{_Z:()=>s,qK:()=>l,F2:()=>c,$i:()=>d,Xk:()=>u,Qp:()=>m,f0:()=>p,d1:()=>g,Ue:()=>y,XH:()=>v});var i=n(12978),a=n(323356);const o="communities-selected-id",r="current-enitity-type",s=[i.py.communities,i.py.communitiesjoinrequest,i.py.communitiesmembers,i.py.communitiesblockmembers],l=()=>localStorage.getItem(o),c=()=>localStorage.getItem("communities-selected-reply-id"),d=()=>localStorage.getItem(r),u=()=>localStorage.removeItem(r),m=e=>e?.id===e?.teamId,p=e=>[i.py.communities,i.py.communitiesjoininviteview].some((t=>t===e)),g=(e,t)=>{const n=[a.D.ActivityFeed,a.D.ActivityFeedBellClick];return e&&n.includes(e)||!!t},h=(e,t,n,i,a)=>{if(t.includes(i)&&n.includes(a))return e},y=(e,t,n)=>{const a=h(e,[i.py.communitiesonboarding,i.py.communities],[i.uk.join,i.uk.update],t,n),{inviteLinkUrl:o}=a?.(t,n)||{};return o},v=(e,t,n)=>{const a=h(e,[i.py.communities],[i.uk.view],t,n),{isPostLink:o,enqueSwitch:r,source:s,owningTeamId:l}=a?.(t,n)||{};return{isPostLink:o,enqueSwitch:r,source:s,owningTeamId:l}}},64476:(e,t,n)=>{"use strict";n.d(t,{_:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"publishContactsSyncSettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"syncSettings"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ContactsSyncSettingsInput"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"skipMiddleTierUpdate"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"publishContactsSyncSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"syncSettings"},value:{kind:"Variable",name:{kind:"Name",value:"syncSettings"}}},{kind:"Argument",name:{kind:"Name",value:"skipMiddleTierUpdate"},value:{kind:"Variable",name:{kind:"Name",value:"skipMiddleTierUpdate"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]}},69841:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});class i{constructor(){this.registerAppPhase=({phase:e,signals:t,timeout:n})=>{const i=this._phasesMap.get(e);this._phasesMap.set(e,{...i,signals:t,timeout:n})},this._phasesMap=new Map}get appPhases(){return{phases:this._phasesMap}}}},528099:(e,t,n)=>{"use strict";n.d(t,{c:()=>i});const i=e=>t=>t.reduce(((t,n)=>(t[n]=e[n],t)),{})},358050:(e,t,n)=>{"use strict";n.d(t,{FU:()=>i,ZG:()=>o});var i,a=n(686219);!function(e){e.DEFAULT="default",e.HEADER_AT_BOTTOM="header_at_bottom",e.HYER="hyer"}(i||(i={}));class o{constructor({layoutKey:e=i.DEFAULT,layoutMode:t,layoutTemplatesPerLayoutMode:n}){this.getTemplate=({layoutKey:e=i.DEFAULT,layoutMode:t,slots:n,slotsDimensionsOverrides:a={}})=>{const o=this._layoutTemplates[t][this._getKeyFromSlotNameArray(e,n)];return"function"==typeof o?o(a):o},this._getKeyFromSlotNameArray=(e=i.DEFAULT,t)=>[e,...[...t].sort()].join("-"),this._layoutTemplates={[a.lO.focus]:{},[a.lO.minimal]:{},[a.lO.standard]:{},[a.lO.minimode]:{}},n[t]?.forEach((n=>{(n.layoutKey||i.DEFAULT)===e&&this._registerTemplates({layoutMode:t,...n})}))}_registerTemplates({layoutKey:e=i.DEFAULT,layoutMode:t,responsiveTemplates:n,slots:a}){const o=this._getKeyFromSlotNameArray(e,a);if(void 0!==this._layoutTemplates[t][o])throw new Error(`You can't have two templates with same slots for same layoutMode, slots: ${o} layoutMode: ${t}`);this._layoutTemplates[t][o]="function"==typeof n?n:()=>n}}},871799:(e,t,n)=>{"use strict";n.d(t,{L:()=>l});var i=n(874645),a=n(406364),o=n(931473),r=n(346701),s=n(871177);const l={splashStyles:a,favicons:o,splash:i,preloadTitleBar:r,devtools:s}},951892:(e,t,n)=>{"use strict";n.d(t,{rx:()=>i});const i=(e,t)=>{((e,t)=>{const n=e.getElementById("splash-screen");n&&(n.setAttribute("aria-hidden","true"),e.body.removeChild(n),t&&(t.style.display="block"))})(e,t),(e=>{const t=e.getElementsByClassName("preload-title-bar-trim")[0];t&&e.body.removeChild(t)})(e)}},873292:(e,t,n)=>{"use strict";n.d(t,{o:()=>v});var i=n(683184),a=n(23279),o=n(903692),r=n(771469),s=n(250033),l=n(818319),c=n(811537),d=n(6842),u=n(127989);const m=()=>(0,s.t)(u.e,{client:{},children:(0,s.t)("div",{})});class p extends l.PureComponent{constructor(){super(...arguments),this.divRef=l.createRef(),this.siblingEl=l.createRef()}componentDidMount(){const{document:e}=this.props.mainWindow,t=e.createElement("div");this.divRef.current&&(this.divRef.current.appendChild(t),t.dispatchEvent(new MouseEvent("mouseout",{bubbles:!0,cancelable:!0,relatedTarget:this.siblingEl.current})))}render(){return(0,s.t)("div",{ref:this.divRef,children:(0,s.t)("div",{ref:this.siblingEl,onMouseEnter:()=>{}})})}}class g extends l.PureComponent{constructor(){super(...arguments),this.state={mounted:!1}}componentDidMount(){this.setState({mounted:!0})}render(){return(0,s.t)("div",{})}}const h=e=>{(e=>{e.document.body.dispatchEvent(new MouseEvent("click",{bubbles:!0}))})(e)};var y=n(543491);const v=async(e,t,n)=>{const a=await f(t);return e.pipe((0,o.j)((({id:e,window:i,context$:o})=>((e,t,n,i,a,o)=>{if(!e)return null;const s=e.document.getElementById("app");if(!s){const e=a.loggerFactory.newLogger("entry","components-core-layout");return e.errorToTelemetry&&e.errorToTelemetry("element with ID 'app' not found on the document.","webclient_framework_foundation_components_render_windows",void 0,!0),null}a.scenarioFactory.startStep(y.RG.ExperienceReady,y.ck.RenderProviders);const l=new r.Z({context$:t,coreServices:a,getExperienceProps:n,reactDiagnosticsService:o,rootElement:s,windowId:i,window:e});return l.activate(),{coreRenderer:l,host:e,windowId:i}})(i,o,n,e,t,a)),(async e=>{if(!e)return;const{host:n,coreRenderer:a,windowId:o}=e;h(n),a.deactivate();const r=t.windowProvider;await(async e=>{const t=e.document,n=t.body,i=t.createElement("div");i.setAttribute("id","memory-cleanup");const a=n.appendChild(i);await(0,d._)(0),c.render((0,s.t)(l.Fragment,{children:[(0,s.t)(m,{}),(0,s.t)(p,{mainWindow:e}),(0,s.t)(g,{})]}),a),c.unmountComponentAtNode(a),n.removeChild(a)})(r);const{dataCleanupService:u,dataEvictionService:y,coreSettings:v}=t;u.markDataForWindowAsInactive(o);const{enableSingleApolloCoreCache:f}=v.get(i.J.Core);f&&y?.evict()}),(({id:e})=>e))).subscribe()},f=async e=>{const{enableReactDiagnostics:t,enableReactDiagnosticsConsoleLog:o,enableReactDiagnosticsDisplayNameFix:r}=e.coreSettings.get(i.J.Diagnostics);if(t)try{const{initReactDiagnostics:t,ReactDiagnosticsService:i}=await(0,a.mT)((()=>Promise.all([n.e(672880),n.e(474133),n.e(582271)]).then(n.bind(n,193495))),"react-diagnostics",e.scenarioFactory),s=new i(!!o,!!r);return t(s),s}catch(t){const n=e.loggerFactory.newLogger("react-diagnostics","components-core-layout");n.errorToTelemetry&&n.errorToTelemetry(`Failed to load react-diagnostic ${t}`,"webclient_framework_foundation_components_render_windows",void 0,!0)}}},56716:(e,t,n)=>{"use strict";var i;n.d(t,{l:()=>i}),function(e){e.OOFSettingsPage="general_settings_oof_settings_page_title"}(i||(i={}))},756303:(e,t,n)=>{"use strict";n.d(t,{WK:()=>g,CH:()=>h,Oh:()=>p});var i=n(818319),a=n(899617),o=n(224611),r=n(16953);const s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsGuardiansApprovalStatusQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"studentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getGuardiansApprovalStatus"},arguments:[{kind:"Argument",name:{kind:"Name",value:"studentId"},value:{kind:"Variable",name:{kind:"Name",value:"studentId"}}},{kind:"Argument",name:{kind:"Name",value:"teamId"},value:{kind:"Variable",name:{kind:"Name",value:"teamId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"approvalId"}},{kind:"Field",name:{kind:"Name",value:"approvalStatus"}}]}}]}}]},l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsGuardiansCreateApprovalMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"studentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"title"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"relatedContacts"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"RelatedContactPayload"}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createGuardiansApproval"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamId"},value:{kind:"Variable",name:{kind:"Name",value:"teamId"}}},{kind:"Argument",name:{kind:"Name",value:"studentId"},value:{kind:"Variable",name:{kind:"Name",value:"studentId"}}},{kind:"Argument",name:{kind:"Name",value:"title"},value:{kind:"Variable",name:{kind:"Name",value:"title"}}},{kind:"Argument",name:{kind:"Name",value:"relatedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"relatedContacts"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"approvalId"}}]}}]}}]};var c=n(681971),d=n(543491),u=n(629494),m=n(683184);const p=(e,t)=>{const{scenarioFactory:n}=(0,c.SE)(),{enableParentsDataIngestion:i}=(0,u.NC)(m.J.Guardians,["enableParentsDataIngestion"]),o=y(n,!!i,e,t),{data:r,error:l,loading:d}=(0,a.a)(s,{variables:{studentId:e,teamId:t},fetchPolicy:"cache-first",context:{callerInfo:"components-student-contact-card-container"},skip:!e||!t||!i});return v(l,o,!!i,r?.getGuardiansApprovalStatus?.approvalStatus||"",d),{guardiansApprovalStatus:r?.getGuardiansApprovalStatus?.approvalStatus,loading:d}},g=async(e,t,n,i,a)=>{try{(a||e.cache).writeQuery({query:s,variables:{studentId:t,teamId:n},data:{getGuardiansApprovalStatus:{approvalStatus:r.GO.Pending,approvalId:i||"",__typename:"GuardiansApprovalStatusResult"}}})}catch(i){await((e,t,n)=>e.query({query:s,variables:{studentId:t,teamId:n},fetchPolicy:"network-only",context:{callerInfo:"components-student-contact-card-container"}}))(e,t,n)}},h=(e,t,n,a)=>{const r=((e,t,n)=>i.useCallback((async(i,a)=>{const o=a.data?.createGuardiansApproval?.approvalId;await g(n,e,t,o,i)}),[n,e,t]))(t,e,a),[s,{loading:c,error:d}]=(0,o.D)(l,{fetchPolicy:"network-only",context:{callerInfo:"guardians-approval-request-dialog-container"},update:r});return{createGuardiansApproval:i.useCallback((i=>s({variables:{teamId:e,studentId:t,title:n,relatedContacts:i}})),[s,e,t,n]),loading:c,error:d}},y=(e,t,n,i)=>{if(t){const t=e.newScenario(d.RG.GetGuardiansApprovalStatus);return t.appendEventData({studentId:n||"",groupId:i||""}),t}return null},v=(e,t,n,i,a)=>{if(n&&t&&!a)if(e){const{message:n}=e,{code:i,context:a,reason:o}=e?.graphQLErrors?.[0]?.extensions?.prevError??{},r=`ErrorMessage: ${n}`;t.fail({context:a,reason:o,errorCode:i,errors:r})}else t.stop({approvalStatus:i})}},944504:(e,t,n)=>{"use strict";n.d(t,{NU:()=>s,RQ:()=>l,WN:()=>c});var i=n(818319),a=n(681971),o=n(686219),r=n(323356);const s=e=>{const{memberAndRelatedContacts:t,initialAction:n,initialViewMode:s}=e,{entityCommanding:l}=(0,a.SE)();return i.useCallback((()=>{l.guardians.showGuardiansApprovalRequestDialog({stateTransition:o.su.extend,visibilityState:o.fe.show,correlation:{source:r.D.EducationGuardians}},{memberAndRelatedContacts:t,initialAction:n,initialViewMode:s})}),[n,l.guardians,t,s])},l=()=>{const{entityCommanding:e}=(0,a.SE)();return i.useCallback((()=>{e.guardians.showSendApprovalSuccessDialog({stateTransition:o.su.new,visibilityState:o.fe.show,correlation:{source:r.D.EducationGuardians}})}),[e.guardians])},c=()=>{const{entityCommanding:e}=(0,a.SE)();return i.useCallback((t=>{e.guardians.showSendApprovalErrorDialog({stateTransition:o.su.new,visibilityState:o.fe.show,correlation:{source:r.D.EducationGuardians}},{errorCode:t})}),[e.guardians])}},357863:(e,t,n)=>{"use strict";n.d(t,{W8:()=>i,xT:()=>a,fk:()=>o});const i=e=>{const{removeUrl:t,contentUrl:n,websiteUrl:i,entityId:a,baseInfo:o}=e||{};return{removeUrl:t||void 0,contentUrl:n||"",websiteUrl:i||void 0,entityId:a||void 0,suggestedDisplayName:o?.displayName||void 0}},a=(e,t,n)=>{const i=e=>e&&String(e);let a;return a=n?{contentUrl:i(e.contentUrl)||t?.contentUrl||"",websiteUrl:i(e.websiteUrl)??t?.websiteUrl}:{contentUrl:i(e.contentUrl)||t?.contentUrl||"",removeUrl:i(e.removeUrl)??t?.removeUrl,websiteUrl:i(e.websiteUrl)??t?.websiteUrl,entityId:i(e.entityId)??t?.entityId,suggestedDisplayName:i(e.suggestedDisplayName)||t?.suggestedDisplayName},a},o=(e,t,n,i,a,o)=>{if(n)return e.log("app is not supported because appId not found in the current thread"),n;const r=i?.includes(t);if(r)return e.log("app is not supported because appId is found in the disabledTabAppIds blocklist"),r;if(t&&a){const n=a.includes(t);if(o){if(!n)return e.log("app is not supported because appId is not present in the appIdlist whitelist"),!n}else if(n)return e.log("app is not supported because appId is  present in the appIdlist blocklist"),n}return!1}},100744:(e,t,n)=>{"use strict";n.d(t,{P:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsPrivacySettingsUnlinkExternalAccountMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountAddress"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"provider"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExternalAccountProvider"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"hardDelete"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unlinkExternalAccount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}},{kind:"Argument",name:{kind:"Name",value:"accountAddress"},value:{kind:"Variable",name:{kind:"Name",value:"accountAddress"}}},{kind:"Argument",name:{kind:"Name",value:"provider"},value:{kind:"Variable",name:{kind:"Name",value:"provider"}}},{kind:"Argument",name:{kind:"Name",value:"hardDelete"},value:{kind:"Variable",name:{kind:"Name",value:"hardDelete"}}}]}]}}]}},823203:(e,t,n)=>{"use strict";n.d(t,{u:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"contactsSyncSettings"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isContactsSyncEnabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contactsSyncSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isContactsSyncEnabled"},value:{kind:"Variable",name:{kind:"Name",value:"isContactsSyncEnabled"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"isSyncAllowed"}},{kind:"Field",name:{kind:"Name",value:"accountId"}},{kind:"Field",name:{kind:"Name",value:"deltaToken"}},{kind:"Field",name:{kind:"Name",value:"currentSyncStatus"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}}]}}]}},652515:(e,t,n)=>{"use strict";n.d(t,{i:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"deleteCalendarEventsCache"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mailboxAddress"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteCalendarEventsCache"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mailboxAddress"},value:{kind:"Variable",name:{kind:"Name",value:"mailboxAddress"}}}]}]}}]}},924340:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsSimpleCollabCommonSimpleCollabSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesForSimpleCollab"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"simpleCollabUserSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledAdaptiveRailForDesktop"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledUnifiedAppForDesktop"}}]}}]}}]}}]}},328520:(e,t,n)=>{"use strict";var i,a;n.d(t,{XW:()=>i,uy:()=>a,Gv:()=>o}),function(e){e.CreateTeam="CreateTeam",e.CreateChannel="CreateChannel",e.JoinTeam="JoinTeam",e.JoinTeamByCode="JoinTeamByCode",e.AddMember="AddMember",e.AddChannel="AddChannel",e.MarkAllChannelsAsRead="MarkAllChannelsAsRead",e.ManageTeamsList="ManageTeamsList",e.ManageTeamsInvites="ManageTeamsInvites",e.CrossTeamAnalytics="CrossTeamAnalytics"}(i||(i={})),function(e){e.None="None",e.PinChannel="PinChannel",e.UnpinChannel="UnpinChannel",e.ShowChannel="ShowChannel",e.HideChannel="HideChannel",e.ShowTeam="ShowTeam",e.HideTeam="HideTeam",e.ExpandTeam="ExpandTeam",e.CollapseTeam="CollapseTeam",e.ReorderTeam="ReorderTeam",e.ReorderPinnedChannels="ReorderPinnedChannels",e.ForceHideTeam="ForceHideTeam"}(a||(a={}));const o={forceSync:!1}},440960:(e,t,n)=>{"use strict";n.d(t,{Hj:()=>r,_u:()=>l,Rb:()=>c,Bw:()=>d,fg:()=>u,tO:()=>m,Xf:()=>g,iG:()=>h,A4:()=>y});var i=n(609446),a=n(503720);const o=[a.Tk.Transferring,a.Tk.TransferFailed,a.Tk.TransferSucceeded],r=e=>o.includes(e),s=[a.Tk.Parking,a.Tk.ParkFailed,a.Tk.ParkSucceeded],l=e=>s.includes(e),c=e=>(e=>e===i.OX.LocalHold)(e)||(e=>e===i.OX.RemoteHold)(e),d=e=>e===i.OX.Disconnected,u=e=>!(!e||e!==i.Fz.Park),m=(e,t)=>e===i.OX.Observing&&t,p=[i.OX.Notified,i.OX.EarlyMedia,i.OX.None],g=e=>!(y(e)||p.includes(e.state))||r(e.extendedCallState)||l(e.extendedCallState),h=[i.OX.Connected,i.OX.Connecting,i.OX.Staging],y=e=>h.includes(e.state)},114310:(e,t,n)=>{"use strict";n.d(t,{l8:()=>N,FC:()=>b});var i=n(250033),a=n(818319),o=n(861316),r=n(89184),s=n(839779),l=n(918461),c=n(629494),d=n(994575),u=n(683184),m=n(237867);const p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"activeCallsChangedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeCallsChangedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"calls"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"teamsCallId"}},{kind:"Field",name:{kind:"Name",value:"callInitiator"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"replyChainMessageId"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"organizerId"}}]}}]}}]}}]};var g=n(332386),h=n(387383),y=n(873640),v=n(242111),f=n(474528),S=n(333114),k=n(803238);const[C,b]=(0,o.j)("ActiveCallsContext");function w(e){return null!=e}const T=new Map,I=(e,t,{data:n,error:i})=>{if(i)return e.error(`Failed to receive data from activeCallsChangedEvent: ${i}`),t;const a=n?.activeCallsChangedEvent?.id;if(!a)return t;const o=(n?.activeCallsChangedEvent?.calls||[]).filter(w),r=new Map(t);return 0===o.length?(e.log(`No more calls found in ${a}. Removing from active calls map`),r.delete(a),0===r.size?T:r):(e.log(`Updating key in map for conversation ${a}. Number of active calls: ${o.length}`),new Map(r.set(a,o.reduce(((e,t)=>t.messageId?e.set(t.messageId,t):e),new Map))))},N=({children:e})=>{const t=(0,m.x)(),n=(0,d.w)("ActiveCallsContextContainer"),{enableActiveCallsSubscription:o}=(0,c.NC)(u.J.Channels,["enableActiveCallsSubscription"]),b=(()=>{const e=a.useMemo((()=>new r.xQ),[]);return a.useEffect((()=>()=>{e.next(),e.complete()}),[e]),e})(),[w,N]=a.useMemo((()=>{const e=new s.X(T);if(!o)return[e,k.noop];const i=(0,g.G)(t.subscribe({query:p,fetchPolicy:"no-cache"})).pipe((0,h.R)(b),(0,y.R)(((e,t)=>I(n,e,t)),T),(0,v.x)(),(0,f.d)(1),(0,S.K)((e=>(n.error("An exception occurred while subscribing to active calls",e),(0,l.of)(T))))).subscribe(e);return[e,()=>i.unsubscribe()]}),[t,o,n,b]);return a.useEffect((()=>N)),(0,i.t)(C,{source$:w,children:e})}},634195:(e,t,n)=>{"use strict";n.d(t,{vb:()=>r,c6:()=>s});var i=n(250033),a=n(818319);const o=a.createContext(""),r=a.memo((e=>{const{children:t,joinId:n}=e;return(0,i.t)(o.Provider,{value:n,children:t})})),s=()=>a.useContext(o)},449492:(e,t,n)=>{"use strict";n.d(t,{N:()=>c,F:()=>u});var i=n(250033),a=n(818319),o=n(994575),r=n(899617);const s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsCommunitiesAppSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"communitiesAppConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"baseImageUrl"}}]}}]}}]},l=a.createContext({baseImageUrl:null,loadingBaseImageUrl:!0}),c=({children:e})=>{const t=(0,o.w)("CommunitiesAppSettingsProvider"),{data:n,loading:a}=(0,r.a)(s),c=n?.communitiesAppConfig?.baseImageUrl||"",u={baseImageUrl:c,loadingBaseImageUrl:!!a};return c||a?c&&t.infoToTelemetry?.("Communities avatar base image URL found","communities_avatar_base_url_found"):t.errorToTelemetry?.("Communities avatar base image URL not found","communities_avatar_base_url_not_found"),(0,i.t)(l.Provider,{value:d(u),children:e})},d=e=>a.useMemo((()=>({...e})),[e]),u=()=>a.useContext(l)},451330:(e,t,n)=>{"use strict";n.d(t,{Id:()=>o,yx:()=>s,Cs:()=>l});var i=n(250033),a=n(818319);const o={isCallModeStreaming:()=>!1,isFullScreenButtonDisabled:()=>!1,isInEmbedContext:()=>!1,isTestUser:()=>!1,getCallId:()=>{},getCorrelationId:()=>"",getForceAttendeeStreaming:()=>{},getEnablePlayerControlsForStreamingMode:()=>{},getParticipantId:()=>{},getStreamDetails:()=>{},getStreamingMode:()=>!1,getTelemetryData:()=>{},getThreadId:()=>"",getUiLanguagePreference:()=>{},getCallMode:()=>{},getMeetingRole:()=>{},getEventId:()=>{},getTemplateId:()=>{},setFullScreenButton:()=>{},setStreamDetails:()=>{},sendConveneError:()=>{},sendDataLoadError:()=>{},sendHeartbeat:()=>{},sendMetadata:()=>{},sendData:()=>{},sendServerError:()=>{},createBroadcastEndEventListener:()=>{},createCallDataUpdateEventListener:()=>{},createStreamUpdateEventListener:()=>{},createCaptionsToggleEventListener:()=>{},destroyCaptionsToggleEventListener:()=>{},createSubtitleTrackChangeEventListener:()=>{},destroySubtitleTrackChangeEventListener:()=>{},destroyBroadcastEndEventListener:()=>{},destroyCallDataUpdateEventListener:()=>{},destroyStreamUpdateEventListener:()=>{},sendReadyToRecieveBroadcastEndNotification:()=>{},sendReadyToRecieveCallDataUpdateNotification:()=>{},sendReadyToRecieveStreamUpdatesNotification:()=>{},validateEmbedStreamDetailsArray:()=>({isSuccessful:!0})},r=a.createContext(null),s=a.memo((e=>{const{conveneHostMessaging:t,children:n}=e,a={conveneHostMessaging:t||{...o}};return(0,i.t)(r.Provider,{value:a,children:n})}));s.displayName="ConveneHostMessagingContextProvider";const l=()=>a.useContext(r)},771469:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var i=n(250033),a=n(811537),o=(n(818319),n(951892)),r=n(702135),s=n(689626),l=n(23279),c=n(543491);performance?.mark?.("resolve-main-imports-end");const d=()=>Promise.all([n.e(377348),n.e(112403),n.e(463781),n.e(681896),n.e(909020),n.e(591878),n.e(607784),n.e(773923),n.e(505990),n.e(120894),n.e(51724),n.e(591395),n.e(635026),n.e(130631),n.e(228737),n.e(578578),n.e(641062),n.e(379371),n.e(890962),n.e(585815),n.e(243012),n.e(474133),n.e(224284),n.e(802054)]).then(n.bind(n,923678));class u{constructor(e){this._activationOptions=e,this._mounted=!1,this._logger=this._activationOptions.coreServices.loggerFactory.newLogger("CoreReactRenderer","components-core-layout")}async activate(){this.deactivate();try{return this._activateRoot()}catch(e){const t=(0,r.Tr)("Experience",s.jK.Undefined,"activate",e);return this._logger.errorToTelemetry&&this._logger.errorToTelemetry(t.message,"webclient_framework_foundation_components_core_react_renderer",void 0,!0),this._activationOptions.coreServices.errorState.error=t,Promise.reject(t)}}deactivate(){this._mounted&&(a.unmountComponentAtNode(this._activationOptions.rootElement),this._mounted=!1)}async _activateRoot(){const{window:e,rootElement:t,coreServices:{altScenarioService:n,scenarioFactory:r}}=this._activationOptions,{RootRenderer:s}=await(0,l.mT)(d,"core-essentials",r);return n?.altScenario?.mark(c.ck.CoreEssentialsChunkLoad),new Promise((n=>{a.render((0,i.t)(s,{...this._activationOptions}),t,(()=>{this._mounted=!0,e&&(0,o.rx)(e.document,t),n()}))}))}}},151495:(e,t,n)=>{"use strict";n.d(t,{Mx:()=>C});var i=n(250033),a=n(818319),o=n(237867);const r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"presence"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presence"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userPresenceData"}}]}}]}},...n(550214).O.definitions]};var s=n(747322),l=n(332534),c=n(436328),d=n(215938),u=n(919244),m=n(557687),p=n(564087),g=n(438587),h=n(372795),y=n(498104),v=n(42395),f=n(212495);const S=({member:e,ariaLabel:t,isParentsEndSlot:n,isGuardiansApprovalRequestDialog:a})=>{const{vars:o}=(0,c.L)(),r=(0,f.D)(),{onClick:s,onKeyDown:l,onMouseEnter:S,onMouseLeave:k}=(0,g.z)({ariaLabel:t,userId:e.id});return(0,i.t)(v.Im,{userId:e.id,ariaLabel:t,children:(0,i.t)(d.k,{vAlign:"center",gap:n?"gap.medium":"gap.small",variables:o("guardians",["isStudentFocus"]),onClick:s,onKeyDown:l,onMouseEnter:S,onMouseLeave:k,...n&&(0,h.F)(y.D.StudentContactCard,!0),children:[(0,i.t)(m.mw,{users:[e],isFocusable:!1,"aria-hidden":!0,profilePictureSize:p.$D.Medium,size:n?"larger":a?"medium":"small",narrateProfilePicture:!1,variables:o("guardians",["isStudentAvatar"]),v9ClassName:r.isStudentAvatar,callerInfo:"student-renderer"}),(0,i.t)(d.k.Item,{grow:!0,children:(0,i.t)(u.x,{size:"medium",weight:"regular",content:e.displayName,"aria-hidden":!0,variables:o("guardians",[{name:"isStudentName",props:{isParentsEndSlot:n}}]),truncated:!0})})]})})},k=(e,t,n)=>{const i=n?e.stringTranslate("livePersonaCard",n):e.stringTranslate("guardians","guardians_status_unknown_label"),a=t.displayName?t.displayName:e.stringTranslate("guardians","guardians_user_unknown_label");return e.stringTranslate("guardians","guardians_student_label",{studentName:a,status:i})},C=e=>{const{member:t,isParentsEndSlot:n,isGuardiansApprovalRequestDialog:r}=e,s=(e=>{const t=(0,l.Cq)(),[n,i]=a.useState(k(t,e)),r=(0,o.x)();return a.useEffect((()=>{let n=!1;return(async()=>{try{const{title:a}=await b(r,e.id,!0);!n&&i(k(t,e,a))}catch(e){}})(),()=>{n=!0}}),[e,r,t]),n})(t);return(0,i.t)(S,{member:t,ariaLabel:s,isParentsEndSlot:n,isGuardiansApprovalRequestDialog:r})},b=async(e,t,n)=>{if(!e)throw new Error("Apollo Client is not defined");const i=await e.query({query:r,variables:{userId:t,source:"ups"},fetchPolicy:n?"cache-first":"network-only"});return(0,s.Tq)(i?.data?.presence)}},105726:(e,t,n)=>{"use strict";n.d(t,{g$:()=>c,jd:()=>d,pt:()=>m,GZ:()=>p,Dk:()=>g,Mt:()=>h,pI:()=>y});var i=n(689626),a=n(702135),o=n(438846),r=n(245831),s=n(323356),l=n(328520);const c=(e,t)=>e.isGeneral?"OwnersPost"!==t||"Admin"===e.memberRole:"Admin"===e.memberRole||e.isModerator||"Everyone"===e.channelSettings?.channelPostPermissions||"EveryoneButGuests"===e.channelSettings?.channelPostPermissions&&"Guest"!==e.memberRole&&"Undefined"!==e.memberRole,d=(e,t)=>{const n=decodeURIComponent(e),{channelId:o,replyChainId:r}=u(n,t);if(!("string"==typeof o)||!("string"==typeof r||null==r)){const n=`TeamsAndChannelsHelper::extractChannelMessageCompoundId::${i.jK.InvalidInput}::${e}`;throw t?.error(n),(0,a.Tr)("TeamsAndChannelsHelper",i.jK.InvalidInput,"extractChannelMessageCompoundId",{compoundId:e},n)}return{channelId:o,replyChainId:r}},u=(e,t)=>{try{const{channelId:t,replyChainId:n}=JSON.parse(e);return{channelId:t,replyChainId:n}}catch(n){return t?.warn(`Exception parsing channel navigation args JSON, will assume the passed id is a channel id: ${e}`),{channelId:e}}},m=e=>{if(!e)return{teamId:void 0,channelId:void 0};try{const{teamId:t,channelId:n}=JSON.parse(e);return{teamId:t,channelId:n}}catch{return{channelId:e}}},p=(e,t,n,i,a,c,d,u,m,p,g,h,y,v)=>{switch(e){case l.XW.CreateTeam:a&&v?t.teamsAndChannels.createTeamV2():i?t.teamsAndChannels.createTeamOnMainView({source:o.IC.template,canUserCreateTeam:!!v},u):t.teamsAndChannels.createTeam();break;case l.XW.CreateChannel:h&&g&&t.teamsAndChannels.createChannelOnLeftRail({entryPoint:r.y.ChannelListHeaderContextMenu});break;case l.XW.JoinTeamByCode:u===s.D.SchoolTeams?t.school.gridTeamDiscover():t.teamsAndChannels.teamDiscover();break;case l.XW.JoinTeam:c?t.teamsGallery.launchTeamsGallery():t.teamsAndChannels.teamDiscover();break;case l.XW.AddChannel:n&&g?t.teamsAndChannels.createChannel({teamId:n.id,groupId:n.groupId||"",teamType:n.teamType}):n&&t.teamsAndChannels.addChannel(n.id);break;case l.XW.AddMember:n&&(d?t.teamsAndChannels.addMemberToTeamDialog(n.id):t.teamsAndChannels.addMember(n.id));break;case l.XW.MarkAllChannelsAsRead:m?.();break;case l.XW.ManageTeamsList:t.teamsAndChannels.manageTeamsList(s.D.ChannelList,y?{entityCommand:y}:void 0,p?.()),m?.();break;case l.XW.ManageTeamsInvites:t.teamsAndChannels.manageSharedChannelsPendingInvites(s.D.ChannelList,void 0,p?.()),m?.();break;case l.XW.CrossTeamAnalytics:t.teamsAndChannels.crossTeamAnalytics(s.D.ChannelList,void 0,p?.()),m?.()}},g=e=>{const t=e,n=t.graphQLErrors?.find((e=>"CDLResolver"===e.extensions?.source)),i=n?.extensions?.prevError,a=i?.extraInfo;return a},h=e=>{if(!e)return{teamId:void 0,channelId:void 0,replyChainId:void 0,renderId:void 0};try{const t=decodeURIComponent(e),{teamId:n,channelId:i,replyChainId:a,renderId:o}=JSON.parse(t);return{teamId:n,channelId:i,replyChainId:a,renderId:o}}catch{return{channelId:e}}},y=e=>`overflow-${e}`},112020:(e,t,n)=>{"use strict";n.d(t,{UN:()=>g,Te:()=>h});var i=n(250033),a=n(818319),o=n(994575),r=n(883282),s=n(250497),l=n(237867);const c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsWebFloatingMonitorNavigateToCallScreenMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"navigateToCallScreen"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}]}]}}]};var d;!function(e){e[e.Visible=0]="Visible",e[e.Hidden=1]="Hidden",e[e.Closed=2]="Closed"}(d||(d={}));const u=[d.Hidden,d.Visible],m=a.createContext({setIntentIdOverride:()=>{},mounted:()=>{},hide:()=>Promise.resolve(),unhide:()=>Promise.resolve(),close:()=>Promise.resolve(),showCallWindow:()=>Promise.resolve()}),p=new Map,g=e=>{const t=(0,r.useNovaEventing)(),n=(0,l.x)(),[g,h]=a.useState(e.intentIdOverride),y=a.useCallback((()=>{const e=Array.from(p.values());return 0===e.length?d.Closed:e.includes(d.Visible)?d.Visible:d.Hidden}),[]),v=a.useCallback(((e,t)=>(t in u?p.set(e,t):p.delete(e),y())),[y]),f=a.useCallback((e=>{switch(e){case d.Visible:return t.generateEvent({event:s.U3.unhideMonitor()});case d.Hidden:return t.generateEvent({event:s.U3.hideMonitor()});case d.Closed:return t.generateEvent({event:s.U3.closeMonitor()})}}),[t]),S=a.useCallback((e=>{p.get(e)!==d.Hidden&&v(e,d.Visible)}),[v]),k=a.useCallback(((e,t)=>{const n=y(),i=v(e,t);return n!==i?f(i):Promise.resolve()}),[v,y,f]),C=a.useCallback((e=>k(e,d.Hidden)),[k]),b=a.useCallback((e=>k(e,d.Visible)),[k]),w=a.useCallback((e=>k(e,d.Closed)),[k]),T=(0,o.w)("WebFloatingMonitorContextProvider"),I=a.useCallback((e=>n?.mutate({mutation:c,variables:{teamsCallId:e}}).then((e=>{e.data?.navigateToCallScreen||T.error("Failed to navigate to call screen via navigateToCallScreen mutation")})).catch((e=>T.error(`Failed to navigate to call screen via navigateToCallScreen mutation: ${e.message}`)))),[n,T]),N=a.useMemo((()=>({intentIdOverride:g,setIntentIdOverride:h,mounted:S,hide:C,unhide:b,close:w,showCallWindow:I})),[g,S,C,b,w,I]);return(0,i.t)(m.Provider,{value:N,children:e.children})},h=()=>a.useContext(m)},212495:(e,t,n)=>{"use strict";n.d(t,{D:()=>i});const i=(0,n(696618).s)({isStudentAvatar:{Bf4jedk:"f1ohpo60"},isParentAvatar:{Bf4jedk:"ff9fk16"}},{d:[".f1ohpo60{min-width:2.8rem;}",".ff9fk16{min-width:3.2rem;}"]})},931473:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<link\n  rel="shortcut icon"\n  type="image/x-icon"\n  id="teams-favicon"\n  href="[[staticsPath]]/evergreen-assets/icons/microsoft_teams_logo_refresh.ico"\n/>';return __p}},346701:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)__p+="<style>\n  .preload-title-bar-trim {\n    ","mac"===osPlatform?__p+="\n    --preload-title-bar-background-color: rgb(98, 100, 167);\n    ":__p+="\n    --preload-title-bar-background-color: rgb(70, 71, 117);\n    ",__p+='\n\n    background-color: var(--preload-title-bar-background-color);\n    padding: .3rem .3rem 0 .3rem;\n    height: 4rem;\n    width: 100%;\n    position: fixed;\n    top: 0;\n    left: 0;\n    box-sizing: border-box;\n    -webkit-app-region: drag;\n    z-index: -20;\n  }\n\n  .preload-title-bar-trim * {\n    margin: 0;\n    padding: 0;\n    -webkit-margin-before: 0;\n    -webkit-margin-after: 0;\n    box-sizing: inherit;\n  }\n\n  .preload-title-bar {\n    height: 100%;\n    width: 100%;\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    color: white;\n    position: relative;\n  }\n\n\n  /**\n   * Allows resizing around the edges of the title bar by creating a region that isn\'t draggable\n   * The \'top\' value must be greater than zero, otherwise when the app is maximized,\n   * you won\'t be able to click and drag the window from the very top\n   */\n  .preload-title-bar::before {\n    content: "";\n    top: .2rem;\n    position: absolute;\n    height: .2rem;\n    -webkit-app-region: no-drag;\n    width: 100%;\n    left: 0;\n  }\n\n  .preload-title-bar-text {\n    margin: auto;\n    text-align: center;\n    font-size: 1.4rem;\n    pointer-events: none;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n\n  .preload-title-bar-buttons {\n    height: 4rem;\n    display: flex;\n    flex-basis: 0;\n    align-items: center;\n    position: absolute;\n    top: 0;\n    right: 0;\n    margin-top: -.3rem;\n    margin-right: -.3rem;\n  }\n\n  .preload-title-bar-button {\n    background-color: var(--preload-title-bar-background-color);\n    -webkit-app-region: no-drag;\n    user-select: none;\n    border: 0;\n    border-radius: 0;\n    cursor: pointer;\n    height: 100%;\n    width: 4rem;\n    outline: none;\n  }\n\n  .preload-title-bar-button>svg {\n    fill: white;\n    background-color: inherit;\n    width: 1.6rem;\n    height: 1.6rem;\n    display: block;\n    margin: auto;\n  }\n\n  .preload-title-bar-button-close-filled {\n    display: none;\n  }\n\n  .preload-title-bar-button-close-outline {\n    display: block;\n  }\n\n  .preload-title-bar-button:hover {\n    background-color: rgb(51, 52, 74);\n  }\n\n  .preload-title-bar-button-close:hover {\n    background-color: rgb(196, 49, 75);\n  }\n\n  .preload-title-bar-button-close:hover .preload-title-bar-button-close-filled {\n    display: block;\n  }\n\n  .preload-title-bar-button-close:hover .preload-title-bar-button-close-outline {\n    display: none;\n  }\n</style>\n<div class="preload-title-bar-trim">\n  <div id="preload-title-bar" class="preload-title-bar">\n    <span class="preload-title-bar-text" aria-hidden="true">Microsoft Teams</span>\n\n    ',"windows"===osPlatform&&(__p+='\n    <div class="preload-title-bar-buttons">\n      \x3c!-- TODO: Hook button up to minimize/maximize/collapse API --\x3e\n      <button class="preload-title-bar-button">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <path d="M10 16v-1h12v1H10z"></path>\n        </svg>\n      </button>\n      \x3c!-- TODO: Hook button up to minimize/maximize/collapse API --\x3e\n      <button class="preload-title-bar-button">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <path d="M10 10h12v12H10V10zm11 11V11H11v10h10z"></path>\n        </svg>\n      </button>\n      \x3c!-- TODO: toggle on when maximized --\x3e\n      \x3c!-- TODO: Hook button up to minimize/maximize/collapse API --\x3e\n      <button class="preload-title-bar-button" style="display:none;">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <path d="M11 9v2H9v12h12v-2h2V9H11zm9 13H10V12h10v10zm2-2h-1v-9h-9v-1h10v10z"></path>\n        </svg>\n      </button>\n      <button class="preload-title-bar-button preload-title-bar-button-close">\n        <svg role="presentation" focusable="false" viewBox="8 8 16 16">\n          <g>\n            <path class="preload-title-bar-button-close-outline"\n              d="M16.707 16l4.243-4.243a.5.5 0 1 0-.707-.707L16 15.293l-4.243-4.243a.5.5 0 1 0-.707.707L15.293 16l-4.243 4.243a.5.5 0 1 0 .707.707L16 16.707l4.243 4.243a.498.498 0 0 0 .707 0 .5.5 0 0 0 0-.707L16.707 16z">\n            </path>\n            <path class="preload-title-bar-button-close-filled"\n              d="M17.414 16l3.89-3.89a1 1 0 1 0-1.415-1.413L16 14.586l-3.89-3.89a1 1 0 1 0-1.413 1.415L14.586 16l-3.89 3.89a1 1 0 1 0 1.415 1.413L16 17.414l3.89 3.89a.997.997 0 0 0 1.413 0 1 1 0 0 0 0-1.415L17.414 16z">\n            </path>\n          </g>\n        </svg>\n      </button>\n    </div>\n    '),__p+="\n  </div>\n</div>";return __p}},871177:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)0;return __p}},406364:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<style type="text/css" id="splash-styles">\n  /** Remove outline, when focusing splash screen, because it is not necessary to inform user about focus on that element. */\n  div[id="splash-screen"] {\n    outline: none;\n  }\n\n\n  /** Below styles are dedicated for the pre-loading wheel (before React loads) */\n  .ui.loader {\n    display: none;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    margin: 0;\n    text-align: center;\n    z-index: 1000;\n    -webkit-transform: translateX(-50%) translateY(-50%);\n    transform: translateX(-50%) translateY(-50%);\n  }\n\n  .ui.loader:before {\n    position: absolute;\n    content: "";\n    top: 0;\n    left: 50%;\n    width: 100%;\n    height: 100%;\n    border-radius: 500rem;\n    border: 0.2em solid rgba(0, 0, 0, 0.1);\n  }\n\n  .ui.loader:after {\n    position: absolute;\n    content: "";\n    top: 0;\n    left: 50%;\n    width: 100%;\n    height: 100%;\n    -webkit-animation: loader 0.6s linear;\n    animation: loader 0.6s linear;\n    -webkit-animation-iteration-count: infinite;\n    animation-iteration-count: infinite;\n    border-radius: 500rem;\n    border-color: #767676 transparent transparent;\n    border-style: solid;\n    border-width: 0.2em;\n    -webkit-box-shadow: 0 0 0 1px transparent;\n    box-shadow: 0 0 0 1px transparent;\n  }\n\n  @-webkit-keyframes loader {\n    from {\n      -webkit-transform: rotate(0);\n      transform: rotate(0);\n    }\n\n    to {\n      -webkit-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n\n  @keyframes loader {\n    from {\n      -webkit-transform: rotate(0);\n      transform: rotate(0);\n    }\n\n    to {\n      -webkit-transform: rotate(360deg);\n      transform: rotate(360deg);\n    }\n  }\n\n  .ui.large.loader:after,\n  .ui.large.loader:before {\n    width: 3.42857143rem;\n    height: 3.42857143rem;\n    margin: 0 0 0 -1.71428571rem;\n  }\n\n  .ui.text.loader {\n    width: auto !important;\n    height: auto !important;\n    text-align: center;\n    font-style: normal;\n  }\n\n  .ui.loader.active,\n  .ui.loader.visible {\n    display: block;\n  }\n\n  .ui.loader.disabled,\n  .ui.loader.hidden {\n    display: none;\n  }\n\n  .ui.large.text.loader {\n    min-width: 3.42857143rem;\n    padding-top: 4.21428571rem;\n  }\n\n  @-webkit-keyframes fadeOut {\n    from {\n      opacity: 1;\n    }\n\n    to {\n      opacity: 0;\n    }\n  }\n\n  @keyframes fadeOut {\n    from {\n      opacity: 1;\n    }\n\n    to {\n      opacity: 0;\n    }\n  }\n\n  .ui.loader.fadeOut {\n    -webkit-animation: fadeOut 500ms linear;\n    animation: fadeOut 500ms linear;\n  }\n</style>';return __p}},874645:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)__p+='<div id="splash-screen" tabindex="-1" role="progressbar" aria-valuetext="Loading..."\nstyle="height: 100vh; overflow: hidden; -webkit-app-region: drag;">\n  \x3c!-- Inline styles below as once React loads, all of the below will be removed. --\x3e\n  <div style="height: calc(100% - 4rem);\n                -webkit-user-select: none;\n                background-color: transparent;">\n    ',titleBar&&(__p+='\n      <div style="height:4rem;background-color:#464775"></div>\n    '),__p+='\n    <div class="ui large active text loader">\n      <span id="splash-screen-label">Loading...</span>\n    </div>\n  </div>\n</div>\n';return __p}},706827:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<!DOCTYPE html>\n<html lang="en">\n\n<head data-config="'+(null==(__t=htmlWebpackPlugin.options.platformConfig)?"":__t)+'">\n  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />\n  <meta name="containerVer" content="'+(null==(__t=htmlWebpackPlugin.options.containerVer)?"":__t)+'" />\n  ',htmlWebpackPlugin.options.viewportContext&&(__p+='\n    <meta name="viewportContext" content="'+(null==(__t=htmlWebpackPlugin.options.viewportContext)?"":__t)+'" />\n  '),__p+="\n  ",htmlWebpackPlugin.options.enablePwa&&(__p+='\n    <link rel="manifest" href="manifest.json" crossorigin="use-credentials"/>\n  '),__p+=" \n  ";let allEntryAssets=[],loaderChunks=[],mainChunks=[],reactDevToolsChunks=[],asyncEntryManifest=[],buildTimeConfigManifest=[],mainPreloads="",griffelPreload="",configPreloads="";if(htmlWebpackPlugin.files.js){const lazyAssets=htmlWebpackPlugin.options.lazy,configPreloadedChunkSet=new Set(htmlWebpackPlugin.options.preloadedChunks||[]),buildTimeConfigs=new Set(htmlWebpackPlugin.options.buildTimeConfigs||[]);function getFilesForChunk(e){if("string"==typeof e&&(e=new Set([e])),!e||!e.size)return new Set;const t=Array.from(e).filter((e=>e&&"RegExp"===e.constructor.name)),n=compilation.chunkGroups.filter((n=>{const i=n.options&&n.options.name;return e.has(i)||t.some((e=>e.test(i)))})),i=new Set;return n.forEach((e=>{(e.chunks||[]).forEach((e=>{(e.files||[]).forEach((e=>i.add(e)))}))})),i}function getFilteredEntryAssets(e){const t=Array.from(e).join("***");return allEntryAssets.filter((e=>{const n=e.path.split("/").pop();return t.includes(n)&&!e.isLazy&&!e.isGriffel}))}function toPreloadLink(e){return`<link href="${e}" as="${/\.css$/.test(e)?"style":"script"}" rel="preload" />`}function fileToLoaderObject(e){return{path:`${compilation.options.output.publicPath}${e}`,isPolyfill:!1}}allEntryAssets=htmlWebpackPlugin.files.js.concat(htmlWebpackPlugin.files.css).map((e=>{const t=e.split("/").pop().replace(/(-[0-9a-g]+)?\..+/,"");return{id:t,path:e,isPolyfill:/polyfill/.test(t),isLazy:lazyAssets&&lazyAssets.includes(t)||undefined,isGriffel:/griffel/.test(t)||undefined}}));const mainFiles=getFilesForChunk("main"),loaderFiles=getFilesForChunk("loader"),reactDevToolsFiles=getFilesForChunk("reactdevtools"),asyncEntryFiles=getFilesForChunk("async-entry"),configPreloadFiles=getFilesForChunk(configPreloadedChunkSet),buildTimeConfigsFiles=getFilesForChunk(buildTimeConfigs);loaderFiles.forEach((e=>mainFiles.delete(e))),loaderFiles.forEach((e=>reactDevToolsFiles.delete(e))),mainChunks=getFilteredEntryAssets(mainFiles),loaderChunks=getFilteredEntryAssets(loaderFiles),reactDevToolsChunks=getFilteredEntryAssets(reactDevToolsFiles);const batchedRemoteEntry=htmlWebpackPlugin.options.createBatchedRemoteEntry(compilation);mainPreloads=mainChunks.map((e=>e.path)).map(toPreloadLink).join("\n"),griffelPreload=allEntryAssets.filter((e=>e.isGriffel)).map((e=>e.path)).map(toPreloadLink).join("\n"),configPreloads=[...Array.from(configPreloadFiles),batchedRemoteEntry].filter((e=>!!e)).map((e=>`${compilation.options.output.publicPath}${e}`)).map(toPreloadLink).join("\n"),asyncEntryManifest=[...Array.from(asyncEntryFiles),batchedRemoteEntry].filter((e=>!!e)).map(fileToLoaderObject),buildTimeConfigManifest=Array.from(buildTimeConfigsFiles).map((e=>`${compilation.options.output.publicPath}${e}`))}if(__p+="\n  \n  "+(null==(__t=mainPreloads)?"":__t)+"\n  "+(null==(__t=configPreloads)?"":__t)+"\n  "+(null==(__t=griffelPreload)?"":__t)+'\n\n  <script nonce="'+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+'">\n    '+(null==(__t=htmlWebpackPlugin.options.publicPathScript)?"":__t)+"\n\n    // Set container version to be captured in heap snapshots.\n    window.__debug_containerVersion__ = `CONTAINER_VERSION="+(null==(__t=htmlWebpackPlugin.options.containerVer)?"":__t)+"`;\n    __VERSION__  = '"+(null==(__t=htmlWebpackPlugin.options.containerVer)?"":__t)+"';\n\n    // TODO Remove the copy step once OnePlayer Loader supports dynamic importing. (https://onedrive.visualstudio.com/OMG/_workitems/edit/1170258)\n    onePlayerLoaderFullStaticPath = window.__webpack_public_path__;\n\n    // Set theme and default title.\n    document.documentElement.classList.add(\"theme-"+(null==(__t=htmlWebpackPlugin.options.theme)?"":__t)+'");\n    document.title = "Microsoft Teams";\n  <\/script>\n  '+(null==(__t=htmlWebpackPlugin.options.partials.favicons)?"":__t)+"\n\n  ",htmlWebpackPlugin.options.isMainWindow&&(__p+='\n    <script type="text/javascript" nonce="'+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+"\">\n      __webpack_nonce__ = '"+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+"';\n    <\/script>\n\n    <script nonce=\""+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+'">\n      performance.mark("execute-index-html-script");\n    <\/script>\n  '),__p+="\n\n  <style>\n    html,\n    body {\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Web', sans-serif;\n      width: 100%;\n      height: 100%;\n      padding: 0;\n      margin: 0;\n      color: var(--themeColor);\n    }\n\n    html {\n      font-size: 10px;\n      forced-color-adjust: none;\n    }\n\n    body {\n      /*\n        We cannot apply the background color on the HTML element. It covers the video during calls.\n      */\n      background-color: var(--themeBackgroundColor);\n      font-size: 1.4rem;\n      overflow: hidden;\n      /*\n      Prevent pinch-to-zoom\n      TODO: remove this when #1958571 is done\n      */\n      touch-action: none;\n    }\n\n    /** Enable antialiasing and font smoothing across supporting browsers for all elements */\n    * {\n      -webkit-font-smoothing: antialiased;\n      -moz-osx-font-smoothing: grayscale;\n    }\n\n    /*!*Remove hidden ADAL iframes borders as to not cause unnecessary vertical scrolling*!*/\n    body>iframe[id^=\"adal\"] {\n      border: 0;\n    }\n  </style>\n\n  ",htmlWebpackPlugin.options.partials.loadingScreenStyles&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.loadingScreenStyles)?"":__t)+"\n  "),__p+="\n\n  ",htmlWebpackPlugin.options.partials.titleBarStyles&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.titleBarStyles)?"":__t)+"\n  "),__p+="\n\n  ",htmlWebpackPlugin.options.partials.errorScreenStyles&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.errorScreenStyles)?"":__t)+"\n  "),__p+="\n\n  ",htmlWebpackPlugin.options.partials.themeStyles&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.themeStyles)?"":__t)+"\n  "),__p+="\n\n</head>\n\n<body>\n\n  ",htmlWebpackPlugin.options.partials.preloadTitleBar&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.preloadTitleBar)?"":__t)+"\n  "),__p+='\n\n  <div id="app" style="display: block; height: inherit;"></div>\n\n  ',htmlWebpackPlugin.options.partials.errorScreen&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.errorScreen)?"":__t)+"\n  "),__p+="\n\n  ",htmlWebpackPlugin.options.partials.loadingScreen&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.loadingScreen)?"":__t)+"\n  "),__p+="\n\n  ",htmlWebpackPlugin.options.partials.titleBar&&(__p+="\n    "+(null==(__t=htmlWebpackPlugin.options.partials.titleBar)?"":__t)+"\n  "),__p+='\n\n  <script type="application/javascript" nonce="'+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+'">\n    // This code is required to provide post message communication between hosted iframe and core window.\n    (function() {\n      function proxyPostMessage(target, message, targetOrigin, transfer) {\n        if (targetOrigin && target && target.contentWindow) {\n          target.contentWindow.postMessage(message, targetOrigin, transfer);\n        } else {\n          console.log("either targetOrigin or target is invalid");\n        }\n      }\n      window.proxyPostMessage = proxyPostMessage;\n    })();\n  <\/script>\n\n  \x3c!-- Only use custom inject logic if `inject: false` is set --\x3e\n ',!htmlWebpackPlugin.options.inject&&htmlWebpackPlugin.files.js){for(var file of(__p+='\n    \x3c!-- Chunk loader configuration - only named chunks --\x3e\n    <script id="cache-chunks" type="application/javascript" nonce="'+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+"\">\n      window.__experienceWindowChunks__ = JSON.parse(\n        '"+(null==(__t=JSON.stringify(Object.fromEntries(allEntryAssets.filter((e=>!/^[0-9]+$/.test(e.id))).map((e=>[e.id,e.path])))))?"":__t)+'\');\n    <\/script>\n\n    <script id="loader-config" nonce="'+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+'">\n      window.loaderConfig = {\n        experienceName: "'+(null==(__t=htmlWebpackPlugin.options.experienceName)?"":__t)+'",\n        build: "'+(null==(__t=htmlWebpackPlugin.options.containerVer)?"":__t)+'",\n        manifest: {\n          chunks: '+(null==(__t=JSON.stringify(mainChunks))?"":__t)+",\n          buildTimeConfigs: "+(null==(__t=JSON.stringify(buildTimeConfigManifest))?"":__t)+",\n          asyncEntry: {\n            chunks: "+(null==(__t=JSON.stringify(asyncEntryManifest))?"":__t)+"\n          },\n        },\n        ",htmlWebpackPlugin.options.isContainerBuild&&(__p+='\n        buildId: "'+(null==(__t=htmlWebpackPlugin.options.buildId)?"":__t)+'", pullRequestId: "'+(null==(__t=htmlWebpackPlugin.options.pullRequestId)?"":__t)+'",\n        '),__p+="\n        preInitWorker: true\n      }\n    <\/script>\n\n    ",reactDevToolsChunks))__p+='\n        <script id="'+(null==(__t=file.id)?"":__t)+'" src="'+(null==(__t=file.path)?"":__t)+'"><\/script>\n    ';for(var file of(__p+="\n    ",loaderChunks))__p+="\n      ",htmlWebpackPlugin.options.inlineLoaderScripts?__p+='\n        <script id="'+(null==(__t=file.id)?"":__t)+'" nonce="'+(null==(__t=htmlWebpackPlugin.options.cspNonce)?"":__t)+'">\n          '+(null==(__t=compilation.assets[file.path.substr(htmlWebpackPlugin.files.publicPath.length)].source())?"":__t)+"\n        <\/script>\n      ":__p+='\n        <script id="'+(null==(__t=file.id)?"":__t)+'" src="'+(null==(__t=file.path)?"":__t)+'"><\/script>\n      ',__p+="\n    ";__p+="\n\n  "}__p+="\n</body>\n</html>\n"}return __p}},515719:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<style id="theme-styles">\n  .theme-defaultV2,\n  .theme-tfl-default {\n    --themeBackgroundColor: #F5F5F5;\n    --themeColor: #252423;\n  }\n\n  .theme-darkV2,\n  .theme-tfl-dark {\n    --themeBackgroundColor: #141414;\n    --themeColor: #FFF;\n  }\n\n  .theme-contrast {\n    --themeBackgroundColor: #000;\n    --themeColor: #FFF;\n  }\n\n  .mica {\n    --themeBackgroundColor: transparent;\n  }\n\n  .theme-tfl-dark.mercury {\n    --themeBackgroundColor: rgba(20, 20, 20, 0.3);\n  }\n  .theme-tfl-default.mercury {\n    --themeBackgroundColor: transparent;\n  }\n\n</style>\n';return __p}},671491:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<style id="pre-core-title-bar-styles">\n\n  #pre-core-title-bar {\n    position: absolute;\n    top: 0;\n    width: inherit;\n    height: 4.8rem;\n    overflow: hidden;\n    display: none;\n    align-items: center;\n    -webkit-app-region: drag;\n    background-color: var(--themeTitleBarBackgroundColor);\n  }\n\n  #pre-core-title-bar.show {\n    display: flex;\n  }\n\n  .pre-core-title-bar.logo {\n    display: inline-block;\n    margin-left: 2.4rem;\n    width: 2rem;\n    height: 2rem;\n    vertical-align: middle;\n  }\n\n  .pre-core-title-bar.logo.hide {\n    display: none;\n  }\n\n  #pre-core-action-buttons {\n    margin: 0 0 0 auto;\n    white-space: nowrap;\n    display: none;\n    -webkit-app-region: no-drag;\n    color: var(--themeTitleBarColor)\n  }\n\n  #pre-core-action-buttons.show {\n    display: flex;\n  }\n\n  .pre-core-action-ui-button {\n    height: 4.8rem;\n    width: 4.4rem;\n    border-radius: 0;\n    background-color: transparent;\n    min-width: 3.2rem;\n    padding: 0;\n    border: 0;\n    transition: all 100ms ease 0s;\n    cursor: pointer;\n    max-width: 28rem;\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n    vertical-align: middle;\n    color: var(--themeTitleBarButtonColor);\n  }\n\n  /* default hover style of action ui button*/\n  .pre-core-action-ui-button:hover {\n    background-color: var(--themeTitleBarButtonHoverBackgroundColor);\n    color: var(--themeTitleBarButtonHoverColor);\n  }\n\n  .pre-core-action-ui-button:hover .pre-core-action-ui-icon {\n    visibility: visible;\n  }\n\n  .pre-core-action-ui-button:focus,\n  .pre-core-action-ui-button:focus:not(:focus-visible) {\n    outline: none;\n  }\n\n  .pre-core-action-ui-box {\n    display: inline-flex;\n    justify-content: center;\n    align-items: center;\n  }\n\n  .pre-core-action-ui-icon {\n    vertical-align: middle;\n    display: inline-block;\n  }\n\n  .pre-core-action-ui-icon.hide {\n    display: none;\n  }\n\n  .pre-core-action-ui-svg {\n    height: 1.6rem;\n    width: 1.6rem;\n    display: block;\n    fill: currentColor;\n    transform: rotate(0deg);\n  }\n\n  /* Close button with hover*/\n  #pre-core-title-bar-close-button:hover {\n    background: rgb(196, 49, 75);\n    color: #fff;\n  }\n\n  #pre-core-title-bar-close-button:hover .outline {\n    display: none;\n  }\n\n  #pre-core-title-bar-close-button:hover .filled {\n    display: block;\n  }\n\n  /* Close button without hover*/\n  #pre-core-title-bar-close-button .outline {\n    display: block;\n  }\n\n  #pre-core-title-bar-close-button .filled {\n    display: none;\n  }\n\n  /* Light Theme */\n  .theme-defaultV2,\n  .theme-tfl-default {\n    --themeTitleBarBackgroundColor: #ebebeb;\n    --themeTitleBarColor: #616161;\n    --themeTitleBarButtonHoverBackgroundColor: rgba(255,255,255,0.65);\n    --themeTitleBarButtonHoverColor: #616161;\n  }\n\n  /* Dark Theme */\n  .theme-darkV2,\n  .theme-tfl-dark {\n    --themeTitleBarBackgroundColor: #0a0a0a;\n    --themeTitleBarColor: #adadad;\n    --themeTitleBarButtonHoverBackgroundColor: rgba(255,255,255,0.1);\n    --themeTitleBarButtonHoverColor: #adadad;\n  }\n\n  /* High Contrast Theme */\n  .theme-contrast {\n    --themeTitleBarBackgroundColor: rgb(90, 90, 90);\n    --themeTitleBarColor: #fff;\n    --themeTitleBarButtonHoverBackgroundColor: #1aebff;\n    --themeTitleBarButtonHoverColor: #000;\n  }\n\n  /* Mica overrides */\n  .mica {\n    --themeTitleBarBackgroundColor: transparent;\n  }\n  \n  #high-contrast-logo {\n    width: 2rem; \n    color:white;\n    fill: white; \n    display:none\n  }\n\n  .theme-contrast #high-contrast-logo {\n    display: block;\n  }\n\n  .theme-contrast #normal-logo {\n    display: none;\n  }\n</style>';return __p}},650411:module=>{module.exports=function(obj){obj||(obj={});var __t,__p="",__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj)__p+='<div id="pre-core-title-bar" tabindex="-1" data-tid="pre-core-title-bar">\n  <span id="pre-core-title-bar-logo" class="pre-core-title-bar logo" role="img" aria-hidden="true" title="Microsoft Teams">\n    <svg role="presentation" viewBox="2 2 20 20" id="high-contrast-logo">\n      <path\n        fill-rule="evenodd"\n        clip-rule="evenodd"\n        d="M14 9V10H21.061C21.579 10 22 10.386 22 10.861V15.75C22 17.335 20.598 18.62 18.869 18.62C18.508 18.62 18.039 18.553 17.644 18.327C16.97 19.899 15.409 21 13.59 21H13.41C11.467 21 9.818 19.744 9.23 18H3C2.45 18 2 17.55 2 17V7C2 6.45 2.45 6 3 6H11C11 4.343 12.343 3 14 3C15.657 3 17 4.343 17 6C17 7.657 15.657 9 14 9ZM16 6C16 7.103 15.103 8 14 8V7C14 6.45 13.55 6 13 6H12C12 4.897 12.897 4 14 4C15.103 4 16 4.897 16 6ZM8.468 15.875V10.055H10.632V8.125H4.368V10.055H6.545V15.875H8.468ZM17 16.59V16.631C16.998 16.657 16.997 16.685 16.998 16.713C16.933 18.536 15.429 20 13.59 20H13.41C12.032 20 10.843 19.179 10.305 18H13C13.55 18 14 17.55 14 17V11H17V16.59ZM21 15.75C21 16.781 20.044 17.62 18.869 17.62C18.761 17.62 18.285 17.606 18.034 17.381C18.0368 17.2312 18.0252 17.0874 18.0147 16.9579L18.012 16.924L18.008 16.8821C18.0032 16.8321 17.9986 16.7839 17.997 16.74C17.999 16.69 18 16.64 18 16.59V11H21V15.75ZM21.2 7C21.2 7.662 20.662 8.2 20 8.2C19.338 8.2 18.8 7.662 18.8 7C18.8 6.338 19.338 5.8 20 5.8C20.662 5.8 21.2 6.338 21.2 7ZM20 5C21.105 5 22 5.896 22 7C22 8.104 21.105 9 20 9C18.896 9 18 8.104 18 7C18 5.896 18.896 5 20 5Z"\n      />\n    </svg>\n    <svg role="presentation" viewBox="2 2 20 20" id="normal-logo" style="width: 2rem">\n      <path\n        d="M21.0344 10.0012H16.8734L15.7124 10.9402V15.5972C15.7124 17.3262 17.1134 18.7282 18.8424 18.7282C20.5724 18.7282 21.9734 17.3262 21.9734 15.5972V10.9402C21.9734 10.4222 21.5534 10.0012 21.0344 10.0012Z"\n        fill="#5059C9"\n      />\n      <path\n        d="M22 7C22 8.104 21.105 9 20 9C18.895 9 18 8.104 18 7C18 5.896 18.895 5 20 5C21.105 5 22 5.896 22 7Z"\n        fill="#5059C9"\n      />\n      <path\n        d="M9.89214 10.0046H17.0961C17.5921 10.0046 17.9941 10.4066 17.9941 10.9026V16.5946C17.9941 19.0306 16.0201 21.0046 13.5841 21.0046H13.4041C10.9681 21.0046 8.99414 19.0306 8.99414 16.5946V10.9026C8.99414 10.4066 9.39614 10.0046 9.89214 10.0046Z"\n        fill="#7B83EB"\n      />\n      <path\n        d="M16.9065 5.99999C16.9065 7.60499 15.6055 8.90699 13.9995 8.90699C12.3945 8.90699 11.0935 7.60499 11.0935 5.99999C11.0935 4.39499 12.3945 3.09299 13.9995 3.09299C15.6055 3.09299 16.9065 4.39499 16.9065 5.99999Z"\n        fill="#7B83EB"\n      />\n      <path\n        opacity="0.5"\n        fillRule="evenodd"\n        clipRule="evenodd"\n        d="M15.0001 8.6814V8.0004C15.0001 7.4504 14.5281 7.0004 13.9511 7.0004H11.2711C11.6881 8.0944 12.7391 8.8754 13.9801 8.8754C14.3401 8.8754 14.6821 8.8014 15.0001 8.6814ZM8.99414 10.9024C8.99414 10.4064 9.39614 10.0044 9.89214 10.0044H15.0001V17.8394C15.0001 18.3894 14.3821 19.0004 13.7451 19.0004H9.71514C9.26214 18.3074 8.99414 17.4834 8.99414 16.5944V10.9024Z"\n        fill="black"\n      />\n      ',environment&&"life"===environment?__p+='\n      <path\n        d="M3 18C2.45 18 2 17.55 2 17V7C2 6.45 2.45 6 3 6H13C13.55 6 14 6.45 14 7V17C14 17.55 13.55 18 13 18H3Z"\n        fill="white"\n      />\n      <path\n        d="M11.0001 10H8.83511V15.82H7.41211V10H5.23511V8.57001H11.0001V10Z"\n        fill="#4B53BC"\n      />\n      ':__p+='\n        <path\n        d="M3 18C2.45 18 2 17.55 2 17V7C2 6.45 2.45 6 3 6H13C13.55 6 14 6.45 14 7V17C14 17.55 13.55 18 13 18H3Z"\n        fill="#4B53BC"\n      />\n      <path\n        d="M11.0001 10H8.83511V15.82H7.41211V10H5.23511V8.57001H11.0001V10Z"\n        fill="white"\n      />\n      ',__p+='\n    </svg>\n  </span>\n\n  \x3c!-- loading window action buttons --\x3e\n  <div id="pre-core-action-buttons">\n    <button id="pre-core-title-bar-minimize-button" tabindex="-1" data-aa-class="Button"\n      class="pre-core-action-ui-button" data-tid="pre-core-title-bar-minimize-button" aria-hidden="true">\n      <div class="pre-core-action-ui-box">\n        <span role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path d="M3.5 7h9c.28 0 .5.22.5.5s-.22.5-.5.5h-9c-.28 0-.5-.22-.5-.5s.22-.5.5-.5z" />\n          </svg>\n        </span>\n      </div>\n    </button>\n    <button id="pre-core-title-bar-maximize-restore-button" tabindex="-1" data-aa-class="Button"\n      class="pre-core-action-ui-button" data-tid="pre-core-title-bar-maximize-button" aria-hidden="true">\n      <div class="pre-core-action-ui-box">\n        <span id="pre-core-maximize-icon" role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path\n              d="M4.5 3A1.5 1.5 0 003 4.5v7A1.5 1.5 0 004.5 13h7a1.5 1.5 0 001.5-1.5v-7A1.5 1.5 0 0011.5 3h-7zm0 1h7a.5.5 0 01.5.5v7a.5.5 0 01-.5.5h-7a.5.5 0 01-.5-.5v-7a.5.5 0 01.5-.5z" />\n          </svg>\n        </span>\n        <span id="pre-core-restore-icon" role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path d="M5.084 4a1.5 1.5 0 011.415-1h3.5a3 3 0 013 3v3.5a1.5 1.5 0 01-1 1.415V6a2 2 0 00-2-2H5.084z" />\n            <path\n              d="M4.5 5h5A1.5 1.5 0 0111 6.5v5A1.5 1.5 0 019.5 13h-5A1.5 1.5 0 013 11.5v-5A1.5 1.5 0 014.5 5zm0 1a.5.5 0 00-.5.5v5a.5.5 0 00.5.5h5a.5.5 0 00.5-.5v-5a.5.5 0 00-.5-.5h-5z" />\n          </svg>\n        </span>\n      </div>\n    </button>\n    <button id="pre-core-title-bar-close-button" tabindex="-1" data-aa-class="Button" class="pre-core-action-ui-button"\n      data-tid="pre-core-title-bar-close-button" aria-hidden="true">\n      <div class="pre-core-action-ui-box">\n        <span role="img" aria-hidden="true" class="pre-core-action-ui-icon">\n          <svg role="presentation" viewBox="0 0 16 16" class="pre-core-action-ui-svg">\n            <path\n              d="M2.589 2.716l.058-.069a.498.498 0 01.637-.058l.069.058L8 7.293l4.646-4.647a.5.5 0 01.707.707L8.707 8l4.647 4.646a.5.5 0 01.058.638l-.058.069a.5.5 0 01-.638.058l-.069-.058L8 8.707l-4.646 4.647a.5.5 0 01-.707-.707L7.293 8 2.646 3.354a.501.501 0 01-.057-.638l.058-.069-.058.069z" />\n          </svg>\n        </span>\n      </div>\n    </button>\n  </div>\n</div>';return __p}},167312:(e,t,n)=>{"use strict";n.d(t,{qo:()=>f,m8:()=>h,F2:()=>g,I1:()=>y,Xf:()=>S,Ae:()=>k,wY:()=>T,Zm:()=>v});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"firstLoginInfoNS"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Web"}},{kind:"Field",name:{kind:"Name",value:"WebNorthStar"}},{kind:"Field",name:{kind:"Name",value:"CoachMarkSavedWeb"}},{kind:"Field",name:{kind:"Name",value:"PromptCards"}},{kind:"Field",name:{kind:"Name",value:"FreemiumFRE"}},{kind:"Field",name:{kind:"Name",value:"ios"}},{kind:"Field",name:{kind:"Name",value:"android"}},{kind:"Field",name:{kind:"Name",value:"wp"}},{kind:"Field",name:{kind:"Name",value:"electron"}},{kind:"Field",name:{kind:"Name",value:"maglev"}},{kind:"Field",name:{kind:"Name",value:"desktopHwa"}},{kind:"Field",name:{kind:"Name",value:"surfaceHub"}},{kind:"Field",name:{kind:"Name",value:"espFirstRunStarted"}},{kind:"Field",name:{kind:"Name",value:"espFirstRunCompleted"}},{kind:"Field",name:{kind:"Name",value:"unknown"}}]}}]},a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferencesForCategory"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesForCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformationValue"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"firstLoginInfoNS"}}]}}]}}]}}]}},...i.definitions]},o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsEspUserPreferenceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"value"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateUserPreferences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}},{kind:"Argument",name:{kind:"Name",value:"value"},value:{kind:"Variable",name:{kind:"Name",value:"value"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserPreferences"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"firstLoginInfoNS"}}]}}]}}]}}]}},...i.definitions]},r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"activateEspTarget"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"surfaceId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"targetId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"selector"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activateEspTarget"},arguments:[{kind:"Argument",name:{kind:"Name",value:"surfaceId"},value:{kind:"Variable",name:{kind:"Name",value:"surfaceId"}}},{kind:"Argument",name:{kind:"Name",value:"targetId"},value:{kind:"Variable",name:{kind:"Name",value:"targetId"}}},{kind:"Argument",name:{kind:"Name",value:"selector"},value:{kind:"Variable",name:{kind:"Name",value:"selector"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}]}]}}]},s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEspAppReadyTriggerStatusQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appReadyTriggerStatus"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isAppReadyCompleted"}}]}}]}}]};var l=n(897826),c=n(702135),d=n(689626),u=n(803238);const m="growth_growthplatform_start_esp_job",p="syntheticNotificationRecommendation",g=(e,t)=>{try{const t=e.readQuery({query:s});return t&&t.appReadyTriggerStatus?t.appReadyTriggerStatus:{isAppReadyCompleted:!1}}catch(e){return t.errorToTelemetry?.("Failed to get trigger status",m),{isAppReadyCompleted:!1}}},h=(e,t)=>{try{e.writeQuery({query:s,data:{appReadyTriggerStatus:{__typename:"AppReadyTriggerStatus",isAppReadyCompleted:!0}}})}catch(e){const n=T(e,"Failed to complete app ready trigger status.");throw t.errorToTelemetry?.(n.join(" "),m),e}},y=async(e,t)=>{try{const t=await e.query({query:a,variables:{category:"firstLoginInformation"}});return"FirstLoginInformationValue"===t.data?.userPreferencesForCategory.__typename?t.data?.userPreferencesForCategory.firstLoginInformation:null}catch(e){return t.errorToTelemetry?.("First Login CDL Query failed",m),null}},v=async(e,t,n,i,r)=>{const s={...i,[t]:n.toISOString()};if(delete s.__typename,s){let e;for(e in s)null===s[e]&&delete s[e]}await e.mutate({mutation:o,variables:{category:"firstLoginInformation",value:JSON.stringify(s)},update:(e,t)=>{if("UserPreferences"===t.data?.updateUserPreferences?.__typename)try{e.writeQuery({query:a,variables:{category:"firstLoginInformation"},data:{userPreferencesForCategory:{firstLoginInformation:t.data?.updateUserPreferences?.firstLoginInformation,__typename:"FirstLoginInformationValue"}}})}catch(e){r.errorToTelemetry?.("Error while updating cache after updating firstLoginInformation.",m)}}})},f=async(e,t,n="shell",i,a)=>{const{data:o}=await e.mutate({mutation:r,variables:{surfaceId:t,targetId:n,selector:i,windowId:a},fetchPolicy:"no-cache"});if(!o?.activateEspTarget)throw new Error("Failed to activate ESP target component.")},S=(e,t)=>({surfaceId:e,title:w(t.title??t.titleNotification),description:w(t.description??t.descriptionNotification),visibility:t.visibility,deeplinkUrl:t.deeplinkUrl??t.deeplinkUrlNotification}),k=e=>({teamsAppId:e.teamsAppId,previewText:w(e.previewText),description:w(e.description),source:e.source,deeplinkUrl:e.deeplinkUrl,templateParameters:b(e.title??e.titleTfwNotification),activityType:C(e.activityType,e.title??e.titleTfwNotification)}),C=(e,t)=>t?p:e??p,b=e=>{if(e)return[{name:"SyntheticNotification",value:w(e)}]},w=e=>{if(e){if(function(e){return void 0!==e.localizedContent}(e))return{localizedText:e.localizedContent};return{notLocalizedText:e.key}}},T=(e,t)=>{const n=[t];if(I(e)){const t=(0,l.E6)(e),i=(0,c.O$)(t,"innerError",void 0);i?.code===d.jK.NotPresent&&n.push((0,c.B9)(i))}return n},I=e=>!!e&&!!(0,u.get)(e,"graphQLErrors")},613853:(e,t,n)=>{"use strict";n.d(t,{$:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"espState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"espState"}}]}}]}},...n(114422).J.definitions]}},970076:(e,t,n)=>{"use strict";n.d(t,{N:()=>r});var i=n(838119);let a;class o{constructor(e){this.serializeCacheKey=e=>{const{typeName:t,user:n,key:i}=e;return`tmp.auth.v1.${n?.id??"GLOBAL"}.${t}.${i?i.toUpperCase():t}`},this._indexedDbProvider=e}async getValue(e){try{const t=this.serializeCacheKey(e);return await this._indexedDbProvider.getValue(t)}catch(e){return void i.q.log(`getValue:${e}`)}}async put(e,t){try{const n=this.serializeCacheKey(e);return await this._indexedDbProvider.put(n,t),!0}catch(e){return i.q.log(`put:${e}`),!1}}async del(e){try{const t=this.serializeCacheKey(e);return await this._indexedDbProvider.del(t),!0}catch(e){return i.q.log(`delete:${e}`),!1}}}const r=e=>a||(a=new o(e),a)},506688:(e,t,n)=>{"use strict";n.d(t,{zF:()=>g,db:()=>h,l_:()=>y,o8:()=>v,mM:()=>f,kh:()=>S,lj:()=>k,BZ:()=>C,VT:()=>b});var i=n(907203),a=n(945361),o=n(774735),r=n(823774),s=n(516341),l=n(799571),c=n(838119),d=n(7487),u=n(501607),m=n(828139),p=n(354608);const g=(e,t,n)=>{let a;if(t&&!n){const n=r.Jt.getAllOfType("User").filter((e=>e.profile.tid===t&&e.type!==i.Ch.Anonymous));if(n.length>1){const t=r.Jt.getValue(s.Jl.globalUser);if(a=!!e&&n.find((t=>t.id===e))||n.find((e=>e.id===t.id)),a)return a;throw{message:"Multiple users found in cache with same tenantId",errorCode:l.SM.MultipleUsersPresentWithSpecifiedIdentifier}}return n[0]}if(e){const t=r.Jt.getAllOfType("User");a=t?.filter((t=>t.id===e))[0]}else a=r.Jt.getValue(s.Jl.globalUser);return a},h=e=>{if(!e)return[];return r.Jt.getAllOfType("User").filter((t=>t.id!==e&&t.homeAccountId===e))||[]},y=(e,t)=>{if(!e||!t)return;return h(e).find((e=>e.profile.tid===t))},v=(e,t)=>{if(!e||!t)return!1;return e.some((e=>e.cloud!==t&&!e.id.startsWith("dummy-user")))},f=async(e,t,n,i)=>{n?.addScenarioMark("auth_get_encryption_key_start");const o=r.Jt.getValue(s.Jl.encryptionKey);if("object"==typeof o)return n?.addScenarioMark("auth_get_encryption_key_stop"),o;let l,c;n?.addScenarioMark("auth_get_exported_key_start");try{if(i&&(0,m.n)(e)){const e=await t.loadModule(a.nM.Auth);l=(await e.acquireEncryptionKey({correlationId:n?.correlation.id||(0,d.pW)()})).result}else{const e=r.Jt.getValue(s.Jl.exportedEncryptionKey);l=e?.exportedKey}}catch(e){return n?.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Acquiring the exported key failed."},"failure"),n?.addScenarioMark("auth_get_encryption_key_stop"),null}if(!l)return n?.addScenarioMark("auth_get_exported_key_stop",{reason:"No exported encryption key."}),void n?.addScenarioMark("auth_get_encryption_key_stop");try{c=await e.crypto.subtle.importKey("raw",(0,u.k)(l),{name:"AES-CBC"},!0,["encrypt","decrypt"]),r.Jt.put(s.Jl.encryptionKey,c),n?.addScenarioMark("auth_get_exported_key_stop")}catch(e){n?.addScenarioMark("auth_get_exported_key_stop",{error:e,reason:"Importing the key failed"},"failure"),c=null}return n?.addScenarioMark("auth_get_encryption_key_stop"),c},S=(e,t,n)=>{const a=i.JE[o.j[e]],l=g(t,void 0);if(!l)return void c.q.warn(`[AuthState] Account ${t} not found when attempting to write userAuthState`);const u=(0,p.Xx)(l),m=(0,d.u4)(n?.reason)||a;r.Jt.put((0,s.VF)(u).userAuthState,{state:a,reason:m,customError:n?{errorCode:n.errorCode||n.code,message:n.message,isExpected:n.isExpected,context:n.context,subContext:n.subContext,correlationId:n.correlationId}:null}),n?c.q.warn(`[AuthState] UserAuthState updated - ${t} : ${a} errorCode: ${n.errorCode} isExpected: ${n.isExpected} correlationId: ${n.correlationId}`):c.q.log(`[AuthState] UserAuthState updated - ${t} : ${a}`)},k=()=>r.Jt.getValue(s.Jl.logoutState),C=()=>r.Jt.getValue(s.Jl.previousSignInProgressState),b=()=>r.Jt.del(s.Jl.previousSignInProgressState)},823774:(e,t,n)=>{"use strict";n.d(t,{Jt:()=>d,ky:()=>v});var i=n(799571),a=n(838119),o=n(7487),r=n(354608),s=n(516341);const l=[i.aw,i.ZU,i.Fz],c={KeyVersion:"v1",UseAccountIdKey:!0};let d;const u=e=>c.UseAccountIdKey?e?.id||"":e?JSON.stringify({tenantId:e.tenantId,oid:e.oid,accountType:e.accountType,userName:e.userName}):JSON.stringify(void 0),m=(e,t,n)=>`tmp.auth.${c.KeyVersion}.${e}.${t}.${n}`,p=e=>{const{typeName:t,user:n}=e;return{user:e.user?u(n):"GLOBAL",typeName:t,key:e.key?e.key.toUpperCase():t}},g=(e,t)=>({storageKey:c.UseAccountIdKey?m(t.user,t.typeName,t.key):`$[${t.user}][${t.typeName}][${t.key}]`,loggingKey:m(e.user?`${e.user.id}`:t.user,t.typeName,t.key)});class h{constructor(e,t){this._coreSettings=t,this._expireOffsetSeconds=i.rF.SECONDS_FIVE_MINUTES,this._expireOffsetSecondsMin=i.rF.SECONDS_PER_MINUTE,this.internalCache={GLOBAL:{User:{},Token:{},MsalAccount:{}}},this._initializeCacheForCacheItem=(e,t)=>{void 0===this.internalCache[t]?(this.internalCache[t]={},this.internalCache[t][e]={}):void 0===this.internalCache[t][e]&&(this.internalCache[t][e]={})},this._addToExternalCache=async(e,t)=>{let n=t;t.item.encryptedToken&&(n=this._deepCopyEncryptedToken(t));const i=p(e),{storageKey:r,loggingKey:s}=g(e,i);try{this._storage.setItem(r,(0,o.u4)(n))}catch(e){a.q.error(`error in putting key [${s}] in storage, error - [${(0,o.VK)(e)}]`)}},this._deepCopyEncryptedToken=e=>{const t={...e.item};return t.skypeToken?t.skypeToken="":t.token="",{item:t,hitCount:e.hitCount,shouldRefresh:e.shouldRefresh,refreshAfter:e.refreshAfter}},this._deleteFromExternalCache=async e=>{const t=p(e),{storageKey:n,loggingKey:i}=g(e,t);try{this._storage.removeItem(n)}catch(e){a.q.error(`error in deleting key [${i}] in storage, error - [${(0,o.VK)(e)}]`)}},this._flushExternalCache=async e=>{try{const t={};Object.keys(this._storage).forEach((n=>{l.forEach((e=>{if(-1!==n.indexOf(e)){const e=this._storage.getItem(n);e&&(t[n]=e)}})),(!e&&0===n.indexOf("$[")||!e&&0===n.indexOf("tmp.auth")||e&&-1!==n.indexOf("tmp.auth")&&(-1!==n.indexOf(e.oid)||e.id&&-1!==n.indexOf(e.id)))&&this._storage.removeItem(n)})),Object.keys(t).forEach((e=>{this._storage.setItem(e,t[e])}))}catch(e){a.q.error(`error in clearing storage, error - [${(0,o.VK)(e)}]`)}},this._isGlobalUser=e=>{let t=this.internalCache.GLOBAL?.User?.User;return t||(t=this.get(s.Jl.globalUser)),t&&(0,r.FG)((0,r.Xx)(t.item),e)},this._putGlobalUserInCache=(e,t)=>{const n=this.internalCache.GLOBAL?.User?.User;if(n&&e.user&&!this._isGlobalUser(e.user))return;const i=e.user?"GLOBAL":u((0,r.Xx)(t.item));this._initializeCacheForCacheItem("User",i),this.internalCache[i].User.User=t;const a=c.UseAccountIdKey?m(i,"User","User"):`$[${i}][User][User]`;this._storage.setItem(a,JSON.stringify(t))},this._validateValue=(e,t)=>{if(!("Token"!==e.typeName||"object"==typeof t&&t.token&&t.expires))throw new Error("Invalid value for Token.");if(!("Discover"!==e.typeName||e.key!==i.rz||"object"==typeof t&&t.skypeToken&&t.expiration))throw new Error("Invalid value for Skype token.");if("User"!==e.typeName)return;const n=t;if(!(n.userName&&n.type&&n.role&&n.profile&&void 0!==n.isAuthenticated))throw new Error(`Invalid value for user. userName exists: [${!!n.userName}], type: [${n.type}], role: [${n.role}], profile exists: [${!!n.profile}],isAuthenticated: [${n.isAuthenticated}]`);const a=this.internalCache.GLOBAL?.User?.User,o=(0,r.Xx)(n);if(a&&!e.user&&!this._isGlobalUser(o))throw new Error("there is already global user in auth cache")},this._storage=e.localStorage,a.q.info("auth_cache initialized")}updateSetting(e,t){a.q.log(`Updating authCache setting ${e} from ${c[e]} to ${t}.`),"KeyVersion"===e&&(t!==c.KeyVersion&&(this.internalCache={}),c.KeyVersion=t),"UseAccountIdKey"===e&&(t!==c.UseAccountIdKey&&(this.internalCache={}),c.UseAccountIdKey=t)}setExpiryOffset(e,t){e&&(this._expireOffsetSeconds=e),t&&(this._expireOffsetSecondsMin=t)}put(e,t){y(e),this._validateValue(e,t);const{typeName:n,key:i,user:a}=p(e),o="Token"===n||"Discover"===n&&"SKYPE-TOKEN"===i;o&&(t.fromCache=!0);let r=this.internalCache[a]?.[n]?.[i];return r?(r.hitCount=0,r.item=t):r={item:t,shouldRefresh:!1,hitCount:0},o&&(r.refreshAfter=function(e,t,n){const i=S(e,t);if(i&&n)return C(f(),i,n);return}(n,t,this.refreshPercents)),"User"===n&&this._putGlobalUserInCache(e,r),this._initializeCacheForCacheItem(n,a),this.internalCache[a][n][i]=r,this._addToExternalCache(e,r),!0}updateGlobalUser(e){const t="GLOBAL",n={item:e,shouldRefresh:!1,hitCount:0};return this._initializeCacheForCacheItem("User",t),this.internalCache[t].User.User=n,this._addToExternalCache(s.Jl.globalUser,n),!0}get(e){y(e);const t=p(e),{storageKey:n,loggingKey:i}=g(e,t),{typeName:r,key:s,user:l}=t;let c=this.internalCache[l]?.[r]?.[s];const d=!!c;if(!c)try{const e=this._storage?.getItem(n);e&&(c=JSON.parse(e))}catch(e){a.q.error(`value for key [${i}] throw error. ${(0,o.VK)(e)}`)}if(c)return this._initializeCacheForCacheItem(r,l),this.internalCache[l][r][s]=c,("Token"===r||"Discover"===r&&"SKYPE-TOKEN"===s)&&(c.shouldRefresh=this._shouldRefresh(c,r),c.hitCount++,this.internalCache[l][r][s]=c,this._addToExternalCache(e,c)),void 0===c.shouldRefresh?(a.q.info(`cacheItem '[${n}]' need to refresh`),void this.del(e)):(a.q.info(`returning cacheItem '[${n}]' from cache${c.shouldRefresh?", will be refreshed in background":""}. In memory:${+d} found: [${+!!c}]`),c);a.q.info(`value for key [${i}] not found in memory or storage`)}getValue(e){const t=this.get(e);return t?this._value(t):void 0}getAllOfType(e){const t=[],n=[];return Object.keys(this.internalCache).forEach((i=>{"GLOBAL"!==i&&Object.keys(this.internalCache[i][e]||{}).forEach((a=>{const{storageKey:o}=g({},{user:i,typeName:e,key:a});n.push(o),t.push(this.internalCache[i][e][a].item)}))})),Object.keys(this._storage).forEach((i=>{if(-1===n.indexOf(i)&&-1===i.indexOf(".GLOBAL.")&&-1!==i.indexOf(`.${e}.`))try{const e=this._storage.getItem(i);e&&t.push(JSON.parse(e)?.item)}catch(e){a.q.error(`value for key [${i}] throw error. ${(0,o.VK)(e)}`)}})),t}del(e){if(!e)return a.q.error(`Invalid cacheKey: ${e}`),!1;if(!e.typeName)return a.q.error(`Invalid cacheKey type: ${e.typeName}`),!1;if("User"===e.typeName)return this.flush(e.user),!0;const t=p(e),{loggingKey:n}=g(e,t),{typeName:i,key:o,user:r}=t;this.internalCache[r]?.[i]?.[o]&&a.q.info(`Value of key: [${n}] exists before deletion]`);const s=this.internalCache[r]?.[i]?.[o]&&delete this.internalCache[r][i][o],l=this._deleteFromExternalCache(e);return a.q.info(`deleted from local auth-cache. key: [${n}], done - local: [${s}], storage: [${l}]`),s}delTokensWithError(e,t){const{user:n,typeName:i}=p({user:e,typeName:"Token"});if(this.internalCache[n]?.[i]){const a=this.internalCache[n][i];for(const n in a)a[n]?.item?.error?.errorCode===t&&this.del({user:e,typeName:i,key:n})}}deleteType(e,t){const{user:n,typeName:i}=p({user:e,typeName:t});if(this.internalCache[n]?.[i]){let t;if("Token"===i)t=this.internalCache[n][i];else{if("Discover"!==i)return;t=this.internalCache[n][i]}for(const n in t)n&&this.del({user:e,typeName:i,key:n})}}flush(e){if(!e){a.q.info("no user provided, flushing global user from cache");const t=this.internalCache.GLOBAL?.User?.User;if(!t)return;e=(0,r.Xx)(t.item)}a.q.info(`flushing user ${e.id} data from cache`);const t=u(e);this.internalCache[t]={},this._flushExternalCache(e),this._isGlobalUser(e)&&(this.internalCache.GLOBAL={},this._storage.removeItem("$[GLOBAL][User][User]"),this._storage.removeItem("tmp.auth.v1.GLOBAL.User.User")),a.q.info("flushing completed")}_value(e){return e.item}_shouldRefresh(e,t){if(!["Discover","Token"].includes(t)||!e.item)return;const n=e.item,i=S(t,n);if(e.refreshAfter&&this.refreshPercents)return this._proactiveShouldRefresh(f(),e.refreshAfter,i);if(n&&i){const e=i-this._expireOffsetSeconds,t=i-this._expireOffsetSecondsMin,n=f();if(n<=t)return n>=e}}_proactiveShouldRefresh(e,t,n){return!n||n<e-this._expireOffsetSecondsMin?void 0:t<e}get refreshPercents(){const e=this._coreSettings?.("proactiveTokenRefreshPercents");return Number(e??0)}}const y=e=>{if(!(-1===["Token","Discover"].indexOf(e.typeName)||e.key&&e.user))throw new Error(`key/user cannot be empty for type [${e.typeName}]: key: ${e.key}, user: ${+!!e.user}`)},v=(e,t)=>d||(d=new h(e,t),e.localStorage?.getItem("localDebug")&&e.loader&&(e.loader.authCache=d),d);function f(){return Math.round(Date.now()/i.rF.MILLI_PER_SECOND)}function S(e,t){return"Discover"===e?Math.round(t?.expiration/i.rF.MILLI_PER_SECOND):"Token"===e?t?.expires:void 0}const k=i.rF.SECONDS_PER_MINUTE*i.uI.TEN;function C(e,t,n=.67){const i=t-e,a=e+Math.round(i*n),o=t-k;return Math.min(a,o)}},516341:(e,t,n)=>{"use strict";n.d(t,{VF:()=>a,px:()=>o,Jl:()=>r});var i=n(799571);const a=e=>({userDetail:{user:e,typeName:"Discover",key:"discover-user-details"},regionGtm:{user:e,typeName:"Discover",key:"discover-region-gtm"},skypeToken:{user:e,typeName:"Discover",key:"skype-token"},user:{user:e,typeName:"User"},tenants:{user:e,typeName:"Tenants"},loginValidation:{user:e,typeName:"LoginValidation"},userAuthState:{user:e,typeName:"UserAuthState"},meetingDetails:{user:e,typeName:"MeetingDetails"},telemetryInfo:{user:e,typeName:"TelemetryInfo"}}),o=(e,t,n)=>({user:e,typeName:"Token",key:`${t}${n?`-external-${n}`:""}`}),r={addAccountsSuggestionCoachMarkTimeStamp:{typeName:"addAccountsSuggestionCoachMarkTimeStamp"},logoutState:{typeName:i.ZU},authSessionId:{typeName:i.Fz},globalUser:{typeName:"User"},primaryUserId:{typeName:"PrimaryUserId"},encryptionKey:{typeName:"EncryptionKey"},exportedEncryptionKey:{typeName:"ExportedEncryptionKey"},initializationVector:{typeName:"InitializationVector"},previousSignInProgressState:{typeName:"PreviousSignInProgressState"}}},224557:(e,t,n)=>{"use strict";n.d(t,{gA:()=>h,Zl:()=>y,fG:()=>v,MD:()=>f,SH:()=>S,Ri:()=>k,$R:()=>C,et:()=>b,Wh:()=>T,bO:()=>I});var i=n(907203),a=n(945361),o=n(543491),r=n(69588),s=n(894638),l=n(799571),c=n(838119),d=n(354608),u=n(7487),m=n(823774),p=n(516341),g=n(506688);const h=(e,t,n)=>{const i=f(e,t,n);return{...i,message:i.message,stack:i.stack,errorMetaData:{accountId:t?.result?.profile?.id,name:t?.result?.profile?.displayName,email:t?.result?.profile?.email}}},y=(e,t)=>{const n=t?.("buildCloud")||"",a=e.extraQueryParameters?.tenantId,o=E(a,e.domainHint||n,t),r=e.extraQueryParameters?.accountType||i.Ch.Aad;return{correlation:e.correlation,silent:e.silent,extraQueryParameters:{...e.extraQueryParameters,authority:o},userIdentifier:{accountType:r,tenantId:a,id:e.accountId||"",userName:"",oid:""}}},v=e=>e.accountId&&e.extraQueryParameters?.tenantId,f=(e,t,n)=>{const i=t.isExpected||t.message?.includes("657rv")||t.errorMessage?.includes("657rv")||!1;return(0,r.Tr)({context:"authentication",subContext:e,errorCode:t.errorCode||"ErrorCodeMissing",message:t?.errorMessage||t.message||"ErrorMessageMissing",isExpected:i,correlationId:n.id})},S=(e,t,n)=>{const{accountId:i,correlation:o,prompt:r,loginHint:s,extraQueryParameters:l,windowId:c}=e,u=!!n?.("enableRopcFlow"),m={accountId:i,correlationId:o.id,domainHint:n?.("enableAad")?n?.("enableMultiCloud")?void 0:a.nU.prod:a.nU.life,extraQueryParameters:(0,d.nW)(l),loginHint:s,silent:"none"===r,windowId:c,useRopcFlow:u};return t.addEventData([`nativeArgs:{domainPresent:${m.domainHint}`,`extraParams:${m.extraQueryParameters?.length}`,"idPresent:"+ +!!m.accountId,"loginHintPresent:"+ +!!m.loginHint,`silent:${m.silent}`,`useRopcFlow:${m.useRopcFlow}}`]),m},k=(e,t,n,i)=>{const a=C(t.userIdentifier);if(!t.extraQueryParameters?.authority&&i?.("enableSetAuthorityAlways")){const e=t.tenantId||a.tenantId,n=i?.("buildCloud")||"",o=E(e,n,i);t.extraQueryParameters=t.extraQueryParameters||{},t.extraQueryParameters.authority=o}const o={resource:e,correlationId:t.correlation.id,accessTokenToRenew:t.accessTokenToRenew,claim:t.claim,silent:t.silent??"login"!==t.prompt,userIdentifier:a,tenantId:t.tenantId,extraQueryParameters:(0,d.nW)(t.extraQueryParameters),windowId:t.windowId};return n.addEventData(["nativeArgs:{","accessTokenPresent:"+ +!!o.accessTokenToRenew,"claimPresent:"+ +(0,d.WD)(t.claim),"idPresent:"+ +!!a?.id,`silent:${o.silent}`,"userToUse:"+ +!!a,"externalTenant:"+ +!!o.tenantId,"}"]),o},C=e=>({id:e.id,tenantId:e.tenantId,oid:e.oid,upn:e.userName}),b=(e,t,n)=>{let a;c.q.info("Getting user profile");const o=e.extendedProperties?.find((e=>"acct"===e.name));let r;o&&(a=+o.value);try{r=e.profile.id||(e.profile.oid.startsWith("000")?e.profile.oid.replace(/[0-]/g,""):e.profile.oid)}catch{r=e.profile.oid}const s=e.extendedProperties?.find((e=>"isCrossCloudUser"===e.name)),l=N(e,s?.value),u={tenantId:e.profile.tenantId,oid:e.profile.oid,accountType:(0,d.QG)(e.profile.tenantId),userName:e.userName,id:r};m.Jt.put((0,p.VF)(u).telemetryInfo,{isCrossCloudUser:l});const g=w(e,!!t?.("enableMTO"),!!t?.("enableCCM"));let h=1===a?i.w4.Guest:i.w4.Member;g===i.Yf.Ccm&&(h=i.w4.Anonymous);const y=e.profile.isHomeAccount?r:(0,d.vt)(e);return{id:r,userName:e.userName||e.profile.email,profile:{acct:a,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile.email,family_name:"",given_name:e.profile.displayName,iat:1,iss:"",name:e.profile.displayName,preferred_username:e.userName||e.profile.email,nbf:-1,nonce:"",oid:e.profile.oid,onprem_sid:"",sub:"",tid:e.profile.tenantId,unique_name:e.profile.displayName,upn:e.profile.email,ver:"1.0",isHomeAccount:e.profile.isHomeAccount},isAuthenticated:!1,type:(0,d.QG)(e.profile.tenantId),cloud:(0,d.nL)(e,t,n,r,y),homeAccountId:y,role:h,subType:g}},w=(e,t,n)=>{let a=i.Yf.Default;if(t||n){const r={id:(0,u.pW)(),scenarioName:o.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"},[c,d]=(0,s.OU)({options:{correlation:r},subContext:"auth-helper::getUserSubType",scenarioName:o.RG.AuthGetUserSubType,source:"core-auth::getUserSubType"}),m=e.extendedProperties?.find((e=>e.name===l.GA));if(m){const e=t&&m.value.indexOf(l.f)>-1,o=n&&m.value.indexOf(l.u1)>-1;e?a=i.Yf.Mto:o&&(a=i.Yf.Ccm)}d({reason:"Extended properties wids claim check done.",userSubType:a},"success")}return c.q.log(`User subType set to ${a}, enableMTO: ${t}`),a},T=e=>({token:e.result.token,idToken:e.result.idToken,expires:e.result.expires,fromCache:!1,account:e.result.account}),I=e=>e.errorCode===l.wK.ApiContractViolation&&e.message.includes(l.wK.UiAlreadyShowing),N=(e,t)=>{if(!e.homeAccountId)return!1;if(e.profile.id===e.homeAccountId)return!1;const n=(0,g.zF)(e.homeAccountId,void 0);return(!n||e.profile.sovereignty!==i.ym.gcc||n.cloud!==i.G7.prod)&&"1"===t},E=(e,t,n)=>`${(0,d.M_)(t,n)}${e}`},828139:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});const i=e=>!!e?.chrome?.webview},354608:(e,t,n)=>{"use strict";n.d(t,{tN:()=>y,w2:()=>v,b9:()=>f,b6:()=>S,yI:()=>k,B$:()=>C,vt:()=>b,LP:()=>w,QG:()=>T,M_:()=>I,nL:()=>N,$8:()=>E,TP:()=>_,Ig:()=>F,Xx:()=>x,qv:()=>R,nW:()=>j,aS:()=>L,Kv:()=>O,FG:()=>$,fM:()=>U,jV:()=>B,PU:()=>W,dW:()=>H,au:()=>V,S1:()=>G,NL:()=>z,WD:()=>q,_Z:()=>J,ps:()=>Q,Ug:()=>K,Fr:()=>ne,N3:()=>re,qL:()=>le,x7:()=>ce,z7:()=>de,MM:()=>ue});var i=n(803238),a=n(907203),o=n(965517),r=n(945361),s=n(838119),l=n(799571),c=n(823774),d=n(69588),u=n(7487),m=n(516341),p=n(506688),g=n(224557);var h;!function(e){e.Otp="mail",e.GFed="google.com"}(h||(h={}));const y=({type:e,profile:t})=>(e===a.Ch.Otp||e===a.Ch.GFed||t.idp===h.Otp||t.idp===h.GFed)&&t.tid===l._6.services,v=({cloud:e,profile:t},n)=>e===a.G7.life&&t.tid===l.zP&&n===a.G7.prod;function f(e,t){return void 0!==t&&e!==t}const S=e=>(s.q.info(`[returnTokenForAnonUser][${e}] empty token return for anonymous user`),{token:"",expires:Math.floor((new Date).setMinutes(l.uI.FIFTEEN)/l.rF.MILLI_PER_SECOND),fromCache:!0}),k=(e,t)=>{if(!e)return"";const n=t?.("instanceUrl"),i=n?`${n}${e??"common"}`:"";return s.q.log(`[getAuthorityFromCloud] Get Authority from cloud type - ${i}`),i},C=(e,t,n,i)=>{const a=t?.profile.tid||n||e?.tenantId;if(a&&(t||i||e?.isAnonEligible&&e?.isAnonRestrictionSatisfied))return w(a,void 0,t)},b=e=>{const t=e.homeAccountId,n=t?.split(".")[0];return n?.startsWith("00000000-0000-0000")?n.replace("00000000-0000-0000-","").replace("-",""):n},w=(e,t,n,i)=>{s.q.info("Anon flow - anonymous user created");const o=`anon.${t=t||(e===l.zP?a.G7.life:a.G7.prod)}.${e}.${i}`;return{id:o,isAuthenticated:!0,userName:n?.userName||"anonymous",profile:{oid:R(o),tid:e,upn:n?.profile?.upn||"",puid:""},role:a.w4.Anonymous,type:a.Ch.Anonymous,homeAccountId:o,cloud:n?.cloud||t,subType:a.Yf.Default}},T=e=>e===o.e0?a.Ch.MsaLife:a.Ch.Aad,I=(e,t)=>{if(!e)return l._V;const n=t?.("cloudAuthorityMap")??l.fL,i=n.find((t=>t.cloud.toString()===e))?.authority;return i||l._V},N=(e,t,n,i,o)=>{if(T(e.profile.tenantId)===a.Ch.MsaLife)return a.G7.life;if(t?.("enableMTMAAuthDataInMaglevStorage")){const a=e.profile.sovereignty;if(o===i)return A(a);if(n)return n;const r=e.profile.environment;return E(r,e.profile.tenantId,t)}{const t=e.profile.sovereignty;return A(t)}},E=(e,t,n)=>{if("9188040d-6c67-4c5b-b112-36a304b66dad"===t)return a.G7.life;switch(e){case a.Ke.prod:return a.G7.prod;case a.Ke.gallatin:return a.G7.gallatin;case a.Ke.airgap08:return a.G7.airgap08;case a.Ke.airgap09:return a.G7.airgap09;case a.Ke.gov:const e=n?.("buildCloud");return e;default:return a.G7.prod}},A=e=>{switch(e){case a.ym.prod:case a.ym.gcc:return a.G7.prod;case a.ym.gcch:return a.G7.gcch;case a.ym.dod:return a.G7.dod;case a.ym.ag08:return a.G7.airgap08;case a.ym.ag09:return a.G7.airgap09;case a.ym.gallatin:return a.G7.gallatin;default:return a.G7.prod}},_=e=>{switch(e){case a.G7.prod:return r.nU.prod;case a.G7.life:return r.nU.life;case a.G7.gcch:return r.nU.gcch;case a.G7.dod:return r.nU.dod;case a.G7.airgap08:return r.nU.airgap08;case a.G7.airgap09:return r.nU.airgap09;case a.G7.gallatin:return r.nU.gallatin;default:return r.nU.prod}},F=(e,t,n,o)=>t?.subType===a.Yf.Ccm?t:!t||(0,i.isEmpty)(t.profile)||t.role===a.w4.Anonymous||t.userRole===l.uI.TWO||!t.isAuthenticated&&e.isAnonEligible||!t.isAuthenticated&&o?(s.q.info("checking anon flow"),C(e,t,n,o)):(t.role=t.role===a.w4.Guest||1===t.profile?.acct?a.w4.Guest:a.w4.Member,D(t),P(t),M(t)),D=e=>{if(e.profile?.tid===o.e0)return void(e.type=a.Ch.MsaLife);const t=[a.Ch.Msa,a.Ch.Otp,a.Ch.GFed];if(e.type&&-1!==t.indexOf(e.type))return;let n=0===e.profile?.altsecid?.indexOf("1:")?a.Ch.Msa:a.Ch.Aad;e.profile?.idp&&e.profile?.iss!==e.profile.idp&&(n=e.profile.idp===h.Otp?a.Ch.Otp:n,n=e.profile.idp===h.GFed?a.Ch.GFed:n),0===e.profile?.altsecid?.indexOf("1:")&&e.cloud===a.G7.prod&&e.profile?.tid&&e.profile.tid!==l._6.services&&(n=a.Ch.Aad),e.type=n},P=e=>{e.type!==a.Ch.MsaLife?e.cloud&&e.cloud!==a.G7.prod||(e.cloud=a.G7.prod):e.cloud=a.G7.life},M=e=>(e.profile.oid=e.profile.oid||R(e.profile.tid),!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.subType||(e.subType=a.Yf.Default),s.q.log(`User role = [${e.role}], type = [${e.type}], cloud = [${e.cloud}]`),e),x=e=>{if(!e)throw new Error("getUserIdentifier: User cannot be null");return{tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id}},R=e=>`8:defaultOid:${e}`,j=e=>{const t=[];for(const n in e)Object.hasOwnProperty.call(e,n)&&e[n]&&t.push({name:n,key:n,value:"string"==typeof e[n]?e[n]:(0,u.u4)(e[n])});return t},L=(e,t)=>{t.addEventData(["update-global-user:t"]),t.addScenarioMark("auth_update_global_user_start");const n=(0,p.zF)(e,void 0);if(n)return t.addScenarioMark("auth_update_global_user_foundUser"),c.Jt.updateGlobalUser(n);throw t.addScenarioMark("auth_update_global_user_noUserFound"),i=t.correlation?.id,(0,d.Tr)({context:"core-auth-base",subContext:"getUserFromAccountId",correlationId:i,errorCode:l.SM.UserNotFoundError,message:"Cannot update global user ude to missing user"});var i},O=e=>e?e?.id?e?.id:`${e?.oid}-${e?.tenantId}`:"unknown user",$=(e,t)=>!!e&&!!t&&((e.id||t.id)&&e.id===t.id||e.tenantId===t.tenantId&&e.oid===t.oid&&e.userName===t.userName),U=(e,t,n)=>{const i=new CustomEvent(t,{detail:n});e?.dispatchEvent?.(i)},B=(e,t,n,i,a)=>{const o=F(e,t,i,a);return o&&(s.q.info(`[auth-helper][getMappedUserAndSetItToCache][${n}] put user in cache.`),c.Jt.put((0,m.VF)(x(o)).user,o)),o},W=(e,t,n,i)=>{if(l.s9(e))throw i.addEventData(["scope_invalid:1"]),s.q.warn(`[core-auth-base][acquireToken][${n.source}][${n.id}] invalid scope. resource: [${e}]`),(0,d.Tr)({context:"core-auth-base",subContext:"acquireToken",message:`request with [${t?.id}-${t?.oid}-${t?.tenantId}] sent from invalid resource: ${e}`,errorCode:l.SM.InvalidScopeResource,isExpected:!0,correlationId:n.id})},H=(e,t,n,i,a)=>(i.push("user_missing"),(0,d.Tr)({context:"core-auth-base",subContext:e,errorCode:l.SM.UserNotFoundError,isExpected:n,message:`request sent with [${t}] failed as user not found`,innerError:new Error("User Null or empty"),correlationId:a})),V=(e,t,n,i)=>(0,d.Tr)({context:"core-auth-base",subContext:e,errorCode:l.SM.UnsupportedParameter,isExpected:n,message:`${t} parameter is not currently supported`,innerError:new Error(`${t} parameter is not currently supported`),correlationId:i});const G=(e,t,n,i,a,o)=>{i?.push(`errorCode:${t?.errorCode||"undefined"},errorMessage:${t?.message||"undefined"}`),i&&i.length>0&&i.push("$");const r=function(e,t,n="",i,a){return{contentType:n,context:"core-auth-base",correlationId:t?.correlationId,endpointUrl:a||"unset",errorCode:t?.errorCode||"AcquireToken Error",innerError:t,isExpected:t?.isExpected,message:(0,u.VK)(t),reason:i?.join(";")||"",subContext:e}}(e,t,a,i,o),c=r.errorCode.includes(l.SM.InvalidScopeResource)||r.message?.includes(l.SM.InvalidScopeResource)||r.isExpected||r.innerError?.isExpected;return c?s.q.warning(`Error found ${(0,u.VK)(t)}`):s.q.error(`Error found ${(0,u.VK)(t)}`),c?n?.incomplete(r):n?.fail(r),r},z=JSON.stringify({access_token:{xms_cc:{values:["CP1"]}}}),q=e=>!(!e||e===z),J=(e,t,n,i,a)=>(n.tflClaim&&(n.accessTokenToRenew=n.tflClaim),void 0===n.prompt&&void 0===n.silent&&(!n.accessTokenToRenew&&!q(n.claim)||i?.("disablePromptFor401")&&!((e,t)=>{const n=t?.("enablePromptResourcesFor401")||[];return!(!e||!n)&&Array.isArray(n)&&n.findIndex((t=>e.includes(t)))>-1})(e,i)?(n.prompt="none",n.silent=!0):(n.prompt="login",n.silent=!1)),a&&!n.accessTokenToRenew&&(n.forceRenew||!1===n.silent||"login"===n.prompt)&&(s.q.info("[core-auth-base][acquireToken] force renewing."),n.accessTokenToRenew=a.item.token),t.addEventData(["cacheToken:"+ +!!a,"tflClaim:"+ +!!n.tflClaim,"accessTokenToRenew:"+ +!!n.accessTokenToRenew,"forceRenew:"+ +!!n.forceRenew,`prompt: ${n.prompt}`,"silent:"+ +!!n.silent]),a?.item?.error?.errorCode&&t.addEventData([`errorInToken:[${a?.item?.error?.errorCode||""}]`]),n),Q=async(e,t,n,i,o,r)=>{const u=r?.("buildCloud"),m=r?.("enableMultiCloud"),p=r?.("enableCCM");if(s.q.log(`starting cloud misMatch check. Env: ${n}, buildCloud: ${u}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`),Y(e,r)){const t=await oe(e,o.correlation,i);return Promise.reject(t)}if(!e.cloud||!u||e.cloud===u&&e.subType!==a.Yf.Ccm)return s.q.log("No cloud mismatch detected."),t.addEventData(["cloudMismatch:0"]),e;const g=((e,t)=>{const n=t?.("enableMSAGuest"),i=t?.("enableTFLOnT21");return n&&!i&&e.cloud===a.G7.life})(e,r);if(t.addEventData(["cloudMismatch:1","isMsaGuest:"+ +!!g,"enableCCM:"+ +!!p,"meetingDetails:"+ +!!o.meetingDetails]),g){t.addScenarioMark("msa_flow_start");const n=await X(e,o,i,t,u,r);if(n)return n}if(p&&o.meetingDetails){t.addScenarioMark("ccm_flow_start");const n=await Z(e,o,i,t,u,o.meetingDetails,r);if(n)return n}if(m){t.closeScenario({reason:`_checkForCloudMismatchAndReboot. Env: ${n}, enableMultiCloud: ${m}, buildCloud: ${u}, user tid: ${e.profile.tid}, user cloud: ${e.cloud}`});const a=await ie(e,o.correlation,i);return Promise.reject(a)}c.Jt.del({user:x(e),typeName:"User"}),i.removeWebActiveUser?.();const h=await(0,d.MD)({name:l.SM.CloudMismatchNoMultiCloud,message:"cloud mismatch, reboot required",correlationId:o.correlation.id,context:"Login",subContext:"checkForCloudMismatch",errorCode:l.SM.CloudMismatchNoMultiCloud,isExpected:!0});return Promise.reject(h)},K=(e,t)=>{t?.("enableWebTflMsaGuestFlow")&&(e?.profile?.altsecid?.indexOf("1:live")<0||"prod"!==e.cloud||c.Jt.put((0,m.VF)(x(e)).userAuthState,{state:a.JE.Up,reason:"",visibilityState:a.Bl.Shown}))},Y=(e,t)=>{if(e.cloud!==a.G7.life||!t?.("enableMultiMsaRoadBlock")||!t?.("enableTFLOnT21"))return!1;return!!c.Jt.getAllOfType("User").find((t=>t.id!==e.id&&t.cloud===a.G7.life))},X=async(e,t,n,i,o,r)=>{try{const s=await ee(e,t,n,l._6.services,o,r),d=s.webAccount??te(s,r),u=!!r?.("enableWebTflMsaGuestFlow");if(i.addEventData(["msa-account:"+ +!!d]),i.addScenarioMark("msa_flow_end"),d){u&&(d.id=d.homeAccountId??d.id);const e=await le(d,i.correlation,n);return c.Jt.put((0,m.VF)(x(d)).userAuthState,{state:a.JE.Unknown,customError:{errorCode:e.errorCode,isExpected:e.isExpected,message:e.message,context:e.context,subContext:e.subContext,correlationId:e.correlationId,errorMetadata:e.errorMetaData},reason:"MsaUserNotAllowed"}),u||(d.homeAccountId=d.id),d.type=a.Ch.Msa,d}}catch(e){i.addScenarioMark("msa_flow_end",e)}},Z=async(e,t,n,i,o,r,s)=>{if(e.subType===a.Yf.Ccm)return se(e,i,r,e.profile.name);try{const l=await ee(e,t,n,r.tenantId,o,s),c=te(l,s);if(i.addEventData(["account:"+ +!!c,`sub:${c?.subType}`]),c)return c.subType===a.Yf.Ccm?se(c,i,r,e.profile.name):(i.addEventData(["ccgaUser:1"]),c);i.addScenarioMark("ccm_flow_end")}catch(e){i.addScenarioMark("ccm_flow_end",e)}},ee=async(e,t,n,i,a,r)=>{const s=`${I(a,r)}${i}`,l=r?.("mtResource")||o.O_.MT;return await n.acquireToken(l,{correlation:t.correlation,silent:t.silent,userIdentifier:x(e),extraQueryParameters:{authority:s}})},te=(e,t)=>e&&e.account?(0,g.et)(e.account,t):void 0,ne=async(e,t,n)=>new Promise((async i=>{if(e.length<=0)return i({count:0,failure:[]});let a=0;const o=[];for(const r of e){a++;try{const n=t(r);await n,a>=e.length&&i({count:a,failure:o})}catch(t){o.push(a),n?.(t,a,r),a>=e.length&&i({count:a,failure:o})}}})),ie=async(e,t,n)=>(0,d.MD)({errorMetaData:await ae(e,t,n),authSubErrorCode:"MultiCloudMismatch",name:l.SM.CloudMismatch,message:"Cloud Mismatch Detected",context:"Login",correlationId:t.id,errorCode:l.SM.CloudMismatch,subContext:"checkForCloudMismatch",isExpected:!0}),ae=async(e,t,n)=>{const i=await(n.getUserImage?.({id:e.id,correlation:t}))||"";return{cloud:e.cloud,accountId:e.id,email:e.profile.email,name:e.profile.name,pictureBlob:i}},oe=async(e,t,n)=>(0,d.MD)({errorMetaData:await ae(e,t,n),authSubErrorCode:"MultiCloudMismatch",name:l.SM.MultiMSARoadBlock,message:"MultiMSARoadBlock Detected",context:"Login",correlationId:t.id,errorCode:l.SM.MultiMSARoadBlock,subContext:"MultiMSARoadBlock",isExpected:!0}),re=(e,t,n,i)=>{q(n)&&e.addEventData([`isSameToken: ${i===t.token}`]);const a=(e=>{const t=(e-Math.floor((new Date).getTime()/l.rF.MILLI_PER_SECOND))*l.rF.MILLI_PER_SECOND/l.rF.ONE_MINUTE;return Math.floor(t)})(t.expires);e.addEventData([`tokenLifeTime: ${a}`,`fromCache: ${t.fromCache}`])},se=(e,t,n,i)=>(t.addEventData(["ccmUser:1"]),e.id=`${e.id}_${n.conversationId}`,e.type=a.Ch.Anonymous,e.profile.name=i,c.Jt.put((0,m.VF)(x(e)).meetingDetails,n),t.addScenarioMark("ccm_flow_end"),e),le=async(e,t,n)=>{const i=await(n.getUserImage?.({id:e.id,correlation:t}))||"",a={cloud:e.cloud,accountId:e.id,email:e.profile.email||e.userName,name:e.profile.name,pictureBlob:i};return(0,d.MD)({errorMetaData:a,authSubErrorCode:"MsaUserNotAllowed",name:l.SM.CloudMismatch,message:"msa user Detected",context:"Login",correlationId:t.id,errorCode:l.SM.MsaUserNotAllowed,subContext:"msaUserNotAllowedError",isExpected:!0})},ce=e=>({id:`dummy-user-${e.profile?.tid}-${e.homeAccountId}`,userName:e.userName,profile:{acct:1,altsecid:"",amr:[],aud:"",exp:-1,email:e.profile?.email,family_name:"",given_name:e.profile?.given_name,iat:1,iss:"",name:e.profile?.name,preferred_username:e.userName||e.profile?.email,nbf:-1,nonce:"",oid:`dummy-user-${e.profile?.tid}`,onprem_sid:"",sub:"",tid:e.profile?.tid,unique_name:e.profile?.unique_name,upn:e.profile?.email,ver:"1.0",isHomeAccount:!1},homeAccountId:e.homeAccountId||e.id,isAuthenticated:!1,type:a.Ch.Aad,cloud:e.cloud,role:e.role}),de=(e,t)=>!t.some((t=>t.cloud===e)),ue=(e,t)=>{const n=t?.("cloudAuthorityMap");if(!n||!e)return;const i=e.split("/");if(i.length<4)return;const r=i?.[2],s=i?.[3];if(s&&s===o.e0)return a.G7.life;const l=n.find((e=>e.authority===`https://${r}/`))?.cloud,c=t?.("buildCloud");return c!==a.G7.dod&&c!==a.G7.gcch||"dod"!==l&&"gcch"!==l?l?a.G7[l]:void 0:c}},501607:(e,t,n)=>{"use strict";n.d(t,{z:()=>a,k:()=>o});var i=n(34401);const a=e=>i.Buffer.from(e).toString("base64"),o=e=>i.Buffer.from(e,"base64")},327372:(e,t,n)=>{"use strict";function i(e){const t={};return(n,...i)=>{try{let a=t[n];return a||(a=t[n]=e(...i).then((e=>(delete t[n],e))).catch((e=>{throw delete t[n],e}))),a}catch(e){throw e}}}n.d(t,{k:()=>i})},602870:(e,t,n)=>{"use strict";n.d(t,{K_:()=>l,dt:()=>c,P0:()=>d,t8:()=>u,MH:()=>m,oO:()=>p,Kf:()=>g,TT:()=>h,jP:()=>y});var i=n(907203),a=n(506688),o=n(823774),r=n(516341),s=n(354608);const l=e=>o.Jt.getValue((0,r.VF)((0,s.Xx)(e)).userAuthState),c=e=>{if(!e)return;const t=(0,a.zF)(e,void 0);if(!t||!t.homeAccountId||t.homeAccountId===t.id)return t;return(0,a.zF)(t.homeAccountId,void 0)},d=(e,t)=>{if(!e||!t)return;return o.Jt.getAllOfType("User").find((n=>n.homeAccountId===e&&n.profile.tid===t))},u=()=>o.Jt.getAllOfType("User")?.filter((e=>g(e)&&!p(e)))?.[0],m=e=>{let t=(0,a.zF)(e,void 0);if(e||!t)return t;if(t.homeAccountId!==t.id){t=(0,a.zF)(t.homeAccountId,void 0)||t}return t},p=e=>!(!e||!e.homeAccountId||e.homeAccountId===e.id),g=e=>e.type!==i.Ch.Anonymous&&!e.id.startsWith("dummy-user-"),h=e=>{const t=o.Jt.getAllOfType("User")?.filter(Boolean)?.filter((t=>g(t)&&t.cloud===e)),n=t?.filter((e=>!p(e)));return n?.[0]||t?.[0]},y=e=>({message:`user for id: '${e}' not found. if id is undefined, global user should return`,errorCode:"NoAccountFoundForLogout",isExpected:!0,context:"get-user-utilities",subContext:"getUserForLogout",correlationId:"",name:"NoAccountFoundForLogout"})},26073:(e,t,n)=>{"use strict";n.d(t,{g:()=>g});var i=n(907203),a=n(69588),o=n(7487),r=n(354608),s=n(799571),l=n(838119),c=n(630280),d=n(803238);let u,m,p;function g(e,t,n,i){if(Object.getOwnPropertyDescriptor(Window,"mockApi")||Object.defineProperty(Window,"mockApi",{value:{enable:()=>{p=!0},disable:()=>{p=!1},setConfig:h}}),function(e,t){u||(u={});u[t]=e}(e,t),p=i,p){try{m="string"==typeof n?{...m,...JSON.parse(decodeURIComponent(n))}:{...m,...n}}catch(e){l.q.warning(`[MOCK-API] cannot parse config: ${n}`)}y(e,t)}else m={}}function h(e,t={}){m||(m={}),m[e]=t;const n=e.split(".")[0];y(u?.[n],n)}function y(e,t){Object.getOwnPropertyNames(m).filter((e=>e.startsWith(`${t}.`))).map((e=>e.replace(`${t}.`,""))).forEach((n=>{const i=Object.getOwnPropertyDescriptor(e,n)?.value||Object.getOwnPropertyDescriptor(Object.getPrototypeOf(e),n)?.value,a=m?.[`${t}.${n}`];a&&a.delay&&a.delay>0?Object.defineProperty(e,n,{configurable:!0,value:async(...o)=>{if(p){if(l.q.warning(`[MOCK-API] returning delayed mocked response for ${t}.${n}`),a&&a.delay){const e=void 0!==a.delay?a.delay:0;await new Promise((t=>(0,d.delay)(t,e)))}return v(t,n)||i.apply(e,o)}return i.apply(e,o)}}):Object.defineProperty(e,n,{configurable:!0,value:(...a)=>p?(l.q.warning(`[MOCK-API] returning mocked response for ${t}.${n}`),v(t,n)||i.apply(e,a)):i.apply(e,a)})}))}function v(e,t){const n=m?.[`${e}.${t}`];if(n&&n.error)throw function(e,t,n){return(0,a.MD)({name:e?.name||"",context:e?.context||t,subContext:e?.subContext||n,reason:e?.reason,errorCode:e?.errorCode||"ErrorCodeNotFound",correlationId:e?.correlationId||(0,o.pW)(),isExpected:e?.isExpected||!1,message:e?.message||`[MockApi][${t}][${n}]`,authSubErrorCode:e?.authSubErrorCode,errorMetaData:e?.errorMetaData,serverResponse:e?.serverResponse})}(n.error,e,t);if(n&&n.success){const e=function(e){switch(e){case"aquireToken":return S;case"user":return f();case"hostMachineUsers":return[k];case"users":return[f()];case"emptyList":return[]}return{}}(n.success.defaultValue);return Array.isArray(e)?n.success.returnValue?Array.isArray(n.success.returnValue)?[...e,...n.success.returnValue]:[...e,n.success.returnValue]:e:{...e,...n.success?.returnValue}}}const f=()=>(0,r.Ig)(new c.N("https://test.msft.com"),{userName:"TestUserName@email.com",role:i.w4.Member,profile:{name:"Test",oid:(0,r.qv)("123456789"),tid:"123456789"}}),S={token:"TestToken",expires:Date.now()+s.rF.SECONDS_FIVE_MINUTES,fromCache:!1},k={accountType:"Aad",id:"TestHostMachineUserId",displayName:"Test User",emailPhone:"test@email.com",picture:""}},630280:(e,t,n)=>{"use strict";n.d(t,{N:()=>o,j:()=>c});var i=n(799571),a=n(838119);class o{constructor(e){this._hash="",this._search="",this._pathname="",this._isAnonEligible=!1,this._isAnonRestrictionSatisfied=!1,this._tid=void 0,this._queryStrings={},this._parse=e=>{let t=Object.create(null);return"string"!=typeof e?t:(e=e.trim().replace(/^[?#&]/,""))?(e.split("&").forEach((e=>{const n=e.replace(/\+/g," ").split("=");let i=n.shift();const o=n.length>0?decodeURIComponent(n.join("=")):null;if(i){if(i=decodeURIComponent(i),"context"===i&&0===o?.indexOf("{"))try{const e=JSON.parse(o);for(const t in e)!e.hasOwnProperty(t)||"tid"!==t.toLowerCase()&&"tenantid"!==t.toLowerCase()||(this._tid=e[t]);t={...t,...e}}catch(e){a.q.error(e)}if(Object.prototype.hasOwnProperty.call(t,i))Array.isArray(t[i])?t[i].push(o):t[i]=[t[i],o];else{t[i]=o;const e=i.toLowerCase();!o||"tid"!==e&&"tenantid"!==e||(this._tid=o)}}})),t):t};try{this._currenttUrl=Object.freeze(new URL(e))}catch(t){throw new Error(`[TeamsUrl::ctor] - error - ${t} url ${e}`)}if(this._currenttUrl.hash&&-1!==this._currenttUrl.hash.indexOf("#/")){const e=this._currenttUrl.href.substring(this._currenttUrl.origin.length),t=e.indexOf("#");t>=0&&(this._hash=e.substr(t),this._pathname=e.substr(0,t));const n=this._hash.indexOf("?");n>=0&&(this._search=this._hash.substr(n))}this._queryStrings=this._parse(this._search||this._currenttUrl.search);const t=r(this._currenttUrl);this._isAnonEligible=t[0],this._isAnonRestrictionSatisfied=t[1]}get href(){return this._currenttUrl.href}get isLocal(){return 0===this._currenttUrl.host.indexOf("local.teams.office.com")}get hash(){return this._hash||this._currenttUrl.hash}get pathname(){return this._pathname||this._currenttUrl.pathname}get search(){return this._search||this._currenttUrl.search}get origin(){return this._currenttUrl.origin}get searchParams(){return{get:e=>this._queryStrings[e]}}get queryStrings(){return this._queryStrings}get tenantId(){return 0===this._currenttUrl.host.indexOf("teams.live.")?i.zP:this._tid}get isAnonEligible(){return this._isAnonEligible}get isAnonRestrictionSatisfied(){return this._isAnonRestrictionSatisfied}get alternateUrl(){const e=new URL(this._currenttUrl.href);return this.isLocal?(e.port?e.port="":e.port="8080",e.href):(0===e.host.indexOf("teams.live.")?e.host="teams.microsoft.com":e.host="teams.live.com",e.href)}get hasPostMessageAgent(){return"postMessage"===this._queryStrings.agent}}const r=e=>{if(!l)return[!1,!1];for(const t of l)if(t.anonUrlMatch&&e.href.indexOf(t.anonUrlMatch)>-1)return[!0,s(t,e.href)];return[!1,!1]},s=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const n of e.restrictions)if(t.indexOf(n)>-1)return!0;return!1};let l=[];const c=e=>{e&&(l=e)}},774735:(e,t,n)=>{"use strict";var i,a;n.d(t,{j:()=>i,Q:()=>a}),function(e){e.Up="Up",e.InteractionRequired="InteractionRequired",e.AADReconnecting="AADReconnecting",e.SkypeReconnecting="SkypeReconnecting",e.LicenseError="LicenseError",e.SignInRestriction="SignInRestriction"}(i||(i={})),function(e){e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.Success="Success",e.LicenseError="LicenseError",e.SignInRestriction="SignInRestriction",e.Unknown="Unknown"}(a||(a={}))},945361:(e,t,n)=>{"use strict";var i,a,o,r,s;n.d(t,{oo:()=>i,nU:()=>a,R_:()=>o,O3:()=>r,nM:()=>s}),function(e){e.SUCCESS="SUCCESS",e.CANCELLED="CANCELLED",e.FAILED="FAILED",e.TIMEOUT="TIMEOUT"}(i||(i={})),function(e){e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap08="airgap08",e.airgap09="airgap09"}(a||(a={})),function(e){e.Aad="Aad",e.MsaLife="MsaLife"}(o||(o={})),function(e){e.AADReconnecting="AADReconnecting",e.Failure="Failure",e.InteractionRequired="InteractionRequired",e.SignInRestriction="SignInRestriction",e.SkypeReconnecting="SkypeReconnecting",e.Up="Up"}(r||(r={})),function(e){e.UserDataXCloud="userdataxcloud",e.Auth="auth",e.Core="core"}(s||(s={}))},697968:(e,t,n)=>{"use strict";var i;n.d(t,{dX:()=>i}),function(e){e.authWarmLaunch="authWarmLaunch",e.authWarmLaunchAfterLoginValidation="authWarmLaunchAfterLoginValidation",e.authAnonLaunch="authAnonLaunch",e.authLoginSsoComplete="authLoginSsoComplete",e.authDisableSsoLaunch="authDisableSsoLaunch",e.authAfterLogoutLaunch="authAfterLogoutLaunch",e.authLoginPage="authLoginPage",e.authMtoUser="authMtoUser",e.authHasMtoTenant="authHasMtoTenant"}(i||(i={}))},834651:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i,n:()=>a});const i=e=>{const t=e.requestWindowId?`:${e.requestWindowId}`:"";return`${e.requestRendererId}${t}:${e.requestId}`},a=e=>({correlationId:e.correlationId,contextId:e.requestRendererId,context:e.hostRendererId,operationName:e.operationName,operationType:e.operationType,windowId:e.requestWindowId,queryId:e.requestId,commandSource:e.callerInfo,origin:e.component})},919154:(e,t,n)=>{"use strict";n.d(t,{n:()=>i});const i={activity:"14d6962d-6eeb-4f48-8890-de55454bb136",chat:"86fcd49b-61a2-4701-b771-54728cd291fb",calendar:"ef56c0de-36fc-4ef8-b417-3d82ba9d073c",channel:"2a84919f-59d8-4441-a975-2a8c2643b741",calling:"20c3440d-c67e-4420-9f80-0e50c39693df",files:"5af6a76b-40fc-4ba1-af29-8f49b08e44fd",meet:"957ed0e3-e5ca-4c82-9676-fd037185c4d8",meetForWork:"a63f7012-8cc9-42d5-99c3-e35f526fab17",communities:"3b95919f-59d8-4441-a975-2a8c2643c852",virtualConsumerEvents:"40472f6e-248f-4599-842c-ff3ed8f0ae34",store:"ac40aa4a-fef1-4896-aea2-46d1c14dbfd5",simpleCollab:"3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40",homepage:"7133fca9-0853-4e7a-bb5d-32d4e5f6020a",saved:"34b01851-c13d-4604-bb3b-5de1ecbf0288",search:"a2da8768-95d5-419e-9441-3b539865b118",assignments:"66aeee93-507d-479a-a3ef-8f494af43945",queues:"a02e4d17-af86-4ceb-9c97-4c2626eb3587",peopleApp:"7831feaf-c4c4-4669-ba64-ce4ea0b56d31",calendarM365:"5966c135-e05f-4ce0-81e0-e138fe8e9583"};i.activity,i.chat,i.channel,i.simpleCollab,i.files},88462:(e,t,n)=>{"use strict";var i;n.d(t,{k:()=>i}),function(e){e.auth="auth",e.appService="appService",e.appState="appState",e.control="control",e.database="database",e.diagnostics="diagnostics",e.endpointHealth="endpointHealth",e.graphql="graphql",e.networkState="networkState",e.supportedResolvers="supportedResolvers",e.syncEngine="syncEngine",e.tenantSwitch="tenantSwitch",e.telemetry="telemetry"}(i||(i={}))},527098:(e,t,n)=>{"use strict";n.d(t,{AF:()=>T,B$:()=>I,_A:()=>N,V5:()=>E,eU:()=>A,Mh:()=>_,Ig:()=>F,k6:()=>x,aJ:()=>R,Eo:()=>j,U8:()=>L,sW:()=>$,mH:()=>B,Wn:()=>W,ok:()=>H,z5:()=>V,cC:()=>G,vL:()=>z,TA:()=>q,yJ:()=>J,CQ:()=>Q,fr:()=>K,fZ:()=>Y,bY:()=>X});var i,a=n(803238),o=n(907203),r=n(683184),s=n(945151),l=n(37718),c=n(323356),d=n(577911),u=n(6842),m=n(390848),p=n(702135),g=n(689626),h=n(965517),y=n(543491),v=n(799571),f=n(330760),S=n(69588),k=n(894638),C=n(823774),b=n(516341),w=n(354608);!function(e){e.Otp="mail",e.GFed="google.com"}(i||(i={}));const T="9188040d-6c67-4c5b-b112-36a304b66dad",I=(e,t,n,i=!1)=>{let a={};try{a=(0,d.s)().state.getSearchState()}catch{}const r=n?.profile?.tid||a.tid||a.Tid||a.tenantId||a.tenantid;if(n||e[0]&&e[1]){if(r){t.log("Anon flow - anonymous user created");const e=r===T?o.G7.life:o.G7.prod;return{isAuthenticated:!0,userName:n?.userName||"anonymous",profile:{oid:`8:anon:${r}`,tid:r,upn:n?.profile?.upn||"",puid:""},role:o.w4.Anonymous,type:o.Ch.Anonymous,cloud:n?.cloud||e}}if(i)return t.log("Anon flow - anonymous user created without tid"),{isAuthenticated:!0,userName:n?.userName||"anonymous",profile:{oid:"8:anon:",tid:"",upn:n?.profile?.upn||"",puid:""},role:o.w4.Anonymous,type:o.Ch.Anonymous,cloud:n?.cloud||o.G7.prod}}t.log("non anon flow - user undefined")},N=(e,t,n,i)=>{const{enableMTO:a}=i?.get(r.J.Auth)||{},o=C.Jt.getValue((0,b.VF)(e).regionGtm);return{method:t,url:`${`${o?.middleTier||"https://teams.microsoft.com/api/mt/part/dogfood"}${v.$l.TENANTSV2}`}?invalidate=${+new Date(Date.now())}`,serviceName:s.E.Auth,authOptions:{account:e.id,source:"core-auth-base"},apiName:n,headers:a?{"content-type":"application/json","x-ms-client-capabilities":"x-ms-mto-enabled"}:{"content-type":"application/json"}}},E=e=>!!e&&e.status===l.qb.NOT_AUTHORIZED&&"SkypeToken"===e.headers["x-invalid-token"],A=(e,t,n,i,a,o,s)=>{const{ic3CaeResource:l,ic3NonCaeResource:c}=s?.get(r.J.Auth)??{};if("True"!==t?.headers?.[v.kI]||e!==v.ej.IC3_GATEWAY_CAE_KEY&&e!==v.ej.IC3_GATEWAY_AAD_KEY&&e!==v.ej.IC3_GATEWAY_CAE_KEY_INT&&e!==v.ej.IC3_GATEWAY_AAD_KEY_INT&&e!==l&&e!==c)return e;if(!n)return a?.addEventData(["missingWwwAuthHeader"]),e;if(!(0,f.ce)(n))return a?.addEventData(["missingStmHeader"]),e;const d=t.authOptions||{};a?.addEventData([`source:${d?.source}`]);const u=(0,f.Ay)(n);switch(a?.addEventData([`highestProtocol:${u}`]),e){case v.ej.IC3_GATEWAY_CAE_KEY:case v.ej.IC3_GATEWAY_CAE_KEY_INT:case l:if(u===h.Zw.CAE)return e;break;case v.ej.IC3_GATEWAY_AAD_KEY:case v.ej.IC3_GATEWAY_AAD_KEY_INT:case c:if(u===h.Zw.AAD||u===h.Zw.CAE)return e}if(u===h.Zw.AAD)return d?.source&&(0,f.Qk)(i,d.source,h.Zw.AAD),a?.appendScenarioEventData({tokenFallbackType:"CAE_to_AAD"}),a?.addEventData([`stmResource:${v.ej.IC3_GATEWAY_AAD_KEY}`,"stmFallbackWithAadToken"]),c??v.ej.IC3_GATEWAY_AAD_KEY;if(u===h.Zw.Skype){d?.source&&(0,f.Qk)(i,d.source,h.Zw.Skype),a?.appendScenarioEventData({tokenFallbackType:(e===v.ej.IC3_GATEWAY_CAE_KEY||v.ej.IC3_GATEWAY_CAE_KEY_INT?"CAE":"AAD")+"_to_Skype"}),a?.addEventData(["stmResource:skype"]);const n={context:"auth-helper",subContext:"getRetryResourceForStMigration",errorCode:v.SM.FallbackWithSkypeToken,message:"Highest protocal is Skype, retry with skypeToken",correlationId:t?.headers?.correlationId,isExpected:!0};throw o?.({error:{...n,name:"authError"}}),(0,S.Tr)(n)}return e},_=async(e,t,n,i,a)=>{const{buildCloud:s,enableTenantPickerForTFL:l}=a?.get(r.J.Auth)||{};if(!l||e.cloud!==o.G7.life||s!==o.G7.life)return;const c={tenantId:e.profile.tid,oid:e.profile.oid,accountType:e.type,userName:e.userName,id:e.id};let d;try{t.addScenarioMark("show_tenant_picker_for_life_tenant_fetch_start"),d=await n(c,t),t.addScenarioMark("show_tenant_picker_for_life_tenant_fetch_end")}catch(e){return void t.addEventData(["msaTenantPickerFail:1"])}if(!d||d.length<2)return;t.addEventData(["msaTenantPickerShown:1"]);const u=await D(e,t.correlation,d,i),m={state:o.JE.OnTenantPicker};throw C.Jt.put((0,b.VF)((0,w.Xx)(e)).userAuthState,{...m,reason:"TenantPickerShown"}),u},F=(e,t,n,i=!1,r=!1)=>e.subType===o.Yf.Ccm?e:(0,a.isEmpty)(e.profile)||!e.profile.oid&&i||e.role===o.w4.Anonymous||e.userRole===o.jh.Anonymous||!e.isAuthenticated&&t[0]?(n.log("checking anon flow"),I(t,n,e,r)):(e.role=e.role===o.w4.Guest||1===e.profile?.acct?o.w4.Guest:o.w4.Member,P(e),M(e),e.profile.oid=e.profile.oid||`8:defaultOid:${e.profile.tid}`,!e.profile.hasOwnProperty("upn")&&e.hasOwnProperty("userName")&&(e.profile.upn=e.userName||""),e.userRole===o.jh.CrossCloudMeeting&&(e.role=o.w4.Anonymous,e.type=o.Ch.Anonymous),n.log(`User role = [${e.role}], type = [${e.type}], cloud = [${e.cloud}]`),e),D=async(e,t,n,i)=>{const a=await i,o={cloud:e.cloud,accountId:e.id,email:e.profile.email||e.userName,name:e.profile.name,pictureBlob:a,tenants:n};return(0,S.MD)({errorMetaData:o,authSubErrorCode:"MsaUserNotAllowed",name:v.SM.CloudMismatch,message:"msa user Detected",context:"Login",correlationId:t.id,errorCode:v.SM.ShowTenantPicker,subContext:"msaUserNotAllowedError",isExpected:!0})},P=e=>{if(e.profile?.tid===T)return void(e.type=o.Ch.MsaLife);const t=[o.Ch.Msa,o.Ch.Otp,o.Ch.GFed];if(e.type&&-1!==t.indexOf(e.type))return;let n=0===e.profile?.altsecid?.indexOf("1:")?o.Ch.Msa:o.Ch.Aad;e.profile?.idp&&e.profile?.iss!==e.profile.idp&&(n=e.profile.idp===i.Otp?o.Ch.Otp:n,n=e.profile.idp===i.GFed?o.Ch.GFed:n),e.type=n},M=e=>{e.type!==o.Ch.MsaLife?e.cloud&&e.cloud!==o.G7.prod||(e.cloud=o.G7.prod):e.cloud=o.G7.life},x=(e,t)=>{if(!e.anon||!t)return[!1,!1];t=decodeURIComponent(t);for(const n of e.anon)if(n.anonUrlMatch&&t.indexOf(n.anonUrlMatch)>-1)return[!0,O(n,t)];return[!1,!1]},R=(e,t)=>{const n=new Error("Tenant has not completed redemption");return Object.assign(n,{context:"global-auth",subContext:"_performLoginForTenants",reason:"",errorCode:e,serverResponse:"",correlationId:t,isExpected:!0,innerError:""})},j=(e,t,n,i)=>{const a=i?.get(r.J.Auth).isWebClientType,o=i?.get(r.J.Auth).buildCloud||"";if(a&&o&&e.cloudType&&e.cloudType!==o){n.addEventData(["loginSkipped-crossCloudInWeb"]);const e=new Error("Cross cloud tenant login to be skipped for Web.");throw Object.assign(e,{context:"global-auth",subContext:"_performLoginForTenants",reason:"",errorCode:v.SM.CrossCloudTenantInWeb,serverResponse:"",correlationId:t,isExpected:!0,innerError:""})}},L=e=>{const t=new Error("Tenant is has not completed redemption");return Object.assign(t,{context:"global-auth",subContext:"handleGetTenants",reason:"",errorCode:v.SM.MissingRequiredFields,serverResponse:"",correlationId:e,isExpected:!0,innerError:""})},O=(e,t)=>{if(!e.restrictions||0===e.restrictions.length)return!0;for(const n of e.restrictions)if(t.indexOf(n)>-1)return!0;return!1},$=(e,t)=>{const{maxRetries:n,retryWindow:i,backoffTime:a,shouldRetry:o}=t,r=e=>i-(Date.now()-e);return async(...t)=>{const i=Date.now();let s=0,l=r(i),c="";for(;s++<=n&&l>0;)try{return await Promise.resolve(e.apply(e,t))}catch(e){if(o&&!o(e))throw e;if(e&&o&&o(e)&&s>=n){const t=`;All retries elapsed or retryWindow expired, RetryCount: ${s}, RemainingTime: ${l}`;throw(0,p.Tr)(e.context,e.code,e.subContext?e.subContext:"",e.reason,e.message+t,e.serverResponse)}if(s>=n||r(i)<=0){c=e?.message;break}await(0,u._)(a),l=r(i)}throw U(s,c,r(i))}},U=(e,t,n)=>(0,p.Tr)("AuthRetryWithBackoff",g.jK.MaxLimitReached,"elapsed",void 0,`${t}; All retries elapsed or retryWindow expired, RetryCount: ${e}, RemainingTime: ${n}`);var B;!function(e){e.WWW_AUTHENTICATE_HEADER="www-authenticate",e.ERROR_PREFIX="error=",e.CLAIMS_PREFIX="claims=",e.INSUFFICIENT_CLAIMS="insufficient_claims"}(B||(B={}));const W=(e,t)=>{const n={error:void 0,claims:void 0},i=e?.[B.WWW_AUTHENTICATE_HEADER];if(!i)return n;const a=i.split(",").filter(Boolean).map((e=>e.trim()));for(const e of a){const i=e.split('"');if(3===i.length)switch(i[0].toLocaleLowerCase()){case B.ERROR_PREFIX:n.error=i[1];break;case B.CLAIMS_PREFIX:n.claims=t?i[1]:(0,m.G)(i[1])}}return n},H=e=>({id:e.id,tenantId:e.profile.tenantId,oid:e.profile.objectId,userName:e.loginUserName??"",accountType:e.type}),V=(e,t)=>{if(e?.isPartialContent&&t?.length>0){return t.filter((e=>e.tenantRelationship===v.Tv.MTO)).concat(e.tenants)}return e.tenants},G=(e,t)=>{const{enableRenderingCrossCloudTenant:n,buildCloud:i}=t?.get(r.J.Auth)??{};return e.cloudType!==i&&!n},z=(e,t,n)=>{const i=(e=>e&&"string"==typeof e?{claim:e}:e||{})(n),[a,o]=(0,k.OU)({options:i,source:e,scenarioName:y.RG.AcquireToken,subContext:t,startWithoutScenario:!0});return[i,a,o]},q=(e,t)=>({id:`dummy-user-${e.tenantId}-${t.homeAccountId}`,userName:t.userName,profile:{acct:1,altsecid:"",amr:[],aud:"",exp:-1,email:t.profile.email,family_name:"",given_name:t.profile.given_name,iat:1,iss:"",name:t.profile.name,preferred_username:t.userName||t.profile.email,nbf:-1,nonce:"",oid:`dummy-user-${e.tenantId}`,onprem_sid:"",sub:"",tid:e.tenantId,unique_name:t.profile.unique_name,upn:t.profile.email||t.profile.upn,ver:"1.0",isHomeAccount:!1},homeAccountId:t.homeAccountId||t.id,isAuthenticated:!1,type:e.tenantId===h.e0?o.Ch.MsaLife:o.Ch.Aad,cloud:e.cloudType,role:o.w4.Guest}),J=(e,t)=>({id:t.homeAccountId,userName:t.userName,profile:{acct:0,altsecid:"",amr:[],aud:"",exp:-1,email:t.profile.email,family_name:"",given_name:t.profile.given_name,iat:1,iss:"",name:t.profile.name,preferred_username:t.userName||t.profile.email,nbf:-1,nonce:"",oid:t.homeAccountId||e.userId,onprem_sid:"",sub:"",tid:e.tenantId,unique_name:t.profile.unique_name,upn:t.userName,ver:"1.0",isHomeAccount:!0},homeAccountId:t.homeAccountId||e.userId,isAuthenticated:!1,type:e.tenantId===h.e0?o.Ch.MsaLife:o.Ch.Aad,cloud:Q(e.cloudType),role:o.w4.Member}),Q=e=>{switch(e){case o.zC.prod:case o.zC.gcc:return o.G7.prod;case o.zC.dod:return o.G7.dod;case o.zC.gcch:return o.G7.gcch;case o.zC.gallatin:return o.G7.gallatin;default:return o.G7.prod}},K=(e,t,n,i,a)=>{const o=a?y.RG.AuthorizeRequest:y.RG.AcquireToken;n.correlation.scenarioName=o;const[r,s]=(0,k.OU)({options:n,source:"auth-service-module",scenarioName:o,subContext:e,timeoutMs:!1===n.silent?v.rF.ONE_HOUR:void 0,scenarioEventData:{isSilent:n.silent,endpointUrl:t,stmSource:i.source},eventData:["silent:"+(void 0===n.silent?-1:+!!n.silent),"uid:"+ +!!i.userIdentifier,`scheme:${i.scheme}`],startWithoutScenario:!0,isBatch:a});return[r,s]},Y=(e,t)=>{const n=e.newLogger("AuthContextChange","create-auth-task-cross-tab-callbacks");let i;return{contextChangePost:e=>(n.debugToTelemetry?.(`Sent auth context changed cross tab message: ${e}`,"auth_context_change_cross_tab_post_message",{reason:e},!0),t?.postMessage("RefreshForAuthContextChange")),contextChangeSubscribe:e=>(i=t?.subscribeToMessage("RefreshForAuthContextChange",(t=>(n.debugToTelemetry?.("Recieved auth context changed cross tab message","auth_context_change_cross_tab_subscription",void 0,!0),i?.(),e.authentication.showRefreshModal(c.D.Authentication)))),i)}},X=e=>{const t=[];for(let n=0;n<e.length;n++){e.charCodeAt(n)>v.uI.TWO_HUNDRED_FIFTY_FIVE&&t.push(e.charAt(n))}return t}},759795:(e,t,n)=>{"use strict";n.d(t,{_i:()=>c,rt:()=>d});var i=n(43195),a=n(726175),o=n(242111),r=n(59083),s=n(841763),l=n(528004);let c;const d=(e,t)=>(c||(c=new u(e,t)),c);class u{constructor(e,t){this._hostStateProvider=e,this._networkStateProvider=t}observeMachineOnline(){return this._networkStateProvider.observe().pipe((0,o.x)()).pipe((0,r.U)((e=>e===i.G.Online))).pipe((0,s.h)((e=>!0===e)))}observeMachineAwake(){return this._hostStateProvider.observe().pipe((0,l.g)("suspendedState")).pipe((0,r.U)((e=>e.suspendedState===a.V9.Resumed))).pipe((0,s.h)((e=>!0===e)))}isMachineAwake(){return this._hostStateProvider.getState().suspendedState===a.V9.Resumed}isMachineOnline(){return this._networkStateProvider.getState()===i.G.Online}}},645742:(e,t,n)=>{"use strict";n.d(t,{q:()=>c});var i,a,o=n(37718),r=n(689626),s=n(702135),l=n(803238);!function(e){e[e.clean=0]="clean",e[e.registrationToken=1]="registrationToken",e[e.skypeToken=2]="skypeToken"}(i||(i={})),function(e){e.orgid="orgid",e.teamsvisitor="teamsvisitor",e.live="live",e.guest="guest"}(a||(a={}));class c{constructor(e){this.discover=e,this._getSkypeIdType=async()=>{const e=await this.discover.skypeid(),t=e?.split(":")?.[1];return a[t]}}async authorizeRequest(e,t="Authentication"){let n,i;const r=async(e,a)=>{const o={...e.headers};if(this.registrationToken)o.RegistrationToken=this.registrationToken;else{n=i;const r=performance.now(),s=await this._validateSkypeToken({invalidSkypeToken:i,forceRenew:a});i=s.skypeToken,await this.validateAndThrowIfTokensAreSameOrInvalid("Skype::authorizeRequest",i,n,a),e.authPerformanceLogs={...e.authPerformanceLogs,skypeTokenDelta:performance.now()-r,skypeTokenFromCache:s.fromCache},o[t]=this.formatAuthHeader(t,i)}return e.headers=o,e};return{request:await r(e),resolver:async(e,t)=>{const{status:i,headers:{"set-registrationtoken":s}}=e;if(i===o.qb.NOT_AUTHORIZED){const e=await this._getSkypeIdType(),i=this.discover.shouldSkipTokenRefreshForAnon&&this.discover.shouldSkipTokenRefreshForAnon();if(e===a.teamsvisitor&&i)return;if(this.registrationToken&&delete this.registrationToken,!n)return r(t,!0)}else s&&i!==o.qb.NOT_FOUND&&this.parseToken(s)}}}authorize(e,t="Authentication"){return async n=>{let r,s,l=!1,c=i.clean;for(let d=0;d<=2;++d){const d={...n.headers},u=this.registrationToken;if(u)d.RegistrationToken=u;else{const e=performance.now(),i=await this._validateSkypeToken({invalidSkypeToken:r,forceRenew:l});await this.validateAndThrowIfTokensAreSameOrInvalid("Skype::authorize",i?.skypeToken,r,l),r=i.skypeToken,n.authPerformanceLogs={...n.authPerformanceLogs,skypeTokenDelta:performance.now()-e,skypeTokenFromCache:i.fromCache},d[t]=this.formatAuthHeader(t,r)}n.headers=d,s=await e(n);const{status:m,headers:{"set-registrationtoken":p}}=s;if(m===o.qb.NOT_AUTHORIZED){const e=await this._getSkypeIdType(),t=this.discover.shouldSkipTokenRefreshForAnon&&this.discover.shouldSkipTokenRefreshForAnon();if(e===a.teamsvisitor&&t)break;if(u){if(u===this.registrationToken&&delete this.registrationToken,c===i.clean){r=void 0,c=i.registrationToken;continue}}else if(!l&&c!==i.skypeToken){l=!0,c=i.skypeToken;continue}}return p&&m!==o.qb.NOT_FOUND&&this.parseToken(p),s}return this.validateResponse(s)}}async validateAndThrowIfTokensAreSameOrInvalid(e,t,n,i){const a=t===n;if(this.discover.getSettingToDisableSkypeTokenValidation&&this.discover.getSettingToDisableSkypeTokenValidation(i,a))return;const o=this.discover.shouldThrowErrorIfSkypeTokenIsEmpty&&this.discover.shouldThrowErrorIfSkypeTokenIsEmpty(),c=!t||(0,l.isEmpty)(t.trim());if(a||o&&c){const n=await this._getSkypeIdType();throw(0,s.Tr)("Discover",r.jK.FailedToUpdate,e,void 0,`Failed to update token. skypeId startsWith: ${n}, new token: ${+!!t}, isTokenSame: ${a}, isNewTokenEmptyOrUndefined: ${c}, forceRenew: ${i}`)}}async _validateSkypeToken(e){return this.discover.validateSkypeTokenV2?this.discover.validateSkypeTokenV2(e):{skypeToken:await this.discover.validateSkypeToken(e)}}validateResponse(e){if(!e)throw(0,s.Tr)(r.w5.Authentication,r.jK.UndefinedGlobalError,"",void 0,"Failed to authenticate response");return e}formatAuthHeader(e,t){return"Authentication"===e?`skypetoken=${t}`:"x-skypetoken"===e?t:`skype_token ${t}`}parseToken(e){const{expires:t,...n}=(0,l.fromPairs)(e.split(";").map((e=>e.split("=",2).map((e=>e.trim())))));n.endpointId&&(this.registrationToken=(0,l.toPairs)(n).map((e=>e.join("="))).join("; "))}}},576045:(e,t,n)=>{"use strict";n.d(t,{R:()=>i,u:()=>s});var i,a=n(839779),o=n(683184),r=n(803238);!function(e){e.Active="Active",e.Inactive="Inactive",e.LongInactive="LongInactive"}(i||(i={}));class s{constructor(e,t,n,o,l){this._host=e,this._activityCallback=o,this._trackDocumentVisibility=l,this.msUntilIdle=s.MsUntilIdleDefault,this.msUntilLongIdle=s.msUntilLongIdleDefault,this.handleMonitoredWindowEvent=(0,r.debounce)((()=>{this._idleStateBehaviorSubject.value!==i.Active&&this._idleStateBehaviorSubject.next(i.Active),this.restartIdleTimer(),this._activityCallback&&this._activityCallback()}),s.msDelayTime,{maxWait:this.msUntilIdle-s.msDelayTime*s.msMaxWaitTimeFactor,leading:!0}),this.transitionToIdle=()=>{this._idleStateBehaviorSubject.next(i.Inactive),this._idleCountdownTimer=void 0,this.restartLongIdleTimer()},this.handleLongIdleTimerTimeout=()=>{this._idleStateBehaviorSubject.next(i.LongInactive),this._longIdleCountdownTimer=void 0},this.handleDocumentVisibilityChange=()=>{this._host.document.hidden?this.transitionToIdle():this.handleMonitoredWindowEvent()},this._idleStateBehaviorSubject=new a.X(i.Inactive),n&&this.setSettings(n),this.restartLongIdleTimer(),s.monitoredWindowEvents.forEach((t=>{e.addEventListener(t,this.handleMonitoredWindowEvent)})),l&&e.addEventListener("visibilitychange",this.handleDocumentVisibilityChange),t.newLogger("IdleTracker","core-services-client-state").log("Initialized")}observe(){return this._idleStateBehaviorSubject.asObservable()}getState(){return this._idleStateBehaviorSubject.value}createChildWindowIdleTracker(e,t,n){const i=this._activityCallback||this.handleMonitoredWindowEvent;return new s(e,t,n,i)}restartIdleTimer(){this.stopIdleTimers(),this._idleCountdownTimer=this._host.setTimeout(this.transitionToIdle,this.msUntilIdle)}dispose(){this.stopIdleTimers(),s.monitoredWindowEvents.forEach((e=>{this._host.removeEventListener(e,this.handleMonitoredWindowEvent)})),this._trackDocumentVisibility&&this._host.removeEventListener("visibilitychange",this.handleDocumentVisibilityChange),this._idleStateBehaviorSubject.complete(),this.handleMonitoredWindowEvent.cancel()}setSettings(e){const{appIdleTimeoutInMs:t,appLongIdleTimeoutInMs:n}=e.get(o.J.Core);this.msUntilIdle=t||s.MsUntilIdleDefault,this.msUntilLongIdle=n||s.msUntilLongIdleDefault}restartLongIdleTimer(){void 0!==this._longIdleCountdownTimer&&(this._host.clearTimeout(this._longIdleCountdownTimer),this._longIdleCountdownTimer=void 0),this._longIdleCountdownTimer=this._host.setTimeout(this.handleLongIdleTimerTimeout,this.msUntilLongIdle)}stopIdleTimers(){void 0!==this._idleCountdownTimer&&(this._host.clearTimeout(this._idleCountdownTimer),this._idleCountdownTimer=void 0),void 0!==this._longIdleCountdownTimer&&(this._host.clearTimeout(this._longIdleCountdownTimer),this._longIdleCountdownTimer=void 0)}}s.monitoredWindowEvents=["scroll","DOMMouseScroll","mousewheel","touchstart","touchmove","mousemove","keydown"],s.msDelayTime=1e3,s.msMaxWaitTimeFactor=30,s.msUntilLongIdleDefault=12e5,s.MsUntilIdleDefault=3e5},460053:(e,t,n)=>{"use strict";var i,a,o,r,s,l,c;n.d(t,{m7:()=>i,bi:()=>a,GO:()=>s,NU:()=>l}),function(e){e.PASSED="PASSED",e.EDU="EDU",e.PSTN_CALLING="PSTN_CALLING",e.USER_CHOICE="USER_CHOICE",e.ADMIN_DISABLED="ADMIN_DISABLED",e.GUEST_USER="GUEST_USER",e.USER_FTS="USER_FTS",e.T1_DEFAULT="T1DEFAULT",e.T21_DEFAULT="T21DEFAULT",e.T21_ONLY="T21ONLY"}(i||(i={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohort",e.EarlyEnterpriseCohort="EarlyEnterpriseCohort",e.MidEnterpriseCohort="MidEnterpriseCohort",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohort",e.LateEnterpriseCohort="LateEnterpriseCohort",e.GovCloudCohort="GovCloudCohort",e.MacR36Cohort="MacR36Cohort",e.MacR4Cohort="MacR4Cohort",e.EduCohort="EduCohort",e.InternalRingCohort="InternalRingCohort",e.ExternalTapCohort="ExternalTapCohort",e.NoPPChannelCohort="NoPPChannelCohort",e.WebCohort="WebCohort"}(a||(a={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohortUplevel",e.EarlyEnterpriseCohort="EarlyEnterpriseCohortUplevel",e.MidEnterpriseCohort="MidEnterpriseCohortUplevel",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohortUplevel",e.LateEnterpriseCohort="LateEnterpriseCohortUplevel",e.GovCloudCohort="GovCloudCohortUplevel",e.MacR36Cohort="MacR36CohortUplevel",e.MacR4Cohort="MacR4CohortUplevel",e.EduCohort="EduCohortUplevel",e.InternalRingCohort="InternalRingCohortUplevel",e.ExternalTapCohort="ExternalTapCohortUplevel",e.NoPPChannelCohort="NoPPChannelCohortUplevel"}(o||(o={})),function(e){e.M365BusinessLicenseCohort="M365BusinessLicenseCohortDownlevel",e.EarlyEnterpriseCohort="EarlyEnterpriseCohortDownlevel",e.MidEnterpriseCohort="MidEnterpriseCohortDownlevel",e.AdminsOfLateEnterpriseCohort="AdminsOfLateEnterpriseCohortDownlevel",e.LateEnterpriseCohort="LateEnterpriseCohortDownlevel",e.GovCloudCohort="GovCloudCohortDownlevel",e.MacR36Cohort="MacR36CohortDownlevel",e.MacR4Cohort="MacR4CohortDownlevel",e.EduCohort="EduCohortDownlevel",e.InternalRingCohort="InternalRingCohortDownlevel",e.ExternalTapCohort="ExternalTapCohortDownlevel",e.NoPPChannelCohort="NoPPChannelCohortDownlevel"}(r||(r={})),function(e){e.M365_BusinessBasic="M365_BusinessBasic",e.M365_BusinessStandard="M365_BusinessStandard",e.M365_BusinessPremium="M365_BusinessPremium",e.M365_BusinessApps="M365_BusinessApps",e.M365_BusinessEssentials="M365_BusinessEssentials"}(s||(s={})),function(e){e.NONE="NONE",e.ALL_UP_POLICY_EXPIRATION="ALL_UP_POLICY_EXPIRATION",e.COHORT_BASED_EXPIRATION="COHORT_BASED_EXPIRATION",e.COHORT_AND_TAC_BASED_EXPIRATION="COHORT_AND_TAC_POLICY_EXPIRATION",e.NO_COHORT_BASED_EXPIRATION="NO_COHORT_BASED_EXPIRATION"}(l||(l={})),function(e){e.T1_DEFAULT="T1DEFAULT",e.T21_DEFAULT="T21DEFAULT",e.T21_ONLY="T21ONLY",e.NONE="NONE"}(c||(c={}))},671885:(e,t,n)=>{"use strict";var i;n.d(t,{Y:()=>i}),function(e){e.BottomLeft="BottomLeft",e.BottomRight="BottomRight",e.TopLeft="TopLeft",e.TopRight="TopRight"}(i||(i={}))},846630:(e,t,n)=>{"use strict";var i;n.d(t,{hO:()=>i,K$:()=>a,v4:()=>o,F_:()=>r,qF:()=>s}),function(e){e.POP="pop",e.BEARER="Bearer"}(i||(i={}));const a="https://api.spaces.skype.com",o="ForceFallbackToWebAuth",r="ForceReloadIfSkypeAuthFail";var s;!function(e){e.InteractionBanner="interactionBanner",e.Logout="logout",e.UpdateMostRecentUser="updateMostRecentUser"}(s||(s={}))},682881:(e,t,n)=>{"use strict";var i;n.d(t,{l:()=>i,Q:()=>a}),function(e){e[e.UNKNOWN=-1]="UNKNOWN",e[e.ONLINE=1]="ONLINE",e[e.OFFLINE=0]="OFFLINE"}(i||(i={}));const a=["ChatSync","Presence","Files","OneNote","Groups","Video","MasterTab","IndexDb","AdalTokens","AdalLogin","AdalReauth","SkypeTokens","SkypeLicense","SupportedBrowser","MSAGuestLicense","AppSession","CSAStartup"]},79283:(e,t,n)=>{"use strict";n.d(t,{QC:()=>i,_1:()=>a,fl:()=>o,w8:()=>r,nx:()=>s,g4:()=>l});const i="cdl-worker-startup-status",a="cdl-worker-verbose-log",o="cdl-worker-aggregated-user-data",r="cdl-worker-aggregated-user-badge-data",s="cdl-worker-global-user-data",l="secure-global-user-data"},84562:(e,t,n)=>{"use strict";var i;n.d(t,{B:()=>i}),function(e){e.Abandoned="Abandoned",e.AfterOnCommandReceived="AfterOnCommandReceived",e.AfterOnEventReceived="AfterOnEventReceived",e.AlreadyFocused="AlreadyFocused",e.ApplicationHookReceivedCommand="ApplicationHookReceivedCommand",e.ApplicationHookContinuedCommand="ApplicationHookContinuedCommand",e.BeforeOnCommandReceived="BeforeOnCommandReceived",e.BeforeOnEventReceived="BeforeOnEventReceived",e.Blanked="Blanked",e.ChunkLoadStarted="ChunkLoadStarted",e.ChunkLoadSucceeded="ChunkLoadSucceeded",e.Close="Close",e.CommandAfterGetAppViewEntitiesSucceeded="CommandAfterGetAppViewEntitiesSucceeded",e.CommandBeforeGetAppViewEntities="CommandBeforeGetAppViewEntities",e.CommandHandledByOnCommandReceived="CommandHandledByOnCommandReceived",e.CommandHandledPriorToResolution="CommandHandledPriorToResolution",e.CommandMetaDataAdded="CommandMetaDataAdded",e.CommandReceived="CommandReceived",e.CommandReportingTimedOut="CommandReportingTimedOut",e.CommandResolutionStarted="CommandResolutionStarted",e.CommandStart="CommandStart",e.DeeplinkReceived="DeeplinkReceived",e.DeeplinkParsed="DeeplinkParsed",e.DeeplinkParseByAppStarted="DeeplinkParseByAppStarted",e.DeeplinkParseByAppSucceeded="DeeplinkParseByAppSucceeded",e.DelegatedCommandReceived="DelegatedCommandReceived",e.EventBubbled="EventBubbled",e.EventHandled="EventHandled",e.Hidden="Hidden",e.IntentReceived="IntentReceived",e.IntentTransferredCrossCloud="IntentTransferredCrossCloud",e.OnBeforeIntentAuthenticatedStarted="OnBeforeIntentAuthenticatedStarted",e.OnBeforeIntentAuthenticatedCompleted="OnBeforeIntentAuthenticatedCompleted",e.OnLoadingScreenDisplayStarted="OnLoadingScreenDisplayStarted",e.OnLoadingScreenDisplayCompleted="OnLoadingScreenDisplayCompleted",e.WaitForUserContextStarted="WaitForUserContextStarted",e.WaitForUserContextCompleted="WaitForUserContextCompleted",e.WaitForUserContextFailed="WaitForUserContextFailed",e.OnAfterIntentAuthenticatedStarted="OnAfterIntentAuthenticatedStarted",e.OnAfterIntentAuthenticatedCompleted="OnAfterIntentAuthenticatedCompleted",e.IntentHookStarted="IntentHookStarted",e.IntentHookResolved="IntentHookResolved",e.IntentHookRejected="IntentHookRejected",e.IntentHookCompleted="IntentCompleted",e.IntentExecuted="IntentExecuted",e.Failure="Failure",e.Focus="Focus",e.Incomplete="Incomplete",e.LayoutRendered="LayoutRendered",e.LayoutRenderUpdated="LayoutRenderUpdated",e.NavigationCommandStart="NavigationCommandStart",e.NotHandled="NotHandled",e.Rendered="Rendered",e.RenderStarted="RenderStarted",e.ScenarioEventDataAppended="ScenarioEventDataAppended",e.ScenarioMarked="ScenarioMarked",e.SlotPhasedRenderingTimedOut="SlotPhasedRenderingTimedOut",e.Toggled="Toggled",e.UnmountStarted="UnmountStarted",e.WindowCreated="WindowCreated",e.WindowUpdated="WindowUpdated",e.WindowNotUpdated="WindowNotUpdated"}(i||(i={}))},353014:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{yU:()=>i,FV:()=>a,c4:()=>o}),function(e){e.ActiveEntitiesResolved="active_entities_resolved",e.ActiveEntitiesDestroyed="active_entities_destroyed",e.AppSelectionChanged="app_selection_changed_resolved",e.ExperienceIdleStateChanged="experience_idle_state_changed",e.InitialDeeplinkResolved="initial_deep_link_resolved",e.NavigationIntentExecuted="navigation_intent_executed",e.UserAuthenticated="user_authenticated",e.UserConsentedToConsumeResources="user_consented_to_consume_resources",e.PreWarmJobsCompleted="pre_warm_jobs_completed",e.WindowWarmJobsCompleted="window_warm_jobs_completed",e.ExperienceWarmJobsCompleted="experience_warm_jobs_completed",e.ClientStartFinished="client_start_finished"}(i||(i={})),function(e){e.LayoutRenderComplete="layout_render_complete",e.WindowStateChange="window_state_change",e.WindowOptionsChange="window_options_change",e.IdleCallback="idle_callback",e.FirstRenderStarted="first_render_started"}(a||(a={})),function(e){e.Started="app_started",e.Initialized="app_initialized",e.ExperienceWarm="experience_warm",e.UserWarm="user_warm",e.ExperienceLongIdle="experience_long_idle",e.WindowWarm="window_warm",e.Idle="idle"}(o||(o={}))},750622:(e,t,n)=>{"use strict";var i,a;n.d(t,{t:()=>i,H:()=>a}),function(e){e.HighMemoryUsage="HighMemoryUsage",e.CallingStackInitTimeoutOrFailure="CallingStackInitTimeoutOrFailure",e.GroupCallTimeoutOrFailure="GroupCallTimeoutOrFailure"}(i||(i={})),function(e){e.MeetingsAudio="1",e.MeetingsVideoOrScreenSharing="2",e.CallingCallDrops="3",e.MessagingOther="5",e.ActivityFeed="6",e.Crashing="7",e.Files="8",e.SearchSERPSearchResultsPage="9",e.SearchPowerbarAutosuggest="10",e.Other="11",e.MeetingsLiveCaptionsOrTranscript="14",e.TeamsChannelsMembership="15",e.Accessibility="17",e.Calendar="18",e.MeetingsOther="19",e.PlatformApps="20",e.PlatformBotsConnectors="21",e.PlatformTabs="22",e.TeamsChannelsCreateManageSettings="23",e.MessagingSync="25",e.PeopleProfiles="26",e.StatusPresence="27",e.TeamsChannelsPrivateAndSharedChannels="28",e.LocalizationTranslation="29",e.MeetingsAgendaNotes="30",e.MessagingCreateNewOrEdit="31",e.MessagingConversationWithExternalOrSkypeUsers="32",e.Tasks="34",e.Lists="35",e.Approvals="36",e.CallingOther="38",e.Performance="39",e.MessagingChatWindow="40",e.MessagingMissingOrDelayed="41",e.VivaLearning="42",e.MeetingsPowerPointLive="43",e.MeetingsChat="44",e.MeetingsRecording="45",e.MeetingsBreakoutRooms="46",e.MeetingsJoinExperience="47",e.MeetingsGalleryViews="48",e.CallingAudio="49",e.CallingVideoOrScreenSharing="50",e.VirtualAppointments="51",e.MeetingsSpeakerCoach="52",e.NotificationToasts="53",e.WebinarsVirtualEvents="54",e.MessagingVideo="55",e.MeetingsExcelLive="56",e.MeetingsWordLive="57",e.Avatars="58",e.ImmersiveSpace="59",e.MessagingLoopComponents="60",e.Discover="61",e.MeetingsMeetApp="62",e.Communities="63",e.Dashboard="64",e.Photos="65",e.Groups="66",e.InvitingJoiningTeams="67",e.Gaming="68",e.MessagingMessageCompose="70",e.MessagingMessagePaneScrolling="71",e.MessagingReactionsEmojisGIFsStickers="72",e.TeamsChannelsApp="73",e.UpdatesApp="74",e.MeetingsAttendanceReport="75",e.Devices="76",e.VideoFilters="77",e.AuthenticationOrSignIn="78",e.PerformanceMemory="79",e.DesktopAppLaunch="80",e.DesktopAppUpdate="81",e.TaskbarOrSystrayExperiences="82",e.Settings="83",e.AppSwitcherPreview="84",e.MeetingsRecap="86",e.FlyoutAndMinimode="87",e.MultiTenantMultiAccount="88",e.CallingCallNotifications="89",e.TagsChatMentions="90",e.TagsManagement="91",e.MeetingsCopilot="92",e.MessagingSMSIntegration="93",e.PlatformWorkflowsAndConnectors="94"}(a||(a={}))},114676:(e,t,n)=>{"use strict";var i;n.d(t,{M:()=>i}),function(e){e.Default="default",e.MobileSync="mobileSync",e.MobileUnsync="mobileUnsync"}(i||(i={}))},245831:(e,t,n)=>{"use strict";var i,a;n.d(t,{N:()=>i,y:()=>a}),function(e){e.Default="Default",e.Regular="Regular"}(i||(i={})),function(e){e.ChannelListHeaderContextMenu="ChannelListHeaderContextMenu",e.TeamContextMenu="TeamContextMenu",e.ChannelContextMenuLeftRail="ChannelContextMenuLeftRail",e.ManageTeam="ManageTeam",e.ManageChannel="ManageChannel",e.ChannelHeader="ChannelHeader",e.TrinityLeftRail="TrinityLeftRail"}(a||(a={}))},763121:(e,t,n)=>{"use strict";var i,a;n.d(t,{h:()=>i,V:()=>a}),function(e){e.List="List",e.Form="Form"}(i||(i={})),function(e){e.Add="Add",e.Edit="Edit"}(a||(a={}))},233909:(e,t,n)=>{"use strict";var i,a;n.d(t,{X:()=>i,p:()=>a}),function(e){e.TeamsPremium="TeamsPremium"}(i||(i={})),function(e){e.Home="TPCHome",e.Benefits="TPCBenefits",e.StartTrial="TPCStartTrial",e.TryPremium="TPCTryPremium"}(a||(a={}))},409971:(e,t,n)=>{"use strict";var i,a,o,r;n.d(t,{gP:()=>i,pC:()=>a,uP:()=>o,RQ:()=>r}),function(e){e[e.Call=0]="Call",e[e.High=1]="High",e[e.Normal=2]="Normal",e[e.Low=3]="Low"}(i||(i={})),function(e){e.Calling="Calling",e.MSN="MSN",e.MeetingNudge="MeetingNudge",e.Standard="Standard"}(a||(a={})),function(e){e.Rtl="rtl",e.Auto="auto",e.Ltr="ltr"}(o||(o={})),function(e){e.Alert="alert-icon"}(r||(r={}))},980776:(e,t,n)=>{"use strict";var i;n.d(t,{i:()=>i}),function(e){e[e.None=0]="None",e[e.Error=1]="Error",e[e.Warn=2]="Warn",e[e.Info=3]="Info",e[e.Debug=4]="Debug",e[e.Verbose=5]="Verbose",e[e.Max=6]="Max"}(i||(i={}))},308489:(e,t,n)=>{"use strict";n.d(t,{Hl:()=>i,n0:()=>a,fo:()=>o});const i=["/l/auth-callback","/convene/events","/convene/meet","/embed-client/chats","/light-meetings","/l/app","/l/auth/google","/l/auth/signout","/l/autoinstallnotification","/l/calendar/scheduling-form","/l/calendar/surface","/l/campaign/chat","/l/campaign/meeting","/l/channel-dashboard","/l/channel","/l/chat","/l/call","/l/claim","/l/community/create-event","/l/community/events","/l/community/create-post","/l/community/create","/l/community/edit","/l/community/add-member","/l/community/invite","/l/community","/l/discover-teams","/l/entity","/l/file","/l/fileshare","/l/invite/","/l/lobnotifications","/l/manageApps","/l/manage-teams/myinvites","/l/meeting/new","/l/meeting/details","/l/meetingrecap","/l/meetup-join","/l/message","/l/meeting-share","/l/present","/l/share-email","/l/store","/l/task","/l/team-dashboard","/l/team","/l/trial/teamsPremiumLicenseRequest","/l/trial/teamsPremiumTrial","/l/teamsInsider","/meet","/meet/meet-now","/notdefaultapp","/l/stage","/subscriptionmanagement","/l/copilot","/l/virtualevent/new","/l/virtualevent","/l/change-file-open-preference","/l/loopthread"];var a,o;!function(e){e.core="core",e.flyout="flyout",e.default="default"}(a||(a={})),function(e){e.mini="mini",e.main="main"}(o||(o={}))},869292:(e,t,n)=>{"use strict";n.d(t,{Jk:()=>r,UH:()=>s});var i=n(641096);const a=i.Z_.pipe(new i.Dy("URL",(e=>e instanceof URL),((e,t)=>{try{return(0,i.Vp)(new URL(e))}catch{return(0,i.Rn)(e,t)}}),(e=>e.href))),o=(0,i.G0)([(0,i.i0)("NA"),a.pipe(new i.Dy("GTM URL",(e=>e instanceof URL&&e.pathname.endsWith("/")),(e=>(e.pathname.endsWith("/")||(e.pathname+="/"),(0,i.Vp)(e))),i.yR))]),r=(0,i.r$)({isFreemium:i.O7,isBasicLiveEventsEnabled:i.O7,isAdvComms:i.O7,isTranscriptEnabled:i.O7,eduLicenseSkuAndCategory:(0,i.G0)([i.Z_,i.MQ]),isCopilot:i.O7,isM365CopilotBusinessChat:i.O7,isTPProtection:i.O7,isTPCustomization:i.O7,isTPManagement:i.O7,isTPWebinar:i.O7,isTPVirtualAppointments:i.O7,isInfoProtectionPremium:i.O7,isTeamsPhonePremium:i.O7,isTeamsSmb:i.O7,isAvatarsEnabled:i.O7,isImmersiveSpaceEnabled:i.O7,isTeamsPremiumSelfAssigned:i.O7,isTeamsSharedDevices:i.O7,exploratoryTrialLicenseEndDate:(0,i.G0)([i.Z_,i.MQ]),hasOnlyTeamsSharedDevices:i.O7,isTeamsDeviceManagementEnabled:i.O7,experimentationTeamsAddOnPlans:(0,i.IX)(i.Z_),experimentationTeamsLicenseCategories:(0,i.IX)(i.Z_)}),s=(0,i.r$)({ams:o,amsV2:o,appMonetizationService:o,appsSuggestionService:o,appService:o,biometricService:o,chatService:o,chatServiceAfd:o,chatSvcAggAfd:o,eventService:o,teamsPushServiceAfd:o,cmdArtifactsService:o,groupsServiceV2:o,searchService:o,iC3LocationService:o,mcpService:o,middleTier:o,mtImageService:o,phonelinkSmsService:o,powerPointStateService:o,peopleProfileService:o,search:o,tdmService:o,teamsAndChannelsProvisioningService:o,teamsEventsIntegration:o,unifiedPresence:o,urlp:o,urlpV2:o,userProfileService:o,calling_trouterUrl:o,calling_registrarUrl:o,consumerLicenses:o,virtualEventsService:o,userIntelligenceService:o},"region Gtms")},86802:(e,t,n)=>{"use strict";var i;n.d(t,{vW:()=>i,o_:()=>a,Tf:()=>o}),function(e){e[e.Background=0]="Background",e[e.Macro=1]="Macro",e[e.MacroSequential=2]="MacroSequential",e[e.RenderBlocking=3]="RenderBlocking",e[e.UserVisible=4]="UserVisible"}(i||(i={}));const a=-1;var o;!function(e){e[e.None=0]="None",e[e.Canceled=1]="Canceled",e[e.Received=2]="Received",e[e.Started=3]="Started",e[e.Complete=4]="Complete"}(o||(o={}))},43195:(e,t,n)=>{"use strict";var i,a;n.d(t,{G:()=>i,T:()=>a}),function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}(i||(i={})),function(e){e.Offline="Offline",e.Online="Online",e.Unknown="Unknown",e.SuspectedOffline="Suspected Offline"}(a||(a={}))},739720:(e,t,n)=>{"use strict";var i,a;n.d(t,{Z:()=>i,d:()=>a}),function(e){e.AppUpdatedUsingServiceWorker="AppUpdatedUsingServiceWorker",e.AuthTokenForceRefresh="AuthTokenForceRefresh",e.ClearContainer="ClearContainer",e.CloudMismatchOnLogIn="CloudMismatchOnLogIn",e.ErrorPageReboot="ErrorPageReboot",e.ErrorPageSignOut="ErrorPageSignOut",e.RemoveAuthenticatedUser="RemoveAuthenticatedUser",e.RingSwitch="RingSwitch",e.LanguageSwitch="LanguageSwitch",e.HighMemory="HighMemory",e.TeamsInsiderSwitch="TeamsInsiderSwitch",e.SimpleCollabSwitch="SimpleCollabSwitch",e.VDIRestartWorkflow="VDIRestartWorkflow",e.ClientAccessPolicyAdminDisabled="ClientAccessPolicyAdminDisabled",e.ClientAccessPolicyUserAllowed="ClientAccessPolicyUserAllowed",e.ClientAccessLeakedPolicyCleanup="ClientAccessLeakedPolicyCleanup"}(i||(i={})),function(e){e.Auth="Auth",e.DeveloperSwitchersService="DeveloperSwitchersService",e.ReloadAppTask="ReloadAppTask",e.WebClientUpdateService="WebClientUpdateService",e.RemoveAuthenticatedUserResolver="RemoveAuthenticatedUserResolver",e.Core="Core",e.SimpleCollabSwitch="SimpleCollabSwitch",e.ClientAccessAdminPolicyCheckService="ClientAccessAdminPolicyCheckService"}(a||(a={}))},262548:(e,t,n)=>{"use strict";n.d(t,{dS:()=>i,Pz:()=>a,s_:()=>o,Tu:()=>r,Hm:()=>s,Bh:()=>l,x8:()=>c});const i="com.microsoft.teams.chat",a="com.microsoft.teams.calling",o="com.microsoft.teams.meetingOptions",r="com.microsoft.teams.files",s="com.microsoft.teams.teamsAndChannels",l="com.microsoft.teams.simpleCollab",c="com.microsoft.teams.teamsGallery"},943380:(e,t,n)=>{"use strict";var i,a;n.d(t,{t:()=>i,z:()=>a}),function(e){e.core="core",e.window="window",e.mtmaCore="mtmaCore",e.mtmaUser="mtmaUser",e.mtmaWindow="mtmaWindow",e.viewSchema="viewSchema",e.embed="embed",e.cmd="cmd",e.other="other",e.relay="relay"}(i||(i={})),function(e){e.query="query",e.watchQuery="watchQuery",e.mutate="mutate",e.subscribe="subscribe",e.readQuery="readQuery",e.writeQuery="writeQuery",e.readFragment="readFragment",e.writeFragment="writeFragment"}(a||(a={}))},723478:(e,t,n)=>{"use strict";var i,a;n.d(t,{b:()=>i,i:()=>a}),function(e){e[e.SingleAccount=0]="SingleAccount",e[e.MultipleAccounts=1]="MultipleAccounts"}(i||(i={})),function(e){e[e.SingleCloud=0]="SingleCloud",e[e.MultiCloud=1]="MultiCloud"}(a||(a={}))},157551:(e,t,n)=>{"use strict";var i,a;n.d(t,{Q:()=>i,N:()=>a}),function(e){e.Unknown="unknown",e.Prod="prod"}(i||(i={})),function(e){e.MW="MW",e.Anglr="Anglr",e.ShareToTeams="ShareToTeams",e.Files="Files",e.Calendar="Calendar",e.MtgOpt="MtgOpt",e.EmbedClient="EmbedClient",e.LmsIntegration="LmsIntegration",e.CallingEmbed="CallingEmbed",e.ReactWebClient="ReactWebClient",e.Example="Example"}(a||(a={}))},75716:(e,t,n)=>{"use strict";n.d(t,{I:()=>a});const i="IntentPersistenceService";class a{constructor(e){this._localStorage=e}getAllStoredDeeplinks(){const e=this._localStorage.get(i,"Experience");return this.jsonParseSafe(e)||{}}storeDeeplink(e,t){const n=this.getAllStoredDeeplinks();n[e]=t.toString(),this.persist(n)}deleteDeeplink(e){const t=this.getAllStoredDeeplinks();delete t[e],this.persist(t)}clear(){this._localStorage.remove(i,"Experience")}persist(e){this._localStorage.trySet(i,JSON.stringify(e),"Framework","Experience")}jsonParseSafe(e){if(e)try{return JSON.parse(e)}catch(e){return}}}},357859:(e,t,n)=>{"use strict";n.d(t,{xm:()=>a,qf:()=>o,vu:()=>r,b3:()=>s,j:()=>d,sW:()=>u});var i=n(826457);const a="[Authentication][DiscoverV2]";var o,r,s,l,c;!function(e){e.userLocale="X-Client-UI-Language",e.skypeTokenAuthzTypeHeader="ms-teams-authz-type",e.claimsChallengeCapable="claimsChallengeCapable",e.consistencyValue="ConsistencyLevel"}(o||(o={})),function(e){e.skypeTokenRefresh="TokenRefresh",e.skypeTokenExplicitLogin="ExplicitLogin",e.strongConsistencyMsInternalUserSignup="MS-Internal-UserSignup",e.strongConsistencyDefaultValue="Organization;ScenarioId={id}"}(r||(r={})),function(e){e[e.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD=i.gT.Two*i.gT.SECONDS_PER_MINUTE*i.gT.MILLI_PER_SECOND]="DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD"}(s||(s={})),function(e){e.skypeAuthAnonReloadJoinLocation="skypeAuthAnonReloadJoinLocation",e.skypeAuthForceAnonReload="skypeAuthForceAnonReload"}(l||(l={})),function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FIVE=5]="FIVE",e[e.TEN=10]="TEN",e[e.FIFTEEN=15]="FIFTEEN",e[e.SIXTEEN=16]="SIXTEEN",e[e.THIRTY=30]="THIRTY",e[e.TWO_HUNDRED_FIFTY_FIVE=255]="TWO_HUNDRED_FIFTY_FIVE"}(c||(c={}));const d={SKYPE_SEND_REQUEST:"skype_send_request",SKYPE_RECEIVED_RESPONSE:"skype_received_response",SKYPE_RECEIVED_SAME_TOKEN:"skype_received_same_token",SKYPE_SEND_REQUEST_DESKTOP:"skype_send_request_desktop",SKYPE_SEND_REQUEST_WORKER:"skype_send_request_worker",SKYPE_TOKEN_RECEIVED_WORKER:"skype_token_received_worker",RECEIVE_CLAIM:"receive_claim"},u="NA"},109553:(e,t,n)=>{"use strict";n.d(t,{bO:()=>A,BD:()=>_,r2:()=>F,db:()=>P,LO:()=>x,uc:()=>R,qW:()=>j,ut:()=>L,S9:()=>O,Z2:()=>$,Mu:()=>U,Qe:()=>B,br:()=>H,ZC:()=>V,wh:()=>G,nD:()=>q,TB:()=>J,wC:()=>Q,WA:()=>K,H:()=>Y,nd:()=>X,lm:()=>Z,UE:()=>te,lZ:()=>ne,l2:()=>ie,JY:()=>ae,nH:()=>oe,qO:()=>re,Ll:()=>de});var i=n(689626),a=n(702135),o=n(37718),r=n(869292),s=n(683184),l=n(945151),c=n(593018),d=n(641096),u=n(212325),m=n(543491),p=n(907203),g=n(965517),h=n(799571),y=n(69588),v=n(7487),f=n(354608),S=n(823774),k=n(516341),C=n(826457),b=n(256676),w=n(390848),T=n(357859),I=n(771574),N=n(118789);const E=[i.jK.NetworkOffline,i.jK.Forbidden,i.jK.ProxyAuthenticationRequired],A={context:T.xm,subContext:"_getDiscoverResponse",errorCode:i.jK.NetworkOffline,message:"Network is offline, not making any call",isExpected:!0},_={context:T.xm,subContext:"_getDiscoverResponse",errorCode:h.SM.InteractionRequired,message:"Interaction is required to get a skype token, not making any call",isExpected:!0},F=(e,t,n)=>{let o;if(!n){const{response:t}=e;o=t?.isExpected}let r=e;r.context||(r=(0,a.Jn)(e,i.w5.Discover,i.jK.InvalidResponse,"",{error:e.stack},e.message||("string"==typeof e?e:(0,b.u4)(e))));const{serverResponse:{status:s,body:l,headers:c={}}={},context:d}=r;let{reason:u,message:m,code:p=i.jK.InvalidResponse,subContext:g=""}=r;return u=c?{...u,responseCorrelationId:c["correlation-id"],innerError:r}:u,m=l?.message||m,g=l?.errorCode||d,p=t?D(s):i.jK.NetworkOffline,(0,a.Tr)(i.w5.Discover,p,g,{...u,innerError:e},m,r.serverResponse,o)},D=e=>{if(void 0===e)return i.jK.InvalidResponse;switch(e){case o.qb.FORBIDDEN:return i.jK.Forbidden;case o.qb.NOT_AUTHORIZED:return i.jK.Unauthorized;case o.qb.PROXY_AUTHENTICATION_REQUIRED:return i.jK.ProxyAuthenticationRequired;default:return i.jK.FailedToFetch}},P=(e,t,n)=>{if(!e)throw t;const i={...t,errorCode:t.code,reason:(0,b.u4)(t.reason)};return(0,y.ZG)(t)?e.incomplete(i):ee(t)||!n&&t?.isExpected?e.cancel(i):e.fail(i),t.reason&&(t.reason.isExpectedError=ee(t)),t},M=(0,d.dt)({skypeid:d.Z_}),x=((0,d.dt)({skypeTokenData:(0,d.dt)({regionGtms:r.UH,token:(0,d.dt)({skypeToken:d.Z_,expiration:d.pk,userDetails:(0,d.r$)({region:d.Z_})})})},"token"),(e,t)=>{if(!e)return t.error("Can not get userId due to skypeToken is undefined"),"";const{skypeid:n}=(0,u.as)(M,(0,w.J)(e));return`8:${n}`}),R=e=>{let t=e.findScenario(m.RG.GetSkypeToken);return t||(t=e.newScenario(m.RG.GetSkypeToken),t.mark("Non authz error scenario")),t},j=async(e,t,n)=>{const i=(0,v.pW)();n?.push("fn:getuid");const a=await e.getUser({correlation:{id:i,source:"discover-helper::getUserIdentifierForDiscover",scenarioName:m.RG.AuthWebUser}});if(n?.push("user:"+ +!!a),a?.isAuthenticated){t.log(`[_getUserIdentifier][${i}]user found by getUser call`);return(0,f.Xx)(a)}const o=`[_getUserIdentifier] ${a?`User is not authenticated. UserId: [${a.id}] tenantId: [${a.profile.tid}]`:"user missing"}. ${n?.join(";")}`;throw(0,y.Tr)({context:T.xm,subContext:"_getUserIdentifier",errorCode:a?h.SM.UserNotAuthenticated:h.SM.UserNotFoundError,isExpected:!0,message:o,correlationId:i??(0,v.pW)()})},L=async(e,t,n,i,a,o,r,s,l)=>{S.Jt.put(U(e),t.userDetails),n?.push("userDetails:1"),await(0,N.u)(t,r,o,s,l),S.Jt.put($(e),t),n?.push("skypeToken:1");const c=t?.regionGtms;c&&(0,b.u4)(c).length>C.lP.DEFAULT_REGION_GTM_MIN_LENGTH?(S.Jt.put(O(e),c),n?.push("regionGtms:1")):(n?.push("regionGtms:-1"),a.error(`[_getDiscoverResponse][${i}] RegionGtm is missing in response, not able to cache.`))},O=e=>({user:e,typeName:"Discover",key:h.op}),$=e=>({user:e,typeName:"Discover",key:h.rz}),U=e=>({user:e,typeName:"Discover",key:h.ru}),B=async(e,t,n,i)=>{const a=Date.now();let o;try{o=await e.body.clone().json()}catch(n){throw await W(T.xm,"mapToDiscoveryResponse",n,t.correlationId,e,i)}const{regionGtms:r,licenseDetails:s,skypeToken:l,tokens:c,region:d,regionOverride:u,regionSettings:m,skypeGuestUserToken:p,consumerLicenseDetails:g,userRegion:h,partition:y,userPartition:v}=o;t.eventData?.push("parsejson:1");const f=l||c||p,S=f?.skypeToken??f?.skypetoken;let k;return n.log(`[_acquireSkypeTokenWeb][${t?.correlationId}] Response parsed succeed.`),g&&(k={timeStamp:new Date(a),consumerLicenseDetails:g}),{userId:x(S,n),regionGtms:r,licenseDetails:s,skypeToken:S,expires:new Date(a+f?.expiresIn*C.gT.MILLI_PER_SECOND),region:d,userRegion:h,partition:y,userPartition:v,regionOverride:u,regionSettings:m,consumerLicenseDetails:k}},W=async(e,t,n,i,a,o)=>{if(o)throw n;const r=await a.body.text(),s=`${n&&n.message}`,l=(0,I.A)(`${s} - ${r.substring(0,250)}`);return(0,y.Tr)({context:e,subContext:t,correlationId:i??(0,v.pW)(),errorCode:h.SM.SkypeTokenResponseInvalidJson,isExpected:!1,message:l})},H=(e,t,n)=>{if(e.push("fn:_getUserDetailFromHost"),!t)return void e.push("_bootstrapData:0");const{userId:i,region:a,licenseDetails:o,userRegion:r,partition:s,userPartition:l}=t;return i&&a&&o?{id:i,licenseDetails:o,region:a,userRegion:r,partition:s,userPartition:l}:(n.log(`[_getUserDetailFromHost] userId:${!!i}|region:${!!a}|licenseDetails:${!!o}|userRegionForMultiGeo:${!!r}|partition${!!s}|userPartition${!!l}`),void e.push(`userId:${!!i}|region:${!!a}|licenseDetails:${!!o}|userRegionForMultiGeo:${!!r}|partition${!!s}|userPartition${!!l}`))},V=(e,t)=>{const n=x(e.skypeToken,t);return t.log(`[convertResponseToISkypeToken] Skypeid received from discovery. Region: ${e?.region}`),{skypeToken:e?.skypeToken,expiration:e?.expires?.getTime(),regionGtms:e?.regionGtms,userDetails:{id:n,licenseDetails:{...e?.licenseDetails,consumerLicenseDetails:e?.consumerLicenseDetails},region:e?.region,userRegion:e?.userRegion,partition:e?.partition,userPartition:e?.userPartition,regionOverride:e?.regionOverride,regionSettings:e?.regionSettings}}},G=(e,t,n,i,a)=>{const{skypeTokenValidationDisabled:o}=n.get(s.J.Auth),r=n.get(s.J.Host).skypeTokenValidationDisabled,l=o||r;return l&&z(e,t,i,a),!!l},z=(e,t,n,i)=>{if(t){n.log(`Skype token validation skipped. forceRenew:${e};isTokenSame:${t}`);const a=i.newScenario(m.RG.SkypeTokenValidationSkipped);a.appendEventData({message:`forceRenew:${e};isTokenSame:${t}`}),a.stop()}},q=(e,t,n)=>{if(!(0,f.FG)(e.userIdentifier,(0,f.Xx)(t)))throw e.eventData?.push("userMismatch"),n.warn("[_acquireSkypeTokenWeb] user obtained does not match provided userIdentifier, throw error."),(0,y.Tr)({context:T.xm,subContext:"_acquireSkypeTokenWeb",errorCode:h.SM.UserNotFoundError,message:"User obtained does not match provided userIdentifier.",correlationId:e.correlationId,isExpected:!0})},J=(e,t,n,i,a,o,r)=>{const{authOverrides:c}=n.get(s.J.Host),{authzEndpointUrl:d,authzUrl:u,regionGtmsEnv:m,disableT21AuthZDefaultUrl:v}=n.get(s.J.Auth),f=v?h.ej.AUTHZ_DEPRECATED_DEFAULT_BASE_URL:h.ej.AUTHZ_DEFAULT_BASE_URL,S=((e,t,n,i,a)=>{const{environment:o}=i?.get(s.J.Metadata)||{},{doNotPassTenantIdForAnonMeetingJoins:r}=i?.get(s.J.Calling)||{};let c={method:"POST",url:n?`${e}?region_gtms_env=${n}`:`${e}`,serviceName:l.E.Auth,apiName:"acquireSkypeTokenWeb"};if("Anonymous"===t.role)if(t.subType===p.Yf.Ccm){const e=se(t);if(!e)throw(0,y.Tr)({context:"Authentication",subContext:"DiscoverHelper::getRequestConfig",errorCode:"MeetingDetailsNotFound",message:"No meetingUrl present for CCM user",correlationId:a,isExpected:!1});c={...c,body:`{"meetingURL": "${e}"}`}}else c=r?{...c,url:`${e}/visitor`}:{...c,url:`${e}/visitor`,body:`{"tenantId": "${t.profile.tid}"}`};return o!==g.s_.life||"Guest"!==t.role&&"Anonymous"!==t.role||(c={...c,url:`${e}/guest${n?`?region_gtms_env=${n}`:""}`}),c})(c?.authzEndpointUrl||d||u||f,e,m,n,t);return i.log(`[_getFormatRequest][${t}] Request formatted. `),S.headers=((e,t,n,i,a)=>{const o={},r=t?.locale,{disableClaimsChallenge:l,enableSTMHeaderForAuthZ:c,disableCorrelationHeaders:d}=n.get(s.J.Auth);return r&&(o[T.qf.userLocale]=r),l||(o[T.qf.claimsChallengeCapable]="true"),c&&(o["X-MS-Migration"]="True"),o.clientRequestId=e,o["x-ms-skip-phone"]="true",void 0!==i&&(o["ms-teams-authz-type"]=i?T.vu.skypeTokenRefresh:T.vu.skypeTokenExplicitLogin),!d&&a&&(a?.clientVersion&&(o["x-ms-client-version"]=a.clientVersion),o["x-ms-client-type"]=a?.clientType?a.clientType:"web"),o})(t,a,n,o,r),S},Q=(e,t)=>{const n=le(e.licenseDetails,t);return{id:e.id,region:e.region,userRegion:e.userRegion||void 0,partition:e.partition||void 0,userPartition:e.userPartition||void 0,tenant:{type:e.licenseDetails?.isFreemium?c.OV.Freemium:c.OV.Work},...n}},K=(e,t,n)=>{"object"==typeof e&&(e.context=e.context||T.xm,e.subContext=e.subContext||t,e.correlationId=e.correlationId||n)},Y=(e,t,n,i,a)=>{const o=`${e?.subContext}: Failed to get skype token; correlationId:${e.correlationId}, status:${a}, message:${t}, eventData: ${n?.join(";")}`;return e.isExpected?i.debug(o):i.error(o),e},X=(e,t,n)=>{const i=e?.join(";"),a=n?.get(s.J.Metadata)||{},o=n.get(s.J.Auth);return{message:`${i}::isOnline-${t}::environment:${a?.environment}`,endpointUrl:o?.authzUrl,resource:o?.authzResource}},Z=(e,t,n,a,r,l)=>{const{serverResponse:{status:c,body:d}={}}=e;let{message:u,errorCode:m}=e;const{reason:p,code:g}=e,h=n&&!(e.context===i.w5.RejectHttpError&&g===i.jK.RemoteOperationFailed),v=t?.join(";");c&&(m=D(c),u=d.message);const f={reason:p,message:u,eventData:v},S=(0,I.A)((0,b.u4)(f)),k=e.correlationId,C=l?.get(s.J.Metadata)||{},w=l.get(s.J.Auth);void 0===e.isExpected&&(e.isExpected=!h||E.indexOf(m)>-1);const N={context:e?.context??T.xm,subContext:e?.subContext,message:`${u}::isOnline-${h}::env:${C?.environment}`,errorCode:h?m??g:i.jK.NetworkOffline,statusCode:c,correlationId:k,reason:S,endpointUrl:w?.authzUrl,resource:w?.authzResource,isExpected:!h||e.isExpected};if(!((0,b.u4)(e.reason)?.indexOf("LoggedAlready")>-1)&&a){let t=((e,t,n)=>{const{errorCode:a,code:r}=t;if(!e||t.isExpected||n===o.qb.FORBIDDEN||n===o.qb.PROXY_AUTHENTICATION_REQUIRED||a===i.jK.NetworkOffline||r===i.jK.NetworkOffline)return"cancel";if(a===i.jK.TimedOut||r===i.jK.TimedOut)return"incomplete";switch(n){case o.qb.NOT_AUTHORIZED:case-1:case o.qb.THROTTLED:return"incomplete";default:return"fail"}})(h,e,c);switch(t=(0,y.ZG)(e)?"incomplete":t,t){case"stop":a.stop(N);break;case"incomplete":a.incomplete(N);break;case"cancel":a.cancel(N);break;default:a.fail(N)}}return Y(e,u,t,r,c)};function ee(e){return E.indexOf(e.code)>-1||"Authentication::getUser"===e.subContext&&e.message.indexOf("User information is not available")>-1||e.message.indexOf("getUser: MSAL account not found")>-1||e.message.indexOf("Get skype token promise timed out, keep retrying. Is expected:true")>-1}function te(e,t,n,i){return t.getUser().then((()=>{const a=ae(i),{requireSkypetokenForMT:o}=i.get(s.J.Auth),r=t.authorize(e,a);return o?n.authorize(r,"x-skypetoken"):r}))}function ne(e,t,n){return t.getUser().then((()=>{const i=ae(n);return t.authorize(e,i)}))}function ie(e,t,n){return t.getUser().then((()=>{const{cmdMeetingArtifactsServiceResource:i}=n.get(s.J.CMDMeetingArtifactsService);return t.authorize(e,i??"")}))}function ae(e){const{isRunningGlassjar:t,mtAuthResourceOverride:n}=e.get(s.J.Test);if(t&&n)return n;const{authOverrides:i}=e.get(s.J.Host),{mtResource:a}=e.get(s.J.Auth);return i?.mtResource||a||g.O_.MT}const oe=(e,t,n,i,a)=>{if(!e)return void i.log("Failed to obtain telemetry details from discovery.");if(!n)return void i.log("Failed to obtain telemetry provider from getTelemetryProviderInstance.");const o=e.licenseDetails?.isFreemium,{environment:r}=t.get(s.J.Metadata);(e.licenseDetails?.experimentationTeamsLicenseCategories||e.licenseDetails?.experimentationTeamsAddOnPlans||e.licenseDetails?.isTeamsSmb)&&a.getUser().then((t=>{n.setContext("UserInfo.ExpTeamsLicense",e.licenseDetails?.experimentationTeamsLicenseCategories,void 0,t.profile.oid),n.setContext("UserInfo.ExpTeamsAddOnPlan",e.licenseDetails?.experimentationTeamsAddOnPlans,void 0,t.profile.oid),e.licenseDetails?.isTeamsSmb&&n.setContext("UserInfo.IsSmb",e.licenseDetails?.isTeamsSmb,void 0,t.profile.oid)})).catch((e=>i.error("Failed to get Oid from User Profile",e)));const l=r===g.s_.life?c.OV.Life:o?c.OV.Freemium:c.OV.Work;if(r===g.s_.life&&o&&i.warn("The Environment indicates TFL, but Freemium is true - defaulting telemetry to TFL Tenant.Model"),n.setContext("UserInfo.Region",e.region),n.setContext("Tenant.Model",l),e.consumerLicenseDetails?.consumerLicenseDetails){const t=e.consumerLicenseDetails?.consumerLicenseDetails?.licensedProducts?.map((e=>e.skuName)).sort().join(",");n.setContext("UserInfo.IsLicensed",!!e.consumerLicenseDetails?.consumerLicenseDetails?.hasTeamsLicense),n.setContext("UserInfo.Licenses",t)}},re=async(e,t,n,i,a)=>{const{disableClaimsChallenge:o}=i.get(s.J.Auth);if(o)a.log("[unauthorizedErrorHandler] Claims challenge handling disabled.");else if(e)if(t)S.Jt.deleteType(t,"Token");else{const e=await n.getUser();S.Jt.deleteType((0,f.Xx)(e),"Token")}else a.log("[unauthorizedErrorHandler] No header passed in.")},se=e=>{const t=S.Jt.getValue((0,k.VF)((0,f.Xx)(e)).meetingDetails);if(!t)return;const{messageId:n,conversationId:i,tenantId:a,rootMessageId:o}=t;return n===o?`${a}${i}${n}`:`${a}${i}${n}${o}`},le=(e,t)=>({isAdvComms:e?.isAdvComms||!1,isTranscriptEnabled:e?.isTranscriptEnabled||!1,isFreemium:e?.isFreemium||!1,isTrial:e?.isTrial||!1,isWebinarEnabled:e?.isWebinarEnabled||!1,isPrivacyDataControlEnabled:e?.isPrivacyDataControlEnabled||!1,eduLicenseSkuAndCategory:e?.eduLicenseSkuAndCategory||void 0,isBasicLiveEventsEnabled:e?.isBasicLiveEventsEnabled||!1,isCopilot:e?.isCopilot||!1,isM365CopilotBusinessChat:e?.isM365CopilotBusinessChat||!1,isTPProtection:e?.isTPProtection||!1,isTPCustomization:e?.isTPCustomization||!1,isTPManagement:e?.isTPManagement||!1,isTPWebinar:e?.isTPWebinar||!1,isTPVirtualAppointments:e?.isTPVirtualAppointments||!1,isInfoProtectionPremium:e?.isInfoProtectionPremium||!1,isTeamsPhonePremium:e?.isTeamsPhonePremium||!1,isTeamsSmb:e?.isTeamsSmb||!1,isAvatarsEnabled:e?.isAvatarsEnabled||!1,isImmersiveSpacesEnabled:e?.isImmersiveSpacesEnabled||!1,isTeamsPremiumSelfAssigned:e?.isTeamsPremiumSelfAssigned||!1,isTeamsSharedDevices:e?.isTeamsSharedDevices||!1,exploratoryTrialLicenseEndDate:de(e?.exploratoryTrialLicenseEndDate,t),hasOnlyTeamsSharedDevices:e?.hasOnlyTeamsSharedDevices||!1,isTeamsDeviceManagementEnabled:e?.isTeamsDeviceManagementEnabled||!1,...ce(e)}),ce=e=>({experimentationTeamsLicenseCategories:e?.experimentationTeamsLicenseCategories||void 0,experimentationTeamsAddOnPlans:e?.experimentationTeamsAddOnPlans||void 0}),de=(e,t)=>{try{if(e&&!isNaN(Date.parse(e)))return new Date(e)}catch{t.log("Failed to parse date string from license details")}}},118789:(e,t,n)=>{"use strict";n.d(t,{u:()=>d,p:()=>u});var i=n(506688),a=n(501607),o=n(823774),r=n(516341),s=n(683184),l=n(543491),c=n(799571);async function d(e,t,n,o,r){const{enableSkypeTokenEncryption:d,enableEncryptionKeyMaglev:u}=r.get(s.J.Auth);if(!d)return e;const m=n.newScenario(l.RG.AuthWebEncryptToken);m.mark("auth_web_encrypt_token_start");const p=await(0,i.mM)(t,o,void 0,!!u);if(!p)return m.mark("auth_web_encrypt_token_stop",{reason:"tokenEncryption:MissingEncryptionKey"}),m.stop(),e;try{const n=t.crypto.getRandomValues(new Uint8Array(c.uI.SIXTEEN)),i=(new TextEncoder).encode(e.skypeToken),o=await t.crypto.subtle.encrypt({name:"AES-CBC",iv:n},p,i);e.encryptedToken=(0,a.z)(o),e.iv=(0,a.z)(n),m.mark("auth_web_encrypt_token_stop",{reason:"tokenEncryption:success"}),m.stop()}catch(e){m.mark("auth_web_encrypt_token_stop",{error:e,reason:e?.message},"failure"),m.fail()}return e}async function u(e,t,n,c,d){const{enableSkypeTokenEncryption:u,enableEncryptionKeyMaglev:m}=d.get(s.J.Auth);if(!u||!e.encryptedToken||e.skypeToken)return e;const p=n.newScenario(l.RG.AuthWebDecryptToken);p.mark("auth_web_decrypt_token_start");const g=await(0,i.mM)(t,c,void 0,!!m);if(!g)return p.mark("auth_web_decrypt_token_stop",{reason:"Missing encryption key for decryption"}),p.stop(),e;let h=e.iv;if(h||(h=o.Jt.getValue(r.Jl.initializationVector)),!h)return p.mark("auth_web_decrypt_token_stop",{reason:"Missing initialization vector for decryption"}),p.stop(),e;try{const n=(0,a.k)(h),i=(0,a.k)(e.encryptedToken),o=await t.crypto.subtle.decrypt({name:"AES-CBC",iv:n},g,i);e.skypeToken=(new TextDecoder).decode(o),p.mark("auth_web_decrypt_token_stop"),p.stop()}catch(e){p.mark("auth_web_decrypt_token_stop",{error:e,reason:e?.message},"failure"),p.fail()}return e}},68401:(e,t,n)=>{"use strict";n.d(t,{Jq:()=>G});var i=n(869292),a=n(683184),o=n(593018),r=n(898785),s=n(945151),l=n(907203),c=n(37718),d=n(543491),u=n(327204),m=n(390848),p=n(256676),g=n(191366),h=n(65733),y=n(839779),v=n(841763),f=n(826457),S=n(357859),k=n(109553),C=n(188804);const b=(e,t)=>{const n=e.decode(t);if("Left"===n._tag){const e=C.qq.report(n);throw new TypeError(e.join("\n"))}return n.right};var w=n(641096),T=n(212325),I=n(702135),N=n(689626),E=n(112589);const A=(0,w.r$)({isNotificationEnabled:w.O7,isUnifiedPresenceEnabled:w.O7,isOutOfOfficeIntegrationEnabled:w.O7,isContactMigrationEnabled:w.O7,isAppsDiscoveryEnabled:w.O7,isFederationEnabled:w.O7}),_=(0,w.r$)({licenseDetails:i.Jk}),F=(0,w.r$)({regionSettings:A}),D=(0,w.r$)({userRegion:w.Z_}),P=(0,w.r$)({partition:w.Z_}),M=(0,w.r$)({userPartition:w.Z_}),x=(0,w.jV)([(0,w.dt)({region:w.Z_,regionGtms:i.UH,tokens:(0,w.dt)({skypeToken:w.Z_,expiresIn:w.pk})}),(0,w.jV)([F,_,D,P,M])]),R=(0,w.dt)({skuId:w.Z_,skuName:w.Z_,maxMeetingDurationMinutes:w.pk,maxMeetingParticipants:w.pk}),j=(0,w.jV)([(0,w.dt)({hasTeamsLicense:w.O7}),(0,w.r$)({teamsFree:(0,w.dt)({maxMeetingDurationMinutes:w.pk,maxMeetingParticipants:w.pk}),licensedProducts:(0,w.IX)(R)})]),L=(0,w.r$)({consumerLicenseDetails:j}),O=(0,w.jV)([(0,w.dt)({regionGtms:i.UH,skypeToken:(0,w.dt)({skypetoken:w.Z_,expiresIn:w.pk})}),L,_]),$=(0,w.dt)({skypeTokenData:(0,w.dt)({regionGtms:i.UH,token:(0,w.dt)({skypeToken:w.Z_,expiration:w.pk,userDetails:(0,w.r$)({region:w.Z_})})})},"token"),U=(0,w.dt)({skypeid:w.Z_}),B=1e3,W="Discover",H="https://api.spaces.skype.com";function V(e){return h.getParser(e.navigator.userAgent).isBrowser("ie",!0)}class G{constructor(e,t,n,d,m,p,h,v,S,k,C,w=(0,g.J)()){this.aad=e,this.coreSettings=d,this.scenarioFactory=m,this.isOnline=p,this.shouldNotDecodeTokenForIE=h,this.onDiscoverSuccess=v,this.onDiscoverFail=S,this.isCDLWorker=k,this.cdlAuthClient=C,this.globalScope=w,this._localStorageKeys=[],this.licenseTypeToTenantType=e=>e?o.OV.Freemium:o.OV.Work,this._canGetSkypeTokenFromHost=()=>!!this.bootstrapData,this._acquireSkypeTokenWorker=async(e=!1)=>{if(!this.cdlAuthClient)return Promise.reject("CDL worker auth client unavailable");try{const t=await this.cdlAuthClient.getSkypeToken(e);return{...t.userDetails,skypeToken:t.skypeToken,regionGtms:b(i.UH,t.regionGtms),expires:new Date(t.expiration)}}catch(e){throw e.response?.serverResponse&&(e.serverResponse=e.response.serverResponse),e.context=e.context??W,e}},this._acquireRegionGtmTableWorker=async()=>{if(!this.cdlAuthClient?.getRegionGtmTable)return this.logger.log("cdl getRegionGtmTable not implemented"),Promise.resolve(void 0);const e=await this.cdlAuthClient.getRegionGtmTable();return e?b(i.UH,e):(this.logger.log("cdl getRegionGtmTable did not get the table"),Promise.resolve(void 0))},this._acquireUserDetailsWorker=async()=>{if(!this.cdlAuthClient)return Promise.reject("CDL worker auth client unavailable");const e=await this.cdlAuthClient.getUserDetails();return this._mapUserDetailsToUser(e.id,e.userDetails)},this._acquireSkypeTokenDesktop=()=>this.globalScope.opener.requestMessage(r.rY.GetStateData,{requestType:"skypeToken",timeout:f.lP.ACQUIRE_TOKEN_TIMEOUT}).then((e=>b($,e))).then((({skypeTokenData:{regionGtms:e,token:{skypeToken:t,expiration:n,userDetails:i}}})=>({...i,skypeToken:t,regionGtms:e,expires:new Date(n)}))),this._acquireSkypeTokenWeb=()=>{const e=Date.now(),{authOverrides:t}=this.coreSettings.get(a.J.Host),{authzEndpointUrl:n,authzUrl:i,regionGtmsEnv:o,disableT21AuthZDefaultUrl:r}=this.coreSettings.get(a.J.Auth),{doNotPassTenantIdForAnonMeetingJoins:c}=this.coreSettings.get(a.J.Calling)||{},d=r?"https://authsvc.teams.microsoft.com/v1.0/authz":"https://teams.microsoft.com/api/authsvc/v1.0/authz",u=t?.authzEndpointUrl||n||i||d;return this.aad.getUser().then((t=>{const n=this.getResponseFromLocalStorage(t.profile.oid,t.profile.tid);if(n)return n;let i={method:"POST",url:o?`${u}?region_gtms_env=${o}`:`${u}`,serviceName:s.E.Auth,apiName:"acquireSkypeTokenWeb"};if(t.role===l.w4.Anonymous&&(i=c?{...i,url:`${u}/visitor`}:{...i,url:`${u}/visitor`,body:`{"tenantId": "${t.profile.tid}"}`}),V(this.globalScope)&&this.shouldNotDecodeTokenForIE)return this.send().then((t=>t(i).then((({body:e})=>e.json())).then((t=>({...t,tokens:{...t.tokens,expires:new Date(e+t.tokens.expiresIn*B)}})))));{const n=this.send().then((e=>e(i).then((({body:e})=>e.json())))),a=t.type===l.Ch.MsaLife;return this.parseAuthzResponse(n,a,e)}}))},this.logger=t.newLogger("Discover","core-services-discover"),this.send=()=>function(e,t,n){return t.getUser().then((()=>{const{authzResource:i}=n.get(a.J.Auth);return t.authorize(e,i||H)}))}(n,e,this.coreSettings).then((e=>(0,u.B)(e,c.qb.OK))),this._skypeToken=new y.X(null),this.bootstrapData=this.coreSettings.get(a.J.Host).authBootstrapData,this.telemetryProvider=(0,E.Yf)(),e.observeMiddleTierToken?.()?.subscribe((e=>{void 0===e&&(this._discoveryResponse=void 0)}))}observeSkypeToken(){return this._skypeToken.pipe((0,v.h)((e=>null!==e)))}shouldThrowErrorIfSkypeTokenIsEmpty(){return!this.coreSettings.get(a.J.Auth).disableThrowingErrorIfSkypeTokenIsEmpty}getSettingToDisableSkypeTokenValidation(e,t){return(0,k.wh)(e,t,this.coreSettings,this.logger,this.scenarioFactory)}shouldSkipTokenRefreshForAnon(){return!this.coreSettings.get(a.J.Auth).disableSkipTokenRefreshForAnon}regionGtm(e){return V(this.globalScope)&&this.shouldNotDecodeTokenForIE?this.getDiscovery().then((t=>{let n=t.regionGtms[e];if(n)return n===S.sW||n.endsWith("/")||(n+="/"),n;throw(0,I.Tr)(W,N.jK.InvalidResponse,"regionGtm")})):this._getRegionGtmTable().then((e=>({regionGtms:e}))).catch((e=>{if(this._canGetSkypeTokenFromHost()){return{regionGtms:b(i.UH,this.bootstrapData?.regionGtms)}}throw e})).then((({regionGtms:{[e]:t}})=>{if(void 0===t)throw(0,I.Tr)(W,N.jK.InvalidResponse,"regionGtm",{},`${W}::regionGtm::${N.jK.InvalidResponse} - ${e} is missing in discover response`);return t===S.sW?t:t.href}))}async skypeid(){const e=await this.getUser();return new Promise((t=>t(e.id)))}getRegion(){return this.getDiscovery().then((({region:e})=>e)).catch((e=>{if(this._canGetSkypeTokenFromHost()){const e=this.bootstrapData?.region;if(!e)throw(0,I.Tr)(W,N.jK.InvalidResponse,"getRegion");return e}throw e}))}getUserRegionAndPartitionForMultiGeo(){return this.getDiscovery().then((({userRegion:e,userPartition:t,partition:n})=>({userRegion:e,userPartition:t,partition:n}))).catch((e=>{if(this._canGetSkypeTokenFromHost()){const e=this.bootstrapData?.userRegion,t=this.bootstrapData?.userPartition,n=this.bootstrapData?.partition;if(!e||!t||!n)throw(0,I.Tr)(W,N.jK.InvalidResponse,"getUserRegionAndPartitionForMultiGeo");return{userRegion:e,userPartition:t,partition:n}}throw e}))}getUser(){let e;if(this._canGetSkypeTokenFromHost()){const e=this.bootstrapData?.userId,t=this.bootstrapData?.region;if(e)return this.logger.log(`skypeid and region received from host: ${e} ${t}`),Promise.resolve(this._mapHostSkypeTokenToUser(e,t||void 0));this.logger.warn("skypeid or region was not received from host when expected")}return this.isCDLWorker?this._acquireUserDetailsWorker():this.getSkypeTokenInfoFromDiscoveryResponse().then((t=>(e={id:t.userDetails.id,region:t.userDetails.region,userRegion:t.userDetails.userRegion||void 0,partition:t.userDetails.partition||void 0,userPartition:t.userDetails.userPartition||void 0,tenant:{type:this.licenseTypeToTenantType(t.userDetails.licenseDetails?.isFreemium)},isAdvComms:t.userDetails.licenseDetails?.isAdvComms,isTranscriptEnabled:t.userDetails.licenseDetails?.isTranscriptEnabled,isFreemium:t.userDetails.licenseDetails?.isFreemium||!1,isTrial:t.userDetails.licenseDetails?.isTrial||!1,isWebinarEnabled:t.userDetails.licenseDetails?.isWebinarEnabled||!1,isBasicLiveEventsEnabled:t.userDetails.licenseDetails?.isBasicLiveEventsEnabled||!1,eduLicenseSkuAndCategory:t.userDetails.licenseDetails?.eduLicenseSkuAndCategory||void 0,isCopilot:t.userDetails.licenseDetails?.isCopilot||!1,isM365CopilotBusinessChat:t.userDetails.licenseDetails?.isM365CopilotBusinessChat||!1,isTPProtection:t.userDetails.licenseDetails?.isTPProtection||!1,isTPCustomization:t.userDetails.licenseDetails?.isTPCustomization||!1,isTPManagement:t.userDetails.licenseDetails?.isTPManagement||!1,isTPWebinar:t.userDetails.licenseDetails?.isTPWebinar||!1,isTPVirtualAppointments:t.userDetails.licenseDetails?.isTPVirtualAppointments||!1,isInfoProtectionPremium:t.userDetails.licenseDetails?.isInfoProtectionPremium||!1,isTeamsPhonePremium:t.userDetails.licenseDetails?.isTeamsPhonePremium||!1,isTeamsSmb:t.userDetails.licenseDetails?.isTeamsSmb||!1,isAvatarsEnabled:t.userDetails.licenseDetails?.isAvatarsEnabled||!1,isImmersiveSpacesEnabled:t.userDetails.licenseDetails?.isImmersiveSpacesEnabled||!1,isTeamsPremiumSelfAssigned:t.userDetails.licenseDetails?.isTeamsPremiumSelfAssigned||!1,isTeamsSharedDevices:t.userDetails.licenseDetails?.isTeamsSharedDevices||!1,exploratoryTrialLicenseEndDate:(0,k.Ll)(t.userDetails.licenseDetails?.exploratoryTrialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:t.userDetails.licenseDetails?.hasOnlyTeamsSharedDevices||!1,isTeamsDeviceManagementEnabled:t.userDetails.licenseDetails?.isTeamsDeviceManagementEnabled||!1},e)))}async validateSkypeToken(e){return(await this.validateSkypeTokenV2(e)).skypeToken}validateSkypeTokenV2(e){const t=this.getDiscovery(),n=e?.forceRenew,i=e?.invalidSkypeToken;return t.then((({expires:e,skypeToken:t})=>{if(!n&&t!==i&&e.getTime()>Date.now()&&t)return{skypeToken:t,fromCache:!0};if(!t){this.scenarioFactory.newScenario(d.RG.SkypeTokenUndefined).stop()}return this.resetDiscoveryResponse(),this.getDiscovery(n).then((({skypeToken:e})=>({skypeToken:e,fromCache:!1})))}))}async getSkypeTokenInfoFromDiscoveryResponse(){return this.getDiscovery().then((e=>{const{skypeid:t}=(0,T.as)(U,(0,m.J)(e.skypeToken)),n=`8:${t}`;this.logger.log(`skypeid received from discovery: ${n}. Region: ${e.region}`);const i={id:n,region:e.region,userRegion:e?.userRegion,partition:e?.partition,userPartition:e?.userPartition,licenseDetails:{...e.licenseDetails,consumerLicenseDetails:e?.consumerLicenseDetails},regionOverride:e?.regionOverride,regionSettings:e.regionSettings};return{regionGtms:e.regionGtms,skypeToken:e.skypeToken,expiration:e.expires.getTime(),userDetails:i}})).catch((e=>{throw this.logger.error(`failed to get skypeid from discovery: ${(0,p.u4)(e)}â€‹â€‹`),e}))}async getConsumerLicenseDetails(){return this.getSkypeTokenInfoFromDiscoveryResponse().then((e=>e?.userDetails?.licenseDetails?.consumerLicenseDetails))}async _getRegionGtmTable(){if(this._regionGtmTable)return this._regionGtmTable;if(this.isCDLWorker){const e=await this._acquireRegionGtmTableWorker();if(e)return this.logger.log("regionGtm table received from main thread"),this._regionGtmTable=e,e}return this.logger.log("regionGtm table will be obtained via discoveryResponse"),(await this.getDiscovery()).regionGtms}parseAuthzResponse(e,t,n){return t?e.then((e=>b(O,e))).then((({regionGtms:e,licenseDetails:t,skypeToken:{skypetoken:i,expiresIn:a},consumerLicenseDetails:o})=>({regionGtms:e,skypeToken:i,expires:new Date(n+a*B),licenseDetails:t,consumerLicenseDetails:o?{consumerLicenseDetails:o,timeStamp:new Date}:void 0}))):e.then((e=>b(x,e))).then((({region:e,userRegion:t,partition:i,userPartition:a,licenseDetails:o,regionGtms:r,tokens:{skypeToken:s,expiresIn:l},regionSettings:c})=>({region:e,userRegion:t,partition:i,userPartition:a,regionGtms:r,skypeToken:s,expires:new Date(n+l*B),licenseDetails:o,regionSettings:c})))}getDiscovery(e=!1){if(!this._discoveryResponse){const t=this.scenarioFactory.newScenario(d.RG.GetSkypeToken),n=this._canGetSkypeTokenFromHost()?this._acquireSkypeTokenDesktop:this.isCDLWorker?this._acquireSkypeTokenWorker:this._acquireSkypeTokenWeb,i=this.getDiscoveryResponse(n,t,0,e);return this.setDiscoveryResponse(i)}return this._discoveryResponse}async getDiscoveryResponse(e,t,n=0,i=!1){try{const n=await e(i);return t.stop(),this.onDiscoverSuccess&&this.onDiscoverSuccess(),(0,k.nH)(n,this.coreSettings,this.telemetryProvider,this.logger,this.aad),n}catch(o){let r=o;r.serverResponse?.body&&r.serverResponse?.body.json&&(r.serverResponse.body=await r.serverResponse.body.json().catch((e=>{o.message+=`::${e.message}`})));const{disableResponseParsing:s}=this.coreSettings.get(a.J.Auth);if(r=(0,k.r2)(o,this.isOnline(),!!s),this.canRetry(n,r))return t?.mark("retry_skype_token_step",{message:r.message,reason:(0,p.u4)(r)}),this.getDiscoveryResponse(e,t,++n,this.coreSettings.get(a.J.Auth).useForceRenewInSkypeTokenRetry?i:void 0);throw this.onDiscoverFail&&this.onDiscoverFail(this._canGetSkypeTokenFromHost()),this.resetDiscoveryResponse(),(0,k.db)(t,r,!!s)}}resetDiscoveryResponse(){this._discoveryResponse=void 0,this.clearFromLocalStorage()}canRetry(e,t){return e<1&&t.code!==N.jK.NetworkOffline&&t.code!==N.jK.Forbidden&&t.code!==N.jK.ProxyAuthenticationRequired}setDiscoveryResponse(e){return e=e.then((e=>(this.logger.log("discoveryResponse set in memory"),this._regionGtmTable=e.regionGtms,this._skypeToken.next(e.skypeToken),e))),this._discoveryResponse=e}getResponseFromLocalStorage(e,t){let n=this.getFromLocalStorage(e,t,"auth.gtm.table");const a=this.getFromLocalStorage(e,t,"auth.skype.token");return n&&a?(V(this.globalScope)&&this.shouldNotDecodeTokenForIE||(n=b(i.UH,n)),{...a.userDetails,skypeToken:a.skypeToken,expires:new Date(a.expiration),regionGtms:n}):null}getFromLocalStorage(e,t,n){if(!this.globalScope?.localStorage)return;let i=`ts.${t}-${e}.${n}`,a=this.globalScope.localStorage.getItem(i);if(a||(i=`ts.${e}.${n}`,a=this.globalScope.localStorage.getItem(i)),a){this._localStorageKeys.push(i);try{return JSON.parse(a)}catch(e){this.logger.error(e)}}}clearFromLocalStorage(){this.globalScope?.localStorage&&(this._localStorageKeys.forEach((e=>{this.globalScope.localStorage.removeItem(e)})),this._localStorageKeys=[])}getAdditionalUserInfo(){const e=this.bootstrapData?.userRegion,t=this.bootstrapData?.userPartition,n=this.bootstrapData?.partition;return{userRegion:e||void 0,userPartition:t||void 0,partition:n||void 0}}_mapHostSkypeTokenToUser(e,t){const n=this.bootstrapData?.licenseDetails,i=this.getAdditionalUserInfo();return{id:e,region:t||void 0,tenant:{type:this.licenseTypeToTenantType(n?.isFreemium)},isAdvComms:n?.isAdvComms||!1,isTranscriptEnabled:n?.isTranscriptEnabled||!1,isFreemium:n?.isFreemium||!1,isTrial:n?.isTrial||!1,isWebinarEnabled:n?.isWebinarEnabled||!1,isPrivacyDataControlEnabled:n?.isPrivacyDataControlEnabled||!1,eduLicenseSkuAndCategory:n?.eduLicenseSkuAndCategory||void 0,isBasicLiveEventsEnabled:n?.isBasicLiveEventsEnabled||!1,isCopilot:n?.isCopilot||!1,isM365CopilotBusinessChat:n?.isM365CopilotBusinessChat||!1,isTPProtection:n?.isTPProtection||!1,isTPCustomization:n?.isTPCustomization||!1,isTPManagement:n?.isTPManagement||!1,isTPWebinar:n?.isTPWebinar||!1,isTPVirtualAppointments:n?.isTPVirtualAppointments||!1,isInfoProtectionPremium:n?.isInfoProtectionPremium||!1,isTeamsPhonePremium:n?.isTeamsPhonePremium||!1,isTeamsSmb:n?.isTeamsSmb||!1,isAvatarsEnabled:n?.isAvatarsEnabled||!1,isImmersiveSpacesEnabled:n?.isImmersiveSpacesEnabled||!1,isTeamsPremiumSelfAssigned:n?.isTeamsPremiumSelfAssigned||!1,isTeamsSharedDevices:n?.isTeamsSharedDevices||!1,exploratoryTrialLicenseEndDate:(0,k.Ll)(n?.exploratoryTrialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:n?.hasOnlyTeamsSharedDevices||!1,...i}}_mapUserDetailsToUser(e,t){const{region:n,userRegion:i,partition:a,userPartition:o,licenseDetails:r}=t;return{id:e,region:n,userRegion:i,partition:a,userPartition:o,tenant:{type:this.licenseTypeToTenantType(r?.isFreemium)},isAdvComms:r?.isAdvComms||!1,isTranscriptEnabled:r?.isTranscriptEnabled||!1,isFreemium:r?.isFreemium||!1,isTrial:r?.isTrial||!1,isWebinarEnabled:r?.isWebinarEnabled||!1,isBasicLiveEventsEnabled:r?.isBasicLiveEventsEnabled||!1,eduLicenseSkuAndCategory:r?.eduLicenseSkuAndCategory||void 0,isCopilot:r?.isCopilot||!1,isM365CopilotBusinessChat:r?.isM365CopilotBusinessChat||!1,isTPProtection:r?.isTPProtection||!1,isTPCustomization:r?.isTPCustomization||!1,isTPManagement:r?.isTPManagement||!1,isTPWebinar:r?.isTPWebinar||!1,isTPVirtualAppointments:r?.isTPVirtualAppointments||!1,isInfoProtectionPremium:r?.isInfoProtectionPremium||!1,isTeamsPhonePremium:r?.isTeamsPhonePremium||!1,isTeamsSmb:r?.isTeamsSmb||!1,isAvatarsEnabled:r?.isAvatarsEnabled||!1,isImmersiveSpacesEnabled:r?.isImmersiveSpacesEnabled||!1,isTeamsPremiumSelfAssigned:r?.isTeamsPremiumSelfAssigned||!1,isTeamsSharedDevices:r?.isTeamsSharedDevices||!1,exploratoryTrialLicenseEndDate:(0,k.Ll)(r?.exploratoryTrialLicenseEndDate,this.logger),hasOnlyTeamsSharedDevices:r?.hasOnlyTeamsSharedDevices||!1}}}},560116:(e,t,n)=>{"use strict";n.d(t,{a:()=>m});var i=n(645742),a=n(37718),o=n(793803);var r=n(925894),s=n(109553),l=n(683184),c=n(945151),d=n(799571),u=n(750082);class m{constructor(e,t,n,a,o,r){this.aad=e,this.discover=t,this.coreSettings=n,this.loggerFactory=a,this.platformService=o,this.experienceConfig=r,this.skype=new i.q(this.discover)}bind(e,t){switch(t){case"chatService":return this.chatServiceBind(e);case"cmdArtifactsService":return this.cmdArtifactsServiceBind(e);case"userProfileService":return async n=>(0,o.G)(await(0,s.lZ)(this.addAdditionalHeadersToSend(e),this.aad,this.coreSettings),await this.discover.regionGtm(t))(n);case"middleTier":const n=this.coreSettings.get(l.J.Auth).sendMigrationHeaderToMtInGtm,i=this.coreSettings.get(l.J.Auth).disableSkypeTokenToMtInGtm,a={[d.kI]:"True"};return i?async n=>(0,o.G)(await(0,s.lZ)(this.addAdditionalHeadersToSend(e,a),this.aad,this.coreSettings),await this.discover.regionGtm(t))(n):async i=>(0,o.G)(await(0,s.UE)(this.addAdditionalHeadersToSend(e,n?a:void 0),this.aad,this.skype,this.coreSettings),await this.discover.regionGtm(t))(i);case"unifiedPresence":return this.unifiedPresence||(this.unifiedPresence=this.unifiedPresenceBind(t)),this.unifiedPresence(e);case"urlp":case"urlpV2":case"ams":case"amsV2":return async n=>(0,o.G)(this.skype.authorize(e,"Authorization"),await this.discover.regionGtm(t))(n);case"mtImageService":return async n=>{const{mtImageServiceOverrideUrl:i}=this.coreSettings.get(l.J.Test),a=i||await this.discover.regionGtm(t);return(0,o.G)(e,a)(n)};default:return this.defaultBind(e,t)}}defaultBind(e,t){return async n=>{const i=await this.discover.regionGtm(t);return(0,o.G)(this.aad.authorize(e,i),i)(n)}}unifiedPresenceBind(e){const{requireConsumerTypeHeader:t,requireSkypetoken:n}=this.coreSettings.get(l.J.Presence);return function(e,t){let n;return i=>async r=>{for(let s=0;;++s){n||(n=await t());const l=await(0,o.G)(e(i,n),n)({...r,headers:{...r.headers,BehaviorOverride:"redirectAs404"}}),{status:c,headers:{location:d}}=l;if(c!==a.qb.NOT_FOUND||!d||s>2)return l;n=new URL("/",d).href}}}(((e,i)=>{const a=n?this.skype.authorize(e,"x-skypetoken"):this.aad.authorize(e,i);return t?async e=>(e={...e,headers:{...e.headers,"x-ms-client-consumer-type":"teams4life"}},a(e)):a}),(()=>this.discover.regionGtm(e)))}chatServiceBind(e){return this.chatService||(this.chatService=(0,r.Db)((e=>this.skype.authorize(e)),(e=>this.discover.regionGtm(e)),this.coreSettings,this.loggerFactory)),this.chatService(e)}cmdArtifactsServiceBind(e){const{cmdMeetingArtifactsServiceEndpoint:t}=this.coreSettings.get(l.J.CMDMeetingArtifactsService);return async n=>(0,o.G)(await(0,s.l2)(e,this.aad,this.coreSettings),t??"")(n)}addAdditionalHeadersToSend(e,t){if(this.coreSettings.get(l.J.Core).enableCommonMtHeadersWithSend){const n=(0,u.h)(this.platformService,this.experienceConfig);return i=>e({...i,headers:{...n,...t,[c.f.xMsRequestId]:i.correlationId||"",...i.headers}})}return e}}},525556:(e,t,n)=>{"use strict";var i,a;n.d(t,{f:()=>i,a:()=>a}),function(e){e.AssignExternalIcon="AssignExternalIcon",e.AssignedPriorityStatusToToast="AssignedPriorityStatusToToast",e.CallsActionTypeToNotificationActionFailed="CallsActionTypeToNotificationActionFailed",e.CallingToastActionMutationFailed="CallingToastActionMutationFailed",e.ChatActionTypeToNotificationActionFailed="ChatActionTypeToNotificationActionFailed",e.ChatTabsFetchFailed="ChatTabsFetchFailed",e.ChatToastActionMutationFailed="ChatToastActionMutationFailed",e.ChatToastEmoticonsQueryFailed="ChatToastEmoticonsQueryFailed",e.ChannelToastEmoticonsQueryFailed="ChannelToastEmoticonsQueryFailed",e.CollectionIdUndefined="CollectionIdUndefined",e.ConversionToHostEntityOptionsFailed="ConversionToHostEntityOptionsFailed",e.ConversationAlerts="ConversationAlerts",e.ConversationIsMuted="ConversationIsMuted",e.ConversationFetchFailed="ConversationFetchFailed",e.DateConversionFailed="DateConversionFailed",e.DefinedIfToastCanIgnoreConversationMuted="DefinedIfToastCanIgnoreConversationMuted",e.EmptyEvent="EmptyEvent",e.EventFromSelf="EventFromSelf",e.EventDiscarded="EventDiscarded",e.ExtractedSettings="ExtractedSettings",e.ImageFetchFailed="ImageFetchFailed",e.ImageUrlGenerationFailed="ImageUrlGenerationFailed",e.LogToastInfo="LogToastInfo",e.MappingCommandOptions="MappingCommandOptions",e.MappingOfToastInResolver="MappingOfToastInResolver",e.GraphItemToastUnhandledType="GraphItemToastUnhandledType",e.NoAutheticatedUserOrTrackingService="NoAutheticatedUserOrTrackingService",e.NotEnabled="NotEnabled",e.PriorityAssignmentSkipped="PriorityAssignmentSkipped",e.RequiredFieldMissing="RequiredFieldMissing",e.ReturningFetchedImage="ReturningFetchedImage",e.ReturningHardcodedImage="ReturningHardcodedImage",e.ReturningUserKeyForToastCollection="ReturningUserKeyForToastCollection",e.SkippingPriorityMessageFromLongpoll="SkippingPriorityMessageFromLongpoll",e.SubscriptionFailed="SubscriptionFailed",e.Subscribing="Subscribing",e.ToastCommandSent="ToastCommandSent",e.ToastEventIsAlreadyRead="ToastEventIsAlreadyRead",e.ToastEventReceivedInJob="ToastEventReceivedInJob",e.ToastEventReceivedInWorkerResolver="ToastEventReceivedInWorkerResolver",e.ToastImageAsDataUriIsUndefined="ToastImageAsDataUriIsUndefined",e.ToastNavigationDataNotFound="ToastNavigationDataNotFound",e.ToastSuppressedForWindowInFocus="ToastSuppressedForWindowInFocus",e.UnhandledType="UnhandledType",e.UnhandledSubtype="UnhandledSubtype",e.UpdateBlockingCacheWithOSDnD="UpdateBlockingCacheWithOSDnD",e.OSDnDBannerJobUserFetchFailed="OSDnDBannerJobUserFetchFailed",e.YieldingToastFromWorkerResolver="YieldingToastFromWorkerResolver",e.MentionHandledByActivityManager="MentionHandledByActivityManager",e.InvalidType="InvalidType",e.ToastDisabledByCoreSettings="ToastDisabledByCoreSettings",e.MissingConversationId="MissingConversationId",e.CommunityEvent="CommunityEvent",e.MappingException="MappingException",e.ProfileFetchFailed="ProfileFetchFailed",e.ToastThrottled="ToastThrottled"}(i||(i={})),function(e){e.PhonelinkSmsPrefix="phonelink:"}(a||(a={}))},833990:(e,t,n)=>{"use strict";n.d(t,{E:()=>r,z:()=>s});var i=n(702135),a=n(689626);let o;const r=e=>async t=>{if(!o)return e(t);return e(t).then((e=>(o?.processResponse(e),e))).catch((e=>{throw o?.processError(e),e}))};function s(e,t){if(o){throw(0,i.Tr)(a.w5.Tasks,a.jK.AlreadyInitialized,"subscribeToSendNetworkTracking",void 0,"subscription exists")}o={processResponse:e,processError:t};return()=>{o=void 0}}},577911:(e,t,n)=>{"use strict";var i,a;n.d(t,{I:()=>R,s:()=>j}),function(e){e.apps="apps",e.broadcasts="broadcasts",e.chats="chats",e.calls="calls",e.calendars="calendars",e.extensions="extensions",e.files="files",e.licenses="licenses",e.meetings="meetings",e.teamgallery="teamgallery"}(i||(i={})),function(e){e.list="list",e.create="create",e.join="join",e.error="error",e.view="view"}(a||(a={}));var o=n(928322),r=n(803238);const s=1e3,l=new Map,c=/^\/|\/$/g;function d(e,t){const n=t?":":"",i=e.id?`/${n}${e.id}`:"",a=e.action?`/${e.action}`:"";return`${e.resource}${i}${a}`}function u(e){const{descriptor:t,asPath:n,stem:i="",...a}=e;let o=i;const r=t?t.resources:void 0;if(r&&r.length>0)for(const e of r)o=`${o}/${d(e,n)}`;return{...a,descriptor:t,asPath:n,stem:o}}function m(...e){return e.reduce(((e,t)=>(e.resources=e.resources.concat(t.resources),e.search={...e.search,...t.search},e)),{resources:[],search:{}})}function p(e){return(0,r.flow)([u,v,f])(e).stem}function g(e){if(!e||0===e.length)return[];const t=l.get(e);if(t)return t;let n=[];const o=e.replace(c,"");if(0===o.length)return n;const r=o.split("/");try{const t=function(e){const t=[];let n=-1;for(const a of e){const e=a;i[e]&&(n++,t[n]=[]),n>=0&&t[n].push(e)}return t}(r);return t&&(n=t.map((e=>{let t;const n=2,i=3;switch(e.length){case i:t={resource:e[0],id:e[1],action:e[n]};break;case n:{const n=e[1];t=a[n]?{resource:e[0],action:e[1]}:{resource:e[0],id:e[1]};break}default:throw new Error("Invalid resource fragment format found, id or action is required.")}return t}))),l.size<s&&l.set(e,n),n}catch(e){throw new Error(`Unable to parse path into proper resources. ${e.message}`)}}function h(e){return(0,o.parse)(e||"")}function y(e){return(0,o.stringify)(e||{})}function v(e){const{context:t,asPath:n,stem:i=""}=e;let a=i;if(t){const e=t.router;if(!e)throw new Error("Cannot generate a relative path without a context. Verify a context was added provided");{const t=n?e.route.match.path:e.route.match.url;a="/"!==t?`${t}${a}`:a}}return{...e,stem:a}}function f(e){const{descriptor:t,asPath:n,stem:i=""}=e;let a=i;if(t){const e=y(t.search);e&&(a=`${a}${n?`/:${e}`:`?${e}`}`)}return{...e,stem:a}}function S(e){const{pathname:t,search:n}=e;return{resources:g(t),search:h(n)}}class k{constructor(e,t){this.history=t,this._logger=e.newLogger("Routing Service","core-services-routing")}navigate(e){const t=function(e){const{search:t,...n}=e,i=y(t);return{pathname:p({descriptor:n}),search:i}}(e);this.execute(t)}execute(e){this.history?this.history.push(e):this._logger.error("Unable to route using history. History initialized with undefined")}}class C{constructor(e,t,n){this._location=t,this._history=n,this._logger=e.newLogger("State Routing Service","core-services-routing")}getSearchState(){const e=this.getLocation();if(!e)return{};const t=e.search;return t!==this._previousSearch&&(this._previousSearch=t,this._currentState=h(t)),this._currentState||{}}getOrigin(){const e=this.getLocation();return e&&e.origin}getHost(){const e=this.getLocation();return e&&e.host}getPathname(){const e=this.getLocation();return e&&e.pathname}getLocation(){if(this._location||this._logger.error("Unable to execute on location. Location initialized with undefined"),this._location&&this._history&&this._history.location){const{search:e,pathname:t}=this._history.location;return{...this._location,search:e,pathname:t}}return this._location}}var b;!function(e){e.OrgChart="organization"}(b||(b={}));class w{constructor(e,t){this.routingService=e,this.rootRoutingService=t}toCreateChatWithUsers(e){this.routingService.navigate(this.createChatWithUsersDescriptor(e))}toChatById(e){this.routingService.navigate(this.chatByIdDescriptor(e))}toOrgChart(e){this.routingService.navigate(this.orgChartDescriptor(e))}toChatList(){this.routingService.navigate(this.chatListDescriptor())}chatByIdDescriptor(e){return this.concatToAppDescriptor({resources:[{resource:i.chats,id:e}]})}createChatWithUsersDescriptor(e){const t=JSON.stringify(e&&e.length>0?e.sort():[]);return this.concatToAppDescriptor({resources:[{resource:i.chats,action:a.create,id:t}]})}chatListDescriptor(){return this.concatToAppDescriptor({resources:[{resource:i.chats,action:a.list}]})}orgChartDescriptor(e){return m(this.createChatWithUsersDescriptor([e]),{resources:[{resource:i.extensions,id:b.OrgChart}]})}concatToAppDescriptor(e){return m(this.rootRoutingService.chatAppDescriptor(),e)}}class T{constructor(e,t){this.routingService=e,this.rootRoutingService=t}toCallById(e){this.routingService.navigate(this.callByIdDescriptor(e))}toCallList(){this.routingService.navigate(this.callsListDescriptor())}callByIdDescriptor(e){return this.concatToAppDescriptor({resources:[{resource:i.calls,id:e}]})}callsListDescriptor(){return this.concatToAppDescriptor({resources:[{resource:i.calls,action:a.list}]})}concatToAppDescriptor(e){return m(this.rootRoutingService.callingAppDescriptor(),e)}}var I,N=n(262548);class E{constructor(e){this._routingService=e}toAppById(e){this._routingService.navigate(this.appDescriptor(e))}chatAppDescriptor(){return this.appDescriptor(N.dS)}callingAppDescriptor(){return this.appDescriptor(N.Pz)}meetingOptionsAppDescriptor(){return this.appDescriptor(N.s_)}fileAppDescriptor(){return this.appDescriptor(N.Tu)}appDescriptor(e,t){return{resources:[{resource:i.apps,id:e,action:t}]}}}!function(e){e[e.Allow=0]="Allow",e[e.Block=1]="Block"}(I||(I={}));class A{constructor(){this._taps=[]}tap(e){return this._taps.push(e),()=>{this._taps=this._taps.filter((t=>t!==e))}}call(e){let t;for(const n of this._taps){const i=n({data:e,previousResult:t});void 0!==i&&(t=i)}return t}}class _{constructor(e){this._history=e,this.onNavigationBlocked=new A,this.onNavigationStart=new A,this.onNavigationSucceeded=new A,this._handleNavigationStart=e=>{if(!this._history||!this._history.location)return;const t=S(this._history.location),n=S(e);return this.onNavigationStart.call({from:t,to:n})===I.Block?(this.onNavigationBlocked.call({to:n}),!1):void 0},this._handleNavigationSuccess=e=>{const t=S(e);this.onNavigationSucceeded.call({to:t})},this._history&&this._history.block&&this._history.block(this._handleNavigationStart),this._history&&this._history.listen&&this._history.listen(this._handleNavigationSuccess)}}var F=n(702135),D=n(689626);class P{meetingOptionsPageDescriptor(e){const{tenantId:t,organizerId:n,threadId:a,messageId:o,additionalMessageId:r,search:s}=e;return{resources:[{resource:i.meetings,id:JSON.stringify({tenantId:t,organizerId:n,threadId:a,messageId:o,additionalMessageId:r})}],search:s}}meetingOptionsLicenseDescriptor(e){return{resources:[{resource:i.licenses,action:a.list}],search:e?e.search:void 0}}}class M{constructor(e,t){this._history=t,this._logger=e.newLogger("External Routing Service","core-services-routing")}serializeToPath(e){const{descriptor:t,exact:n}=e;let i="";return t&&(i=p({descriptor:t})),this._history?n||(i=this._history.createHref({pathname:i}).toString()):n&&this._logger.error("Unable to execute on history to generate absolute path. History initialized with undefined"),i}}let x;const R=(e,t,n)=>{const i=new k(e,t),a=new E(i),o={state:new C(e,n,t),root:a,call:new T(i,a),chat:new w(i,a),meeting:new P,external:new M(e,t),hooks:new _(t)};return x=o,x},j=()=>{if(!x)throw(0,F.Tr)("RoutingServices",D.jK.NotInitialized,"getInstance");return x}},118359:(e,t,n)=>{"use strict";n.d(t,{qo:()=>s,Q6:()=>o,bE:()=>r});var i=n(683184),a=n(803238);const o=e=>{const t=e.get(i.J.Host).enableSyncEngine;return(0,a.isNil)(t)?!!e.get(i.J.CdlWorker).enableSyncEngine:t},r=e=>{const t=e.get(i.J.Host).enableProfileManagerStore;return(0,a.isNil)(t)?!!e.get(i.J.People).enableProfileManagerStore:t},s=e=>{const{dataStoreMapType:t,disableDataStoreInMemoryProvider:n}=e.get(i.J.CdlWorker);return n?"none":t||"red-black-tree"}},472930:(e,t,n)=>{"use strict";n.d(t,{RT:()=>d,iI:()=>u,Y3:()=>m,u0:()=>p,JX:()=>g,xb:()=>h,mN:()=>k});var i=n(40493),a=n(507751),o=n(683184),r=n(66432),s=n(609930);const l="99999999999",c="ringFinder",d="https://config.teams.microsoft.com",u="1.0.0.0",m="1415",p="MicrosoftTeams";function g(e){const t=Object.keys(s.z).filter((e=>isNaN(Number(e))));for(let n=0;n<t.length;n++)if(e===t[n])return n}function h({experienceName:e,hostExperienceName:t,coreSettings:n,platformService:a,user:s,locale:l,logger:g}){const h=function(e,t,n){const{primaryUserProfile:a}=e.get(o.J.Host);if(a){const{oid:e,tid:t}=a;return{userId:e,tenantId:t}}return n||function(e){try{const e=i.get(c);if(!e)return;const{oid:t,tid:n}=JSON.parse(decodeURIComponent(e));return{userId:t,tenantId:n}}catch(t){return void e.warn(`Error parsing ringFinder cookie when user not authenticated: ${t}`)}}(t)}(n,g,s),{ecsOverrides:k,config:{platformId:C,buildVersion:b,buildType:w,osPlatform:T}}=a,{ecsNamespaces:I,criticalEcsNamespaces:N,ecsEndpoint:E,enableEcsNativeRingResolution:A,disableSendOsVersionWithEcsRequest:_,enableUbrInOsVersion:F}=n.get(o.J.Core),{ecsNamespacesOverride:D,criticalEcsNamespacesOverride:P}=function(e,t,n,i){const{enableT1EndgameNamespaceOverride:a}=e.get(o.J.Core);if(!a)return{};if("cdl-worker"===n&&"main-renderer"===i&&t.config.platformId===r.us.Web)return{ecsNamespacesOverride:["TeamsNorthstarLegacy","TeamsBuilds","Segmentation"],criticalEcsNamespacesOverride:["TeamsNorthstarLegacy"]};return{}}(n,a,e,t),M=function(e,t){const{environment:n="prod",ring:i,originalRing:a}=e,o={environment:n};t&&!a||(o.audienceGroup=i,o.teamsRing=i);return o}(k,A),{ecsHostUrl:x,electronVersion:R,windowsInsiderChannel:j,windowsInsiderRing:L}=n.get(o.J.Host),{deviceInfo:O,isOcdi:$}=n.get(o.J.Platform),U=k.hostUrl||x||E||d;return{version:`${C||m}_${u}`,domain:U,client:p,agents:D||I,criticalAgents:P||N,filters:{...M,experience:e,buildType:w,virtualization:f(n,a),osPlatform:T,wipChannel:j,wipRing:L,osVersion:_?void 0:y(O,!!F,g),isOcdi:$?.toString(),id:h?.userId,aaduserid:h?.userId,tenantId:h?.tenantId,experienceBuild:S(w,b),desktopVersion:v(n,a),electronVersion:R,teamsLocale:l,teamsLicenseCategory:h?.teamsLicenseCategories,teamsAddOnPlan:h?.teamsAddOnPlans,mtmaCount:h?.mtmaCount}}}function y(e,t,n){if(!e||!e.osVersion)return;let i=e.osVersion;if(t&&e.ubrVersion&&!isNaN(parseInt(e.ubrVersion,10))&&(i=`${e.osVersion}.${e.ubrVersion}`),(0,a.validate)(i))return i;n.errorNoPii?.(`osVersion parsed from deviceInfo is not a proper semver '${i}'.`)}function v(e,t){const{desktopVersion:n}=e.get(o.J.Host);if(n){const e=n.indexOf("/");return e>-1?n.substr(e+1):n}return t.host.hostAppVersion}function f(e,t){const{virtualization:n}=e.get(o.J.Host);return n??t.config.vdi?.configFilter}function S(e,t){if("local"===e||"container"===e)return l;if(t){const e="1.0.0.20",n=6;if((t=`${t}`).startsWith(e)){const i=t.substring(e.length,e.length+n),a=t.substring(e.length+n);t=`${i}000${a}`}const i=parseInt(t,10);if(!isNaN(i))return i.toString()}}function k(e){if(!e)return;const t=e.getTime(),n=(new Date).getTime();return t<n?n-t:0}},780073:(e,t,n)=>{"use strict";n.d(t,{YK:()=>T,Lk:()=>_});var i,a=n(683184),o=n(605882),r=n(37718),s=n(593018);!function(e){e.HEALTHY="healthy",e.UNHEALTHY="unhealthy",e.UNKNOWN="unknown"}(i||(i={}));var l=n(933609),c=n(131476),d=n(256676),u=n(876934),m=n(112589),p=n(316877),g=n(702135);const h=3e4,y={headers:{sharePoint:{SPRequestGuid:"SPRequestGuid",SPClientServiceRequestDuration:"SPClientServiceRequestDuration",SPRequestDuration:"SPRequestDuration"}}},v="cache",f="cache-control",S="x-cache",k="electron";var C;!function(e){e.CDN="CDN",e.Shared="Shared",e.Browser="Browser",e.None="None"}(C||(C={}));let b="";async function w(e){const{status:t,responseHeaders:n,requestHeaders:i,performance:a}=e,o=await async function(e){try{return await(0,u.E)(e,h)}catch(e){return}}(a);return Object.assign(e,{requestHeaders:(r=i,N(["clientRequestId","x-ms-request-id"],r)),responseHeaders:A(t,n),performance:P(o)});var r}const T=(e,t,n,r="")=>{const s=(t.get(a.J.Telemetry).httpnsDisabledServices??[]).map((e=>e.toLowerCase()));return async t=>{const{serviceName:a,apiName:u,result:h,innerError:y,operationLogs:v}=t;if(y&&(0,g.Wc)(y))return;t.operationLogs=await function(e){const t=e.map((async e=>{const{type:t,duration:n,result:i,request:a}=e;return{type:t,duration:n,result:i,request:a&&await w(a)}}));return Promise.all(t)}(v);const f=a.toLowerCase(),S=s.some((e=>e===f));b=r;const k=t.correlationId||(0,p.v4)(),C=R(a,u);n.log(`Data call ${C} is completed with ${h}. CorrelationId: ${k}`),S||t.operationLogs.forEach((t=>{if(t.request){const{name:n,method:i}=t.request;F(e,x(a,n||u,i),"EM",t,k)}})),function(e,t,n){const{serviceName:a,apiName:r,createdTime:s,duration:u,parameters:p,result:g,statusCode:h,innerError:y,operationLogs:v}=e,f=function(e,t){const n=(0,m.Yf)().getEndpointHealth(e,t);return void 0===n?i.UNKNOWN:n?i.HEALTHY:i.UNHEALTHY}(a,r);v.forEach((e=>{if(e.request){const{method:t}=e.request;!function(e,t,n,i,a,r,s){const l=t.request;if(l){const{duration:u,result:m}=t,{method:p,hostname:g,performance:h,responseHeaders:y,requestHeaders:v,dateTime:f,authPerformanceLogs:S}=l,k={apiName:i,serviceName:a,duration:u,result:I(m),correlationId:n,method:p,hostname:g,responseHeaders:(0,d.u4)(y),requestHeaders:(0,d.u4)(v),healthState:r,timestamp:f.toISOString(),hasInnerError:!!s};h&&(h.duration&&(k.perf_duration=h.duration.toString()),k.perf_details=(0,d.u4)({...h,...S})),(0,c.P3)(o.x.Endpoint,e,k,void 0,void 0,void 0,b)}}(x(a,r,t),e,n,r,a,f,y)}}));const S=g===l.A.RequireStatusFailed?`${g}-${h}`:g,k={apiName:r,serviceName:a,duration:u,result:S,innerError:(0,d.u4)(y),correlationId:n,userAgent:t.navigator.userAgent,timestamp:s,operationLogs:(0,d.u4)(v),parameters:(0,d.u4)(p),ECT:t.navigator?.connection?.effectiveType,healthState:f},C=R(a,r);(0,c.P3)(o.x.Endpoint,C,k,void 0,void 0,void 0,b)}(t,e,k)}};function I(e){let t;return e instanceof Error&&(t=e.innerException?`${e.reason} / ${(0,d.u4)(e.innerException)}`:e.reason),t||e||""}function N(e,t){const n={};return t&&e.forEach((e=>{t[e]&&(n[e]=t[e])})),n}function E(e=""){if(!e)return e;let t=0;return e.split(",").forEach((e=>{const n=e.split("/");t+=+n[0]+ +n[1]})),`${t}`}function A(e,t){return t?{contentLength:t["content-length"]||"-1",serverRequestId:t.contextid||t["x-serverrequestid"]||t["request-id"]||D(t),[v]:M(e,t),requestId:t["x-ms-request-id"],invalidToken:t["x-invalid-token"],afdCorrelationId:t["x-msedge-ref"],serverLatency:t["x-end2endlatencyms"],serviceOrigin:t["x-servicering"],cafeLatency:E(t["x-cafeproxylatency"])}:{}}const _=(e,t,n,i,a,o,s)=>{const l=s||r.qb[i?.status]||"",c=function(e){const t={};if(e)for(const n of Object.keys(e.headers)){t[n.toLowerCase()]=e.headers[n]}return t}(i),{serviceName:d,apiName:u,method:m,authPerformanceLogs:p}=n;F(o,x(d,u,m),"SEND",{type:r.nz.Initial,duration:e,result:l,request:{name:u||"undefined",dateTime:t,method:n.method,hostname:i&&new URL(i.url).hostname,status:i?.status,requestHeaders:n.headers||{},responseHeaders:c,performance:a,authPerformanceLogs:p}},n.correlationId)};const F=({navigator:e},t,n,i,a)=>{const l=i.request;if(l){const{dateTime:u,method:m,hostname:p,status:g,requestHeaders:h,responseHeaders:y,performance:f,authPerformanceLogs:S}=l,C={ECT:e?.connection?.effectiveType,hostname:p,transport:n,requestCreatedTime:u.toISOString(),networkState:e.onLine?s.XR.ONLINE:s.XR.OFFLINE,method:m,resultCode:g,requestResult:I(i.result),contentLength:y["content-length"]||-1,serverRequestId:y.contextid||y["x-serverrequestid"]||y["request-id"]||D(y),correlationId:a,duration:i.duration,authPerformanceLogs:(0,d.u4)(S)};!function(e,t,n,i,a){const o=i&&i.clientRequestId,s=n["x-ms-request-id"]||i["x-ms-request-id"];e.requestId=s,o&&(e.clientRequestId=o);n["x-invalid-token"]&&(e.invalidToken=n["x-invalid-token"]);t!==r.qb.OK&&(e.afdCorrelationId=n["x-msedge-ref"]);e.hasClaims=!!a&&!!a.hasClaims}(C,g,y,h,S),C[v]=M(g,y),function(e,t,n){if(n){const i=n.domainLookupEnd-n.domainLookupStart,a=n.connectEnd-n.connectStart,o=n.redirectEnd-n.redirectStart;if(i>0&&(e.dns=i),a>0&&(e.tcp=a),o>0&&(e.redirect=o),e.size=n.transferSize,e.payload=n.encodedBodySize,e.start=n.startTime,e.reqStart=n.requestStart,e.respStart=n.responseStart,n.duration){const i=n.duration;(-1===t.userAgent.toLowerCase().indexOf(k)||e.duration&&i>e.duration)&&(e.duration=i)}}}(C,e,f),(0,c.P3)(o.x.Http,t,C,void 0,void 0,void 0,b)}};function D(e){let t=e[y.headers.sharePoint.SPRequestGuid.toLowerCase()]||"";return"[object String]"===Object.prototype.toString.call(t)&&t.length>0&&(t=[`${y.headers.sharePoint.SPRequestGuid}=${t}`,`${y.headers.sharePoint.SPClientServiceRequestDuration}=${e[y.headers.sharePoint.SPClientServiceRequestDuration.toLowerCase()]||""}`,`${y.headers.sharePoint.SPRequestDuration}=${e[y.headers.sharePoint.SPRequestDuration.toLowerCase()]||""}`].join(";")),t}function P(e){if(e){const{duration:t,domainLookupStart:n,domainLookupEnd:i,connectStart:a,connectEnd:o,redirectStart:r,redirectEnd:s,transferSize:l,encodedBodySize:c,startTime:d,requestStart:u,responseStart:m}=e;return{duration:t,dns:i-n,tcpHandshakeTime:o-a,redirectTime:s-r,transferSize:l,encodedBodySize:c,startTime:d,requestStart:u,responseStart:m}}return{}}function M(e,t){let n=C.None;if(t.hasOwnProperty(f)){const i=t[f];e===r.qb.NOT_MODIFIED?n=C.Browser:i.includes("no-store")||i.includes("no-cache")||(n=C.Browser,i.includes("public")&&(n+=", ".concat(C.Shared)))}else t.hasOwnProperty("expires")&&(n=C.Browser);if(t.hasOwnProperty(S)){t[S].toLowerCase().includes("hit")&&(n===C.None?n=C.CDN:n+=", ".concat(C.CDN))}return n}function x(e,t,n){return`${e}_${t||"undefined"}_${n}`}function R(e,t){return`${t}_${e}`}},864727:(e,t,n)=>{"use strict";n.d(t,{p:()=>s});var i=n(37718),a=n(702135),o=n(689626),r=n(431682);function s(e){return async t=>{try{return await e(t)}catch(e){if(e instanceof TypeError&&e.message?.toLowerCase()===r.gZ){const n=t.headers&&t.headers.cache;if(n&&-1!==n.indexOf("only-if-cached"))return{status:i.qb.GATEWAY_TIMEOUT};e=(0,a.Tr)(o.w5.RejectHttpError,o.jK.RemoteOperationFailed,"rejectHttpError",void 0,e.message)}throw e}}}},925894:(e,t,n)=>{"use strict";n.d(t,{Db:()=>m,tC:()=>p,j$:()=>g});var i=n(37718),a=n(683184),o=n(858273),r=n(793803);const s=10,l="",c=/\/api\/chatsvc\/.*?\//,d="teams.microsoft.com",u="teams.live.com";function m(e,t,n,a){let o=l;const c=a.newLogger("chat-service-redirect","core-services-transport");return a=>async d=>{let u=0;for(;;){h(o)&&(o=await g(t,n,c));const m=await(0,r.G)(e(a),o)({...d,headers:{...d.headers,BehaviorOverride:"redirectAs404"}}),{status:y,headers:{location:v}}=m;if(!v||y!==i.qb.NOT_FOUND)return y===i.qb.SERVICE_UNAVAILABLE||y===i.qb.BAD_GATEWAY?(o=l,m):m;if(u>=s)return m;if(o=p(v,c),o===l)return m;u+=1}}}function p(e,t){let n;try{n=new URL(e)}catch(n){return t.error(`Location header ${e} is invalid: error message ${n.message}`),l}if(n.hostname===d||n.hostname===u){const i=n.pathname.match(c);return i&&i[0]?`${n.origin}${i[0]}`:(t.error(`No match of chatServiceAfd 404 location with regex, url is ${e}`),l)}return t.log("Url is a ATM Url, use previous parsing strategy."),new URL("/",e).href}async function g(e,t,n){const{chatServiceHostOverrideUrl:i}=t.get(a.J.Test);if(i)return(r=i).endsWith("/")?r:`${r}/`;var r;if(function(e){return e.get(a.J.Host).enableUseChatServiceAfd??e.get(a.J.ChatService).useChatServiceAfd??void 0}(t))try{return await e("chatServiceAfd")}catch(t){if((0,o.B)(t))return n.warn("Flag useChatServiceAfd is set but chatServiceAfd was not found in the GTM table. Falling back to chatService."),e("chatService");throw t}return e("chatService")}function h(e){return e===l}},431682:(e,t,n)=>{"use strict";n.d(t,{EH:()=>i,gZ:()=>a,dX:()=>o});const i=3e4,a="failed to fetch",o="Request Timed Out"},193672:(e,t,n)=>{"use strict";n.d(t,{S:()=>r});var i=n(37718),a=n(702135),o=n(689626);function r(e){return async t=>{const n=await e(t);if(n.status>=i.qb.BAD_REQUEST)throw(0,a.Tr)(o.w5.RejectHttpError,o.jK.RemoteOperationFailed,"rejectHttpError",void 0,void 0,n);return n}}},877684:(e,t,n)=>{"use strict";n.d(t,{cZ:()=>f,Gg:()=>S,UZ:()=>v});var i=n(689626),a=n(559925),o=n(1489),r=n(873640),s=n(117020),l=n(142723),c=n(651572),d=n(359857),u=n(59083),m=n(307790),p=n(667470),g=n(565748);const h=([e,t])=>(t&&e.do((()=>{}),(e=>{throw e})),e),y=(e,t)=>{const n=e.pipe((0,r.R)(((e,n)=>e||!t(n)),!1)),i=e.pipe((0,s.P)(t),(0,l.V)(5e3));return(0,o.z)((0,c.i)(),(0,d.M)(n),(0,u.U)(h),(0,m.a)((e=>e.pipe((0,p.w)(i)))),(0,g.D)())};function v(e,t){return(...n)=>(0,a.P)((()=>e(...n))).pipe(y(t,k)).toPromise()}const f=e=>(e=>{switch(e){case i.eT.Disabled:case i.eT.Offline:return!1;default:return!0}})(e),S=e=>()=>f(e.getState()),k=e=>e},505935:(e,t,n)=>{"use strict";n.d(t,{s:()=>r,r:()=>s});var i=n(689626),a=n(677686),o=n(876934);function r(e,t){return n=>c((()=>e(n)),t)}function s(e,t){return n=>d(c((()=>e(n)),t),t)}const l=(e,t)=>{if(e.context===i.w5.RejectHttpError&&t.retryCount++<(t.policy.maxRetryCountForOffline||t.policy.maxRetryCount)&&t.policy.shouldRetryRejectHttpError)return t.policy.errorHandler(e,t);if(!e.serverResponse)throw e;const{serverResponse:{status:n}}=e;if(n&&t.retryCount++<t.policy.maxRetryCount&&t.policy.shouldRetry(n))return t.retriesTable[n]=(t.retriesTable[n]||0)+1,t.policy.errorHandler(e,t);throw e},c=(e,t)=>(0,a.X)(e,l)({policy:t,delay:t.createDelay(),retryCount:0,retriesTable:{}}),d=(e,t)=>(0,o.E)(e,t.retryMaxTimeMs)},303303:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var i=n(133598),a=n.n(i),o=n(876934),r=n(431682);const s=({url:e,method:t,body:n,headers:i,credentials:s,timeout:l=r.EH,skipHeaders:c=!1})=>{const d=new AbortController;return(0,o.E)(a()(e,{method:t,headers:c?{}:i&&new Headers(i),body:n,credentials:s,signal:d.signal}),l,r.dX,d).then((e=>{const t={};return e.headers.forEach(((e,n)=>t[n]=e)),{status:e.status,headers:t,body:e,url:e.url}}))}},382008:(e,t,n)=>{"use strict";n.d(t,{l:()=>s});var i=n(833990),a=n(780073);var o=n(303303),r=n(864727);const s=(0,i.E)(function(e){return async t=>{let i,o;const r=performance.now(),s=new Date;try{return o=await e(t),o}catch(e){throw i=e.code||e.message,o=e.serverResponse,e}finally{!function(e,t,i,o,r){const s=n.g;(0,a.Lk)(o,t,i,e,e&&function(e){const t=performance.getEntriesByName(e);if(t.length>0&&"resource"===t[t.length-1].entryType)return t[t.length-1];return}(e.url),s,r)}(o,s,t,performance.now()-r,i)}}}((0,r.p)(o.A)))},833189:(e,t,n)=>{"use strict";n.d(t,{mf:()=>i,Zz:()=>a,hh:()=>o,YM:()=>r});const i={Safari:11.1},a=11,o=11.1,r={chrome:">=60",chromium:">=60",edge:">=12",electron:">=2",firefox:">=52"}},263881:(e,t,n)=>{"use strict";n.d(t,{H$:()=>r,MB:()=>s,Qh:()=>l,L5:()=>c});var i=n(65733),a=n(833189),o=n(191366);function r(e=a.YM){return!!e&&!!d().satisfies(e)}function s(){return!u("ie")}function l(){return!!d().satisfies({safari:`>=${a.mf.Safari}`})}function c(){return u("safari")&&void 0===d().getBrowserVersion()}function d(){return i.getParser((0,o.J)().navigator.userAgent)}function u(e){return d().isBrowser(e,!0)}},287068:(e,t,n)=>{"use strict";n.d(t,{r:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataApolloClientTacoArchiveTeamInfoQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"archiveTeamResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"archiveSharepointSite"}}]}}]}}]}},491454:(e,t,n)=>{"use strict";n.d(t,{h$:()=>A,sE:()=>I,lx:()=>N,Do:()=>_,gi:()=>E,xB:()=>F});var i=n(367901);const a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]},o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageFieldsForDeletedMessages"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentHash"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"users"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"time"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}},{kind:"Field",name:{kind:"Name",value:"escalations"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"users"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"time"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"itemId"}},{kind:"Field",name:{kind:"Name",value:"userId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"mentionType"}}]}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"userHasSaved"}},{kind:"Field",name:{kind:"Name",value:"diagnosticInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"diagnosticErrorCode"}},{kind:"Field",name:{kind:"Name",value:"diagnosticMessage"}}]}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"baseUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"previewUrl"}},{kind:"Field",name:{kind:"Name",value:"previewHeight"}},{kind:"Field",name:{kind:"Name",value:"previewWidth"}}]}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"FragmentSpread",name:{kind:"Name",value:"deletionInfo"}}]}},...a.definitions]},r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"deletedMessages"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletedMessages"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"message"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"messageFieldsForDeletedMessages"}}]}}]}}]}},...o.definitions]};var s=n(225734);const l={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedReplyChainMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ReplyChainMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};s.l.definitions,l.definitions;var c=n(713050);const d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedMeetingReplyMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingReplyMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};c.y.definitions,d.definitions;var u=n(501616);const m={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedStandardPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StandardPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};u.w.definitions,m.definitions;var p=n(287751);const g={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedAnnouncementPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnnouncementPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};p.B.definitions,g.definitions;var h=n(99613);const y={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedEmailPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmailPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};h.E.definitions,y.definitions;var v=n(439887);const f={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedMeetingPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};v.l.definitions,f.definitions;var S=n(847203);const k={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedConnectorPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ConnectorPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};S.z.definitions,k.definitions;var C=n(270264);const b={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatDeletedGuardiansPostMessageFragment_deletionInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"GuardiansPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};C.N.definitions,b.definitions;var w=n(873644);const T="cacheDeletedMessages";function I(e,t){const{message:n}=P(e,t.id,t.clientMessageId,void 0,!t?.deleteTime),i=n&&n.message&&"Urgent"===n.message.importance;return{__typename:"DeletionInfo",showMessageAsDeleted:!!n,canBeUndeleted:!!n&&!i,deleteFailed:!1}}function N(e,t,n,i){try{const{message:a}=P(e,t,n,i);if(a){const{message:n}=a,i={...n,id:t},r=`Message:${t}`;return e.writeFragment({id:r,fragmentName:"messageFieldsForDeletedMessages",fragment:o,data:i}),i}}catch(e){i.errorToTelemetry?.(`Failed to recoverDeletedMessageInCache for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function E(e,t,n,i,o,r){const{fragment:s,fragmentName:c}=function(e){switch(e){case"Message":default:return{fragment:a,fragmentName:"deletionInfo"};case"ReplyChainMessage":return{fragment:l,fragmentName:"DataClientChatDeletedReplyChainMessageFragment_deletionInfo"};case"MeetingReplyMessage":return{fragment:d,fragmentName:"DataClientChatDeletedMeetingReplyMessageFragment_deletionInfo"};case"StandardPostMessage":return{fragment:m,fragmentName:"DataClientChatDeletedStandardPostMessageFragment_deletionInfo"};case"AnnouncementPostMessage":return{fragment:g,fragmentName:"DataClientChatDeletedAnnouncementPostMessageFragment_deletionInfo"};case"EmailPostMessage":return{fragment:y,fragmentName:"DataClientChatDeletedEmailPostMessageFragment_deletionInfo"};case"MeetingPostMessage":return{fragment:f,fragmentName:"DataClientChatDeletedMeetingPostMessageFragment_deletionInfo"};case"ConnectorPostMessage":return{fragment:k,fragmentName:"DataClientChatDeletedConnectorPostMessageFragment_deletionInfo"};case"GuardiansPostMessage":return{fragment:b,fragmentName:"DataClientChatDeletedGuardiansPostMessageFragment_deletionInfo"}}}(n),u=`${n}:${t}`;try{const a=e.readFragment({id:u,fragment:s,fragmentName:c});a&&e.writeFragment({id:u,fragment:s,data:{...a,id:t,deleteTime:r,deletionInfo:{__typename:"Message"===n?"DeletionInfo":"MessageDeletionInfo",showMessageAsDeleted:!1,canBeUndeleted:!1,deleteFailed:i},version:(0,w.MX)()[0].toString()}})}catch(e){o.errorToTelemetry?.(`Failed to updateCachedMessageForDelete for messageId: ${t}, fragmentName: ${c}, deleteFailed: ${i}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function A(e,t,n){let i=[];try{if(i=D(e,n),i.find((e=>e.id===t)))return;const a=`Message:${t}`,s=e.readFragment({id:a,fragment:o,fragmentName:"messageFieldsForDeletedMessages"}),l={...s,id:`${s.id}_deleted`},c={id:t,message:l,__typename:"DeletedMessage"};return i=[c,...i],e.writeQuery({query:r,data:{deletedMessages:i}}),c}catch(e){n.errorToTelemetry?.(`Failed to addDeletedMessageToCacheForUndelete for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function _(e,t,n,i){try{const a=D(e,i),{message:s,isDeletedLieMessage:l}=P(e,t,n,i,!1,a);if(s){const i=a.filter((e=>l?e.message?.clientMessageId!==n:e.id!==t)),c={...s.message,id:t,deletionInfo:{__typename:"DeletionInfo",showMessageAsDeleted:!1,canBeUndeleted:!1,deleteFailed:!1},version:(0,w.MX)()[0].toString(),__typename:"Message"};e.writeQuery({query:r,data:{deletedMessages:i}});const d=`Message:${t}`;return e.writeFragment({id:d,fragment:o,data:c}),c}}catch(e){i.errorToTelemetry?.(`Failed to removeDeletedMessageFromCacheForUndelete for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}function F(e,t,n,a){const o=i.Ps`
    fragment messageFieldsNeeded on Message {
      deleteTime
      importance
      deletionInfo {
        showMessageAsDeleted
        canBeUndeleted
        deleteFailed
      }
      version
    }
  `,r=`Message:${t}`;try{const t=e.readFragment({id:r,fragment:o});if(t){const i="Urgent"===t.importance;e.writeFragment({id:r,fragment:o,data:{deleteTime:n,importance:t.importance,deletionInfo:{__typename:"DeletionInfo",showMessageAsDeleted:!!n,canBeUndeleted:!!n&&!i,deleteFailed:!1},version:(0,w.MX)()[0].toString(),__typename:"Message"}})}}catch(e){a.errorToTelemetry?.(`Failed to updateCachedMessageForUndelete for messageId: ${t}`,"messaging_delete_message",{"Message.Id":t,operationType:T},!0)}}const D=(e,t)=>{let n;try{n=e.readQuery({query:r})}catch(e){t?.errorToTelemetry?.("Failed to queryDeletedMessages","messaging_delete_message",{operationType:T},!0)}return n&&n.deletedMessages||[]},P=(e,t,n,i,a,o)=>{const r={message:null,isDeletedLieMessage:!1};if(!(o=o||D(e,i))||0===o.length)return r;if(!a){const e=o.find((e=>e.id===t));if(e)return{message:e,isDeletedLieMessage:!1}}const s=o.find((e=>e.message&&e.message.clientMessageId===n));return s?{message:s,isDeletedLieMessage:!0}:r}},271061:(e,t,n)=>{"use strict";n.d(t,{C:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"dlpDialogData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dlpDialogData"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isReport"}},{kind:"Field",name:{kind:"Name",value:"isOverride"}},{kind:"Field",name:{kind:"Name",value:"justification"}}]}}]}}]}},68156:(e,t,n)=>{"use strict";n.d(t,{v:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"smartReplyFileSuggestion"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"smartReplyFileSuggestion"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fileName"}},{kind:"Field",name:{kind:"Name",value:"url"}}]}}]}}]}},858466:(e,t,n)=>{"use strict";n.d(t,{Om:()=>l,Ng:()=>c});var i=n(803238),a=n(683184);const o=[{predicate:e=>!!e.get(a.J.Presence).enablePresenceInWorker,resolvers:{query:["presence","presences"],mutation:["setPresence","setStatusNote","setCallStatePresence"],subscription:["presenceUpdateEvent","presenceUpdateEventBatch","presenceAvailabilityEvent"]}},{predicate:e=>!!e.get(a.J.Host).enableEspInWorker||!!e.get(a.J.Esp).enableEsp,resolvers:{query:["espState","irisCampaign"],mutation:["recordEligibleSurface","recordDisplayedSurface","recordEspCompletedActions","triggerNotificationDisplay","triggerTfwNotificationDisplay","recordIrisExternalTelemetry"],subscription:["espTriggerEvent","espSurfaceShownEvent","espSurfacesUpdateEvent"]}},{predicate:e=>!!e.get(a.J.Guardians).enableMembersAndRelatedContactsWorkerResolver,resolvers:{query:["membersAndRelatedContacts"],mutation:[],subscription:[]}},{predicate:e=>!!e.get(a.J.Guardians).enableRelatedContactsWorkerResolver,resolvers:{query:["relatedContacts"],mutation:[],subscription:[]}},{predicate:e=>!(!e.get(a.J.Host)?.enableHybridDiscoverSurface&&!e.get(a.J.DiscoverSurface)?.enableHybridDiscoverSurface),resolvers:{query:["feed"],mutation:["feedback","discoverSurfaceUserPreferenceForEntities","removeHasUpdatedItemsFlag","startPolling","stopPolling","userActionFeedbackLog","sendDiscoverFeedRenderAction","setLastVisitedSurface"],subscription:["replyChainSummaryEvent","discoverFeedHasUpdatedItems","feedEvent"]}},{predicate:e=>!!e.get(a.J.WhatsNew).enableWhatsNew,resolvers:{query:["whatsNewState"],mutation:["recordWhatsNewDisplayedFeature","recordWhatsNewEntryPointPromotion","recordWhatsNewEntryPointUserAction"],subscription:[]}},{predicate:e=>!!e.get(a.J.VirtualConsumerEvents).enableVirtualConsumerEvents,resolvers:{query:["virtualConsumerEvent","virtualConsumerEvents"],mutation:["createVirtualConsumerEvent","deleteVirtualConsumerEvent","editVirtualConsumerEvent"],subscription:[]}},{predicate:e=>!!e.get(a.J.People).enableBatchUsersByEmailsAndPhonesWorkerResolver,resolvers:{query:["batchUsersByEmailsAndPhones"],mutation:[],subscription:[]}}],r=[{predicate:e=>!!e.get(a.J.Host).enableOfflineActionsManager&&!!e.get(a.J.Host).msgEnableOfflineReactions,resolvers:{query:[],mutation:["updateMessageEmotion"],subscription:[]}},{predicate:e=>!!e.get(a.J.Messaging).msgEnableAutoSetConsumptionHorizonResolver,resolvers:{query:[],mutation:["setConsumptionHorizon"],subscription:[]}},{predicate:e=>!!e.get(a.J.Extensibility).enableAdaptiveAppletCacheFromCDL,resolvers:{query:[],mutation:["cardCacheOperation"],subscription:[]}}],s=()=>({query:[],mutation:[],subscription:[]});function l(e,t,n){const{experimentalResolvers:o,stableResolvers:l}=e.get(a.J.Cdl),c=l&&l.resolvers&&(0,i.pick)(l.resolvers,["query","mutation","subscription"])||s();if(t.log(`Supported operations from config: ${JSON.stringify(c,m)}`),l&&l.version&&o&&o.version&&l.version>=o.version){const e=o.resolvers&&(0,i.pick)(o.resolvers,["query","mutation","subscription"])||s();t.log(`Supported operations from ECS: ${JSON.stringify(e,m)}`),(0,i.mergeWith)(c,e,p)}g(c,r,e,t);const h=(0,i.mapValues)(c,(e=>e?new Set(e):new Set)),{dataLayerSettings:y}=e.get(a.J.Host),v=y&&(0,i.pick)(y,["query","mutation","subscription"]);return n?d(v,h,t,"Angular"):u(v,"supportedResolversFromMainWindow",h,"resolversFromConfiguration",t,"Angular")}function c(e,t,n,r){const l=function(e,t){let n;try{if(!t)throw new Error("CDL Worker did not return supported operations");n=JSON.parse(t)}catch(t){e.errorToTelemetry?.(`getWorkerSupportedOperations: Failed to set CDL Worker supported operations: ${t&&t.message}`,"cdl_worker_manager_get_worker_supported_operations_error",void 0,!0),n={query:[],mutation:[],subscription:[]}}const a=(0,i.mapValues)(n,(e=>e?new Set(e):new Set));return(0,i.pick)(a,["query","mutation","subscription"])}(t,n),{supportedResolvers:c,activitySupportedResolvers:m,mtmaMissedNotificationsSupportedResolvers:h,calendarSupportedResolvers:y,chatSupportedResolvers:v,chatPartiallySupportedResolvers:f,phonelinkSmsSupportedResolvers:S,appsUsageResolvers:k,tabsUsageResolvers:C,peopleTargetingSupportedResolvers:b,tflFeaturedCommunitiesSupportedResolvers:w}=e.get(a.J.CdlWorker),T=function(e){const t=s();return e.forEach((e=>e&&(0,i.mergeWith)(t,e,p))),t}([c,m,h,y,v,f,S,k,C,b,w]),I=(0,i.pick)(T,["query","mutation","subscription"]);return g(I,o,e,t),r?d(I,l,t,"Worker"):u(I,"resolversFromConfiguration",l,"supportedOperationsFromCDLWorker",t,"Worker")}function d(e,t,n,a){if(!e)return{query:new Set,mutation:new Set,subscription:new Set};n.log(`Supported operations received from ${a}: ${JSON.stringify(e,m)}`);const o=(0,i.mapValues)(e,((e,n)=>new Set(e.filter((e=>t[n]&&t[n].has(e))))));return n.log(`Merged datalayer settings with config: ${JSON.stringify(o,m)}`),o}function u(e,t,n,i,a,o){const r=function(e,t,n){const i={query:{},mutation:{},subscription:{}};return Object.keys(i).forEach((a=>{const o=e[a];if(o)for(const e of o)i[a][e]={fieldName:e,active:n,configurationDescription:t}})),i}(n,i,!1);return e?(Object.keys(e).forEach((n=>{if(!r[n])return;const i=e[n];if(i)for(const e of i){const i=r[n][e];i?i.active=!0:r[n][e]={fieldName:e,active:!1,configurationDescription:t}}})),function(e,t,n){const i={};Object.keys(t).forEach((e=>{const n=t[e];Object.keys(n).forEach((t=>{const a=n[t];if(!a.active){const t=a.configurationDescription;i[t]||(i[t]={query:[],mutation:[],subscription:[]}),i[t][e].push(a.fieldName)}}))})),Object.keys(i).forEach((t=>{const a=i[t],o=a.query,r=a.mutation,s=a.subscription;if(o.length>0||r.length>0||s.length>0){const i=`GraphQL Link for ${e}: ${t} has unsupported resolvers: query= ${o.length}, mutation=${r.length}, subscription=${s.length}.`;n.log(i)}}))}(o,r,a),r):(a.log(`No supported resolvers for ${o}`),r)}const m=(e,t)=>"object"==typeof t&&t instanceof Set?Array.from(t):t,p=(e,t)=>(0,i.isArray)(e)?e.concat(t):void 0;function g(e,t,n,a){const o=s();t.forEach((({predicate:e,resolvers:t})=>{e(n)&&(0,i.mergeWith)(o,t,p)})),a.log(`Supported additional operations: ${JSON.stringify(o,m)}`),(0,i.mergeWith)(e,o,p)}},90178:(e,t,n)=>{"use strict";n.d(t,{zz:()=>c,nG:()=>l,Fj:()=>d});var i=n(702135),a=n(689626),o=n(803238),r=n(906363);const s=(e,t)=>{let n=null;try{n=e.readQuery({query:r.gv.currentFilesQuery,variables:{fileContainerId:t}})}catch(e){}return n||(n={currentFiles:[]}),n.currentFiles},l=(e,t,n)=>s(n,t).find((t=>t.id===e)),c=(e,t,n)=>{const i={currentFiles:[...s(t,n).map((t=>{const n=e.findIndex((e=>e.id===t.id));if(-1===n)return t;const i=e[n];e.splice(n,1);return(0,o.merge)({},t,i)})),...e]};t.writeQuery({query:r.gv.currentFilesQuery,variables:{fileContainerId:n},data:i})},d=(e,t,n)=>{const o=s(n,t),l=o.find((t=>t.id===e));if(!l)throw(0,i.Tr)("FileUploadResolver",a.jK.NotPresent,"removecachefile",{logErrorMessage:`File with id: ${e} not found  in the cache`});const c=o.filter((t=>t.id!==e));return n.writeQuery({query:r.gv.currentFilesQuery,variables:{fileContainerId:t},data:{currentFiles:c}}),l}},60044:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"customAppUploadResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customAppUploadResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customAppType"}}]}}]}}]}},219395:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppDevicePermissionsUpdatedQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appDevicePermissionsUpdated"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"status"}}]}}]}}]}},162013:(e,t,n)=>{"use strict";n.d(t,{Q:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppsBadgeReadQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appsBadgeRead"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},749392:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformInContextStoreLaunchInstalledAppResultQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"inContextStoreLaunchInstalledAppResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"capability"}},{kind:"Field",name:{kind:"Name",value:"appDisplayName"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"botId"}},{kind:"Field",name:{kind:"Name",value:"appCommand"}}]}}]}}]}},352914:(e,t,n)=>{"use strict";n.d(t,{r:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformTabDeletionResultQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelMeetingMessageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tabDeletionResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"threadId"},value:{kind:"Variable",name:{kind:"Name",value:"threadId"}}},{kind:"Argument",name:{kind:"Name",value:"channelMeetingMessageId"},value:{kind:"Variable",name:{kind:"Name",value:"channelMeetingMessageId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"channelMeetingMessageId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}}]}}]}}]}},695920:(e,t,n)=>{"use strict";n.d(t,{F:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageExtensionsAppsState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageExtensionsAppsState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toggleRefetch"}}]}}]}}]}},205815:(e,t,n)=>{"use strict";n.d(t,{s:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"tabConfigurationResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"threadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tabConfigurationResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"threadId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"tabId"}}]}}]}}]}},622923:(e,t,n)=>{"use strict";n.d(t,{S:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webhookConfirmationResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webhookConfirmationResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},974286:(e,t,n)=>{"use strict";n.d(t,{w:()=>s});var i=n(827571),a=n(84562),o=n(803238);function r(e,t,n=!0,a){let r=[];try{if(a.enableDecoupleCommandingFromApollo)r=a.getActiveWindows();else{const n=e.readQuery({query:i.i8})?.activeWindows;n||t.errorToTelemetry?.("cache.readquery has returned undefined or null for activeWindowsQuery","webclient_framework_foundation_core_services_entity_commanding",void 0,!0),r=n||[]}}catch(e){t.errorToTelemetry?.("cache.readQuery failed for activeWindowsQuery","webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}return n?(0,o.cloneDeep)(r):r}const s=()=>({Query:{activeWindows:(e,t,{cache:n,loggerFactory:i,activeWindowsService:a})=>r(n,i.newLogger("activeWindows-query","data-client-windows"),!1,a)},Mutation:{removeWindow(e,{windowId:t},{cache:n,loggerFactory:o,commandChangeReportingService:s,activeWindowsService:l}){const c=o.newLogger("removeWindow-mutation","data-client-windows"),d=r(n,c,!0,l),u=d.findIndex((e=>e.id===t));if(u>=0){const e=function(e,t,n,a){const o=e.splice(t,1);return a.enableDecoupleCommandingFromApollo?a.removeActiveWindowById(o[0].id):n.writeQuery({query:i.i8,data:{activeWindows:e}}),o[0]}(d,u,n,l);return s.report({type:a.B.Close,correlationId:e.correlation.id,context:{target:"remove-window-mutation"},userContextId:e.userContextId||void 0}),e}return c.warn(`Removing window that does not exist ${t}`),null}}})},958434:(e,t,n)=>{"use strict";n.d(t,{k:()=>a});var i=n(827571);function a(e){e.writeQuery({query:i.i8,data:{activeWindows:[]}})}},921627:(e,t,n)=>{"use strict";n.d(t,{_:()=>a});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"sdnFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SDNDetails"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"playbackInfo"}},{kind:"Field",name:{kind:"Name",value:"pluginUrl"}},{kind:"Field",name:{kind:"Name",value:"sdkUrl"}}]}}]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"broadcastFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Broadcast"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"admissionType"}},{kind:"Field",name:{kind:"Name",value:"userRole"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"streamingDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"streamingDetailsFields"}}]}},{kind:"Field",name:{kind:"Name",value:"qna"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}},{kind:"Field",name:{kind:"Name",value:"attendeeUrl"}},{kind:"Field",name:{kind:"Name",value:"moderatorUrl"}},{kind:"Field",name:{kind:"Name",value:"iosAutodiscoverUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"yammer"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}},{kind:"Field",name:{kind:"Name",value:"broadcastId"}},{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"eventUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"meetingStatus"}},{kind:"Field",name:{kind:"Name",value:"sdn"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"sdnFields"}}]}},{kind:"Field",name:{kind:"Name",value:"transcription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}},{kind:"Field",name:{kind:"Name",value:"isSuppressed"}},{kind:"Field",name:{kind:"Name",value:"transcriptionLanguage"}},{kind:"Field",name:{kind:"Name",value:"translationLanguages"}},{kind:"Field",name:{kind:"Name",value:"captionsCacheUrl"}},{kind:"Field",name:{kind:"Name",value:"captionsOriginUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"aesKey"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"iv"}},{kind:"Field",name:{kind:"Name",value:"expiry"}},{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"aesKeyRefresh"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"errorFields"}}]}},{kind:"Field",name:{kind:"Name",value:"utcStart"}},{kind:"Field",name:{kind:"Name",value:"utcEnd"}},{kind:"Field",name:{kind:"Name",value:"location"}},{kind:"Field",name:{kind:"Name",value:"supportUrl"}},{kind:"Field",name:{kind:"Name",value:"streamResource"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attendeeEmbed"}}]}},{kind:"Field",name:{kind:"Name",value:"signalR"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attendeeHubName"}},{kind:"Field",name:{kind:"Name",value:"eventTeamHubName"}},{kind:"Field",name:{kind:"Name",value:"setCookieUrl"}},{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"querystrings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"joinid"}},{kind:"Field",name:{kind:"Name",value:"msgid"}},{kind:"Field",name:{kind:"Name",value:"organizerid"}},{kind:"Field",name:{kind:"Name",value:"tenantid"}},{kind:"Field",name:{kind:"Name",value:"threadid"}},{kind:"Field",name:{kind:"Name",value:"uid"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"broadcastRestartVersion"}},{kind:"Field",name:{kind:"Name",value:"odspVodShareUrl"}},{kind:"Field",name:{kind:"Name",value:"access"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attendeeAuthorization"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"details"}},{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"subCode"}}]}},{kind:"Field",name:{kind:"Name",value:"disableLobby"}},{kind:"Field",name:{kind:"Name",value:"inInvitation"}},{kind:"Field",name:{kind:"Name",value:"useLiveEventAuthorizationV2"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"streamingDetailsFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BroadcastStreamingDetails"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"stream"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"streamFields"}}]}},{kind:"Field",name:{kind:"Name",value:"altStream"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"streamFields"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"streamFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BroadcastStreamingInfo"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"wamsStreamingUrl"}},{kind:"Field",name:{kind:"Name",value:"wamsHlsStreamingUrls"}},{kind:"Field",name:{kind:"Name",value:"decryptionToken"}},{kind:"Field",name:{kind:"Name",value:"decryptionKey"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"decryptionKeyFields"}}]}},{kind:"Field",name:{kind:"Name",value:"keyAuthorizationToken"}},{kind:"Field",name:{kind:"Name",value:"setKeyAuthorizationCookieUri"}},{kind:"Field",name:{kind:"Name",value:"sdn"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"sdnFields"}}]}},{kind:"Field",name:{kind:"Name",value:"deliveryPipelineType"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"decryptionKeyFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StreamDecryptionKey"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}.definitions,...i.definitions]}.definitions]}.definitions,...i.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"errorFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"BroadcastErrorDetails"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"errorMessage"}},{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"errorSubCode"}}]}}]}.definitions]}},963469:(e,t,n)=>{"use strict";n.d(t,{f:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonActivitiesConnectionFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivitiesConnection"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"workerResponseTime"}},{kind:"Field",name:{kind:"Name",value:"workerExitTimestamp"}},{kind:"Field",name:{kind:"Name",value:"deletedActivityInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"deletedActivityIds"}}]}},{kind:"Field",name:{kind:"Name",value:"isActivityTranslated"}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},...n(736147).q.definitions]}},736147:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FeedActivity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isRead"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"icon"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"titleParams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DefaultFeedLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"count"}},{kind:"Field",name:{kind:"Name",value:"isTranslated"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChannelFeedTitleLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"mentionName"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommunitiesFeedTitleLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"communityName"}},{kind:"Field",name:{kind:"Name",value:"userNickname"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"translatedTitle"}},{kind:"Field",name:{kind:"Name",value:"translatedTimestamp"}},{kind:"Field",name:{kind:"Name",value:"translatedLocation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"ignoreInSearch"}}]}},{kind:"Field",name:{kind:"Name",value:"translatedMessagePreview"}},{kind:"Field",name:{kind:"Name",value:"actorAriaLabel"}},{kind:"Field",name:{kind:"Name",value:"actorDisplayName"}},{kind:"Field",name:{kind:"Name",value:"location"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"ignoreInSearch"}},{kind:"Field",name:{kind:"Name",value:"isTranslated"}}]}},{kind:"Field",name:{kind:"Name",value:"locationParams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"DefaultFeedLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChannelFeedLocationLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"channelName"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CommunitiesFeedLocationLocaleParams"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"communityName"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"messagePreview"}},{kind:"Field",name:{kind:"Name",value:"messagePreviewTemplateOption"}},{kind:"Field",name:{kind:"Name",value:"workerProcessingCompleteTimeStamp"}},{kind:"Field",name:{kind:"Name",value:"activity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activityId"}},{kind:"Field",name:{kind:"Name",value:"activityType"}},{kind:"Field",name:{kind:"Name",value:"activitySubtype"}},{kind:"Field",name:{kind:"Name",value:"threadType"}},{kind:"Field",name:{kind:"Name",value:"sourceMessageId"}},{kind:"Field",name:{kind:"Name",value:"sourceUserImDisplayName"}},{kind:"Field",name:{kind:"Name",value:"activityProcessingLatency"}},{kind:"Field",name:{kind:"Name",value:"webhookCorrelationId"}},{kind:"Field",name:{kind:"Name",value:"teamsAppId"}},{kind:"Field",name:{kind:"Name",value:"appName"}}]}},{kind:"Field",name:{kind:"Name",value:"activityNavigationParams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"replyChainId"}},{kind:"Field",name:{kind:"Name",value:"navigationTarget"}},{kind:"Field",name:{kind:"Name",value:"campaignType"}},{kind:"Field",name:{kind:"Name",value:"deeplinkUrl"}},{kind:"Field",name:{kind:"Name",value:"customParams"}}]}},{kind:"Field",name:{kind:"Name",value:"analytics"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamId"}}]}},{kind:"Field",name:{kind:"Name",value:"supportedActions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"isDivided"}}]}},{kind:"Field",name:{kind:"Name",value:"user"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment_user"}}]}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"isUnknownUser"}},{kind:"Field",name:{kind:"Name",value:"activityCustomProps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"customIconUrl"}},{kind:"Field",name:{kind:"Name",value:"customAvatarMedia"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"avatarMediaType"}},{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"square"}},{kind:"Field",name:{kind:"Name",value:"hidePersonaCard"}},{kind:"Field",name:{kind:"Name",value:"team"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"badgeType"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonActivityFeedFragment_user"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"userType"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"enableAvatarUrlResolutionInActivityFeeds"}}}]}]},{kind:"Field",name:{kind:"Name",value:"givenName"}},{kind:"Field",name:{kind:"Name",value:"surname"}},{kind:"Field",name:{kind:"Name",value:"profileType"}},{kind:"Field",name:{kind:"Name",value:"mtoLabel"}}]}}]}.definitions]}},287751:(e,t,n)=>{"use strict";n.d(t,{B:()=>p});var i=n(780920),a=n(903418),o=n(902692),r=n(325549),s=n(757737),l=n(789555),c=n(275252),d=n(461024),u=n(109272),m=n(488980);const p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonAnnouncementPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnnouncementPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"announcement"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"originalImageUrl"}},{kind:"Field",name:{kind:"Name",value:"croppedImageUrl"}},{kind:"Field",name:{kind:"Name",value:"colorTheme"}},{kind:"Field",name:{kind:"Name",value:"croppedImageHeight"}},{kind:"Field",name:{kind:"Name",value:"croppedImageWidth"}},{kind:"Field",name:{kind:"Name",value:"croppedImageAltText"}},{kind:"Field",name:{kind:"Name",value:"isTeamsIllustration"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"meeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}}]}},...i.U.definitions,...a.w.definitions,...o.M.definitions,...r.p.definitions,...s.S.definitions,...l.v.definitions,...c.w.definitions,...d.x.definitions,...u.I.definitions,...m.M.definitions]}},298433:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonChannelListChannelFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Channel"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"archivalLevel"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"explicitlyAdded"}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}},{kind:"Field",name:{kind:"Name",value:"isShown"}},{kind:"Field",name:{kind:"Name",value:"isShownByDefault"}},{kind:"Field",name:{kind:"Name",value:"isGeneral"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"isLie"}},{kind:"Field",name:{kind:"Name",value:"realThreadId"}},{kind:"Field",name:{kind:"Name",value:"isCreationFailed"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"isNewForUser"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"isUserMember"}},{kind:"Field",name:{kind:"Name",value:"hasBookmark"}},{kind:"Field",name:{kind:"Name",value:"unreadMessageCount"}},{kind:"Field",name:{kind:"Name",value:"createdAt"}},{kind:"Field",name:{kind:"Name",value:"channelResourceTenantId"}},{kind:"Field",name:{kind:"Name",value:"areWorkflowsEnabled"}},{kind:"Field",name:{kind:"Name",value:"parentTeamId"}},{kind:"Field",name:{kind:"Name",value:"isSharedWithParentTeam"}},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Channel"}},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activityCount"}},{kind:"Field",name:{kind:"Name",value:"hasChannelMention"}},{kind:"Field",name:{kind:"Name",value:"hasTeamMention"}}]}}]}}]}},430641:(e,t,n)=>{"use strict";n.d(t,{K:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonChannelListTeamFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Team"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelOnlyMember"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"dynamicMembership"}},{kind:"Field",name:{kind:"Name",value:"hasNewHiddenChannels"}},{kind:"Field",name:{kind:"Name",value:"hiddenChannelsCount"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"isCollapsed"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}},{kind:"Field",name:{kind:"Name",value:"isFavorite"}},{kind:"Field",name:{kind:"Name",value:"isUserMember"}},{kind:"Field",name:{kind:"Name",value:"isTenantWide"}},{kind:"Field",name:{kind:"Name",value:"isNewForUser"}},{kind:"Field",name:{kind:"Name",value:"lastJoinAt"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"pictureETag"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"teamGuestSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}},{kind:"Field",name:{kind:"Name",value:"deleteChannel"}}]}},{kind:"Field",name:{kind:"Name",value:"teamSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}},{kind:"Field",name:{kind:"Name",value:"deleteChannel"}},{kind:"Field",name:{kind:"Name",value:"updateConnectors"}}]}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"visibility"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Team"}},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalActivityCount"}},{kind:"Field",name:{kind:"Name",value:"hasChannelMention"}},{kind:"Field",name:{kind:"Name",value:"hasTeamMention"}}]}},{kind:"Field",name:{kind:"Name",value:"shouldShowHideTeamOnChannelShowHide"}}]}}]}},333204:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MissedActivityOfConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"activityId"}},{kind:"Field",name:{kind:"Name",value:"icon"}},{kind:"Field",name:{kind:"Name",value:"sourceMessageId"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}},99613:(e,t,n)=>{"use strict";n.d(t,{E:()=>p});var i=n(780920),a=n(903418),o=n(902692),r=n(325549),s=n(757737);const l={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmailDetails"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"from"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment_emailUser"}}]}},{kind:"Field",name:{kind:"Name",value:"sender"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment_emailUser"}}]}},{kind:"Field",name:{kind:"Name",value:"to"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment_emailUser"}}]}},{kind:"Field",name:{kind:"Name",value:"cc"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment_emailUser"}}]}},{kind:"Field",name:{kind:"Name",value:"emailLink"}},{kind:"Field",name:{kind:"Name",value:"totalRecipients"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment_emailUser"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmailUser"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"smtp"}}]}}]}.definitions]};var c=n(789555),d=n(275252),u=n(461024),m=n(109272);const p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonEmailPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmailPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"emailDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonEmailDetailsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}}]}},...i.U.definitions,...a.w.definitions,...o.M.definitions,...r.p.definitions,...s.S.definitions,...l.definitions,...c.v.definitions,...d.w.definitions,...u.x.definitions,...m.I.definitions]}},488980:(e,t,n)=>{"use strict";n.d(t,{M:()=>i});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Meeting"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"itemId"}},{kind:"Field",name:{kind:"Name",value:"meetingTitle"}},{kind:"Field",name:{kind:"Name",value:"meetingActionType"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"organizerId"}},{kind:"Field",name:{kind:"Name",value:"meetingJoinUrl"}},{kind:"Field",name:{kind:"Name",value:"location"}},{kind:"Field",name:{kind:"Name",value:"scheduledMeetingInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment_scheduledMeetingInfo"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment_scheduledMeetingInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ScheduledMeetingInfo"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startTime"}},{kind:"Field",name:{kind:"Name",value:"endTime"}},{kind:"Field",name:{kind:"Name",value:"exchangeId"}},{kind:"Field",name:{kind:"Name",value:"iCalUID"}},{kind:"Field",name:{kind:"Name",value:"isCancelled"}},{kind:"Field",name:{kind:"Name",value:"eventType"}},{kind:"Field",name:{kind:"Name",value:"eventRecurrenceRange"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startDate"}},{kind:"Field",name:{kind:"Name",value:"endDate"}}]}},{kind:"Field",name:{kind:"Name",value:"eventRecurrencePattern"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patternType"}},{kind:"Field",name:{kind:"Name",value:"daily"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"interval"}}]}},{kind:"Field",name:{kind:"Name",value:"weekly"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"daysOfTheWeek"}},{kind:"Field",name:{kind:"Name",value:"interval"}}]}},{kind:"Field",name:{kind:"Name",value:"monthly"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dayOfMonth"}},{kind:"Field",name:{kind:"Name",value:"interval"}}]}},{kind:"Field",name:{kind:"Name",value:"relativeMonthly"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dayOfTheWeekIndex"}},{kind:"Field",name:{kind:"Name",value:"dayOfTheWeek"}},{kind:"Field",name:{kind:"Name",value:"interval"}}]}},{kind:"Field",name:{kind:"Name",value:"yearly"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"month"}},{kind:"Field",name:{kind:"Name",value:"dayOfTheMonth"}}]}},{kind:"Field",name:{kind:"Name",value:"relativeYearly"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"month"}},{kind:"Field",name:{kind:"Name",value:"dayOfTheWeekIndex"}},{kind:"Field",name:{kind:"Name",value:"dayOfTheWeek"}}]}}]}}]}}]}.definitions]}},439887:(e,t,n)=>{"use strict";n.d(t,{l:()=>p});var i=n(903418),a=n(902692),o=n(325549),r=n(757737),s=n(780920),l=n(488980),c=n(789555),d=n(275252),u=n(461024),m=n(109272);const p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonMeetingPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"meeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}}]}},...i.w.definitions,...a.M.definitions,...o.p.definitions,...r.S.definitions,...s.U.definitions,...l.M.definitions,...c.v.definitions,...d.w.definitions,...u.x.definitions,...m.I.definitions]}},713050:(e,t,n)=>{"use strict";n.d(t,{y:()=>p});var i=n(902692),a=n(325549),o=n(757737),r=n(903418),s=n(789555),l=n(275252),c=n(780920),d=n(488980),u=n(461024),m=n(109272);const p={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonMeetingReplyMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingReplyMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"isImportant"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"meeting"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonMeetingFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"attached"}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}}]}},...i.M.definitions,...a.p.definitions,...o.S.definitions,...r.w.definitions,...s.v.definitions,...l.w.definitions,...c.U.definitions,...d.M.definitions,...u.x.definitions,...m.I.definitions]}},225734:(e,t,n)=>{"use strict";n.d(t,{l:()=>m});var i=n(780920),a=n(902692),o=n(325549),r=n(757737),s=n(903418),l=n(789555),c=n(275252),d=n(109272),u=n(461024);const m={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonReplyMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ReplyChainMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}},{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"isImportant"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"attached"}},{kind:"Field",name:{kind:"Name",value:"urlPreview"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"previewEnabled"}},{kind:"Field",name:{kind:"Name",value:"thumbnail"}},{kind:"Field",name:{kind:"Name",value:"thumbnailMeta"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}}]}},...i.U.definitions,...a.M.definitions,...o.p.definitions,...r.S.definitions,...s.w.definitions,...l.v.definitions,...c.w.definitions,...d.I.definitions,...u.x.definitions]}},501616:(e,t,n)=>{"use strict";n.d(t,{w:()=>m});var i=n(780920),a=n(903418),o=n(902692),r=n(325549),s=n(757737),l=n(789555),c=n(275252),d=n(109272),u=n(461024);const m={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataFragmentsCommonStandardPostMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"StandardPostMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"editTime"}},{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"Field",name:{kind:"Name",value:"isDeletedByAdmin"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"files"}}]}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"mentions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"diverseEmotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonDiverseEmotionsFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"emotions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotions"}}]}},{kind:"Field",name:{kind:"Name",value:"emotionsSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"emotionsSummary"}}]}},{kind:"Field",name:{kind:"Name",value:"subject"}},{kind:"Field",name:{kind:"Name",value:"isPinned"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"card"}}]}},{kind:"Field",name:{kind:"Name",value:"atpSharepointData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonAtpSharepointDataFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"isLastRead"}},{kind:"Field",name:{kind:"Name",value:"isTimestampDividerNeeded"}},{kind:"Field",name:{kind:"Name",value:"isCrossPost"}},{kind:"Field",name:{kind:"Name",value:"crossPostId"}},{kind:"Field",name:{kind:"Name",value:"crossPostStatus"}},{kind:"Field",name:{kind:"Name",value:"crossPostFailedChannels"}},{kind:"Field",name:{kind:"Name",value:"postType"}},{kind:"Field",name:{kind:"Name",value:"urlPreview"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"url"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"previewEnabled"}},{kind:"Field",name:{kind:"Name",value:"thumbnail"}},{kind:"Field",name:{kind:"Name",value:"thumbnailMeta"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"deeplinks"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"channelId"}},{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"serverRelativeUrl"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}},{kind:"Field",name:{kind:"Name",value:"dlpContext"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"dlpContext"}}]}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"translation"}}]}},{kind:"Field",name:{kind:"Name",value:"hardDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"hardDeleteTime"}},{kind:"Field",name:{kind:"Name",value:"onBehalfOf"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"mentions"}}]}},{kind:"Field",name:{kind:"Name",value:"messageRenderType"}},{kind:"Field",name:{kind:"Name",value:"replyPermission"}},{kind:"Field",name:{kind:"Name",value:"canUserReply"}},{kind:"Field",name:{kind:"Name",value:"translationStatus"}},{kind:"Field",name:{kind:"Name",value:"softDeleteReason"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"deletionInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showMessageAsDeleted"}},{kind:"Field",name:{kind:"Name",value:"canBeUndeleted"}},{kind:"Field",name:{kind:"Name",value:"deleteFailed"}}]}},{kind:"Field",name:{kind:"Name",value:"fromUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"isUserFollowing"}}]}},...i.U.definitions,...a.w.definitions,...o.M.definitions,...r.p.definitions,...s.S.definitions,...l.v.definitions,...c.w.definitions,...d.I.definitions,...u.x.definitions]}},676518:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});const i={M365Application:["M365HubApplication","M365PlatformApplication"],M365Link:["M365PlatformLink"],M365ApplicationIcon:["InternalIcon","RemoteImage"],M365ApplicationsUpdated:["M365ApplicationsBadgeUpdated","M365ApplicationsConnectionUpdated"],M365ApplicationBadge:["M365ApplicationNumericBadge","M365ApplicationDotBadge","M365ApplicationStringBadge"],EventTrigger:["AppAcquisitionLink","AppSecondaryAction"],Node:["M365HubApplication","M365PlatformApplication","M365PlatformLink","Conversation","Me","FullAccount","Cloud","ActiveTenant","InactiveTenant","MeInOtherTenant","Person","MePresence","PersonPresence","AvailabilityOption"],ConnectionEdge:["M365ApplicationEdge","AccountEdge","TenantEdge","M365LinkEdge"],ConnectionEdgeWithCursorPagination:[],Connection:["M365ApplicationConnection","M365LinkConnection","AccountConnection","TenantConnection"],ConnectionWithCursorPagination:[],MutationFailure:["PresenceMutationFailure","PresenceMutationFailureNetworkOffline"],BaseAccount:["FullAccount","Cloud"],Account:["FullAccount","Cloud"],Tenant:["ActiveTenant","InactiveTenant"],BaseTenant:["ActiveTenant","InactiveTenant"],Persona:["Me","MeInOtherTenant","Person"],Individual:["Me","MeInOtherTenant","Person"],Presence:["MePresence","PersonPresence"],PresenceExpiry:["PresenceExpiryPreDefined","PresenceExpiryCustom"],PresenceMutationResult:["PresenceMutationSuccess","PresenceMutationFailure","PresenceMutationFailureNetworkOffline"]}},82523:(e,t,n)=>{"use strict";n.d(t,{wf:()=>$,s_:()=>O});const i=e=>e&&!!e.wamsStreamingUrl&&!!e.decryptionToken,a=(e,t,n)=>({__typename:"Broadcast",id:e,admissionType:n.admissionType,type:t?"Overflow":"QuickStart",userRole:n.userRole||"Attendee",correlationId:n.correlationId,title:n.subject,utcStart:n.utcStart||null,utcEnd:n.utcEnd||null,location:n.location||null,streamingDetails:s(e,n),qna:{...n.qna,isEnabled:n.qna?.isEnabled||!1,attendeeUrl:n.qna?.attendeeUrl||"",moderatorUrl:n.qna?.moderatorUrl||"",iosAutodiscoverUrl:n.qna?.iosAutodiscoverUrl||"",__typename:"BroadcastQnaMetadata"},yammer:n.yammer&&{__typename:"BroadcastYammerMetadata",broadcastId:n.yammer.broadcastId,groupId:n.yammer.groupId,isEnabled:n.yammer.isEnabled,eventUrl:n.yammer.event}||null,meetingStatus:n.meetingStatus||(i(n.stream)||i(n.altStream)?"Live":"Created"),supportUrl:n.supportUrl,sdn:c(n)||null,transcription:u(e,n),aesKey:{__typename:"AESKey",...m(n)},aesKeyRefresh:n.aesKeyRefresh,error:n.error||null,signalR:{__typename:"SignalRDetails",...p(n)},streamResource:g(n),broadcastRestartVersion:n.broadcastRestartVersion||0,odspVodShareUrl:n.odspVodShareUrl||null,access:h(n),byoe:n?.byoe||null}),o=e=>({__typename:"BroadcastAttendeeStream",wamsStreamingUrl:e?.wamsStreamingUrl,decryptionToken:e?.decryptionToken}),r=e=>({__typename:"BroadcastStreamingInfo",wamsStreamingUrl:e?.wamsStreamingUrl||null,wamsHlsStreamingUrls:null,decryptionToken:e?.decryptionToken||null,decryptionKey:{key:null,value:null},setKeyAuthorizationCookieUri:null,keyAuthorizationToken:null,sdn:l(e)||null,deliveryPipelineType:"AMS"}),s=(e,t)=>({__typename:"BroadcastStreamingDetails",id:e,stream:r(t.stream),altStream:r(t.altStream)}),l=e=>e&&e.sdnName&&e.sdnPluginUrl&&{__typename:"SDNDetails",name:e.sdnName,playbackInfo:e.sdnPlaybackInfo||"",pluginUrl:e.sdnPluginUrl,sdkUrl:""}||void 0,c=e=>e.stream&&l(e.stream)||e.altStream&&l(e.altStream),d=e=>e/1e3,u=(e,t)=>({__typename:"BroadcastTranscription",id:e,isEnabled:t.transcription?.isEnabled,isSuppressed:t.transcription?.isSuppressed,translationLanguages:t.transcription?.translationLanguages,transcriptionLanguage:t.transcription?.transcriptionLanguage,captionsOriginUrl:t.transcription?.captionsOriginUrl,captionsCacheUrl:t.transcription?.captionsCacheUrl}),m=e=>({id:e.aesKey?.id||"",iv:e.aesKey?.iv||"",expiry:e.aesKey?.expiry||"",key:e.aesKey?.key||""}),p=e=>({attendeeHubName:e?.signalR?.attendeeHubName||null,eventTeamHubName:e?.signalR?.eventTeamHubName||null,url:e?.signalR?.url||null,querystrings:e?.signalR?.querystrings||null,setCookieUrl:e?.signalR?.setCookieUrl||null}),g=e=>({__typename:"StreamResource",attendeeEmbed:e.streamResource?.attendeeEmbed||"",encoderSource:e.streamResource?.encoderSource||null}),h=e=>e?.access&&{__typename:"BroadcastAccess",useLiveEventAuthorizationV2:e?.access?.useLiveEventAuthorizationV2,disableLobby:e?.access?.disableLobby,inInvitation:e?.access?.inInvitation,attendeeAuthorization:y(e)}||void 0,y=e=>e?.access?.attendeeAuthorization&&{__typename:"BroadcastAttendeeAuthorization",errorCode:e.access.attendeeAuthorization.errorCode,subCode:e.access.attendeeAuthorization.subCode,details:e.access.attendeeAuthorization.details}||void 0;const v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"broadcast"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"roleHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"broadcast"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"roleHint"},value:{kind:"Variable",name:{kind:"Name",value:"roleHint"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"broadcastFragment"}}]}}]}},...n(921627)._.definitions]},f={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showInMeetingReport"}}]}}]}}]};var S=n(420250),k=n(543491),C=n(839860),b=n(702135);const w=e=>{const[t,n,i,a,o]=e.split("__");return{tenantId:t,organizerId:n,threadId:i,messageId:a,sessionId:o,roleHint:"Attendee"}},T=async(e,t,n,i,o,r)=>{try{const s=(0,C.G5)(t),l=e.readQuery({query:v,variables:{id:s}});if(l)return l.broadcast;{const l=await n.getAttendeeMeeting(i),c=a(t,o,l);return I(e,r,s,c),c}}catch(e){throw r.error(e),e}},I=(e,t,n,i)=>{const a={broadcast:i};try{e.writeQuery({query:v,variables:{id:n},data:a})}catch(e){t.error(e)}},N=async(e,t,n,i,a,o,r,s,l,c,d)=>{if(E(e))return!1;const u=A(r,i,a,l,s,c),m=x(i,n);o.joinId=e?.signalR?.querystrings?.joinid;const p=R(i,o,n,u,s,r,a,e.meetingStatus);try{const r=!a||d;return e.signalR&&e.signalR.url&&!e.error&&r?(await t.subscribeToBroadcast(i,e.signalR,u,m,p),!0):!e.error&&(n.startPollingAttendeeMeeting(i,o,u,e.meetingStatus,!0),!0)}catch(t){return s.error(t),n.startPollingAttendeeMeeting(i,o,u,e.meetingStatus,!0),!0}},E=e=>"Stopped"===e.meetingStatus&&e.streamingDetails?.stream.wamsStreamingUrl,A=(e,t,n,i,o,r)=>(l,c)=>{const d=_(r,t);let m="",p="";try{const r=(0,C.G5)(t),g=i.readQuery({query:v,variables:{id:r}}),h=g?.broadcast;let y;if(h)if(y={...h},c===S.N.transcriptionStateUpdate)y.transcription=u(t,l),m="SignalR",p=S.N.transcriptionStateUpdate;else if(c===S.N.streamUpdateHubEvent){const e=s(t,l);if(F(e,h.streamingDetails))return void d.stop({broadcastData:"Duplicated update skipped"});y.streamingDetails=D(h,e),y.broadcastRestartVersion=l.broadcastRestartVersion,y.meetingStatus=P(h.broadcastRestartVersion,l.broadcastRestartVersion),m="SignalR",p=S.N.streamUpdateHubEvent}else y={...a(t,n,l)},m="Attendee Polling";else y={...a(t,n,l)};const f=M(y);o.log(f),d.stop({broadcastData:JSON.stringify({updateSource:m,updateType:p,details:f})}),e.publish(`${S.V}-${t}`,{broadcastUpdatedEvent:y}),o.log(`New broadcast info successfully published for ${t}`),I(i,o,r,y)}catch(e){o.error(e),d.fail({broadcastData:`Error while processing broadcast update. updateSource: ${m}, updateType: ${p}`,broadcastError:e&&e.message})}},_=(e,t)=>{const n=e.newScenario(k.RG.BroadcastSubscriptionUpdate);return n.appendEventData({"Thread.Id":(0,C.G5)(t)}),n},F=(e,t)=>e?.stream.wamsStreamingUrl===t?.stream.wamsStreamingUrl&&e?.altStream.wamsStreamingUrl===t?.altStream.wamsStreamingUrl,D=(e,t)=>({__typename:"BroadcastStreamingDetails",stream:t?.stream||e.streamingDetails?.stream,altStream:t?.altStream||e.streamingDetails?.altStream,id:t?.id||e.streamingDetails?.id}),P=(e,t)=>(t=t||0)>(e=e||0)?"Suspended":"Created",M=e=>{const t=e.broadcastRestartVersion,n=e.meetingStatus,i=e.streamingDetails?.stream?.wamsStreamingUrl,a=!!e.streamingDetails?.stream?.decryptionToken,o=e.streamingDetails?.altStream?.wamsStreamingUrl,r=!!e.streamingDetails?.altStream?.decryptionToken,s=e.transcription,l=s?.isEnabled,c=s?.isSuppressed;return`broadcastRestartVersion: ${t}, meetingStatus: ${n}, stream: ${i}, isDecryptionTokenAvailable: ${a}, altStream: ${o}, isAltDecryptionTokenAvailable: ${r}, isTranscriptionEnabled: ${l}, isTranscriptionSuppressed: ${c}`},x=(e,t)=>()=>{t.stopPollingAttendeeMeeting(e)},R=(e,t,n,i,a,o,r,s)=>l=>{if(!l){a.log("broadcast-subscripotion disconnect callback called not intentionally. Subscribing to attendee service polling.");try{n.startPollingAttendeeMeeting(e,t,i,s,!1)}catch(t){j(a,o,t.message,e,r)}}},j=(e,t,n,i,o)=>{e.error("Error while starting broadcast updates subscription");const r=a(i,o,{error:{errorMessage:n}});t.publish(`${S.V}-${i}`,{broadcastUpdatedEvent:r})};var L=n(683184);const O={Query:{async broadcastAttendeeMeeting(e,{broadcastAttendeeMeetingParams:t},{cache:n,coreSettings:i,getBroadcastAttendeeService:a,loggerFactory:r}){const s=i.get(L.J.MeetingArtifacts);let l=!0;const c=r.newLogger("broadcastAttendeeMeetingQuery","data-resolvers-browser-broadcast-attendee"),{overflowAttendance:d}=s;if(t){if(d)try{l=((e,t)=>{if("Disabled"===t)return!1;if("Enabled"===t)return!0;const n=!(!e||!e.userPreferences||"true"!==e.userPreferences.showInMeetingReport&&"false"!==e.userPreferences.showInMeetingReport);return"EnabledUserOverride"===t?!n||"false"!==e?.userPreferences?.showInMeetingReport:"DisabledUserOverride"!==t||!!n&&"false"!==e?.userPreferences.showInMeetingReport})(n.readQuery({query:f}),s.allowTrackingInReportPolicy)}catch(e){c.error("Failed to fetch allowTrackingInReportPolicy"),c.error(e)}return{__typename:"BroadcastAttendeeMeeting",id:(u=await(await a()).getAttendeeMeeting({...t,allowTrackingInReport:l})).correlationId,title:u.subject,stream:o(u.stream),altStream:o(u.altStream),qna:u.qna,yammer:u.yammer&&{__typename:"YammerMetadata",broadcastId:u.yammer.broadcastId,groupId:u.yammer.groupId,isEnabled:u.yammer.isEnabled,eventUrl:u.yammer.event},supportUrl:u.supportUrl}}return null;var u},async broadcastCaptions(e,{id:t,broadcastId:n,culture:i,currentPlayerTime:a},{cache:o,getBroadcastCaptionsService:r,loggerFactory:s}){const l=s.newLogger("broadcastCaptionsQuery","data-resolvers-browser-broadcast-attendee");if(!t&&!n||!i)return l.error("Invalid params sent to broadcastCaptions Query"),Promise.reject("Invalid params sent to broadcastCaptions Query");l.log(`Fetching the captions for: ID: ${t}, Culture: ${i}, Time: ${a}`);const c=t||(0,C.G5)(n);try{const e=o.readQuery({query:v,variables:{id:c}});if(e&&e.broadcast.aesKey&&e.broadcast.transcription){const t={aesKey:e.broadcast.aesKey,aesKeyRefresh:e.broadcast.aesKeyRefresh,correlationId:e.broadcast.correlationId,transcription:e.broadcast.transcription},n=await r();n.setCurrentCaptionLanguage(c,i);return(e=>{const t=[];for(const n of e){if(""===n.Text)continue;const e={__typename:"Captions",start:d(n.TimestampMs),text:n.Text,end:d(n.EndTimestampMs)};t.push(e)}return t})(await n.getCaptions(a,c,t,i))}}catch(e){l.error("Failed to fetch captions"),l.error(e)}return Promise.resolve([])},async broadcast(e,{id:t,roleHint:n,joinId:i},{getBroadcastAttendeeService:o,loggerFactory:r}){const[s,l,c,d,u]=t.split("__");if(!(s&&l&&c&&d)){const e=`Invalid Id: ${t}`;throw r.newLogger("broadcast","data-resolvers-browser-broadcast-attendee").error(e),new Error(e)}const m=!!u,p=m?"Overflow":"QuickStart",g=await(await o()).getAttendeeMeeting({tenantId:s,organizerId:l,threadId:c,messageId:d,sessionId:u,roleHint:n,broadcastType:p,joinId:i||void 0});return a(t,m,g)}},Mutation:{async startLiveStreamCaptions(e,{id:t,liveStreamId:n,culture:i},{cache:a,getBroadcastCaptionsService:o,getLiveStreamRenderingService:r,loggerFactory:s}){const l=s.newLogger("liveStreamCaptionsMutation","data-resolvers-browser-broadcast-attendee");try{const e=a.readQuery({query:v,variables:{id:t}});if(!e)throw new Error("Could not find broadcast data");const s=await r(),c=await o(),d=()=>s.getDiagnosticData(n).then((e=>(l.log(`The times are: ${e.currentAbsoluteTime}, ${e.currentMediaTime}, ${e.currentPlayPosition}`),e.currentAbsoluteTime))),u=e=>{s.addCues(n,e)},m={aesKey:e.broadcast.aesKey,aesKeyRefresh:e.broadcast.aesKeyRefresh,correlationId:e.broadcast.correlationId,transcription:e.broadcast.transcription};c.startCaptionsForStream(n,t,m,i,!1,"AzureMediaPlayer",d,u)}catch(e){l.error("Failed to fetch captions"),l.error(e)}return null},async stopLiveStreamCaptions(e,{liveStreamId:t},{getBroadcastCaptionsService:n,getLiveStreamRenderingService:i,loggerFactory:a}){const o=a.newLogger("liveStreamCaptionsMutation","data-resolvers-browser-broadcast-attendee");o.log(`Stopping captions for stream ${t}`);try{const e=await n(),a=await i();return e.stopCaptionsForStream(t),a.clearCues(t),!0}catch(e){return o.error(`Error while stopping captions for stream ${t}`),o.error(e),!1}},async toggleLiveStreamCaptionButton(e,{liveStreamId:t,shouldShowButton:n},{getLiveStreamRenderingService:i,loggerFactory:a}){const o=a.newLogger("toggleLiveStreamCaptionButton","data-resolvers-browser-broadcast-attendee");o.log(`Setting the caption button visibility in the player to ${n} for stream ${t}`);try{return(await i()).showCaptions(t,n),!0}catch(e){return o.error(`Error while setting the caption button to ${n} for stream ${t}`),!1}},async subscribeToBroadcastUpdates(e,{id:t},{loggerFactory:n,getBroadcastAttendeeService:i,getBroadcastSignalRService:a,pubsub:o,cache:r,coreSettings:s,scenarioFactory:l}){const c=await i(),d=await a(),u=n.newLogger("broadcastSubscribe","data-resolvers-browser-broadcast-attendee"),{enableSignalrForOverflow:m}=s.get(L.J.Broadcast),p=await(async(e,t,n,i,a,o,r,s)=>{const l=w(e),c=!!l.sessionId;try{const d=await T(a,e,t,l,c,o);return d?(i.publish(`${S.V}-${e}`,{broadcastUpdatedEvent:d}),await N(d,n,t,e,c,l,i,o,a,r,s)):(j(o,i,"Error subscribing to broadcast updates",e,c),!1)}catch(t){return o.error(t),j(o,i,(0,b.VK)(t),e,c),!1}})(t,c,d,o,r,u,l,!!m);return p},async unsubscribeFromBroadcastUpdates(e,{id:t},{getBroadcastAttendeeService:n,getBroadcastSignalRService:i,loggerFactory:a}){const o=a.newLogger("broadcastUnsubscribe","data-resolvers-browser-broadcast-attendee");o.log(`Stopping subscription for broadcast ${t}`);try{(await n()).stopPollingAttendeeMeeting(t);return(await i()).unsubscribeFromBroadcast(t),!0}catch(e){return o.error(`Error while unsubscribing from broadcast ${t}`),o.error(e),!1}}},Subscription:{broadcastQnaFeedStatusEvent:{subscribe:(e,{id:t},{pubsub:n})=>n.asyncIterator(t)},broadcastUpdatedEvent:{subscribe:async(e,{broadcastId:t},{pubsub:n})=>n.asyncIterator(`${S.V}-${t}`)}}},$=()=>({Mutation:{updateBroadcastQnaFeedStatus:(e,{id:t,isQnaFeedLoaded:n,hasNewMessages:i},{pubsub:a})=>(null==i&&null==n||a.publish(t,{broadcastQnaFeedStatusEvent:{isQnaFeedLoaded:!!n,hasNewMessages:!!i}}),{__typename:"BroadcastQnaFeedStatus",isQnaFeedLoaded:!!n,hasNewMessages:!!i})}})},386698:(e,t,n)=>{"use strict";n.d(t,{w:()=>s});var i=n(803238),a=n(871471);const o="calendarv2",r=e=>{const t=e.get(o);return t?(0,a.D)(t):{}},s={Query:{calendarSettingsFromLocalStorage:(e,t,{localStorage:n})=>(({shouldGetDateRangeType:e,shouldGetWorkHours:t,shouldGetWorkWeekDays:n},i)=>{const a=r(i);return{__typename:"ICalendarSettings",dateRangeType:e&&a.dateRangeType||null,workHours:t&&a.workHours?{__typename:"IWorkHours",...a.workHours}:null,workWeekDays:n&&a.workWeekDays||null,isLeftRailExpanded:a.isLeftRailExpanded}})(t,n)},Mutation:{saveCalendarSettingsInLocalStorage:(e,t,{localStorage:n})=>((e,t)=>{const n=r(t);return(0,i.forOwn)(e,((e,t)=>{null!=e&&(n[t]=e)})),t.trySet(o,JSON.stringify(n),"Calendar"),!0})(t,n)}}},974065:(e,t,n)=>{"use strict";n.d(t,{b:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataResolversBrowserCallingUpdateCallingStateMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"newState"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CurrentCallingState"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateCallingState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"newState"},value:{kind:"Variable",name:{kind:"Name",value:"newState"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},581329:(e,t,n)=>{"use strict";n.d(t,{s:()=>Q});var i=n(170854),a=n(910215),o=n(683184),r=n(379658),s=n(543491),l=n(325506),c=n(139555),d=n(689626),u=n(702135),m=n(229113);const p=async(e,t,n)=>{const i=n.filter((e=>!e.shareUrl)).map((e=>e.id));if(0===i.length)return n;const a=await e.shareDriveItems(i),o=new Map;a.forEach(((e,t)=>o.set(i[t],e)));const r=[];for(const e of n){const n=o.get(e.id);if(n){if(!n.link){const n=`ShareUrl (link.webUrl) is not present in createLink response for fileId: ${e.id}`,i={[m.z.internalErrorCode]:"ShareUrlIsMissingFromResponse",[m.z.logErrorMessage]:n};throw t.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat").error(`${n}. ${JSON.stringify(i)}`),(0,u.Tr)(d.w5.AddShareUrlOnSendMessage,d.jK.Undefined,"",i,n)}r.push({...e,shareUrl:n.link.webUrl,shareId:n.shareId})}else r.push(e)}return r},g=e=>!!e?.files?.length,h=(e,t,n)=>{const i=e.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat"),{reason:a}=n;if(a){const e={errorCode:a[m.z.internalErrorCode]||n.code||"ErrorCodeMissing",correlationId:a[m.z.correlationId],statusCode:a[m.z.httpCode],message:a[m.z.logErrorMessage]||"Log message is not present in reason bag",errors:a[m.z.logErrorMessage]};throw t.fail(e),i.error(`Failed to generate ShareUrl for files. ${JSON.stringify(e)}`),n}const o={errorCode:n.code||d.jK.Unknown,message:"thrown error is not an instance of IError. So not much data available",errors:`${n.context}_${n.subContext}`};throw t.fail(o),i.error(`Failed to generate ShareUrl for files and as well error is not instance of IError ${JSON.stringify(o)}`),n},y=async(e,t,n)=>{try{return await e()}catch(e){const i="Failed to lazy load drive item share service",a={[m.z.internalErrorCode]:e.code||"FailedToLazyLoadDriveItemShareService",[m.z.logErrorMessage]:i,innerError:e},o={errorCode:a[m.z.internalErrorCode],message:a[m.z.logErrorMessage]};n.fail(o);throw t.newLogger("ChatResolversUtilsFiles","data-resolvers-browser-chat").error(`Failed to get DriveItemShareService. error: ${JSON.stringify(o)}`),(0,u.Tr)(d.w5.AddShareUrlOnSendMessage,d.jK.FailedToLazyLoadService,"",a,i)}},v=e=>!!e?.files&&!!e?.files.find((e=>"deeplink"===e.type));var f=n(202252),S=n(803238),k=n(593018),C=n(485510),b=n(288718),w=n(811957),T=n(309501),I=n(981917),N=n(72742),E=n(465698),A=n(820055);const _={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"optionalTelemetry"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"optionalTelemetry"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidCorrelationId"}},{kind:"Field",name:{kind:"Name",value:"fluidDataLossOccurred"}},{kind:"Field",name:{kind:"Name",value:"fluidDataLossPrevented"}},{kind:"Field",name:{kind:"Name",value:"hasLoopComponentAndContent"}},{kind:"Field",name:{kind:"Name",value:"embedLoopLinks"}}]}}]}}]};var F=n(439697),D=n(565634),P=n(567885);const M=e=>{switch(e){case"Standard":return"NORMAL";case"Important":return"HIGH";case"Urgent":return"URGENT"}return null},x=e=>{const t=e.computed?.cards;if(!t)return!1;return!!(0,S.find)(t,(e=>"application/vnd.microsoft.card.fluid"===e.contentType||"application/vnd.microsoft.card.fluidEmbedCard"===e.contentType))},R=(e,t)=>{const n=e.computed?.cards;return!!n&&n.some((e=>e.appName===t))},j=e=>{const t=e.computed?.cards;if(t){const e=[];return t.forEach((t=>{e.push(t.appId)})),e?.join(",")}return""},L=e=>{const t=new RegExp(N.T.reply,"g");return(e.match(t)||[]).length},O=e=>e?e.replace(/(<([^>]+)>)/gi,""):"",$=(e,t)=>{const n={};if(e&&t?.isOneOnOne&&t?.hasFederatedUser){const e=F.eo.getTflExtendedDirectoryMembership(t?.extendedDirectoryRedemptionRequired);e&&(n["DataBag.TFLUserInED"]=!0,n["DataBag.TFLUserEDState"]=e)}return n},U=(e,t,n)=>{if(t)return n?"replyConversation":"newConversation";const i="Update"===e;return n?i?"editThreadedChat":"replyThreadedChat":i?"chatEdit":"newP2PMessage"},B=e=>e?.guardianChatInfo?k.Ml.GuardianChat:null,W=e=>e?.awarenessLiveState?"sync":"async",H=(e,t)=>t===C.Th.Channel?b.Mv.team:e?.isOneOnOne?b.Mv.personal:e?.isMeeting?b.Mv.meeting:e?.isOneOnOneBotChat||e?.isOneOnOne?b.Mv.general:b.Mv.group,V=(e,t,n,i,a,o,r,s,c,d,u,m,p,g,h,y,v)=>{const f=((e,t,n)=>{if(!e||e.chatSubType===I.k2.Channel)return t?n?C.Th.Communities:C.Th.Channel:void 0;const i=e.memberIds?.map((e=>e))??[],a=(0,w._K)(e.id,e.isFederated,e.isOneOnOne,e.hasFederatedUser,i);return(0,l.NL)(e.id,e.chatType,e.isMeeting,e.isOneOnOne,e.isOneOnOneBotChat,a,e.isFederated)})(u,g,r&&y===e);let k={};f===C.Th.Botchat&&(k=((e,t)=>{const n=e?.memberIds?.find(w.bl);if(n){const e=n.substring(T.at.BotPrefix.length);try{const n=t.readQuery({query:E.C,variables:{installedContext:{scope:"Personal"}}});if(n){const t=n.installedAppsV2?.filter((t=>t?.definition?.bots?.[0]?.id===e));if(t&&t.length>0)return{id:t[0]?.id,capabilityId:e,scenarioCapability:b.Ky.bots}}}catch(e){}}return{}})(u,p));let _={};f!==C.Th.Channel&&f!==C.Th.Communities||(_=((e,t,n,i)=>{let a;try{a=e.readQuery({query:A.h,variables:{conversationId:t}})}catch(e){i.error(`Failed to retrieve Team.Id and Team.OfficeGroupId from cache. Thread.Id: ${t}. Thread.Type: ${n}.`)}return{channelType:a?.channelByID.channelType,teamId:a?.channelByID?.owningTeam?.id,officeGroupId:a?.channelByID?.owningTeam?.teamSiteInformation?.groupId,memberCount:a?.channelByID?.owningTeam?.membershipSummary?.memberCount}})(p,e,f,o));const F=_?.channelType??null,{panelType:V,panelRegion:z}=function(e,t,n){let i=C.wh.Chat,a=C.Ai.main;e&&(i=t?C.wh.discoverSurface:C.wh.Channel);n&&(i=C.wh.CommentStreamChat,a=C.Ai.right);return{panelType:i,panelRegion:a}}(g,v,d),q=g?"channel":"chat",J=((e,t,n,i,a,o,r,s,l,c)=>{return{"DataBag.messagelength":O(e.content).length,"DataBag.size":e.content.length,"DataBag.importantflag":M(e.importance),"DataBag.messageType":U(t,s,l),"DataBag.postType":"Announcement"===e.postType?"announcement":"normal","DataBag.richText":(u=e.messageType,"RichText/Html"===u),"DataBag.fluidCard":x(e),"DataBag.appId":j(e),"DataBag.sfbInteropMessage":"SfBInteropChat"===o?.chatType,"DataBag.mricollection":o?.memberIds?.map((e=>(0,w.Q2)(e)))?.join(" ")||"","DataBag.rostersize":o?.memberIds?.length||0,"DataBag.attachments":e.files?.length||0,"DataBag.attachmentIds":e.files?.map((e=>e.id))?.join(" ")||"","DataBag.fileTypeList":e.files?.map((e=>e.type))?.filter((e=>!(0,S.isNil)(e)))||[],"DataBag.suggestedFile":e.files?.some((e=>"smartReply"===e.context)),"DataBag.leftRailDirective":s?"channel-list":"chat-list","Messaging.messageChannelType":c,"DataBag.messageID":e.id!==e.clientMessageId?e.id:void 0,"DataBag.replyChainId":l,"DataBag.isNewChat":!!r,"DataBag.newChatIntentId":r,"DataBag.tflOffNetworkEmailCount":o?.memberIds?o.memberIds.filter((e=>e.startsWith(T.b6))).length:0,"DataBag.tflOffNetworkOneWayPhoneCount":o?.memberIds?o.memberIds.filter((e=>e.startsWith(T.EI))).length:0,"DataBag.tflSMSMembersCount":o?.memberIds?o.memberIds.filter(w.yj).length:0,"DataBag.offNetworkContactsSelected":o?.memberIds?o.memberIds.filter(w.$i).length:0,"DataBag.hasAADFederatedMembers":o?.hasFederatedUser||!1,"DataBag.hasMSAFederatedMembers":o?.hasTflConsumerUser||!1,"DataBag.quotedReplyCount":L(e.content),"DataBag.groupTemplateType":o?.groupTemplate,"DataBag.chatType":B(o),"DataBag.GIF":(0,P.W)(e.content,N.T.giphy),"DataBag.Sticker":(0,P.W)(e.content,N.T.sticker),"DataBag.customEmoji":(0,P.W)(e.content,N.T.customEmoji),"DataBag.emoji":(0,P.W)(e.content,N.T.emoji),"Designer.containsImageFromDesigner":R(e,D.SL)||(d=e.content,d.split(" ").filter((e=>e===`type="${D.m7}"`)).length>0),"DataBag.composeVersion":i?"Simplified":"Classic",...$(n,o),"DataBag.lifeCycleFlavor":W(o),"DataBag.wasEdited":"Update"===t,"Messaging.additionalContentPresent":a?O(e.content).length>0:void 0,"Messaging.additionalContentLength":a?O(e.content).length:void 0};var d,u})(t,n,r,s,c,u,m,g,h,F);a.recordPanelAction({actionGesture:C.uS.click,actionOutcome:C.$K.submit,actionOutcomeNew:C.$K.submit,actionScenarioType:c?C.Yu.forwardMessage:C.Yu.composeMsg,actionScenario:C.Tk.composeSendMessage,appId:J["DataBag.appId"]||"",appScope:H(u,f).toString(),appScenarioCapability:void 0!==J["DataBag.appId"]?b.Ky.messaging.toString():"",moduleName:c?C.rA.forwardButton:C.rA.sendButton,moduleNameNew:c?C.rA.forwardButton:C.rA.sendButton,moduleType:C.PO.sendMessageButton,moduleTypeNew:C.PO.sendMessageButton,officeGroupId:null!=_?.officeGroupId?_?.officeGroupId:void 0,panelRegion:z,panelType:V,panelRegionNew:z,panelTypeNew:V,panelUri:c?"app.conversation":void 0,threadId:e,teamId:y??_?.teamId,threadMembers:_?.memberCount??u?.memberIds?.length,threadType:f,actionWorkload:g?C.sz.channelContent:C.sz.chatContent,actionSubworkload:C.eD.composeMsg,tabId:"",tabType:"conversations",tabIdNew:"",tabTypeNew:"conversations",tabOrdinal:1,appName:q,dataBag:{id:"",data:{...i,...J,...G(p,t,v,h)},dispose:()=>{}},extensibilityData:k},o)};function G(e,t,n,i){const a={};let o=null;try{o=e.readQuery({query:_})}catch{}const r=o?.optionalTelemetry;return null!=r?.fluidDataLossOccurred&&(a["DataBag.fluidDataLossOccurred"]=o?.optionalTelemetry?.fluidDataLossOccurred),null!=r?.fluidDataLossPrevented&&(a["DataBag.fluidDataLossPrevented"]=o?.optionalTelemetry?.fluidDataLossPrevented),null!=r?.fluidCorrelationId&&(a["Messaging.fluidCorrelationId"]=o?.optionalTelemetry?.fluidCorrelationId),null!=r?.embedLoopLinks&&(a["Messaging.embedLoopLinks"]=o?.optionalTelemetry?.embedLoopLinks),null!=r?.hasLoopComponentAndContent&&(a["Messaging.hasLoopComponentAndContent"]=o?.optionalTelemetry?.hasLoopComponentAndContent),n&&(a["DiscoverSurface.requestId"]=n,a["DataBag.messageID"]=i),"Announcement"===t.postType&&(a["Channels.containsImageBanner"]=R(t,D.KN)),a}var z=n(456366),q=n(719799),J=n(585189);const Q={Mutation:{sendMessageWorker:async(e,t)=>K(e,t),sendMessage:async(e,t)=>K(e,t)}},K=async(e,t)=>{const{convId:n,action:i,originalConvId:a,withChatNetworkFallback:l,searchSessionId:d,sendFromChannel_ToBeRefactored:u,isCommentStream:m,composeCopilotSessionId:S}=e,k=e.message,{cache:C,coreSettings:b,loggerFactory:w,offlineCacheManager:T,getDriveItemShareService:N,scenarioFactory:E,channelView:A,channelOrder:_,teamId:F,getPeopleService:D,requestId:P,authenticationUser:M,themeType:x}=t,{enableInstalledAppsV2:R,enableBotsFileSharing:j,enableAppsQueryOptimization:L,botFileInfoFetchTimeout:O}=b.get(o.J.Extensibility),{enableFilesShareLinksInvite:$,enableSharingByCreateLinkAPI:U,enableFilesShareLinksFetchFederatedUsersAPI:B,enableFilesShareLinksFetchTflConsumerUsersAPI:W,enableSendMessageLoggingForDebugging:H,enableFileSharingSecurityFixInChannels:G}=b.get(o.J.Files),{msgEnableChannelsV2:Q}=b.get(o.J.Host),{enableScheduleMessage:K,enableSimplifiedCompose:te}=b.get(o.J.Messaging),{enableCrossPostFileSharing:ne}=b.get(o.J.Channels),ie=!!te,{enableMeetingChatAttachmentsInMCO:ae,meetingChatAttachmentsMap:oe,enableSPODataInSaveArtifacts:re}=b.get(o.J.ArtifactsPlatform),{userIdPrefix:se}=b.get(o.J.Calling),{environment:le}=b.get(o.J.Metadata),ce=le===r.s.life,de=w.newLogger("chatMutationForwardResolvers","data-resolvers-browser-chat"),ue=function(e,t,n){const i=(0,c.qr)(e,t);return n.findScenario(i)}(i,k,E),me=await(0,f.mb)(n,C,t,de,w,l,null,null,void 0,a||"");ue?.mark(s.ck.ChatSendMessageGotChat);const pe=X(a,C,de),ge=await Y(t);ue?.mark(s.ck.ChatSendMessageServicesLazyLoadComplete);const he=(0,f.Fb)(C,n,R,L),ye=(0,f.QD)(C),ve=Z(t,de);ae&&async function(e,t,n,i,a,o,r,l,c,d){const{scenario:u}=(0,q.hg)(s.RG.AddAttachmentToMCO,a);if(t?.chatSubType===I.k2.Channel)return;const m=e?.files?.length;try{if(m&&("Recurring"===t?.meetingInformation?.meetingType||"Scheduled"===t?.meetingInformation?.meetingType)){const s=await l(),m=await ee(t?.meetingInformation?.organizerId||"",s,c)||"",p=`${t.me?.objectId}@${t.addedByTenantId}`,g=`${t.meetingInformation.organizerId}@${t.meetingInformation.tenantId}`,h=t.meetingInformation.iCalUid||"",y=t.meetingInformation.organizerId,v=m,S=e.files,k=(0,q.Sk)(t?.me?.objectId||"",S,n);if(k.length>0){const e=(0,f.i$)(t,h,g,p,m);e?(r.errorToTelemetry?.(e,"cmd_meetings_collab_object_add_resources_to_collab_object_event"),u.fail({reason:e})):(0,J.A)(o,a,i,"MeetingChat",h,h,g,p,k,(0,q.xk)(t.id,m,t.meetingInformation?.meetingJoinUrl,"0"),y,v,d)}}u.stop()}catch(e){(0,q.jq)(e,u)}}(k,me,oe,w,E,t.getCollabObjectService,de,D,se,!!re);const fe={"DataBag.searchSessionId":d,"DataBag.isChannelsV2":!!Q,"DataBag.channelView":A,"Channels.channelOrder":_,"Compose.sendPostAsEmail":!!k?.sendPostAsEmail,"Messaging.isShadowMTOMember":"Mto"===M?.subType,"Messaging.isMTOMember":null,"Messaging.hasMTOMembers":me?.hasFederatedMTOUser,"Compose.composeCopilotSessionId":S};let Se=await(0,f.JB)(t,k,i,n,ve,{...ge,cache:C,offlineCacheManager:T,telemetryDatabag:fe,convId:n,conversationMembers:me?.memberIds,getInstalledMessageExtensionApps:he,getAppDefinitions:ye,authenticationUser:M},ue,!!u,m??!1,x);return U&&k&&((0,f.Oc)(de,"Adding share url to files payload pram- addShareUrlToFiles","send_message_forward_resolver",H),Se=await(async(e,t,n,i)=>{if(g(i)){const a=t.newScenario(s.RG.FilesCreateShareLink),o=await y(e,n,a);try{const e=await p(o,n,i.files);return a.stop(),{...i,files:e}}catch(e){h(n,a,e)}}return{...i}})(N,E,w,Se)),(0,f.Oc)(de,"calling updateFluidMessageShareUrl","send_message_forward_resolver",H),Se=await(0,f.KE)(Se,de,t),(0,f.Oc)(de,"calling getBotDownloadUrlForFiles","send_message_forward_resolver",H),Se=await(0,f.R_)(ge.botsPlatformService,Se,j,w,me,O),Se=(0,f.wX)(Se,me),($||K)&&me&&(0,f.iX)(me)&&!v(Se)&&(ue?.mark(s.ck.ChatSendMessageFileShareLinksChats),(0,f.Oc)(de,"Creating Sharelinks if the files attached in Chat with no share url getMessageWithFileShareLinks","send_message_forward_resolver",H),Se=await(0,f.Ju)(Se,me,t,de,B,W)),($||K)&&u&&!v(Se)&&(ue?.mark(s.ck.ChatSendMessageFileShareLinksChannels),(0,f.Oc)(de,"Creating Sharelinks if the files attached in Channel with no share url getMessageWithFileShareLinksForChannel","send_message_forward_resolver",H),Se=await(0,f.DE)(Se,C,n,de,t,!!ne,!!G)),ue?.mark(s.ck.ChatSendMessageBiTelemetry),((e,t,n,i,{loggerFactory:a,userBiService:o,cache:r},s,l,c,d,u,m,p,g,h,y)=>{const v=a.newLogger("sendMessageTelemetry","data-resolvers-browser-chat");o?V(e,t,n,i,o,v,s,l,c,d,u,m,r,p,g,h,y):v.warn("userBiService is null")})(n,Se,i,fe,t,ce,ie,(0,f.Cf)(k),!!m,me,pe,u,k?.replyChainId,F,P),ue?.mark(s.ck.ChatSendMessageForwardResolverComplete),(0,z.Y)({scenario:ue,message:Se,oamRetryCount:0,logger:de}),{...e,message:Se}},Y=async e=>{const{getAppBasedLinkService:t,getAsyncMediaService:n,getUrlPreviewService:i,getImageProxyService:a,getFilesReferenceService:o,getBotsPlatformService:r}=e,[s,l,c,d,u,m]=await Promise.all([n(),a(),i(),o(),t(),r()]);return{asyncMediaService:s,imageProxyService:l,urlPreviewService:c,fileReferenceService:d,appBasedLinkService:u,botsPlatformService:m}},X=(e,t,n)=>{let a=null;if((0,l.UL)(e))try{const n=t.readQuery({query:i.i,variables:{convId:e}});a=n?.newChatIntentId??null}catch(e){n.error("Failed to find newChatIntentId in cache")}return a},Z=(e,t)=>{let n=!0;const{cache:i,coreSettings:r}=e,{enableConnectedExperiences:s}=r.get(o.J.Messaging);if(!s)return n;try{const e=i.readQuery({query:a.K});n="false"!==e?.userPreferences?.controllerConnectedServicesEnabled}catch{t.error("Failed to find userPreferences in cache")}return n},ee=async(e,t,n)=>{const i=`${n}${e}`,a=(await t.getPeopleProfilesByMris([i],"MeetingChat")).get(i),o=a?.userPrincipalName;return o}},202252:(e,t,n)=>{"use strict";n.d(t,{QD:()=>J,R_:()=>z,mb:()=>ce,i$:()=>me,Fb:()=>Q,Ju:()=>X,DE:()=>Z,iX:()=>de,Cf:()=>G,Oc:()=>pe,PJ:()=>V,JB:()=>W,wX:()=>ue,KE:()=>oe});var i=n(803238),a=n(894917),o=n(543491),r=n(692741),s=n(325506),l=n(904986),c=n(593697);let d=class{transform(e,t){if(e.parent&&1===e.parent.children.length&&"div"===e.parent.name?.toLowerCase()&&"root"===e.parent.parent?.type){if((!e.children||0===e.children.length)&&"text"===e.type)return t.isPureText=!0,void(t.textContent=(0,i.unescape)(e.data));if("tag"===e.type&&"p"===e.name?.toLowerCase()&&1===e.children?.length&&"text"===e.children[0].type)return t.isPureText=!0,void(t.textContent=(0,i.unescape)(e.children?.[0].data));if("tag"===e.type&&"p"===e.name?.toLowerCase())return e.name="div",e}}};d=(0,c.__decorate)([(0,l.wx)({name:"BotMessageContentSerializer",filter:"*"})],d);var u=n(84539),m=n(666921),p=n(811957),g=n(569864),h=n(309501),y=n(567861),v=n(683184);var f=n(98666),S=n(565634),k=n(498346),C=n(876934),b=n(72742),w=n(716626),T=n(205454),I=n(252228);const N={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserChatAppDefinitionsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"scope"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appDefinitions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"scope"},value:{kind:"Variable",name:{kind:"Name",value:"scope"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"appDefinition"}}]}}]}},...n(793563).E.definitions]};var E=n(820055);const A={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserChatChannelsByIdsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeTeams"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelsByIds"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationIds"},value:{kind:"Variable",name:{kind:"Name",value:"conversationIds"}}},{kind:"Argument",name:{kind:"Name",value:"includeTeams"},value:{kind:"Variable",name:{kind:"Name",value:"includeTeams"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataResolversBrowserChatChannelsByIdsFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataResolversBrowserChatChannelsByIdsFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Channel"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}}]}}]}}]}.definitions]};var _=n(465698),F=n(341887);const D={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"installedChatAppsWithPreCheck"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"InstalledAppsOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedChatAppsWithPreCheck"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"installedAppFields"}}]}}]}},...F.W.definitions]},P={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"installedApps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedScopes"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedApps"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedScopes"},value:{kind:"Variable",name:{kind:"Name",value:"installedScopes"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"installedAppFields"}}]}}]}},...F.W.definitions]};var M=n(873644);const x={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}}]}}]};let R=class{transform(e,t){if(e&&e.attribs&&w.zj.cacheKey in e.attribs&&e.attribs[w.zj.cacheKey]===t.cacheKey)return t.instancesReplaced++,void 0!==t.value?e.attribs[t.prop]=t.value:t.prop in e.attribs&&void 0===t.value&&delete e.attribs[t.prop],e}};R=(0,c.__decorate)([(0,l.wx)({name:"InlineVideoUpdater",filter:[{itemtype:b.T.amsVideo}]})],R);const j="external_tfw_tfl_users",L="external_tfw_users",O="external_tfl_users",$="internal_users",U=async(e,t)=>{const n=e.loggerFactory.newLogger("postTransformationCleanup","data-resolvers-browser-chat");e.nonBlockingDeletableCacheKeys.length&&(n.log(`AsyncSendSerialization: Cleaning up ${e.nonBlockingDeletableCacheKeys.length} cached items.`),t?.mark(o.ck.ChatSendMessageSerializationCacheCleanup));for(const t of e.nonBlockingDeletableCacheKeys)try{await e.offlineCacheManager.delete(t)||n.warn(`AsyncSendSerialization: Failed to delete cached image with key: ${t}`)}catch(e){n.warn(`AsyncSendSerialization: Failed to delete cache image with key: ${t}. Also, we experienced an error, which is being considered non blocking to ensure we do not cause a terminal send issue.`)}},B=async(e,t,n,i,a,r,s,c)=>{const{cache:d,loggerFactory:m}=e,p=m.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),g=(0,l.te)(u.bl,t,n);try{G(a)||(await(0,I.yG)(d,e,i,a,r,g,n.messageProperties,c),s?.mark(o.ck.ChatSendMessageOptimisticResponsePosted))}catch(e){p.error(`client lie generation failed for conversation: ${i} clientMessageId: ${a.clientMessageId} error: ${e}`)}return(0,l.zL)(u.Vf,g,{...n,videoMessageLieUpdater:(e,t,n)=>((e,t,n,i,a)=>{if(!t)throw Error("clientMessageId undefined");const o=`Message:${t}`;let r;try{r=e.readFragment({id:o,fragment:x})}catch(e){throw e}if(!r)throw Error(`Message lie ${o} not found.`);if(!r.content)throw Error(`Message lie ${o} has no content.`);const s={cacheKey:n,prop:i,value:a,instancesReplaced:0},c=(0,l.te)([R],r.content,s);if(1!==s.instancesReplaced)throw Error(`${s.instancesReplaced} instances found instead of 1`);{const n=(0,M.MX)()[0].toString();try{e.writeFragment({id:o,fragment:x,data:{__typename:"Message",id:t,content:c,version:n}})}catch(e){throw e}}})(d,a.clientMessageId,e,t,n)},U)},W=async(e,t,n,i,a,r,s,l,c,d)=>{const{content:u,computed:m,files:p,clientMessageId:g,deeplinks:h,title:f,...S}=t,{coreSettings:k,i18n:C,loggerFactory:b,scenarioFactory:w}=e,T={conversationId:i,connectedExperienceEnabled:a,existingLinks:m?.embeddedLinks||[],messageProperties:m?{...m,embeddedLinks:[],mentions:m.mentions?[...m.mentions]:void 0,onBehalfOf:m.onBehalfOf?[...m.onBehalfOf]:void 0}:{},files:p?[...p]:[],coreSettings:k,loggerFactory:b,i18n:C,scenarioFactory:w,nonBlockingDeletableCacheKeys:[],...c&&{isLiteEmoticon:!0,disableBigEmoticons:!0},...r,...d&&{themeType:d}},I=b.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),N=await B(e,u,T,i,t,n,s,l),E=((e,t)=>{const{enableEntityConversationInMWTab:n}=e.get(v.J.Extensibility);if(!n)return[];const i=y.h.getInstance(),a=i.getSubEntityDeepLinkInfo();return a&&t&&i.getClientMessageId()===t?(i.setSubEntityDeepLinkInfo(void 0),i.setClientMessageId(void 0),[a]):[]})(k,g||void 0),{updatedTitle:A,updatedCards:_,updatedAmsReferences:F}=await H(f||"",T);return I.log(`serialized message ${g}`),s?.mark(o.ck.ChatSendMessageSerializationComplete),{content:N,computed:{...T.messageProperties,cards:_,amsReferences:F},files:T.files,deeplinks:E.length>0?E:h,clientMessageId:g,title:A,...S}},H=async(e,t)=>{let n=t.messageProperties.cards,i=t.messageProperties.amsReferences;if(n?.length){const e=n.find((e=>e.appId===S.lq&&e.contentType===S.hY));if(e){let a=JSON.parse(e.content);if(a.imageData?.origImage&&a.imageData?.croppedImage?.src?.startsWith("blob:")){const o=await(0,k.Hk)(a.imageData.croppedImage.src),r="MicrosoftTeams-image.png",s=await t.asyncMediaService.uploadItem(o,t.conversationId,"IMAGE",r,f.r1.Inline),l=s.inlineSizeUrl.replace("/imgo","/imgpsh_fullsize");a={...a,imageData:{...a.imageData,croppedImage:{...a.imageData.croppedImage,id:s.objectId,src:l},origImage:{...a.imageData.origImage,id:s.objectId,src:l}}},i=i?.length?[...i,s.objectId]:[s.objectId];const c={...e,content:JSON.stringify(a)};n=n.map((e=>e.appId===S.lq&&e.contentType===S.hY?c:e))}}}return{updatedTitle:e,updatedCards:n,updatedAmsReferences:i}},V=(e,t)=>{const{loggerFactory:n,offlineCacheManager:i}=e,a={logger:n.newLogger("chat-resolvers-utils","data-resolvers-browser-chat"),offlineCacheManager:i},o=(0,l.te)(u.D,t.content,a);return{...t,content:o}},G=e=>!!e?.forwardMessageId&&!!e?.forwardMessageOriginalConvId,z=async(e,t,n,i,a,o)=>{if(!a||!n||!t.files||0===t.files.length)return t;if(!a?.isOneOnOneBotChat)return t;const r=i.newLogger("chat-resolver-utils","data-resolvers-browser-chat"),s=o||1e4,l=await Promise.all(t.files.map((t=>q(t,e,r,s))));return{...t,files:l}},q=async(e,t,n,i)=>{const a=e.objectUrl;if(a){let o;try{o=await(0,C.E)(t.getBotFileDownloadUrl(a,n),i,"get bot downlaod url timed out")}catch{o=null,n.error("getBotDownloadUrlForFiles: failed to get file info")}if(o)return{...e,downloadUrl:o}}return e},J=e=>()=>{try{const t=e.readQuery({query:N,variables:{options:{capabilityFilter:["Messaging"]}}});return t?.appDefinitions?.filter((e=>!!e))}catch{return}},Q=(e,t,n,a)=>()=>{try{if(n){const n=K(e,t,a);return(0,i.compact)(n?.filter((e=>e?.definition?.messageExtensions)).map((e=>e&&Y(e)?e:null)))}{const n=e.readQuery({query:P,variables:{conversationId:t,installedScopes:["Personal","GroupChat"],options:{capabilityFilter:["Messaging"]}}});return(0,i.compact)(n?.installedApps?.map((e=>e&&Y(e)?e:null)))}}catch{return}},K=(e,t,n)=>{let i=null;try{i=e.readQuery({query:_.C,variables:{installedContext:{scope:"Personal"}}})}catch{i=null}let a=null;try{if(n){const n=e.readQuery({query:D,variables:{conversationId:t}});a=n?.installedChatAppsWithPreCheck}else{const n=e.readQuery({query:_.C,variables:{installedContext:{conversationId:t,scope:"GroupChat"}}});a=n?.installedAppsV2}}catch{a=null}const o=a??[];return(i?.installedAppsV2??[]).concat(o)},Y=e=>(0,i.includes)(["Installed","InstalledAndFavorited","InstalledAndPermanent"],e.installationState),X=async(e,t,{getSharepointShareService:n,getPeopleService:i,discover:a,scenarioFactory:r},s,l,c)=>{if(e?.files?.length&&!t?.isOneOnOneBotChat){const d=r.newScenario(o.RG.FileSharelinkMessageSend),u=await n(),m=await i(),p=await a.skypeid();let g=[];try{d.mark(o.ck.FetchingUserDetailsStarted);g=(await le(t,m,d,s,l,c)).filter((e=>e.mri!==p)),d.mark(o.ck.ShareUrlInviteCallForChatStarted);const n=await u.shareFiles(e.files,g,d,!0);return d.stop(),{...e,files:n}}catch(e){ne(e,d,g.length);const t=JSON.stringify({errorCode:`${e.serverResponse?.status}`,errors:JSON.stringify([e.code]),correlationId:e.reason?.correlationId,errorMessage:e.reason?.logErrorMessage,numOfUsers:g.length,reason:e.reason?.reason});throw s.error(`getMessageWithFileShareLinks: Failed to create the shareLink for Chat's message. Error: ${t}`),e}}return e},Z=async(e,t,n,i,{getSharepointShareService:a,scenarioFactory:r},s,l)=>{if(!e?.files?.length)return e;const c=!(!s||!e.crossPostChannels?.length),[d,u]=c?te(e,t,i):ee(e,t,n,i,l);if(!d.length||!u.length)return e;const m=r.newScenario(o.RG.FileSharelinkMessageSend);try{const t=await a();m.mark(o.ck.ShareUrlInviteCallForChannelStarted);const n=await t.shareFiles(d,u,m);return m.stop({message:c?"CrossPostFileSharing":"StandardPostFileSharing"}),{...e,files:n}}catch(e){ne(e,m,u.length);const t=JSON.stringify({errorCode:`${e.serverResponse?.status}`,errors:JSON.stringify([e.code?.toString()]),correlationId:e.reason?.correlationId,errorMessage:e.reason?.logErrorMessage,numOfUsers:u.length,reason:e.reason?.reason});i.error(`getMessageWithFileShareLinksForChannel: Failed to create the shareLink for Channel's message. isCrossPostFileSharing: ${c}, Error: ${t}`)}return e},ee=(e,t,n,i,a)=>{const o=[],r=[],s=ie(t,n,i),{teamSiteInformation:l,smtpAddress:c}=s?.channelByID?.owningTeam||{};let d=null;a?s?.channelByID?.channelType&&(d="Private"===s?.channelByID?.channelType||"Shared"===s?.channelByID?.channelType?s?.channelByID?.sharepointSiteUrl||null:l?.sharepointSiteUrl||null):d=l?.sharepointSiteUrl||null;const u=l?.groupId||null;return d&&c&&u&&e?.files?.length&&e.files[0].baseUrl!==d&&(o.push(...e.files),r.push({id:u,smtpAddresses:[c],objectId:u})),[o,r]},te=(e,t,n)=>{const i=[],a=[],o=e.crossPostChannels?[...e.crossPostChannels]:[],r=ae(t,o,n);return e.files?.forEach((e=>{let t=!1;r?.channelsByIds?.forEach((n=>{const{teamSiteInformation:i,smtpAddress:o}=n?.owningTeam||{},r=i?.sharepointSiteUrl||null,s=i?.groupId||null;s&&r&&o&&e.baseUrl!==r&&(t=!0,a.some((e=>e.id===s))||a.push({id:s,smtpAddresses:[o],objectId:s}))})),t&&i.push(e)})),n.log(`getFilesAndRecipientsForCrossPost: ${i.length} files and ${a.length} recipients.`),[i,a]},ne=(e,t,n)=>{const i={errorCode:`${e.serverResponse?.status}`,errors:JSON.stringify([e.code?.toString()]),correlationId:e.reason?.correlationId,errorMessage:e.reason?.logErrorMessage,numOfUsers:n,reason:e.reason?.reason};t.fail(i)},ie=(e,t,n)=>{try{return e.readQuery({query:E.h,variables:{conversationId:t}})}catch(e){return n.error("getChannelFieldsForFileSharing: Failed to find channels related data"),null}},ae=(e,t,n)=>{try{return e.readQuery({query:A,variables:{conversationIds:t,includeTeams:!0}})}catch(e){return n.error("getChannelsFieldsForFileSharing: Failed to find channels related data"),null}},oe=async(e,t,{getFluidService:n})=>{if(e&&e.content&&e.fluidUrlPermissionInfo&&e.fluidUrlPermissionInfo.grantPermissionVariables){const{siteUrl:i,driveId:a,itemId:o,queryParams:r,linkType:s,scope:l,recipientList:c,createShareLinkOptions:d}=e.fluidUrlPermissionInfo.grantPermissionVariables,u=await n();try{const t=await u.createShareLink(i,a,o,r,s,l,c,d),n=t?.link?.webUrl,p=e.computed?.cards;if(p&&n){const t=p.find((e=>e.contentType===m.p.FluidEmbed||"fluid-card"===e.appId));if(t&&t.contentType===m.p.FluidEmbed){const i=t.cardClientId,a=JSON.parse(t.content).componentUrl,o=re(t,n),r=se(e.content,b.T.fluidEmbedLink,n,a,i);return{...e,content:r,computed:{...e.computed,cards:o}}}if(t&&"fluid-card"===t.appId){const i=re(t,n);return{...e,computed:{...e.computed,cards:i}}}}}catch(e){t.warn(`Error creating fluid sharelink in chat resolvers: ${e}`)}}return e},re=(e,t)=>{const n=[],i=e.contentType===m.p.FluidEmbed?JSON.parse(e.content).sourceType:null,a=JSON.stringify({componentUrl:t,sourceType:i}),o={...e,content:a};return n.push(o),n},se=(e,t=b.T.fluidLink,n,i,a)=>{const o=T.N.parseDOM(e),r=T.N.DomUtils.findAll((e=>"a"===e.name&&T.N.DomUtils.getAttributeValue(e,w.zj.itemtype)===t&&!!T.N.DomUtils.getAttributeValue(e,"href")),o),s=T.N.DomUtils.getAttributeValue(o[1],"itemid"),l=T.N.DomUtils.getAttributeValue(r[0],"href");if((e=>e.length>=1)(r)&&r[0]&&s&&a&&l&&i&&n&&s===a&&l===i){return e.replace(/href="(.*?)"/,`href="${n}`)}return e},le=async(e,t,n,a,s,l)=>{try{const a=e.hasFederatedUser,c=e.hasTflConsumerUser,[d,u]=c?(0,i.partition)(e.memberIds,(t=>(0,p.Nl)(t)&&!(0,g.Bl)(e.id))):[[],e.memberIds];let m;s&&a?(n.mark(o.ck.FetchingFederatedUser),m=await(0,r.a2)(u||[],t)):m=await(0,r.Mv)(u||[],t);let h,y=[];return l&&c&&(n.mark(o.ck.FetchingTflConsumerUser),y=await(0,r.LH)(d||[],t)),h=a&&c?j:a?L:c?O:$,n.mark(o.ck.FetchingUserDetailsCompleted,{message:h}),m.concat(y)}catch(e){throw a.error("getUsersForShareLink: Failed to fetch users from People Service(mt)."),e}},ce=async(e,t,n,i,o,r,l,c,d,u)=>{let m;try{m=t.readQuery({query:a.v,variables:{convId:e}})?.chat}catch(e){i.error("Failed to find chat in cache")}if(r&&!m){const t=await n.getCSAService(),i=await t.getChat(e);i&&(m=(0,s._$)(i,o,l,{id:c},d))}const p=(0,s.UL)(u)||(0,s.AK)(u);if(!m&&p&&u){e=u;try{m=t.readQuery({query:a.v,variables:{convId:e}})?.chat}catch(e){i.error("Failed to find chat in cache")}}return m},de=({chatType:e})=>"Chat"===e||"Meeting"===e,ue=(e,t)=>{const n=!(0,i.isEmpty)(t?.botMembers),a=!!e.computed?.mentions?.find((e=>"bot"===e.mentionType));if(!(t?.isOneOnOneBotChat||n&&a))return e;const o={},r=(0,l.te)([d],e.content,o);return o.isPureText&&!(0,i.isNil)(o.textContent)?{...e,content:o.textContent,messageType:"BotMessageBack"===e.messageType?"BotMessageBack":h.Cs.Text}:{...e,content:r}},me=(e,t,n,i,a)=>{let o="";return e||(o=o?o.concat(", Chat Object ( thus meetingUrl)"):o.concat("Missing Chat Object ( thus meetingUrl)")),t||(o=o?o.concat(", externalEntityKey"):o.concat("Missing externalEntityKey")),n||(o=o?o.concat(", organizer"):o.concat("Missing organizer")),i||(o=o?o.concat(", user"):o.concat("Missing user")),e&&!e.meetingInformation?.meetingJoinUrl&&(o=o?o.concat(", meetingUrl"):o.concat("Missing meetingUrl")),a||(o=o?o.concat(", organizerUpn"):o.concat("Missing organizerUpn")),o||void 0},pe=(e,t,n,i)=>{i&&e.log(t,n)}},820055:(e,t,n)=>{"use strict";n.d(t,{h:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserChatChannelIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"membershipSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"memberCount"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}}]}}]}},465698:(e,t,n)=>{"use strict";n.d(t,{C:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"installedAppsV2"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"installedContext"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallContext"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"InstalledAppsOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"installedAppsV2"},arguments:[{kind:"Argument",name:{kind:"Name",value:"installedContext"},value:{kind:"Variable",name:{kind:"Name",value:"installedContext"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"installedAppFields"}}]}}]}},...n(341887).W.definitions]}},255764:(e,t,n)=>{"use strict";n.d(t,{X:()=>a});var i=n(666341);function a(e){switch(e.__typename){case"BreakoutRoom":return`${e.__typename}:${e.coordinates?.threadId}`;case"Participant":return`${e.__typename}:${e.participantId}`;case"TeamTagCards":return`${e.__typename}:${e.teamId}`;case"TagCard":return`${e.__typename}:${e.tagId}`;case"Entity":return e.linkedEntity?`${e.__typename}:${e.id}:${e.type}:${e.action}:${e.options}:${e.linkedEntity.id}:${e.linkedEntity.type}:${e.linkedEntity.action}`:`${e.__typename}:${e.id}:${e.type}:${e.action}:${e.options}`;case"LinkedEntity":return`${e.__typename}:${e.id}:${e.type}:${e.action}`;case"ExtensibilityAppPickerCategory":return e.conversationId?`${(0,i.uG)(e)}:${e.conversationId}`:(0,i.uG)(e);case"InstalledApp":const t=`${(0,i.uG)(e)}:${e.installedScope}`;return e.conversationId?`${t}:${e.conversationId}`:t;case"AppDefinition":return`${(0,i.uG)(e)}:${e.version}`;case"MessageExtensionCommand":return`${(0,i.uG)(e)}:${e.appKey}`;case"BotDynamicCommands":return`${e.__typename}:${e.botMri}:${e.commandContext}`;case"Device":return`${e.__typename}:${e.type}:${e.id}`;case"DeviceList":if(!e.id)throw new Error("dataIdFromObject(), no id on DeviceList object.");return(0,i.uG)(e);case"TransportCompanionDeviceInfo":case"UserPreferences":case"UserSettings":case"MessagingSettings":case"MeetingChatSettings":case"AppsUsage":case"TranslationSettingsV2":return e.__typename;case"StagedApp":return`${(0,i.uG)(e)}:${e.reviewStatus}`;case"CallLogParticipant":return`${(0,i.uG)(e)}:${e.displayName}:${e.type}`;case"WebApplicationInfo":return`${e.__typename}:${e.appKey}`;case"DeepLink":return`${e.__typename}:${e.id}:${e.serverRelativeUrl}`;case"MeetingThreadProperties":return e.hideOneOnOneMeetingReport?`${(0,i.uG)(e)}:${e.hideOneOnOneMeetingReport}`:(0,i.uG)(e);default:return(0,i.uG)(e)}}},674262:(e,t,n)=>{"use strict";n.d(t,{D:()=>a});var i=n(367901);const a={Mutation:{updateFilePermission(e,{updateFilePermissionInput:t},{cache:n}){if(!t)return!1;const{fileId:a,shareUrl:o,shareId:r,scope:s}=t,l=i.Ps`
  fragment filePermissionUpdate on FileUpload {
    id
    shareUrl
    shareId
    permissionScope
  }
`;let c;const d=`FileUpload:${a}`;try{c=n.readFragment({fragment:l,id:d})}catch(e){throw e}if(!c)throw new Error("Expected initial files to be populated before a command is executed");const u={...c,shareUrl:o,shareId:r,permissionScope:s};return n.writeFragment({fragment:l,id:d,data:u}),!0},updatePermissionScopeInFileUpload(e,{updatePermissionScopeInput:t},{cache:n}){if(!t)return!1;const{fileId:a,scope:o}=t;if(!a)return!1;const r={permissionScope:o,__typename:"FileUpload"};try{n.writeFragment({fragment:i.Ps`
  fragment updatePermissionScope on FileUpload {
    permissionScope
  }
`,id:`FileUpload:${a}`,data:r})}catch(e){return!1}return!0},updateMessageApiFileProperties(e,{fileUploadRedeemPayload:t},{cache:n,loggerFactory:a}){const r=a.newLogger("updateMessageApiFileProperties","data-resolvers-browser-files");if(!t)return!1;const{fileId:s}=t;if(!s)return!1;const l=i.Ps`
  fragment filePropertiesUpdate on FileUpload {
    id
    sharepointIds
    site
    publication
  }
`;let c;const d=`FileUpload:${s}`;try{c=n.readFragment({fragment:l,id:d})}catch(e){throw e}if(!c)throw new Error("Expected initial files to be populated before a command is executed");if(c.sharepointIds?.siteUrl||c.site?.dataLocationCode||c.publication?.level){const e=`SWM file properties should already be populated via sharelink flow for fileId: ${s}`;return r.infoToTelemetry?.(e,"file_permission_client_resolvers",void 0,!0),!1}const u=o(c,t);try{n.writeFragment({fragment:l,id:d,data:u});const e=`Updated SWM file poperties for fileId: ${s}`;r.infoToTelemetry?.(e,"file_permission_client_resolvers",void 0,!0)}catch(e){const t=`Failed updating SWM file properties for fileId: ${s}`;return r.infoToTelemetry?.(t,"file_permission_client_resolvers",void 0,!0),!1}return!0}}},o=(e,t)=>({...e,sharepointIds:t.sharepointIds,site:t.site,publication:t.publication})},585189:(e,t,n)=>{"use strict";n.d(t,{A:()=>S,s_:()=>f});var i=n(683184),a=n(689626),o=n(543491),r=n(842070),s=n(691854),l=n(852793),c=n(702135),d=n(803238),u=n(771574);const m=e=>(0,u.A)(e)||"<scrubbed>",p=e=>e.map((e=>e.type)).sort().toString(),g=e=>new RegExp(/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i).test(e);var h=n(719799);let y;const v=e=>y||(y=e.newLogger("meeting-artifacts-resolvers","data-resolvers-browser-meeting-artifacts")),f={Query:{async meetingArtifacts(e,{meetingArtifactType:t,externalEntityKey:n,organizer:i,user:a,organizedByUserId:r,organizedByUserUpn:s},{getCollabObjectService:l,scenarioFactory:c,loggerFactory:d,callerApp:u}){const{scenario:g,correlationId:f}=(0,h.hg)(o.RG.ReadCollabObject,c),S=m(n);g.appendEventData({externalEntityKey:S}),v(d),y.log(`Read collab object for ${S}`);try{const e=await l(),o=await e.readCollabObject(f,n,i,a,r=r||"",s=s||"",u),c=(o?.resources||[]).filter((e=>e.type.toLowerCase()===t.toLowerCase())).map((e=>({id:e.id,type:C(e.type),location:e.location,metadata:e.metadata})));y.log(`type of resources received after reading collabObject ${p(c)}`);const d={changeKey:o?.changeKey,resources:c};return g.stop({message:p(c)}),d}catch(e){return(0,h.jq)(e,g),Promise.reject(e)}},async allMeetingArtifacts(e,{externalEntityKey:t,organizer:n,user:i,organizedByUserId:a,organizedByUserUpn:r},{getCollabObjectService:s,scenarioFactory:l,loggerFactory:c,callerApp:d}){const{scenario:u,correlationId:g}=(0,h.hg)(o.RG.ReadCollabObject,l),f=m(t);u.appendEventData({externalEntityKey:f}),v(c),y.log(`Read collab object to get all meeting artifacts for ${f}`);try{const e=await s(),o=await e.readCollabObject(g,t,n,i,a=a||"",r=r||"",d),l=(o?.resources||[]).filter((e=>b(e.type))).map((e=>({id:e.id,type:C(e.type),location:e.location,subType:e.subType,...e.metadata})));y.log(`type of resources received after reading collabObject to get all meeting artifacts are ${p(l)}`);const c={changeKey:o?.changeKey,resources:l};return u.stop({message:p(l)}),c}catch(e){return(0,h.jq)(e,u),Promise.reject(e)}},async allMeetingArtifactsBatch(e,{meetingArtifactsBatchInputList:t},{getCollabObjectService:n,scenarioFactory:i,loggerFactory:a}){const{scenario:r,correlationId:l}=(0,h.hg)(o.RG.ReadCollabObjectBatchRequest,i);v(a),y.log(`Read group of meeting artifacts for ${t.length} meetings start`);try{const e=await n(),i=await e.readCollabObjectBatchRequest(l,function(e){const t={collabIds:{}};return e.forEach((n=>{(0,s.v)(n.organizer)?e.forEach((e=>{t.collabIds={...t.collabIds,[e.iCalUid]:{smtp:e.organizer}}})):t.collabIds={...t.collabIds,[n.iCalUid]:{organizer:n.organizer}}})),t}(t)),a=function(e){const t=[];if(e?.collabMap){const n=e.collabMap;Object.keys(n).forEach((e=>{const i=n[e],a={iCalUid:e,value:{resources:(i.collab?.resources||[]).filter((e=>b(e.type))).map((e=>({id:e.id,type:C(e.type),location:e.location,subType:e.subType,...e.metadata})))}};t.push(a)}))}return t}(i);return y.log(`Read group of meeting artifacts for ${a.length} meetings success`),r.stop(),a}catch(e){return(0,h.jq)(e,r),Promise.reject(e)}},async reserveMeetingArtifact(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:a,meetingParams:r,organizedByUserId:s,organizedByUserUpn:l},{getCollabObjectService:c,scenarioFactory:d,loggerFactory:u,callerApp:p}){const{scenario:f,correlationId:S}=(0,h.hg)(o.RG.ReserveResourceToCollabObject,d),C=m(t),b=m(n);f.appendEventData({externalEntityKey:C,seriesExternalEntityKey:b}),v(u),y.log(`Reserve meeting artifact for instance externalEntityKey: ${C}, series externalEntityKey: ${b}`);try{if(s&&!g(s)){const e="organizedByUserId is not valid uuid";throw f.appendEventData({message:e}),new Error(e)}const e="Notes",o=await c(),d=await o.reserveResourceToCollabObject(S,function(e,t,n,i,a,o,r,s){return{type:e.toLowerCase(),externalEntityKey:t,seriesExternalEntityKey:n,meetingUrl:s.meetingUrl,threadId:s.threadId,messageId:s.messageId,organizerUpn:s.organizerUpn,organizer:i,user:r,organizedByUserId:a,organizedByUserUpn:o}}(e,t,n,i,s||i.split("@")[0],l||r.organizerUpn,a,r),p);if(d?.collab){const t=k(e,d);return f.stop(),{...d,collab:{changeKey:d?.collab.changeKey,resources:t}}}return f.stop(),d}catch(e){return(0,h.jq)(e,f),Promise.reject(e)}},async readAndOptionallyReserveMeetingArtifact(e,{externalEntityKey:t,organizer:n,user:i},{getCollabObjectService:a,scenarioFactory:r,loggerFactory:s,callerApp:l}){const{scenario:c,correlationId:d}=(0,h.hg)(o.RG.ReadAndOptionallyReserveResourceToCollabObject,r),u=m(t);c.appendEventData({externalEntityKey:u}),v(s),y.log(`Read and Optionally Reserve meeting artifact for instance externalEntityKey: ${u}`);try{const e="Notes",o=await a(),r=await o.readAndOptionallyReserveResourceToCollabObject(d,function(e,t,n,i){return{type:e.toLowerCase(),externalEntityKey:t,organizer:n,user:i}}(e,t,n,i),l);if(r?.collab){const t=k(e,r);return c.stop(),{...r,collab:{changeKey:r?.collab.changeKey,resources:t}}}return c.stop(),r}catch(e){return(0,h.jq)(e,c),Promise.reject(e)}}},Mutation:{async addMeetingArtifacts(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:a,user:o,meetingParams:r,meetingArtifacts:s,organizedByUserId:l,organizedByUserUpn:c},{getCollabObjectService:d,scenarioFactory:u,loggerFactory:m,callerApp:p,coreSettings:g}){const{enableSPODataInSaveArtifacts:h}=g.get(i.J.ArtifactsPlatform);return S(d,u,m,p,t,n,a,o,s,r,l||"",c||"",!!h)},async commitMeetingArtifact(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:a,secret:s,resourceUri:l,metadata:c},{getCollabObjectService:u,scenarioFactory:p,loggerFactory:g,callerApp:y}){const f=v(g),{scenario:S,correlationId:k}=(0,h.hg)(o.RG.CommitResourceToCollabObject,p);try{const e=await u(),o=m(t),p=m(n);return f.log(`commit Meeting Artifact to instance externalEntityKey: ${o}, series externalEntityKey: ${p}`),S.appendEventData({externalEntityKey:o,seriesExternalEntityKey:p}),s?(await e.commitResourceToCollabObject(k,function(e,t,n,i,a,o,r,s){const l=s??{};return{type:e.toLowerCase(),externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:a,secret:o,resourceUri:r,metadata:(0,d.omitBy)((0,h.SW)(l),d.isEmpty)}}("Notes",t,n,i,a,s,l,c),y),S.stop(),!0):(f.error("commit Meeting Artifact API called without secret"),S.fail({errorCode:r.py.INVALID_SECRET.toString(),message:r.WK.INVALID_SECRET}),!1)}catch(e){return(0,h.jq)(e,S),Promise.reject(e)}},async updateMeetingArtifacts(e,{externalEntityKey:t,seriesExternalEntityKey:n,organizer:i,user:s,meetingParams:l,changeKey:d,meetingArtifacts:u,organizedByUserId:y,organizedByUserUpn:f},{getCollabObjectService:S,scenarioFactory:k,loggerFactory:C,callerApp:b}){const w=v(C),{scenario:T,correlationId:I}=(0,h.hg)(o.RG.UpdateResourcesOnCollabObject,k),N=m(t),E=m(n);w.log(`Update meeting artifacts for externalEntityKey: ${N} and seriesExternalEntityKey: ${E}`);try{if(y&&!g(y)){const e="organizedByUserId is not valid uuid";throw T.appendEventData({externalEntityKey:N,seriesExternalEntityKey:E,message:e}),new Error(e)}const e=await S(),o=u??[];if(T.appendEventData({externalEntityKey:N,seriesExternalEntityKey:E,message:p(o)}),0===o.length){const e=(0,c.Tr)(a.w5.CmdArtifactsServiceClient,a.jK.InvalidInput,"meetingArtifactsResolver.updateMeetingArtifacts",{[r.zm.internalErrorCode]:r.py.EMPTY_INPUT,[r.zm.logErrorMessage]:r.WK.EMPTY_INPUT},r.WK.EMPTY_INPUT.toString());return(0,h.jq)(e,T),!1}return await e.updateResourcesOnCollabObject(I,function(e,t,n,i,a,o,r,s,l){return{externalEntityKey:e,seriesExternalEntityKey:t,organizer:n,user:i,meetingUrl:a.meetingUrl,threadId:a.threadId,messageId:a.messageId,organizerUpn:a.organizerUpn,changeKey:o,resources:(0,h.m6)(r),organizedByUserId:s,organizedByUserUpn:l}}(t,n,i,s,l,d,o,y||i.split("@")[0],f||l.organizerUpn),b),T.stop(),!0}catch(e){return(0,h.jq)(e,T),Promise.reject(e)}}},MeetingArtifactV2Union:{__resolveType:e=>"Transcript"===e.type?"MeetingArtifactV2Transcript":"TranscriptV2"===e.type?"MeetingArtifactV2TranscriptV2":"Recording"===e.type?"MeetingArtifactV2Recording":"Notes"===e.type?"MeetingArtifactV2Notes":"MeetingContent"===e.type?"MeetingArtifactV2MeetingContent":"MeetingArtifactV2Default"}};async function S(e,t,n,i,a,s,l,c,d,u,g,y,f){const S=v(n),{scenario:k,correlationId:C}=(0,h.hg)(o.RG.AddResourcesToCollabObject,t);k.appendEventData({callerApp:i});try{const t=await e(),n=m(a);S.log(`Adding meeting artifacts to externalEntityKey: ${n}`);const o=d??[];return k.appendEventData({externalEntityKey:n,message:p(o)}),0===o.length?(S.error("addMeetingArtifacts called with and empty array of meeting artifacts"),k.fail({errorCode:r.py.EMPTY_INPUT.toString(),message:r.WK.EMPTY_INPUT}),!1):(await t.addResourcesToCollabObject(C,(0,h.m_)(a,s,l,c,u,o,g,y,f),i),k.stop(),!0)}catch(e){return(0,h.jq)(e,k),Promise.reject(e)}}const k=(e,t)=>{const n=(0,l.j)()("Attachment","AttendanceReport","AttendanceReportV3","Decisions","ExplicitActionItems","ExternalParticipants","ImplicitActionItems","ManualActionItems","MeetingChat","MeetingCoach","MeetingContent","MeetingInfo","MeetingInfoV3","MeetingStage","NgcParticipantsActivity","Notes","Playground","Recommendation","Recording","Transcript","TranscriptEntities","TranscriptEvents","TranscriptV2");return t?.collab?.resources?.filter((t=>t.type.toLowerCase()===n.find((t=>t===e))?.toLowerCase())).map((e=>({...e,id:e.id,type:C(e.type),location:e.location,metadata:e.metadata,subType:e.subType})))},C=e=>{const t=(0,l.j)()("Attachment","AttendanceReport","AttendanceReportV3","Decisions","ExplicitActionItems","ExternalParticipants","ImplicitActionItems","ManualActionItems","MeetingChat","MeetingCoach","MeetingContent","MeetingInfo","MeetingInfoV3","MeetingStage","NgcParticipantsActivity","Notes","Playground","Recommendation","Recording","Transcript","TranscriptEntities","TranscriptEvents","TranscriptV2");for(const n of t)if(n.toLowerCase()===e.toLowerCase())return n;return e},b=e=>{const t=(0,l.j)()("Attachment","AttendanceReport","AttendanceReportV3","Decisions","ExplicitActionItems","ExternalParticipants","ImplicitActionItems","ManualActionItems","MeetingChat","MeetingCoach","MeetingContent","MeetingInfo","MeetingInfoV3","MeetingStage","NgcParticipantsActivity","Notes","Playground","Recommendation","Recording","Transcript","TranscriptEntities","TranscriptEvents","TranscriptV2");for(const n of t)if(n.toLowerCase()===e.toLowerCase())return!0;return!1}},414784:(e,t,n)=>{"use strict";n.d(t,{w:()=>o,s:()=>r});var i=n(92613),a=n(537041);const o={Query:{async meetingBotMetaInfo(e,t,n){const{getMeetingBotService:i}=n,a=await i();return{meetingBotMri:await a.getBotId(),__typename:"MeetingBotMetaInfo"}},async meetingBotCalendarEvents(e,{start:t,end:n},i){const a=await i.getMeetingBotService();return(await a.fetchCalendarEvents(t,n)).filter((e=>!e.isAllDayEvent&&e.isOnlineMeeting)).map((e=>({id:e.objectId,start:new Date(e.startTime).toUTCString(),end:new Date(e.endTime).toUTCString(),iCalUID:e.iCalUID,subject:e.subject,objectId:e.objectId,conversationId:e.skypeTeamsDataObj?.cid,skypeTeamsMeetingUrl:e.skypeTeamsMeetingUrl,isCancelled:e.isCancelled,isAllDayEvent:e.isAllDayEvent})))},meetingBotChatIdForCalendarEvent:async(e,{eventId:t},n)=>(await n.getMeetingBotService()).fetchChatIdForCalendarEvent(t)},Mutation:{async postMeetingStarted(e,{absentAttendees:t,hasRecordingStarted:n,meetingId:a,isForced:o},r){const s=await r.getMeetingBotService();if(!o&&s.isMeetingEventSent(a,i.$.MeetingStart))return"absentAttendee checked";if(s.setMeetingEventSent(a,i.$.MeetingStart),t&&t.length>0){const e=await s.postEventToBot({Scenario:i.$.MeetingStart,MeetingInfo:{HasRecordingStarted:n,AbsentAttendee:t}});return`${e?.status}`}return"no absent attendees"},async postGreetingToMeetingBot(e,{input:{meetingId:t,organizerId:n,recordingState:a,hasPresentedDeck:o,hasRecordingStarted:r,hasProactiveAction:s,absentAttendee:l,timeElapedSinceMeetingStartedInMinutes:c,hasNextMeeting:d,endTime:u,isRecurrent:m}},p){const g=await p.getMeetingBotService();if(g.isMeetingEventSent(t,i.$.InMeetingGreeting)||g.isMeetingEventSent(t,i.$.MeetingStart))return!1;g.setMeetingEventSent(t,i.$.InMeetingGreeting);return!!await g.postEventToBot({Scenario:i.$.InMeetingGreeting,MeetingInfo:{MeetingId:t,AbsentAttendee:l,OrganizerId:n,RecordingState:a,HasPresentedFile:o,HasProactiveAction:s,HasRecordingStarted:r,TimeElapedSinceMeetingStartedInMinutes:c,HasNextMeeting:d,EndTime:u,IsRecurrent:m,Subject:"Subject"}})},async tryStartMeetingBotPublisher(e,t,n){const{getMeetingBotService:i,loggerFactory:a}=n;a.newLogger("MeetingBot Resolver","data-resolvers-browser-meeting-artifacts").log("tryStartMeetingBotPublisher");const o=await i();return await o.startPublisher(),!0},async sendActionStatus(e,{botAction:t,isActionSucess:n,nextMeetingName:a},o){const r=await o.getMeetingBotService();return await r.postEventToBot({Scenario:i.$.InMeetingActionStatusUpdated,MeetingInfo:{InMeetingAction:t,IsActionSucceed:n,NextMeetingName:a}}),!0},async sendRunningLateForNextMeetingNotification(e,{iCalUID:t,subject:n,objectId:a,conversationId:o},r){const s=await r.getMeetingBotService();return await s.postEventToBot({Scenario:i.$.RunningLate,MeetingInfo:{CallId:t,ThreadId:o,Subject:n,MeetingUid:a}}),!0},async removeCalendarEvent(e,{eventId:t},n){const i=await n.getMeetingBotService();return await i.removeCalendarEvent(t),"Message sent"},sendMeetingBotMessage:async(e,{text:t,conversationId:n},i)=>(await i.getMeetingBotService()).sendMeetingBotMessage(t,n),async sendMeetingObjectId(e,{meetingObjectId:t},n){const a=await n.getMeetingBotService();return await a.postEventToBot({Scenario:i.$.InMeetingShareFile,MeetingInfo:{MeetingId:t}}),!0},reportUsageToMeetingBot:async(e,t,n)=>(await n.getMeetingBotService()).reportUsageToMeetingBot(),async triggerBotAction(e,{conversationId:t,botAction:n,actionId:i},a){const o=await a.getMeetingBotService(),r=await o.fetchChatIdForCalendarEvent(t);return a.pubsub.publish("meetingBotActionEvent",{meetingBotActionEvent:{conversationId:r,botAction:n,actionId:i},__typename:"meetingBotActionEvent"}),!0},async sendMessageToConversation(e,{conversationId:t,message:n,files:i},a){if(i&&!i.length)return!1;const o=await a.getMeetingBotService();return await o.sendToConversation(t,n,i),!0}}},r={Subscription:{meetingBotActionEvent:{subscribe:(0,a.OF)(((e,t,{pubsub:n})=>n.asyncIterator(["meetingBotActionEvent"])),((e,t)=>t.conversationId===e.meetingBotActionEvent.conversationId))}}}},675907:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserMeetingRoomMeetingRoomFrontOfRoomCallPanelsStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meetingRoomFrontOfRoomCallPanelsState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"rightPanel"}}]}}]}}]}},979963:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var i=n(452459),a=n(675907);const o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversBrowserMeetingRoomWhiteboardWalkUpStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"whiteboardWalkUpState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},r={Query:{meetingRoomFrontOfRoomCallPanelsState:(e,{teamsCallId:t},{cache:n})=>{let o=(0,i.n1)(t);try{const e=n.readQuery({query:a.Z,variables:{teamsCallId:t}}),i=e?.meetingRoomFrontOfRoomCallPanelsState;o=i??o}catch(e){}return o},whiteboardWalkUpState:(e,t,{cache:n,loggerFactory:i})=>{try{const e=n.readQuery({query:o});return e?.whiteboardWalkUpState??"Inactive"}catch(e){const t=i?.newLogger("whiteboardWalkUpState","data-resolvers-browser-meeting-room");t?.error("failed to get data")}return"Inactive"}},Mutation:{setMeetingRoomFrontOfRoomCallPanelsState:(e,{teamsCallId:t,state:n},{cache:o,loggerFactory:r})=>{const s=r?.newLogger("setMeetingRoomFrontOfRoomCallPanelsState","data-resolvers-browser-meeting-room");let l=(0,i.n1)(t);try{const e=o.readQuery({query:a.Z,variables:{teamsCallId:t}});e?.meetingRoomFrontOfRoomCallPanelsState&&(l=e.meetingRoomFrontOfRoomCallPanelsState)}catch(e){s?.error("No data found in cache for meetingRoomFrontOfRoomCallPanelsState, using default value")}const c={__typename:"MeetingRoomFrontOfRoomCallPanelsState",id:l.id,rightPanel:n.rightPanel??null};try{o.writeQuery({query:a.Z,variables:{teamsCallId:t},data:{meetingRoomFrontOfRoomCallPanelsState:c}})}catch(e){s?.error("setMeetingRoomFrontOfRoomCallPanelsState to cache failed.")}return c},updateWhiteboardWalkUpState:async(e,{state:t},{cache:n,loggerFactory:i})=>{const a=i?.newLogger("updateWhiteboardWalkUpState","data-resolvers-browser-meeting-room");try{n.writeQuery({query:o,data:{whiteboardWalkUpState:t.whiteboardWalkUpState}})}catch(e){a?.error("updateWhiteboardWalkUpState to cache failed.")}return!0}}}},452459:(e,t,n)=>{"use strict";n.d(t,{n1:()=>i,vq:()=>a});const i=e=>({__typename:"MeetingRoomFrontOfRoomCallPanelsState",id:e,rightPanel:null}),a=async({entrypointType:e,dataRequestContext:t,callback:n})=>{const{getCallingService:i,loggerFactory:a,cancellationListener:r}=t,s=a.newLogger("invokeCallingApi","data-resolvers-browser-meeting-room"),l=await i(e);return s.log(`Emitting meeting-room event request via api for endpoint: ${e}`),n(l,o(),r)},o=()=>({hostRendererId:"",component:"Resolver"})},890797:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});const i="payment-service"},342689:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var i=n(890797),a=n(434794);let o;const r={Mutation:{updatePaymentDetailsInCache:(e,{eventId:t,paymentDetails:n},{cache:r,loggerFactory:s})=>{(e=>{o||(o=e.newLogger(i.k,"data-resolvers-browser-payment"))})(s);try{const e={...r.readQuery({query:a.Z,variables:{eventId:t}})?.paymentDetails||{},...n,__typename:"PaymentDetails"};return r.writeQuery({query:a.Z,variables:{eventId:t},data:{paymentDetails:e}}),{...e,__typename:"PaymentDetails"}}catch(e){throw o.error("Payment client resolver failed to update payment details in cache",e),e}}}}},434794:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"paymentDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paymentDetails"},arguments:[{kind:"Argument",name:{kind:"Name",value:"eventId"},value:{kind:"Variable",name:{kind:"Name",value:"eventId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"eventId"}},{kind:"Field",name:{kind:"Name",value:"paymentProvider"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"product"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"price"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"amount"}},{kind:"Field",name:{kind:"Name",value:"currency"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}}]}}]}}]}}]}}]}},14866:(e,t,n)=>{"use strict";n.d(t,{w:()=>a});var i=n(316877);const a={Query:{},Mutation:{async sendMeetingAgenda(e,{callId:t,agenda:n,notesUrl:a},{getTeamsCopilotService:o,loggerFactory:r,callerApp:s}){const l=r.newLogger("teams-copilot-resolvers","components-meeting-collaboration");try{const e=(0,i.v4)(),r=await o(),c={callId:t,agenda:n,notesUrl:a},d=await r.addCopilotResources(e,c,s);return d.body?d.body:(l.log("No response from teams copilot service"),Promise.reject("No response teams copilot service"))}catch(e){return l.log(`Could not save meeting agenda ${e?.errorCode}`),Promise.reject(e)}},async sendCalendarEvent(e,{callId:t,calendarEvent:n},{getTeamsCopilotService:a,loggerFactory:r,callerApp:s}){const l=r.newLogger("teams-copilot-resolvers","components-meeting-collaboration");try{const e=(0,i.v4)(),r=await a(),c={callId:t,calendarEvent:o(n)},d=await r.saveCalendarData(e,c,s);return d?.body?d?.body:(l.log("No response from teams copilot service"),Promise.reject("No response teams copilot service"))}catch(e){return l.log(`Could not save calendar event ${e?.errorCode}`),Promise.reject(e)}},async sendCalendarEventV2(e,{callId:t,calendarEvent:n},{getTeamsCopilotService:a,loggerFactory:o,callerApp:r}){const s=o.newLogger("teams-copilot-resolvers","components-meeting-collaboration");try{const e=(0,i.v4)(),o=await a(),l={callId:t,calendarEvent:n},c=await o.saveCalendarDataV2(e,l,r);return c?.body?c?.body:(s.log("No response from teams copilot service"),Promise.reject("No response teams copilot service"))}catch(e){return s.log(`Could not save calendar event v2 ${e?.errorCode}`),Promise.reject(e)}},async sendConfiguationEvent(e,{callId:t,requestUrl:n,tcsEndpointUrl:a},{getTeamsCopilotService:o,loggerFactory:r,callerApp:s}){const l=r.newLogger("teams-copilot-resolvers","components-meeting-collaboration");try{const e=(0,i.v4)(),r=await o(),l={callId:t,requestUrl:n,tcsEndpointUrl:a},c=await r.sendConfigurationData(e,l,s);return c?.body?c?.body:Promise.reject("No response from copilot bot")}catch(e){return l.error(`Could not send configuration  event v2 ${e?.errorCode}`),Promise.reject(e)}}}},o=e=>({CallCopilotEventDetails:{id:e.callCopilotEventDetails.id,startTime:e.callCopilotEventDetails.startTime,endTime:e.callCopilotEventDetails.endTime,eventType:e.callCopilotEventDetails.eventType,iCalUid:e.callCopilotEventDetails.iCalUid,isCancelled:e.callCopilotEventDetails.isCancelled,subject:e.callCopilotEventDetails.subject}})},505429:(e,t,n)=>{"use strict";n.d(t,{w:()=>m});var i=n(405654),a=n(803238);function o(e,t){return e.isUserMuted?"MutedTeamMember":function(e,t){return t.isGeneral&&"Admin"!==e.memberRole&&function(e){return e.teamSettings&&"OwnersPost"===e.teamSettings.generalChannelPosting}(e)}(e,t)?"OnlyOwnersCanPost":"None"}var r=n(786067);function s(e,t){return{id:t.id,channelType:c(t.channelType),isGeneral:t.isGeneral||!1,displayName:t.displayName,disallowedToPostReason:o(e,t),consumptionHorizon:t.consumptionHorizon?{...t.consumptionHorizon,__typename:"ClientConsumptionHorizon"}:null,filesRelativePath:t.defaultFileSettings?.filesRelativePath||null,memberRole:d(t.memberRole),isModerator:t.isModerator||!1,channelSettings:{__typename:"ChannelSettings",channelPostPermissions:u(t.channelSettings?.channelPostPermissions)},sharepointSiteUrl:t.sharepointSiteUrl||null,team:{id:e.id,displayName:e.displayName,groupId:e.teamSiteInformation.groupId,sharepointSiteUrl:e.teamSiteInformation.sharepointSiteUrl||null,pictureETag:e.pictureETag||null,smtpAddress:e.smtpAddress,teamSettings:e.teamSettings,__typename:"ClientTeam"},isArchived:t.isArchived,isDeleted:t.isDeleted,__typename:"ChannelWithTeam"}}function l(e){return(0,a.flatMap)(e,(e=>e.filteredChannels.map(s.bind(void 0,e))))}function c(e){switch(e){case"Standard":return"Standard";case"Private":return"Private";case"Shared":return"Shared";default:return null}}const d=e=>{switch(e){case"Admin":return"Admin";case"Guest":return"Guest";case"User":return"User";default:return"Undefined"}},u=e=>{switch(e){case"Moderators":return"Moderators";case"EveryoneButGuests":return"EveryoneButGuests";default:return"Everyone"}},m={Query:{channelSearch:async(e,{searchQuery:t},n)=>{let i=await p(n);if(0===i.length)return{__typename:"ChannelSearchResults",resultsByChannelName:[],resultsByTeamName:[]};i=i.filter((e=>!e.isDeleted)).map((e=>({...e,channels:e.channels.filter((e=>!e.isDeleted))})));const o=new RegExp((0,a.escapeRegExp)(t.toLowerCase())),r=(0,a.cloneDeep)(i).filter((e=>o.test(e.displayName.toLowerCase()))).map((e=>(e.filteredChannels=e.channels,e)));return{__typename:"ChannelSearchResults",resultsByChannelName:l(i.map((e=>(e.filteredChannels=e.channels.filter((e=>o.test(e.displayName.toLowerCase()))),e)))),resultsByTeamName:l(r)}},channel:async(e,{channelId:t},n)=>{const i=await p(n);let o;return(0,a.forEach)(i,(e=>{const n=(0,a.find)(e.channels,{id:t});return!n||(o=s(e,n),!1)})),o}}};async function p(e){const{authenticationUser:t,cache:n,coreSettings:a,localStorage:o,loggerFactory:s,scenarioFactory:l}=e;let c;try{({teams:c}=n.readQuery({query:i.T}))}catch(e){s.newLogger("ClientResolvers","data-resolvers-browser-teams").warn("Cache error, returning empty data instead");const d=t&&await(0,r.Qp)(t,a,o,l);if(d){const e=d.map(r.uX);n.writeQuery({query:i.T,data:{teams:e}})}c=d||[]}return c}},405654:(e,t,n)=>{"use strict";n.d(t,{T:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"teamsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"isUserMuted"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"smtpAddress"}},{kind:"Field",name:{kind:"Name",value:"pictureETag"}},{kind:"Field",name:{kind:"Name",value:"teamSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"generalChannelPosting"}}]}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"channels"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"isGeneral"}},{kind:"Field",name:{kind:"Name",value:"isShown"}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}}]}},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"}}]}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"channelSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelPostPermissions"}}]}},{kind:"Field",name:{kind:"Name",value:"isModerator"}}]}}]}}]}}]}},786067:(e,t,n)=>{"use strict";n.d(t,{uX:()=>k,Qp:()=>E,xm:()=>P,GC:()=>x});var i=n(803238),a=n(683184),o=n(543491),r=n(768896),s=n(569864),l=n(309501),c=n(981917),d=n(325506),u=n(191366);const m=7,p=2,g="conversations",h="skypexspaces",y="Teams:conversation-manager",v="teams-list",f=7;function S(e){return{__typename:"Channel",...(0,i.defaults)((0,i.pick)(e,["id","channelType","displayName","isArchived","isDeleted","isGeneral","isModerator","isShown","memberRole"]),{channelType:null,isArchived:null,isDeleted:null,isModerator:null,memberRole:null}),channelSettings:(0,i.defaults)(e.channelSettings,{__typename:"ChannelSettings",channelPostPermissions:null}),defaultFileSettings:{__typename:"DefaultFileSettings",filesRelativePath:e.defaultFileSettings?.filesRelativePath||null},sharepointSiteUrl:e.sharepointSiteUrl||null,...e.consumptionHorizon?.id?{consumptionHorizon:{__typename:"ConsumptionHorizon",id:e.consumptionHorizon.id,timeStamp:e.consumptionHorizon.timeStamp||null}}:{consumptionHorizon:null}}}function k(e){return{__typename:"Team",...(0,i.defaults)((0,i.pick)(e,["id","displayName","isDeleted","isUserMuted","memberRole","smtpAddress","pictureETag","teamType"]),{isUserMuted:null,pictureETag:null,smtpAddress:null,teamType:null}),teamSettings:{__typename:"TeamSettings",generalChannelPosting:e.teamSettings?.generalChannelPosting||null},teamSiteInformation:{__typename:"TeamSiteInformation",...(0,i.defaults)((0,i.pick)(e.teamSiteInformation,["groupId","sharepointSiteUrl"]),{groupId:null,sharepointSiteUrl:null})},channels:(e.channels||[]).map(S)}}function C(e){try{return JSON.parse(e)}catch(e){return}}function b(e){if(!e||0===e.length)return;const t=new Map,n=new Map;e.filter((e=>e&&(0,s.HU)(e))).map((e=>t.set(e.id,function(e){const t=e.threadProperties;return{id:e.id,displayName:t[l.Q5.SpaceThreadTopic]||"",isDeleted:(0,s.uY)(e),memberRole:N(e.memberProperties?.role||l.nL.None),teamSiteInformation:{groupId:t[l.Q5.GroupId]||"",sharepointSiteUrl:t[l.Q5.SiteUrl]},smtpAddress:t[l.Q5.TeamSmtpAddress],pictureETag:t[l.Q5.PictureETag],isFavorite:(0,s.Dq)(e),channels:[],...I(e)}}(e)))),e.filter((e=>e&&(0,s.J6)(e)&&e.threadProperties)).map((e=>n.set(e.id,{teamId:e.threadProperties[l.Q5.SpaceId],channel:w(e)}))),n.forEach((e=>{const{teamId:n,channel:i}=e,a=n&&t.get(n);a&&(i.team=a,a.channels.push(i))}));const i=Array.from(t.values());return i.length>0?i:void 0}function w(e){const t=e.threadProperties,n=t[l.Q5.SpaceTypes]===c.tG.Private;return{id:e.id,displayName:(n?t[l.Q5.SpaceThreadTopic]:(0,s.T7)(e))||"",description:t[l.Q5.TopicDescription]||"",isDeleted:(0,s.uY)(e),isGeneral:(0,s.HU)(e),channelType:T(t[l.Q5.SpaceTypes]),tabs:[],isShown:(0,s.Dq)(e),isShownByDefault:"true"===t[l.Q5.FavDefault],sharepointSiteUrl:n?t[l.Q5.SiteUrl]:void 0,defaultFileSettings:{filesRelativePath:t[l.Q5.FolderRelativeUrl]},consumptionHorizon:(0,d.CH)(e)}}function T(e){switch(e){case c.tG.Private:return"Private";case c.tG.Shared:return"Shared";case c.tG.None:default:return"Standard"}}function I(e){const t=C(e.threadProperties[l.Q5.TeamAdminSettings]);return t?{teamSettings:t.userSettings,teamGuestSettings:t.guestSettings}:{teamSettings:{}}}function N(e){switch(e){case l.nL.Admin:return"Admin";case l.nL.Guest:return"Guest";case l.nL.User:return"User";case l.nL.None:default:return"Undefined"}}async function E(e,t,n,i){const{enableChannelLocalCache:o,channelLocalCacheMaxDays:r,enableChannelIndexedDBCache:s,disableChannelIndexedDBNextCache:l}=t.get(a.J.Search);let c,d=!1;if(s&&(c=await P(e.profile.objectId,e.profile.tenantId,i,!!l),d=void 0!==c),o&&(function(e,t){const n=M(e),i=new Date(Date.now()),a=new Date(n?.timestamp||0);a.setDate(a.getDate()+t),a<i&&e.remove(v)}(n,d?0:r||f),!c)){const e=M(n);c=e?.teams}return c}let A;const _=3e5;let F;const D=(0,u.J)();async function P(e,t,n,i){return A||(A=async function(e,t,n,i){const a=n.newScenario(o.RG.GetTeamsChannelsFromIndexedDB),s=async i=>{try{return await async function(e,t,n,i){const a=function(e,t,n){return n?`${y}:${t}:${e}`:`${h}-${e}`}(e,t,n),o=function(e){return e?p:m}(n);return(0,r.q8)(a,o,g,"",i,!0)}(e,t,i,n)}catch(e){return void a.appendEventData({errors:JSON.stringify(e)})}};let l;i||(l=await s(!0));l||(l=await s(!1));if(!l)return void a.fail({errors:"unable to read conversations from indexedbd"});try{const e=b(l);return a.stop({message:e?"Successfully fetched.":"Conversations store does not contain any teams or channels."}),e}catch{return void a.fail({errors:"Fails to convert conversations to teams."})}}(e,t,n,i),F=D.setTimeout((()=>{A=void 0,D.clearTimeout(F),F=void 0}),_),A)}function M(e){const t=e.get(v);if(t)return C(t)}function x(e,t){e.trySet(v,JSON.stringify({timestamp:Date.now(),teams:t}),"Messaging")}},973325:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});const i="webinar-service"},409784:(e,t,n)=>{"use strict";n.d(t,{C:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webinarImageQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webinarImage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"webinarId"},value:{kind:"Variable",name:{kind:"Name",value:"webinarId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"image"}}]}}]}}]}},924992:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"webinar"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"webinarId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"webinar"},arguments:[{kind:"Argument",name:{kind:"Name",value:"webinarId"},value:{kind:"Variable",name:{kind:"Name",value:"webinarId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"allWebinarFiels"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"allWebinarFiels"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Webinar"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"eventDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"startTime"}},{kind:"Field",name:{kind:"Name",value:"endTime"}},{kind:"Field",name:{kind:"Name",value:"accessPolicy"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"isFull"}},{kind:"Field",name:{kind:"Name",value:"privacyProfileStatementLink"}},{kind:"Field",name:{kind:"Name",value:"capacity"}},{kind:"Field",name:{kind:"Name",value:"price"}}]}},{kind:"Field",name:{kind:"Name",value:"speakerBios"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"speakerId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}},{kind:"Field",name:{kind:"Name",value:"questionnaire"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"questionId"}},{kind:"Field",name:{kind:"Name",value:"order"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"options"}},{kind:"Field",name:{kind:"Name",value:"isRequired"}},{kind:"Field",name:{kind:"Name",value:"isPredefined"}}]}},{kind:"Field",name:{kind:"Name",value:"isUserAlreadyRegistered"}},{kind:"Field",name:{kind:"Name",value:"joinLink"}},{kind:"Field",name:{kind:"Name",value:"participantRole"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"registrationId"}},{kind:"Field",name:{kind:"Name",value:"paymentTransactionId"}}]}}]}.definitions]}},878870:(e,t,n)=>{"use strict";n.d(t,{O:()=>a,a:()=>o});var i=n(924992);const a=(e,t)=>{try{const n=e.readQuery({query:i.H,variables:{webinarId:t}});if(!n||!n.webinar)throw new Error("Invalid cached webinar data");return n.webinar}catch(e){throw e}},o=(e,t,n,o)=>{try{const o={...a(n,e),questionnaire:t.map((e=>({...e,name:e.name??null,displayName:e.displayName??null,options:e.options??null,__typename:"WebinarQuestion"})))};n.writeQuery({variables:{webinarId:e},query:i.H,data:{webinar:o}})}catch(e){throw o.error("Webinar resolver fails to update webinar questions in cache."),e}}},466648:(e,t,n)=>{"use strict";n.d(t,{s:()=>c});var i=n(973325),a=n(924992),o=n(409784),r=n(878870);let s;const l=e=>s||(s=e.newLogger(i.k,"data-resolvers-browser-webinar")),c={Mutation:{updateWebinarDetails:(e,{webinarId:t,detailsInput:n},{cache:i,loggerFactory:o})=>{l(o);try{const e=(0,r.O)(i,t),o={...e,eventDetails:{...e.eventDetails,...n,__typename:"WebinarDetails"}};return i.writeQuery({variables:{webinarId:t},query:a.H,data:{webinar:o}}),{_:!0,__typename:"Webinar"}}catch(e){throw s.error("Webinar resolver fails to update webinar details in cache."),e}},updateWebinarQuestions:(e,{webinarId:t,questionsInput:n},{cache:i,loggerFactory:a})=>(l(a),(0,r.a)(t,n,i,s),{_:!0,__typename:"Webinar"}),updateWebinarSpeakers:(e,{webinarId:t,speakersInput:n},{cache:i,loggerFactory:o})=>{l(o);try{const e={...(0,r.O)(i,t),speakerBios:n.map((e=>({...e,__typename:"WebinarSpeakerBio"})))};return i.writeQuery({variables:{webinarId:t},query:a.H,data:{webinar:e}}),{_:!0,__typename:"Webinar"}}catch(e){throw s.error("Webinar resolver fails to update webinar speakers in cache."),e}},updateWebinarImage:(e,{webinarId:t,webinarImageInput:n},{cache:i,loggerFactory:a})=>{l(a);try{return i.writeQuery({variables:{webinarId:t},query:o.C,data:{webinarImage:{image:n.image,__typename:"WebinarImage"}}}),{_:!0,__typename:"Webinar"}}catch(e){throw s.error("Webinar resolver fails to update webinar image in cache."),e}}}}},692741:(e,t,n)=>{"use strict";n.d(t,{Mv:()=>o,kO:()=>r,a2:()=>l,LH:()=>c,sU:()=>d,I_:()=>u});var i=n(803238),a=n(443089);async function o(e,t){return s(e,t)}async function r(e,t,n,i){return s(e,t,n,i)}async function s(e,t,n,o){const r=(0,i.uniqBy)(e,(e=>e)),s=(0,i.chunk)(r.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT),l=await Promise.all(s.map((async e=>{const i=await t.getPeopleProfilesByMris(e,n,!0,!1,!0);return await u(i,n,o),i})));let c=[];return l.forEach((e=>{c=c.concat(Array.from(e.values(),(e=>(0,a.ne)(e))))})),c}async function l(e,t,n){const o=(0,i.uniqBy)(e,(e=>e)),r=(0,i.chunk)(o.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(await Promise.all(r.map((e=>t.getPeopleProfilesIncludeFederatedByMris(e,!0,!1,n))))).map((e=>Array.from(e.values(),(e=>(0,a.ne)(e))))).reduce(((e,t)=>e.concat(t)),[])}async function c(e,t,n){const o=(0,i.uniqBy)(e,(e=>e)),r=(0,i.chunk)(o.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(await Promise.all(r.map((e=>t.getTflConsumerProfilesByMris(e,n||null))))).map((e=>Array.from(e.values(),(e=>(0,a.ne)(e))))).reduce(((e,t)=>e.concat(t)),[])}async function d(e,t,n){const o=(0,i.uniqBy)(e,(e=>e)),r=(0,i.chunk)(o.map((e=>e)),t.MAX_PEOPLE_MRI_LIMIT);return(await Promise.all(r.map((e=>t.getSkypeConsumerProfilesByMris(e,n||null))))).map((e=>Array.from(e.values(),(e=>(0,a.ne)(e))))).reduce(((e,t)=>e.concat(t)),[])}const u=async(e,t,n)=>{n&&await n.combineFeatureSettingsWithProfiles(e,t||"combine feature settings")}},418342:(e,t,n)=>{"use strict";n.d(t,{P:()=>r});var i=n(893895),a=n(667232),o=n(589773);const r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"chatFieldsWithCachedTitle"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"shortTitle"}},{kind:"Field",name:{kind:"Name",value:"creator"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"picture"}},{kind:"Field",name:{kind:"Name",value:"guardianChatInfo"}},{kind:"Field",name:{kind:"Name",value:"groupTemplate"}},{kind:"Field",name:{kind:"Name",value:"isBotBlocked"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOneBotChat"}},{kind:"Field",name:{kind:"Name",value:"isDisabled"}},{kind:"Field",name:{kind:"Name",value:"isMuted"}},{kind:"Field",name:{kind:"Name",value:"lastMessage"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatListItemLastMessageFragment"}}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatListItemLastUpdateFragment"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeLastUpdate"}}}]}]},{kind:"Field",name:{kind:"Name",value:"memberCount"}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"hasFederatedUser"}},{kind:"Field",name:{kind:"Name",value:"hasTflSmsVerifiedUser"}},{kind:"Field",name:{kind:"Name",value:"hasTflConsumerUser"}},{kind:"Field",name:{kind:"Name",value:"cfet"}},{kind:"Field",name:{kind:"Name",value:"hasTypingUsers"}},{kind:"Field",name:{kind:"Name",value:"tflOffNetworkUserLength"}},{kind:"Field",name:{kind:"Name",value:"isUserMember"}},{kind:"Field",name:{kind:"Name",value:"localClientId"}},{kind:"Field",name:{kind:"Name",value:"isRead"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"isSfB"}},{kind:"Field",name:{kind:"Name",value:"isSmsOnly"}},{kind:"Field",name:{kind:"Name",value:"isFederated"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}},{kind:"Field",name:{kind:"Name",value:"isMeeting"}},{kind:"Field",name:{kind:"Name",value:"extendedDirectoryRedemptionRequired"}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}},{kind:"Field",name:{kind:"Name",value:"isBotMember"}},{kind:"Field",name:{kind:"Name",value:"hasMissedCall"}},{kind:"Field",name:{kind:"Name",value:"hasMissedMention"}},{kind:"Field",name:{kind:"Name",value:"hasMissedReaction"}},{kind:"Field",name:{kind:"Name",value:"arrivalTimeAriaLabel"}},{kind:"Field",name:{kind:"Name",value:"quarantineCounter"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}},{kind:"Field",name:{kind:"Name",value:"isPhonelinkSmsChat"}},{kind:"Field",name:{kind:"Name",value:"interopConversationStatus"}},{kind:"Field",name:{kind:"Name",value:"activeCall"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActiveCallFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"oneOnOneOtherMemberId"}}]}},...i.C.definitions,...a.m.definitions,...o.E.definitions]}},393878:(e,t,n)=>{"use strict";n.d(t,{h:()=>r});var i=n(418342),a=n(333204),o=n(608372);const r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chatListWithCachedTitle"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"recentChatsFirst"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"recentChatsAfter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsFirst"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsAfter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsLocale"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}},type:{kind:"NamedType",name:{kind:"Name",value:"ChatTypeFilter"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includePinnedChats"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedContacts"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"excludePinnedChatsFromRecents"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!0}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"alwaysShowSuggestedContacts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxChatCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}},defaultValue:{kind:"IntValue",value:"0"}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedGroupChats"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeTopFixedChatListItems"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeLastUpdate"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recentsChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"recentChatsFirst"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"recentChatsAfter"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}}},{kind:"Argument",name:{kind:"Name",value:"excludePinnedChats"},value:{kind:"Variable",name:{kind:"Name",value:"excludePinnedChatsFromRecents"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"chatFieldsWithCachedTitle"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatListChannelConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatListChannelConversationFragment"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pinnedChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includePinnedChats"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"chatFieldsWithCachedTitle"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatListChannelConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatListChannelConversationFragment"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",alias:{kind:"Name",value:"suggestedContacts"},name:{kind:"Name",value:"suggestedContactsInChatList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsFirst"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsAfter"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"locale"},value:{kind:"Variable",name:{kind:"Name",value:"suggestedContactsLocale"}}},{kind:"Argument",name:{kind:"Name",value:"alwaysShowSuggestedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"alwaysShowSuggestedContacts"}}},{kind:"Argument",name:{kind:"Name",value:"filterOutFrequentlyUsedContacts"},value:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedContacts"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"}},{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"phone"}},{kind:"Field",name:{kind:"Name",value:"dbKey"}},{kind:"Field",name:{kind:"Name",value:"userType"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"suggestedGroupChats"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeSuggestedGroupChats"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"groupChatName"}},{kind:"Field",name:{kind:"Name",value:"groupChatMembers"}},{kind:"Field",name:{kind:"Name",value:"chatListDummyItemDisplayName"}},{kind:"Field",name:{kind:"Name",value:"chatListDummyItemSubtitle"}}]}},{kind:"Field",name:{kind:"Name",value:"frequentlyUsedContacts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"maxChatCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxChatCount"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeFrequentlyUsedContacts"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"phone"}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"topFixedChats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}},{kind:"Argument",name:{kind:"Name",value:"typeFilter"},value:{kind:"Variable",name:{kind:"Name",value:"typeFilter"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeTopFixedChatListItems"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"chatFieldsWithCachedTitle"}},{kind:"Field",name:{kind:"Name",value:"missedActivities"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"includeMissedActivities"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatMissedActivitiesOfConversationFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"ariaLabelledBy"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ChatListChannelConversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChatListChannelConversationFragment"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"cursor"}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startCursor"}},{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}}]}},...i.P.definitions,...a.B.definitions,...o.o.definitions]}},209661:(e,t,n)=>{"use strict";n.d(t,{g:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataResolversConnectedCalendarShowHardDeleteSurfaceDialogQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shouldShowHardDeleteConnectedCalendarSurfaceDialog"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},57281:(e,t,n)=>{"use strict";n.d(t,{s:()=>a});var i=n(209661);const a={Mutation:{setShouldShowHardDeleteConnectedCalendarSurfaceDialog:async(e,{showDialog:t},{cache:n,loggerFactory:a})=>{try{n.writeQuery({query:i.g,data:{shouldShowHardDeleteConnectedCalendarSurfaceDialog:t}})}catch(e){a.newLogger("setShouldShowHardDeleteConnectedCalendarSurfaceDialogMutation","data-resolvers-connected-calendar").error("Failed to write to client cache the show hard-delete connected calendar surface dialog mutation")}return t}}}},465263:(e,t,n)=>{"use strict";n.d(t,{y:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"localizationSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"localizationSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"currentLocale"}}]}}]}}]}},244740:(e,t,n)=>{"use strict";n.d(t,{s:()=>r});var i=n(465263),a=n(66432),o=n(923671);const r={Query:{async localizationSettings(e,t,{hostCommunicationService:n,platformService:i,routingServices:r,i18n:s}){const d=await c(r.state.getSearchState()||{});if(d)return{currentLocale:d};if(localStorage.getItem("localeCode"))return{currentLocale:localStorage.getItem("localeCode")};if(i.config.clientType===a.Bh.Web)return{currentLocale:s.locale};let u;try{const e=await l(n);e?(u=(0,o.vw)(e).locale,await s.setLocale(u)):u=s.locale}catch{u=s.locale}return{currentLocale:u}}},Mutation:{async updateCurrentLocale(e,{newLocale:t},{cache:n,hostCommunicationService:o,loggerFactory:r,platformService:l,i18n:c}){try{const e={localizationSettings:{__typename:"LocalizationSettings",currentLocale:t}};return await c.setLocale(t),localStorage.setItem("localeCode",t),n.writeQuery({query:i.y,data:e}),l.config.clientType!==a.Bh.Web&&await s(r,o,t),{currentLocale:t}}catch{return{currentLocale:c.locale}}}}},s=async(e,t,n)=>{const i=e.newLogger("LocalizationSettingsResolvers","data-resolvers-localization-settings");try{const e=await t.loadModule("osutils");await(e?.setAppLocale?.({localeName:n}))||i.warn("hostingCommunicationService language set has failed")}catch(e){i.warn("hostingCommunicationService failed to load")}},l=async e=>{const t=await e.loadModule("osutils"),n=await(t?.getAppLocale?.());return n?.localeName},c=async e=>{if(e.localeCode)return e.localeCode;if(e.language)return e.language.toLowerCase();if(!e.setting)return;const t=e.setting;let n;if(Array.isArray(t)){for(const e of t)if(e.startsWith("localeCode:")){n=e;break}}else t.startsWith("localeCode:")&&(n=t);return n?n.split(":")[1]:void 0}},928470:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{$p:()=>i,fg:()=>a,YQ:()=>o}),function(e){e.InviteJoined="InviteJoined",e.TeamsTasks="TeamsTasks",e.GroupMessage="GroupMessage",e.Message="Message",e.Follow="Follow",e.Reply="Reply",e.PersonalReply="PersonalReply",e.ReplyToReply="ReplyToReply"}(i||(i={})),function(e){e.joinInvite="joinInvite",e.teamsTasks="teamsTasks",e.communityFollow="communityFollow",e.communityReplyToReply="communityReplyToReply",e.communityReply="communityReply"}(a||(a={})),function(e){e.inviteeJoined="inviteeJoined",e.tFLPlanCreated="tFLPlanCreated",e.communityNewMessage="communityNewMessage",e.communityReplyMessage="communityReplyMessage"}(o||(o={}))},54927:(e,t,n)=>{"use strict";var i;n.d(t,{yH:()=>i,zc:()=>a,bJ:()=>o,V6:()=>r}),function(e){e.Chat="chat",e.Channel="channel",e.SyntheticNotification="syntheticNotification",e.Communities="communities",e.GraphItemToast="graphItemToast"}(i||(i={}));var a;!function(e){e.FILE="file",e.IMAGE="image",e.VOICE="voice",e.LOCATION="location",e.TEXT="text",e.VIDEO="video"}(a||(a={}));const o="giphy.com",r="bfb101ece45946be988be560a74322f2"},993704:(e,t,n)=>{"use strict";n.d(t,{St:()=>a});const i={about:"about",markAllAsRead:"markAllAsRead",blockUnblockBotChat:"blockUnblockBotChat",newChat:"newChat",popNewChat:"popNewChat"},a={PlatformEvents:i}},28950:(e,t,n)=>{"use strict";n.d(t,{R_:()=>i,U3:()=>a});const i={leaveBroadcastQualityFeedback:"leaveBroadcastQualityFeedback"},a={leaveBroadcastQualityFeedback:()=>({originator:"Broadcast",type:i.leaveBroadcastQualityFeedback})}},915323:(e,t,n)=>{"use strict";n.d(t,{kn:()=>i,U3:()=>r,qh:()=>s});const i="MessageThreading",a="openThreadPane",o="hideThreadPane",r={openThreadPane:e=>({originator:i,type:a,data:()=>e}),hideThreadPane:e=>({originator:i,type:o,data:()=>e})},s={isOpenThreadPaneEvent:e=>e.type===a,isHideThreadPaneEvent:e=>e.type===o}},822582:(e,t,n)=>{"use strict";n.d(t,{uS:()=>i,U3:()=>a});const i={openPhonelinkDialog:"openPhonelinkDialog"},a={openPhonelinkDialog:()=>({originator:"MoreOptionsMenu",type:i.openPhonelinkDialog})}},774514:(e,t,n)=>{"use strict";n.d(t,{kn:()=>a,uS:()=>o,U3:()=>l});var i=n(258867);const a="Notifications",o={activateAlerts:"activateAlerts",activateCallToast:"activeCallToast",activateChatToast:"activateChatToast",activateCommunitiesToast:"activateCommunitiesToast",activateRemindersToast:"activateRemindersToast",activateGraphItemToast:"activateGraphItemToast",offsetNotificationsWindow:"offsetNotificationsWindow",resizeWindow:"resizeWindow",sendTelemetry:"sendTelemetry",sendDismissToastTelemetry:"sendDismissToastTelemetry",focusWindow:"focusWindow",settingsstore:"settingsstore",files:"files"},r="localRecordingAssembly",s=(e,t)=>{if(t===r)return o.files;switch(e){case i.dt.activity:return o.activateGraphItemToast;case i.dt.calls:case i.dt.callingdeeplink:return o.activateCallToast;case i.dt.communities:case i.dt.communitiesevents:case i.dt.communitiesjoinrequest:case i.dt.communitiesmembers:return o.activateCommunitiesToast;case i.dt.reminders:return o.activateRemindersToast;case i.dt.settingsstore:return o.settingsstore;case i.dt.alerts:return o.activateAlerts;case i.dt.chats:default:return o.activateChatToast}},l={activateToast:(e,t)=>({originator:a,type:s(e.type,e.id),data:()=>({targetEntity:e,startTimestamp:t})}),resizeWindow:e=>({originator:a,type:o.resizeWindow,data:()=>({windowFeatures:e})}),focusWindow:()=>({originator:a,type:o.focusWindow}),sendTelemetry:e=>({originator:a,type:o.sendTelemetry,data:()=>e}),offsetNotificationsWindow:e=>({originator:a,type:o.offsetNotificationsWindow,data:()=>e}),sendDismissToastTelemetry:({reason:e,correlationId:t,toastType:n})=>({originator:a,type:o.sendDismissToastTelemetry,data:()=>({reason:e,correlationId:t,toastType:n})})}},113600:(e,t,n)=>{"use strict";n.d(t,{dX:()=>i,U3:()=>a});const i={launchDefaultPersonalApp:"launchDefaultPersonalApp"},a={launchDefaultPersonalApp:()=>({originator:"Platform",type:i.launchDefaultPersonalApp})}},630213:(e,t,n)=>{"use strict";n.d(t,{k:()=>i,u:()=>a});const i="EntitySearch",a={openContextualSearch:"openContextualSearch"}},293929:(e,t,n)=>{"use strict";n.d(t,{_H:()=>a,cn:()=>o,xs:()=>r,hY:()=>s});const i="SimpleCollabList",a={switchToChat:"switchToChat",switchToChannel:"switchToChannel",channelNotificationSettings:"channelNotificationSettings",filterLeftRail:"filterLeftRail",filterLeftRailComplete:"filterLeftRailComplete",filterLeftRailFail:"filterLeftRailFail",channelWorkflows:"channelWorkflows",archiveChannel:"archiveChannel",toastMessageChannelEvent:"toastMessageChannelEvent",deleteChannel:"deleteChannel",editChannel:"editChannel",getLinkToChannel:"getLinkToChannel",manageChannel:"manageChannel",manageChannelMembers:"manageChannelMembers",manageChannelTags:"manageChannelTags",showHideChannel:"showHideChannel",channelContextMenuClick:"channelContextMenuClick",teamContextMenuClick:"teamContextMenuClick",viewChannelEmail:"viewChannelEmail",channelAddMembers:"channelAddMembers",leaveChannel:"leaveChannel",shareChannelWithUser:"shareChannelWithUser",shareChannelWithTeam:"shareChannelWithTeam",shareChannelWithTeamYouOwn:"shareChannelWithTeamYouOwn",viewDiscover:"viewDiscover",manageTeam:"manageTeam",manageTeamChannels:"manageTeamChannels",manageTags:"manageTags",deleteTeam:"deleteTeam",getLinkToTeam:"getLinkToTeam",leaveTeam:"leaveTeam",teamAddMember:"teamAddMember",teamAddChannel:"teamAddChannel",leftRailRenderComplete:"leftRailRenderComplete",leftRailRenderStart:"leftRailRenderStart",forceHideTeam:"forceHideTeam",simpleCollabNavigation:"simpleCollabNavigation",simpleCollabConversationFolderNavigation:"simpleCollabConversationFolderNavigation",seeMoreRenderComplete:"seeMoreRenderComplete",seeMoreRenderStart:"seeMoreRenderStart",seeMoreRenderFail:"seeMoreRenderFail",chatManageApps:"chatManageApps",leaveChat:"leaveChat",deleteChat:"deleteChat",viewTeamSeeAllChannels:"viewTeamSeeAllChannels",joinTeam:"joinTeam",createChannel:"createChannel",createTeam:"createTeam",manageTeams:"manageTeams",leftRailHeaderPlusMenuOpen:"leftRailHeaderPlusMenuOpen",openFilterLeftRail:"openFilterLeftRail",switchToBizChatMetaOS:"switchToBizChatMetaOS",stopBizChatMetaOSE2EScenarioIfActive:"stopBizChatMetaOSE2EScenarioIfActive",openManageTeams:"openManageTeams",reorderTeamsFailed:"reorderTeamsFailed",createTeamOnMainView:"createTeamOnMainView",teamDiscover:"teamDiscover",teamsAndChannelsFolderViewTypeChangeFailed:"teamsAndChannelsFolderViewTypeChangeFailed"},o={createConversationFolder:"createConversationFolder",removeConversationFolder:"removeConversationFolder",renameConversationFolder:"renameConversationFolder"},r={staleChannelsAdhocDialog:"staleChannelsAdhocDialog",createConversationFolderCancelAction:"createConversationFolderCancelAction",createConversationFolderConfirmAction:"createConversationFolderConfirmAction",createConversationFolderSucceeded:"createConversationFolderSucceeded",createConversationFolderFailed:"createConversationFolderFailed",renameConversationFolderCancelAction:"renameConversationFolderCancelAction",renameConversationFolderConfirmAction:"renameConversationFolderConfirmAction",renameConversationFolderSucceeded:"renameConversationFolderSucceeded",renameConversationFolderFailed:"renameConversationFolderFailed",removeConversationFolderCancelAction:"removeConversationFolderCancelAction",removeConversationFolderConfirmAction:"removeConversationFolderConfirmAction",removeConversationFolderSucceeded:"removeConversationFolderSucceeded",removeConversationFolderFailed:"removeConversationFolderFailed",removeFromFolderAction:"removeFromFolderAction",removeFromFolderSucceeded:"removeFromFolderSucceeded",removeFromFolderFailed:"removeFromFolderFailed",moveConversationToFolderAction:"moveConversationToFolderAction",moveConversationToFolderSucceeded:"moveConversationToFolderSucceeded",moveConversationToFolderFailed:"moveConversationToFolderFailed",setConversationFolderExpandedStateAction:"setConversationFolderExpandedStateAction",setConversationFolderExpandedStateSucceeded:"setConversationFolderExpandedStateSucceeded",setConversationFolderExpandedStateFailed:"setConversationFolderExpandedStateFailed",reorderConversationFoldersAction:"reorderConversationFoldersAction",reorderConversationFoldersSucceeded:"reorderConversationFoldersSucceeded",reorderConversationFoldersFailed:"reorderConversationFoldersFailed",reorderConversationFolderItemsAction:"reorderConversationFolderItemsAction",reorderConversationFolderItemsSucceeded:"reorderConversationFolderItemsSucceeded",reorderConversationFolderItemsFailed:"reorderConversationFolderItemsFailed",dndItemToConversationFolderAction:"dndItemToConversationFolderAction",dndItemToConversationFolderSucceeded:"dndItemToConversationFolderSucceeded",dndItemToConversationFolderFailed:"dndItemToConversationFolderFailed",setChannelsViewType:"setChannelsViewType"},s={switchToChat:e=>({data:e,originator:i,type:a.switchToChat}),switchToBizChatMetaOS:e=>({data:e,originator:i,type:a.switchToBizChatMetaOS}),stopBizChatMetaOSE2EScenarioIfActive:()=>({originator:i,type:a.stopBizChatMetaOSE2EScenarioIfActive}),switchToChannel:e=>({data:e,originator:i,type:a.switchToChannel}),channelNotificationSettings:e=>({data:e,originator:i,type:a.channelNotificationSettings}),channelWorkflows:e=>({data:e,originator:i,type:a.channelWorkflows}),archiveChannel:e=>({data:e,originator:i,type:a.archiveChannel}),toastMessageChannelEvent:e=>({data:e,originator:i,type:a.toastMessageChannelEvent}),deleteChannel:e=>({data:e,originator:i,type:a.deleteChannel}),editChannel:e=>({data:e,originator:i,type:a.editChannel}),getLinkToChannel:e=>({data:e,originator:i,type:a.getLinkToChannel}),filterLeftRail:e=>({data:e,originator:i,type:a.filterLeftRail}),filterLeftRailComplete:()=>({originator:i,type:a.filterLeftRailComplete}),filterLeftRailFail:()=>({originator:i,type:a.filterLeftRailFail}),manageChannel:e=>({data:e,originator:i,type:a.manageChannel}),manageChannelMembers:e=>({data:e,originator:i,type:a.manageChannelMembers}),manageChannelTags:e=>({data:e,originator:i,type:a.manageChannelTags}),showHideChannel:e=>({data:e,originator:i,type:a.showHideChannel}),channelContextMenuClick:()=>({originator:i,type:a.channelContextMenuClick}),teamContextMenuClick:()=>({originator:i,type:a.teamContextMenuClick}),viewChannelEmail:e=>({data:e,originator:i,type:a.viewChannelEmail}),channelAddMembers:e=>({data:e,originator:i,type:a.channelAddMembers}),leaveChannel:e=>({data:e,originator:i,type:a.leaveChannel}),shareChannelWithUser:e=>({data:e,originator:i,type:a.shareChannelWithUser}),shareChannelWithTeam:e=>({data:e,originator:i,type:a.shareChannelWithTeam}),shareChannelWithTeamYouOwn:e=>({data:e,originator:i,type:a.shareChannelWithTeamYouOwn}),createConversationFolder:e=>({data:e,originator:i,type:o.createConversationFolder}),removeConversationFolder:e=>({data:e,originator:i,type:o.removeConversationFolder}),renameConversationFolder:e=>({data:e,originator:i,type:o.renameConversationFolder}),staleChannelsAdhocDialog:e=>({data:e,originator:i,type:r.staleChannelsAdhocDialog}),createConversationFolderCancelAction:e=>({data:e,originator:i,type:r.createConversationFolderCancelAction}),createConversationFolderConfirmAction:e=>({data:e,originator:i,type:r.createConversationFolderConfirmAction}),createConversationFolderSucceeded:e=>({data:e,originator:i,type:r.createConversationFolderSucceeded}),createConversationFolderFailed:e=>({data:e,originator:i,type:r.createConversationFolderFailed}),renameConversationFolderCancelAction:e=>({data:e,originator:i,type:r.renameConversationFolderCancelAction}),renameConversationFolderConfirmAction:e=>({data:e,originator:i,type:r.renameConversationFolderConfirmAction}),renameConversationFolderSucceeded:e=>({data:e,originator:i,type:r.renameConversationFolderSucceeded}),renameConversationFolderFailed:e=>({data:e,originator:i,type:r.renameConversationFolderFailed}),removeConversationFolderCancelAction:e=>({data:e,originator:i,type:r.removeConversationFolderCancelAction}),removeConversationFolderConfirmAction:e=>({data:e,originator:i,type:r.removeConversationFolderConfirmAction}),removeConversationFolderSucceeded:e=>({data:e,originator:i,type:r.removeConversationFolderSucceeded}),removeConversationFolderFailed:e=>({data:e,originator:i,type:r.removeConversationFolderFailed}),removeFromFolderAction:e=>({data:e,originator:i,type:r.removeFromFolderAction}),removeFromFolderSucceeded:e=>({data:e,originator:i,type:r.removeFromFolderSucceeded}),removeFromFolderFailed:e=>({data:e,originator:i,type:r.removeFromFolderFailed}),moveConversationToFolderAction:e=>({data:e,originator:i,type:r.moveConversationToFolderAction}),moveConversationToFolderSucceeded:e=>({data:e,originator:i,type:r.moveConversationToFolderSucceeded}),forceHideTeam:e=>({data:e,originator:i,type:a.forceHideTeam}),moveConversationToFolderFailed:e=>({data:e,originator:i,type:r.moveConversationToFolderFailed}),setConversationFolderExpandedStateAction:e=>({data:e,originator:i,type:r.setConversationFolderExpandedStateAction}),setConversationFolderExpandedStateSucceeded:e=>({data:e,originator:i,type:r.setConversationFolderExpandedStateSucceeded}),setConversationFolderExpandedStateFailed:e=>({data:e,originator:i,type:r.setConversationFolderExpandedStateFailed}),reorderConversationFoldersAction:e=>({data:e,originator:i,type:r.reorderConversationFoldersAction}),reorderConversationFoldersSucceeded:e=>({data:e,originator:i,type:r.reorderConversationFoldersSucceeded}),reorderConversationFoldersFailed:e=>({data:e,originator:i,type:r.reorderConversationFoldersFailed}),reorderTeamsFailed:e=>({data:e,originator:i,type:a.reorderTeamsFailed}),reorderConversationFolderItemsAction:e=>({data:e,originator:i,type:r.reorderConversationFolderItemsAction}),reorderConversationFolderItemsSucceeded:e=>({data:e,originator:i,type:r.reorderConversationFolderItemsSucceeded}),reorderConversationFolderItemsFailed:e=>({data:e,originator:i,type:r.reorderConversationFolderItemsFailed}),dndItemToConversationFolderAction:e=>({data:e,originator:i,type:r.dndItemToConversationFolderAction}),dndItemToConversationFolderSucceeded:e=>({data:e,originator:i,type:r.dndItemToConversationFolderSucceeded}),dndItemToConversationFolderFailed:e=>({data:e,originator:i,type:r.dndItemToConversationFolderFailed}),setChannelsViewType:e=>({data:e,originator:i,type:r.setChannelsViewType}),manageTeam:e=>({data:e,originator:i,type:a.manageTeam}),manageTeamChannels:e=>({data:e,originator:i,type:a.manageTeamChannels}),manageTags:e=>({data:e,originator:i,type:a.manageTags}),getLinkToTeam:e=>({data:e,originator:i,type:a.getLinkToTeam}),deleteTeam:e=>({data:e,originator:i,type:a.deleteTeam}),leaveTeam:e=>({data:e,originator:i,type:a.leaveTeam}),teamAddMember:e=>({data:e,originator:i,type:a.teamAddMember}),teamAddChannel:e=>({data:e,originator:i,type:a.teamAddChannel}),chatManageApps:e=>({data:e,originator:i,type:a.chatManageApps}),leaveChat:e=>({data:e,originator:i,type:a.leaveChat}),deleteChat:e=>({data:e,originator:i,type:a.deleteChat}),viewDiscover:()=>({originator:i,type:a.viewDiscover}),leftRailRenderStart:()=>({originator:i,type:a.leftRailRenderStart}),leftRailRenderComplete:()=>({originator:i,type:a.leftRailRenderComplete}),simpleCollabNavigation:e=>({data:e,originator:i,type:a.simpleCollabNavigation}),simpleCollabConversationFolderNavigation:e=>({data:e,originator:i,type:a.simpleCollabConversationFolderNavigation}),seeMoreRenderStart:()=>({originator:i,type:a.seeMoreRenderStart}),seeMoreRenderComplete:()=>({originator:i,type:a.seeMoreRenderComplete}),seeMoreRenderFail:()=>({originator:i,type:a.seeMoreRenderFail}),viewTeamSeeAllChannels:e=>({data:e,originator:i,type:a.viewTeamSeeAllChannels}),joinTeam:e=>({data:e,originator:i,type:a.joinTeam}),createChannel:e=>({data:e,originator:i,type:a.createChannel}),createTeam:e=>({data:e,originator:i,type:a.createTeam}),manageTeams:e=>({data:e,originator:i,type:a.manageTeams}),leftRailHeaderPlusMenuOpen:e=>({data:e,originator:i,type:a.leftRailHeaderPlusMenuOpen}),openFilterLeftRail:e=>({data:e,originator:i,type:a.openFilterLeftRail}),openManageTeams:()=>({originator:i,type:a.openManageTeams}),createTeamOnMainView:e=>({data:e,originator:i,type:a.createTeamOnMainView}),teamDiscover:e=>({data:e,originator:i,type:a.teamDiscover}),teamsAndChannelsFolderViewTypeChangeFailed:e=>({data:e,originator:i,type:a.teamsAndChannelsFolderViewTypeChangeFailed})}},898067:(e,t,n)=>{"use strict";n.d(t,{s:()=>i,$:()=>a});const i={SimpleCollabSwitcher:"simple-collab-switcher"},a={SwitchOnSimpleCollab:"SwitchOnSimpleCollab",SwitchOffSimpleCollab:"SwitchOffSimpleCollab",SwitchOnSplitView:"SwitchOnSplitView"}},146367:(e,t,n)=>{"use strict";n.d(t,{kn:()=>i,pd:()=>a,yG:()=>o});const i="UseronboardingToTeam",a={switchToChannel:"switchToChannel",loadUserOnboardingToTeamPage:"loadUserOnboardingToTeamPage",seeAllChannelsLoadMoreRenderStart:"seeAllLoadMoreRenderStart",seeAllChannelsLoadMoreRenderFail:"seeAllChannelsLoadMoreRenderFail",seeAllChannelsLoadMoreRenderComplete:"seeAllChannelsLoadMoreRenderComplete",useronboardingFilterSortLoadStart:"useronboardingFilterSortLoadStart",useronboardingFilterSortLoadFail:"useronboardingFilterSortLoadFail",useronboardingFilterSortLoadComplete:"useronboardingFilterSortLoadComplete",seeAllChannelsAction:"seeAllChannelsAction",seeAllChannelsOnLoadAction:"seeAllChannelsOnLoadAction",channelPreviewAction:"channelPreviewAction",channelBackAction:"channelBackAction",openContextMenuAction:"openContextMenuAction",goToTeamAction:"goToTeamAction",activityFeedOnLoadAction:"activityFeedOnLoadAction",showChannelAction:"showChannelAction",hideChannelAction:"hideChannelAction",allPillAction:"allPillAction",shownPillAction:"shownPillAction",hiddenPillAction:"hiddenPillAction",sortByAction:"sortByAction",searchAction:"searchAction",searchResultsAction:"searchResultsAction",searchNoResultsAction:"searchNoResultsAction"},o={switchToChannel:e=>({data:e,originator:i,type:a.switchToChannel}),loadUserOnboardingToTeamPage:e=>({data:e,originator:i,type:a.loadUserOnboardingToTeamPage}),useronboardingFilterSortLoadStart:e=>({data:e,originator:i,type:a.useronboardingFilterSortLoadStart}),useronboardingFilterSortLoadFail:()=>({originator:i,type:a.useronboardingFilterSortLoadFail}),useronboardingFilterSortLoadComplete:()=>({originator:i,type:a.useronboardingFilterSortLoadComplete}),seeAllChannelsLoadMoreRenderStart:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderStart}),seeAllChannelsLoadMoreRenderFail:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderFail}),seeAllChannelsLoadMoreRenderComplete:()=>({originator:i,type:a.seeAllChannelsLoadMoreRenderComplete}),seeAllChannelsAction:()=>({originator:i,type:a.seeAllChannelsAction}),seeAllChannelsOnLoadAction:()=>({originator:i,type:a.seeAllChannelsOnLoadAction}),channelPreviewAction:e=>({data:e,originator:i,type:a.channelPreviewAction}),channelBackAction:()=>({originator:i,type:a.channelBackAction}),openContextMenuAction:e=>({data:e,originator:i,type:a.openContextMenuAction}),goToTeamAction:e=>({data:e,originator:i,type:a.goToTeamAction}),activityFeedOnLoadAction:()=>({originator:i,type:a.activityFeedOnLoadAction}),showChannelAction:e=>({data:e,originator:i,type:a.showChannelAction}),hideChannelAction:e=>({data:e,originator:i,type:a.hideChannelAction}),allPillAction:e=>({data:e,originator:i,type:a.allPillAction}),shownPillAction:e=>({data:e,originator:i,type:a.shownPillAction}),hiddenPillAction:e=>({data:e,originator:i,type:a.hiddenPillAction}),sortByAction:e=>({data:e,originator:i,type:a.sortByAction}),searchAction:e=>({data:e,originator:i,type:a.searchAction}),searchResultsAction:e=>({data:e,originator:i,type:a.searchResultsAction}),searchNoResultsAction:e=>({data:e,originator:i,type:a.searchNoResultsAction})}},580632:(e,t,n)=>{"use strict";n.d(t,{kn:()=>i,uS:()=>a,RB:()=>o,nW:()=>r,HY:()=>s,Lz:()=>l,gM:()=>c,t5:()=>d,U3:()=>u});const i="VirtualConsumerEvents",a={createVirtualConsumerEvent:"createVirtualConsumerEvent",editVirtualConsumerEvent:"editVirtualConsumerEvent",joinVirtualConsumerEvent:"joinVirtualConsumerEvent",shareVirtualConsumerEvent:"shareVirtualConsumerEvent",viewVirtualConsumerEvent:"viewVirtualConsumerEvent",deleteVirtualConsumerEvent:"deleteVirtualConsumerEvent"},o=e=>"object"==typeof e&&!!e&&"communityId"in e,r=e=>"object"==typeof e&&!!e&&"eventId"in e,s=e=>"object"==typeof e&&!!e&&"eventId"in e,l=e=>"object"==typeof e&&!!e&&"joinLink"in e&&"title"in e,c=e=>"object"==typeof e&&!!e&&"eventId"in e,d=e=>"object"==typeof e&&!!e&&"eventId"in e,u={createVirtualConsumerEvent:e=>({originator:i,type:a.createVirtualConsumerEvent,data:e}),deleteVirtualConsumerEvent:e=>({originator:i,type:a.deleteVirtualConsumerEvent,data:e}),editVirtualConsumerEvent:e=>({originator:i,type:a.editVirtualConsumerEvent,data:e}),joinVirtualConsumerEvent:e=>({originator:i,type:a.joinVirtualConsumerEvent,data:e}),shareVirtualConsumerEvent:e=>({originator:i,type:a.shareVirtualConsumerEvent,data:e}),viewVirtualConsumerEvent:e=>({originator:i,type:a.viewVirtualConsumerEvent,data:e})}},397016:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>hfe,getPlatformConfigurationOverrides:()=>gfe});n(887198);var i,a=n(873292),o=n(528099),r=n(839779),s=n(816566),l=n(1489),c=n(237071),d=n(59083),u=n(117020),m=n(841763),p=n(333114),g=n(782478),h=n(689626),y=n(258867);!function(e){e.DiagnosticsLogsMain="diagnostics-event-logs-main",e.DiagnosticsLogsWorker="diagnostics-event-logs-worker"}(i||(i={}));var v,f,S,k,C=n(323356),b=n(683184);!function(e){e.Cold="Cold",e.Warm="Warm",e.Rollback="Rollback",e.Update="Update",e.Local="Local",e.Container="Container",e.Unknown="Unknown"}(v||(v={})),function(e){e.SessionID="tmp.sessionId",e.DeviceID="tmp.deviceId",e.IsRelaunchFromOOPs="tmp.relaunchFromOOPs",e.PreAuthUserID="tmp.preAuthUserId",e.T2WebOptInSessionId="tmp.t2WebOptInSessionId",e.AttemptedWebBootCount="tmp.numT2WebBootAttempts"}(f||(f={})),function(e){e.IndexPageStart="execute-index-html-script",e.CoreModuleLoaded="exp_loader_core_module_loaded",e.NotifyDesktop="exp_loader_notified_desktop",e.ConfigLoaded="exp_loader_config_loaded",e.MainChunksLoadingStart="exp_loader_load_bundles_start",e.MainChunksLoadingStop="exp_loader_load_bundles_stop",e.IndexPageStop="exp_loader_index_stop",e.AsyncEntryModuleFederationUrlsInited="exp_loader_steps_init_module_federation_remote_urls_failure",e.AsyncEntryDownloadStart="exp_loader_steps_async_entry_load_start",e.AsyncEntryDownloadStop="exp_loader_steps_async_entry_load_stop",e.ClientStartStop="client_start_stop"}(S||(S={})),function(e){e.ExpLoaderFailure="ExpLoaderFailure",e.LoadBundlesFailure="LoadBundlesFailure",e.ParseIndexPageFailure="ParseIndexPageFailure",e.CoreStartTimeout="CoreStartTimeout",e.PreTelemetryCoreInitFailure="PreTelemetryCoreInitFailure"}(k||(k={}));var w=n(317876);const T="core_life_cycle_start_",I="core_task_end_",N="core_init_complete";var E,A=n(284669),_=n(980776);!function(e){e.DIAGNOSTICSSERVICE="DiagnosticsService"}(E||(E={}));const F=e=>{let t;const n=[];return{newScenario:i=>{if(t)return t.newScenario(i);if(e&&n.length<20){const e=M(i,n);return n.push(e),e}},setScenarioFactory:e=>{t=e,D(n,t)}}},D=(e,t)=>{if(e.length>0)for(let n=e.length-1;n>=0;n--)P(e[n],t)&&e.splice(n,1)},P=(e,t,n)=>{if(e.status){const i=t.newScenario(e.name,{startTime:e.time});if("failed"===e.status&&i.fail({cached:!0,overrideTimestamp:e.endtime,...e.result}),"stopped"===e.status&&i.stop({cached:!0,overrideTimestamp:e.endtime,...e.result}),n){const t=n.indexOf(e);t>=0&&n.splice(t,1)}return!0}return e.setFactory?.(t),!1},M=(e,t)=>{let n,i,a,o;const r={name:e,time:Date.now(),fail:e=>{i="failed",a=Date.now(),n=e,o&&P(r,o,t)},stop:e=>{i="stopped",a=Date.now(),n=e,o&&P(r,o,t)},get result(){return n},get status(){return i},get endtime(){return a},setFactory:e=>o=e};return r};var x=n(867135);class R{constructor(){this.eventsBufferArray=[],this.scheduledBufferArray=[],this.isForErrorLogs=!1,this.ALTCompleted=!1}addEvents(e,t=!1){e&&e.length>0&&e.forEach((e=>{this.addEvent(e,t)}))}getBufferedEvents(e){const t=this.eventsBufferArray.concat(this.scheduledBufferArray).sort(((e,t)=>{const n="function"==typeof e.timeStamp.getTime?e.timeStamp:new Date(e.timeStamp),i="function"==typeof t.timeStamp.getTime?t.timeStamp:new Date(t.timeStamp);return n.getTime()-i.getTime()}));return e&&e>0&&e<t.length?t.slice(t.length-e):t}setALTDone(){this.ALTCompleted=!0}fetchPersistedLogsFromLastSession(){if(this.host?.localStorage){const e=(0,x.yN)(this.userId,this.isForErrorLogs);try{(0,x.UL)(this,this.host.localStorage,e,!0)}catch(t){this.host.localStorage.removeItem(e);const n=`DiagnosticsService: Failed to load persisted logs from store with error: ${t}`;this.addEvent({message:n,isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date})}}}shiftBufferArray(){return 0===this.scheduledBufferArray.length?this.eventsBufferArray.shift():0===this.eventsBufferArray.length||this.scheduledBufferArray[0].timeStamp<this.eventsBufferArray[0].timeStamp?this.scheduledBufferArray.shift():this.eventsBufferArray.shift()}addIntoBufferArray(e,t){t?this.scheduledBufferArray.push(e):this.eventsBufferArray.push(e)}get bufferArraySize(){return this.eventsBufferArray.length+this.scheduledBufferArray.length}}class j extends R{constructor(e=!1,t,n,i){super(),this.isForErrorLogs=e,this.sessionId=t,this.host=n,this.maxCapacity=i,this.queueCapacity=this.maxCapacity||j.DEFAULT_QUEUE_CAPACITY}setCapacity(e){const t=e.bufferSize||0;t<1||this.queueCapacity===t||(this.queueCapacity=t,this.bufferArraySize>t&&(this.scheduledBufferArray.length>=t?(this.eventsBufferArray=[],this.scheduledBufferArray=this.scheduledBufferArray.slice(this.scheduledBufferArray.length-t)):this.eventsBufferArray=this.eventsBufferArray.slice(this.bufferArraySize-t)))}addEvent(e,t=!1){this.bufferArraySize<this.queueCapacity||this.shiftBufferArray(),this.addIntoBufferArray(e,t)}getAllEvents(e){return 0===e?Promise.resolve([]):e&&e<=this.bufferArraySize?Promise.resolve(this.getBufferedEvents().slice(this.bufferArraySize-e)):Promise.resolve(this.getBufferedEvents())}setScenarioFactory(e){}handleUserLogout(){this.eventsBufferArray=[],this.scheduledBufferArray=[];const e=(0,x.yN)(this.userId);return this.host?.localStorage.removeItem(e),Promise.resolve()}setDBInfo(e,t,n){this.tId||(this.tId=e),this.oId||(this.oId=t),this.userId||(this.userId=n,this.fetchPersistedLogsFromLastSession())}persistLogs(){if(this.eventsBufferArray.length>0&&this.host?.localStorage){const e=(0,x.yN)(this.userId,this.isForErrorLogs);(0,x.RA)(this,this.host.localStorage,e,this.sessionId)}}}j.DEFAULT_QUEUE_CAPACITY=1e3;var L=n(191366),O=n(898785),$=n(256676);class U{constructor(e,t,n,i){this.opener=e,this.setTimeout=t,this.clearTimeout=n,this.diagnosticsEventsBuffer=[],this.flush=()=>{if(this.diagnosticsEventsBuffer.length>0)try{this.opener.postMessage(O.rY.ActivityEvent,{action:"er:rendererDiagnosticsEvents",data:[...this.diagnosticsEventsBuffer]})}catch(e){console.error("DiagnosticsBackupService failed to send a message")}this.reset()},this.backupTimeoutMs=i&&i>0?i:U.DefaultBackupTimeoutMs,this.reset()}pushDiagnosticsEvent(e){e&&(this.diagnosticsEventsBuffer.push(this.stringifyEvent(e)),this.diagnosticsEventsBuffer.length===U.BufferCapacity&&this.flush(),!this.backupTimer&&this.diagnosticsEventsBuffer.length>0&&this.startTimer())}dispose(){this.flush()}reset(){this.diagnosticsEventsBuffer.length=0,this.stopTimer()}stopTimer(){this.backupTimer&&(this.clearTimeout(this.backupTimer),this.backupTimer=void 0)}startTimer(){this.backupTimer=this.setTimeout(this.flush,this.backupTimeoutMs)}stringifyEvent(e){return(0,$.Uw)("{0} {1}\t{2}\r\n",[e.timeStamp,e.levelName.slice(0,3),e.message])}}U.BufferCapacity=50,U.DefaultBackupTimeoutMs=100;var B,W=n(803238),H=n(543491);!function(e){e[e.ecsSetting=0]="ecsSetting",e[e.clientPreference=1]="clientPreference",e[e.error=2]="error",e[e.beforeDeletingDB=3]="beforeDeletingDB"}(B||(B={}));var V=n(876934);class G extends R{constructor(e,t,n,a){super(),this.host=e,this.experienceName=t,this.databaseName=n,this.sessionId=a,this.indexedDBVersion=1,this.storeName="LogsStore",this.timeIndexName="timeIdx",this.currentIDBItemIndex=-1,this.IDBManagementArray=[],this.IDBErrorCount=0,this.allowedIDBErrorCount=10,this.defaultAllowedBufferLength=2e3,this.defaultCountOfIDBObjects=10,this.defaultWorkerAllowedBufferLength=1e3,this.defaultWorkerMaxCountOfIndexDBObject=10,this.minBufferLength=1e3,this.maxBufferLength=5e3,this.minWorkerBufferLength=500,this.maxWorkerBufferLength=3e3,this.minCountOfIDBObjects=10,this.maxCountofIDBObjects=1e3,this.minWorkerCountOfIDBObjects=10,this.maxWorkerCountofIDBObjects=1e3,this.timeThrottlingInterval=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.disableIDBLogs=!1,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.fetchFromIDBTimeLimit=18e3,this.minFetchFromIDBTimeLimit=5e3,this.databaseName===i.DiagnosticsLogsWorker?(this.allowedCountOfIndexDBObject=this.defaultWorkerMaxCountOfIndexDBObject,this.allowedBufferLength=this.defaultWorkerAllowedBufferLength):(this.allowedCountOfIndexDBObject=this.defaultCountOfIDBObjects,this.allowedBufferLength=this.defaultAllowedBufferLength),this.scenarioFactory=F(!0)}setDBInfo(e,t,n){this.getDBName()||(this.tId=e,this.oId=t,this.userId=n,this.openIndexedDB(),this.fetchPersistedLogsFromLastSession())}setCapacity(e){if(void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingInterval=1e3*e.throttleTime),e.bufferSize){const t=this.databaseName===i.DiagnosticsLogsMain?this.minBufferLength:this.minWorkerBufferLength,n=this.databaseName===i.DiagnosticsLogsMain?this.maxBufferLength:this.maxWorkerBufferLength;e.bufferSize>=t&&e.bufferSize<=n&&(this.allowedBufferLength=e.bufferSize)}const t=this.allowPersistIntoIDB;if(e.enableIndexedDB?this.ecsEnableIDBLogs=!0:!1===e.enableIndexedDB&&this.disablePersistIntoIDB(B.ecsSetting),e.clientEnableExtendedLogs?this.isUserEnableIDBLogs=!0:!1===e.clientEnableExtendedLogs&&this.disablePersistIntoIDB(B.clientPreference),e.IDBFetchingTimeoutMs&&e.IDBFetchingTimeoutMs>this.minFetchFromIDBTimeLimit&&(this.fetchFromIDBTimeLimit=e.IDBFetchingTimeoutMs),e.IDBObjectCount){const n=this.databaseName===i.DiagnosticsLogsMain?this.minCountOfIDBObjects:this.minWorkerCountOfIDBObjects,a=this.databaseName===i.DiagnosticsLogsMain?this.maxCountofIDBObjects:this.maxWorkerCountofIDBObjects;if(e.IDBObjectCount>=n&&e.IDBObjectCount<=a){if(t&&this.allowPersistIntoIDB&&this.IDBManagementArray.length>e.IDBObjectCount){const t=this.getToBeDeletedIDs(e.IDBObjectCount);this.deleteIDBItems(t)}this.allowedCountOfIndexDBObject=e.IDBObjectCount}}!t&&this.allowPersistIntoIDB&&this.openIndexedDB()}addEvent(e,t=!1){if(this.addIntoBufferArray(e,t),this.bufferArraySize>=this.allowedBufferLength)if(this.allowPersistIntoIDB&&this.db)if(this.shouldBeThrottled()){const e=this.shiftBufferArray();this.skippedEventsCount++,void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=e?.timeStamp),this.lastSkippedEventTime=e?.timeStamp}else this.flushBufferIntoIndexedDB(!0);else this.allowPersistIntoIDB&&!this.ALTCompleted&&this.skippedEventsCount++,this.shiftBufferArray()}async getAllEvents(e){if(!this.db||e&&this.bufferArraySize>=e)return e&&this.bufferArraySize>e?Promise.resolve(this.getBufferedEvents().slice(this.bufferArraySize-e)):Promise.resolve(this.getBufferedEvents());{const t=this.getIDBStore(this.db,this.storeName,"readonly");if(t)try{const n=await(0,V.E)(this.getAllEventsFromIDB(t,e),this.fetchFromIDBTimeLimit);return Promise.resolve(n)}catch{const e=this.getBufferedEvents();return e.push({message:`DiagnosticsService - fetching logs form IDB timedout with limit of ${this.timeIndexName} ms`,isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),Promise.resolve(e)}}return Promise.resolve(this.getBufferedEvents())}handleUserLogout(){this.eventsBufferArray=[],this.scheduledBufferArray=[];const e=(0,x.yN)(this.userId);return this.host.localStorage.removeItem(e),this.allowPersistIntoIDB&&this.db?this.createDeleteUserDBPromise():Promise.resolve()}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}setALTDone(){this.ALTCompleted||(this.skippedEventsCount>0&&this.addEvent({message:`DiagnosticsService - ${this.skippedEventsCount} logs skipped before client_start complete`,isPiiFree:!0,level:_.i.Info,levelName:"info",timeStamp:new Date}),this.ALTCompleted=!0,this.openIndexedDB())}persistLogs(){if(this.bufferArraySize>0)if(this.allowPersistIntoIDB&&this.db)this.flushBufferIntoIndexedDB(!1);else if(this.host?.localStorage){const e=(0,x.yN)(this.userId);(0,x.RA)(this,this.host.localStorage,e,this.sessionId)}}parseMaglevEventsFromIDB(e,t){let n="",i=[];return e.forEach((e=>{e.sessionId!==n&&""!==n&&this.addAnSeperateLogItem(i,n),n=e.sessionId,i=i.concat(e.logsArray)})),""!==n&&n!==this.sessionId&&this.addAnSeperateLogItem(i,n),i=i.concat(this.getBufferedEvents()),i.sort(x.mw),t&&i.length>t&&(i=i.slice(i.length-t)),i}parseNonMaglevEventsFromIDB(e,t){const n=new Map;e.forEach((e=>{if(e.logsArray&&e.logsArray.length>0){const t=n.get(e.sessionId)||[];n.set(e.sessionId,t.concat(e.logsArray))}}));let i=n.get(this.sessionId);if(i?(i=i.concat(this.getBufferedEvents()),n.delete(this.sessionId)):i=this.getBufferedEvents(),n.forEach(((e,t)=>{e.sort(x.mw),this.addAnSeperateLogItem(e,t)})),i.sort(x.mw),t&&i.length>=t)return i.slice(i.length-t);let a=Array.from(n.values()).sort(((e,t)=>{const n="function"==typeof e[e.length-1].timeStamp.getTime?e[e.length-1].timeStamp:new Date(e[e.length-1].timeStamp),i="function"==typeof t[t.length-1].timeStamp?t[t.length-1].timeStamp:new Date(t[t.length-1].timeStamp);return n.getTime()-i.getTime()})).flat().concat(i);return t&&a.length>t&&(a=a.slice(a.length-t)),a}createDeleteUserDBPromise(){const e=this.host?.indexedDB||globalThis.indexedDB;if(e&&this.db){const t=this.getDBName();if(t)return this.disablePersistIntoIDB(B.beforeDeletingDB,"Deleting user IDB"),this.db.close(),new Promise((n=>{const i=this.scenarioFactory.newScenario(H.RG.DiagnosticsDeleteIDB),a=e.deleteDatabase(t);a.onblocked=()=>{this.addEvent({message:"DiagnosticsService - Deleting user diagnostics logs IDB blocked",isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),i?.fail({reason:`Deleting DB blocked for ${a.error}`}),n()},a.onsuccess=()=>{i?.stop(),n()},a.onerror=()=>{this.addEvent({message:"DiagnosticsService - Deleting user diagnostics logs IDB error",isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),i?.fail({reason:`Deleting DB failed for ${a.error}`}),this.increaseIDBErrorCount(),n()}}))}return Promise.resolve()}flushBufferIntoIndexedDB(e){if(this.bufferArraySize>0){const t=this.getBufferedEvents();this.eventsBufferArray=[],this.scheduledBufferArray=[];const n=this.skippedEventsCount;this.updateThrottleInfo(t);const i=this.scenarioFactory.newScenario(H.RG.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(this.getNextManagementItem(),t,!1,void 0,void 0,e),i?.stop({skippedCount:n})}}updateThrottleInfo(e){this.skippedEventsCount>0&&this.lastSkippedEventTime&&(e.unshift({message:`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${this.firstSkippedEventTime?.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,level:_.i.Info,levelName:"Info",isPiiFree:!0,timeStamp:this.lastSkippedEventTime}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0),this.lastPersistTimestamp=Date.now()}openIndexedDB(){if(this.allowPersistIntoIDB&&!this.db&&this.ALTCompleted){const e=this.host?.indexedDB||globalThis.indexedDB;if(!e)return;const t=this.getDBName();if(t){const n=this.scenarioFactory.newScenario(H.RG.DiagnosticsOpenIDB),i=e.open(t,this.indexedDBVersion);i.onerror=()=>{this.addEvent({message:"DiagnosticsService - Open IndexedDB failed",isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),n?.fail({reason:i.error}),this.increaseIDBErrorCount()},i.onupgradeneeded=()=>{this.createDataStores(i.result)},i.onsuccess=()=>{this.initializeManagementArray(i.result),n?.stop()}}}}createDataStores(e){const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsCreateIDBStore);try{e.createObjectStore(this.storeName,{autoIncrement:!0}).createIndex(this.timeIndexName,"timeStamp",{unique:!0}),t?.stop()}catch(e){t?.fail({reason:e}),this.addEvent({message:"DiagnosticService - Create objectStore failed",isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date})}}getDBName(){return this.tId&&this.oId&&this.experienceName&&this.sessionId?`Teams:${this.databaseName}:${this.experienceName}:${this.tId}:${this.oId}`:""}getIDBStore(e,t,n){if(e)try{const i=e.transaction(t,n);return i?.objectStore(t)}catch{this.disablePersistIntoIDB(B.error,"getIDBStore failed")}}persistBufferIntoDB(e,t,n=!1,i,a,o=!1){if(0===t.length)return;if(e.isUpdating&&!n)return void this.disablePersistIntoIDB(B.error,"All diagnostics log indexedDB items are pending update");const r=this.getIDBStore(this.db,this.storeName,"readwrite");if(r){n||(e.isUpdating=!0,e.timeStamp=a||Date.now());const s={logsArray:t,sessionId:i||this.sessionId||"",timeStamp:e.timeStamp};let l,c;e.IDBId>0?(c=this.scenarioFactory.newScenario(H.RG.DiagnosticsUpdateIDBItem),l=r.put(s,e.IDBId)):(c=this.scenarioFactory.newScenario(H.RG.DiagnosticsAddLogsIntoIDB),l=r.add(s)),l.onsuccess=()=>{c?.stop({context:this.userId,message:this.timeThrottleEnabled()?"throttle_enabled":"throttle_not_enabled",reason:o?"regular":"forced"}),t.length=0,this.isMaglev?(e.isUpdating=!1,e.IDBId=l.result):this.checkIDBItemCount()},l.onerror=()=>{c?.fail({reason:`${o?"regular":"forced"} - error: ${l.error}`,retryCount:n?1:0,context:this.userId,message:this.timeThrottleEnabled()?"throttle_enabled":"throttle_not_enabled"}),n?(this.addEvent({message:`DiagnosticService - Failed adding event buffer into IDB after retry, lost ${t.length} events`,isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),t.length=0,e.isUpdating=!1,this.increaseIDBErrorCount()):(this.addEvent({message:"DiagnosticService - Failed adding event buffer into IDB, start retry",isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),this.persistBufferIntoDB(e,t,!0,i,a,o))}}}deleteIDBItems(e){if(e.length>0){const t=this.getIDBStore(this.db,this.storeName,"readwrite");t&&e.forEach((e=>{const n=this.scenarioFactory.newScenario(H.RG.DiagnosticsDeleteLogsInIDB),i=t.delete(e);i.onsuccess=()=>{n?.stop()},i.onerror=()=>{n?.fail({reason:i.error}),this.increaseIDBErrorCount()}}))}}clearDBStore(){const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsClearIDBStore),n=e.clear();n.onsuccess=()=>{this.IDBManagementArray=[],this.currentIDBItemIndex=-1,t?.stop()},n.onerror=()=>{t?.fail({reason:n.error}),this.addEvent({message:"DiagnosticsService - Clear IDB store failed",isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),this.increaseIDBErrorCount()}}}getToBeDeletedIDs(e){const t=[];if(this.db&&e<this.IDBManagementArray.length){const n=this.IDBManagementArray.length-e;for(let e=0;e<n;e++){let e=0;this.currentIDBItemIndex<this.IDBManagementArray.length-1&&(e=this.currentIDBItemIndex+1);const n=this.IDBManagementArray[e];t.push(n.IDBId),this.IDBManagementArray.splice(e,1),0===e&&this.currentIDBItemIndex--}}return t}getNextManagementItem(){return this.isMaglev?(this.currentIDBItemIndex===this.IDBManagementArray.length-1?this.IDBManagementArray.length<this.allowedCountOfIndexDBObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.IDBManagementArray[this.currentIDBItemIndex]):{IDBId:0,timeStamp:0,isUpdating:!1}}initializeManagementArray(e){if(this.allowPersistIntoIDB&&e&&!this.db)if(this.isMaglev){const t=this.getIDBStore(e,this.storeName,"readwrite");if(t){const n=t.index(this.timeIndexName);if(n){const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllKeysFromIDB),i=n.getAllKeys();i.onsuccess=()=>{t?.stop(),this.db=e,this.IDBManagementArray=[],i.result.forEach((e=>this.addNewManagementItem(e))),this.currentIDBItemIndex=this.IDBManagementArray.length-1,this.fetchAndPersistPreviuosSessionLogs()},i.onerror=()=>{t?.fail({reason:i.error}),this.increaseIDBErrorCount()}}}}else this.db=e,this.fetchAndPersistPreviuosSessionLogs()}addNewManagementItem(e=0){this.IDBManagementArray.push({timeStamp:0,isUpdating:!1,IDBId:e})}disablePersistIntoIDB(e,t){const n=this.allowPersistIntoIDB;switch(e){case B.ecsSetting:if(!this.ecsEnableIDBLogs)return;this.ecsEnableIDBLogs=!1;break;case B.clientPreference:if(!this.isUserEnableIDBLogs)return;this.isUserEnableIDBLogs=!1;break;case B.error:case B.beforeDeletingDB:if(this.disableIDBLogs)return;this.disableIDBLogs=!0}const i=`DiagnosticService - writing logs into IDB settings changed for ${B[e]}`;this.addEvent({message:i,isPiiFree:!0,level:e===B.error?_.i.Error:_.i.Info,levelName:e===B.error?"error":"info",timeStamp:new Date}),n&&!this.allowPersistIntoIDB&&(e===B.error?this.scenarioFactory.newScenario(H.RG.DiagnosticsDisableIDB)?.stop({errorReason:t}):e!==B.beforeDeletingDB&&this.clearDBStore())}increaseIDBErrorCount(){this.IDBErrorCount<this.allowedIDBErrorCount&&(this.IDBErrorCount++,this.IDBErrorCount===this.allowedIDBErrorCount&&this.disablePersistIntoIDB(B.error,"Allowed IDB error count reached"))}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingInterval}timeThrottleEnabled(){return!this.isUserEnableIDBLogs&&this.timeThrottlingInterval>0&&this.lastPersistTimestamp>0}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${x.f5} The following logs are for previous session [${t}] ${x.f5}`,isPiiFree:!0,level:_.i.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}get allowPersistIntoIDB(){return(this.ecsEnableIDBLogs||this.isUserEnableIDBLogs)&&!this.disableIDBLogs}fetchAndPersistPreviuosSessionLogs(){let e=this.fetchPreviuosSessionLogsFromLocalStorage(this.userId);(0,x.uD)(this.host.localStorage,this.userId||""),void 0===e&&this.userId===x.$J&&(e=this.fetchPreviuosSessionLogsFromLocalStorage(),e&&(0,x.uD)(this.host.localStorage,"")),e&&e.sessionId&&e.logsArray?.length>0&&this.persistBufferIntoDB(this.getNextManagementItem(),e.logsArray,!1,e.sessionId,e.logsArray[e.logsArray.length-1].timeStamp.getTime(),!1)}fetchPreviuosSessionLogsFromLocalStorage(e){const t=(0,x.IB)(e);return(0,x.Tx)(this.host.localStorage,t,!0)}checkIDBItemCount(){if(!this.isMaglev&&this.allowPersistIntoIDB&&this.db){const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=e.index(this.timeIndexName);if(t){const e=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllKeysFromIDB),n=t.getAllKeys();n.onsuccess=()=>{e?.stop(),n.result.length>this.allowedCountOfIndexDBObject&&this.deleteIDBItems([n.result[0]])},n.onerror=()=>{e?.fail({reason:n.error}),this.increaseIDBErrorCount()}}}}}get isMaglev(){return void 0===this._isMaglev&&(this._isMaglev=(0,L.J)()?.loader?.getProperties()?.isMaglev),this._isMaglev}getAllEventsFromIDB(e,t){return new Promise((n=>{const i=e.index(this.timeIndexName);if(!i)return n(this.getBufferedEvents());{const e=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllLogsFromIDB),a=i.getAll();a.onsuccess=()=>{e?.stop();const i=this.isMaglev?this.parseMaglevEventsFromIDB(a.result,t):this.parseNonMaglevEventsFromIDB(a.result,t);n(i)},a.onerror=()=>{e?.fail({reason:a.error}),this.increaseIDBErrorCount(),n(this.getBufferedEvents())}}}))}}var z=n(217816);class q extends R{constructor(e){super(),this.sessionId=e,this.currentIDBItemIndex=-1,this.IDBManagementArray=[],this.defaultWorkerAllowedBufferLength=1e3,this.defaultWorkerMaxCountOfIndexDBObject=10,this.minWorkerBufferLength=500,this.maxWorkerBufferLength=5e3,this.minWorkerCountOfIDBObjects=5,this.maxWorkerCountOfIDBObjects=100,this.timeThrottlingInterval=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.pushLogsOutOfOrdersFound=!1,this.disableIDBLogs=!1,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.allowedCountOfIndexDBObject=this.defaultWorkerMaxCountOfIndexDBObject,this.allowedBufferLength=this.defaultWorkerAllowedBufferLength,this.scenarioFactory=F(!0)}setDBInfo(e,t,n){this.addEvent({message:`DiagnosticsService - setDBInfo called for: tid ${e}, oid ${t}, userid ${n}`,isPiiFree:!0,level:_.i.Info,levelName:"info",timeStamp:new Date})}async setCapacity(e){void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingInterval=e.throttleTime*z.kg),e.bufferSize&&e.bufferSize>=this.minWorkerBufferLength&&e.bufferSize<=this.maxWorkerBufferLength&&(this.allowedBufferLength=e.bufferSize);const t=this.allowPersistIntoIDB;if(e.enableIndexedDB?this.ecsEnableIDBLogs=!0:!1===e.enableIndexedDB&&this.disablePersistIntoIDB(B.ecsSetting),e.clientEnableExtendedLogs?this.isUserEnableIDBLogs=!0:!1===e.clientEnableExtendedLogs&&this.disablePersistIntoIDB(B.clientPreference),e.IDBObjectCount&&e.IDBObjectCount>=this.minWorkerCountOfIDBObjects&&e.IDBObjectCount<=this.maxWorkerCountOfIDBObjects){if(t&&this.allowPersistIntoIDB&&this.IDBManagementArray.length>e.IDBObjectCount){const t=this.getToBeDeletedIDs(e.IDBObjectCount);await this.deleteIDBItems(t)}this.allowedCountOfIndexDBObject=e.IDBObjectCount}}addEvent(e){if(!this.pushLogsOutOfOrdersFound&&this.eventsBufferArray.length>0&&e.timeStamp<this.eventsBufferArray[this.eventsBufferArray.length-1].timeStamp){this.pushLogsOutOfOrdersFound=!0;const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsLogsAddOutOfOrder);t?.fail({reason:`Add one log out of order: Current - ${e.timeStamp.toString()}, Last - ${this.eventsBufferArray[this.eventsBufferArray.length-1].timeStamp.toString()}`})}if(this.eventsBufferArray.push(e),this.eventsBufferArray.length>=this.allowedBufferLength)if(this.allowPersistIntoIDB&&this.dataManager)if(this.shouldBeThrottled()){const e=this.eventsBufferArray.shift();this.skippedEventsCount++,void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=e?.timeStamp),this.lastSkippedEventTime=e?.timeStamp}else this.flushBufferIntoIndexedDB(!0);else this.eventsBufferArray.shift()}getAllEvents(e){return!this.dataManager||!this.allowPersistIntoIDB||e&&this.eventsBufferArray.length>=e?e&&this.eventsBufferArray.length>e?Promise.resolve(this.eventsBufferArray.slice(this.eventsBufferArray.length-e)):Promise.resolve(this.eventsBufferArray):new Promise((t=>{this.dataManager?.getAllLogs().then((n=>{let i=[],a="",o="";n?.sort(((e,t)=>e.timeStamp-t.timeStamp)),n?.forEach((e=>{""!==a&&e.logsArray.length>1&&e.logsArray[0].timeStamp>e.logsArray[e.logsArray.length-1].timeStamp&&(a=`Fetch from IDB out of order: First - ${e.logsArray[0].timeStamp.toString()}, Last - ${e.logsArray[e.logsArray.length-1].timeStamp.toString()}`),e.sessionId!==o&&""!==o&&this.addAnSeperateLogItem(i,o),o=e.sessionId,i=i.concat(e.logsArray)})),""!==o&&o!==this.sessionId&&this.addAnSeperateLogItem(i,o),i=i.concat(this.eventsBufferArray),e&&i.length>e&&(i=i.slice(i.length-e)),t(i)}))}))}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}setWorkerLogsDataManager(e){this.dataManager=e}persistLogs(){this.allowPersistIntoIDB&&this.flushBufferIntoIndexedDB(!1)}handleUserLogout(e){return Promise.resolve()}async flushBufferIntoIndexedDB(e){if(this.eventsBufferArray.length>0){const t=this.eventsBufferArray;this.eventsBufferArray=[];const n=this.skippedEventsCount;this.updateThrottleInfo(t);const i=await this.getNextManagementItem(),a=this.scenarioFactory.newScenario(H.RG.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(i,t,e),a?.stop({skippedCount:n})}}updateThrottleInfo(e){this.skippedEventsCount>0&&this.lastSkippedEventTime&&(e.unshift({message:`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${this.firstSkippedEventTime?.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,level:_.i.Info,levelName:"Info",isPiiFree:!0,timeStamp:this.lastSkippedEventTime}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0),this.lastPersistTimestamp=Date.now()}persistBufferIntoDB(e,t,n){if(0===t.length||!this.allowPersistIntoIDB)return;const i={id:e.IDBId,logsArray:t,sessionId:this.sessionId||"",timeStamp:Date.now(),throttleEnabled:this.timeThrottleEnabled(),isRegularPersist:n};this.dataManager?.persistLogs(i),e.timeStamp=i.timeStamp}async deleteIDBItems(e){e.length>0&&this.dataManager&&e.forEach((async e=>{if(await(this.dataManager?.removeOneLogItem(e))){const t=this.IDBManagementArray.findIndex((t=>t.IDBId===e));t>=0&&this.IDBManagementArray.splice(t,1)}}))}async clearDBStore(){return this.dataManager&&await(this.dataManager?.clearAllLogs())&&(this.IDBManagementArray=[],this.currentIDBItemIndex=-1),!0}getToBeDeletedIDs(e){const t=[];if(this.dataManager&&e<this.IDBManagementArray.length){const n=this.IDBManagementArray.length-e;for(let e=0;e<n;e++){let e=0;this.currentIDBItemIndex<this.IDBManagementArray.length-1&&(e=this.currentIDBItemIndex+1);const n=this.IDBManagementArray[e];t.push(n.IDBId),this.IDBManagementArray.splice(e,1),0===e&&this.currentIDBItemIndex--}}return t}async getNextManagementItem(){return 0===this.IDBManagementArray.length&&this.allowedCountOfIndexDBObject>0&&await this.initializeManagementArray(),this.currentIDBItemIndex===this.IDBManagementArray.length-1?this.IDBManagementArray.length<this.allowedCountOfIndexDBObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.IDBManagementArray[this.currentIDBItemIndex]}addNewManagementItem(){let e=0;for(this.IDBManagementArray.length>0&&(e=this.IDBManagementArray[this.IDBManagementArray.length-1].IDBId),e++;e>this.allowedCountOfIndexDBObject||this.idExists(e);)e>this.allowedCountOfIndexDBObject?e=1:e++;this.IDBManagementArray.push({IDBId:e,timeStamp:0,isUpdating:!1})}idExists(e){return this.IDBManagementArray.filter((t=>t.IDBId===e)).length>0}async initializeManagementArray(){if(this.allowPersistIntoIDB&&this.dataManager&&0===this.IDBManagementArray.length&&this.allowedCountOfIndexDBObject>0){const e=await(this.dataManager?.getAllKeys());e?.sort(((e,t)=>e.timeStamp-t.timeStamp)),e?.forEach((e=>this.IDBManagementArray.push({IDBId:e.id,timeStamp:e.timeStamp,isUpdating:!1}))),this.currentIDBItemIndex=this.IDBManagementArray.length-1}}disablePersistIntoIDB(e,t){const n=this.allowPersistIntoIDB;switch(e){case B.ecsSetting:if(!this.ecsEnableIDBLogs)return;this.ecsEnableIDBLogs=!1;break;case B.clientPreference:if(!this.isUserEnableIDBLogs)return;this.isUserEnableIDBLogs=!1;break;case B.error:case B.beforeDeletingDB:if(this.disableIDBLogs)return;this.disableIDBLogs=!0}const i=`DiagnosticService - writing logs into IDB settings changed for ${B[e]}`;this.addEvent({message:i,isPiiFree:!0,level:e===B.error?_.i.Error:_.i.Info,levelName:e===B.error?"error":"info",timeStamp:new Date}),n&&!this.allowPersistIntoIDB&&(e===B.error?this.scenarioFactory.newScenario(H.RG.DiagnosticsDisableIDB)?.stop({errorReason:t}):e!==B.beforeDeletingDB&&this.clearDBStore())}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingInterval}timeThrottleEnabled(){return!this.isUserEnableIDBLogs&&this.timeThrottlingInterval>0&&this.lastPersistTimestamp>0}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${x.f5} The following logs are for previous session [${t}] ${x.f5}`,isPiiFree:!0,level:_.i.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}get allowPersistIntoIDB(){return(this.ecsEnableIDBLogs||this.isUserEnableIDBLogs)&&!this.disableIDBLogs}}class J{constructor(e,t){this.sessionId=e,this.allowedBufferLength=2e3,this.minBufferLength=500,this.maxBufferLength=5e3,this.timeThrottlingIntervalMs=6e4,this.lastPersistTimestamp=0,this.skippedEventsCount=0,this.disableExtendedPersistingThrottling=!1,this.fetchFromIDBTimeLimit=18e3,this.minFetchFromIDBTimeLimit=5e3,this.eventsBufferArray=[],this.updateBufferLength(t),this.scenarioFactory=F(!0)}setExtendedStorage(e){this._extendedStorage=e}setCapacity(e){void 0!==e.throttleTime&&e.throttleTime>=0&&(this.timeThrottlingIntervalMs=1e3*e.throttleTime),void 0!==e.clientEnableExtendedLogs&&(this.disableExtendedPersistingThrottling=e.clientEnableExtendedLogs),this.updateBufferLength(e.bufferSize),e.IDBFetchingTimeoutMs&&e.IDBFetchingTimeoutMs>this.minFetchFromIDBTimeLimit&&(this.fetchFromIDBTimeLimit=e.IDBFetchingTimeoutMs)}addEvent(e){if(this.eventsBufferArray.push(e),!(this.eventsBufferArray.length<this.allowedBufferLength)){if(!this._extendedStorage?.isStorageEnabled)return this.skippedEventsCount++,void this.eventsBufferArray.shift();if(this.shouldBeThrottled()){this.skippedEventsCount++;const e=this.eventsBufferArray.shift();void 0===this.firstSkippedEventTime&&(this.firstSkippedEventTime=e?.timeStamp),this.lastSkippedEventTime=e?.timeStamp}else this.flushBufferIntoExtendedStorage()}}async getAllEvents(e){if(this._extendedStorage?.isStorageEnabled&&(!e||e&&e>this.eventsBufferArray.length)){const t=e?e-this.eventsBufferArray.length:void 0,n=this._extendedStorage.getLatestLogs(t);try{const e=await(0,V.E)(n,this.fetchFromIDBTimeLimit);return Promise.resolve(e.concat(this.eventsBufferArray))}catch{const e=this.eventsBufferArray;return e.push({message:`DiagnosticsService - fetching logs form IDB timedout with limit of ${this.fetchFromIDBTimeLimit} ms`,isPiiFree:!0,level:_.i.Error,levelName:"error",timeStamp:new Date}),Promise.resolve(e)}}return e&&this.eventsBufferArray.length>e?Promise.resolve(this.eventsBufferArray.slice(this.eventsBufferArray.length-e)):Promise.resolve(this.eventsBufferArray)}handleUserLogout(){return this.eventsBufferArray.length=0,this._extendedStorage?this._extendedStorage.clearLogs():Promise.resolve(!0)}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}getBufferedEvents(e){return e&&e>0&&e<this.eventsBufferArray.length?this.eventsBufferArray.slice(this.eventsBufferArray.length-e):this.eventsBufferArray}flushBufferIntoExtendedStorage(){if(this.eventsBufferArray.length>0&&this._extendedStorage?.isStorageEnabled){const e=this.eventsBufferArray;this.eventsBufferArray=[];const t=this.skippedEventsCount;this.updateThrottleInfo(e),this.lastPersistTimestamp=Date.now();const n=this.scenarioFactory.newScenario(H.RG.DiagnosticsSaveToExtendedStorageMain),i=this.timeThrottleEnabled();this._extendedStorage.storeLogs(e,this.sessionId,Date.now(),i?"buffer-full":"buffer-full-without-throttle"),n?.stop({skippedCount:t,reason:"regular",message:i?"throttle_enabled":"throttle_not_enabled"})}}updateThrottleInfo(e){if(this.skippedEventsCount>0){let t=`DiagnosticsService - skipped ${this.skippedEventsCount} event logs before extended logs storage enabled`,n=new Date;this.lastSkippedEventTime&&(t=`DiagnosticsService - skipped ${this.skippedEventsCount} event logs between ${this.firstSkippedEventTime?.toISOString()} and ${this.lastSkippedEventTime.toISOString()} for logs throttle`,n=this.lastSkippedEventTime),e.unshift({message:t,level:_.i.Info,levelName:"Info",isPiiFree:!0,timeStamp:n}),this.skippedEventsCount=0,this.lastSkippedEventTime=void 0,this.firstSkippedEventTime=void 0}}shouldBeThrottled(){return!!this.timeThrottleEnabled()&&Date.now()-this.lastPersistTimestamp<this.timeThrottlingIntervalMs}timeThrottleEnabled(){return!this.disableExtendedPersistingThrottling&&this.timeThrottlingIntervalMs>0&&this.lastPersistTimestamp>0}updateBufferLength(e){e&&e!==this.allowedBufferLength&&e>=this.minBufferLength&&e<=this.maxBufferLength&&(this.allowedBufferLength=e)}}class Q{constructor(){this.minAllowedStorageObjectCount=3,this.allowedCountOfStorageObject=10,this.sessionId="",this.allowCacheStoredItemIDs=!1,this.scenarioFactory=F(!0)}setCapacity(e){this.allowedCountOfStorageObject!==e&&e>=this.minAllowedStorageObjectCount&&(this.allowedCountOfStorageObject=e,this.checkStorageItemCount())}setScenarioFactory(e){this.scenarioFactory.setScenarioFactory(e)}parseAndSortLogs(e,t){const n=new Map;e.forEach((e=>{if(e.logsArray&&e.logsArray.length>0){const t=n.get(e.sessionId)||[];n.set(e.sessionId,t.concat(e.logsArray))}}));const i=n.get(this.sessionId)||[];if(i&&n.delete(this.sessionId),n.forEach(((e,t)=>{e.sort(x.mw),this.addAnSeperateLogItem(e,t)})),i.sort(x.mw),t&&i.length>=t)return i.slice(i.length-t);let a=Array.from(n.values()).sort(((e,t)=>{const n="function"==typeof e[e.length-1].timeStamp.getTime?e[e.length-1].timeStamp:new Date(e[e.length-1].timeStamp),i="function"==typeof t[t.length-1].timeStamp?t[t.length-1].timeStamp:new Date(t[t.length-1].timeStamp);return n.getTime()-i.getTime()})).flat().concat(i);return t&&a.length>t&&(a=a.slice(a.length-t)),a}addAnSeperateLogItem(e,t){0!==e.length&&e.push({message:`${x.f5} The following logs are for previous session [${t}] ${x.f5}`,isPiiFree:!0,level:_.i.Info,levelName:"Info",timeStamp:e[e.length-1].timeStamp})}}class K extends Q{constructor(e,t,n,i=!1){super(),this.idbFactory=e,this.databaseName=t,this.sessionId=n,this.allowCacheStoredItemIDs=i,this.indexedDBVersion=1,this.storeName="LogsStore",this.timeIndexName="timeIdx",this.IDBErrorCount=0,this.allowedIDBErrorCount=10,this.disableIDBLogs=!1,this.ongoingSavingRequestCount=0,this.allowedSavingRequestCount=3,this.currentIDBItemIndex=-1,this.indexedDBManagedDiagnosticItems=[]}initialize(){if(this.db)return Promise.resolve(!0);if(this.disableIDBLogs)return Promise.resolve(!1);const e=this.scenarioFactory.newScenario(H.RG.DiagnosticsOpenIDB);return new Promise((t=>{const n=this.idbFactory.open(this.databaseName,this.indexedDBVersion);n.onerror=()=>{e?.fail({reason:"openDB error"}),this.increaseIDBErrorCount(),t(!1)},n.onblocked=()=>{e?.fail({reason:"openDB blocked",context:this.databaseName}),this.increaseIDBErrorCount(),t(!1)},n.onupgradeneeded=()=>{this.createDataStores(n.result)},n.onsuccess=()=>{e?.stop({context:this.databaseName}),this.allowCacheStoredItemIDs?this.initializeManagementArray(n.result):this.db=n.result,t(!0)}}))}async getLatestLogs(e){const t=this.getIDBStore(this.db,this.storeName,"readonly");if(t){return new Promise((n=>{const i=t.index(this.timeIndexName);if(!i)return n([]);{const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllLogsFromIDB),a=i.getAll();a.onsuccess=()=>{t?.stop({context:this.databaseName});const i=this.parseAndSortLogs(a.result,e);n(i)},a.onerror=()=>{t?.fail({reason:a.error,context:this.databaseName}),this.increaseIDBErrorCount(),n([])}}}))}return Promise.resolve([])}clearLogs(){return this.db?(this.disablePersistIntoIDB("Before clearing IDB"),this.db.close(),new Promise((e=>{const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsDeleteIDB),n=this.idbFactory.deleteDatabase(this.databaseName);n.onblocked=()=>{t?.fail({reason:`Deleting DB blocked for ${n.error}`,context:this.databaseName}),this.increaseIDBErrorCount(),e(!1)},n.onsuccess=()=>{t?.stop({context:this.databaseName}),this.indexedDBManagedDiagnosticItems=[],this.currentIDBItemIndex=-1,e(!0)},n.onerror=()=>{t?.fail({reason:`Deleting DB failed for ${n.error}`,context:this.databaseName}),this.increaseIDBErrorCount(),e(!1)}}))):Promise.resolve(!0)}storeLogs(e,t,n,i="force"){if(e.length>0){const a=this.scenarioFactory.newScenario(H.RG.DiagnosticsSaveIDBItemMain);this.persistBufferIntoDB(this.getNextManagedItem(),e,!1,t||this.sessionId,n||Date.now(),i),a?.stop({context:this.databaseName})}}get isStorageEnabled(){return!this.disableIDBLogs&&!!this.db}checkStorageItemCount(){if(this.allowCacheStoredItemIDs){this.getToBeDeletedIDs().forEach((e=>this.deleteIDBItem(e)))}else{const e=this.getIDBStore(this.db,this.storeName,"readwrite");if(e){const t=e.index(this.timeIndexName);if(t){const e=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllKeysFromIDB),n=t.getAllKeys();n.onsuccess=()=>{if(e?.stop({context:this.databaseName}),n.result.length>this.allowedCountOfStorageObject){const e=n.result.length-this.allowedCountOfStorageObject;for(let t=0;t<e;t++)this.deleteIDBItem(n.result[t])}},n.onerror=()=>{e?.fail({reason:n.error,context:this.databaseName}),this.increaseIDBErrorCount()}}}}}createDataStores(e){const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsCreateIDBStore);try{e.createObjectStore(this.storeName,{autoIncrement:!0}).createIndex(this.timeIndexName,"timeStamp",{unique:!1}),t?.stop({context:this.databaseName})}catch(e){t?.fail({reason:e,context:this.databaseName})}}getIDBStore(e,t,n){if(e)try{const i=e.transaction(t,n);return i?.objectStore(t)}catch{this.disablePersistIntoIDB("getIDBStore failed")}}persistBufferIntoDB(e,t,n=!1,i,a,o="buffer-full"){if(0===t.length)return;if(this.ongoingSavingRequestCount>this.allowedSavingRequestCount)return void this.disablePersistIntoIDB(`${this.ongoingSavingRequestCount} saving logs request are pending`);if(e.isUpdating&&!n)return void this.disablePersistIntoIDB("All diagnostics log indexedDB items are pending update");const r=this.getIDBStore(this.db,this.storeName,"readwrite");if(!r)return;n||(e.isUpdating=!0,e.timeStamp=a||Date.now());const s={logsArray:t,sessionId:i||this.sessionId,timeStamp:e.timeStamp};let l,c;this.ongoingSavingRequestCount++,e.IDBId>0?(c=this.scenarioFactory.newScenario(H.RG.DiagnosticsUpdateIDBItem),l=r.put(s,e.IDBId)):(c=this.scenarioFactory.newScenario(H.RG.DiagnosticsAddLogsIntoIDB),l=r.add(s)),l.onsuccess=()=>{this.ongoingSavingRequestCount--,c?.stop({reason:"buffer-full"===o||"buffer-full-without-throttle"===o?"regular":"forced",message:"buffer-full"===o?"throttle_enabled":"throttle_not_enabled",context:this.databaseName}),t.length=0,this.allowCacheStoredItemIDs&&(e.isUpdating=!1,e.IDBId=l.result),this.checkStorageItemCount()},l.onerror=()=>{this.ongoingSavingRequestCount--,c?.fail({reason:`${"buffer-full"===o||"buffer-full-without-throttle"===o?"regular":"forced"} - error: ${l.error}`,retryCount:n?1:0,context:this.databaseName,message:"buffer-full"===o?"throttle_enabled":"throttle_not_enabled"}),n?(t.length=0,e.isUpdating=!1,this.increaseIDBErrorCount()):this.persistBufferIntoDB(e,t,!0,i,a,o)}}getToBeDeletedIDs(){const e=[];if(this.allowCacheStoredItemIDs&&this.allowedCountOfStorageObject<this.indexedDBManagedDiagnosticItems.length){const t=this.indexedDBManagedDiagnosticItems.length-this.allowedCountOfStorageObject;for(let n=0;n<t;n++){let t=0;this.currentIDBItemIndex<this.indexedDBManagedDiagnosticItems.length-1&&(t=this.currentIDBItemIndex+1);const n=this.indexedDBManagedDiagnosticItems[t];e.push(n.IDBId),this.indexedDBManagedDiagnosticItems.splice(t,1),0===t&&this.currentIDBItemIndex--}}return e}deleteIDBItem(e){const t=this.getIDBStore(this.db,this.storeName,"readwrite");if(t){const n=this.scenarioFactory.newScenario(H.RG.DiagnosticsDeleteLogsInIDB),i=t.delete(e);i.onsuccess=()=>{n?.stop({context:this.databaseName})},i.onerror=()=>{n?.fail({reason:i.error,context:this.databaseName}),this.increaseIDBErrorCount()}}}getNextManagedItem(){return this.allowCacheStoredItemIDs?(this.currentIDBItemIndex===this.indexedDBManagedDiagnosticItems.length-1?this.indexedDBManagedDiagnosticItems.length<this.allowedCountOfStorageObject?(this.addNewManagementItem(),this.currentIDBItemIndex++):this.currentIDBItemIndex=0:this.currentIDBItemIndex++,this.indexedDBManagedDiagnosticItems[this.currentIDBItemIndex]):{IDBId:0,timeStamp:0,isUpdating:!1}}initializeManagementArray(e){if(this.allowCacheStoredItemIDs&&e&&!this.db){const t=this.getIDBStore(e,this.storeName,"readwrite");if(t){const n=t.index(this.timeIndexName);if(n){const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllKeysFromIDB),i=n.getAllKeys();i.onsuccess=()=>{t?.stop(),this.db=e,this.indexedDBManagedDiagnosticItems=[],i.result.forEach((e=>this.addNewManagementItem(e))),this.currentIDBItemIndex=this.indexedDBManagedDiagnosticItems.length-1,Promise.resolve(!0)},i.onerror=()=>{t?.fail({reason:i.error}),this.increaseIDBErrorCount(),Promise.resolve(!1)}}}}}addNewManagementItem(e=0){this.indexedDBManagedDiagnosticItems.push({timeStamp:0,isUpdating:!1,IDBId:e})}increaseIDBErrorCount(){this.IDBErrorCount<this.allowedIDBErrorCount&&(this.IDBErrorCount++,this.IDBErrorCount===this.allowedIDBErrorCount&&this.disablePersistIntoIDB("Allowed IDB error count reached"))}disablePersistIntoIDB(e){this.disableIDBLogs||(this.disableIDBLogs=!0,this.scenarioFactory.newScenario(H.RG.DiagnosticsDisableIDB)?.stop({errorReason:e,context:this.databaseName}))}}class Y extends Q{constructor(e,t,n,i=!1){super(),this.host=e,this.folderName=t,this.sessionId=n,this.allowCacheStoredItemIDs=i,this.OPFSErrorCount=0,this.allowedOPFSErrorCount=10,this.disableOPFSLogs=!1,this.ongoingSavingRequestCount=0,this.allowedSavingRequestCount=3,this.rootFolderName="DiagnosticsLogs",this.folderName=this.folderName.split(":").join("_")}async initialize(){if(this.folderHandle)return Promise.resolve(!0);if(this.folderName){const e=this.scenarioFactory.newScenario(H.RG.DiagnosticsInitOPFS);try{const t=await this.host.navigator.storage.getDirectory();return this.logsRootFolderHandle=await t.getDirectoryHandle(this.rootFolderName,{create:!0}),this.folderHandle=await this.logsRootFolderHandle.getDirectoryHandle(this.folderName,{create:!0}),e?.stop({context:this.folderName}),!0}catch(t){e?.fail({reason:t.errorCode||t.code})}}return!1}async getLatestLogs(e){return this.folderHandle?new Promise((async t=>{const n=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllLogsFromOPFS);try{const i=[],a=await(this.folderHandle?.values()),o=await this.getAllFiles(a),r=[];for(const e of o){const t=await e.value.getFile(),n=await t.text();let a=!1;if(n&&n.length>0)try{const e=JSON.parse(n);i.push(e)}catch{a=!0}else a=!0;a&&r.push(e.value.name)}const s=this.parseAndSortLogs(i,e);n?.stop({context:this.folderName}),r.length>0&&await this.deleteOPFSItems(r),t(s)}catch(e){n?.fail({reason:e.errorCode||e.code}),this.increaseOPFSErrorCount(),t([])}})):Promise.resolve([])}clearLogs(){return this.ongoingClearLogs||(this.disablePersistIntoOPFS("Deleting user OPFS folder"),this.ongoingClearLogs=new Promise((async e=>{let t=!0;if(this.logsRootFolderHandle&&this.folderHandle?.name){const e=this.folderHandle.name,n=this.logsRootFolderHandle,i=this.scenarioFactory.newScenario(H.RG.DiagnosticsClearOPFSFolder);try{await n.removeEntry(e,{recursive:!0}),this.storedItemIds=void 0,i?.stop({context:this.folderName})}catch(e){i?.fail({reason:`Deleting OPFS folder failed for ${e.errorCode||e.code}`}),this.increaseOPFSErrorCount(),t=!1}}this.ongoingClearLogs=void 0,e(t)}))),this.ongoingClearLogs}storeLogs(e,t,n,i="force"){if(0===e.length)return;const a=this.scenarioFactory.newScenario(H.RG.DiagnosticsSaveOPFSItemMain),o=this.createLogsFile(e,t||this.sessionId,n);this.persistBufferIntoOPFS(o,!1,i),a?.stop({context:this.folderName})}get isStorageEnabled(){return!this.disableOPFSLogs&&!!this.folderHandle}async checkStorageItemCount(){try{const e=await this.getStoredItemIds();e&&e.length>this.allowedCountOfStorageObject&&this.deleteOPFSItems(e.slice(0,e.length-this.allowedCountOfStorageObject))}catch(e){this.increaseOPFSErrorCount()}}async getStoredItemIds(){if(this.allowCacheStoredItemIDs&&void 0!==this.storedItemIds)return this.storedItemIds;if(this.folderHandle){const e=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetAllKeysFromOPFS);try{if(void 0===this.storedItemIds&&this.allowCacheStoredItemIDs||!this.allowCacheStoredItemIDs){this.storedItemIds=[];const t=await this.folderHandle.keys();let n=await t.next();for(;void 0!==n&&!n.done&&n.value;)this.storedItemIds.push(n.value),n=await t.next();e?.stop({context:this.folderName}),this.storedItemIds.sort(((e,t)=>Number(e)-Number(t)))}}catch{e?.fail({reason:"Get stored item Ids fail",context:this.folderName}),this.increaseOPFSErrorCount()}}return this.storedItemIds||[]}async getAllFiles(e){const t=[];if(e){let n=await e.next();for(;n&&!n.done&&n.value;)"file"===n.value.kind&&t.push(n),n=await e.next()}return t}async persistBufferIntoOPFS(e,t=!1,n="buffer-full"){if(0===e.logsArray.length)return Promise.resolve();if(this.ongoingSavingRequestCount>this.allowedSavingRequestCount)return this.disablePersistIntoOPFS(`${this.ongoingSavingRequestCount} saving logs request are pending`),Promise.resolve();if(this.folderHandle){const i=e.timeStamp.toString(),a=await this.folderHandle.getFileHandle(i,{create:!0});if(a){this.ongoingSavingRequestCount++;const o=this.scenarioFactory.newScenario(H.RG.DiagnosticsAddLogsIntoOPFS);try{const t=await a.createWritable();await t.write(JSON.stringify(e)),await t.close(),this.ongoingSavingRequestCount--,o?.stop({reason:"buffer-full"===n||"buffer-full-without-throttle"===n?"regular":"forced",message:"buffer-full"===n?"throttle_enabled":"throttle_not_enabled",context:this.folderName}),this.allowCacheStoredItemIDs&&void 0!==this.storedItemIds&&this.storedItemIds.push(i),this.checkStorageItemCount()}catch(i){this.ongoingSavingRequestCount--,o?.fail({reason:`${"buffer-full"===n||"buffer-full-without-throttle"===n?"regular":"forced"} - error: ${i.errorCode||i.code}`,message:"buffer-full"===n?"throttle_enabled":"throttle_not_enabled",retryCount:t?1:0}),t?this.increaseOPFSErrorCount():await this.persistBufferIntoOPFS(e,!0,n)}}}}async deleteOPFSItems(e){e.length>0&&this.folderHandle&&e.forEach((async e=>{const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsDeleteLogsInOPFS);try{await(this.folderHandle?.removeEntry(e)),this.storedItemIds&&(this.storedItemIds=this.storedItemIds.filter((t=>t!==e))),t?.stop({context:this.folderName})}catch(e){return t?.fail({reason:e.errorCode||e.code}),void this.increaseOPFSErrorCount()}}))}increaseOPFSErrorCount(){this.OPFSErrorCount<this.allowedOPFSErrorCount&&(this.OPFSErrorCount++,this.OPFSErrorCount===this.allowedOPFSErrorCount&&this.disablePersistIntoOPFS("Allowed OPFS error count reached"))}disablePersistIntoOPFS(e){this.disableOPFSLogs||(this.disableOPFSLogs=!0,this.scenarioFactory.newScenario(H.RG.DiagnosticsDisableOPFS)?.stop({reason:e}))}createLogsFile(e,t,n){return{logsArray:e,sessionId:t,timeStamp:n||Date.now()}}}class X{constructor(e,t,n,i,a){this.sessionId=e,this.experienceName=t,this.extendedStoreName=n,this.defaultPreECSConsoleLogLevel=i,this.userECSConsoleLogLevel=a,this.userDiagnosticsMap=new Map,this._userID="",this.memoryBufferArraySize=0,this._minDurationForCountingLogLines=20,this._minThrottleWindowSize=1e4,this._minThrottleWindowCapacity=5,this._minLoggerReportTimeInterval=1e4,this._minLoggerReportCountInterval=30,this._maxCorePreviousSessionLogsLength=0,this._maxUserPreviousSessionLogsLength=0,this._cleanPreviousSessionLogsDelay=18e4,this._clearPreviousSessionLogsTimer=0,this._minLogsInLogFile=500,this._ALTCompleted=!1,this.rwcExperienceName="react-web-client",this.logsStoredAsPreviousSession=!1,this._disableGzipPreviousSessionLogs=!1,this._defaultMainBufferLength=2e3,this.ecsEnableIDBLogs=!1,this.isUserEnableIDBLogs=!1,this.extendedStorageType="None",this._loggerSettings={durationForCountingLogLines:0,loggerReportTimeInterval:0,loggerReportCountInterval:0,diagnosticsLogsThrottling:"DryRunQuiet",isUserEnableIDBLogs:!1,throttleWindowSize:0,throttleCapacity:0,consoleLogLevel:_.i.Error,throttleLoggers:new Set},this._defaultLatestErrorCount=5,this.tId="",this.oId="",this._firstUserID="",this.logsProviderName=E.DIAGNOSTICSSERVICE,this.updatedSettingsForMainThread=e=>{this.diagnosticsSettings=e,(0,W.isUndefined)(e.clientExtendedDiagnosticsData)||(this.isUserEnableIDBLogs=!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle),this.updateSettingsForLogger({durationForCountingLogLines:e.logsMarkInterval||0,loggerReportTimeInterval:e.loggerReportTimeInterval||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:e.loggerReportCountInterval||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:e.throttleWindowSizeMs||0,throttleCapacity:e.throttleCapacity||0,isUserEnableIDBLogs:this.isUserEnableIDBLogs,diagnosticsLogsThrottling:e.diagnosticsLogsThrottling||"DryRunQuiet",throttleLoggers:new Set(e.loggerThrottleList||[]),consoleLogLevel:this.validateConsoleLogLevel(e.consoleLogLevel||"")});const t=(0,W.isNumber)(e.savingLogsIntoIDBThrottleTime)?e.savingLogsIntoIDBThrottleTime:void 0,n=(0,W.isNumber)(e.diagnosticsEventQueueMaxSize)?e.diagnosticsEventQueueMaxSize:0;if(void 0===e.enableStoreDiagnosticsLogsInIDB&&void 0===e.clientExtendedDiagnosticsData)this.diagnosticsEvents.setCapacity({bufferSize:n,throttleTime:t});else{(0,W.isUndefined)(e.enableStoreDiagnosticsLogsInIDB)||(this.ecsEnableIDBLogs=!!e.enableStoreDiagnosticsLogsInIDB),this.enableExtendedStorage()&&!this.extendedStorage?.isStorageEnabled&&this.addAndInitExtendedStorage();const i=this.enableExtendedStorage()?(0,W.isNumber)(e.diagnosticsLogBufferArraySize)?e.diagnosticsLogBufferArraySize:0:n;this.diagnosticsEvents.setCapacity({bufferSize:i,clientEnableExtendedLogs:this.isUserEnableIDBLogs,IDBFetchingTimeoutMs:(0,W.isNumber)(e.IDBFetchingTimeoutMs)?e.IDBFetchingTimeoutMs:0,throttleTime:t}),this.extendedStorage?.setCapacity?.((0,W.isNumber)(e.diagnosticsLogsIDBObjectCount)?e.diagnosticsLogsIDBObjectCount:0)}this._disableGzipPreviousSessionLogs=!!e.disableGzipPreviousSessionLogs,this._maxCorePreviousSessionLogsLength=this.validateSettingNumberValue(e.corePreviousSessionLogsLength,-1,this._maxCorePreviousSessionLogsLength),this._maxUserPreviousSessionLogsLength=this.validateSettingNumberValue(e.userPreviousSessionLogsLength,-1,this._maxUserPreviousSessionLogsLength),this.isErrorDiagnosticsEnabled=!!e.errorDiagnosticsEventQueueMaxSize,e.extendedStorageType&&(this.extendedStorageType=e.extendedStorageType),this.isErrorDiagnosticsEnabled?(0,W.isNumber)(e.errorDiagnosticsEventQueueMaxSize)&&this.errorDiagnosticsEvents.setCapacity({bufferSize:e.errorDiagnosticsEventQueueMaxSize}):this.errorDiagnosticsEvents.handleUserLogout(),this._cleanPreviousSessionLogsDelay=this.validateSettingNumberValue(e.clearPreviousSessionLogsDelayMs,0,this._cleanPreviousSessionLogsDelay)},this.updatedSettingsForWorkerThread=e=>{const{workerDiagnosticsEventQueueMaxSize:t,enableWorkerStoreDiagnosticsLogsInIDB:n,workerDiagnosticsLogBufferArraySize:i,workerDiagnosticsLogsIDBObjectCount:a,logsMarkInterval:o,savingLogsIntoIDBThrottleTime:r,throttleCapacity:s,throttleWindowSizeMs:l,clientExtendedDiagnosticsData:c,disableExtendedDiagnosticsDataToggle:d,diagnosticsLogsThrottling:u,consoleLogLevel:m,loggerReportTimeInterval:p,loggerReportCountInterval:g,loggerThrottleList:h}=e;this.updateSettingsForLogger({durationForCountingLogLines:o||0,loggerReportTimeInterval:p||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:g||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:l||0,throttleCapacity:s||0,isUserEnableIDBLogs:!!c&&!d,diagnosticsLogsThrottling:u||"DryRunQuiet",throttleLoggers:new Set(h||[]),consoleLogLevel:this.validateConsoleLogLevel(m||"")});const y=(0,W.isNumber)(r)?r:void 0,v=(0,W.isNumber)(t)?t:0;this.memoryBufferArraySize=n&&(0,W.isNumber)(i)?i:v,this.diagnosticsEvents.setCapacity({bufferSize:this.memoryBufferArraySize,enableIndexedDB:(0,W.isUndefined)(n)?void 0:!!n,IDBObjectCount:(0,W.isNumber)(a)?a:0,throttleTime:y,clientEnableExtendedLogs:(0,W.isUndefined)(c)?void 0:!!c&&!d})},this.attemptToSetHost(),this.scenarioFactory=F(!1),void 0!==this.userECSConsoleLogLevel?this.loggerSettings.consoleLogLevel=this.userECSConsoleLogLevel:void 0!==i&&(this.loggerSettings.consoleLogLevel=i),this.diagnosticsEvents=new J(this.sessionId,this._defaultMainBufferLength),this.isErrorDiagnosticsEnabled=!1,this.errorDiagnosticsEvents=new j(!0,this.sessionId,this.host),this.host?.addEventListener&&this.host.addEventListener("unload",(()=>{this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer),this.persistDiagnosticsAsPreviousSessionLogs()}))}setScenarioFactory(e){this.coreScenarioFactory=e,this.scenarioFactory.setScenarioFactory(e),this.diagnosticsEvents.setScenarioFactory(e),this.extendedStorage?.setScenarioFactory(e),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScenarioFactory(e)}))}setScheduler(e){}setLogsCountReporter(e){this._logsCountReporter||(this._logsCountReporter=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setLogsCountReporter(e)})))}setALTDone(){this._ALTCompleted||(this._ALTCompleted=!0,this.addAndInitExtendedStorage(),this._userID===x.$J&&this.host?.localStorage&&this.cleanAllPreviousSessionLogsWithDelay(this.host),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>e.setALTDone())))}subscribeToCoreSettings(e){e.getObservable(b.J.Diagnostics).subscribe((e=>{this.extendedStoreName===i.DiagnosticsLogsWorker?this.updatedSettingsForWorkerThread(e):(this.updatedSettingsForMainThread(e),this.userDiagnosticsMap.size>0&&this.userDiagnosticsMap.forEach(((t,n)=>{this._firstUserID===n?t.updatedSettingsForMainThread({...e,userPreviousSessionLogsLength:e.firstUserPreviousSessionLogsLength}):t.updatedSettingsForMainThread(e)})))})),this.logCountReporter&&this.logCountReporter.subscribeToCoreSettings(e)}updateDiagnosticInfo(e,t,n){e&&(this.tId=e),t&&(this.oId=t),n&&(this._userID=n),this.addAndInitExtendedStorage(),this.errorDiagnosticsEvents.setDBInfo(e,t,n)}handleUserLogout(e){if(e){const t=this.userDiagnosticsMap.get(e);if(t){this.userDiagnosticsMap.delete(e);let n=Promise.resolve();return 0===this.userDiagnosticsMap.size&&(n=this.cleanLogsStorage()),Promise.all([t.handleUserLogout(e),n]).then()}this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer)}return this.cleanLogsStorage()}createUserDiagnosticsService(e,t,n){if(this.extendedStoreName===i.DiagnosticsLogsWorker||this._userID&&this._userID!==x.$J)this.pushDiagnosticsEvent(_.i.Error,"DiagnosticsService: createUserDiagnosticsService function should only be called from the coreDiagnosticsService in the main thread",!0);else if(e&&t&&n){this._userID||this.updateDiagnosticInfo(x.zB,x.m0,x.$J),this._firstUserID||(this._firstUserID=n);let i=this.userDiagnosticsMap.get(n);return void 0===i&&(i=new X(this.sessionId,this.experienceName,this.extendedStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel),i.updateDiagnosticInfo(e,t,n),this.diagnosticsSettings&&(this._firstUserID===n?i.updatedSettingsForMainThread({...this.diagnosticsSettings,userPreviousSessionLogsLength:this.diagnosticsSettings.firstUserPreviousSessionLogsLength}):i.updatedSettingsForMainThread(this.diagnosticsSettings)),this.coreScenarioFactory&&i.setScenarioFactory(this.coreScenarioFactory),this._logsCountReporter&&i.setLogsCountReporter(this._logsCountReporter),this._ALTCompleted&&i.setALTDone(),this.userDiagnosticsMap.set(n,i)),i}}pushDiagnosticsEvent(e,t,n,i){const a=(0,x.hR)(this.diagnosticsEvents,e,t,n,i,!1);e===_.i.Error&&this.isErrorDiagnosticsEnabled&&this.errorDiagnosticsEvents.addEvent(a,!1)}async getDiagnosticsEvents(e){let t=[];const n=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetLogs);try{t=await this.diagnosticsEvents.getAllEvents(e)||[]}catch(e){const t=`DiagnosticsService: Failed to fetch diagnostic logs: ${e}`;this.pushDiagnosticsEvent(_.i.Error,t,!0),n?.fail({reason:t})}try{t=t.reverse(),n?.stop()}catch(e){n?.fail({reason:"Logs events array failed on reverting and sorting"})}return t}persistDiagnostics(){}async getLogsFiles(e,t=0){t>0&&t<this._minLogsInLogFile&&(t=this._minLogsInLogFile);const n="No logs found",i="Logging of this type is not enabled";let a="",o="",r=this.isErrorDiagnosticsEnabled&&await this.errorDiagnosticsEvents.getAllEvents()||[];r=(e?(0,x.Ij)(r):r).reverse();let s=(0,x.Mf)(r.slice(0,this._defaultLatestErrorCount));s&&(s=`Latest errors for ${this._userID}\r\n${s}`),this.isErrorDiagnosticsEnabled?(o=this.getPreviousSessionDiagnosticsLogsString(!0,e),a=(0,x.Mf)(r)):(o=i,a=i);const l=this.getPreviousSessionDiagnosticsLogsString(!1,e),c=await this.getDiagnosticsLogs(!!e,t),d=x.$J===this._userID?void 0:this._userID;return Promise.resolve([{isPiiFree:!!e,fileName:"diagnostics-error-logs-previous-session.txt",content:o||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-logs-previous-session.txt",content:l||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-error-logs.txt",content:a||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"diagnostics-logs.txt",content:c||n,...d?{userId:d}:{}},{isPiiFree:!!e,fileName:"latestErrors",content:s,...d?{userId:d}:{}}])}getSystemInfo(){return Promise.resolve(new Map)}get loggerSettings(){return this._loggerSettings}get logScheduler(){}get userId(){return this._userID!==x.$J?this._userID:""}get logCountReporter(){return this._logsCountReporter}persistDiagnosticsAsPreviousSessionLogs(){if(!this.logsStoredAsPreviousSession&&(this.logsStoredAsPreviousSession=!0,this.host?.localStorage)){const e=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,t=this.experienceName===this.rwcExperienceName?this.sessionId:void 0,n=e===x.$J?this._maxCorePreviousSessionLogsLength:this._maxUserPreviousSessionLogsLength;if(n<0)return;const i=this.diagnosticsEvents.getBufferedEvents(n);i.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,i,(0,x.IB)(e),t);const a=this.errorDiagnosticsEvents?.getBufferedEvents(n)||[];a.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,a,(0,x.IB)(e,!0),t),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnosticsAsPreviousSessionLogs()}))}}persistLogsWithErrorHandle(e,t,n,i){try{(0,x.NF)(e,t,n,i,!this._disableGzipPreviousSessionLogs)}catch(e){this.pushDiagnosticsEvent(_.i.Error,`DiagnosticsService: window_localstorage save logs failure, ${e?.name}`,!0)}}enableExtendedStorage(){return this.ecsEnableIDBLogs||this.isUserEnableIDBLogs}async getDiagnosticsLogs(e,t=0){const n=await this.getDiagnosticsEvents(t),i=(0,x.Mf)(e?(0,x.Ij)(n):n),a=`Note: only ${this.memoryBufferArraySize||2e3} most recent logs are guaranteed to be shown due to the way logs are stored. Previous logs may have been removed\n`;return i?a+i:i}attemptToSetHost(){try{this.host=(0,L.J)()}catch{}}cleanLogsStorage(){return this.host?.localStorage&&((0,x.uD)(this.host.localStorage,this._userID),this._userID===x.$J&&((0,x.uD)(this.host.localStorage,""),(0,x.e2)(this.host.localStorage))),Promise.all([this.diagnosticsEvents.handleUserLogout(),this.errorDiagnosticsEvents.handleUserLogout()]).then()}updateSettingsForLogger(e){this._loggerSettings.durationForCountingLogLines=this.validateSettingNumberValue(e.durationForCountingLogLines,this._minDurationForCountingLogLines,this._loggerSettings.durationForCountingLogLines),this._loggerSettings.throttleCapacity=this.validateSettingNumberValue(e.throttleCapacity,this._minThrottleWindowCapacity,this._loggerSettings.throttleCapacity),this._loggerSettings.throttleWindowSize=this.validateSettingNumberValue(e.throttleWindowSize,this._minThrottleWindowSize,this._loggerSettings.throttleWindowSize),this._loggerSettings.isUserEnableIDBLogs=e.isUserEnableIDBLogs,this._loggerSettings.diagnosticsLogsThrottling=e.diagnosticsLogsThrottling,void 0===this.userECSConsoleLogLevel&&void 0!==e.consoleLogLevel&&null!==e.consoleLogLevel&&(this._loggerSettings.consoleLogLevel=e.consoleLogLevel),this._loggerSettings.loggerReportTimeInterval=this.validateSettingNumberValue(e.loggerReportTimeInterval,this._minLoggerReportTimeInterval,this._loggerSettings.loggerReportTimeInterval),this._loggerSettings.loggerReportCountInterval=this.validateSettingNumberValue(e.loggerReportCountInterval,this._minLoggerReportCountInterval,this._loggerSettings.loggerReportCountInterval),this._loggerSettings.throttleLoggers=e.throttleLoggers}validateSettingNumberValue(e,t,n,i=!0){return(0,W.isNumber)(e)&&(i&&e===t||e>t)?e:n}validateConsoleLogLevel(e){if(this.isValidLoglevel(e))return _.i[e]}isValidLoglevel(e){return Object.keys(_.i).includes(e)}getPreviousSessionDiagnosticsLogsString(e,t){let n="";if(this.host?.localStorage){const i=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,a=(0,x.IB)(i,e);n=(0,x.gE)(this.host.localStorage,a,!!t)}return n||"No logs found"}async addAndInitExtendedStorage(){if((this.isUserEnableIDBLogs||this.ecsEnableIDBLogs)&&this._ALTCompleted&&this.host&&"None"!==this.extendedStorageType){const e=this.getDBName();if(!this.extendedStorage&&e){const t=!!this.host?.loader?.getProperties?.().isMaglev,n=this.host.indexedDB;let i;if("OriginPrivateFileSystem"===this.extendedStorageType&&"navigator"in this.host?i=new Y(this.host,e,this.sessionId,t):"IndexedDB"===this.extendedStorageType&&"indexedDB"in this.host&&(i=new K(n,e,this.sessionId,t)),void 0===i)return;if(this.coreScenarioFactory&&i.setScenarioFactory(this.coreScenarioFactory),this.diagnosticsSettings){const{diagnosticsLogsIDBObjectCount:e}=this.diagnosticsSettings;i.setCapacity((0,W.isNumber)(e)?e:0)}this.extendedStorage=i,this.diagnosticsEvents.setExtendedStorage(i)}if(this.extendedStorage&&!this.extendedStorage.isStorageEnabled){await this.extendedStorage.initialize()&&this.fetchAndPersistPreviuosSessionLogs()}}}fetchAndPersistPreviuosSessionLogs(){if(this.extendedStorage?.isStorageEnabled&&this._userID&&this.host?.localStorage){const e=(0,x.IB)(this._userID),t=(0,x.Tx)(this.host.localStorage,e,!1);t&&t.sessionId&&t.logsArray?.length>0&&(this.extendedStorage.storeLogs(t.logsArray,t.sessionId,t.logsArray[t.logsArray.length-1].timeStamp.getTime(),"force"),(0,x.uD)(this.host.localStorage,this._userID))}}getDBName(){return this.tId&&this.oId&&this.experienceName&&this.sessionId?`Teams:${this.extendedStoreName}:${this.experienceName}:${this.tId}:${this.oId}`:""}cleanAllPreviousSessionLogsWithDelay(e){this._clearPreviousSessionLogsTimer=e.setTimeout((()=>{(0,x.yQ)(e)}),this._cleanPreviousSessionLogsDelay)}}class Z{constructor(e,t,n,a,o){this.sessionId=e,this.experienceName=t,this.dbStoreName=n,this.defaultPreECSConsoleLogLevel=a,this.userECSConsoleLogLevel=o,this.diagnosticsBackupEnabled=!1,this.allowPersistUncaughtErrorLogs=!1,this.userDiagnosticsMap=new Map,this._userID="",this.memoryBufferArraySize=0,this._minDurationForCountingLogLines=20,this._minThrottleWindowSize=1e4,this._minThrottleWindowCapacity=5,this._minLoggerReportTimeInterval=1e4,this._minLoggerReportCountInterval=30,this._minLogsInLogFile=500,this._ALTCompleted=!1,this.rwcExperienceName="react-web-client",this.logsStoredAsPreviousSession=!1,this._enableScheduler=!1,this._enableSchedulerBeforeALT=!1,this._disableGzipPreviousSessionLogs=!1,this._forceUsingV1Service=!1,this._cleanPreviousSessionLogsDelay=18e4,this._clearPreviousSessionLogsTimer=0,this._firstUserID="",this._loggerSettings={durationForCountingLogLines:0,loggerReportTimeInterval:0,loggerReportCountInterval:0,diagnosticsLogsThrottling:"DryRunQuiet",isUserEnableIDBLogs:!1,throttleWindowSize:0,throttleCapacity:0,consoleLogLevel:_.i.Error,throttleLoggers:new Set},this._defaultLatestErrorCount=5,this._maxCorePreviousSessionLogsLength=0,this._maxUserPreviousSessionLogsLength=0,this.logsProviderName=E.DIAGNOSTICSSERVICE,this.updatedSettingsForMainThread=e=>{this.diagnosticsSettings=e,this.updateSettingsForLogger({durationForCountingLogLines:e.logsMarkInterval||0,loggerReportTimeInterval:e.loggerReportTimeInterval||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:e.loggerReportCountInterval||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:e.throttleWindowSizeMs||0,throttleCapacity:e.throttleCapacity||0,isUserEnableIDBLogs:!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle,diagnosticsLogsThrottling:e.diagnosticsLogsThrottling||"DryRunQuiet",throttleLoggers:new Set(e.loggerThrottleList||[]),consoleLogLevel:this.validateConsoleLogLevel(e.consoleLogLevel||"")}),this.setDiagnosticsBackupEnabled(!!e.enableDiagnosticsBackup,e.diagnosticsBackupSyncCycleMs||void 0);const t=(0,W.isNumber)(e.savingLogsIntoIDBThrottleTime)?e.savingLogsIntoIDBThrottleTime:void 0,n=(0,W.isNumber)(e.diagnosticsEventQueueMaxSize)?e.diagnosticsEventQueueMaxSize:0;if(void 0===e.enableStoreDiagnosticsLogsInIDB&&void 0===e.clientExtendedDiagnosticsData)n&&this.diagnosticsEvents.setCapacity({bufferSize:n,throttleTime:t});else{const i=e.enableStoreDiagnosticsLogsInIDB?(0,W.isNumber)(e.diagnosticsLogBufferArraySize)?e.diagnosticsLogBufferArraySize:0:n;this.diagnosticsEvents.setCapacity({enableIndexedDB:(0,W.isUndefined)(e.enableStoreDiagnosticsLogsInIDB)?void 0:!!e.enableStoreDiagnosticsLogsInIDB,bufferSize:i,IDBObjectCount:(0,W.isNumber)(e.diagnosticsLogsIDBObjectCount)?e.diagnosticsLogsIDBObjectCount:0,throttleTime:t,clientEnableExtendedLogs:(0,W.isUndefined)(e.clientExtendedDiagnosticsData)?void 0:!!e.clientExtendedDiagnosticsData&&!e.disableExtendedDiagnosticsDataToggle,IDBFetchingTimeoutMs:(0,W.isNumber)(e.IDBFetchingTimeoutMs)?e.IDBFetchingTimeoutMs:0})}this._enableScheduler=!!e.enableSchedulerOnLoggers,this._enableSchedulerBeforeALT=!!e.enableSchedulerOnLoggersBeforeALT,this._disableGzipPreviousSessionLogs=!!e.disableGzipPreviousSessionLogs,this.isErrorDiagnosticsEnabled=!!e.errorDiagnosticsEventQueueMaxSize,this.allowPersistUncaughtErrorLogs=!!e.allowPersistUncaughtErrorLogs,this._forceUsingV1Service=!!e.forceUsingV1Service,this._maxCorePreviousSessionLogsLength=this.validateSettingNumberValue(e.corePreviousSessionLogsLength,-1,this._maxCorePreviousSessionLogsLength),this._maxUserPreviousSessionLogsLength=this.validateSettingNumberValue(e.userPreviousSessionLogsLength,-1,this._maxUserPreviousSessionLogsLength),this._cleanPreviousSessionLogsDelay=this.validateSettingNumberValue(e.clearPreviousSessionLogsDelayMs,0,this._cleanPreviousSessionLogsDelay),this.isErrorDiagnosticsEnabled?(0,W.isNumber)(e.errorDiagnosticsEventQueueMaxSize)&&this.errorDiagnosticsEvents.setCapacity({bufferSize:e.errorDiagnosticsEventQueueMaxSize,throttleTime:t}):this.errorDiagnosticsEvents=new j(!0,this.sessionId,this.host,this._defaultLatestErrorCount)},this.updatedSettingsForWorkerThread=e=>{const{workerDiagnosticsEventQueueMaxSize:t,enableWorkerStoreDiagnosticsLogsInIDB:n,workerDiagnosticsLogBufferArraySize:i,workerDiagnosticsLogsIDBObjectCount:a,logsMarkInterval:o,savingLogsIntoIDBThrottleTime:r,throttleCapacity:s,throttleWindowSizeMs:l,clientExtendedDiagnosticsData:c,disableExtendedDiagnosticsDataToggle:d,diagnosticsLogsThrottling:u,consoleLogLevel:m,loggerReportTimeInterval:p,loggerReportCountInterval:g,loggerThrottleList:h}=e;this.updateSettingsForLogger({durationForCountingLogLines:o||0,loggerReportTimeInterval:p||this._loggerSettings.loggerReportTimeInterval,loggerReportCountInterval:g||this._loggerSettings.loggerReportCountInterval,throttleWindowSize:l||0,throttleCapacity:s||0,isUserEnableIDBLogs:!!c&&!d,diagnosticsLogsThrottling:u||"DryRunQuiet",throttleLoggers:new Set(h||[]),consoleLogLevel:this.validateConsoleLogLevel(m||"")});const y=(0,W.isNumber)(r)?r:void 0,v=(0,W.isNumber)(t)?t:0;this.memoryBufferArraySize=n&&(0,W.isNumber)(i)?i:v,this.diagnosticsEvents.setCapacity({bufferSize:this.memoryBufferArraySize,enableIndexedDB:(0,W.isUndefined)(n)?void 0:!!n,IDBObjectCount:(0,W.isNumber)(a)?a:0,throttleTime:y,clientEnableExtendedLogs:(0,W.isUndefined)(c)?void 0:!!c&&!d})},this.attemptToSetHost(),this.scenarioFactory=F(!1),void 0!==this.userECSConsoleLogLevel?this.loggerSettings.consoleLogLevel=this.userECSConsoleLogLevel:void 0!==a&&(this.loggerSettings.consoleLogLevel=a),this.sessionId&&t&&n===i.DiagnosticsLogsMain?this.diagnosticsEvents=new G(this.host,t,n,this.sessionId):t&&n===i.DiagnosticsLogsWorker&&this.sessionId?this.diagnosticsEvents=new q(this.sessionId):this.diagnosticsEvents=new j(!1,this.sessionId,this.host),this.isErrorDiagnosticsEnabled=!1,this.errorDiagnosticsEvents=new j(!0,this.sessionId,this.host),this.diagnosticsBackupService=void 0,this.host?.addEventListener&&this.host.addEventListener("unload",(()=>{this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer),this.persistDiagnosticsAsPreviousSessionLogs()})),t!==this.rwcExperienceName&&this.loadDiagnosticsFromLocalStorage(!0)}setScenarioFactory(e){this.coreScenarioFactory=e,this.scenarioFactory.setScenarioFactory(e),this.diagnosticsEvents.setScenarioFactory(e),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScenarioFactory(e)}))}setScheduler(e){this._scheduler||(this._scheduler=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setScheduler(e)})))}setLogsCountReporter(e){this._logsCountReporter||(this._logsCountReporter=e,this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((t=>{t.setLogsCountReporter(e)})))}setALTDone(){if(!this._ALTCompleted){if(this._ALTCompleted=!0,this.diagnosticsEvents.setALTDone(),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>e.setALTDone())),this._userID===x.$J&&this.host?.localStorage){if(!this.diagnosticsSettings?.skipCleanInvalidPreSessionLogs){const e=Array.from(this.userDiagnosticsMap.keys());(0,x.OO)(this.host.localStorage,[...e,x.$J])}this.cleanAllPreviousSessionLogsWithDelay(this.host)}this._userID===x.$J&&this.experienceName===this.rwcExperienceName&&this.host?.localStorage&&(0,x.e2)(this.host.localStorage)}}subscribeToCoreSettings(e){if(!e)return void this.pushDiagnosticsEvent(_.i.Error,"DiagnosticsService: Failed to subscribe to core settings",!0);e.getObservable(b.J.Diagnostics).subscribe((e=>{this.dbStoreName===i.DiagnosticsLogsWorker?this.updatedSettingsForWorkerThread(e):(this.updatedSettingsForMainThread(e),this.userDiagnosticsMap.size>0&&this.userDiagnosticsMap.forEach(((t,n)=>{this._firstUserID===n?t.updatedSettingsForMainThread({...e,userPreviousSessionLogsLength:e.firstUserPreviousSessionLogsLength}):t.updatedSettingsForMainThread(e)})))})),this.logCountReporter&&this.logCountReporter.subscribeToCoreSettings(e)}updateDiagnosticInfo(e,t,n){n&&(this._userID=n),this.diagnosticsEvents.setDBInfo(e,t,n),this.errorDiagnosticsEvents.setDBInfo(e,t,n)}handleUserLogout(e){if(e){const t=this.userDiagnosticsMap.get(e);if(t){this.userDiagnosticsMap.delete(e);let n=Promise.resolve();return 0===this.userDiagnosticsMap.size&&(n=this.cleanLogsStorage()),Promise.all([t.handleUserLogout(e),n]).then()}this._clearPreviousSessionLogsTimer&&this.host?.clearTimeout(this._clearPreviousSessionLogsTimer)}return this.cleanLogsStorage()}createUserDiagnosticsService(e,t,n){if(this.dbStoreName===i.DiagnosticsLogsWorker||this._userID&&this._userID!==x.$J)this.pushDiagnosticsEvent(_.i.Error,"DiagnosticsService: createUserDiagnosticsService function should only be called from the coreDiagnosticsService in the main thread",!0);else if(e&&t&&n){this._userID||this.updateDiagnosticInfo(x.zB,x.m0,x.$J),this._firstUserID||(this._firstUserID=n);let i=this.userDiagnosticsMap.get(n);return i||(i=this.experienceName!==this.rwcExperienceName||this._forceUsingV1Service?new Z(this.sessionId||"",this.experienceName,this.dbStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel):new X(this.sessionId||"",this.experienceName,this.dbStoreName,this.defaultPreECSConsoleLogLevel,this.userECSConsoleLogLevel),i.updateDiagnosticInfo(e,t,n),this.diagnosticsSettings&&(this._firstUserID===n?i.updatedSettingsForMainThread({...this.diagnosticsSettings,userPreviousSessionLogsLength:this.diagnosticsSettings.firstUserPreviousSessionLogsLength}):i.updatedSettingsForMainThread(this.diagnosticsSettings)),this.coreScenarioFactory&&i.setScenarioFactory(this.coreScenarioFactory),this._scheduler&&i.setScheduler(this._scheduler),this._logsCountReporter&&i.setLogsCountReporter(this._logsCountReporter),this._ALTCompleted&&i.setALTDone(),this.userDiagnosticsMap.set(n,i),i)}}pushDiagnosticsEvent(e,t,n,i,a=!1){const o=(0,x.hR)(this.diagnosticsEvents,e,t,n,i,a);e===_.i.Error&&this.errorDiagnosticsEvents.addEvent(o,a),this.diagnosticsBackupEnabled&&this.diagnosticsBackupService&&this.diagnosticsBackupService.pushDiagnosticsEvent(o)}async getDiagnosticsEvents(e){let t=[];const n=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetLogs);try{t=await this.diagnosticsEvents.getAllEvents(e)||[]}catch(e){const t=`DiagnosticsService: Failed to fetch diagnostic logs: ${e}`;this.pushDiagnosticsEvent(_.i.Error,t,!0),n?.fail({reason:t})}try{t=t.reverse(),n?.stop()}catch(e){n?.fail({reason:"Logs events array failed on reverting and sorting"})}return t}persistDiagnostics(){this.experienceName!==this.rwcExperienceName&&this.allowPersistUncaughtErrorLogs&&(this.diagnosticsEvents.persistLogs(),this.errorDiagnosticsEvents.persistLogs(),this.diagnosticsBackupEnabled&&this.diagnosticsBackupService&&this.diagnosticsBackupService.flush(),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnostics()})))}async getLogsFiles(e,t=0){t>0&&t<this._minLogsInLogFile&&(t=this._minLogsInLogFile);const n="No logs found",i="Logging of this type is not enabled";let a="",o="",r=await this.errorDiagnosticsEvents.getAllEvents()||[];r=(e?(0,x.Ij)(r):r).reverse();let s=(0,x.Mf)(r.slice(0,this._defaultLatestErrorCount));s&&(s=`Latest errors for ${this._userID}\r\n${s}`),this.isErrorDiagnosticsEnabled?(o=this.getPreviousSessionDiagnosticsLogsString(!0,e),a=(0,x.Mf)(r)):(o=i,a=i);const l=this.getPreviousSessionDiagnosticsLogsString(!1,e),c=await this.getDiagnosticsLogs(!!e,t),d=x.$J===this._userID?void 0:this._userID;return Promise.resolve([{isPiiFree:!1,fileName:"diagnostics-error-logs-previous-session.txt",content:o||n,...d?{userId:d}:{}},{isPiiFree:!1,fileName:"diagnostics-logs-previous-session.txt",content:l||n,...d?{userId:d}:{}},{isPiiFree:!1,fileName:"diagnostics-error-logs.txt",content:a||n,...d?{userId:d}:{}},{isPiiFree:!1,fileName:"diagnostics-logs.txt",content:c||n,...d?{userId:d}:{}},{isPiiFree:!1,fileName:"latestErrors",content:s,...d?{userId:d}:{}}])}getSystemInfo(){return Promise.resolve(new Map)}get loggerSettings(){return this._loggerSettings}get logScheduler(){if(this._enableScheduler&&(this._enableSchedulerBeforeALT||this._ALTCompleted))return this._scheduler}get userId(){return this._userID!==x.$J?this._userID:""}get logCountReporter(){return this._logsCountReporter}setWorkerLogsDataManager(e){"setWorkerLogsDataManager"in this.diagnosticsEvents&&this.diagnosticsEvents.setWorkerLogsDataManager(e)}persistDiagnosticsAsPreviousSessionLogs(){if(!this.logsStoredAsPreviousSession&&(this.logsStoredAsPreviousSession=!0,this.host?.localStorage)){const e=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,t=this.experienceName===this.rwcExperienceName?this.sessionId:void 0,n=e===x.$J?this._maxCorePreviousSessionLogsLength:this._maxUserPreviousSessionLogsLength;if(n<0)return;const i=this.diagnosticsEvents.getBufferedEvents(n);i.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,i,(0,x.IB)(e),t);const a=this.errorDiagnosticsEvents.getBufferedEvents(n);a.length>0&&this.persistLogsWithErrorHandle(this.host.localStorage,a,(0,x.IB)(e,!0),t),this.userDiagnosticsMap.size>0&&Array.from(this.userDiagnosticsMap.values()).forEach((e=>{e.persistDiagnosticsAsPreviousSessionLogs()}))}}persistLogsWithErrorHandle(e,t,n,i){try{(0,x.NF)(e,t,n,i,!this._disableGzipPreviousSessionLogs)}catch(e){this.pushDiagnosticsEvent(_.i.Error,`DiagnosticsService: window_localstorage save logs failure, ${e?.name}`,!0)}}setDiagnosticsBackupEnabled(e,t){this.diagnosticsBackupEnabled=e,e?!this.diagnosticsBackupService&&this.host?.opener&&this.host?.setTimeout&&this.host?.clearTimeout&&(this.diagnosticsBackupService=new U(this.host.opener,this.host.setTimeout,this.host.clearTimeout,t)):this.diagnosticsBackupService&&(this.diagnosticsBackupService.dispose(),this.diagnosticsBackupService=void 0)}async getDiagnosticsLogs(e,t=0){const n=await this.getDiagnosticsEvents(t),i=(0,x.Mf)(e?(0,x.Ij)(n):n),a=`Note: only ${this.memoryBufferArraySize||2e3} most recent logs are guaranteed to be shown due to the way logs are stored. Previous logs may have been removed\n`;return i?a+i:i}attemptToSetHost(){try{this.host=(0,L.J)()}catch{}}loadDiagnosticsFromLocalStorage(e=!0){if(this.host?.localStorage&&this.experienceName!==this.rwcExperienceName){const t=this.scenarioFactory.newScenario(H.RG.DiagnosticsGetLogsFromLocalStorage);try{(0,x.UL)(this.diagnosticsEvents,this.host.localStorage,(0,x.yN)(),e),(0,x.UL)(this.errorDiagnosticsEvents,this.host.localStorage,(0,x.yN)(void 0,!0),e),t?.stop()}catch(e){const n=`DiagnosticsService: Failed to load persisted logs from store with error: ${e}`;this.pushDiagnosticsEvent(_.i.Error,n,!0),t?.fail({reason:n})}}}cleanLogsStorage(){return this.host?.localStorage&&((0,x.uD)(this.host?.localStorage,this.userId),this.userId===x.$J&&(0,x.uD)(this.host?.localStorage,"")),Promise.all([this.diagnosticsEvents.handleUserLogout(),this.errorDiagnosticsEvents.handleUserLogout()]).then()}updateSettingsForLogger(e){this._loggerSettings.durationForCountingLogLines=this.validateSettingNumberValue(e.durationForCountingLogLines,this._minDurationForCountingLogLines,this._loggerSettings.durationForCountingLogLines),this._loggerSettings.throttleCapacity=this.validateSettingNumberValue(e.throttleCapacity,this._minThrottleWindowCapacity,this._loggerSettings.throttleCapacity),this._loggerSettings.throttleWindowSize=this.validateSettingNumberValue(e.throttleWindowSize,this._minThrottleWindowSize,this._loggerSettings.throttleWindowSize),this._loggerSettings.isUserEnableIDBLogs=e.isUserEnableIDBLogs,this._loggerSettings.diagnosticsLogsThrottling=e.diagnosticsLogsThrottling,void 0===this.userECSConsoleLogLevel&&void 0!==e.consoleLogLevel&&null!==e.consoleLogLevel&&(this._loggerSettings.consoleLogLevel=e.consoleLogLevel),this._loggerSettings.loggerReportTimeInterval=this.validateSettingNumberValue(e.loggerReportTimeInterval,this._minLoggerReportTimeInterval,this._loggerSettings.loggerReportTimeInterval),this._loggerSettings.loggerReportCountInterval=this.validateSettingNumberValue(e.loggerReportCountInterval,this._minLoggerReportCountInterval,this._loggerSettings.loggerReportCountInterval),this._loggerSettings.throttleLoggers=e.throttleLoggers}validateSettingNumberValue(e,t,n,i=!0){return(0,W.isNumber)(e)&&(i&&e===t||e>t)?e:n}validateConsoleLogLevel(e){if(Object.keys(_.i).includes(e))return _.i[e]}getPreviousSessionDiagnosticsLogsString(e,t){let n="";if(this.host?.localStorage){const i=this.experienceName===this.rwcExperienceName?this._userID||x.$J:void 0,a=(0,x.IB)(i,e);n=(0,x.gE)(this.host.localStorage,a,!!t)}return n||"No logs found"}cleanAllPreviousSessionLogsWithDelay(e){this._clearPreviousSessionLogsTimer=e.setTimeout((()=>{(0,x.yQ)(e)}),this._cleanPreviousSessionLogsDelay)}}var ee=n(131476);class te{constructor(e){this.globalContext=e,this.reportIntervalHandler=0,this.minReportTimeInterval=6e4,this.minReportCountInterval=200,this.minReportErrorCountInterval=10,this.reportTimeInterval=0,this.reportCountInterval=0,this.reportErrorCountInterval=0,this.lastReportTime=Date.now(),this.totalLogsCountFromLastReport=0,this.errorLogsCountFromLastReport=0,this.logsCountMap=new Map}updateLogsCounts(e){for(const[t,n]of e)this.updateLogsCountForOneLogger(t,n)}updateLogsCountForOneLogger(e,t){this.startTimer();const n=this.logsCountMap.get(e);n?(n.total+=t.total,n.error+=t.error,n.diagnostics+=t.diagnostics,n.throttled+=t.throttled):this.logsCountMap.set(e,{...t}),this.totalLogsCountFromLastReport+=t.total,this.errorLogsCountFromLastReport+=t.error}subscribeToCoreSettings(e){if(this.coreSettingsSubscription)return;const t=e.getObservable(b.J.Diagnostics,["logReporterSendCountInterval","logReporterSendTimeInterval","logReporterSendErrorCountInterval"]);this.coreSettingsSubscription=t.subscribe((e=>{if((0===e.logReporterSendCountInterval||(e.logReporterSendCountInterval||0)>=this.minReportCountInterval)&&(this.reportCountInterval=e.logReporterSendCountInterval||0),(0===e.logReporterSendErrorCountInterval||(e.logReporterSendErrorCountInterval||0)>=this.minReportErrorCountInterval)&&(this.reportErrorCountInterval=e.logReporterSendErrorCountInterval||0),0===e.logReporterSendTimeInterval||(e.logReporterSendTimeInterval||0)>=this.minReportTimeInterval){const t=e.logReporterSendTimeInterval||0;this.reportTimeInterval!==t&&(this.reportTimeInterval=t,this.reportIntervalHandler&&(this.globalContext.clearTimeout(this.reportIntervalHandler),this.reportIntervalHandler=0,this.startTimer()))}}))}reportLogsCount(){if(this.reportIntervalHandler=0,this.shouldReport()){const e=Date.now(),t=e-this.lastReportTime;this.lastReportTime=e,this.totalLogsCountFromLastReport=0,this.errorLogsCountFromLastReport=0;const n=this.logsCountMap;this.logsCountMap=new Map;const i=this.packLogsCountInfo(n);n.clear(),i&&(0,ee.MI)("logsCountInfo",{logsCountInfo:i,delta:t},"webclient_framework_logs_count_event")}}packLogsCountInfo(e){if(e.size>0){const t=[];for(const[n,i]of e)t.push({loggerName:n,total:i.total,error:i.error,diagnostics:i.diagnostics,throttled:i.throttled});return JSON.stringify(t)}return""}shouldReport(){return this.reportCountInterval>0&&this.reportTimeInterval>0&&this.reportErrorCountInterval>0&&(this.logsCountMap.size>0&&(this.totalLogsCountFromLastReport>=this.reportCountInterval||this.errorLogsCountFromLastReport>=this.reportErrorCountInterval))}startTimer(){0===this.reportIntervalHandler&&this.reportTimeInterval>0&&(this.reportIntervalHandler=this.globalContext.setTimeout((()=>this.reportLogsCount()),this.reportTimeInterval))}}var ne=n(739023),ie=n(86802),ae=n(817330);class oe{constructor(){this.debugLogging=""}initialize(e){this.logger=e,this.logger.debug("Telemetry Utility-Service initialized")}static getInstance(){return this.instance}}function re(){return oe.getInstance()}oe.instance=new oe;class se{constructor(e,t,n,i="",a=""){this.diagnosticsService=e,this.label=t,this.loggerName=n,this.contextId=i,this.userContextId=a,this.enableDebugLogging=!1,this.cidLabel="",this.logsCount=0,this.lastReportTime=0,this.throttleAllowance=0,this.currentWindow=0,this.throttledCount=0,this.logsCountPerLoggerNameMap=new Map;try{const e=(0,L.J)();re().debugLogging||(re().debugLogging=e.localStorage.getItem("localDebug")??"default"),this.enableDebugLogging="true"===re().debugLogging}catch{}this.cidLabel=i?i.concat(" ",t):t}log(e,...t){return this.invoke(console.log,e,_.i.Info,!1,...t)}warn(e,...t){return this.invoke(console.warn,e,_.i.Warn,!1,...t)}error(e,...t){return this.invoke(console.error,e,_.i.Error,!1,...t)}debug(e,...t){return this.enableDebugLogging||this.consoleLogLevel>=_.i.Debug?this.invoke(console.debug,e,_.i.Debug,!1,...t):ne.V.None}logNoPii(e,...t){return this.invoke(console.log,e,_.i.Info,!0,...t)}warnNoPii(e,...t){return this.invoke(console.warn,e,_.i.Warn,!0,...t)}errorNoPii(e,...t){return this.invoke(console.error,e,_.i.Error,!0,...t)}debugNoPii(e,...t){return this.enableDebugLogging||this.consoleLogLevel>=_.i.Debug?this.invoke(console.debug,e,_.i.Debug,!0,...t):ne.V.None}errorToTelemetry(e,t,n,i){return this.toTelemetry(console.error,e,t,_.i.Error,n,i)}warnToTelemetry(e,t,n,i){return this.toTelemetry(console.warn,e,t,_.i.Warn,n,i)}debugToTelemetry(e,t,n,i){return this.toTelemetry(console.debug,e,t,_.i.Debug,n,i)}infoToTelemetry(e,t,n,i){return this.toTelemetry(console.log,e,t,_.i.Info,n,i)}sendToDiagnosticLogs(e,t,n,i,a,o,...r){if((0,ae.R3)(a,ne.V.AddedIntoDiagnostics)||(0,ae.R3)(a,ne.V.ThrottledForDiagnostics)){if(r?.length>0){e=`${e} ${r.map((e=>(0,$.XC)(e))).join(", ")}`}e=(0,$.LQ)(e),(0,ae.R3)(a,ne.V.AddedIntoDiagnostics)?this.diagnosticsService.pushDiagnosticsEvent(t,e,o,n,i):["Enabled","EnabledQuiet"].includes(this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling)||this.diagnosticsService.pushDiagnosticsEvent(t,e,o,n,i)}}toTelemetry(e,t,n,i,a,o=!1){t=(0,$.LQ)(`${t}`);let r=ne.V.SentToTelemetry;return o&&(r=(0,ae.Kx)(this.invoke(e,t,i,!0),ne.V.SentToTelemetry)),(a=a||{}).message=t,a.logLevel=_.i[i],a.contextId=this.contextId,(0,ee.MI)(this.label,a,n,void 0,void 0,this.userContextId),r}invoke(e,t,n,i,...a){const o=this.getLogResult(n);if(o!==ne.V.None){let r=this.loggerName;if(a?.length>0&&a[0]&&"object"==typeof a[0]&&"loggerName"in a[0])try{r=a[0].loggerName,1===Object.keys(a[0]).length?a.shift():delete a[0].loggerName}catch{}if(this.increaseLogCount(n,o,r),t=`${this.cidLabel}: ${t}`,(0,ae.R3)(o,ne.V.LoggedInConsole)){const n=this.diagnosticsService.userId;e.call(console,n?`[${n}] - ${t}`:t,...a)}if(n!==_.i.Error&&this.diagnosticsService.logScheduler)try{return this.diagnosticsService.logScheduler?.schedule((()=>this.sendToDiagnosticLogs(t,n,new Date,!0,o,i,...a)),{priority:ie.vW.Background,id:"send-log-to-console-and-diagnostics",scheduledById:"logger"},""),o}catch{this.diagnosticsService.pushDiagnosticsEvent(_.i.Error,"Schedule logs failed",!0,new Date,!1)}this.sendToDiagnosticLogs(t,n,new Date,!1,o,i,...a)}return o}getLogResult(e){let t=ne.V.None;return(e<=this.consoleLogLevel||this.enableDebugLogging)&&(t=(0,ae.Kx)(t,ne.V.LoggedInConsole)),(e<_.i.Debug||e<=this.consoleLogLevel)&&!this.isLoggerThrottledForDiagnostics()&&(e===_.i.Error||this.diagnosticsService.loggerSettings.isUserEnableIDBLogs||!this.shouldThrottle()?t=(0,ae.Kx)(t,ne.V.AddedIntoDiagnostics):(this.throttledCount++,t=(0,ae.Kx)(t,ne.V.ThrottledForDiagnostics))),t}increaseLogCount(e,t,n){if(-1===this.diagnosticsService.loggerSettings.loggerReportCountInterval)this.updateCountToReporterForOneEvent(n,t,e);else{0===this.lastReportTime&&(this.lastReportTime=Date.now());let i=this.logsCountPerLoggerNameMap.get(n);void 0===i&&(i={total:0,error:0,diagnostics:0,throttled:0},this.logsCountPerLoggerNameMap.set(n,i)),this.logsCount++,i.total++,e===_.i.Error&&i.error++;((0,ae.R3)(t,ne.V.AddedIntoDiagnostics)||(0,ae.R3)(t,ne.V.ThrottledForDiagnostics))&&(i.diagnostics++,(0,ae.R3)(t,ne.V.ThrottledForDiagnostics)&&(this.throttledCount++,i.throttled++)),this.updateLogsCountToReporter(e===_.i.Error)}}updateLogsCountToReporter(e){if(this.logsCount>0&&this.diagnosticsService.loggerSettings.loggerReportCountInterval>0&&this.diagnosticsService.loggerSettings.loggerReportTimeInterval>0&&this.diagnosticsService.logCountReporter){const t=Date.now();(t-this.lastReportTime>this.diagnosticsService.loggerSettings.loggerReportTimeInterval||this.logsCount>=this.diagnosticsService.loggerSettings.loggerReportCountInterval||e)&&(this.diagnosticsService.logCountReporter.updateLogsCounts(this.logsCountPerLoggerNameMap),this.logsCount=0,this.throttledCount=0,this.lastReportTime=t,this.logsCountPerLoggerNameMap=new Map)}}updateCountToReporterForOneEvent(e,t,n){if(this.diagnosticsService.logCountReporter){const i={total:1,error:0,diagnostics:0,throttled:0};((0,ae.R3)(t,ne.V.AddedIntoDiagnostics)||(0,ae.R3)(t,ne.V.ThrottledForDiagnostics))&&(i.diagnostics=1,(0,ae.R3)(t,ne.V.ThrottledForDiagnostics)&&(i.throttled=1)),n===_.i.Error&&(i.error=1),this.diagnosticsService.logCountReporter.updateLogsCountForOneLogger(e,i)}}shouldThrottle(){const e=this.diagnosticsService.loggerSettings;if("Disabled"===e.diagnosticsLogsThrottling||0===e.throttleCapacity)return!1;const t=Date.now();return t-this.currentWindow>e.throttleWindowSize&&(this.sendThrottledCount(),this.currentWindow=t,this.throttleAllowance=e.throttleCapacity),this.throttleAllowance<1||(this.throttleAllowance-=1,!1)}sendThrottledCount(){if(!(this.throttledCount<1)&&["DryRun","Enabled"].includes(this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling)){const e="DryRun"===this.diagnosticsService.loggerSettings.diagnosticsLogsThrottling?"would have been throttled":"were throttled",t=`${this.cidLabel}: ${this.throttledCount} logs ${e} from ${new Date(this.currentWindow).toISOString()}`;this.diagnosticsService.pushDiagnosticsEvent(_.i.Info,t,!0,new Date,!1)}}get consoleLogLevel(){const e=this.diagnosticsService.loggerSettings.consoleLogLevel;return void 0===e?_.i.Warn:e}isLoggerThrottledForDiagnostics(){return!!this.loggerName&&this.diagnosticsService?.loggerSettings?.throttleLoggers?.has(this.loggerName)}}class le{constructor(e,t,n=""){this.diagnosticsService=e,this.contextId=t,this.userContextId=n,this.newLogger=(e,t)=>{e=(0,$.LQ)(`${e}`);return new se(this.diagnosticsService,e,t,this._contextId,this.userContextId)},this._contextId=t&&"00000000-0000-0000-0000-000000000000"!==t?(0,$.LQ)(`CID[${t}]`):""}get cID(){return this.contextId}notifyDiagnosticsALTDone(){this.diagnosticsService.setALTDone()}}var ce=n(771574),de=n(702135),ue=n(897826),me=n(899036),pe=n(447377);const ge=(e,t,n,i)=>(0,l.z)((0,me.fU)((async(n,a)=>async function(e,t,n,i){const a=e[Symbol.iterator](),o=t[Symbol.iterator]();let r=a.next(),s=o.next();const l=[];for(;!s.done||!r.done;)s.done||!r.done&&s.value.id>r.value[0].id?(await i(r.value[1]),r=a.next()):r.done||s.value.id<r.value[0].id?(l.push([s.value,n(s.value)]),s=o.next()):(l.push([s.value,r.value[1]]),r=a.next(),s=o.next());return l}(n,Array.from(a).sort(((e,t)=>e.id.localeCompare(t.id))),(t=>he(t,e,i)),(e=>ye(e,t)))),[]),(0,d.U)((e=>ve(e,n))),(0,pe.b)((async e=>{const t=await e;return Promise.all(t)}))),he=async(e,t,n)=>{try{return{type:"value",value:await t(e)}}catch(t){return n&&n(e,t),{type:"error",error:t}}},ye=async(e,t)=>{const n=await e;if("error"!==n.type)return t(Promise.resolve(n.value))},ve=async(e,t)=>{const n=[],i=await Promise.all(e);for(const e of i){const i=await e[1];"value"===i.type&&n.push(t(e[0],Promise.resolve(i.value)))}return n};var fe=n(332386),Se=n(12978),ke=n(686219);var Ce=n(347653);function be(e){const t=Object.keys(e).reduce(((t,n)=>(t[n]=function(e){const t=(0,Ce.QS)(e);return{update:e=>t(e),read:()=>t(),ref:t}}(e[n]),t)),{});return t}const we=new Set([ke.ab,ke.Xt]);class Te{constructor(e,t,n){this._logger=e.newLogger("ReactiveValuesService","core-services-activator"),this._appViewStateForWindowMap=new Map,this._servicesAppsRegistry=t,this._config=n}getAppViewStateForWindow(e,t){this._config.enableEmbedDataClient&&(e=h.ew);const n=this._appViewStateForWindowMap.get(e)?.get(t);if(!n){const n=this._servicesAppsRegistry.getAppByID(t);n&&"viewStateRegistration"in n&&n.viewStateRegistration&&this._logger.errorToTelemetry?.(`Unable to find appViewState for window ${e} app ${t}, registeredApps: ${this._appViewStateForWindowMap.get(e)}`,"webclient_framework_foundation_core_services_activator")}return n}resetAllViewState(e){const t=this._appViewStateForWindowMap.get(e);t&&t.forEach(((e,t)=>{we.has(t)||this.resetViewStateForApp(t,e)}))}setReactiveValuesForApp(e,t,n){const i=this._appViewStateForWindowMap.get(e)?.get(t);if(this._logger.log(`Setting view state to apollo cache value for windowId ${e}, app ${t}`),i){const{navigationalReactiveValues:e,nonNavigationalReactiveValues:t}=i;Object.keys(n).forEach((i=>{let a=e[i];a||(a=t[i]),a.update(n[i])}))}}getRegisteredAppsTypePolicies(e){const t={typePolicies:{},defaultTypeName:[]};return this._appViewStateForWindowMap.set(e,new Map),this._servicesAppsRegistry.registeredApps.forEach((n=>{const i=n.manifest.id,a=n;if(a.viewStateRegistration){const{computedValues:n,navigationalFieldDefaultValues:o,nonNavigationalFieldDefaultValues:r,gqlTypeName:s,queryFieldName:l}=a.viewStateRegistration,c=be(o),d=be(r),u=this._appViewStateForWindowMap.get(e);u?.set(i,{navigationalReactiveValues:c,nonNavigationalReactiveValues:d});const m=function(...e){const[t,n,i]=e,a={};for(const e of Object.keys(n)){const t=e,i=()=>n[t].read();a[t]={read:i}}if(i)for(const e of Object.keys(i)){const t=e,o=(e,a)=>{const{args:o}=a||{};return i[t](n,o)},r=o;a[t]={read:r}}return{[t]:{fields:a}}}(s,{...c,...d},n);t.typePolicies={...t.typePolicies,...m},t.defaultTypeName.push({gqlTypeName:s,queryFieldName:l})}})),t}removeWindowViewState(e){this._appViewStateForWindowMap.delete(e)}resetViewStateForApp(e,t,n){const i=this._servicesAppsRegistry.getAppByID(e);if(i&&t&&"viewStateRegistration"in i&&i.viewStateRegistration){this._logger.log(`Resetting view state for app ${e}`);const{navigationalFieldDefaultValues:a,nonNavigationalFieldDefaultValues:o}=i.viewStateRegistration;Object.keys(a||{}).forEach((e=>{n?.includes(e)||t.navigationalReactiveValues[e].update(a[e])})),Object.keys(o).forEach((e=>{n?.includes(e)||t.nonNavigationalReactiveValues[e].update(o[e])}))}}}const Ie={[Se.py.meetings]:["com.microsoft.teams.calling","com.microsoft.teams.meeting-options"]};class Ne{constructor(e,t,n,i){this._loadedTasksMap=new Map,this._appIdToAppMap=void 0,this._logger=e.newLogger("AppsRegistryService","core-services-activator"),this._loadedApps=[],this._entityTypeToAppMap=new Map,this._appsWithAppHistoryStored=[],this.initialize(n,i),this._reactiveValuesService=new Te(e,this,t)}get registeredApps(){return this._loadedApps}get registeredAppManifests(){return this._loadedApps.map((e=>e.manifest))}get registeredTasks(){return Array.from(this._loadedTasksMap.values())}get appsWithAppHistoryStored(){return this._appsWithAppHistoryStored}getApp({entityType:e,renderMode:t}){if(e||t)return this.registeredApps.find((n=>(!e||function({supportedEntities:e},t){return!(!e||-1===e.indexOf(t))}(n.manifest,e))&&(!t||function({supportedRenderModes:e},t){return!(!e||-1===e.indexOf(t))}(n.manifest,t))))}getAppViewStateForWindow(e,t){return this._reactiveValuesService.getAppViewStateForWindow(e,t)}getAppByID(e){return this._appIdToAppMap?.get(e)}getPlatformAppIdForEntity(e){const t=this._entityTypeToAppMap.get(e.type);if(void 0===t)return void this._logger.error("getPlatformAppIdForEntity: Platform id requested for entity which has no registered app in this experience.",{entityType:e.type});if(void 0===t.getPlatformAppIdForEntity)return void this._logger.debug("getPlatformAppIdForEntity: An app is registered for this entity but has no function for getPlatformAppIdForEntity.",{appName:t.manifest.name,entityType:e.type});let n;try{n=t.getPlatformAppIdForEntity(e)}catch(n){this._logger.error("getPlatformAppIdForEntity: Error caught from app handler while mapping the id for this entity.",{appName:t.manifest.name,entityType:e.type})}if(void 0!==n)return n;this._logger.debug("getPlatformAppIdForEntity: App mapped the id for this entity to undefined.",{appName:t.manifest.name,entityType:e.type})}getAppByActor(e){if(e)return this.registeredApps.find((t=>function({actors:e},t){return!(!e||-1===e.indexOf(t))}(t.manifest,e)))}getDefaultCommand(e,t){const{coldBootAppId:n}=e.get(b.J.Edu),{coreColdBootAppId:i,coreColdBootFlyoutWindowAppId:a,enableEDUColdBootApp:o}=e.get(b.J.Core),r=o?n:t===ke.lO.minimode||t===ke.lO.minimal?a:i;if(r){this._logger.debug(`Using cold boot appId of ${r} with enableEDUColdBootApp ${o}`);const t=this.getAppByID(r),n=t?.manifest.getDefaultCommand?.(e);if(n)return n;this._logger.debug(`No default command found ${r}`)}for(const t of this.registeredAppManifests)if(t.getDefaultCommand){const n=t.getDefaultCommand(e);if(n)return this._logger.debug(`Found a default command in ${t.name}`),n}}resetAllViewState(e){this._reactiveValuesService.resetAllViewState(e)}setReactiveValuesForApp(e,t,n){this._reactiveValuesService.setReactiveValuesForApp(e,t,n)}getRegisteredAppsTypePolicies(e){return this._reactiveValuesService.getRegisteredAppsTypePolicies(e)}removeWindowViewState(e){this._reactiveValuesService.removeWindowViewState(e)}registerTask(e){this._loadedTasksMap.set(e.id,e)}initialize(e,t){const n=new Map;if(!(t&&t.length>0))throw new Error(`initialize::${h.jK.Empty} - No apps registered`);-1===t.findIndex((t=>t.manifest.id===e.manifest.id))&&t.length>0&&t.push(e),t.forEach((e=>{if(n.has(e.manifest.id))throw new Error(`Multiple apps found for appId ${e.manifest.id}`);n.set(e.manifest.id,e),e.manifest.supportedEntities?.forEach((t=>{const n=Ie[t];if(!n||!n.includes(e.manifest.id)){if(this._entityTypeToAppMap.has(t))throw new Error(`Multiple apps found for entity ${t}`);this._entityTypeToAppMap.set(t,e)}})),e.onRegister&&e.onRegister({registerTask:this.registerTask.bind(this)}),e.onBeforeAddToNavigation?.shouldStoreLastVisitedInAppHistory&&this._appsWithAppHistoryStored.push(e.manifest.id)})),this._loadedApps=Array.from(n.values()),this._appIdToAppMap=n}}var Ee=n(968687);class Ae extends Ee.G{static fromExecutionError(e,t){return new Ae({code:"EXECUTION_FAILURE",taskName:e,prevError:t})}static fromMissingDependencies(e,t){return new Ae({code:"MISSING_DEPENDENCIES",taskName:e,dependencies:t,message:`${JSON.stringify(t)} are required, but not initialized.`})}constructor({code:e,taskName:t,prevError:n,dependencies:i,message:a}){super({type:"TaskError",code:e,prevError:n,message:a}),this.taskName=t,this.missingDependencies=i}getBoundaryProps(){return"EXECUTION_FAILURE"===this.code&&this.prevError instanceof Ee.G?this.prevError.getBoundaryProps():super.getBoundaryProps()}toJSON(){return{...super.toJSON(),taskName:this.taskName,prevError:this.prevError,missingDependencies:JSON.stringify(this.missingDependencies)}}toTelemetryCode(){return`[${this.type}::${this.taskName}::${this.code}::${this.missingDependencies?.join()}]`}static fromSerialized(e){if("TaskError"!==e?.type)return null;const t=new Ae({code:e.code,taskName:e.taskName,prevError:e.prevError,dependencies:e.dependencies});return t.deserialize(e),t}}class _e{constructor(e,t){this.id=e,this.name=h.Yg[e],this.dependencies=t}async executeSafe(e,t){const n=[];for(const t of this.dependencies)null==e[t]&&n.push(t);if(n.length>0)throw Ae.fromMissingDependencies(this.name,n);try{return await this.execute(e,t)}catch(e){throw Ae.fromExecutionError(this.name,e)}}}var Fe=n(726175);const De={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindowForEntity"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindowForEntity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindow"}}]}},{kind:"Field",name:{kind:"Name",value:"endEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindow"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"source"}}]}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"entityFieldsForActiveWindow"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"action"}},{kind:"Field",name:{kind:"Name",value:"options"}}]}}]}.definitions]};var Pe=n(308918),Me=n(692588),xe=n(94025),Re=n(316877);function je(e){return{...e,id:(t=e,t&&t.id||(0,Re.v4)()),startTimestamp:Le(e),source:e?.source||C.D.StandAlone};var t}function Le(e){return e&&e.startTimestamp||Date.now()}const Oe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesActivatorIsEntityInActiveWindowQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEntityInActiveWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};async function $e(e,t,n,i,a,o){const{enableIsEntityInViewByFocusedWindow:r}=o.get(b.J.Core);if(!r){return Be(await Ue(e,t,a),i,n,a)}{const o=function(e,t,n){const i=e.getValue().find((e=>{const n=!(!e||!e.window.document.hasFocus()),i=t.getState(),a=i===Fe.pk.LongInactive||i===Fe.pk.Inactive;return n&&!a}));return n.log(`Current window in focus is ${i?.id}`),i?.id}(i,n,a);if(a.log("Window in focus: ",o),!o)return a.log("There are no windows in focus"),!1;try{return(await t.query({query:Oe,variables:{entity:e,windowId:o},fetchPolicy:"no-cache"})).data.isEntityInActiveWindow}catch(e){return a.error("isEntityInActiveWindowQuery failed"),!1}}}async function Ue(e,t,n){try{const n=await t.query({query:De,variables:{entity:e},fetchPolicy:"no-cache"});return n.data.activeWindowForEntity?.id}catch(t){return void n.error(`query for entity failed. Entity: ${JSON.stringify(e)}, Error: ${t}`)}}function Be(e,t,n,i){const a=t.getValue().find((t=>t.id===e)),o=!(!a||!a.window.document.hasFocus()),r=n.getState(),s=r===Fe.pk.LongInactive||r===Fe.pk.Inactive,l=o&&!s;return l||i.log(`isWindowInView: Window considered to be not in view. Window is inactive ${s}, window has focus: ${o}`),l}function We(e){return function(e,t){return(0,Pe.sanitize)(e,t)}(e,function(e,t){return{ADD_ATTR:e,ADD_TAGS:t,RETURN_TRUSTED_TYPE:!0,WHOLE_DOCUMENT:!0}}(["content","focusable","nonce","onclick"],["link","meta","script","#comment","!doctype"]))}function He(e){return[e?.findScenario(H.RG.ClientStart)??null,e?.findScenario(H.RG.ExperienceReady)??null]}function Ve(e,t){return e instanceof Ee.G?e:new Me.G(Me.$.UNKNOWN,e,t)}function Ge(e,t,n,i){return qe.bind(void 0,e,t,n,i)}function ze(e,t){const n=t?.get(b.J.Core)?.enableStackTraceCollection;return{errorCode:e instanceof Ee.G&&Ee.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():void 0,stack:n&&e instanceof Ee.G?e.stack:void 0}}async function qe(e,t,n,i){let a="";const o=e?.host;o&&(a=`SessionId:\t${o.sessionId}\r\nDeviceId:\t${o.deviceId}\r\nHostVersion:\t${o.hostAppVersion}\r\n`);const r=e?.config;r&&(a=`${a}WebVersion:\t${r?.clientVersion}\r\n`);const s=t?.locale;s&&(a=`${a}Language:\t${s}\r\n`);const l=i?.get(b.J.Metadata);l?.ring?.id&&(a=`${a}Ring:\t${l.ring.id}\r\n`),r?.vdi&&(a=`${a}Virtualization:\t${r?.vdi?.configFilter}\r\n`,a=`${a}vdiMode:\t${r?.vdi?.mode}\r\n`);const c=await(n?.getCachedUsers?.({...je({source:C.D.Core}),scenarioName:H.RG.AuthWebCachedUser}));if(c?.length){a=`${a}Logged in users:\r\n`;for(const e of c)a=`${a}\t${e.userName}  ${e.profile.name}  TId:${e.profile.tid}  OId:${e.profile.oid}  UserId:${e.id}\r\n`}return a}class Je{constructor(e,t,n,i,a,o,r,s,l,c,d,u){this._loggerFactory=e,this._appsRegistryService=t,this._config=n,this._configLoader=i,this._coreTasks=o,this._diagnosticsService=r,this._logsCollectorService=s,this._waitForRenderingContextReady=l,this._isEntityInView=c,this._criticalDynamicImports=d,this._getPlatformConfigurationOverrides=u,this._maxPerfMarkNameLength=150,this._logger=e.newLogger("TaskManagerService","core-services-activator"),this._appsRegistryService=t,this._taskContext=this.createNewContext(a)}async notifyLifeCycleEvent(e,t={},n){const i=this.extractApplicableTasks(this._appsRegistryService.registeredTasks,e),a=`notify::starting - lifeCycleEvent=${e}, taskCount=${i.length}`;this._logger.log(a);const o={...this._taskContext,...t};this.markCoreLifeCycleEventStart(o,e);const r={},s=performance?.timing?.navigationStart,l=new Map,c=[];let d=0;for(const t of i){const i=performance?.now?.(),a=e=>{const n=`notify:: Task Execute Error - taskId ${h.Yg[t.id]}, code=${e.code} errorMsg=${(0,de.B9)(e?.prevError||e)}.`;this._logger.errorToTelemetry?.(n,"webclient_framework_foundation_core_init",void 0,!0),l.set(t.id,e)},u=()=>t instanceof _e?t.executeSafe(o,r):t.execute(o,r),m=e=>e?(0,V.E)(u(),e,`${h.Yg[t.id]} timed out.`):u(),p=await m(this._config.coreTasksTimeoutMs).catch(a);p&&c.push({taskId:t.id,cleanupFn:p}),this.markCoreLifeCycleTaskCompleted(o,e,t,l,i,s,++d,n)}return this.logErrorSummary(e,l),this._logger.log(`notify::tasks complete - lifeCycleEvent=${e}, taskCount=${i.length}`),{...r,...o,coreTaskErrors:Array.from(l.values()),cleanupFns:c}}async destroyContext(e,t){const n=e.cleanupFns.length;let i,a=0;for(;i=e.cleanupFns.pop();)try{await i.cleanupFn(t),a++}catch(e){this._logger.error(`Cleanup failed for task: ${h.Yg[i.taskId]}`)}this._logger.log(`destroyContext complete: ${a}/${n} tasks succeeded.`)}hasTasks(e){return this.extractApplicableTasks(this._appsRegistryService.registeredTasks,e).length>0}markCoreLifeCycleEventStart(e,t){const n=e.altScenarioService?.altScenario,i=e.altScenarioService?.clientStartScenario,a=`${T}${t}`;n||i?(n&&n.mark(a),i&&i.mark(a)):performance?.mark?.(a)}markCoreLifeCycleTaskCompleted(e,t,n,i,a,o,r,s){const l=e.altScenarioService?.altScenario,c=e.altScenarioService?.clientStartScenario,d=i.get(n.id),u=ze(d).errorCode,m=`${t}_${h.Yg[n.id]}`;l||c?(l&&l.mark(`core_task_${m}`,d?{errorCode:u}:void 0),c&&c.mark(`core_task_${m}`,d?{errorCode:u}:void 0)):(performance?.mark?.(`${I}${m}`),d&&performance?.mark?.(`pre_core_error_${m}:reason:${u}`.substring(0,this._maxPerfMarkNameLength))),this.addTaskDetailsToLocalStorage(d||{},a,o,m,r,e),s?.(n.id,d)}addTaskDetailsToLocalStorage(e,t,n,i,a,o){try{const{windowProvider:r,config:s}=o;s.shouldTrackCoreInitTasks&&r?.localStorage.setItem(i,(0,$.u4)({index:a,startTime:new Date(n+t).toISOString(),duration:performance?.now?.()-t,error:e}))}catch(e){e.code===DOMException.QUOTA_EXCEEDED_ERR?this._logger.error("Error: Quota exceeded while writing core task details to local storage."):this._logger.warn(`Couldn't write core init task details to local storage: ${(0,de.B9)(e)}`)}}createNewContext(e){return{correlation:e,diagnosticsService:this._diagnosticsService,logsCollectorService:this._logsCollectorService,loggerFactory:this._loggerFactory,appsRegistryService:this._appsRegistryService,config:this._config,configLoader:this._configLoader,waitForRenderingContextReady:this._waitForRenderingContextReady,isEntityInView:this._isEntityInView,criticalDynamicImports:this._criticalDynamicImports,getPlatformConfigurationOverrides:this._getPlatformConfigurationOverrides}}extractApplicableTasks(e,t){const n=[];if(e){const i=e.filter((e=>!e.lifeCycleSubscriptions&&t===h.sM.Initialization||e.lifeCycleSubscriptions&&-1!==e.lifeCycleSubscriptions.indexOf(t)));n.push(...i)}return(this._coreTasks[t]?.()||[]).concat(n)}logErrorSummary(e,t){if(t.size>0){const n=(0,de.Tr)("TaskManagerService",h.jK.NotInitialized,`lifeCycleEvent=${e}`,{failedTaskErrors:t});this._logger.error(`Failed ${t.size} core tasks: ${Array.from(t.keys()).map((e=>h.Yg[e])).join()}, lifeCycleEvent=${e}: `,n)}}}const Qe={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"windowOptionsFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"left"}},{kind:"Field",name:{kind:"Name",value:"top"}},{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]},Ke={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subNavEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"headerEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"startEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"midNavEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"endEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"monitorEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"inAppNotificationsEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}},{kind:"Field",name:{kind:"Name",value:"entityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"entityFieldsForActiveWindows"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"clientLaunchId"}}]}},{kind:"Field",name:{kind:"Name",value:"extendedEntityContainerState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"containerState"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}}]}},{kind:"Field",name:{kind:"Name",value:"isMainWindow"}},{kind:"Field",name:{kind:"Name",value:"isNotificationsWindow"}},{kind:"Field",name:{kind:"Name",value:"isInitialWindowStateHidden"}},{kind:"Field",name:{kind:"Name",value:"userContextId"}},{kind:"Field",name:{kind:"Name",value:"layoutConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layoutMode"}},{kind:"Field",name:{kind:"Name",value:"isFullscreen"}},{kind:"Field",name:{kind:"Name",value:"slots"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"header"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"midNav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"subNav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"notifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}}]}}]}},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"windowOptionsFields"}}]}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"entityFieldsForActiveWindows"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"action"}},{kind:"Field",name:{kind:"Name",value:"options"}},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"windowOptionsFields"}}]}},{kind:"Field",name:{kind:"Name",value:"linkedEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"action"}}]}},{kind:"Field",name:{kind:"Name",value:"entityState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"flushableByLinkedEntity"}}]}}]}},...Qe.definitions]}.definitions,...Qe.definitions]},Ye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"authenticationUsersEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsersEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"puid"}}]}},{kind:"Field",name:{kind:"Name",value:"subType"}},{kind:"Field",name:{kind:"Name",value:"role"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"loginUserName"}},{kind:"Field",name:{kind:"Name",value:"homeAccountId"}}]}}]}}]}}]},Xe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"authenticationUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"puid"}}]}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"subType"}},{kind:"Field",name:{kind:"Name",value:"role"}},{kind:"Field",name:{kind:"Name",value:"loginUserName"}},{kind:"Field",name:{kind:"Name",value:"homeAccountId"}}]}}]}}]};var Ze=n(40493);const et=new Set([y.G5.quit,y.G5.restart]);async function tt({hostCommunicationService:e,logger:t,reason:n,renderingContextManager:i}){let a;const o=i.getDefaultRenderingContext();switch(o?.scenarioFactory&&(a=it(n,o.scenarioFactory)),n){case"quit":try{await i.removeAllRenderingContexts(n),a?.mark(H.ck.RemoveAllRenderingContexts),await async function(e,t,n){let i,a;try{i=await t.loadModule("core")}catch(e){a="LoadModuleCoreFailed"}try{await(i?.reportReadyToQuit?.())}catch(e){a="ReportReadyToQuitFailed"}if(!a)return;rt(a,e,n)}(t,e,a),a?.stop()}catch(e){ot(e,t,a)}break;case"restart":try{await i.cleanupWithPriority(n),a?.stop()}catch(e){ot(e,t,a)}break;default:return}}async function nt({coreSettings:e,logger:t,reason:n,renderingContextManager:i,user:a}){let o;try{const t=a&&(0,xe.b4)(a);if(!t)throw new Me.G(Me.$.CLEANUP,new Error("signout::UserContextIdNotFound"));const r=await i.getUserRenderingContext(t);if(!r)return;r.scenarioFactory&&(o=it(n,r.scenarioFactory)),await i.removeUserRenderingContext(n,t),o?.mark(H.ck.RemoveUserRenderingContext);if(!e.get(b.J.Auth).isLegacyCleanupCodeFlag){const e=["TestCookie","ringFinder"];!function(e){try{(0,L.J)().sessionStorage.clear()}catch(t){at(e,"ClearSessionStorageFailed")}}(o),function(e,t){try{Object.keys(Ze.getJSON()).forEach((t=>{e.includes(t)||Ze.remove(t)}))}catch(e){at(t,"DeleteCookiesFailed")}}(e,o)}o?.stop()}catch(e){ot(e,t,o)}}function it(e,t){const n=t.newScenario(H.RG.CoreCleanup),i={reason:e};return n.appendEventData(i),n}function at(e,t){const n={errorCode:t};e&&e.fail(n)}function ot(e,t,n){const i="UnknownCleanupFailure";let a;a=e instanceof Me.G&&Ee.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():e instanceof Error?`${Me.$.CLEANUP}::${i}::${e?.name}::${e?.message}`:`${Me.$.CLEANUP}::${i}::${(0,$.u4)(e)}`,rt(a,t,n)}function rt(e,t,n){n&&at(n,e),t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services",void 0,!0)}var st=n(742286),lt=n(207689),ct=n(990266),dt=n(84562),ut=n(528004),mt=n(917018),pt=n(379658),gt=n(353014);class ht{constructor(e,t,n){this.eventHandler=e,this.commandHandler=t,this.commandDelegator=n}bubble(e){return this.eventHandler(e,this.commandHandler,this.commandDelegator)}}var yt=n(588592);const vt=new Set([ke.ab,ke.Xt]),ft=e=>"viewStateRegistration"in e,St=e=>vt.has(e.manifest.id),kt=e=>e.current?.midNavEntity??e.current?.subNavEntity??e.current?.headerEntity??e.current?.startEntity??e.current?.mainEntity,Ct=e=>e.manifest.id===ke.vC;const bt="internal-event-handler",wt=({commandChangeReportingService:e,correlation:t,type:n})=>{if(n===dt.B.DelegatedCommandReceived)e.report({type:n,correlationId:t.id,context:{target:bt,correlation:t}});else e.report({type:n,correlationId:t.id,context:{target:bt}})},Tt=({commandChangeReportingService:e,correlation:t,errorInfo:n=ct.y.DelegatedCommandError,errorMessage:i,logger:a})=>{a.errorToTelemetry?.(i,"webclient_framework_foundation_core_services_internal_command_delegator",void 0,!0),e.report({correlationId:t.id,type:dt.B.Failure,context:{target:bt,errorMessage:i,errorInfo:n}})};var It=n(956898),Nt=n(555128);const Et=async({activeWindowsService:e,appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,commandHandler:o,commandInput:r,coreSettings:s,executionContext:l,loggerFactory:c,scenarioFactory:d,shortcutExecutionService:u,windowId:m,host:p,userBiService:g,isInSecondHop:y=!1,correlation:v})=>{const f=c.newLogger("internalCommandDelegator","core-services-entity-commanding"),S=At(v,r);wt({commandChangeReportingService:a,correlation:S,type:dt.B.DelegatedCommandReceived});const k=function(e,t){return e.getAppByActor(t.command.actor)}(t,r);if(!k){const e=`Command for actor ${r.command.actor} does not map to any registered app.`;return Tt({commandChangeReportingService:a,correlation:S,errorMessage:e,logger:f}),Promise.resolve(void 0)}const C=Ft(m,k,r);if(!k.onCommandReceived){const e=`Command for actor ${r.command.actor} maps to app ${k.manifest.name}, but the app hasn't registered onCommandReceived handler.`;return Tt({commandChangeReportingService:a,correlation:S,errorMessage:e,logger:f}),Promise.resolve(void 0)}const{navigationalReactiveValues:b,nonNavigationalReactiveValues:w}=t.getAppViewStateForWindow(C||h.ew,k.manifest.id)||{};let T=!1,I={};b&&(I=Object.keys(b).reduce(((e,t)=>{const n=b[t];return{...e,[t]:{read:n.read,update:e=>{e!==n.read()&&(n.update(e),T=!0)}}}}),{}));const N=function(e,t,n,i,a,o,{viewEntitiesRef:r,viewEntity:s}={},l,c){const d=r&&kt(r);return{client:e,clientPreferences:t.getAllPreferences(),coreSettings:n,loggerFactory:i,scenarioFactory:a,shortcutExecutionService:c,executionContext:{viewEntities:{endEntity:r?.current?.endEntity,mainEntity:r?.current?.mainEntity},viewEntity:s,isHandlingAppActiveApp:!!d&&o.getApp({entityType:d.type})?.manifest.id===l}}}(n,i,s,c,d,t,l,k.manifest.id,u);let E;try{const i={commandInput:r,requestContext:N};wt({commandChangeReportingService:a,correlation:S,type:dt.B.BeforeOnCommandReceived});const o={...I,...w};E=await(async({activeWindowsService:e,delegatedApp:t,reactiveValues:n,hookOptions:i,host:a,windowId:o,userBiService:r,appsRegistryService:s})=>{if(!t.onCommandReceived)return Promise.resolve(void 0);if(ft(t)&&St(t)){if(n){const l={...i,activeWindowsService:e,appsRegistryService:s,appViewState:n,host:a,slotDimensionsOptions:yt.Vi,userBiService:r,windowId:o};return t.onCommandReceived(l)}}else{if(!ft(t)){if(St(t)){const n={...i,activeWindowsService:e,appsRegistryService:s,slotDimensionsOptions:yt.Vi,windowId:o};return t.onCommandReceived(n)}return t.onCommandReceived(i)}if(n){const e={...i,appViewState:n};return t.onCommandReceived(e)}}return Promise.resolve(void 0)})({activeWindowsService:e,delegatedApp:k,reactiveValues:o,hookOptions:i,host:p,windowId:C,userBiService:g,appsRegistryService:t}),T&&(n.mutate({mutation:It.E,variables:{windowId:C,appIds:[k.manifest.id]}}).catch((e=>{f.warn(`saveReactiveVarToHistory failed ${e.message}`)})),T=!1),wt({commandChangeReportingService:a,correlation:S,type:dt.B.AfterOnCommandReceived})}catch(e){const t=`Command for actor ${r.command.actor} encountered an error inside onCommandReceived of ${k.manifest.name}.`;return Tt({commandChangeReportingService:a,correlation:S,errorMessage:t,logger:f}),Promise.reject(e)}if(!E)return wt({correlation:S,commandChangeReportingService:a,type:dt.B.CommandHandledByOnCommandReceived}),Promise.resolve(void 0);const A=e=>"entity"in e;if(!y&&!A(E)&&Dt(E,k))return f.log(`onCommandReceived for ${k.manifest.name} is requesting a second hop to CoreLayoutApp`),Et({activeWindowsService:e,appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,commandHandler:o,commandInput:E,coreSettings:s,executionContext:l,host:p,isInSecondHop:!0,loggerFactory:c,scenarioFactory:d,shortcutExecutionService:u,userBiService:g,windowId:C,correlation:S});if(!A(E)){const e=`Command for actor ${r.command.actor} inside onCommandReceived of ${k.manifest.name}, should return an IEntityCommand or undefined.`;return Tt({commandChangeReportingService:a,correlation:S,errorMessage:e,logger:f}),Promise.reject(e)}const{layoutMode:_,clientLaunchId:F}=r.command?.data||{};o(_t(E,S,C,_),F)},At=(e,t)=>e||t.correlation||je(),_t=(e,t,n,i)=>({...e,command:{...e.command,correlation:t,...n&&{__UNSAFE_windowId:n},...i&&{layoutMode:i}}}),Ft=(e,t,n)=>St(t)&&n.command.data?.windowId||e,Dt=(e,t)=>e.command.actor===Nt.$K||"com.microsoft.teams.corelayout"===t.manifest.id;class Pt{constructor(e,t){this.commandHandler=e,this.commandDelegator=t}execute(e){return this.commandDelegator(e,this.commandHandler)}}var Mt=n(1872);const xt="internal-event-handler",Rt=({commandChangeReportingService:e,correlation:t,type:n,eventInput:i})=>{const a=i.event.type;if(n===dt.B.EventBubbled)e.report({type:n,correlationId:t.id,context:{target:xt,correlation:t,eventType:a}});else e.report({type:n,correlationId:t.id,context:{target:xt,eventType:a}})},jt=({commandChangeReportingService:e,correlation:t,errorMessage:n,logger:i})=>{const a=ct.y.EventError;i.errorToTelemetry?.(n,"webclient_framework_foundation_core_services_internal_event_handler",void 0,!0),e.report({correlationId:t.id,type:dt.B.Failure,context:{target:xt,errorMessage:n,errorInfo:a}})},Lt=["MeControlCore","MeControlMeAccount","MeControlMTMA"],Ot=async({appsRegistryService:e,client:t,clientPreferences:n,commandChangeReportingService:i,commandDelegator:a,commandHandler:o,coreSettings:r,eventInput:s,executionContext:l,hostCommunicationService:c,i18n:d,loggerFactory:u,notificationsHandler:m,phaseStateMachine:p,scenarioFactory:g,shortcutExecutionService:y,userBiService:v,windowId:f})=>{const S=u.newLogger("internalEventHandler","core-services-entity-commanding");let k=function(e,t){return t?t&&e.getApp({entityType:t.viewEntity?.type}):e.getAppByID(ke.ab)}(e,l);const C=((e,t,n,i,a,o)=>{const{scenarioName:r,id:s,source:l}=t?.getEventScenarioData?.(e,i,a,o)||{};let c;c=a.get(b.J.Core).enableEventTimestamp?e.source.timeStamp:Date.now();const d=je({id:s,scenarioName:r,source:l,startTimestamp:c});return Rt({commandChangeReportingService:n,correlation:d,type:dt.B.EventBubbled,eventInput:e}),d})(s,k,i,S,r,n);if("com.microsoft.teams.search"===k?.manifest.id&&Lt.includes(s.event.originator)&&(k=e.getApp({renderMode:Mt.e.TitleBar})),"updateDialogState"===s.event.type&&(k=e.getAppByID(ke.ab)),!k){return jt({commandChangeReportingService:i,correlation:C,errorMessage:"Error mapping event to slot.",logger:S}),Promise.resolve(void 0)}if(!k.eventHandlers?.onEventReceived){const e=`Event '${s.event.type}' was received for app ${k.manifest.name}, but it hasn't registered an event handler.`;return jt({commandChangeReportingService:i,correlation:C,errorMessage:e,logger:S}),Promise.resolve(void 0)}const w=function(e,t,n,i,a,o,r,{viewEntitiesRef:s,viewEntity:l}={},c,d,u,m,p){const g=s&&kt(s);return{client:e,clientPreferences:t.getAllPreferences(),coreSettings:n,hostCommunicationService:u,i18n:m,loggerFactory:i,scenarioFactory:a,shortcutExecutionService:d,userBiService:o,executionContext:{viewEntities:{endEntity:s?.current?.endEntity,mainEntity:s?.current?.mainEntity},viewEntity:l,isHandlingAppActiveApp:!!g&&r.getApp({entityType:g.type})?.manifest.id===c},phaseStateMachine:p}}(t,n,r,u,g,v,e,l,k.manifest.id,y,c,d,p);let T;try{const n={eventInput:s,requestContext:w};Rt({commandChangeReportingService:i,correlation:C,eventInput:s,type:dt.B.BeforeOnEventReceived});const{navigationalReactiveValues:a,nonNavigationalReactiveValues:o}=e.getAppViewStateForWindow(f||h.ew,k.manifest.id)||{};let r=!1,l={};a&&(l=Object.keys(a).reduce(((e,t)=>{const n=a[t];return{...e,[t]:{read:n.read,update:e=>{e!==n.read()&&(n.update(e),r=!0)}}}}),{}));const c=(l||o)&&{...l,...o};T=await(async({sourceApp:e,reactiveValues:t,hookOptions:n,notificationsHandler:i,windowId:a})=>{let o;if(!e.eventHandlers?.onEventReceived)return Promise.resolve(void 0);if(ft(e)&&St(e)){if(t){const i={...n,appViewState:t,windowId:a};o=await e.eventHandlers.onEventReceived(i)}}else if(ft(e)){if(t){const i={...n,appViewState:t};o=await e.eventHandlers.onEventReceived(i)}}else if(St(e)){const t={...n,windowId:a};o=await e.eventHandlers.onEventReceived(t)}else if(Ct(e)&&i){const t={...n,notificationsHandler:i};o=await e.eventHandlers.onEventReceived(t)}else o=await e.eventHandlers.onEventReceived(n);return Promise.resolve(o)})({sourceApp:k,reactiveValues:c,hookOptions:n,notificationsHandler:m,windowId:f}),r&&(t.mutate({mutation:It.E,variables:{windowId:f,appIds:[k.manifest.id]}}).catch((e=>{S.warn(`saveReactiveVarToHistory mutation failed ${e.message}`)})),r=!1),Rt({correlation:C,commandChangeReportingService:i,type:dt.B.AfterOnEventReceived,eventInput:s})}catch(e){const t=`Event '${s.event.type}' encountered an error inside onEventReceived of ${k.manifest.name}.`;return jt({commandChangeReportingService:i,correlation:C,errorMessage:t,logger:S}),Promise.reject(e)}if(!T)return Rt({correlation:C,commandChangeReportingService:i,type:dt.B.EventHandled,eventInput:s}),Promise.resolve(void 0);return a({...T,correlation:C},o)};var $t=n(906813),Ut=n(64284);const Bt="DeepLink:: ";var Wt,Ht;!function(e){e.DecodeURIComponentFailed="DecodeURIComponentFailed",e.DeeplinkNotHandledByRegisteredApps="DeeplinkNotHandledByRegisteredApps",e.DeeplinkTerminatedByApp="DeeplinkTerminatedByApp",e.ExecuteFromUrlFailed="ExecuteFromUrlFailed",e.IntentServiceExecutionFailed="IntentServiceExecutionFailed",e.InvalidDeepLinkUrl="InvalidDeepLinkUrl",e.OnBeforeDeeplinkParsedFailed="OnBeforeDeeplinkParsedFailed",e.ToNavigationIntentFailed="ToNavigationIntentFailed",e.InvalidOrigin="InvalidOrigin"}(Wt||(Wt={})),function(e){e.NavigationIntentNotFound="NavigationIntentNotFound"}(Ht||(Ht={}));var Vt=n(469483),Gt=n(400966);const zt="https://teams.microsoft.com/l",qt="/task/",Jt="/stage/",Qt="/entity/",Kt="context",Yt="application/vnd.microsoft.card.adaptive",Xt=(e,t,n)=>{const i=e=>n?.(e);return e.executeCommand(t.entity,{entityCommand:t.command,entityOptions:t.entityOptions}).subscribe({complete:i,error:i}),Promise.resolve()},Zt=(e,t,n,i,a,o)=>{const r=e.executeCommand(t.entity,{entityCommand:t.command,entityOptions:t.entityOptions}),s=n.newScenario(H.RG.ExtTaskModuleLaunch),l=Vt.gV.DeepLink;return r.subscribe({complete:()=>{i.log(`task module complete for entrypoint ${l}`),s.stop(nn(a,l)),o&&o()},error:e=>{i.error(`error launching task module for entry point ${l}.  Error:`,e),s.fail(nn(a,l,e)),o&&o(e)},next:e=>{e.containerState===ke.oq.Open&&s.stop(nn(a,l))}}),Promise.resolve()},en=(e,t)=>{const n=new URL(e).pathname.split("/");if(n.length===t){const[,,e,t,i]=n;return!(!e||!t)}return!1},tn=e=>!(!e||!e.startsWith(zt)),nn=(e,t,n)=>{const i={};return e&&(i["App.Id"]=e),t&&(i["App.EntryPoint"]=Vt.gV[t]),n&&(i.errors=n),i},an=(e,t)=>{if(!t)throw new Error("Could not find app context");switch(e.type){case Se.py.extensions:return{...t,type:Gt.p.tab};case Se.py.channels:return{...t,type:Gt.p.channel};case Se.py.chats:return{...t,type:Gt.p.chat};default:throw new Error("unsupported launch context")}},on=e=>!!e&&"0"!==e,rn=e=>e?JSON.parse(e):{},sn=(e,t)=>{switch(e&&e.type){case Se.py.extensions:return dn(e);case Se.py.chats:return{chatId:e.id||""};case Se.py.channels:{const{channelId:n,replyChainId:i}=rn(e.id);return{channelId:n,parentMessageId:i,chatId:cn(i,n,t),meetingId:ln(n,i),channelMeetingMessageId:i}}default:return}},ln=(e,t)=>{if(e){const n=e.split(";")[0];return on(t)?btoa(`0#${n}#${t}`):btoa(`0#${n}#0`)}return""},cn=(e,t,n)=>on(e)&&n?t.includes("messageid")?t:`${t};messageid=${e}`:t,dn=e=>{if(e.linkedEntity)switch(e.linkedEntity.type){case Se.py.chats:return{chatId:e.linkedEntity.id};case Se.py.channels:{const{channelId:t,replyChainId:n}=rn(e.linkedEntity.id);return{channelId:t,parentMessageId:n,channelMeetingMessageId:n}}case Se.py.extensions:return e.linkedEntity.id?JSON.parse(e.linkedEntity.id):void 0}},un=(e,t)=>{const n=e.search.indexOf("=")+1,i=e.search.substring(n)||"",a=decodeURIComponent(i),{contentUrl:o,websiteUrl:r,removeUrl:s,name:l}=JSON.parse(a);return{type:"tab/tabInfoAction",tabInfo:{contentUrl:o,websiteUrl:r,removeUrl:s,name:l,entityId:t}}},mn=e=>{const t=e.search.indexOf("?")+1;return(e.search.substring(t)||"").split("&").reduce(((e,t)=>{const[n,i]=t.split("="),a=decodeURIComponent(i);return{...e,[n]:(0,W.isString)(n)&&"card"===n.toLowerCase()?pn(a):a}}),{})},pn=e=>{try{const t=JSON.parse(e),n=(0,W.isString)(t.contentType)&&t.contentType.toLowerCase()===Yt.toLowerCase(),i=(0,W.isString)(t.type)&&"adaptivecard"===t.type.toLowerCase();return n?{content:JSON.stringify(t.content),contentType:t.contentType}:i?{content:e,contentType:Yt}:null}catch{return null}};var gn=n(354162);class hn{constructor(e,t,n,i,a,o,r,s,l,c){this.host=e,this.commandHandler=t,this.extensionCommandingService=n,this.scenarioFactory=i,this.deeplinkService=o,this.coreSettings=r,this.executionContext=s,this.sourceViewEntity=l,this.clientLaunchId=c,this.logger=a.newLogger("DeepLinkCommandingService","core-services-entity-commanding")}checkForPendingDeeplink(e,t){return this.deeplinkService.checkForPendingIntent(e,this.clientLaunchId,t??this.executionContext.userContextId)}launchMainApp(e,t,n){return this.deeplinkService.launchMainApp(e,this.clientLaunchId,t,n)}launchMinimode(e,t){return this.deeplinkService.launchMinimode(e,this.clientLaunchId,t)}switchAccount(e,t,n,i,a,o){return this.deeplinkService.switchAccount(e,t,this.clientLaunchId,n,i,a,o)}prewarmFlyout(e){return this.deeplinkService.prewarmFlyout(e)}prewarmMinimode(e){return this.deeplinkService.prewarmFlyout(e,!0)}async executeFromUrlV2(e,t,n,i){this.logger.log(`executeFromUrlV2::deepLink::'${e}'`);const a=this.allowV2Flow(e),o=i||(0,Ut.o6)(e,this.coreSettings);if(!a)return!1;try{return await this.deeplinkService.executeFromUrlAsync(e,t,n,this.clientLaunchId,{...this.executionContext,...this.isCrossCloudNonMeetingDeeplink(e)&&{userContextId:void 0}},this.sourceViewEntity,o)}catch(e){const t=`DeepLinkCommanding:: ${Wt.ExecuteFromUrlFailed} ${(0,$.u4)(e)}`;throw this.logger.errorToTelemetry?.(t,"webclient_framework_foundation_core_services_deeplink",void 0,!0),new Error(t)}}async executeDeepLinkFromUrl(e,t,n,i){this.coreSettings.get(b.J.Core).forceHostOpenForDeepLink&&this.host.open(e);const a=!!this.coreSettings.get(b.J.Core)?.handleInternalDeepLinks,o=!!this.coreSettings.get(b.J.Extensibility)?.enableChatIdChangeInGetContextCall;try{if(await this.executeFromUrlV2(e,n,void 0))return}catch(e){this.logger.errorToTelemetry?.(e?.message,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}const r=this.createEntityCommandFromDeepLink(e,t,o);return r?((e,t,n,i,a,o,r)=>{switch(e.entity.type){case Se.py.taskmodule:const s=new URL(t),[,,,l]=s.pathname.split("/");return Zt(i,e,o,a,l,r);case Se.py.platformStage:return Xt(i,e,r);default:return n(e)}})(r,e,this.commandHandler,this.extensionCommandingService,this.logger,this.scenarioFactory,i):a?void this.host.open(e):this.host.opener.open($t.B.OpenOnMainRenderer,$t._.DeepLink,{url:e})}executeIntent(e,t){return this.deeplinkService.executeIntent({...e,metadata:{userContextId:e.metadata.userContextId??this.executionContext.userContextId,...e.metadata}},t)}createEntityCommandFromDeepLink(e,t,n){return en(e,4)&&(e=>{if(tn(e))return e.substr(29).toLowerCase().substring(0,6)===qt;return!1})(e)?((e,t,n)=>{const i=(0,Re.v4)(),a=new URL(e),[,,,o]=a.pathname.split("/"),r={entryPoint:Vt.gV.DeepLink,appId:o,taskInfo:mn(new URL(e))};return{entity:{id:i,type:Se.py.taskmodule,action:Se.uk.create},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}},entityOptions:{input:r,launchContext:an(t,sn(t,n))}}})(e,t,n):(e=>en(e,5))(e)&&(e=>!!tn(e)&&e.substr(29).toLowerCase().substring(0,7)===Jt)(e)?(e=>{try{const t=new URL(e),[,,,n]=t.pathname.split("/"),i=(0,Re.v4)();return{entity:{id:i,type:Se.py.platformStage,action:Se.uk.view},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}},entityOptions:{appId:n,tabInfo:JSON.stringify(un(t,i))}}}catch{return null}})(e):null}allowV2Flow(e){return!!(this.coreSettings.get(b.J.Extensibility).handleDeepLinkToMeetingSidePanel&&(e=>{if(!en(e,5))return!1;const{searchParams:t}=new URL(e),n=t.has(Kt)&&t.get(Kt);if(!n)return!1;try{const e=JSON.parse(decodeURIComponent(n));return!(!e||!e.chatId||"chat"!==e.contextType&&"meeting"!==e.contextType||"false"===t.get("openInMeeting"))}catch(e){return!1}})(e)&&(t=e,tn(t)&&t.substring(29).toLowerCase().substring(0,8)===Qt))||!!this.coreSettings.get(b.J.Core)?.handleInternalDeepLinks;var t}isCrossCloudNonMeetingDeeplink(e){let t;try{t=new URL(e)}catch{return!1}const n=(0,gn.Ee)(t.host,this.coreSettings);return!!n&&n!==(0,gn.NH)(this.coreSettings)&&!(0,Ut.u7)(e)}}var yn=n(387383),vn=n(544349),fn=n(459605),Sn=n(705824),kn=n(89184),Cn=n(67081);const bn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesEntityCommandingActiveWindowContainerStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"extendedEntityContainerState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"containerState"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}}]}},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}}]}}]}}]},wn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindowBlockingExtension"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"blockingEntityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"action"}},{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]}}]},Tn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"addBlockingExtension"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"removeBlock"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addBlockingExtension"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}},{kind:"Argument",name:{kind:"Name",value:"removeBlock"},value:{kind:"Variable",name:{kind:"Name",value:"removeBlock"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};class In{constructor(e,t,n,i,a,o,r){this.commandHandler=e,this.client=t,this.windowId=n,this.scenarioFactory=i,this._coreSettings=o,this._windowLayoutService=r,this.subscribers=[],this.onDestroy=new kn.xQ,this.logger=a.newLogger("ExtensionCommandingService","core-services-entity-commanding")}async destroy(){try{this.onDestroy.next(),this.reset()}catch(e){this.logger.warn(`Unable to destroy, error ocurred in persisting delete of extension entity. e.name: ${e.name}, e.message: ${e.message}`)}}executeCommand(e,t){const n=t?.entityCommand||{stateTransition:ke.su.none,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}};n.stateTransition=ke.su.extend;const i={entity:e,command:n,entityOptions:t?.entityOptions};return this.processRequest(i)}async addBlockingExtension(e,t,n=!1){if(!n&&await this.isWindowBlocked())return void this.logger.log("Window is currently blocked, addBlockingExtension no-op");this.logger.log(`addBlockingExtension, requesting an extension of type ${e.type} to block the window`);const i={entity:e,entityOptions:JSON.stringify(t),windowId:this.windowId,removeBlock:n};await this.client.mutate({mutation:Tn,variables:i})}isBlockedByEntity(e){return this._windowLayoutService.modalManager.isBlockedByEntity(e)}async isWindowBlocked(){const{enableDecoupleCommandingFromApollo:e}=this._coreSettings.get(b.J.Core);if(e)return this._windowLayoutService.modalManager.isBlockingEntityExtension();const{data:t}=await this.client.query({query:wn,variables:{windowId:this.windowId}});return!!t.activeWindow.blockingEntityExtension}pipeWhileStateIsValid(e,t){return e.pipe((0,yn.R)(this.onDestroy),(0,vn.o)((e=>e.hasEntityExtension),!0),t,(0,fn.G)(),(0,vn.o)((([e,t])=>{const n=t.containerState,i=t.hasEntityExtension,a=e.containerState,o=n===ke.oq.Confirmed,r=n===ke.oq.Cancelled,s=n===ke.oq.Error,l=n===ke.oq.Closed,c=a===ke.oq.Open;return i&&!o&&!r&&!s&&!(c&&l)}),!0),(0,d.U)((([,e])=>({containerState:e.containerState}))))}processRequest(e){this.scenarioFactory.newScenario(H.RG.ExtensionOpen);const t=this._windowLayoutService.enableDecoupleCommandingFromApollo,n=t?this._windowLayoutService.modalManager.observeContainerState().pipe():this.observeContainerState(this.client,this.windowId),i=this.pipeWhileStateIsValid(n,t?(0,Sn.O)({hasEntityExtension:!1,containerState:ke.oq.Closed}):(0,g.b)());this.commandHandler(e).then((()=>{i.subscribe({next:e=>{this.stopActiveScenario(e.containerState),this.nextSubscriber(e),e.containerState===ke.oq.Error&&this.resetSubscriber((0,de.Tr)("ExtensionCommanding",h.jK.Unknown,`ExtendedContainerState ${e.containerState}`,void 0,"Error processing entity extension"))},complete:()=>{this.resetSubscriber()},error:e=>{this.resetSubscriber(e)}})})).catch((e=>{this.resetSubscriber(e)}));return new Cn.y((e=>{this.subscribers.push(e)}))}nextSubscriber(e){this.subscribers.forEach((t=>t.next(e)))}resetSubscriber(e){const t=this.subscribers;this.reset(),e?(this.failActiveScenarios(),t.length&&t.forEach((t=>t.error(e)))):(this.stopActiveScenarios(),t.length&&t.forEach((e=>e.complete())))}reset(){this.subscribers=[]}stopActiveScenarios(){this.scenarioFactory.findScenario(H.RG.ExtensionClose)?.stop(),this.scenarioFactory.findScenario(H.RG.ExtensionOpen)?.stop()}failActiveScenarios(){this.scenarioFactory.findScenario(H.RG.ExtensionClose)?.fail(),this.scenarioFactory.findScenario(H.RG.ExtensionOpen)?.fail()}stopActiveScenario(e){switch(e){case ke.oq.Error:this.failActiveScenarios();break;case ke.oq.Open:case ke.oq.Closed:case ke.oq.Cancelled:case ke.oq.Confirmed:this.stopActiveScenarios();break;default:this.logger.errorToTelemetry&&this.logger.errorToTelemetry(`Unable to stop active scenario, no case mapped to container state provided: ${e}`,"webclient_framework_foundation_core_services_extension_commanding",void 0,!0)}}observeContainerState(e,t){return(0,fe.G)(this.watchActiveWindow(e,t)).pipe((0,d.U)((({data:e})=>({containerState:e.activeWindow.extendedEntityContainerState.containerState,hasEntityExtension:!!e.activeWindow.activeEntities.entityExtension?.type}))))}watchActiveWindow(e,t){return e.watchQuery({query:bn,variables:{windowId:t}})}}const Nn={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"executeEntityCommand"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"executionContext"}},type:{kind:"NamedType",name:{kind:"Name",value:"ExecutionContextInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"command"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityCommandInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"clientLaunchId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"WindowOptionsInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"defaultEntityBehindExtension"}},type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"executeEntityCommand"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"executionContext"},value:{kind:"Variable",name:{kind:"Name",value:"executionContext"}}},{kind:"Argument",name:{kind:"Name",value:"command"},value:{kind:"Variable",name:{kind:"Name",value:"command"}}},{kind:"Argument",name:{kind:"Name",value:"clientLaunchId"},value:{kind:"Variable",name:{kind:"Name",value:"clientLaunchId"}}},{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}},{kind:"Argument",name:{kind:"Name",value:"windowOptions"},value:{kind:"Variable",name:{kind:"Name",value:"windowOptions"}}},{kind:"Argument",name:{kind:"Name",value:"defaultEntityBehindExtension"},value:{kind:"Variable",name:{kind:"Name",value:"defaultEntityBehindExtension"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var En=n(198418),An=n(66432);const _n=/(maglev|Teams)\/(\d+\.\d+\.\d+\.\d+)/,Fn="teams-precache-v2";function Dn(e){return e.includes("local")?"local":e.includes("-oncdn-")?"container":"production"}function Pn(e,t){try{const t=Mn(e),n=t?.dataset?.config;return n?JSON.parse(decodeURIComponent(n)):{}}catch(e){const n=`Failed to parse head-data config with error: ${e}`;t?.errorToTelemetry?t?.errorToTelemetry?.(n,"webclient_framework_head_config",void 0,!0):t?.error?.(n)}return{}}function Mn(e){const t=e?.document.getElementsByTagName("head");if(t)return t[0]}function xn(e){const t=e?.navigator.userAgent||"";return-1!==t.indexOf("maglev/")||-1!==t.indexOf("Teams/")}const Rn=e=>function(e){const t=e.match(/(maglev|Teams)\/(\d+\.\d+\.\d+\.\d+)\/(\d+)/);if(t&&t.length>3)switch(t[3]){case"49":return An.us.MaglevT21;case"50":return An.us.MaglevMacT21;case"51":return An.us.MaglevRoomsT21}return An.us.Maglev}(e?.navigator.userAgent||"");function jn(e){const t=e.navigator.userAgent.match(_n);return t&&t.length>2?t[2]:void 0}function Ln(e){const t=e.config.clientType;return t!==An.Bh.Web?t:e.config.isPwa?An.Bh.PWA:t}function On(e){const t=e.navigator?.serviceWorker?.controller;return"activated"===t?.state}async function $n({app:e,commandChangeReportingService:t,entityCommand:n,hookRequestContext:i,logger:a,windowProvider:o,notificationsHandler:r}){let s=n;if(e.onBeforeCommandHandled){const l=n.command.correlation,c=l.id,d="internal-command-handler-execute-before-command-handled-hook";t.report({type:dt.B.ApplicationHookReceivedCommand,context:{target:d},correlationId:c});try{const t={entityCommand:n,requestContext:i,windowProvider:o||void 0,notificationsHandler:Ct(e)&&r?r:void 0};s=await e.onBeforeCommandHandled(t)}catch(n){const i=`Command 'onBeforeCommandHandled' rejected. An attempt to handle the command was made by app:${e.manifest.name}, but failed. Error: ${(0,ce.A)((0,de.VK)(n))}`;let r,s;return a.errorToTelemetry?.(i,"webclient_framework_foundation_core_services_internal_command_handler",void 0,!0),o&&function(e){return e.indexOf("failed to load bundle:")>=0}(i)&&(r=On(o),r&&(s=await async function(e,t,n){try{const n="failed to load bundle: ",i=e.indexOf(n),a=e.indexOf('","stack":');if(i>=0&&a>i){const o=e.substring(i+n.length,a);if(o){const e=await async function(e,t,n){let i=!1;try{if(e&&On(t)){const n=await t.caches.open(Fn);if(n){const t=await n.keys(),a=new RegExp(`https:\\/\\/staticsint\\.teams\\.cdn\\.office\\.net\\/teams-modular-packages\\/hashed-assets\\/${e}-[a-f0-9]{16}\\.js$`,"i");void 0!==t.find((e=>a.test(e.url)))&&(i=!0)}}}catch{n?.error(`Checking assets in sw cache by name failed, chunk name: ${e}`)}return i}(o,t);return e}}}catch{n.errorNoPii?.(`Check for isChunckInSWCache error, errorMessage: ${e}`)}return Promise.resolve(void 0)}(i,o,a))),t.report({type:dt.B.Failure,context:{errorInfo:ct.y.OnBeforeCommandHandledRejected,errorMessage:i,target:d,isServiceWorkerActive:r,isLoadedFromServiceWorkerCache:s},correlationId:c}),Promise.reject(n)}void 0!==s&&(t.report({type:dt.B.ApplicationHookContinuedCommand,context:{target:d},correlationId:c}),s.command.correlation=l,t.report({type:dt.B.CommandStart,correlationId:c,context:{target:d,entityCommand:s}}))}return Promise.resolve(s)}function Un({appName:e,commandChangeReportingService:t,entityCommand:n,getCommandScenarioName:i,logger:a,coreSettings:o,clientPreferences:r}){const s=n.command.correlation,l=void 0===s.scenarioName||s.scenarioName===H.RG.EntityCommand;if(i&&l){try{s.scenarioName=i(n,a,o,r)}catch(n){t.report({type:dt.B.Failure,context:{errorInfo:ct.y.GetCommandScenarioNameHookFailed,errorMessage:`App ${e} failed to execute entity command hook GetCommandScenarioName with ${n.name}`,target:"internal-command-handler"},correlationId:s.id})}a.log(`App ${e} is overwriting default scenario name to ${s.scenarioName} for command with entityType ${n.entity.type}`)}}function Bn(e){return{...e,command:Wn(e.command)}}function Wn(e){return{...e,correlation:je(e.correlation)}}const Hn=new En.B(50),Vn=async({activeWindowsService:e,appsRegistryService:t,authenticationUser:n,client:i,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,coreSettings:s,entityCommandInput:l,executionContext:c,experienceChangeReportingService:d,loggerFactory:u,notificationsHandler:m,platformService:p,scenarioFactory:g,userBiService:y,userTrackingService:v,windowId:f,windowProvider:S})=>{const k=u.newLogger("internalCommandHandler","core-services-entity-commanding"),w=l.command?.__UNSAFE_windowId??f;w!==f&&k.log(`window id overridden to ${w}`);let T=Bn(function(e){const t=e.command||Wn({stateTransition:ke.su.none,visibilityState:ke.fe.show,correlation:{source:C.D.Unknown}});return{...e,command:t}}(l));const I=T.command.correlation.id;if(((e,t,n,i,a)=>{const{enableRejectOnDuplicateCorrelationId:o}=n.get(b.J.Core);if(!o)return!1;if(Hn.has(t)){const n=`Error, duplicate entity command correlation id, ${t}, entity: ${e.entity.type}/${e.entity.action}`;return i.report({type:dt.B.Failure,correlationId:t,context:{target:"internal-command-handler",errorMessage:n,eventData:{mainEntityType:e.entity.type,mainEntityAction:e.entity.action}}}),a.error(n),!0}return Hn.set(t,!0),!1})(T,I,s,r,k))return Promise.resolve(void 0);const N=function(e,t){return t&&e.getApp({entityType:t.viewEntity?.type})}(t,c),E=function(e,t){return e.getApp({entityType:t.entity.type})}(t,T);if(function({commandChangeReportingService:e,entityCommand:t,logger:n,sourceApp:i,renderingApp:a,coreSettings:o,clientPreferences:r}){t.entity.type===Se.py.default&&(t.command.correlation.scenarioName=H.RG.DefaultCommand),i&&Un({appName:i.manifest.name,commandChangeReportingService:e,entityCommand:t,getCommandScenarioName:i.getCommandScenarioNameFromSource,logger:n,coreSettings:o,clientPreferences:r}),a&&Un({appName:a.manifest.name,commandChangeReportingService:e,entityCommand:t,getCommandScenarioName:a.getCommandScenarioName,logger:n,coreSettings:o,clientPreferences:r})}({commandChangeReportingService:r,entityCommand:T,renderingApp:E,sourceApp:N,logger:k,coreSettings:s,clientPreferences:o}),function({commandChangeReportingService:e,entityCommand:t,executionContextEntity:n}){const i=t.command.correlation.id;e.report({type:dt.B.CommandStart,correlationId:i,context:{target:"internal-command-handler",entityCommand:t,executionContextEntity:n}})}({commandChangeReportingService:r,entityCommand:T,executionContextEntity:c?.viewEntity}),E){const e=function(e,t,n,i,a,o,r,s){return{client:e,coreSettings:t,loggerFactory:n,platformService:i,scenarioFactory:a,userBiService:o,userTrackingService:r,authenticationUser:s}}(i,s,u,p,g,y,v,n),t=S||void 0;T=await $n({app:E,commandChangeReportingService:r,entityCommand:T,hookRequestContext:e,logger:k,windowProvider:t,notificationsHandler:m})}if(!T)return r.report({type:dt.B.CommandHandledPriorToResolution,context:{target:"internal-command-handler"},correlationId:I}),Promise.resolve(void 0);const{enableDecoupleCommandingFromResolvers:A}=s.get(b.J.Core);if(A){const i=await(async({activeWindowsService:e,commandChangeReportingService:t,coreSettings:n,entityCommand:i,executionContext:a,loggerFactory:o,authenticationUser:r,windowId:s=h.ew})=>{const{enableDecoupleCommandingFromResolversExtend:l}=n.get(b.J.Core);if(!l)return!1;const c=o.newLogger("dispatchCommand","core-services-entity-commanding");t.report({correlationId:i.command.correlation.id,type:dt.B.CommandResolutionStarted,context:{target:"executeEntityCommand"}}),c.log(`Command received for entity ${JSON.stringify(i.entity)}`),c.log(`Command received :${JSON.stringify(i.command)}`),c.log(`Command with id ${i.command.correlation.id} received on window context ${s}`),c.log(`Command received with execution context: ${a?.viewEntityName}`);const d=a?.userContextId||r&&(0,xe.b4)(r)||"extend"===i.command.stateTransition&&e.getStandardMainWindow()?.id&&e.getStandardMainWindow()?.userContextId||null;if("extend"===i.command.stateTransition){const t=i.command.correlation;return e.executeCommand("handleExtendCommand")({correlation:t,entity:{...i.entity,options:JSON.stringify(i.entityOptions)},userContextId:d,windowId:s}),!0}return!1})({activeWindowsService:e,appsRegistryService:t,authenticationUser:n,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,coreSettings:s,entityCommand:T,executionContext:c,experienceChangeReportingService:d,loggerFactory:u,notificationsHandler:m,scenarioFactory:g,windowId:w,windowProvider:S});if(i)return void k.log("Command was handled without resolvers")}return function({entityCommand:e,mutateContext:{client:t,executionContext:n,windowId:i,clientLaunchId:a}}){return t.mutate({mutation:Nn,variables:{...e,entityOptions:JSON.stringify(e.entityOptions),executionContext:n,windowId:i,clientLaunchId:a},fetchPolicy:"no-cache"}).then((e=>e?.data?.executeEntityCommand?.id))}({entityCommand:T,mutateContext:{client:i,executionContext:c,windowId:w,clientLaunchId:a}})};var Gn=n(141330);class zn{constructor(e){this.commandHandler=e}trigger(e){return this.commandHandler({entity:Jn(e.entity),command:Xn(e.command)})}}const qn=e=>{switch(e){case Gn.uk.view:return Se.uk.view;case Gn.uk.list:return Se.uk.list;case Gn.uk.default:return Se.uk.default;default:throw(0,de.Tr)(h.w5.Commanding,h.jK.NotImplemented,"Nova",void 0,`Mapping for Nova action type ${e} not implemented in Teams!`)}},Jn=e=>{switch(e.type){case Gn.py.identity:return Qn(e);case Gn.py.teams_chat:return{type:Se.py.chats,id:e.entityId,action:qn(e.action)};case Gn.py.teams_channel:return{type:Se.py.channels,id:e.entityId,action:qn(e.action)};case Gn.py.office_home:return{type:Se.py.communitiesonboarding,id:e.entityId,action:qn(e.action)};case Gn.py.office_people:return{type:Se.py.homepage,id:e.entityId,action:qn(e.action)};case Gn.py.teams_activity:return{type:Se.py.activity,id:e.entityId,action:qn(e.action)};case Gn.py.teams_calendar:return{type:Se.py.calendar,id:e.entityId,action:qn(e.action)};case Gn.py.teams_meet:return{type:Se.py.meet,id:e.entityId,action:qn(e.action)};case Gn.py.m365_app:return{type:Se.py.extensions,id:e.entityId,action:qn(e.action)};case Gn.py.teams_calling:return{type:Se.py.callsmain,id:e.entityId,action:Se.uk.view};default:throw(0,de.Tr)(h.w5.Commanding,h.jK.NotImplemented,"Nova",void 0,`Mapping for Nova entity type ${e.type} not implemented in Teams!`)}},Qn=e=>{switch(e.action){case Gn.uk.signout:return{type:Se.py.signoutdialog,id:e.entityId,action:Se.uk.view};case Gn.uk.updateProfilePicture:return{type:Se.py.updatemsaprofileavatardialog,id:e.entityId,action:Se.uk.view};case Gn.uk.updateDisplayName:return{type:Se.py.updatemsaprofilenamedialog,id:e.entityId,action:Se.uk.view};default:throw(0,de.Tr)(h.w5.Commanding,h.jK.NotImplemented,"Nova",void 0,`Mapping for Nova identity entity with action type ${e.action} not implemented in Teams!`)}},Kn=e=>{switch(e){case Gn.fe.hide:return ke.fe.hide;case Gn.fe.show:return ke.fe.show;case Gn.fe.toggle:return ke.fe.toggle}},Yn=e=>{switch(e){case Gn.su.extend:return ke.su.extend;case Gn.su.flush:return ke.su.flush;case Gn.su.forceFlush:return ke.su.forceFlush;case Gn.su.new:return ke.su.new;case Gn.su.none:return ke.su.none}},Xn=e=>({visibilityState:Kn(e.visibilityState),stateTransition:Yn(e.stateTransition),correlation:{source:C.D.Nova}});var Zn,ei,ti=n(268632),ni=n(542187),ii=n(112589);class ai{constructor(e,t,n,i,a,o,r){this.commandHandler=e,this.extensionCommanding=t,this.hostCommunicationService=n,this.windowId=i,this.host=a,this.coreSettings=o,this._logger=r.newLogger("ShellCommandingService","core-services-entity-commanding")}async bringWindowToFront(e){const t=await this.hostCommunicationService.loadModule("osutils");return this._logger.log(`Performing action: bringWindowToFront on ${e}`),t?.bringWindowToFront?.(e)||Promise.resolve(!1)}desktopActiveCallDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.appswitcherdesktopactivecalldialog,action:Se.uk.view},{entityCommand:e})}async desktopNotice(){const e=await this.hostCommunicationService.loadModule("osutils");return this._logger.log("Performing action: desktopNotice"),e?.openThirdPartyNotice?.()}dismissBanner(e,t=C.D.Unknown){return this.dismissNotification(e,Se.py.bannerNotification,t)}dismissToast(e,t=C.D.Unknown){return this.dismissNotification(e,Se.py.inAppToast,t)}executeNotificationAction(e,t,n,i,a){let o;try{o=JSON.parse(i)}catch(e){return this._logger.errorNoPii?.(`Notification command can't be parsed: ${i}`),Promise.resolve()}return a?this.dismissNotification(e,t,n):t===Se.py.bannerNotification&&(o.entityOptions={...o.entityOptions,bannerId:e}),this.commandHandler(o)}exitFullscreen(){if(this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms){const e=this.host.document,t=(e.exitFullscreen?"exitFullscreen":e.mozCancelFullScreen&&"mozCancelFullScreen")||e.webkitExitFullscreen&&"webkitExitFullscreen"||e.webkitExitFullScreen&&"webkitExitFullScreen";return Promise.resolve(e[t]()).then((()=>(this._logger.log(`WindowAction[${t}] succeeded.`),Promise.resolve()))).catch((e=>{const n=(0,ce.A)(e?.message);return this._logger.error(`WindowAction[${t}] failed due to: ${n}.`),Promise.reject(n)}))}return this.host.exitFullscreen(),Promise.resolve()}async getScreenshots(e,t){const n=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: getScreenshots on ${this.windowId}`),n?.getScreenshots?.(e,t)}async installAndLaunchT1(){const e=await this.hostCommunicationService.loadModule("appswitcher"),t=await(e?.downloadAndInstallPearApp?.(ti.OP.Teams1));switch(t?.status){case ti.cw.DownloadedAndInstalled:await this.launchT1AndQuitT2(!0),this._logger.log("T1 is downloaded and installed");break;case ti.cw.FailedToDownload:this._logger.errorNoPii?.(`T1 failed to download: ${t?.errorMessage}`);break;case ti.cw.FailedToInstall:this._logger.errorNoPii?.(`T1 failed to install: ${t?.errorMessage}`);break;default:this._logger.errorNoPii?.(`T1 download and install failed: ${t?.errorMessage}`)}}joinLinkDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.joinlinkdialog,action:Se.uk.view},{entityCommand:e,entityOptions:t})}async launchT1AndQuitT2(e,t){const n=await this.hostCommunicationService.loadModule("appswitcher");e&&(this._logger.log("launchT1AndQuitT2, Switcher default app to T1"),await(n?.switchDefaultAppTo?.(ti.OP.Teams1))),this._logger.log("launchT1AndQuitT2, launch T1"),await(n?.launchPearApp?.(ti.OP.Teams1,t)),this._logger.log("Flushing T2 telemetry events"),await(0,ii.Yf)().flush(),this._logger.log("launchT1AndQuitT2, quit T2"),await(n?.quitApp?.())}async setWindowControlsTheme(e){const t=await this.hostCommunicationService.loadModule("windowcontrols");return t?.setCustomFrameOptions?.(this.windowId,{titleBarMode:ni.i$.ButtonsOnly,theme:e})}licenseRequestDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.licenserequestdialog,action:Se.uk.view},{entityCommand:e,entityOptions:t})}async maximizeWindow(){if(!this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms)return this.host.maximize();const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: maximizeWindow on ${this.windowId}`),e?.maximize?.(this.windowId)}async minimizeWindow(){if(!this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms)return this.host.minimize();const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: maximizeWindow on ${this.windowId}`),e?.minimize?.(this.windowId)}msaProfileAvatarUpdateDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.updatemsaprofileavatardialog,action:Se.uk.view},{entityCommand:e})}msaProfileNameUpdateDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.updatemsaprofilenamedialog,action:Se.uk.view},{entityCommand:e})}noticeDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.tpndialog,action:Se.uk.view},{entityCommand:e})}openFreDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.officeintegrationfredialog,action:Se.uk.info},{entityCommand:e})}premiumTrialDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.premiumtrialdialog,action:Se.uk.view},{entityCommand:e,entityOptions:t})}requestFullscreen(){if(this.coreSettings.get(b.J.Core).routeWindowActionsThroughHostComms){const e=this.host.document.documentElement,t=(e.requestFullscreen?"requestFullscreen":e.mozRequestFullScreen&&"mozRequestFullScreen")||e.webkitRequestFullscreen&&"webkitRequestFullscreen"||e.webkitRequestFullScreen&&"webkitRequestFullScreen"||e.webkitEnterFullScreen&&"webkitEnterFullScreen"||e.webkitEnterFullscreen&&"webkitEnterFullscreen";return Promise.resolve(e[t]()).then((()=>(this._logger.log(`WindowAction[${t}] succeeded.`),Promise.resolve()))).catch((e=>{const n=(0,ce.A)(e?.message);return this._logger.error(`WindowAction[${t}] failed due to: ${n}.`),Promise.reject(n)}))}return this.host.requestFullscreen(),Promise.resolve()}async restoreWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: restoreWindow on ${this.windowId}`),e?.restore?.(this.windowId)}async setMinimumWindowSize(e,t){const n=await this.hostCommunicationService.loadModule("windowcontrols");return n?.setMinimumWindowSize?.(this.windowId,e,t)}async setWindowBounds(e,t,n,i){const a=await this.hostCommunicationService.loadModule("windowcontrols");return a?.setWindowBounds?.(this.windowId,Math.trunc(e),Math.trunc(t),Math.trunc(n),Math.trunc(i))}async updateWindowTransparency(e,t){const n=await this.hostCommunicationService.loadModule("windowcontrols");let i;return i="mercury"===t?this.calculateMercuryWindowTransparencyBorders(e):this.calculateDefaultWindowTransparencyBorders(e),n?.setBackdropEffectState?.(this.windowId,!0,i)}async showContextMenu(e){const t=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: showContextMenu on ${this.windowId} and position ${e}`),t?.showTitleBarContextMenu?.(this.windowId,e)}showBanner({id:e,dismissable:t=!0,duration:n=4,source:i=C.D.Unknown,...a}){return this.commandHandler({command:{correlation:{source:i},stateTransition:ke.su.none,visibilityState:ke.fe.show},entity:{type:Se.py.bannerNotification,action:Se.uk.create,id:e},entityOptions:{...a,dismissable:t,duration:n}})}showToast({id:e,duration:t=7e3,source:n=C.D.Unknown,...i}){return this.commandHandler({command:{correlation:{source:n},stateTransition:ke.su.none,visibilityState:ke.fe.show},entity:{type:Se.py.inAppToast,action:Se.uk.create,id:e},entityOptions:{...i,duration:t}})}signOutDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.signoutdialog,action:Se.uk.view},{entityCommand:e})}async startWindowDragListener(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: startWindowDragListener on ${this.windowId}`),e?.startWindowDragListener?.(this.windowId)}async swapMeetingRoomFrontOfRoomWindows(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log("Performing action: swapMeetingRoomFrontOfRoomWindows"),e?.swapMeetingRoomFrontOfRoomWindows?.()}async switchDefaultAppTo(e){const t=await this.hostCommunicationService.loadModule("appswitcher");this._logger.log(`switchDefaultAppTo ${e}`),await(t?.switchDefaultAppTo?.(e))}t1DownloadDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.appswitchert1downloaddialog,action:Se.uk.view},{entityCommand:e})}webActiveCallDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.appswitcherwebactivecalldialog,action:Se.uk.view},{entityCommand:e})}webMultipleTabsDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.appswitcherwebmultipletabsdialog,action:Se.uk.view},{entityCommand:e})}async zoomInWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomInWindow on ${this.windowId}`),e?.zoomIn?.(this.windowId)}async zoomOutWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomOutWindow on ${this.windowId}`),e?.zoomOut?.(this.windowId)}async zoomResetWindow(){const e=await this.hostCommunicationService.loadModule("windowcontrols");return this._logger.log(`Performing action: zoomResetWindow on ${this.windowId}`),e?.zoomReset?.(this.windowId)}dismissNotification(e,t,n=C.D.Unknown){return this.commandHandler({command:{correlation:{source:n},stateTransition:ke.su.none,visibilityState:ke.fe.hide},entity:{type:t,action:Se.uk.delete,id:e}})}calculateDefaultWindowTransparencyBorders(e){let t=0;if(e>=1500){t=360}else if(e>=1350){t=320}else if(e>=947){t=280}return{left:68+t,top:48,right:0,bottom:0}}calculateMercuryWindowTransparencyBorders(e){let t=0;if(e>=1500){t=408}else if(e>=1350){t=408}else if(e>=947){t=340}return{left:67+t,top:48,right:0,bottom:0}}}!function(e){e.openInExplorer="openInExplorer"}(Zn||(Zn={})),function(e){e.quickReply="quickReply",e.unknown="unknown",e.view="view",e.toast="toast"}(ei||(ei={}));var oi,ri=n(737874);!function(e){e.unknown="unknown",e.toast="toast",e.activity="activity"}(oi||(oi={}));var si=n(774205),li=n(525556);class ci{constructor(e,t){this.commandHandler=e,this.userContextId=t}showMessage(e,{collectionId:t,conversationId:n,mainImage:i,discardDuringMeetingsAndCalls:a,messageId:o,quickReply:r,quickReplyButton:s,quickReplyPlaceholder:l,text:c,time:d,title:u,isUrgent:m,isFromPriorityContact:p,externalAppIconType:g}){const h={collectionId:t,isUrgent:p||m,mainImage:i,discardDuringMeetingsAndCalls:a,targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,messageId:o,userContextId:this.userContextId,toastType:di(n)?"phoneLinkSmsToast":void 0},id:n,type:y.dt.chats},textInput:r?ui(n,s,l,this.userContextId):void 0,text:c,time:d,title:u,telemetryClientId:e,externalAppIconType:g},v={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:d.valueOf(),scenarioName:H.RG.CrossClientToastView},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:h};return this.commandHandler(v)}showReminder(e,{collectionId:t,conversationId:n,mainImage:i,messageId:a,text:o,time:r,title:s,buttonText:l,type:c}){const d={collectionId:t,mainImage:i,targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,messageId:a,userContextId:this.userContextId,toastType:c},id:n,type:y.dt.reminders},textInput:void 0,text:o,time:r,title:s,telemetryClientId:e,buttons:[{targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,messageId:a,userContextId:this.userContextId},id:n,type:y.dt.reminders},text:l}]},u={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:r.valueOf()},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:d};return this.commandHandler(u)}showChatTabEntityNotification(e,{collectionId:t,conversationId:n,mainImage:i,tabId:a,text:o,time:r,title:s}){const l={collectionId:t,mainImage:i,targetEntity:{id:a,type:y.dt.extensions,action:y.A$.view,dataOptions:{actionType:ei.unknown,userContextId:this.userContextId},linkedEntity:{id:n,action:y.A$.view,type:y.dt.chats}},text:o,time:r,title:s,telemetryClientId:e},c={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:r.valueOf()},stateTransition:ke.su.flush,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:l};return this.commandHandler(c)}showChannelsNotification(e,{collectionId:t,conversationId:n,mainImage:i,discardDuringMeetingsAndCalls:a,messageId:o,text:r,time:s,title:l,replyChainId:c}){const d={collectionId:t,mainImage:i,discardDuringMeetingsAndCalls:a,targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,messageId:o,userContextId:this.userContextId,focusOnLoad:ri.t.DoNotMove},id:JSON.stringify({channelId:n,replyChainId:c,deepLinkId:c}),type:y.dt.channels},text:r,time:s,title:l,telemetryClientId:e},u={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:s.valueOf(),scenarioName:H.RG.CrossClientToastView},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:d};return this.commandHandler(u)}showCommunitiesNotifications(e,{collectionId:t,conversationId:n,mainImage:i,messageId:a,text:o,time:r,title:s,replyChainId:l,type:c}){const d={collectionId:t,mainImage:i,targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,messageId:a,userContextId:this.userContextId,toastType:c,teamId:n,deepLinkId:a},id:JSON.stringify({channelId:n,replyChainId:l}),type:y.dt.communities},text:o,time:r,title:s,telemetryClientId:e},u={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:r.valueOf()},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:d};return this.commandHandler(u)}showCommunitiesMembersViewNotifications(e,{collectionId:t,conversationId:n,mainImage:i,text:a,time:o,title:r,type:s}){const l={collectionId:t,mainImage:i,targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,userContextId:this.userContextId,toastType:s,teamId:n},id:n,type:y.dt.communitiesmembers},text:a,time:o,title:r,telemetryClientId:e},c={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:o.valueOf()},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:l};return this.commandHandler(c)}showCommunitiesMemberRequestsNotifications(e,{collectionId:t,conversationId:n,mainImage:i,text:a,time:o,title:r,type:s}){const l={collectionId:t,mainImage:i,targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,userContextId:this.userContextId,toastType:s,teamId:n},id:n,type:y.dt.communitiesjoinrequest},text:a,time:o,title:r,telemetryClientId:e},c={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:o.valueOf()},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:l};return this.commandHandler(c)}showCommunitiesCalendarEventsNotifications(e,{collectionId:t,conversationId:n,mainImage:i,text:a,time:o,title:r}){const s={collectionId:t,mainImage:i,targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,userContextId:this.userContextId},id:JSON.stringify({channelId:n}),type:y.dt.communitiesevents},text:a,time:o,title:r},l={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:o.valueOf()},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:s};return this.commandHandler(l)}showEspSyntheticNotification(e,{collectionId:t,mainImage:n,text:i,time:a,title:o,campaignType:r}){let s;if(r){if(r===si.mL.files){const l="newchat";s={collectionId:t,mainImage:n,targetEntity:{type:y.dt.chats,action:y.A$.view,id:l,dataOptions:{actionType:oi.toast,userContextId:this.userContextId,campaignType:r}},text:i,time:a,title:o,telemetryClientId:e}}else s={collectionId:t,mainImage:n,targetEntity:{type:y.dt.campaignnotifications,action:y.A$.view,id:r,dataOptions:{actionType:oi.toast,userContextId:this.userContextId}},text:i,time:a,title:o,telemetryClientId:e};const l={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:a.valueOf()},stateTransition:ke.su.flush,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:s};return this.commandHandler(l)}{const t={targetEntity:{dataOptions:{actionType:ei.view,userContextId:this.userContextId,focusOnLoad:ri.t.DeeplinkedMessage},action:y.A$.list,type:y.dt.activity},textInput:void 0,text:i,time:a,title:o,mainImage:n,telemetryClientId:e},r={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:a.valueOf()},stateTransition:ke.su.flush,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:t};return this.commandHandler(r)}}showGraphItemNotification(e,{collectionId:t,mainImage:n,discardDuringMeetingsAndCalls:i,text:a,time:o,title:r,isSquareImage:s}){const l={collectionId:t,mainImage:n,discardDuringMeetingsAndCalls:i,targetEntity:{action:y.A$.list,dataOptions:{actionType:ei.view,userContextId:this.userContextId,focusOnLoad:ri.t.DeeplinkedMessage},id:"msGraph",type:y.dt.activity},text:a,time:o,title:r,isSquareImage:s,telemetryClientId:e},c={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:o.valueOf(),scenarioName:H.RG.CrossClientToastView},stateTransition:ke.su.flush,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:l};return this.commandHandler(c)}showReEngageNudge(e,{conversationId:t,text:n,time:i,title:a,type:o}){const r={targetEntity:{action:y.A$.view,dataOptions:{actionType:ei.view,userContextId:this.userContextId,toastType:o},id:t,type:y.dt.reminders},textInput:void 0,text:n,time:i,title:a,telemetryClientId:e},s={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:i.valueOf()},stateTransition:ke.su.new,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:r};return this.commandHandler(s)}showLocalRecordingAssemblyNotification(e,{text:t,time:n,title:i,mainImage:a},o){const r={targetEntity:{action:y.A$.view,dataOptions:{actionType:Zn.openInExplorer,userContextId:this.userContextId,fileId:o},id:"localRecordingAssembly",type:y.dt.activity},mainImage:a,textInput:void 0,text:t,time:n,title:i,telemetryClientId:e},s={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:n.valueOf()},stateTransition:ke.su.none,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:r};return this.commandHandler(s)}showMeetNowNudge(e,{conversationId:t,text:n,time:i,title:a,type:o,deeplinkUrl:r,deepLinkId:s}){const l={targetEntity:{action:y.A$.join,dataOptions:{actionType:ei.view,userContextId:this.userContextId,toastType:o,deeplinkUrl:r,coordinates:{joinType:"MeetingData",meetingData:{meetingUrl:r}},deepLinkId:s},id:t,type:y.dt.callingdeeplink},textInput:void 0,text:n,time:i,title:a,telemetryClientId:e},c={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:i.valueOf()},stateTransition:ke.su.flush,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:l};return this.commandHandler(c)}showInteractionRequiredToast(e,{text:t,time:n,title:i,mainImage:a}){const o={targetEntity:{action:y.A$.view,dataOptions:{actionType:"cannot-be-empty",userContextId:this.userContextId},id:e,type:y.dt.alerts},mainImage:a,text:t,time:n,title:i,telemetryClientId:e},r={command:{correlation:{id:e,source:C.D.Notifications,startTimestamp:n.valueOf()},stateTransition:ke.su.flush,visibilityState:ke.fe.show},entity:{action:Se.uk.view,type:Se.py.toasts},entityOptions:o};return this.commandHandler(r)}}const di=e=>!!e?.startsWith(li.a.PhonelinkSmsPrefix),ui=(e,t,n,i)=>({placeholderText:n||"Send a quick reply",sendButton:{text:t||"Send",targetEntity:{action:y.A$.mutate,type:y.dt.chats,dataOptions:{actionType:ei.quickReply,convId:e,userContextId:i,toastType:di(e)?"phoneLinkSmsToast":void 0}}}});class mi{constructor(e){this.commandHandler=e}showAccounts(){return this.commandHandler({entity:{type:Se.py.accounts,action:Se.uk.list}})}}class pi{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}default(e){return this.commandHandler({entity:{type:Se.py.activity,action:Se.uk.default},command:e})}empty(e){return this.commandHandler({entity:{type:Se.py.activity,action:Se.uk.empty},command:e})}launchDeleteActivityFeedItemDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.activity,action:Se.uk.delete},{entityCommand:e})}launchActivityErrorDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.activity,action:Se.uk.error},{entityCommand:t})}openEmptyFeedMainPane(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.activity,action:Se.uk.empty},command:t,scenarioEventData:n})}}var gi=n(799571),hi=n(69588);const yi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataAuthUserAuthStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAuthState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"reason"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"isExpected"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"errorMetadata"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accountId"}},{kind:"Field",name:{kind:"Name",value:"cloud"}}]}}]}}]}}]}}]},vi={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataAuthEndPagesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMRU"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEndPageData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"isMRU"},value:{kind:"Variable",name:{kind:"Name",value:"isMRU"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"pictureBlob"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"subContext"}}]}},{kind:"Field",name:{kind:"Name",value:"shouldBypassEndPageLogout"}}]}}]}}]};class fi{constructor(e,t,n,i){this.commandHandler=e,this.extensionCommanding=t,this.deeplinkCommandingService=n,this.client=i}signinPage(e){return this.commandHandler({entity:{type:Se.py.identity,action:Se.uk.default},command:e})}accountList(e){return this.commandHandler({entity:{type:Se.py.identity,action:Se.uk.list},command:e})}async switchAccount({correlation:e,userContextId:t,targetEntity:n,cloud:i,entityOptions:a}){if(!this.client)throw new Error("client missing in switch account commanding");const{data:o}=await this.client.query({query:yi,variables:{userContextId:t},context:{correlation:e}})||{},r=o?.userAuthState;if(r&&"Up"!==r.state){let n,a;const s=r.customError?.errorCode;if("UnRedeemed"===r.state&&(n=Se.uk.tenantRedemption),"LoginError"===r.state)switch(r.customError?.errorCode){case gi.SM.TenantUnredeemed:n=Se.uk.tenantRedemption;break;case gi.SM.InteractionRequired:n=Se.uk.tenantLogin;break;case gi.SM.CloudMismatch:const e=r.customError?.errorMetadata;i=e?.cloud,t=e?.accountId;break;default:n=Se.uk.error}if("LicenseError"===r.state||"SignInRestriction"===r.state||"MsaUserNotAllowed"===s){const i=await this.client.query({query:vi,variables:{userContextId:t,isMRU:!1},context:{correlation:e}}),o="MsaUserNotAllowed"===s?s:"LicenseError"===r.state?"LicenseError":"SignInRestriction",l=i.data.userEndPageData;n=Se.uk.error,a=(0,hi.fj)(l,o,t)}if(n)return this.commandHandler({entity:{type:Se.py.identitydialog,action:n},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:e},entityOptions:{correlation:e,userContextId:t,userAuthState:o?.userAuthState,error:a}})}return this.deeplinkCommandingService.switchAccount(e,t,n,i,a)}signOutDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.signoutdialog,action:Se.uk.view},{entityCommand:e})}smartDeviceSignOutDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.smartdevicelogoutdialog,action:Se.uk.view},{entityCommand:e})}addAccountDialog(e){return this.commandHandler({entity:{type:Se.py.identitydialog,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,layoutMode:ke.lO.focus,correlation:e.correlation},entityOptions:e})}accountSelectionDialog(e){return this.commandHandler({entity:{type:Se.py.accountselectiondialog,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,layoutMode:ke.lO.focus,correlation:e.correlation},entityOptions:e})}closeAccountSelectionDialog(e){return this.commandHandler({entity:{type:Se.py.accountselectiondialog,action:Se.uk.create},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,layoutMode:ke.lO.focus,correlation:{source:e}}})}addAccount(e){return this.commandHandler({entity:{type:Se.py.identity,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new,layoutMode:ke.lO.focus,correlation:e},entityOptions:{correlation:e}})}closeAccountListDialog(e){return this.commandHandler({entity:{type:Se.py.identitydialog,action:Se.uk.create},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,layoutMode:ke.lO.focus,correlation:{source:e}}})}closeEntity(e,t){return this.commandHandler({entity:t,command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,layoutMode:ke.lO.focus,correlation:{source:e}}})}executeEntity(e){return this.commandHandler(e)}closeAccountLoginDialog(e){return this.commandHandler({entity:{type:Se.py.identitydialog,action:Se.uk.tenantLogin},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,layoutMode:ke.lO.focus,correlation:{source:e}}})}closeAddAccountListWindow(e){return this.commandHandler({entity:{type:Se.py.identity,action:Se.uk.create},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,layoutMode:ke.lO.focus,correlation:{source:e}}})}closeAccountListWindow(e){return this.commandHandler({entity:{id:ke.lO.focus,type:Se.py.identity,action:Se.uk.list},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,layoutMode:ke.lO.focus,correlation:{source:e}}})}showAuthEndPage(e,t,n){return this.commandHandler({entity:{type:n?Se.py.identitydialog:Se.py.identity,action:Se.uk.error},command:{visibilityState:ke.fe.show,stateTransition:n?ke.su.extend:ke.su.flush,layoutMode:n?ke.lO.focus:ke.lO.standard,correlation:{source:e}},entityOptions:{error:t.error}})}showRefreshModal(e){return this.commandHandler({entity:{type:Se.py.authrefreshdialog,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,layoutMode:ke.lO.standard,correlation:{source:e}}})}}class Si{constructor(e){this.commandHandler=e}viewAutoInstallNotification(e,t){return this.commandHandler({entity:{type:Se.py.autoinstallnotification,action:Se.uk.view},command:t,entityOptions:e})}}class ki{constructor(e){this.commandHandler=e}navigateToFaceEnrollment(){return this.commandHandler({entity:{type:Se.py.faceenrollment,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{startTimestamp:Date.now(),source:C.D.FaceEnrollmentGetStartedButton}}})}navigateToVoiceEnrollment(){return this.commandHandler({entity:{type:Se.py.voiceenrollment,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{startTimestamp:Date.now(),source:C.D.VoiceEnrollmentGetStartedButton}}})}}class Ci{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}brbFeedbackDialogInMainWindow(e,t){return this.commandHandler({entity:{type:Se.py.brbfeedbackdialog,action:Se.uk.view},command:e,entityOptions:t})}brbFeedbackDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.brbfeedbackdialog,action:Se.uk.view},{entityCommand:e,entityOptions:t})}autoBrbConfirmationDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.autobrbconfirmationdialog,action:Se.uk.view},{entityCommand:e,entityOptions:t})}autoBrbFlowDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.autobrbflowdialog,action:Se.uk.view},{entityCommand:e,entityOptions:t})}}class bi{constructor(e){this.commandHandler=e}openBreakoutRooms(e,t){return this.commandHandler({entity:{type:Se.py.breakoutrooms,action:Se.uk.view},entityOptions:t,command:e})}openBreakoutRoomsInChat(e,t){return this.commandHandler({entity:{type:Se.py.breakoutrooms,action:Se.uk.view,linkedEntity:{type:Se.py.chats,id:e}},command:t})}showAssignmentDialog(e){return this.showDialog(Se.py.breakoutroomsassignment,e)}showAssignmentTypeDialog(e){return this.showDialog(Se.py.breakoutroomsassignmenttype,e)}showCreateRoomsDialog(e){return this.showDialog(Se.py.breakoutroomscreaterooms,e)}showDeleteRoomDialog(e){return this.showDialog(Se.py.breakoutroomsdeleteroom,e)}showDeleteRoomsDialog(e){return this.showDialog(Se.py.breakoutroomsdeleterooms,e)}showEditRoomDialog(e){return this.showDialog(Se.py.breakoutroomseditroom,e)}showSettingsDialog(e){return this.showDialog(Se.py.breakoutroomssettings,e)}showDialog(e,t){return this.commandHandler({entity:{type:e,action:Se.uk.view},command:{stateTransition:ke.su.extend,correlation:{source:C.D.ExtensionCommanding},visibilityState:t}})}}class wi{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}qnaPanelById(e,t){return this.commandHandler({entity:{type:Se.py.broadcastqna,action:Se.uk.view,id:e,linkedEntity:{type:Se.py.calls,id:e}},command:t})}broadcastQnaPanelById(e,t){return this.commandHandler({entity:{type:Se.py.eventsbroadcastqna,action:Se.uk.view,id:e,linkedEntity:{type:Se.py.calls,id:e}},command:t})}infoPanelById(e,t){return this.commandHandler({entity:{type:Se.py.broadcasts,action:Se.uk.info,id:e,linkedEntity:{type:Se.py.calls,id:e}},command:t})}broadcastWebJoinUnsupportedDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.broadcastwebjoinnotsupporteddialog,action:Se.uk.view},{entityOptions:{originalDeeplink:e}})}broadcastById(e,t,n){return this.commandHandler({entity:{type:Se.py.broadcasts,action:Se.uk.view,id:e},command:t,entityOptions:n})}broadcastFeedbackById(e,t,n){return this.commandHandler({entity:{type:Se.py.broadcastfeedback,action:Se.uk.view,id:e},command:t,entityOptions:n})}broadcastLeave(e,t,n){return this.commandHandler({entity:{type:Se.py.broadcasts,action:Se.uk.leave,id:e},command:t,entityOptions:n})}joinBroadcastAsAttendee(e){return this.commandHandler(e)}}class Ti{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}meetingDetails(e,t,n,i){const a=i||Se.py.schedulingform;return this.commandHandler({entity:{type:a,action:Se.uk.view,id:e},command:t,entityOptions:n})}openCalendarSurface(e,t,n,i){return this.commandHandler({entity:{type:Se.py.calendar,action:Se.uk.view,id:e,linkedEntity:i},command:t,entityOptions:n})}openM365CalendarSurface(e){return this.commandHandler({entity:{type:Se.py.extensions,action:Se.uk.view,id:JSON.stringify({appId:"5966c135-e05f-4ce0-81e0-e138fe8e9583"})},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:e||C.D.Calendar}}})}openCalendarAgendaView(e,t,n){return this.commandHandler({entity:{type:Se.py.calendar,action:Se.uk.list,linkedEntity:n},command:e,entityOptions:t})}openChannelCalendarSurface(e,t,n,i){const a={entity:{action:Se.uk.view,id:e,linkedEntity:i,type:Se.py.channelcalendar},command:t,entityOptions:n};return this.commandHandler(a)}openSchedulingFormInMainWindow(e,t,n){return this.commandHandler({entity:{type:Se.py.schedulingform,action:Se.uk.create,id:e},command:t,entityOptions:n})}openBroadcast(e,t,n,i){const a={type:Se.py.broadcastliveevent,id:e,action:t};return this.extensionCommanding.executeCommand(a,{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{source:n}},entityOptions:i})}closeSchedulingForm(e,t,n){return this.commandHandler({entity:e,command:t,entityOptions:n})}showCalendarErrorModal(e){return this.extensionCommanding.executeCommand({type:Se.py.calendar,action:Se.uk.error},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.CalendarEventAction}},entityOptions:e})}addBlockingConfirmationDialog(e,t){return this.extensionCommanding.addBlockingExtension({type:Se.py.calendar,action:Se.uk.confirm},e,t)}isBlockedByCalendar(){return this.extensionCommanding.isBlockedByEntity(Se.py.calendar)}showConfirmationDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.calendar,action:Se.uk.confirm},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.CalendarEventAction}},entityOptions:e})}showShareDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.calendar,action:Se.uk.share},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.CalendarEventAction}},entityOptions:e})}showEmbedDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.calendar,action:Se.uk.info},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.CalendarEventAction}},entityOptions:e})}openConnectedCalendarDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.connectedcalendardialog,action:Se.uk.view},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.CalendarSettings}},entityOptions:e})}openConnectedCalendarSurfaceDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.connectedcalendarsurfacedialog,action:Se.uk.view},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.Calendar}},entityOptions:e})}}class Ii{constructor(e,t,n=void 0){this.commandHandler=e,this.extensionCommanding=t,this.userContextId=n}call(e,t){return this.commandHandler({entity:{type:Se.py.calls,action:Se.uk.list,id:e},command:t})}callDebug(e){return this.commandHandler({entity:{type:Se.py.calls,action:Se.uk.info},command:e})}dialPad(e){return this.commandHandler({entity:{type:Se.py.calls,action:Se.uk.join},command:e})}callById(e,t,n,i,a){let o;return n&&(o={type:Se.py.chats,id:n}),a&&(o={type:Se.py.callingdeeplink,id:a}),this.commandHandler({entity:{type:i||Se.py.calls,action:Se.uk.view,id:e,linkedEntity:o},command:t})}callStageContentById(e,t){return this.commandHandler({entity:{type:Se.py.stagecontent,action:Se.uk.view},entityOptions:t,command:e})}callList(e){return this.commandHandler({entity:{type:Se.py.calls,action:Se.uk.list},command:e})}deviceSettingsById(e,t,n={useCall:!0}){return this.commandHandler({entity:{type:Se.py.devicesettings,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},entityOptions:n,command:t})}audioSettingsById(e,t,n={useCall:!0}){return this.commandHandler({entity:{type:Se.py.audiosettings,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},entityOptions:n,command:t})}extensibilityAppPickerCallingPanel(e,t,n,i){return this.commandHandler({entity:{type:Se.py.extensibilityapppickercallingpanel,action:Se.uk.info,id:e},command:t,entityOptions:{messageId:i,conversationId:e,config:n}})}callNotification(e,t,n,i){const a=e.entityOptions;return a.targetEntity.dataOptions.userContextId=this.userContextId,a.telemetryClientId=n,a.buttons?.forEach((e=>{e.targetEntity.dataOptions.userContextId=this.userContextId})),"Hide"===i?this.commandHandler({entity:{id:t,action:Se.uk.view,type:Se.py.toasts},command:{correlation:{id:n,source:C.D.Calling},stateTransition:ke.su.new,visibilityState:ke.fe.hide},entityOptions:a}):this.commandHandler({entity:{action:Se.uk.view,type:Se.py.toasts,id:t},command:e.command,entityOptions:a})}cameraEffectsSettingsById(e,t){return this.commandHandler({entity:{type:Se.py.cameraeffects,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},entityOptions:{commandSource:t?.correlation.source},command:t})}customVideoBackgroundSettingsById(e,t){return this.commandHandler({entity:{type:Se.py.videobackgrounds,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}styleMyRoomPanelById(e,t){return this.commandHandler({entity:{type:Se.py.stylemyroom,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}callRosterById(e,t,n){const i={entity:{type:Se.py.roster,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t};return n&&(i.entityOptions={isBYODAttendeeView:n}),this.commandHandler(i)}callByodRosterById(e,t){return this.commandHandler({entity:{type:Se.py.byodroster,action:Se.uk.view,linkedEntity:{type:Se.py.byodattendeewindow,id:e}},command:t})}callDetailsById(e,t,n){return this.commandHandler({entity:{type:Se.py.meetingdetails,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e},id:e},entityOptions:{didMeetingNotesAutoOpen:n},command:t})}callInfoById(e,t){return this.commandHandler({entity:{type:Se.py.calls,action:Se.uk.info,linkedEntity:{type:Se.py.calls,id:e}},command:t})}callNotesById(e,t){return this.commandHandler({entity:{type:Se.py.notes,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}transcriptPanelById(e,t){return this.commandHandler({entity:{type:Se.py.transcript,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}callHealthPanelById(e,t){return this.commandHandler({entity:{type:Se.py.calls,action:Se.uk.health,linkedEntity:{type:Se.py.calls,id:e}},command:t})}mediaStreamsPanelById(e,t){return this.commandHandler({entity:{type:Se.py.mediastreams,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}callBreakoutRoomById(e,t){return this.commandHandler({entity:{type:Se.py.breakoutroomspanel,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e},id:e},command:t})}callDeeplinkDialog(e){return this.commandHandler({entity:{type:Se.py.callingdeeplinkDialog,action:Se.uk.view},command:e})}createById(e,t,n,i){return this.commandHandler({entity:{id:e,type:t,action:Se.uk.create},command:n,windowOptions:i})}callMonitorById(e,t,n){return this.commandHandler({entity:{type:Se.py.callsmonitor,action:Se.uk.view},entityOptions:e&&{callingIntentId:e},command:t,windowOptions:n})}callShareMeetingInviteDialogById(e,t,n){return this.extensionCommanding.executeCommand(e,{entityOptions:t,entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:n}}})}callsKeypad(e,t){return this.commandHandler({entity:{type:Se.py.callskeypad,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}callMeetingOptionsById(e,t){return this.commandHandler({entity:{type:Se.py.meetings,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}callsTransfer(e,t){return this.commandHandler({entity:{type:Se.py.callstransfer,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}contentCameraSetupDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.contentcamerasetup,action:Se.uk.create},{entityOptions:t,entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{source:n}}})}startMeetingStream(e,t){return this.extensionCommanding.executeCommand({type:Se.py.meetingstream,action:Se.uk.create},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{source:e}},entityOptions:t})}stagingRoomStartMeetingConfirmationDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.stagingroomstartmeetingconfirmationdialog,action:Se.uk.create},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:t}},entityOptions:n})}openDialog(e,t,n,i){if(!e.id)throw new Error("[openDialog] entity.id is required");return i?this.commandHandler({entity:{id:e.id,type:Se.py.callingdialog,action:Se.uk.create},entityOptions:{entity:e,command:t,options:n},command:{...t,...i}}):(this.extensionCommanding.executeCommand({id:e.id,type:Se.py.callingdialog,action:Se.uk.create},{entityCommand:t,entityOptions:{entity:e,command:t,options:n}}),Promise.resolve())}callableChannelById(e,t,n){return this.commandHandler({entity:{id:t,type:Se.py.callablechannels,action:Se.uk.list,linkedEntity:{id:e,type:Se.py.channels,action:Se.uk.view}},command:n})}toggleRoomRemote(e,t,n){return this.commandHandler({entity:{type:Se.py.roomremote,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},entityOptions:n,command:t})}accessibilityPanelById(e,t){return this.commandHandler({entity:{type:Se.py.accessibilitypanel,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}closedCaptionsSettingsPanelById(e,t,n={allowTranslatedCaptions:!1}){return this.commandHandler({entity:{type:Se.py.closedcaptionssettings,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},entityOptions:n,command:t})}closedCaptionsFlyoutById(e,t){return this.commandHandler({entity:{type:Se.py.closedcaptionsflyout,action:Se.uk.view},entityOptions:e&&{callingIntentId:e},command:t})}openCopilot(e,t,n){return this.commandHandler({entity:{type:Se.py.meetingcollaboration,action:Se.uk.view,id:e.threadId||t||e.callId,linkedEntity:{type:Se.py.calls,id:t||e.callId||e.threadId}},entityOptions:e,command:n})}openCopilotInRecap(e,t,n){return this.commandHandler({entity:{type:Se.py.meetingcollaboration,action:Se.uk.view,id:e.threadId||t||e.callId,linkedEntity:{type:Se.py.meetingrecap,id:e.threadId}},entityOptions:e,command:n})}presenterToolbarById(e,t,n){return this.commandHandler({entity:{type:Se.py.presentertoolbar,action:Se.uk.view},entityOptions:{callingIntentId:t,teamsCallId:e},command:n})}floatingUfdById(e,t,n){return this.commandHandler({entity:{type:Se.py.floatingufd,action:Se.uk.view},entityOptions:{callingIntentId:e,teamsCallId:t},command:n})}pstnCallMeDialogToggle(e,t,n){return this.extensionCommanding.executeCommand(e,{entityOptions:n,entityCommand:t})}openStageCustomizationPanel(e,t){return this.commandHandler({entity:{type:Se.py.stagecustomizationpanel,action:Se.uk.view},entityOptions:{teamsCallId:e},command:t})}openBYODAttendeeView(e,t){return this.commandHandler({entity:{type:Se.py.byodattendeewindow,action:Se.uk.view,id:t?.intentId},entityOptions:t,command:e})}closedCopilotPanelById(e,t,n){return this.commandHandler({entity:{type:Se.py.meetingcollaboration,action:Se.uk.view,id:e,linkedEntity:{type:Se.py.calls,id:e}},entityOptions:n,command:t})}}class Ni{constructor(e){this.commandHandler=e}async navigateById(e,t){return this.commandHandler({entity:{type:Se.py.campaignnotifications,action:Se.uk.view,id:e},entityOptions:t?.entityOptions,command:t?.entityCommand,scenarioEventData:t?.scenarioEventData})}}class Ei{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}default(e=this.getDefaultEntityCommand(C.D.Unknown)){return this.commandHandler({entity:{type:Se.py.channels,action:Se.uk.default},command:e})}channelDeeplinkWithMessageId(e,t,n){return this.commandHandler({entity:{type:Se.py.channels,action:Se.uk.view,id:e},command:t,entityOptions:n})}channelMessagesById(e,t){const n={channelId:e,replyChainId:t?.replyChainId};return this.commandHandler({entity:{type:Se.py.channels,action:Se.uk.view,id:JSON.stringify(n)},command:t.entityCommand,entityOptions:{...t.entityOptions,deepLinkId:t.deepLinkId,pinned:t.pinned,parentTeamId:t.parentTeamId??t.entityOptions?.parentTeamId,source:t.entityCommand.correlation?.source},scenarioEventData:t.extendedOptions?.scenarioEventData})}toggleChannelInfoPane(e,t){const{channelId:n}=Ai(e),i=JSON.stringify({channelId:n});return this.commandHandler({entity:{type:Se.py.channels,action:Se.uk.info,id:i},command:t})}toggleChannelInfoPaneExpandedView(e,t,n,i){const{channelId:a,replyChainId:o}=Ai(e),r=JSON.stringify({channelId:a,replyChainId:o});return this.commandHandler({entity:{type:n,action:Se.uk.info,id:r,linkedEntity:{id:e,type:Se.py.channels}},command:t,entityOptions:i})}showDefaultNavigationDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.defaultchannelnavdialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}showJoinTeamDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.teamjoindialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchCrossPostChannelSelectionDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.crosspostchannelselectiondialog,action:Se.uk.view},{entityCommand:this.getDefaultEntityCommand(t,ke.su.extend),entityOptions:{selectedChannelIds:e}})}launchCrossPostChannelSelectionDialogV2(e,t,n){return this.extensionCommanding.executeCommand({type:Se.py.crosspostchannelselectiondialogV2,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:n}},entityOptions:{selectedChannelIds:e,currentChannelId:t}})}launchAppEnableDialogOnSendMessage(e,t,n,i,a){return this.extensionCommanding.executeCommand({type:Se.py.appenabledialog,action:Se.uk.view},{entityCommand:a,entityOptions:{appId:e,channelType:t,channelId:n,context:i}})}toggleChannelCopilotView(e,t,n){return this.commandHandler({entity:{type:n,action:Se.uk.info,id:e,linkedEntity:{id:e,type:Se.py.channels}},command:t,entityOptions:{source:C.D.ChannelCopilot}})}extensibilityAppPickerSidePanel(e,t){return this.commandHandler({entity:{type:Se.py.channelextensibilityapppickersidepanel,action:Se.uk.info,id:e,linkedEntity:{id:e,type:Se.py.channels}},command:t,entityOptions:{source:C.D.ExtensibilityAppPickerSidePanel}})}openChannelCopilotFromL1View(e,t){return this.commandHandler({entity:{type:Se.py.channels,action:Se.uk.view,id:e},command:t.entityCommand,entityOptions:{...t.entityOptions,channelCopilotOpen:!0,source:t.entityCommand.correlation?.source}})}launchCrossPostDeleteDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.crosspostdeletedialog,action:Se.uk.view},{entityCommand:this.getDefaultEntityCommand(t,ke.su.extend),entityOptions:e})}launchSharedChannelsPastePermissionsFluid(e){return this.extensionCommanding.executeCommand({type:Se.py.fluid,action:Se.uk.info},{entityCommand:e})}getDefaultEntityCommand(e,t=ke.su.flush){return{stateTransition:t,visibilityState:ke.fe.show,correlation:{source:e}}}}const Ai=e=>{if(!e)return{teamId:void 0,channelId:void 0,replyChainId:void 0};try{const{teamId:t,channelId:n,replyChainId:i}=JSON.parse(e);return{teamId:t,channelId:n,replyChainId:i}}catch{return{channelId:e}}};var _i=n(681375);class Fi{constructor(e,t,n,i){this.commandHandler=e,this.extensionCommanding=t,this.coreSettings=n,this._logger=i.newLogger("ChatCommandingService","core-services-entity-commanding")}default(e){return this.handleCommandWithChecks({entity:{type:Se.py.chats,action:Se.uk.default},command:e})}empty(e){return this.handleCommandWithChecks({entity:{type:Se.py.chats,action:Se.uk.empty},command:e})}chatList(e,t){return this.handleCommandWithChecks({entity:{type:Se.py.chats,action:Se.uk.list},entityOptions:t?.entityOptions,command:e})}getChatByIdCommand(e,t,n){const i=n&&t?.entityOptions?.isBYODMode?{type:Se.py.calls,id:n}:null,a={entity:{type:Se.py.chats,action:Se.uk.view,id:e,linkedEntity:i},entityOptions:t?.entityOptions,command:t?.entityCommand,scenarioEventData:t?.scenarioEventData};return this.checkPolicies(a),a}holisticRecap(e){return this.handleCommandWithChecks({command:e,entity:{type:Se.py.holisticrecap,action:Se.uk.view}})}chatById(...e){const t=this.getChatByIdCommand(...e);return this.commandHandler(t)}byodChatById(...e){const t=this.getByodChatByIdCommand(...e);return this.commandHandler(t)}chatChannelConversationById(e,t,n){const i={channelId:e,replyChainId:t};return this.handleCommandWithChecks({entity:{type:Se.py.chatschannelconv,action:Se.uk.view,id:JSON.stringify(i)},entityOptions:n?.entityOptions,command:n?.entityCommand,scenarioEventData:n?.scenarioEventData})}chatWithUsers(e){const t=(0,_i.Mf)(e?.userIds||[],e?.entityCommand);return this.handleCommandWithChecks({...t,entityOptions:e?.entityOptions})}chatWithGuardians(e,t,n,i,a,o){const r=(0,_i.Mf)(t||[],o),s={groupName:n,isGuardiansChat:!0,guardiansChatGroupId:e,guardiansChatStudentId:i,guardiansPreferredToAlternateMriMappings:a};return this.handleCommandWithChecks({...r,entityOptions:s})}orgChat(e,t){return this.handleCommandWithChecks({entity:{type:Se.py.extensions,action:Se.uk.view,id:ke.oz.organization,linkedEntity:{type:Se.py.chats,id:(0,_i.f$)([e])}},command:t})}linkedIn(e,t){return this.handleCommandWithChecks({entity:{type:Se.py.extensions,action:Se.uk.view,id:ke.oz.linkedin,linkedEntity:{type:Se.py.chats,id:(0,_i.f$)([e])}},command:t})}openLpcInMainWindow(e,t){return this.commandHandler({entity:{type:Se.py.livepersonacard,action:Se.uk.view},command:t,entityOptions:e})}launchAltText(e,t){return this.extensionCommanding.executeCommand({type:Se.py.alttext,action:Se.uk.view},{entityCommand:t,entityOptions:{element:e}})}launchAddNewComponentFluid(e){return this.extensionCommanding.executeCommand({type:Se.py.fluid,action:Se.uk.confirm},{entityCommand:e})}launchInsertHyperlink(e,t,n){return this.extensionCommanding.executeCommand({type:Se.py.hyperlink,action:Se.uk.view},{entityCommand:n,entityOptions:{displayText:e,address:t}})}launchDiscardCodeSnippet(e){return this.extensionCommanding.executeCommand({type:Se.py.codesnippet,action:Se.uk.delete},{entityCommand:e})}launchTranslationFeedbackDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.translationfeedback,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchTwoWaySmsFriendlyNameDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.twowaysmsfriendlyname,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchDeleteChat(e,t){return this.extensionCommanding.executeCommand({type:Se.py.deletechat,action:Se.uk.delete},{entityCommand:t,entityOptions:e})}launchDiscardFluid(e,t){return this.extensionCommanding.executeCommand({type:Se.py.fluid,action:Se.uk.delete},{entityCommand:t,entityOptions:{isCompose:e}})}launchPastePermissionsFluid(e,t,n,i,a){return this.extensionCommanding.executeCommand({type:Se.py.fluid,action:Se.uk.manage},{entityCommand:a,entityOptions:{displayTitle:e,displayText:t,cancelButtonContent:n,confirmButtonContent:i}})}launchUpdatePermissionsFluid(e,t){return this.extensionCommanding.executeCommand({type:Se.py.fluid,action:Se.uk.update},{entityCommand:t,entityOptions:{recipientList:e}})}launchUnpinMessageFromChat(e){return this.extensionCommanding.executeCommand({type:Se.py.pinnedconversationitems,action:Se.uk.delete},{entityCommand:e})}launchReplaceMessageFromChat(e){return this.extensionCommanding.executeCommand({type:Se.py.pinnedconversationitems,action:Se.uk.update},{entityCommand:e})}launchDiscardMessageDraft(e,t,n,i){return this.extensionCommanding.executeCommand({type:Se.py.messagedraft,action:Se.uk.delete},{entityCommand:i,entityOptions:{isBranded:e,workload:t,isEditing:n}})}launchGiphyConsent(e){return this.extensionCommanding.executeCommand({type:Se.py.giphyconsent,action:Se.uk.view},{entityCommand:e})}launchLeaveChat(e,t){return this.extensionCommanding.executeCommand({type:Se.py.leavechat,action:Se.uk.delete},{entityCommand:e,entityOptions:t})}launchSendFeedback(e,t,n,i,a,o,r,s){return this.extensionCommanding.executeCommand({type:e,action:Se.uk.view},{entityCommand:t,entityOptions:{convId:n,serverMessageId:i,traceId:a,bizChatConversationId:o,endpoint:r,utteranceTimestamp:s}})}launchChatInviteConfirmation(e){return this.extensionCommanding.executeCommand({type:Se.py.chatInviteConfirmation,action:Se.uk.view},{entityCommand:e})}launchMaxPinnedChatsReached(e,t){return this.extensionCommanding.executeCommand({type:Se.py.pinnedchatsmaxreached,action:Se.uk.view},{entityCommand:t,entityOptions:{maxPinnedChats:e}})}launchUpdateGroupChatAvatar(e,t){return this.extensionCommanding.executeCommand({type:Se.py.updategroupchatavatar,action:Se.uk.view},{entityCommand:t,entityOptions:{threadId:e}})}launchTfwUpdateGroupChatAvatar(e,t,n){return this.extensionCommanding.executeCommand({type:Se.py.tfwupdategroupchatavatar,action:Se.uk.view},{entityCommand:n,entityOptions:{threadId:e,avatarUrl:t}})}launchRemoveChatUser(e,t,n){return this.extensionCommanding.executeCommand({type:Se.py.removechatuser,action:Se.uk.delete},{entityCommand:n,entityOptions:{userName:e,isRemoveTfwUserInTflChat:t}})}launchShareChatLink(e,t,n,i,a,o,r,s){return this.extensionCommanding.executeCommand({action:Se.uk.view,id:e,type:Se.py.sharechatlink},{entityCommand:s,entityOptions:{chatTitle:t,tenantId:n,hasError:i,sharedLink:a,cfet:o,panelType:r}})}launchChatError(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.chats,action:Se.uk.error},{entityCommand:t})}launchStreamCamera(e){return this.extensionCommanding.executeCommand({type:Se.py.streamcamera,action:Se.uk.default,id:e?.correlation.id},{entityCommand:e})}launchStreamCameraInChannels(e){return this.extensionCommanding.executeCommand({type:Se.py.streamcamerainchannels,action:Se.uk.default,id:e?.correlation.id},{entityCommand:e})}launchMaxPinnedMesssagesReachedDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.chatmaxmultiplepinnedmessages,action:Se.uk.view},{entityCommand:e})}launchStreamCameraInCommunities(e){return this.extensionCommanding.executeCommand({type:Se.py.streamcameraincommunities,action:Se.uk.default,id:e?.correlation.id},{entityCommand:e})}meetingRecapTab(e,t,n){return this.handleCommandWithChecks({entity:{type:n||Se.py.meetingrecaptab,action:Se.uk.view,id:e.threadId},command:t,entityOptions:e})}transcriptTab(e,t,n,i,a,o,r,s,l,c,d,u){return this.handleCommandWithChecks({entity:{type:Se.py.transcripttab,action:Se.uk.view,id:t},entityOptions:{conversationId:e,storageId:n,teamsCallId:i,meetingOrganizerId:a,meetingTenantId:o,eventId:r,isOdspTranscript:s,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u}})}launchReportConcern(e,t){return this.extensionCommanding.executeCommand({type:Se.py.reportConcern,action:Se.uk.create},{entityCommand:t,entityOptions:e})}launchForwardMessage(e,t){return this.extensionCommanding.executeCommand({type:Se.py.forwardMessage,action:Se.uk.create},{entityCommand:t,entityOptions:e})}launchReportConcernV2(e,t){return this.extensionCommanding.executeCommand({type:Se.py.reportConcernForTFW,action:Se.uk.create},{entityCommand:t,entityOptions:e})}launchReportConcernTY(e){return this.extensionCommanding.executeCommand({type:Se.py.reportConcern,action:Se.uk.info},{entityCommand:e})}launchReportConcernV2Confirmation(e){return this.extensionCommanding.executeCommand({type:Se.py.reportConcernForTFW,action:Se.uk.info},{entityCommand:e})}launchDlpDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.dlp,action:Se.uk.view},{entityCommand:t,entityOptions:e})}chatInfoPane(e,t,n){return this.handleCommandWithChecks({entity:{type:Se.py.chatsInfoView,action:Se.uk.info,id:e},command:t,entityOptions:n})}extensibilityAppPickerSidePanel(e,t){return this.handleCommandWithChecks({entity:{type:Se.py.extensibilityapppickersidepanel,action:Se.uk.info,id:e},command:t})}chatContextualSearch(e,t,n){return this.handleCommandWithChecks({entity:{type:Se.py.chatContextualSearch,action:Se.uk.info,id:e},command:t,entityOptions:n})}chatCopilotSynthesis(e,t){return this.handleCommandWithChecks({entity:{type:Se.py.chatcopilotsynthesis,action:Se.uk.info,id:e},command:t})}chatHighlightsDetails(e,t,n){return this.handleCommandWithChecks({entity:{type:Se.py.chatHighlightsDetails,action:Se.uk.info,id:e},command:t,entityOptions:n})}chatFluidThread(e,t){return this.handleCommandWithChecks({entity:{type:Se.py.chatfluidthread,action:Se.uk.info,id:e},command:t})}manage(e,t){return this.handleCommandWithChecks({entity:{type:Se.py.chatManageApps,action:Se.uk.manage,id:e,linkedEntity:{type:Se.py.chats,id:e}},command:t})}chatInfoPaneDetails(e,t,n,i){return this.handleCommandWithChecks({entity:{type:i||Se.py.chatsInfo,action:Se.uk.infoDetails,id:e},command:t,entityOptions:n})}launchBlockChatDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.blockChat,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchMultiStepAcceptChatDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.multiStepAcceptChat,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchLeaveGroupAndBlockUserDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.leaveGroupAndBlockUser,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchCustomizeReactions(e){return this.extensionCommanding.executeCommand({type:Se.py.customizereactions,action:Se.uk.view},{entityCommand:e})}launchCustomEmojiUpload(e,t){return this.extensionCommanding.executeCommand({type:Se.py.customemojiupload,action:Se.uk.view},{entityCommand:t,entityOptions:{blobUrl:e}})}handleCommandWithChecks(e){return this.checkPolicies(e),this.commandHandler(e)}checkPolicies(e){if(this.coreSettings.get(b.J.Messaging).allowUserChat||e.entity.id?.startsWith("19:meeting"))return;const{type:t,action:n}=e.entity,i=`${h.w5.Commanding}::${h.jK.PolicyCheckFailed}::Chat command not allowed due to policy (allowUserChat=false)`;this._logger.errorToTelemetry?.(i,"messaging_command_policy_violation",{mainEntityType:t,mainEntityAction:n})}getByodChatByIdCommand(e,t,n){const i={entity:{type:Se.py.byodchat,action:Se.uk.view,id:e,linkedEntity:{type:Se.py.byodattendeewindow,id:n||""}},entityOptions:t?.entityOptions,command:t?.entityCommand,scenarioEventData:t?.scenarioEventData};return this.checkPolicies(i),i}}class Di{constructor(e){this.commandHandler=e}coachReport(e,t){return this.commandHandler({entity:{type:Se.py.coachreport,action:Se.uk.view,linkedEntity:{type:Se.py.chats,id:t?t.threadId:""}},command:e,entityOptions:t})}}class Pi{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}showAddMemberDialog(e,t,n){const i=n??{};return this.commandHandler({entity:{id:e,type:Se.py.communitiesaddmember,action:Se.uk.view},entityOptions:{...i,source:t?.correlation?.source},command:t})}showCreateChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:Se.py.communitiescreatechannel,action:Se.uk.view},entityOptions:{},command:t})}showEditChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:Se.py.communitieseditchannel,action:Se.uk.view},entityOptions:{},command:t})}showDeleteChannelDialog(e,t){return this.commandHandler({entity:{id:e,type:Se.py.communitiesdeletechannel,action:Se.uk.view},entityOptions:{},command:t})}showCommunityLinkDialog(e,t,n){const i=n??{};return this.commandHandler({entity:{action:Se.uk.view,id:e,type:Se.py.sharecommunitieslink},entityOptions:{...i,source:t?.correlation?.source},command:t})}showEmbedCommunityCodeDialog(e,t){return this.commandHandler({entity:{action:Se.uk.view,id:e,type:Se.py.embedcommunitycodedialog},entityOptions:{},command:t})}showCommunityGuidelinesDialog(e,t){return this.commandHandler({entity:{action:Se.uk.view,id:e,type:Se.py.communitiesguidelinesdialog},entityOptions:{},command:t})}showCommunityGetAppDialog(e){return this.commandHandler({entity:{action:Se.uk.view,type:Se.py.communitiesgetappdialog},entityOptions:{},command:e})}showCommunitiesCreateDialog(e,t){return this.commandHandler({entity:{action:Se.uk.view,type:Se.py.communitiescreatedialog},entityOptions:{templateId:t},command:e})}showCommunitiesEditDialog(e,t){return this.commandHandler({entity:{action:Se.uk.view,type:Se.py.communitieseditdialog,id:e},entityOptions:{},command:t})}showReportConcernDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.reportconcerncommunities,action:Se.uk.create},{entityCommand:t})}showRemoveMemberDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.communitiesremovemember,action:Se.uk.view},{entityOptions:{...t},entityCommand:n})}showNicknameDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.communitiesnickname,action:Se.uk.view},{entityOptions:{...t},entityCommand:n})}showReportConcernTY(e,t){return this.commandHandler({entity:{type:Se.py.reportconcerncommunities,action:Se.uk.view,id:e},entityOptions:{},command:t})}showSendPostAsEmailDialog(e,t){return this.commandHandler({entity:{type:Se.py.communitiessendpostasemaildialog,action:Se.uk.view,id:e},entityOptions:{},command:t})}showWelcomeBotConfigDialog(e,t){return this.commandHandler({entity:{type:Se.py.communitieswelcomebotconfigdialog,action:Se.uk.view,id:e},entityOptions:{},command:t})}showLeaveCommunityDialog(e,t){return this.commandHandler({entity:{id:e,type:Se.py.leavecommunity,action:Se.uk.view},entityOptions:{},command:t})}showOwnerLeaveCommunityDialog(e,t){return this.commandHandler({entity:{id:e,type:Se.py.ownerleavecommunity,action:Se.uk.view},entityOptions:{},command:t})}openDialog(e,t,n,i){return this.commandHandler({entity:{id:t,type:e,action:i??Se.uk.view},entityOptions:{},command:n})}communityMessagesById(e,t,n,i,a,o,r){const s={channelId:e,replyChainId:t};return localStorage.setItem("communities-selected-id",e),localStorage.setItem("communities-selected-reply-id",t||""),this.commandHandler({entity:{type:Se.py.communities,action:r??Se.uk.view,id:JSON.stringify(s)},command:i,entityOptions:{...a,source:i?.correlation.source,deepLinkId:n},scenarioEventData:o?.scenarioEventData})}getCommunityEvents(e,t){return this.commandHandler({entity:{type:Se.py.communitiesevents,action:Se.uk.view,id:JSON.stringify({channelId:e})},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.CommunitiesEventsButton},...t}})}showCreateCommunityEvent(e){const t={stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.CommunitiesCreateEventButton}};return this.commandHandler({entity:{type:Se.py.communitiescreateevent,action:Se.uk.view,id:JSON.stringify({channelId:e})},command:t,entityOptions:{isGroup:!0,conversationId:e}})}getOnboardingView(e,t,n){return this.getView(Se.py.communitiesonboarding,e??Se.uk.view,t,C.D.CommunitiesOnboarding,n)}getCommunitiesJoinView(e,t,n,i,a){const o={channelId:e,replyChainId:t},r=e?JSON.stringify(o):void 0;return this.commandHandler({entity:{type:i??Se.py.communities,action:Se.uk.join,id:r},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:a||C.D.CommunitiesInviteLink}},entityOptions:{messageId:t,inviteLinkUrl:n,source:a}})}navigateToCommunityId(e,t,n,i,a){const o={stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:n||C.D.Unknown}};return this.communityMessagesById(e,i,void 0,o,a?{enqueSwitch:!0}:void 0,void 0,t?Se.uk.default:void 0)}showCommunitiesManage(e,t,n,i){localStorage.setItem("current-enitity-type",Se.py.communitiesmembers);const a=n?.source||t?.correlation?.source||C.D.CommunitiesManage;return this.commandHandler({entity:{type:Se.py.communitiesmembers,action:Se.uk.view,id:e},entityOptions:{...n,source:a},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:a},...t},scenarioEventData:i?.scenarioEventData})}showCommunitiesBlockMembers(e,t){return this.commandHandler({entity:{type:Se.py.communitiesblockmembers,action:Se.uk.view,id:e},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:t?.correlation?.source||C.D.CommunitiesManage},...t}})}showCommunitiesSettings(e,t){return localStorage.setItem("current-enitity-type",Se.py.communitiessettings),this.commandHandler({entity:{type:Se.py.communitiessettings,action:Se.uk.view,id:e},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.CommunitiesManageLink},...t}})}showCommunitiesManageMemberRequests(e,t,n,i){const a=n?.source||t?.correlation?.source||C.D.CommunitiesManage;return this.commandHandler({entity:{type:Se.py.communitiesjoinrequest,action:Se.uk.view,id:e},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:a},...t},entityOptions:{...n,source:a},scenarioEventData:i?.scenarioEventData})}showCommunityJoinView(e,t,n,i,a){return this.commandHandler({entity:{type:Se.py.communitiesjoininviteview,action:Se.uk.join,id:e},command:t,entityOptions:{...n,activityId:a},scenarioEventData:i?.scenarioEventData})}showPerCommunityNotificationSettingsDialog(e,t){return this.commandHandler({entity:{action:Se.uk.view,id:e,type:Se.py.percommunitynotificationsettingsdialog},entityOptions:{},command:t})}showCommunityDeleteReplyChainDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.communitiesreplychain,action:Se.uk.delete},{entityOptions:{...e},entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.CommunitiesDeleteReplyChainDialogButton}}})}toggleCommunitiesCopilotView(e,t,n){return this.commandHandler({entity:{type:n,action:Se.uk.info,id:e,linkedEntity:{id:e,type:Se.py.communities}},command:t,entityOptions:{source:C.D.CommunitiesCopilot}})}showCommunitiesGallery(e,t){return this.commandHandler({entity:{type:Se.py.communitiesgallery,action:Se.uk.view,id:e},command:t})}showFeatureCommunityApplicationDialog(e,t){const n=t?.correlation?.source||C.D.FeatureCommunityApplicationButton;return this.commandHandler({entity:{action:Se.uk.view,id:e,type:Se.py.featurecommunityapplicationdialog},entityOptions:{source:n},command:t})}showCommunitiesExplore(e){return localStorage.setItem("current-enitity-type",Se.py.communitiesexplore),this.commandHandler({entity:{type:Se.py.communitiesexplore,action:Se.uk.view},command:e})}getView(e,t,n,i,a,o){const r={channelId:o,replyChainId:a},s=o?JSON.stringify(r):void 0;return this.commandHandler({entity:{id:s,type:e,action:t??Se.uk.default},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:i||C.D.ChannelListItem}},...t===Se.uk.join||t===Se.uk.update?{entityOptions:{inviteLinkUrl:n,messageId:a}}:{}})}}class Mi{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}openContactsSyncPopout(e){return this.commandHandler({entity:{type:Se.py.contactssync,action:Se.uk.default,id:"default"},command:e?.entityCommand||{stateTransition:ke.su.new,visibilityState:ke.fe.show,correlation:{source:C.D.Flyout}},windowOptions:e?.windowOptions})}openContactsSyncModal(){return this.extensionCommanding.executeCommand({type:Se.py.contactssync,action:Se.uk.view,id:"default"})}launchContactsModal(e,t){return this.extensionCommanding.executeCommand({type:Se.py.contactssync,action:Se.uk.info,id:e},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:t}})}showHideContactsView(e,t,n){return this.commandHandler({entity:{type:Se.py.contactssync,action:Se.uk.view,id:e},command:{stateTransition:ke.su.flush,visibilityState:n?ke.fe.show:ke.fe.hide,correlation:t}})}}class xi{constructor(e){this.commandHandler=e}discoverApps(e,t){return this.commandHandler({entity:{type:Se.py.discoverappsnotifications,action:Se.uk.view},command:t,entityOptions:e})}}class Ri{constructor(e,t){this.commandHandler=e,this.loggerFactory=t,this.logger=this.loggerFactory.newLogger("DiscoverSurfaceCommandingService","core-services-entity-commanding")}showDiscoverSurface(e){return this.logger.log(`showDiscoverSurface: called with - ${Se.py.discoversurface}:${Se.uk.view}`),this.commandHandler({entity:{type:Se.py.discoversurface,action:Se.uk.view},command:e?.entityCommand,entityOptions:e?.entityOptions})}showDiscoverSurfaceSettings(e){return this.logger.log(`showDiscoverSurfaceSettings: called with - ${Se.py.discoversurface}:${Se.uk.view}`),this.commandHandler({entity:{type:Se.py.discoversurfacesettings,action:Se.uk.view},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:e?.commandSource??C.D.DiscoverSurfaceHeader}},entityOptions:e?.entityOptions})}}class ji{constructor(e){this.commandHandler=e}launchErrorApp(e){return this.commandHandler({entity:{type:Se.py.error,action:Se.uk.view},command:{stateTransition:ke.su.forceFlush,visibilityState:ke.fe.show,correlation:{source:C.D.LayoutError}},entityOptions:{errorReason:e.code}})}}class Li{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t,this.entityAllowList=[Se.py.esp,Se.py.help,Se.py.storefre,Se.py.whatsnewdialog]}displaySurface(e,t,n){return this.commandHandler({entity:{type:Se.py.esp,action:Se.uk.create,id:e},entityOptions:{forceShow:t,customParams:n}})}displayFollowUpSurface(e,t){return this.commandHandler({entity:{type:Se.py.esp,action:Se.uk.create,id:e},entityOptions:{forceShow:t,espTrigger:"FollowUp"}})}launchDialog(e,t){let n=Se.py.esp;if(t){if(!this.entityAllowList.includes(t))throw new Error("launchDialog must be called with Entity from the allow list.");n=t}return this.extensionCommanding.executeCommand({id:e,type:n,action:Se.uk.view})}closeDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:t??Se.py.esp,action:Se.uk.view},{entityCommand:{visibilityState:ke.fe.hide,stateTransition:ke.su.extend,correlation:{source:C.D.ExtensionCommanding}}})}navigate(e,t,n){return this.commandHandler({entity:e,command:t,entityOptions:n})}}class Oi{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}surveyDialogWithObserver(e,t,n){const i={...n,source:t?.correlation?.source,entityStateTransition:t?.stateTransition};return this.extensionCommanding.executeCommand({action:Se.uk.view,type:Se.py.survey,id:e},{entityCommand:t,entityOptions:i})}surveyDialog(e,t,n){const i={...n,source:t?.correlation?.source,entityStateTransition:t?.stateTransition};return this.commandHandler({entity:{type:Se.py.survey,action:Se.uk.view,id:e},command:t,entityOptions:i})}giveFeedbackDialog(e){return this.commandHandler({entity:{type:Se.py.givefeedbackchoices,action:Se.uk.view},command:e})}}class $i{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}galleryImage(e,t){const n=e.galleryId,i={type:Se.py.galleryImages,action:Se.uk.view,id:n};return this.commandHandler({entity:i,command:t,entityOptions:e})}galleryImageExtended(e,t){const n=e.galleryId,i={type:Se.py.galleryImages,action:Se.uk.view,id:n};return this.extensionCommanding.executeCommand(i,{entityCommand:t,entityOptions:e})}fileById(e){const t=e.fileId;return this.commandHandler({entity:{type:Se.py.file,action:Se.uk.view,id:t},entityOptions:e})}launchFileViewApp(e,t,n=C.D.FileViewer){const i={subEntityId:JSON.stringify(t)};return this.commandHandler({entity:{type:Se.py.extensions,action:Se.uk.view,id:JSON.stringify({appId:e,fileId:t.fileId.toLowerCase()}),linkedEntity:{id:JSON.stringify(i),type:Se.py.extensions}},command:{visibilityState:ke.fe.show,stateTransition:t.shouldOpenInMultiWindow?ke.su.new:ke.su.flush,correlation:{source:n}},entityOptions:{entryPoint:"personalApp"}})}openInOneup(e,t=C.D.FileViewer){const n=e.fileId;let i,a;switch(e.context){case"channelsPDFTab":{const t={channelId:e.threadId,replyChainId:void 0};a={type:Se.py.filesoneupviewer,action:Se.uk.view,id:e.entityId,linkedEntity:{id:JSON.stringify(t),type:Se.py.channels}},i=C.D.ChannelHeader;break}case"chatPDFTab":a={type:Se.py.filesoneupviewer,action:Se.uk.view,id:e.entityId,linkedEntity:{id:e.threadId?e.threadId:"",type:Se.py.chats}},i=C.D.ChatHeader;break;case"ChannelMakeAsATab":{const t={channelId:e.threadId,replyChainId:void 0};a={type:Se.py.extensions,action:Se.uk.view,id:e.entityId,linkedEntity:{id:JSON.stringify(t),type:Se.py.channels}},i=C.D.ChannelHeader;break}default:a={type:Se.py.filesoneupviewer,action:Se.uk.view,id:n},i=t}return this.commandHandler({entity:a,command:{visibilityState:ke.fe.show,stateTransition:e.shouldOpenInMultiWindow?ke.su.new:ke.su.flush,correlation:{id:(0,Re.v4)(),source:i}},entityOptions:e})}closeOneup(e,t=C.D.FileViewer){return this.commandHandler({entity:{type:Se.py.filesoneupviewer,action:Se.uk.view,id:e},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,correlation:{source:t}}})}fileOpenSettingsSuggestion(e){return this.commandHandler({entity:{type:Se.py.fileopensettings,action:Se.uk.info},entityOptions:e})}fileOpenSettingsUpdate(e){return this.commandHandler({entity:{type:Se.py.fileopensettings,action:Se.uk.update},entityOptions:e})}fileOpenSettingsUpdateV2(e,t){return this.commandHandler({entity:{type:Se.py.fileopensettings,action:Se.uk.update},entityOptions:e,command:t})}chatFilesList(e,t){return this.commandHandler({entity:{id:null,type:Se.py.file,action:Se.uk.list,linkedEntity:{type:Se.py.chats,id:e}},command:t})}photosList(e,t){return this.commandHandler({entity:{id:null,type:Se.py.gallery,action:Se.uk.view,linkedEntity:{type:Se.py.chats,id:e}},command:t})}launchFilePicker(e,t,n,i){return this.extensionCommanding.executeCommand({type:Se.py.filepicker,action:Se.uk.view},{entityCommand:n,entityOptions:{fileContainerKey:e,filePickerContext:t,filePickerConfigurationOverrides:i}})}launchCloudStorageDialog(e,t,n){return this.extensionCommanding.executeCommand({type:Se.py.cloudStorageDialog,action:Se.uk.view},{entityCommand:n,entityOptions:{isClassMaterialRequired:e,channelId:t}})}}class Ui{constructor(e){this.commandHandler=e}launchFlyoutHomePage(){const e={id:(0,Re.v4)(),source:C.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:Se.py.flyout,action:Se.uk.default},command:{correlation:e,stateTransition:ke.su.flush,visibilityState:ke.fe.show,layoutMode:ke.lO.minimal}})}showPhonelinkPairingPage(e){const t={id:(0,Re.v4)(),source:C.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{id:e,type:Se.py.flyoutphonelink,action:Se.uk.default},command:{correlation:t,stateTransition:ke.su.flush,visibilityState:ke.fe.show,layoutMode:ke.lO.minimal}})}showFlyoutWhatsNew(){const e={id:(0,Re.v4)(),source:C.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:Se.py.flyoutwhatsnew,action:Se.uk.default},command:{correlation:e,stateTransition:ke.su.flush,visibilityState:ke.fe.show,layoutMode:ke.lO.minimal}})}openMinimodeMeetingScheduler(){const e={id:(0,Re.v4)(),source:C.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:Se.py.minimodeMeetingScheduler,action:Se.uk.view},command:{correlation:e,stateTransition:ke.su.new,visibilityState:ke.fe.show}})}closeMinimodeMeetingScheduler(){const e={id:(0,Re.v4)(),source:C.D.Flyout,startTimestamp:Date.now()};return this.commandHandler({entity:{type:Se.py.minimodeMeetingScheduler,action:Se.uk.view},command:{correlation:e,visibilityState:ke.fe.hide,stateTransition:ke.su.forceFlush}})}}class Bi{constructor(e){this.commandHandler=e}async freemiumUpgrade(e,t){return this.commandHandler({entity:{type:Se.py.freemiumupgrade,action:Se.uk.view},command:e,entityOptions:t})}}class Wi{constructor(e,t){this.extensionCommanding=e,this.commandHandler=t}guardiansTabInChannelById(e,t,n,i){const a={type:Se.py.guardians,action:Se.uk.list,id:e,linkedEntity:n};return this.commandHandler({entity:a,command:t,entityOptions:i})}showGuardiansApprovalRequestDialog(e,t){const n={type:Se.py.guardiansapprovalrequest,action:Se.uk.create};return this.commandHandler({entity:n,command:e,entityOptions:t})}showSendApprovalSuccessDialog(e){const t={type:Se.py.guardianssendapprovalsuccess,action:Se.uk.create};return this.extensionCommanding.executeCommand(t,{entityCommand:e})}showSendApprovalErrorDialog(e,t){const n={type:Se.py.guardianssendapprovalerror,action:Se.uk.create};return this.extensionCommanding.executeCommand(n,{entityCommand:e,entityOptions:t})}}class Hi{constructor(e){this.commandHandler=e}launchTflHomepage(){const e={id:(0,Re.v4)(),source:C.D.Homepage,startTimestamp:Date.now()};return this.commandHandler({entity:{type:Se.py.homepage,action:Se.uk.default},command:{correlation:e,stateTransition:ke.su.flush,visibilityState:ke.fe.show}})}}class Vi{constructor(e){this.extensionCommanding=e}showCreatePostDialog(e,t,n,i){return this.extensionCommanding.executeCommand({type:Se.py.classesintegrationcontent,action:Se.uk.create},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.LmsCourseTeams}},entityOptions:{teamId:e,teamName:t,groupId:n,tenantId:i}})}}class Gi{constructor(e){this.commandHandler=e}viewLobNotifications(e,t){return this.commandHandler({entity:{type:Se.py.lobnotifications,action:Se.uk.view},command:t,entityOptions:e})}}class zi{constructor(e){this.commandHandler=e}analytics(e,t){return this.commandHandler({entity:{type:Se.py.meetinganalytics,action:Se.uk.view},command:e,entityOptions:t})}openAttendanceTabInSchedulingForm(e,t,n="",i=0){return this.commandHandler({entity:{type:Se.py.attendancereport,action:Se.uk.view,linkedEntity:{type:Se.py.schedulingform,action:Se.uk.view,id:JSON.stringify({eventId:(0,_i.cW)(n),providerType:i})}},command:e,entityOptions:{...t,eventId:(0,_i.cW)(n)}})}openAnalyticsInSchedulingForm(e,t,n="",i=0){return this.commandHandler({entity:{type:Se.py.meetinganalytics,action:Se.uk.view,linkedEntity:{type:Se.py.schedulingform,action:Se.uk.view,id:JSON.stringify({eventId:(0,_i.cW)(n),providerType:i,tabId:"Attendance",key:(0,Re.v4)()})}},command:e,entityOptions:{...t,eventId:(0,_i.cW)(n)}})}openAttendanceTabInMeetingChat(e,t){return this.commandHandler({entity:{type:Se.py.meetinganalytics,action:Se.uk.view},command:e,entityOptions:{threadId:t,subType:"meetingchat"}})}openAttendanceTabInMeetingRecapOfChat(e,t){return this.commandHandler({entity:{type:Se.py.meetinganalytics,action:Se.uk.view,linkedEntity:{type:Se.py.chats,action:Se.uk.view,id:t?.threadId||""}},command:e,entityOptions:t})}}class qi{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}meetingOptionsFormView(e,t,n,i,a,o){return this.commandHandler({entity:{type:Se.py.meetings,action:Se.uk.view,id:this.serializeMeetingCoordinates(e,t,n,i,a)},command:o})}meetingOptionsCreateViewDialog(e,t,n){const i={type:Se.py.meetingoptionscreatedialog,id:e.id,action:e.action};return this.extensionCommanding.executeCommand(i,{entityCommand:t,entityOptions:n})}serializeMeetingCoordinates(e,t,n,i,a){return JSON.stringify({tenantId:e,organizerId:t,threadId:n,messageId:i,additionalMessageId:a})}}class Ji{constructor(e){this.commandHandler=e}recapTabInMeetingChat(e,t,n){return this.commandHandler({entity:{type:Se.py.meetingrecap,action:Se.uk.view,linkedEntity:n?{type:Se.py.chats,action:Se.uk.view,id:t?.threadId||""}:null},command:e,entityOptions:t})}recapTabInSchedulingForm(e,t,n){return this.commandHandler({entity:{type:Se.py.meetingrecap,action:Se.uk.view,linkedEntity:{type:Se.py.schedulingform,action:Se.uk.view,id:JSON.stringify({eventId:(0,_i.cW)(t?.externalEntityKey||""),providerType:n,tabId:"Recap",key:(0,Re.v4)()})}},command:e,entityOptions:t})}popOutMeetingRecap(e,t){const n={id:(0,Re.v4)(),source:t||C.D.Unknown,startTimestamp:Date.now()},{externalEntityKey:i,threadId:a}=e||{};return this.commandHandler({entity:{type:Se.py.meetingrecap,action:Se.uk.view,id:i||a},command:{stateTransition:ke.su.new,visibilityState:ke.fe.show,correlation:n},entityOptions:{...e,openType:"popout"}})}recapPageInChannel(e,t){const{externalEntityKey:n,threadId:i}=t||{};return this.commandHandler({entity:{type:Se.py.meetingrecap,action:Se.uk.view,id:n||i},command:e,entityOptions:t})}}var Qi;!function(e){e.JoinByCode="JoinByCode",e.Dialpad="Dialpad",e.Cortana="Cortana",e.SmartDeviceJoinByCode="SmartDeviceJoinByCode"}(Qi||(Qi={}));class Ki{constructor(e){this.commandHandler=e}meetingRoomConsoleInCallById(e,t,n,i){return this.commandHandler({entity:{type:e,action:Se.uk.view,id:t},entityOptions:n,command:i})}meetingRoomNewCall(e){return this.commandHandler({entity:{type:e,action:Se.uk.create},entityOptions:{stateParams:{isPstnCall:!0},createCallType:Qi.Dialpad},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.Calling}}})}meetingRoomBroadcast(e,t,n){return this.commandHandler({entity:{type:e,action:Se.uk.share},entityOptions:n,command:t})}meetingRoomSmartDeviceJoinByCode(e){return this.commandHandler({entity:{type:Se.py.meetingroomconsolecall,action:Se.uk.create},entityOptions:{createCallType:Qi.SmartDeviceJoinByCode},command:e})}meetingRoomJoinByCode(e,t,n){return this.commandHandler({entity:{type:e,action:Se.uk.create},entityOptions:{stateParams:n?.stateParams,createCallType:Qi.JoinByCode},command:t})}meetingRoomHome(e,t){return this.commandHandler({entity:{type:e,action:Se.uk.list},entityOptions:{},command:t})}meetingRoomPostCall(e,t,n){return this.commandHandler({entity:{type:e,action:Se.uk.health},entityOptions:n,command:t})}meetingRoomFrontOfRoom(e,t,n){return this.commandHandler({entity:{id:e,type:t,action:Se.uk.create},command:n})}}class Yi{constructor(e){this.commandHandler=e}viewOnboardingNotifications(e,t){return this.commandHandler({entity:{type:Se.py.onboardingnotifications,action:Se.uk.view},command:t,entityOptions:e})}}var Xi=n(233304);class Zi{constructor(e,t,n){this.commandHandler=e,this.extensionCommanding=t,this.coreSettings=n}launchTaskModule(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.taskmodule,action:Se.uk.create},{entityCommand:n,entityOptions:t?.taskModuleOptions})}launchHWCTaskModule(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.hwctaskmodule,action:Se.uk.create},{entityCommand:n,entityOptions:t?.taskModuleOptions})}launchStage(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({type:Se.py.platformStage,action:Se.uk.view},{entityCommand:t,entityOptions:e?.stageOptions})}launchReactStageModal(e,t,n){const i=n||this.getDefaultExtensionCommand();return this.extensionCommanding.executeCommand({id:e,type:Se.py.platformstagemodal,action:Se.uk.view},{entityCommand:i,entityOptions:t})}launchStageMW(e){return this.commandHandler({entity:{id:e.id,type:Se.py.platformStage,action:Se.uk.create,linkedEntity:e.linkedEntity},command:{stateTransition:ke.su.new,visibilityState:ke.fe.show,correlation:{source:e.commandSource||C.D.PlatformExtension,startTimestamp:e.stageOptions.scenarioStartTime}},entityOptions:e.stageOptions})}launchStageMWWithoutChat(e){const t=void 0===e.stageOptions.reloadToggle?ke.su.new:ke.su.flush;return this.commandHandler({entity:{id:e.id,type:Se.py.platformstagewithoutchat,action:Se.uk.view},command:{stateTransition:t,visibilityState:ke.fe.show,correlation:{source:e.commandSource||C.D.PlatformExtension,startTimestamp:e.stageOptions.scenarioStartTime}},entityOptions:e.stageOptions})}launchAppEnableDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.enableappdialog,action:Se.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchTabGallery(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({type:Se.py.platformTabGallery,action:Se.uk.view},{entityCommand:t,entityOptions:e?.tabGalleryOptions})}launchUnsupportedDeeplinkDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.unsupporteddeeplinkdialog,action:Se.uk.view},{entityOptions:{originalDeeplink:e}})}launchAppDetails(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.platformapp,action:Se.uk.create},{entityCommand:n,entityOptions:t?.platformAppDetailsOptions})}launchAppDetailsTutorial(e){return this.extensionCommanding.executeCommand({type:Se.py.platformappdetails,action:Se.uk.info},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchAppRevokeConsent(e){return this.extensionCommanding.executeCommand({type:Se.py.platformappconsent,action:Se.uk.delete},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}appDetailsPostInstall(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=ke.su.none,this.commandHandler({entity:{type:Se.py.platformappdetails,action:Se.uk.config},command:t,entityOptions:e})}appDetailsPostInstallV2(e){return this.extensionCommanding.executeCommand({type:Se.py.platformappdetails,action:Se.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}appDetailsOnDone(e,t){const n=this.getDefaultExtensionCommand();return n.stateTransition=ke.su.none,this.commandHandler({entity:{id:e,type:Se.py.platformappdetails,action:Se.uk.update},command:n,entityOptions:t})}launchInContextStore(e){return this.extensionCommanding.executeCommand({type:Se.py.incontextstore,action:Se.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}inContextStorePostInstall(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=ke.su.none,this.commandHandler({entity:{type:Se.py.incontextstore,action:Se.uk.config},command:t,entityOptions:e})}inContextStoreOnDone(e,t){const n=this.getDefaultExtensionCommand();return n.stateTransition=ke.su.none,this.commandHandler({entity:{id:e,type:Se.py.incontextstore,action:Se.uk.update},command:n,entityOptions:t})}launchAppStore(e,t){return this.commandHandler({entity:{type:Se.py.platformapps,action:Se.uk.list},command:t,entityOptions:e})}launchPersonalApp(e){const t=this.getDefaultExtensionCommand();return t.stateTransition=ke.su.none,this.commandHandler({entity:{type:Se.py.platformapp,action:Se.uk.view},command:t,entityOptions:e})}launchAppUninstall(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.platformapp,action:Se.uk.delete},{entityCommand:n,entityOptions:t?.uninstallOptions})}launchAppError(e){return this.extensionCommanding.executeCommand({type:Se.py.platformapp,action:Se.uk.error},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchContextlessConfigDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.platformapp,action:Se.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchManifestParsingErrorDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.customapp,action:Se.uk.error},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchUploadCustomApp(){return this.extensionCommanding.executeCommand({type:Se.py.customapp,action:Se.uk.view},{entityCommand:this.getDefaultExtensionCommand()})}launchRequestSubmittedDialog(){return this.extensionCommanding.executeCommand({type:Se.py.customapp,action:Se.uk.info},{entityCommand:this.getDefaultExtensionCommand()})}launchLocationDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.locationapi,action:Se.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchSelectMediaDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.selectMediaApi,action:Se.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchViewImagesDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.viewImagesApi,action:Se.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchSelectPeoplePickerDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.selectpeoplepicker,action:Se.uk.view},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:e})}launchAppRatingCoachmark(e){return this.extensionCommanding.executeCommand({type:Se.py.platformappratingcoachmark,action:Se.uk.view},{entityCommand:e??this.getDefaultExtensionCommand()})}launchAppConfig(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.platformapp,action:Se.uk.config},{entityCommand:n,entityOptions:t?.launchAppConfigOptions})}launchTabInfo(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.platformtab,action:Se.uk.info},{entityCommand:n,entityOptions:t?.launchTabInfoOptions})}launchStagedApps(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({type:Se.py.stagedapps,action:Se.uk.info},{entityCommand:t,entityOptions:e?.launchStagedAppsOptions})}launchAppAuthConsent(e,t){const n=t?.entityCommand||this.getDefaultExtensionCommand();return n.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.platformauthconsentdialog,action:Se.uk.create},{entityCommand:n,entityOptions:t?.launchAuthConsentOptions})}platformPersonalAppvia3PUX(e,t){return this.commandHandler({entity:e,command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Platform3PCookiesUX,startTimestamp:Date.now()}},entityOptions:t})}platformTabById(e,t,n,i){return this.commandHandler({entity:{id:e,type:Se.py.extensions,action:Se.uk.view,linkedEntity:n},command:t,entityOptions:i})}launchPersonalPlatformApp(e,t,n,i,a){return this.commandHandler({entity:{id:JSON.stringify({appId:e,tabEntityId:n}),type:Se.py.extensions,action:Se.uk.view,linkedEntity:a},command:{visibilityState:ke.fe.show,stateTransition:t?ke.su.new:ke.su.flush,correlation:{source:i??C.D.AppBar,startTimestamp:Date.now()}},entityOptions:{isMultiWindow:t,entryPoint:Xi.mQ.personalApp}})}platformAppById(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.extensions,action:Se.uk.view,linkedEntity:n},command:t})}navigateToManageApps(e){return this.commandHandler({entity:{type:Se.py.platformapps,action:Se.uk.manage},entityOptions:e})}launchSubscriptionPlansDialog(e,t,n){const i=n||this.getDefaultExtensionCommand();return i.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.platformsubscriptionplans,action:Se.uk.info},{entityCommand:i,entityOptions:t})}launchAngularAppDetails(e,t,n){const{enableAppDetailsAngularFeatureParity:i}=this.coreSettings.get(b.J.Host);if(i)return this.launchAppDetails(e,{platformAppDetailsOptions:t,entityCommand:n});const a=n||this.getDefaultExtensionCommand();return a.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({id:e,type:Se.py.platformapp,action:Se.uk.info},{entityCommand:a,entityOptions:t})}launchCustomAppFilePicker(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.customapp,action:Se.uk.create},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:n||C.D.Store}},entityOptions:t})}launchWorkflowsDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.workflows,action:Se.uk.create},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:n||C.D.Store}},entityOptions:t})}launchWorkflowSelectionDialog(e,t,n,i){let a=Se.py.chatworkflows;const o=Se.uk.view;switch(t){case C.D.ChatListItem:a=Se.py.chatworkflows;break;case C.D.ChannelListItem:a=Se.py.channelworkflows;break;case C.D.MessageExtensionFlyout:a=Se.py.messageextensionworkflows;break;case C.D.MessageAction:a=Se.py.messageactionworkflows}return this.extensionCommanding.executeCommand({id:e,type:a,action:o},{entityCommand:n,entityOptions:i})}launchManageWorkflows(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.workflows,action:Se.uk.manage},entityOptions:t,command:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{source:n||C.D.Store}}})}launchSettingsDialog(e,t,n){const i={visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:n||C.D.Card}};return this.extensionCommanding.executeCommand({id:e,type:Se.py.settingsdialog,action:Se.uk.view},{entityCommand:i,entityOptions:t})}updatePlatformTabById(e,t,n,i){return this.commandHandler({entity:{id:e,type:Se.py.extensions,action:Se.uk.update,linkedEntity:n},command:t,entityOptions:i})}videoEffectsCustomizationPanelById(e,t){return this.commandHandler({entity:{type:Se.py.videoeffectscustomization,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}videoEffectsMoreViewPanelById(e,t,n){return this.commandHandler({entity:{type:Se.py.videoeffectsmoreview,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t,entityOptions:n})}videoEffectsAndAvatarPanelById(e,t,n){return this.commandHandler({entity:{type:Se.py.videoeffectsandavatar,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t,entityOptions:n})}videoEffectsAndSettingsPanelById(e,t,n){return this.commandHandler({entity:{type:Se.py.videoeffectsandsettings,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t,entityOptions:n})}meshAvatarPanelById(e,t){return this.commandHandler({entity:{type:Se.py.meshavatar,action:Se.uk.view,linkedEntity:{type:Se.py.calls,id:e}},command:t})}launchManageAppsUninstall(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.manageapps,action:Se.uk.delete},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchManageAppsWebhook(e,t){const n=t.editMode?Se.uk.update:Se.uk.create;return this.extensionCommanding.executeCommand({id:e,type:Se.py.manageappswebhook,action:n},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchManageAppsWebhookConfirmation(e){const t={webhookToken:e};return this.extensionCommanding.executeCommand({type:Se.py.manageappswebhook,action:Se.uk.info},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}selectAppEntity(e){const t=e?.entityCommand||this.getDefaultExtensionCommand();return t.visibilityState=ke.fe.show,this.extensionCommanding.executeCommand({type:Se.py.platformTabGallery,action:Se.uk.create},{entityCommand:t,entityOptions:e?.selectAppEntityOptions})}launchAppDevicePermissions(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.platformappdevicepermissions,action:Se.uk.create},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchAppDevicePermissionsFirstRun(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.platformappdevicepermissions,action:Se.uk.update},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}launchRefreshConfirmationAfterAppDevicePermissionsUpdate(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.platformappdevicepermissions,action:Se.uk.confirm},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}hideExtension(e){return this.extensionCommanding.executeCommand(e,{entityCommand:{visibilityState:ke.fe.hide,stateTransition:ke.su.extend,correlation:{source:C.D.ExtensionCommanding}}})}getDefaultExtensionCommand(){return{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}}}}class ea{constructor(e,t){this.commandHandler=e,this.coreSettings=t}registration(e){const{enableMultiWindowWebinarRegistration:t}=this.coreSettings.get(b.J.WebinarRegistration);return t?this.commandHandler({entity:{action:Se.uk.view,id:e,type:Se.py.registration},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new,correlation:{source:C.D.Calendar}}}):((0,L.J)().open(`${(0,L.J)().location.origin}/registration/${e}?mode=edit`,"_blank"),Promise.resolve())}}class ta{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}showTeamsGrid(e){return this.commandHandler({entity:{type:Se.py.schoolteams,action:Se.uk.list},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.SchoolTeams}},entityOptions:{lastVisitedTeamId:e}})}gridTeamDiscover(){return this.commandHandler({entity:{type:Se.py.schoolteams,action:Se.uk.join},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.SchoolTeams}}})}showSingleTeam(e){return this.commandHandler({entity:{type:Se.py.channels,action:Se.uk.view,id:e},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.SchoolTeams}}})}showUnlockDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.schoolteams,action:Se.uk.update,id:e},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.UnlockTeam}}})}}class na{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t,this.updateSearchState=(e,t,n,i)=>{const a={type:Se.py.search,action:Se.uk.view};let o;const r=n?`${e?.searchQuery}${e?.currentTab?` | ${e?.currentTab}`:""}`:e?.searchQuery;return o=t?{...a}:i&&i.type===Se.py.search&&i.action===Se.uk.view?{...i,...n?{id:r}:{}}:{...a,id:r},this.commandHandler({entity:o,command:{correlation:{id:(0,Re.v4)(),startTimestamp:Date.now(),source:C.D.Search},stateTransition:n?ke.su.flush:ke.su.none,visibilityState:ke.fe.show},entityOptions:e})},this.updateSearchStateRW=(e,t,n)=>this.commandHandler({entity:{id:t||e&&e.searchQuery,type:Se.py.search,action:Se.uk.view},command:{correlation:{id:(0,Re.v4)(),startTimestamp:Date.now(),source:C.D.Search},stateTransition:n||ke.su.flush,visibilityState:ke.fe.show},entityOptions:e}),this.sendSearchStateToMetaOSSearchService=(e,t)=>this.commandHandler({entity:{id:JSON.stringify({appId:t}),type:Se.py.extensions,action:Se.uk.view},command:{correlation:{id:(0,Re.v4)(),startTimestamp:Date.now(),source:C.D.Search},stateTransition:ke.su.flush,visibilityState:ke.fe.show},entityOptions:e}),this.open3SFeedback=e=>this.commandHandler({entity:{type:Se.py.open3sfeedback,action:Se.uk.view},command:{correlation:{source:C.D.Search},stateTransition:ke.su.new,visibilityState:ke.fe.show},entityOptions:e}),this.exitSearchState=()=>this.commandHandler({entity:{type:Se.py.search,action:Se.uk.view,id:"search"},command:{correlation:{source:C.D.Search},stateTransition:ke.su.forceFlush,visibilityState:ke.fe.hide}})}openFeedback(e,t){return this.extensionCommanding.executeCommand({type:Se.py.openfeedbackdialog,action:Se.uk.view},{entityCommand:e,entityOptions:t})}launchReactHelpApp(e){this.commandHandler({entity:{type:Se.py.help,action:Se.uk.view},command:{correlation:{source:C.D.Search},stateTransition:ke.su.new,visibilityState:ke.fe.show},entityOptions:e})}}class ia{constructor(e){this.commandHandler=e}launch(e,t){return this.commandHandler({entity:{type:Se.py.settingsstore,action:Se.uk.default,id:t},command:e})}launchSection(e,t,n,i){return this.commandHandler({entity:{type:i??Se.py.settingsstore,action:Se.uk.view,id:e},command:t,entityOptions:{...n,commandSource:t?.correlation.source}})}}class aa{constructor(e){this.extensionCommanding=e}launchShareFormDialog(e,t){const n=t?.entityCommand||this.getDefaultCommand();return n.visibilityState=ke.fe.show,n.stateTransition=ke.su.extend,this.extensionCommanding.executeCommand({id:e,type:Se.py.shareformdialog,action:Se.uk.view},{entityCommand:n,entityOptions:t?.entityOptions})}getDefaultCommand(){return{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}}}}class oa{constructor(e){this.commandHandler=e}viewStore(e,t,n){return this.commandHandler({entity:{type:Se.py.store,action:Se.uk.view,id:e},command:n,entityOptions:t})}showStoreFre(e,t){return this.commandHandler({entity:{type:Se.py.storefre,action:Se.uk.view,id:t},command:{visibilityState:e?ke.fe.show:ke.fe.hide,stateTransition:ke.su.extend,correlation:{source:C.D.ExtensionCommanding}}})}viewManageAppsTab(e,t){return this.commandHandler({entity:{type:Se.py.store,action:Se.uk.manage},command:t,entityOptions:e})}}var ra,sa=n(438846);function la(e){return{id:e||"",type:Se.py.channels,action:Se.uk.list}}function ca(e,t=ke.su.flush){return{stateTransition:t,visibilityState:ke.fe.show,correlation:{source:e}}}!function(e){e.User="user",e.Team="team",e.TeamOwned="teamowned"}(ra||(ra={}));class da{constructor(e,t){this.commandHandler=e,this.extensionCommanding=t}editTeamPicture(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teampicture,action:Se.uk.view})}viewTeamJoinCode(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamjoincode,action:Se.uk.view},{entityOptions:{teamJoinCode:t}})}viewTeamRenewal(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamrenewal,action:Se.uk.view},{entityOptions:{expiryTime:t}})}editTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamedit,action:Se.uk.view},{entityOptions:t})}addMember(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.addmember,action:Se.uk.view})}addMemberToTeamDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.addmembertoteamdialog,action:Se.uk.view},{entityOptions:t})}addMemberToPrivateChannelDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.addmembertoprivatechanneldialog,action:Se.uk.view},{entityOptions:t})}shareChannelWithUserDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.sharechannelwithuserdialog,action:Se.uk.view},{entityOptions:t})}addMemberToNewTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.addmembernewteam,action:Se.uk.view},{entityOptions:t})}addChannel(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.addchannel,action:Se.uk.view})}createChannel(e){return this.extensionCommanding.executeCommand({type:Se.py.createchanneldialog,action:Se.uk.view},{entityOptions:e})}createChannelOnLeftRail(e){return this.extensionCommanding.executeCommand({type:Se.py.createchannelleftraildialog,action:Se.uk.view},{entityOptions:e})}manageApps(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.teammanageapps,action:Se.uk.view,linkedEntity:la(e)},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}manageTags(e,t,n,i){return this.commandHandler({entity:{id:e,type:Se.py.teammanagetags,action:Se.uk.view,linkedEntity:la(e)},entityOptions:{...i?.entityOptions,tagId:n},scenarioEventData:i?.scenarioEventData,command:i?.entityCommand||ca(t??C.D.ChannelListItem)})}leaveTeam(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamleave,action:Se.uk.view})}createTeam(){return this.extensionCommanding.executeCommand({type:Se.py.teamcreate,action:Se.uk.view})}archiveTeam(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamarchive,action:Se.uk.view})}restoreTeam(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamrestore,action:Se.uk.view})}launchConfirmPinUnpinPost(e,t){return this.extensionCommanding.executeCommand({type:Se.py.pinunpinpost,action:Se.uk.view},{entityCommand:t,entityOptions:e})}createTeamOnMainView(e,t){const n=e?.source||sa.IC.template;return this.commandHandler({entity:{id:n,type:Se.py.teams,action:Se.uk.create},entityOptions:e,command:ca(t??C.D.ChannelList)})}createTeamV2(){return this.extensionCommanding.executeCommand({type:Se.py.teamcreatedialog,action:Se.uk.view})}showListView(){return this.commandHandler({entity:{type:Se.py.channels,action:Se.uk.view},command:ca(C.D.SchoolTeams)})}teamDiscover(){return this.commandHandler({entity:{type:Se.py.teamdiscover,action:Se.uk.view},command:ca(C.D.ChannelListItem)})}manageTeam(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.teammanage,action:Se.uk.view,linkedEntity:la(e)},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}manageTeams(e){return this.commandHandler({entity:{type:Se.py.teams,action:Se.uk.config},command:ca(e)})}manageSharedChannelsPendingInvites(e,t,n){return this.commandHandler({entity:{id:n,type:Se.py.sharedchannelspendinginvites,action:Se.uk.view,linkedEntity:la(n)},command:t?.entityCommand||ca(e,ke.su.flow),scenarioEventData:t?.scenarioEventData,entityOptions:t?.entityOptions||{commandSource:e}})}manageTeamsList(e,t,n){return this.commandHandler({entity:{id:n,type:Se.py.teamslist,action:Se.uk.view,linkedEntity:la(n)},command:t?.entityCommand||ca(e,ke.su.flow),scenarioEventData:t?.scenarioEventData,entityOptions:t?.entityOptions||{commandSource:e}})}crossTeamAnalytics(e,t,n){return this.commandHandler({entity:{id:n,type:Se.py.crossteamanalytics,action:Se.uk.view,linkedEntity:la(n)},command:t?.entityCommand||ca(e),scenarioEventData:t?.scenarioEventData,entityOptions:t?.entityOptions})}acceptInvitation(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.sharedchannelacceptinvitation,action:Se.uk.view},{entityOptions:t})}declineInvitation(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.sharedchanneldeclineinvitation,action:Se.uk.view},{entityOptions:t})}teamDeepLink(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamdeeplink,action:Se.uk.view})}channelDeepLink(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channeldeeplink,action:Se.uk.view})}viewChannelEmail(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channelemail,action:Se.uk.view})}viewChannelEmailV2(e,t){return this.extensionCommanding.executeCommand({type:Se.py.channelemailv2,action:Se.uk.view},{entityCommand:t,entityOptions:e})}removeChannelEmail(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.removechannelemail,action:Se.uk.view},{entityCommand:t})}launchChannelEmailErrorDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.channelemailerror,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ChannelEmail}},entityOptions:{errorCode:e}})}manageChannelConnectors(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channelconnectors,action:Se.uk.view},{entityCommand:n,entityOptions:t})}connectorInstanceConfiguration(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.connectorinstanceconfiguration,action:Se.uk.view},{entityCommand:n,entityOptions:t})}deleteChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channeldelete,action:Se.uk.view},{entityOptions:t})}editChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channeledit,action:Se.uk.view},{entityOptions:t})}channelModerators(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channelmoderators,action:Se.uk.view})}manageChannel(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.channelmanage,action:Se.uk.view,linkedEntity:la(e)},entityOptions:{parentTeamId:t?.parentTeamId},command:ca(n||C.D.ChannelListItem)})}manageChannelApps(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.channelapps,action:Se.uk.view,linkedEntity:la(e)},entityOptions:{...n?.entityOptions,parentTeamId:n?.parentTeamId},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData})}manageChannelAnalytics(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.channelanalytics,action:Se.uk.view,linkedEntity:la(e)},entityOptions:{...n?.entityOptions,parentTeamId:n?.parentTeamId},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData})}manageChannelMembers(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.channelmembers,action:Se.uk.view,linkedEntity:la(e)},entityOptions:{...n?.entityOptions,parentTeamId:n?.parentTeamId},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData})}manageChannelSettings(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.channelsettings,action:Se.uk.view,linkedEntity:la(e)},entityOptions:{...n?.entityOptions,parentTeamId:n?.parentTeamId},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData})}manageChannelInvitations(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.channelinvitations,action:Se.uk.view},entityOptions:{...n?.entityOptions,parentTeamId:n?.parentTeamId},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData})}manageChannelTags(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.channeltags,action:Se.uk.view,linkedEntity:la(e)},entityOptions:{...n?.entityOptions,parentTeamId:n?.parentTeamId,tagId:n?.tagId},command:n?.entityCommand||ca(t??C.D.ChannelListItem),scenarioEventData:n?.scenarioEventData})}addChannelMember(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channelroster,action:Se.uk.manage})}leaveChannel(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channels,action:Se.uk.leave})}showHideGeneralChannel(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channels,action:Se.uk.confirm})}channelNotificationSettings(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channelnotificationsettings,action:Se.uk.view},{entityCommand:ca(t||C.D.ChannelListItem),entityOptions:{commandSource:t||C.D.ChannelListItem,teamName:n?.teamName,channelName:n?.channelName}})}shareChannelWithUser(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channels,action:Se.uk.share},{entityOptions:{shareWith:ra.User}})}shareChannelWithTeam(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channels,action:Se.uk.share},{entityOptions:{shareWith:ra.Team}})}shareChannelWithTeamOwned(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.channels,action:Se.uk.share},{entityOptions:{shareWith:ra.TeamOwned}})}manageTeamSettings(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.teamsettings,action:Se.uk.view,linkedEntity:la(e)},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}manageTeamAnalytics(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.teamanalytics,action:Se.uk.view,linkedEntity:la(e)},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}manageTeamChannels(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.teamchannels,action:Se.uk.view,linkedEntity:la(e)},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}manageTeamPendingJoinRequest(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.teampendingrequests,action:Se.uk.view,linkedEntity:la(e)},command:n?.entityCommand||ca(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}deleteTeam(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teams,action:Se.uk.delete})}restoreChannel(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.restorechannel,action:Se.uk.view},{entityOptions:t?.entityOptions})}showChannelOwners(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.showChannelOwners,action:Se.uk.view},{entityOptions:t})}showChannelOwnersReactDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.showchannelownersreactdialog,action:Se.uk.view},{entityOptions:e})}showForMemberDialog(e){return this.extensionCommanding.executeCommand({id:e,type:Se.py.showformemberdialog,action:Se.uk.view})}userOnboardingTeam(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.useronboardingteam,action:Se.uk.view},command:n?.entityCommand||ca(t||C.D.ChannelList),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}}class ua{constructor(e){this.commandHandler=e}openTranscriptTab({entityCommand:e,messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,iCalUid:s,disableCallRecap:l,entryPoint:c},d){return this.commandHandler({entity:{type:Se.py.transcriptcontent,action:Se.uk.view},command:e,entityOptions:{messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,eventId:d,iCalUid:s,disableCallRecap:l,entryPoint:c}})}openTranscriptInSchedulingForm({entityCommand:e,messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,iCalUid:s,entryPoint:l},c,d,u){return this.commandHandler({entity:{type:Se.py.transcriptcontent,action:Se.uk.view,linkedEntity:{type:Se.py.schedulingform,action:Se.uk.view,id:JSON.stringify({eventId:(0,_i.cW)(c),providerType:d,tabId:u?"Recap":"Recordings & Transcripts",key:(0,Re.v4)()})}},command:e,entityOptions:{messageId:t,threadId:n,transcriptId:i,isOrganizer:a,eventId:(0,_i.cW)(c),meetingOrganizerId:o,meetingTenantId:r,iCalUid:s,entryPoint:l}})}openTranscriptInChatApp({entityCommand:e,messageId:t,threadId:n,transcriptId:i,isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,isOdspTranscript:s,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u,iCalUid:m,entryPoint:p},g,h){return this.commandHandler({entity:{id:i,type:Se.py.transcriptcontent,action:Se.uk.view,linkedEntity:h?{type:Se.py.chats,action:Se.uk.view,id:n||""}:null},command:e,entityOptions:{eventId:g?(0,_i.cW)(g):"",isOrganizer:a,meetingOrganizerId:o,meetingTenantId:r,messageId:t,threadId:n,transcriptId:i,isOdspTranscript:s,recordingDriveId:l,recordingDriveItemId:c,recordingUrl:d,recordingType:u,iCalUid:m,entryPoint:p}})}}class ma{constructor(e,t,n,i){this.extensionCommanding=e,this.commandHandler=t,this.host=n,this.coreSettings=i}virtualEventsList(e){return this.commandHandler({entity:{type:Se.py.virtualevents,action:Se.uk.list},command:e})}virtualEventById(e,t){const{useMeetingExperienceForSchedulingVirtualEvents:n,virtualEventByIdLinkUrl:i}=this.coreSettings.get(b.J.VirtualEvents);return n&&t?.stateTransition===ke.su.new?(this.host.open(i?.replace("{eventId}",e)),Promise.resolve()):this.commandHandler({entity:{type:Se.py.virtualevents,action:Se.uk.view,id:e},command:t})}createVirtualEvent(e,t){const{eventType:n}=e,{useMeetingExperienceForSchedulingVirtualEvents:i,createVirtualEventsLinkUrl:a}=this.coreSettings.get(b.J.VirtualEvents);return i?(this.host.open(a?.replace("{eventType}",n)),Promise.resolve()):this.commandHandler({entity:{type:Se.py.virtualevents,action:Se.uk.create,id:(0,ae.GW)()},command:t,entityOptions:e})}showConfirmationDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.virtualevents,action:Se.uk.confirm},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.VirtualEventDetails}},entityOptions:e})}showShareDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.virtualevents,action:Se.uk.share},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.VirtualEventDetails}},entityOptions:e})}navigateVirtualEvent(e,t,n,i,a){return this.commandHandler({entity:{type:Se.py.virtualevents,action:i||Se.uk.view,id:`${e}-${n}`},command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush,correlation:{source:C.D.VirtualEventDetails}},entityOptions:{selectedNavItem:n,sessionId:a,eventId:e,eventType:t}})}showFormErrorsDialog(){return this.extensionCommanding.executeCommand({type:Se.py.virtualevents,action:Se.uk.error},{entityCommand:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.VirtualEventDetails}}})}}class pa{constructor(e){this.commandHandler=e}openWikiTab(e,t,n,i){const a={entity:{action:Se.uk.view,id:e,linkedEntity:i,type:Se.py.wiki},command:t,entityOptions:n};return this.commandHandler(a)}}class ga{constructor(e){this.commandHandler=e}qnaById(e,t,n){return this.commandHandler({entity:{type:Se.py.yammerqna,action:Se.uk.view,id:e},command:t,entityOptions:n})}}class ha{constructor(e){this.commandHandler=e}launch(e){return this.commandHandler({entity:{type:Se.py.teamsgallery,action:Se.uk.view},command:e})}launchSection(e){return this.commandHandler({entity:{type:Se.py.teamsgallery,action:Se.uk.view,id:e},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.TeamsGallery}}})}launchTeamsGallery(){return this.commandHandler({entity:{type:Se.py.teamsgallery,action:Se.uk.view,id:""},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.TeamsGallery}}})}manageAppsInTeam(e,t,n){return this.commandHandler({entity:{id:e,type:Se.py.teammanageapps,action:Se.uk.view,linkedEntity:{id:e||"",type:Se.py.channels,action:Se.uk.list}},command:n?.entityCommand||this.getDefaultEntityCommand(t),scenarioEventData:n?.scenarioEventData,entityOptions:n?.entityOptions})}getDefaultEntityCommand(e,t=ke.su.flush){return{stateTransition:t,visibilityState:ke.fe.show,correlation:{source:e},targetWindow:ke.PH.main}}}class ya{constructor(e){this.commandHandler=e}callList(e,t){return this.commandHandler({entity:{id:e,type:Se.py.callsmain,action:Se.uk.view},command:t})}contactList(e,t){return this.commandHandler({entity:{type:Se.py.callsmain,action:Se.uk.list},command:e,entityOptions:t?.entityOptions,scenarioEventData:t?.scenarioEventData})}peopleAppAsContacts(e,t){return this.commandHandler({entity:{type:Se.py.peopleapp,action:Se.uk.view},command:e,scenarioEventData:t?.scenarioEventData})}}class va{constructor(e){this.extensionCommanding=e}launchUnifiedConsent(e){this.extensionCommanding.executeCommand({type:Se.py.unifiedconsentdialog,action:Se.uk.view},{entityOptions:{...e}})}}class fa{constructor(e){this.extensionCommanding=e}stopSharingChannelWithTeam(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.stopsharingchannelwithteam,action:Se.uk.view},{entityOptions:t?.entityOptions})}createSharedChannelInvitationDialog(e,t,n){return this.extensionCommanding.executeCommand({id:e,type:Se.py.sharedchannelcreateinvitationsdialog,action:Se.uk.view,linkedEntity:this.getChannelLinkedEntity(e)},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:t}},entityOptions:n})}acceptSharedChannelInvitationDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.acceptsharedchannelinvitationdialog,action:Se.uk.view},{entityOptions:t})}shareWithTeamYouOwnDialog(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.sharewithteamyouowndialog,action:Se.uk.view},{entityOptions:t})}archiveChannel(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:Se.py.archivechannel,action:Se.uk.view},{entityOptions:{teamId:e,channelId:t,channelDisplayName:n,channelType:i}})}unArchiveChannel(e,t,n){return this.extensionCommanding.executeCommand({id:t,type:Se.py.unarchivechannel,action:Se.uk.view},{entityOptions:{teamId:e,channelId:t,channelDisplayName:n}})}editTeamPicture(e,t,n,i,a,o){return this.extensionCommanding.executeCommand({id:e,type:Se.py.changeteampicture,action:Se.uk.view},{entityCommand:o,entityOptions:{teamId:e,threadId:t,teamDisplayName:n,pictureETag:i,defaultTeamInitialsPicture:a}})}showForMemberDialogV2(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.showformemberdialogv2,action:Se.uk.view},{entityOptions:t})}joinChannelDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.channeljoindialog,action:Se.uk.view},{entityOptions:e})}getChannelLinkedEntity(e){return{id:e||"",type:Se.py.channels,action:Se.uk.list}}}class Sa{constructor(e){this.extensionCommanding=e}launchTeamsErrorDialog(e,t,n,i,a){return this.extensionCommanding.executeCommand({id:e,type:Se.py.teamserrordialog,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:a}},entityOptions:{titleString:t,contentString:n,buttonString:i}})}getLinkToTeamOrChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.getlinktoteamorchanneldialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}staleChannelsAdhocDialog(e){return this.extensionCommanding.executeCommand({type:Se.py.stalechannelsadhocdialog,action:Se.uk.view},{entityCommand:e})}denyInvitationConfirmDialog(){return this.extensionCommanding.executeCommand({type:Se.py.sharedchanneldenyinvitation,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ChannelInvitations}}})}declineJoinChannelRequestConfirmDialog(){return this.extensionCommanding.executeCommand({type:Se.py.sharedchanneldeclinejoinrequestdialog,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ChannelInvitations}}})}launchConfirmLeaveChannel(e,t){return this.extensionCommanding.executeCommand({type:Se.py.leavechanneldialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchShowHideGeneralChannelWarningDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.showhidegeneralchannelwarningdialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchLeaveChannelLastOwnerDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.leavechannellastownerdialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchRestoreChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.restorechannelreactdialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchDeleteChannelDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.deletechannelreactdialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}launchStopSharingChannelWithTeamDialog(e,t){return this.extensionCommanding.executeCommand({type:Se.py.stopsharingchannelwithteamreactdialog,action:Se.uk.view},{entityCommand:t,entityOptions:e})}archiveTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:Se.py.archiveteam,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}deleteTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:Se.py.deleteteam,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}leaveTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:Se.py.leaveteam,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}restoreTeamT2(e,t,n,i){return this.extensionCommanding.executeCommand({id:t,type:Se.py.restoreteam,action:Se.uk.view},{entityCommand:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i}},entityOptions:{teamName:n,groupId:e,threadId:t}})}}class ka{constructor(e){this.extensionCommanding=e}launchAppDevicePermissionsConsent(e,t){return this.extensionCommanding.executeCommand({id:e,type:Se.py.platformappdevicepermissions,action:Se.uk.manage},{entityCommand:this.getDefaultExtensionCommand(),entityOptions:t})}getDefaultExtensionCommand(){return{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}}}}class Ca{constructor(e){this.commandHandler=e}launch(e){return this.commandHandler({entity:{type:Se.py.cast,action:Se.uk.view},command:e})}}class ba{constructor(e){this.commandHandler=e}async acquireExploratoryLicense(e){return this.commandHandler({entity:{type:Se.py.exploratorylicense,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:e}}})}async licenseAcquirementFailed(e,t){return this.commandHandler({entity:{type:Se.py.exploratorylicense,action:Se.uk.error},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:e}},entityOptions:t})}}class wa{constructor(e){this.commandHandler=e}presenterChatById(e,t,n){return this.commandHandler({entity:{type:Se.py.presenterchat,action:Se.uk.view},entityOptions:e,command:t,windowOptions:n})}}class Ta{constructor(e){this.extensionCommanding=e}vdiRestartDialogWorkflow(e,t){return this.extensionCommanding.executeCommand({type:Se.py.vdirestartworkflow,action:Se.uk.view},{entityCommand:e,entityOptions:t})}}const Ia=(e,t,n,i,a,o,r,s,l,c,d,u=h.ew,m,p,g)=>{const y=new In(e,i,u,r,s,a,m),v=new hn(o,e,y,r,s,l,a,{userContextId:d,windowId:u},p,g);return{entityCommanding:{account:new mi(e),activity:new pi(e,y),authentication:new fi(e,y,v,i),autoinstallnotification:new Si(e),biometricEnrollment:new ki(e),brbFeedback:new Ci(e,y),breakoutRooms:new bi(e),broadcast:new wi(e,y),calendar:new Ti(y,e),call:new Ii(e,y,d),callsMain:new ya(e),campaignNotifications:new Ni(e),cast:new Ca(e),channel:new Ei(e,y),chat:new Fi(e,y,a,s),coachReport:new Di(e),contacts:new Mi(e,y),deepLink:v,destroy:()=>y.destroy(),discoverSurface:new Ri(e,s),discoverappsnotifications:new xi(e),error:new ji(e),esp:new Li(e,y),exploratory:new ba(e),feedback:new Oi(e,y),file:new $i(y,e),flyout:new Ui(e),freemiumUpgrade:new Bi(e),guardians:new Wi(y,e),homepage:new Hi(e),meetingAnalytics:new zi(e),meetingRecap:new Ji(e),meetingRoom:new Ki(e),meetingOptions:new qi(e,y),nova:new zn(e),platform:new Zi(e,y,a),platformDevicePermissionDialogs:new ka(y),presenterTools:new wa(e),registration:new ea(e,a),school:new ta(e,y),search:new na(e,y),settings:new ia(e),shareForm:new aa(y),shell:new ai(e,y,c,u,o,a,s),store:new oa(e),lobnotifications:new Gi(e),lms:new Vi(y),onboardingnotifications:new Yi(e),teamsAndChannels:new da(e,y),teamsAndChannelsDialogs:new fa(y),teamsAndChannelsConfirmationDialogs:new Sa(y),teamsGallery:new ha(e),toasts:new ci(e,d),transcript:new ua(e),unifiedConsent:new va(y),virtualEvents:new ma(y,e,o,a),yammerQna:new ga(e),wiki:new pa(e),communities:new Pi(e,y),vdi:new Ta(y)},eventing:new ht(n,e,t),delegatedCommanding:new Pt(e,t)}},Na=new Set(["com.microsoft.teams.activity","com.microsoft.teams.calling"]);class Ea{constructor(e,t,n,i,a,o,r,s){this._appsRegistry=e,this._client=t,this._commandResultChangeReportingService=n,this._coreSettings=i,this._entityCommanding=a,this._loggerFactory=o,this._scenarioFactory=r,this._userContextId=s}init(){this._changes&&this.destroy(),this._changes=this._commandResultChangeReportingService.observeChanges().pipe((0,m.h)((e=>e.userContextId===this._userContextId))).subscribe((e=>this.executeOnCommandResultAppHooks(e)))}destroy(){this._changes?.unsubscribe(),this._changes=void 0}executeOnCommandResultAppHooks({context:{entityCommand:e,error:t},type:n}){if(!e)return;const i=e.command.correlation.scenarioName===H.RG.ActivitySwitch,a=e.entity.type,o=a&&this._appsRegistry.getApp({entityType:i?Se.py.activity:a}),r=o?.onCommandResult;if(o&&Na.has(o.manifest.id)&&r)try{r({requestContext:{client:this._client,coreSettings:this._coreSettings,entityCommanding:this._entityCommanding,error:t,loggerFactory:this._loggerFactory,scenarioFactory:this._scenarioFactory},entityCommand:e,result:n})}catch(e){this._loggerFactory.newLogger("command-result-hooks-service","core-services-entity-commanding").errorToTelemetry?.(`App ${o?.manifest.name} failed to execute entity command hook 'OnAfterCommandResolved' with ""${e.name}"" error`,"entity_command_hook",{errors:`${e.name}`},!0)}}}var Aa=n(613378);function _a(e){return function(e){const t=Da(e),n=1,i=2,a=3;if(!t)return e;if(t[a])return t[n].replace(t[i],t[a]);return t[n]}(e)}function Fa(e){return e.message&&(e.message=_a(e.message)),e.stack&&(e.stack=function(e){if(Da(e.message))return"Sanitized due to potential PII leaks.";return e.stack}(e)),e}function Da(e){return new RegExp(/(Can't find field ((chat)\(.*\)|.*) on object)/).exec(e)}const Pa=/-extension:\/\//;function Ma(e){return e===h.jK.TimedOut}class xa{constructor(e,t,n,i,a,o){this.host=e,this.scenarioFactory=t,this.platformService=n,this.networkStateProvider=i,this.diagnosticsService=a,this.coreSettings=o,this._onWindowError=e=>{if(function(e){return e&&("resizeobserver loop limit exceeded"===e.message.toLowerCase()||Pa.test(e.filename))}(e))return!0;const{colno:t,filename:n,lineno:i,message:a}=e;let{error:o}=e;const r=!!o&&Ma(o.code);return o=o?Fa(o):new Error(_a(a)),this._reportError(H.RG.GlobalWindowError,Object.assign(o,{colno:t,filename:n,lineno:i}),h.jK.UndefinedWindowError,r),!0},this._onUnhandledPromiseRejection=async e=>{const{reason:t}=e,n=!!t&&Ma(t.code);return this._reportError(H.RG.UnhandledRejection,t,h.jK.UnhandledPromiseRejection,n)},e.addEventListener(O.cr.UnhandledRejection,this._onUnhandledPromiseRejection),e.addEventListener(O.cr.GlobalWindowError,this._onWindowError)}dispose(){this.host.removeEventListener(O.cr.UnhandledRejection,this._onUnhandledPromiseRejection),this.host.removeEventListener(O.cr.GlobalWindowError,this._onWindowError)}set error(e){this.persistDiagnostics(),void 0!==e&&(this._error=e,this._reportError(H.RG.FatalError,e,h.jK.UndefinedGlobalError,!0))}get error(){return this._error}async _reportError(e,t,n,i){const{code:a=n,context:o=""}=t||{},r=""===o?`${a}`:`${o}:${a}`,s=(0,de._S)((0,ce.A)((0,de.B9)(t)));let l="";try{l=this.extractError(t)}catch(e){l="Stringifying error failed"}const c=`[errorCode:${r};filename:${t?.filename};lineno:${t?.lineno};colno:${t?.colno}]`,d=t?.originSlotName,u=t?.originAppId;this.scenarioFactory.newScenario(e).fail({message:u||d?`${u}/${d}: ${r}`:r,errorCode:r,errors:c,showOops:i,"AppInfo.NetworkState":this.networkStateProvider.isOnline()?"Online":"Offline",errorSlotName:d,errorAppId:u});let m=Promise.resolve();if(i){const e=1e3;m=(0,V.E)(ee.ip.getInstance().flush(),e),this.persistDiagnostics()}const p=this.platformService.config.clientVersion;return m.catch((()=>this.diagnosticsService.pushDiagnosticsEvent(_.i.Warn,"Could not flush telemetry logs in time",!0))).then((async()=>{const{disableSendingLogsToHost:e}=this.coreSettings.get(b.J.Diagnostics);if(!e){const e=await this.diagnosticsService.getDiagnosticsEvents(1e3);this.host.opener.postMessage(O.rY.WindowErrored,{errorCode:r,errorDescription:s,errorMsg:l,logs:e,showOops:i,clientVersion:p})}}))}extractError(e){const{scrubStackTrace:t}=this.coreSettings.get(b.J.Core),n=t?[]:[Aa.A4.SmtpAddress,Aa.A4.IPV4Address,Aa.A4.IPv6Address,Aa.A4.PhoneNumber];return(0,ce.A)(JSON.stringify(e,(0,de.cm)()),n)}persistDiagnostics(){this.diagnosticsService.persistDiagnostics()}}const Ra={[ie.vW.Background]:"background",[ie.vW.UserVisible]:"user-visible"};class ja{constructor(e,t,n){this.host=e,this.postTaskSchedulerDiagnosticsService=n,this.postTaskMap=new Map,this.logger=t.newLogger("PostTaskScheduler","core-services-scheduling")}schedule(e,t,n,i){const a=Ra[t.priority],o=new AbortController;return this.host.scheduler.postTask((()=>(this.postTaskSchedulerDiagnosticsService.markTaskDequeued(i,t.id),e())),{signal:o.signal,priority:a}).then((()=>{this.postTaskMap.delete(i)})).catch((()=>{this.postTaskMap.delete(i),this.logger.errorToTelemetry?.(`PostTaskScheduler: Job failed ${i}, ${t.id}`,"webclient_framework_foundation_core_services_scheduling")})),this.postTaskMap.set(i,{controller:o}),this.postTaskSchedulerDiagnosticsService.markTaskEnqueued(i,t.id),i}cancel(e){const{controller:t}=this.postTaskMap.get(e)||{};t&&(t.abort(),this.postTaskMap.delete(e))}destroy(){this.postTaskMap.forEach(((e,t)=>{this.cancel(t),this.postTaskMap.delete(t)}))}}var La;!function(e){e.JobChange="job_change"}(La||(La={}));class Oa{constructor(e,t,n,i,a,o,r,s){this._jobHandle=e,this._changes=t,this._meta=n,this._job=i,this._windowId=o,this._correlationId=r,this._executeSequentially=s,this._timing={received:0,started:0,completed:0,canceled:0},this._execution=ie.Tf.None,this._logger=a.newLogger("Scheduled Job","core-services-scheduling")}receive(){this._timing.received=Date.now(),this._execution=ie.Tf.Received,this.reportJobChange()}async execute(){if(this._execution===ie.Tf.Canceled)return;if(this._execution!==ie.Tf.Received)throw new Error("Unable to execute a job that has not been received");let e;this._timing.started=Date.now(),this._execution=ie.Tf.Started;try{this.reportJobChange();const t=this._job();e=t instanceof Promise?t:Promise.resolve(t),this._executeSequentially&&await e}catch(t){this._logger.error(`Job with ID:${this._meta.id} failed to execute or rejected with error: ${t.message?t.message:t}`),e=Promise.reject(t)}this.complete(e)}equals(e){return this._jobHandle===e}cancel(){return this._timing.canceled=Date.now(),this._execution=ie.Tf.Canceled,this.reportJobChange(),{meta:this._meta,job:this._job}}complete(e){const t=e=>{let t;return this._timing.completed=Date.now(),this._execution=ie.Tf.Complete,this.isError(e)&&(t={message:e.message,code:e.code,context:e.context,name:e.name}),this.reportJobChange(t),e};e.then(t).catch(t)}isError(e){return!!e&&e instanceof Error}reportJobChange(e){this._changes.report({correlationId:this._correlationId,type:La.JobChange,context:{...this.toChangeState(),target:"job",error:e},windowId:this._windowId})}toChangeState(){return{handle:this._jobHandle,timing:this._timing,execution:this._execution,meta:this._meta}}}var $a=n(75484);class Ua extends $a.default{remove(e,t){const n=[];let i;return this.forEach((a=>{t(a,e)?i=a:n.push(a)})),i&&(this.clear(),n.forEach((e=>this.enqueue(e)))),i}}const Ba=(e,t)=>e.equals(t),Wa=()=>0;class Ha{constructor(e,t,n,i){this._jobExecutor=e,this._supportedPriority=t,this._changes=n,this._loggerFactory=i,this._logger=i.newLogger("GreedyJobExecutionQueue","core-services-scheduling"),this._queue=new Ua(Wa),this._executeSequentially=t===ie.vW.MacroSequential}clearExecutionSchedule(){this._jobExecutor.clearExecutionSchedule(),this._queue.clear()}cancel(e){const t=this._queue.remove(e,Ba);return t&&t.cancel()}enqueue(e,t,n,i,a){if(n.priority!==this._supportedPriority)return this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job priroty [${ie.vW[n.priority]}] not supported by this queue, this queue supports [${ie.vW[this._supportedPriority]}]`,"webclient_framework_foundation_core_services_scheduling",void 0,!0),!1;const o=new Oa(e,this._changes,n,t,this._loggerFactory,i,a,this._executeSequentially);return this._queue.enqueue(o)?(o.receive(),this._jobExecutor.scheduleExecution({getJob:()=>this._queue.dequeue(),executeSequentially:this._executeSequentially}),!0):(this._logger.errorToTelemetry&&this._logger.errorToTelemetry("PriorityQueue did not enqueue the job","webclient_framework_foundation_core_services_scheduling",void 0,!0),!1)}}class Va{constructor(e,t,n){this._schedule=e,this._clearSchedule=t,this._logger=n}clearExecutionSchedule(){this._executionHandle&&this._clearSchedule(this._executionHandle)}scheduleExecution(e){this._executionHandle||(this._executionHandle=this._schedule((()=>{this._executionHandle=void 0,this.execute(e)})))}async execute({getJob:e,executeSequentially:t}){let n;for(;n=e();)try{const e=n.execute();t&&await e}catch(e){this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job executor caught an exception executing a job. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}}}class Ga{constructor(e,t,n,i){this._changes=e,this._loggerFactory=n,this._windowId=i,this._logger=n.newLogger("QueueScheduler","core-services-scheduling"),this._queues=new Map,this.createQueues(t)}destroy(){this._queues.forEach((e=>{e.clearExecutionSchedule()}))}schedule(e,t,n,i){const a=this._queues.get(t.priority);return a?(a.enqueue(i,e,t,this._windowId,n),i):(this._logger.errorToTelemetry&&this._logger.errorToTelemetry(`Job priority [${ie.vW[t.priority]}] supplied by ${t.scheduledById} not supported by scheduling`,"webclient_framework_foundation_core_services_scheduling",void 0,!0),ie.o_)}cancel(e){let t;if(e===ie.o_)return t;const n=Array.from(this._queues.values());for(const i of n)if(t=i.cancel(e),t)break;return t}createQueues(e){this.createQueue(ie.vW.Macro,(t=>e.setTimeout(t)),(t=>e.clearTimeout(t))),this.createQueue(ie.vW.RenderBlocking,(t=>e.requestAnimationFrame(t)),(t=>e.cancelAnimationFrame(t))),this.createQueue(ie.vW.MacroSequential,(t=>e.setTimeout(t)),(t=>e.clearTimeout(t)))}createQueue(e,t,n){const i=new Va(t,n,this._logger),a=new Ha(i,e,this._changes,this._loggerFactory);this._queues.set(e,a)}}var za;!function(e){e.PostTask="PostTask",e.Queue="Queue"}(za||(za={}));const qa={[ie.vW.Background]:za.PostTask,[ie.vW.Macro]:za.Queue,[ie.vW.MacroSequential]:za.Queue,[ie.vW.RenderBlocking]:za.Queue,[ie.vW.UserVisible]:za.PostTask};class Ja{constructor(e,t,n,i,a){const o=new Ga(e,t,n,i),r=new ja(t,n,a);this.activeSchedulers=new Map([[za.PostTask,r],[za.Queue,o]])}static get nextJobHandle(){return this._nextJobHandle===Number.MAX_SAFE_INTEGER&&(this._nextJobHandle=0),++this._nextJobHandle}destroy(){this.activeSchedulers.forEach((e=>{e.destroy()}))}schedule(e,t,n){return this.findScheduler(t.priority).schedule(e,t,n,Ja.nextJobHandle)}cancel(e){for(const t of this.activeSchedulers.values()){const n=t.cancel(e);if(n)return n}}findScheduler(e){const t=this.activeSchedulers.get(qa[e]);if(!t)throw new Error("No scheduler found for priority");return t}}Ja._nextJobHandle=0;const Qa=async(e,t,n,i)=>{const[a,o]=await Promise.all([t.getUser({correlation:n}),Ka(t,n,i)]);if(o)for(const t of o)e.setContext("UserInfo.IsMRU",void 0,void 0,t.id);e.setContext("UserInfo.IsMRU",!0,void 0,a.id)},Ka=(e,t,n)=>{if(n)return Promise.resolve(n);const i=e.getCachedUsers;return i?i(t):void 0},Ya=async(e,t,n,i,a)=>{const o={id:i.id,source:i.source,scenarioName:H.RG.AuthWebUser};try{const[i,a]=await Promise.all([n.getCachedUsers?.(o,{isAllCachedUsers:!0,isAuthenticated:!0}),n.getCachedUsers?.(o,{isPrimaryUser:!0})]);if(Qa(t,n,o,i),Array.isArray(i)){for(const e of i)t.setContext("UserInfo.IsPrimary",void 0,void 0,e.id);const e=i.filter((e=>e.profile.isHomeAccount)).length;t.setCoreContext("uniqueCredentialCount",e),t.setCoreContext("mtmaAccounts",i.length)}if(Array.isArray(a)){const[n,i]=a;e?t.setContext("UserInfo.IsPrimary",!0,void 0,n.id):(t.setCoreContext("primaryUserInfoId",n.profile.oid),t.setCoreContext("primaryUserInfoTenantId",n.profile.tid))}}catch(e){a.errorToTelemetry?.("Failed to update MRU or sync mtma context","telemetry_instrumentation_update_user_context")}},Xa={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"performWindowHistoryNavigation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"navigationDirection"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NavigationDirection"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"performWindowHistoryNavigation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"navigationDirection"},value:{kind:"Variable",name:{kind:"Name",value:"navigationDirection"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},Za={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"navigateToWindowHistoryIndex"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowHistoryIndex"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"navigateToWindowHistoryIndex"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"windowHistoryIndex"},value:{kind:"Variable",name:{kind:"Name",value:"windowHistoryIndex"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},eo={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesWindowHistoryNavigationPushToWindowHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pushToWindowHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},to={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesWindowHistoryNavigationRemoveFromWindowHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entity"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeFromWindowHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entity"},value:{kind:"Variable",name:{kind:"Name",value:"entity"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};class no{constructor(e,t,n,i,a){this._client=e,this._host=t,this._coreSettings=n,this._windowId=i,this._activeWindowsService=a,this.onPopState=async e=>{void 0!==e.state?.windowHistoryIndex&&this.navigateTo(e.state?.windowHistoryIndex)}}async init(){this.hostHistoryNavigationEnabled&&this._host.addEventListener("popstate",this.onPopState)}async destroy(){this.hostHistoryNavigationEnabled&&this._host.removeEventListener("popstate",this.onPopState)}async navigate(e){return this.mutate(Xa,{navigationDirection:e})}async navigateTo(e){return this.mutate(Za,{windowHistoryIndex:e})}isEnableDecoupleCommandingFromApollo(){return this._activeWindowsService.enableDecoupleCommandingFromApollo}canNavigateObservable(){return this._activeWindowsService.getActiveWindowObservable(this._windowId).pipe((0,m.h)((e=>e?.isMainWindow&&e?.layoutConfig.layoutMode===ke.lO.standard||!1)),(0,d.U)((e=>({canNavigateBack:e?.windowHistoryNavigationState?.canNavigateBack||!1,canNavigateForward:e?.windowHistoryNavigationState?.canNavigateForward||!1}))))}historyNavigationObservable(){return this._activeWindowsService.getActiveWindowObservable(this._windowId).pipe((0,m.h)((e=>e?.isMainWindow&&e?.layoutConfig.layoutMode===ke.lO.standard||!1)),(0,d.U)((e=>({backHistory:e?.windowHistoryNavigationState?.backHistory||[],forwardHistory:e?.windowHistoryNavigationState?.forwardHistory||[]}))))}async pushToWindowHistory(e,t){return this.mutate(eo,{entity:e,entityOptions:JSON.stringify(t)})}async removeFromWindowHistory(e){if(!this.hostHistoryNavigationEnabled)return this.mutate(to,{entity:e})}get hostHistoryNavigationEnabled(){return this._coreSettings.get(b.J.Core)?.enableHostHistoryNavigation||!1}async mutate(e,t){return this._client.mutate({mutation:e,variables:{...t,windowId:this._windowId},fetchPolicy:"no-cache"})}}var io=n(64340);const ao={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeWindow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},oo={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"windowStateEvent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"windowStateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isFocused"}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"shouldClose"}}]}}]}}]};class ro{report(e){if(!this._changes||0===this._changes.observers.length)return;const t=e.changeCorrelationId||(0,Re.v4)();this.changes.next({...e,changeCorrelationId:t})}observeChanges(){return this.changes.asObservable()}get changes(){return this._changes||(this._changes=new kn.xQ),this._changes}}class so{constructor(e,t){this.parentContext=e,this.pulsarLibraryInstance=t}startSignal(e,t){return this.pulsarLibraryInstance.startSignal(e,t,this.parentContext)}}class lo{constructor(e,t,n,i){this.logger=e,this.span=t,this.pulsarLibraryInstance=i,this.pulsarLibraryInstance.otlDependencies?this.signalContext=this.pulsarLibraryInstance.otlDependencies.trace.setSpan(n,t):this.logger.error("PulsarSignal: otlDependencies is not defined")}stop(e){this.span.setStatus(e),this.span.end()}appendEventData(e,t){this.span.setAttributes(lo.eventDataToAttributes(e,t))}addEvent(e){this.span.addEvent(e)}getPulsarContext(){return new so(this.signalContext,this.pulsarLibraryInstance)}propagate(){if(!this.signalContext)return void this.logger.error("propagate: signalContext is not defined");const{W3CTraceContextPropagator:e,defaultTextMapSetter:t}=this.pulsarLibraryInstance.otlDependencies,n={};return(new e).inject(this.signalContext,n,t),n}static eventDataToAttributes(e,t){const n={};return Object.keys(t).forEach((i=>{n[`${e}.${i}`]=t[i]})),n}}var co,uo,mo;!function(e){e.TEAMS_CORE="Teams.Core",e.TEAMS_RENDERING="Teams.Rendering",e.TEAMS_RESOLVER="Teams.Resolver"}(co||(co={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(uo||(uo={})),function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(mo||(mo={}));class po{constructor(e,t){this.exporter=e,this.otlDependencies=t,this._shutdownOnce=new this.otlDependencies.BindOnceFuture(this._shutdown,this)}forceFlush(){return Promise.resolve()}onStart(e){this.export(e,"onStart")}onEnd(e){this._shutdownOnce.isCalled||0!=(e.spanContext().traceFlags&mo.SAMPLED)&&this.export(e,"onEnd")}shutdown(){return this._shutdownOnce.call()}export(e,t){const{context:n,suppressTracing:i,ExportResultCode:a,globalErrorHandler:o}=this.otlDependencies;n.with(i(n.active()),(()=>{this.exporter.export([e],(e=>{e.code!==a.SUCCESS&&o(e.error??new Error(`PulsarSpanProcessor: span export failed (status ${e})`))}),t)}))}_shutdown(){return this.exporter.shutdown()}}var go=n(142009);class ho{constructor(e,t){this.serviceName=e,this.config=t,this.consumerNotificationObserver=new kn.xQ,this.logger=t.loggerFactory.newLogger("PulsarLib","frameworks-pulsar"),this.sessionId=t.sessionId}async initialize(){await this.importOTLDependencies(),this.initOTL()}async shutdown(){await(this.provider?.shutdown())}startSignal(e,t,n){if(!this.tracer)return void this.logger.error("startSignal: tracer is not initialized");const i=n||this.otlDependencies.ROOT_CONTEXT,a=this.tracer.startSpan(e,t,i);return a.setAttribute("sessionId",this.sessionId),new lo(this.logger,a,i,this)}startSignalFromCarrier(e,t,n){if(!t)return;if(!this.otlDependencies)return void this.logger.error("startSignalFromCarrier: OTL dependencies are not initialized");const{W3CTraceContextPropagator:i,ROOT_CONTEXT:a,defaultTextMapGetter:o}=this.otlDependencies,r=(new i).extract(a,t,o);return this.startSignal(e,n,r)}observeConsumerNotifications(){return this.consumerNotificationObserver.asObservable()}initOTL(){if(!this.otlDependencies)return void this.logger.error("initOTL: OTL dependencies are not initialized");const{WebTracerProvider:e,Resource:t,SemanticResourceAttributes:n,SimpleSpanProcessor:i,OTLPTraceExporter:a}=this.otlDependencies;this.provider=new e({resource:new t({[n.SERVICE_NAME]:this.serviceName})}),this.config.spanExporter.registerConsumerNotificationCallback((e=>{this.consumerNotificationObserver.next(e)})),this.provider.addSpanProcessor(new po(this.config.spanExporter,this.otlDependencies)),this.config.logToOTLCollector&&this.provider.addSpanProcessor(new i(new a({url:"http://localhost:4318/v1/traces"}))),this.tracer=this.provider.getTracer("pulsar-tracer")}async importOTLDependencies(){this.otlDependencies=await(0,go.m)()}}class yo{constructor(){this.hasShutdown=!1,this.telemetryProvider=(0,ii.Yf)(),this.telemetryProvider.registerPulsarBackchannelListener(this.notify.bind(this))}export(e,t,n){this.hasShutdown||e.forEach((e=>{switch(n){case"onStart":this.telemetryProvider.sendPulsarSignal({type:"onStart",span:this.sanitizeSpan(e)});break;case"onEnd":this.telemetryProvider.sendPulsarSignal({type:"onEnd",span:this.sanitizeSpan(e)})}}))}registerConsumerNotificationCallback(e){this.consumerNotificationCallback=e}shutdown(){return this.hasShutdown=!0,Promise.resolve()}notify(e){this.consumerNotificationCallback?.(e)}sanitizeSpan(e){return{...e,_spanProcessor:void 0,_clock:void 0}}}const vo=(e,t,n)=>{const{enableThemePreferenceResolution:i}=t.get(b.J.Core),{environment:a}=t.get(b.J.Metadata);if(i){const t=(0,io.R6)(a??pt.s.prod);return(0,io.u_)(e,n,t)}return t.get(b.J.Host).theme||"default"},fo=(e,t)=>e.subscribe({query:oo,variables:{windowId:t}}),So=(e,t,n,i,a,o,r)=>{const{isFocused:s,shouldClose:l,correlation:c}=e&&e.data&&e.data.windowStateEvent;let d;const u=c?.id;l?(t.close(),r.log(`host.close() called through window state event with correlationId ${u}`),d=dt.B.Close):s&&(t.isFocused()?(r.log(`host.isFocused() returns true with correlationId ${u}`),d=dt.B.AlreadyFocused):(t.focus(),r.log(`host.focus() called through window state event with correlationId ${u}`),d=dt.B.Focus,o.loadModule("windowcontrols").then((e=>{e?.focus?.(n),r.log(`HostComms focus() called through window state event with correlationId ${u}`)})))),d&&u&&(i.report({context:{target:"handle-window-state-event"},correlationId:u,type:d}),a.report({type:gt.FV.WindowStateChange,context:{target:"context-providers-handle-window-event"},correlationId:u,windowId:n}))},ko=(e,t)=>(0,d.U)((n=>((e,t,n)=>(n&&(e._cleanupFns||(e._cleanupFns=[]),e._cleanupFns.push(n)),{...e,...t}))(n,e(n),t))),Co=e=>ko((t=>({regenerateEntityCommandingServices:(n,i,a,o)=>(({activeWindowsService:e,appsRegistryService:t,authenticationUser:n,client:i,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,coreSettings:s,deeplinkService:l,experienceChangeReportingService:c,hostCommunicationService:d,i18n:u,loggerFactory:m,notificationsHandler:p,phaseStateMachine:g,platformService:h,scenarioFactory:y,shortcutExecutionService:v,userBiService:f,userContextId:S,userTrackingService:k,viewEntitiesRef:C,viewEntity:b,viewEntityName:w,windowId:T,windowLayoutService:I,windowProvider:N})=>Ia((l=>Vn({experienceChangeReportingService:c,activeWindowsService:e,authenticationUser:n,appsRegistryService:t,client:i,clientLaunchId:a,commandChangeReportingService:r,coreSettings:s,entityCommandInput:l,loggerFactory:m,platformService:h,scenarioFactory:y,windowId:T,executionContext:{userContextId:S,viewEntity:b,viewEntityName:w},windowProvider:N,userBiService:f,notificationsHandler:p,clientPreferences:o,userTrackingService:k})),((n,l)=>Et({activeWindowsService:e,appsRegistryService:t,client:i,clientPreferences:o,clientLaunchId:a,commandChangeReportingService:r,coreSettings:s,commandInput:n,commandHandler:l,loggerFactory:m,scenarioFactory:y,shortcutExecutionService:v,windowId:T,executionContext:{userContextId:S,viewEntitiesRef:C,viewEntity:b,viewEntityName:w},host:N,userBiService:f})),((e,n,l)=>Ot({appsRegistryService:t,client:i,clientLaunchId:a,clientPreferences:o,commandChangeReportingService:r,commandDelegator:l,commandHandler:n,coreSettings:s,eventInput:e,executionContext:{userContextId:S,viewEntitiesRef:C,viewEntity:b,viewEntityName:w},hostCommunicationService:d,i18n:u,loggerFactory:m,notificationsHandler:p,phaseStateMachine:g,scenarioFactory:y,shortcutExecutionService:v,userBiService:f,windowId:T})),i,s,N,y,m,l,d,S,T,I,b,a))({activeWindowsService:t.activeWindowsService,appsRegistryService:t.appsRegistryService,authenticationUser:t.authenticationUser,client:t.client,clientPreferences:t.clientPreferences,clientLaunchId:t.correlation.clientLaunchId||void 0,commandChangeReportingService:t.commandChangeReportingService,coreSettings:t.coreSettings,deeplinkService:t.deeplinkService,experienceChangeReportingService:t.experienceChangeReportingService,hostCommunicationService:t.hostCommunicationService,i18n:t.i18n,loggerFactory:t.loggerFactory,notificationsHandler:t.notificationsHandler,platformService:t.platformService,scenarioFactory:t.scenarioFactory,shortcutExecutionService:t.shortcutExecutionService,userContextId:t.authenticationUser?(0,xe.b4)(t.authenticationUser):void 0,viewEntitiesRef:n,viewEntity:i,viewEntityName:a,cdlWorkerRegistrarService:t.cdlWorkerRegistrarService,windowId:e,windowProvider:t.windowProvider,userBiService:t.userBiService,windowLayoutService:t.activeWindowsService.getWindowLayoutService(e),userTrackingService:t.userTrackingService,phaseStateMachine:o})}))),bo=(e,t,n,i,a,o,r,s)=>e.pipe((e=>e.pipe((e=>ko((()=>({windowProvider:e}))))(o),(e=>ko((t=>({loggerFactory:new le(t.diagnosticsService,e)}))))(n),((e,t)=>ko((({loggerFactory:n,postTaskSchedulerDiagnosticsService:i})=>({scheduler:new Ja(new ro,t,n,e,i)})),(({scheduler:e})=>e.destroy())))(n,o),((e,t)=>ko((n=>{const i=n.windowProvider.viewportContext,a=t.type,o=n.coreSettingsContext.createContextForViewport({id:e,viewportContext:i,entityType:a}),r=o.getCoreSettings();return{coreSettingsContext:o,coreSettings:r}}),(({coreSettingsContext:e})=>e.cleanup())))(n,s),(e=>ko((()=>({scenarioFactory:e})),(({scenarioFactory:e})=>e.destroy())))(t),(e=>ko((t=>({userBiService:t.telemetryService.createUserBiService(t,e,{id:t.correlation.id,startTimestamp:+t.correlation.startTimestamp||0,source:t.correlation.source})})),(({userBiService:e})=>e.destroy())))(n),((e,t)=>ko((({experienceChangeReportingService:n,authenticationUser:i})=>({experienceChangeReportingService:{...n,report:a=>{n.report({windowId:e,isMainWindow:t,userContextId:i?(0,xe.b4)(i):void 0,...a})}}}))))(n,i),((e,t)=>ko((({activeWindowsService:n,appBarService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,authenticationService:s,authenticationUser:l,cacheStorage:c,cdlWorkerService:d,client:u,clientPreferences:m,clientState:p,commandChangeReportingService:g,coreSettings:h,dataCleanupService:y,discover:v,experienceChangeReportingService:f,hostCommunicationService:S,localStorage:k,loggerFactory:C,notificationsHandler:w,offlineCacheManager:T,platformService:I,rebootService:N,scenarioFactory:E,user:A,userBiService:_,windowProvider:F,i18n:D,brbServiceManager:P,entityCommanding:M,pulsar:x,cdlAppStateService:R})=>{const j=u,L={activeWindowsService:n,appBarService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,authenticationService:s,authenticationUser:l,cacheStorage:c,cdlWorkerService:d,clientPreferences:m,clientState:p,commandChangeReportingService:g,coreSettings:h,dataCleanupService:y,discover:v,entityType:t,experienceChangeReportingService:f,hostCommunicationService:S,localStorage:k,loggerFactory:C,notificationsHandler:w,offlineCacheManager:T,platformService:I,pubsub:j.getServices().pubsub,rebootService:N,scenarioFactory:E,user:A,userBiService:_,windowId:e,windowProvider:F,i18n:D,brbServiceManager:P,entityCommanding:M,pulsar:x,cdlAppStateService:R},{enableViewSchema:O}=h.get(b.J.Core);return{client:j.clone(L),viewSchemaClient:O?j.cloneForViewSchema?.(L):null}}),(({client:e,entityCommanding:t,viewSchemaClient:n,coreSettings:i})=>(n?.destroy(),e.destroy(),i.get(b.J.Core).enableMTMA&&e?.clearCache(),t.destroy()))))(n,s.type))),(e=>e.pipe(((e,t,n)=>ko((i=>(e&&i.notificationsHandler.initializeWithWindow(t,n,i.client),{notificationsHandler:i.notificationsHandler})),(()=>{})))(a,n,o),((e,t)=>ko((n=>{const{appsRegistryService:i,authenticationUser:a,client:o,commandResultChangeReportingService:r,coreSettings:s,correlation:{clientLaunchId:l},deeplinkService:c,hostCommunicationService:d,loggerFactory:u,scenarioFactory:m}=n,{delegatedCommanding:p,entityCommanding:g,eventing:h}=Ia((t=>Vn({activeWindowsService:n.activeWindowsService,appsRegistryService:n.appsRegistryService,authenticationUser:n.authenticationUser,client:n.client,clientLaunchId:n.correlation.clientLaunchId||void 0,commandChangeReportingService:n.commandChangeReportingService,coreSettings:n.coreSettings,entityCommandInput:t,experienceChangeReportingService:n.experienceChangeReportingService,loggerFactory:n.loggerFactory,notificationsHandler:n.notificationsHandler,platformService:n.platformService,scenarioFactory:n.scenarioFactory,executionContext:{userContextId:n.authenticationUser?(0,xe.b4)(n.authenticationUser):void 0},windowId:e,userBiService:n.userBiService,clientPreferences:n.clientPreferences,userTrackingService:n.userTrackingService}).then()),((i,a)=>Et({activeWindowsService:n.activeWindowsService,appsRegistryService:n.appsRegistryService,client:n.client,clientPreferences:n.clientPreferences,commandChangeReportingService:n.commandChangeReportingService,coreSettings:n.coreSettings,commandInput:i,commandHandler:a,loggerFactory:n.loggerFactory,scenarioFactory:n.scenarioFactory,shortcutExecutionService:n.shortcutExecutionService,windowId:e,host:t,userBiService:n.userBiService})),((t,i,a)=>Ot({appsRegistryService:n.appsRegistryService,client:n.client,clientPreferences:n.clientPreferences,commandChangeReportingService:n.commandChangeReportingService,commandDelegator:a,commandHandler:i,coreSettings:n.coreSettings,eventInput:t,hostCommunicationService:n.hostCommunicationService,i18n:n.i18n,loggerFactory:n.loggerFactory,notificationsHandler:n.notificationsHandler,scenarioFactory:n.scenarioFactory,shortcutExecutionService:n.shortcutExecutionService,userBiService:n.userBiService,windowId:e})),o,s,t,m,u,c,d,a?(0,xe.b4)(a):void 0,e,n.activeWindowsService.getWindowLayoutService(e),void 0,l||void 0);let y=n.commandResultHooksService;return y&&s.get(b.J.Core)?.enableStandaloneCommandReportingService&&(y=new Ea(i,o,r,s,g,u,m,n.authenticationUser&&(0,xe.b4)(n.authenticationUser)),y.init()),{entityCommanding:g,eventing:h,commandResultHooksService:y,delegatedCommanding:p}}),(({commandResultHooksService:e})=>e?.destroy())))(n,o),ko((e=>({errorState:new xa(e.windowProvider,e.scenarioFactory,e.platformService,e.networkState,e.diagnosticsService,e.coreSettings)})),(({errorState:e})=>e.dispose())),(e=>ko((()=>({clientState:e}))))(r),Co(n),(e=>ko((t=>{const n=new no(t.client,t.windowProvider,t.coreSettings,e,t.activeWindowsService);return n.init(),{windowHistoryNavigationService:n}}),(({windowHistoryNavigationService:e})=>e.destroy())))(n),ko((e=>{const{enablePulsarTelemetry:t,logToOTLCollector:n}=e.coreSettings.get(b.J.Pulsar),i=new ho(co.TEAMS_RENDERING,{sessionId:e.platformService.host.sessionId,spanExporter:new yo,loggerFactory:e.loggerFactory,logToOTLCollector:!!n});return t&&i.initialize(),{pulsar:i}}),(({pulsar:e})=>e.shutdown())))),(e=>e.pipe(((e,t,n)=>ko((i=>(i.authenticationUser&&i.experienceLifecycleManager.manageWindow(e,i.authenticationUser.id,{...i,isMainWindow:t,isNotificationsWindow:n}),{})),(t=>t.authenticationUser&&t.experienceLifecycleManager.removeWindow(t.authenticationUser.id,e,"window_closed"))))(n,i,a)))),wo=(e,t,n,i,a,o,r,s,l,c)=>{const u=l.pipe((0,ut.g)("userContextId"),(0,mt.w)((({userContextId:e,correlation:t})=>c(e||void 0).pipe((0,d.U)((e=>({context:e,correlation:t})))))),(0,ut.g)("context"),(0,g.b)((({context:e,correlation:t})=>(o||r)&&To(e,t))),(0,d.U)((({context:e,correlation:t})=>({...e,correlation:t}))));return bo(u,e,t,o,s,n,i,a)},To=(e,t)=>{const{coreSettings:n,cdlWorkerRegistrarService:i}=e,a=n?.get(b.J.Core)?.enableMTMA,o=!!n?.get(b.J.CdlWorker)?.enableUserContextWorkerRegistration,r={id:t.id,source:t.source,scenarioName:t.scenarioName||"auth_switch_account"};e.authenticationUser&&a&&e.authenticationService.updateMostRecentUser?.({accountId:(0,xe.b4)(e.authenticationUser),correlation:r}).then((()=>{r.scenarioName=H.RG.AuthWebUser,Qa(e.telemetryContextService,e.authenticationService,r)})).then((()=>{o&&e.authenticationUser&&i.setMainWindowWorkerByUserId((0,xe.b4)(e.authenticationUser))}))},Io=(e,t,n)=>{n.log(`Removing window ${e} from apollo cache`),t.client.mutate({mutation:ao,variables:{windowId:e}}).catch((e=>n.error("Error in removing window: ",e)))},No=(e,t,n,i,a="")=>e.telemetryService.createScenarioFactory(e,t,{id:n.id,startTimestamp:parseInt(n.startTimestamp,10)||0,source:n.source},n.clientLaunchId??void 0,i,a),Eo=(e,t)=>e.markStep(H.RG.WindowLaunchTime,t);var Ao=n(63682);const _o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"setWindowFullscreen"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isFullscreen"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setWindowFullscreen"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"isFullscreen"},value:{kind:"Variable",name:{kind:"Name",value:"isFullscreen"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var Fo=n(773427);const Do=(e,t)=>e.opener.postMessage(O.Gx.Destroy,{windowId:t});async function Po(e,t,n,i,a,o,r,s){Eo(i,H.ck.BeginWindowCreation);const l=e.windowProvider;if(t===h.ew)return l;const c=await function(e,t,n,i){return new Promise(((a,o)=>{const r=e.setTimeout((()=>{o("New Frame did not report in 10000ms")}),1e4),s=e.self;return s.frameResolvers=s.frameResolvers||{},s.frameResolvers[t]=n=>{e.clearTimeout(r),Uo(e,t),a(n)},e.opener.postMessage(O.Gx.Create,{windowId:t,correlation:n,activeEntities:i})}))}(l,t,a,s);if(!c)return l;const d=(0,Ao.dP)(c,e,t,o,r),u=d.getHostedWindowContext();return Object.assign(d,{getHostedWindowContext:()=>({...u,windowId:t}),viewportContext:st.R.iFrame}),Eo(i,H.ck.EndWindowCreation),Wo(c,t,d.viewportContext,s),Wo(d,t,d.viewportContext,s),Mo(c,d,e,t,n),d.close=()=>Do(l,t),d}const Mo=(e,t,n,i,a,o)=>{xo(n,e,t);const r="onpagehide"in t?"pagehide":"unload",s=t.onFullscreen().subscribe((e=>{n.client.mutate({mutation:_o,variables:{isFullscreen:e,windowId:i}})})),l=()=>{e&&Ho(e),Ho(t),Io(i,n,a),o&&o(),t.removeEventListener(r,l),s.unsubscribe()};t.addEventListener(r,l)},xo=(e,t,n)=>{const i=e.leakDetectorService?.create();i?.track(Fo.I.UnwrappedIFrame,t),i?.track(Fo.I.IFrameWrapper,n)},Ro=async({id:e,activeEntities:t},n)=>{const{window:i,context$:a}=await n;return{id:e,window:i,context$:a,activeEntities:t}},jo=(e,t,n)=>(0,l.z)(ge((async i=>Oo(i,e,t,n)),(e=>async function(e,t){const{window:n,subscription:i,clientState:a}=await t,o=n.location.hash?.slice(1);o?Do(n,o):n.close(),i&&i.unsubscribe(),a&&a.dispose(),e?.cleanup(),n.destroy(0)}(t.leakDetectorService,e)),Ro,((e,n)=>((e,t,n)=>{const i=n.loggerFactory.newLogger("IframeStateManager","core-services-activator");i.error(`Creation for window ${e.id} failed with ${t}. Removing window from cache`),n.commandChangeReportingService.report({context:{target:"iframe-state-manager",errorInfo:ct.y.CreateWindowError},correlationId:e.correlation.id,type:dt.B.Failure}),Io(e.id,n,i)})(e,n,t)))),Lo=async(e,t,n,i,a,o,r,s,l,c,d)=>e&&t?Promise.resolve(((e,t,n,i,a,o,r)=>{const s=t.windowProvider,l=s.open(void 0,e,"width=600px,height=500px,toolbar=no,menubar=no,location=no");if(r){const{clientPreferences:e,coreSettings:n}=t,i=r({theme:vo(e,n,s),viewportContext:st.R.iFrame});l.document.write(i),l.document.close()}const c=()=>{const e=new URL(s.location.href);e.searchParams.append("random",Date.now().toString()),e.hash=[s.location.pathname,i.mainEntity.type,encodeURIComponent(i.mainEntity.id)].join("/"),l.location.href=decodeURIComponent(e.href)};s.addEventListener("unload",c);let d=(0,Ao.dP)(l,t,e,a,o);return d=Object.assign(d,{getHostedWindowContext:()=>({startReason:lt.zF.userInitiated,panelContext:lt.QP.secondary})}),Wo(l,e,d.viewportContext,i),Wo(d,e,d.viewportContext,i),Mo(l,d,t,e,n,(()=>{s.removeEventListener("unload",c)})),d})(i,n,a,s,l,c,d)):Po(n,i,a,o,r,l,c,s),Oo=async(e,t,n,i)=>{const{id:a,correlation:o,activeEntities:r,isMainWindow:s,layoutConfig:{layoutMode:l}}=e,{coreSettings:c}=n,d=o.source===C.D.PopOutButton,{enablePopOutChats:u}=c.get(b.J.Messaging),m=new le(n.diagnosticsService,a),p=m.newLogger("IframeStateManager","core-services-activator"),g={...n,loggerFactory:m},h=No(g,a,o,st.R.iFrame);return $o(t,g,p,a,o,r,d,u,h,s,l,i)},$o=async(e,t,n,i,a,o,r,s,l,c,d,u)=>{const m=await Lo(s,r,t,i,n,l,a,o,c,d,u),p=fo(t.client,i).subscribe((e=>So(e,m,i,t.commandChangeReportingService,t.experienceChangeReportingService,t.hostCommunicationService,n))),g=t.clientState.getChildWindowStateProvider(m,t.loggerFactory,t.coreSettings),{mainEntity:h}=o,y=Bo(m,i,c,p,g,e,l,a,h);return Eo(l,H.ck.WindowContextProvider),y},Uo=(e,t)=>e.opener.postMessage(O.Gx.Acquired,{windowId:t}),Bo=(e,t,n,i,a,o,r,s,l)=>({window:e,subscription:i,clientState:a,context$:bo(o(void 0).pipe((0,d.U)((e=>({...e,correlation:s})))),r,t,n,!1,e,a,l)}),Wo=(e,t,n,i)=>{e.iframeLeakInfo={iframeLeakInfoStartTime:(new Date).toISOString(),iframeLeakInfoEntities:Object.keys(i).reduce(((e,t)=>{const n=i[t],a=n&&"object"==typeof n&&"type"in n?n?.type:void 0;return a&&(e[t]=a),e}),{}),iframeLeakInfoViewportContext:n,iframeLeakInfoWindowId:t}},Ho=e=>{e.iframeLeakInfo||(e.iframeLeakInfo={}),e.iframeLeakInfo.iframeLeakInfoEndTime=(new Date).toISOString()};var Vo=n(201579),Go=n(359857);const zo=(e,t,n)=>{e.opener.postMessage(O.rY.ShouldShowChatNotification,{shouldShowChatNotification:t,windowId:n})};var qo=n(180053),Jo=n(873640),Qo=n(980860),Ko=n(498028),Yo=n(903692);const Xo=(e,t)=>!!(e===t||!e&&!t||e&&t&&e.id===t.id&&e.type===t.type&&e.action===t.action);function Zo(e,t){if(!t||!t.activeEntities)return!1;const n=t.activeEntities?.mainEntity,i=e.activeEntities?.mainEntity;return!Xo(i,n)&&!function(e,t){const n=["midNavEntity","subNavEntity","headerEntity","startEntity","mainEntity","endEntity"];for(const i of n)if(e[i]||t[i])return Xo(e[i],t[i]);return!1}(e.activeEntities,t.activeEntities)}const er=e=>({isChanged:tr,execute:t=>{e.dataCleanupService.markDataForWindowAsInactive(t.id)}});function tr(e,t){return function(e){return!!e.isMainWindow&&e.layoutConfig?.layoutMode===ke.lO.standard}(e)&&function(e,t){if(!t||!t.activeEntities)return!1;const n=t.activeEntities?.mainEntity,i=e.activeEntities?.mainEntity;return!Xo(i,n)}(e,t)}const nr=e=>({isChanged:(e,t)=>!e.isMainWindow&&!e.isNotificationsWindow&&Zo(e,t),execute:(t,n)=>function(e,t,n){const i=t.activeEntities.mainEntity,a=n?.activeEntities.mainEntity,o=e.appsRegistryService.getApp({entityType:i.type});if(!o)throw new Error("Entity does not match to an existing app");const r=o.getAppWindowFeatures?.({coreServices:e,host:t.window,isResize:!0,prevEntityType:a?.type,entityType:i?.type});if(!r)return;const{width:s,height:l,minWidth:c,minHeight:d}=r,{window:u}=t,m=e.loggerFactory.newLogger("WindowResizeCommand","core-services-activator");m.log(`From ${a?.type} of height ${u.innerHeight} and width ${u.innerWidth}, to ${i.type} of height ${l} and width ${s}`),c&&d&&(u.setMinimumSize&&u.setMinimumSize(c,d),e.hostCommunicationService.loadModule("windowcontrols").then((e=>e?.setMinimumWindowSize?.(t.id,c,d))));s&&l&&(u.setBounds&&u.setBounds({x:u.screenX,y:u.screenY,width:s,height:l}),e.hostCommunicationService.loadModule("windowcontrols").then((e=>e?.setWindowBounds?.(t.id,void 0,void 0,Math.trunc(s),Math.trunc(l)))))}(e,t,n)});const ir=e=>({isChanged:(e,t)=>!(!e.isMainWindow||e.layoutConfig&&e.layoutConfig.layoutMode!==ke.lO.standard||e.userContextId===t?.userContextId),execute:async t=>{const{enableSettingUserContextIdOnWindow:n}=e.coreSettings.get(b.J.Core);if((n||(0,Ko._)(e.coreSettings,e.platformService))&&t.userContextId){const n=await e.hostCommunicationService.loadModule("core");n?.setUserContextIdOnWindow?.(t.userContextId,t.id)}}});function ar(e){return!e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||"bigint"==typeof e||"symbol"==typeof e}function or(e){return function(t){const n=t&&("error"in t&&t.error||"reason"in t&&t.reason);return e.setTimeout((()=>function(e){if(e instanceof Error){const t=e.stack,n=e.message,i=e.code;Error.captureStackTrace?.(e),Object.setPrototypeOf(e,{});for(const t of Reflect.ownKeys(e))delete e[t];e.message=ar(n)?n:JSON.stringify(n),e.stack=ar(t)?t:JSON.stringify(t),e.code=ar(i)?i:JSON.stringify(i),Reflect.preventExtensions(e)}}(n)),0),console.error("Unhandled error/rejection",t),t&&t.preventDefault&&t.preventDefault(),!0}}function rr(e){!function(e){for(const t in e.console){const n=t;if("function"!=typeof e.console[n]||"Console"===n||"assert"===n||"dir"===n||"dirxml"===n||"table"===n)continue;const i=e.console[n];e.console[n]=function(...e){return i(...e.map((e=>{if(ar(e))return e;try{return JSON.stringify(e)}catch{return`Can't stringify ${e} - circular reference`}})))},Object.defineProperty(e.console[n],"name",{value:n,writable:!1})}}(e);const t=or(e);e.addEventListener("unhandledrejection",t),e.addEventListener("error",t)}const sr=e=>({isChanged:(e,t)=>Zo(e,t),execute:t=>{const{enableUpdateViewportOverride:n}=e.coreSettings.get(b.J.Core);if(!n)return;const i=e.windowProvider.viewportContext;t.context$.subscribe((e=>e.coreSettingsContext.updateViewportOverrideProviderSettings({id:t.id,viewportContext:i,entityType:t.activeEntities.mainEntity.type}))).unsubscribe()}});function lr(e,t,n,i,a,o,r,s,l){let c={},d={};if(l)c=l({coreServices:e,host:t,screenState:a,windowOptions:i,entityType:n,entityOptions:s})||{};else{const o=e.appsRegistryService.getApp({entityType:n});if(!o)throw new Error("Entity does not match to an existing app");d=o.getAppWindowFeatures?.({coreServices:e,host:t,screenState:a,windowOptions:i,entityType:n,entityOptions:s})||{}}const{additionalFeatures:u={},...m}={...c,...d},{width:p,height:g,minWidth:h,minHeight:y}=m;void 0!==p&&void 0!==h&&p<h&&(m.width=h),void 0!==g&&void 0!==y&&g<y&&(m.height=y);let v=Object.keys(m).reduce(((e,t)=>`${e}${e?",":""}${t}=${m[t]}`),"");return v=e.platformService.config.clientType===An.Bh.Web?`${v},toolbar=no,menubar=no,location=no`:v,r=Object.keys(u).reduce(((e,t)=>u?(0,Qo.ZN)(e,t,u[t]):e),r),o.log(`windowFeatures: ${v}, url: ${r}`),{url:r,windowFeatures:v}}const cr=(e,t)=>{switch(t){case"standard":return(0,Qo.ZN)(e,"window",lt.d.main);case"minimal":return(0,Qo.ZN)(e,"window",lt.d.flyout);case"minimode":return(0,Qo.ZN)(e,"window",lt.d.minimode);default:return e}},dr=(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h)=>{let y="",v="about:blank";const{coreSettings:f,platformService:S}=t;"minimode"!==d&&(v=S.config.clientType!==An.Bh.Web?(0,Qo.ZN)(v,"entityType",r.type):v);const k={url:v,windowId:n,windowFeatures:y,globalWindow:e,coreServices:t,logger:i,scenarioFactory:a,windowState:o,mainEntityType:r.type,isMainWindow:l,isNotificationsWindow:c,layoutMode:d,userContextId$:m,templateGenerator:g};if(S.config.clientType===An.Bh.Maglev){const{addWindowIdQsp:a,enableSettingUserContextIdOnWindow:o}=t.coreSettings.get(b.J.Core),{enablePinchToZoomTouchpad:g}=t.coreSettings.get(b.J.Calling);a&&(v=(0,Qo.ZN)(v,"windowId",n)),g&&(v=(0,Qo.ZN)(v,"pinchzoom","true"));const h=m.value.userContextId;if((o||(0,Ko._)(f,S))&&h&&(v=(0,Qo.ZN)(v,"userContextId",h)),v=((e,t)=>t?(0,Qo.ZN)(e,"show","false"):e)(v,u),l)return ur(e,t,i,r,s,d,p,v,y,k);c&&(v=mr(v,t)),v=(0,Qo.ZN)(v,"customframetheme","default")}return({url:v,windowFeatures:y}=lr(t,e,r.type,p??r.windowOptions,s,i,v,r.options,h)),pr({...k,url:v,windowFeatures:y})},ur=(e,t,n,i,a,o,r,s,l,c)=>{if("standard"===o){const{flushViewSchemaClient:e}=t.coreSettings.get(b.J.Core);e&&t.client?.viewSchemaClient?.clearStore(),s=(0,Qo.ZN)(s,"customframetheme","main")}else"minimode"===o&&(({url:s,windowFeatures:l}=lr(t,e,i.type,r??i.windowOptions,a,n,s,null)),s=(0,Qo.ZN)(s,"customframetheme","nobuttons"),l.split(",")?.forEach((e=>{s=(0,Qo.ZN)(s,e.split("=")[0],e.split("=")[1])})));return pr({...c,url:cr(s,o),windowFeatures:l})},mr=(e,t)=>{const{enableToastContentProtection:n}=t.coreSettings.get(b.J.Notifications);let i=e;return n&&(i=(0,Qo.ZN)(i,"contentprotection","true")),i=(0,Qo.ZN)(i,"window",lt.d.notifications),i=(0,Qo.ZN)(i,"show","false"),i},pr=({url:e,windowId:t,windowFeatures:n,globalWindow:i,coreServices:a,logger:o,scenarioFactory:r,windowState:s,mainEntityType:l,isMainWindow:c,isNotificationsWindow:d,layoutMode:u,userContextId$:m,templateGenerator:p})=>{let g=i.open(e,t,n||void 0);const{enableRetryWindowOpen:h}=a.coreSettings.get(b.J.Core);if(h){const a=(e,t)=>{const n=e;let i=!1;try{i=!n||!n.ResizeObserver||!n.caches}catch{i=!0}return o?.errorToTelemetry?.(`${t}, window is ${i?"":"not"} missing APIs.`,"webclient_framework_foundation_core_services_activator",void 0,!0),i};a(g,"Initial window.open")&&(g=i.open(e,t,n||void 0),a(g,"Retried window.open"))}if(!g)throw new Me.G(Me.$.WINDOW_UNDEFINED);var y;(y=g)._leakOverrides||(y._leakOverrides=!0,rr(y));const v=(0,Ao.dP)(g,a,t,c,u);Ar(g,t,v.viewportContext,e),Ar(v,t,v.viewportContext,e),o.log(`windowState: ${JSON.stringify(s)}`);const{minWidth:f=0,minHeight:S=0}=s;v.setMinimumSize&&v.setMinimumSize(f,S),gr(i,v,a,p),Eo(r,H.ck.EndWindowCreation),hr(g,v,l,a,u,r,m,t,o),yr(a,v,g);const{enableHostHistoryNavigation:k}=a.coreSettings.get(b.J.Core);return k||d||v.history.pushState("defaultBrowserHistory",""),v},gr=(e,t,n,i)=>{if(!i)return;if(!!t.document.getElementById("app"))return;const{clientPreferences:a,coreSettings:o,platformService:r}=n,s=r.config.clientVersion.split("/").pop(),l=We(i({theme:vo(a,o,e),osPlatform:r.config.osPlatform,cspNonce:e.__webpack_nonce__,publicPathScript:`window.__webpack_public_path__="${r.config.publicPath}"`,containerVer:s,environment:o.get(b.J.Metadata).environment||"",viewportContext:t.viewportContext,shouldStubConsoleError:!0}));t.document.write(l),t.document.close()},hr=(e,t,n,i,a,o,r,s,l)=>{const{disableMainWindowMouseListeners:c,enableActiveWindowsHistoryRecovery:d}=i.coreSettings.get(b.J.Core),{interactionToNextPaintService:u}=i,m=u?.track(t,n),p=()=>{t.opener.postMessage(O.rY.UnhandledMouseEvent,{type:"mousemove"})},g=()=>{t.opener.postMessage(O.rY.UnhandledMouseEvent,{type:"click"})},y=e=>{if(!(e=>{const t=e.target,n=t.nodeName?.toLowerCase(),i=t.type?.toLowerCase();return!(!t||!(t.isContentEditable||"textarea"===n||"input"===n&&/^(?:text|email|number|search|tel|url|password)$/i.test(i)))})(e))return e.preventDefault(),!1},v="onpagehide"in t?"pagehide":"unload",f=(e=>{const{disableContextMenu:t}=e.coreSettings.get(b.J.Core);return!!t})(i),S=t.onFullscreen().subscribe((e=>{i.client.mutate({mutation:_o,variables:{isFullscreen:e,windowId:s}})})),k=()=>{if(r.isStopped)return;const{correlation:{id:e},userContextId:n}=r.value;i.experienceChangeReportingService.report({correlationId:e,type:gt.FV.WindowOptionsChange,userContextId:n||void 0,windowId:s,context:{target:"window-state-manager",height:t.innerHeight,left:t.screenX,top:t.screenY,width:t.innerWidth}})},C=d&&i.platformService.config.clientType===An.Bh.Maglev&&"focus"===a&&s!==h.ew,w=C&&(0,Vo.R)(t,"resize").pipe((0,qo.b)(500)).subscribe(k),T=C&&r.pipe((0,qo.b)(500)).subscribe(k),I=()=>{l.log(`${v} called for window ${s}`),e&&_r(e),_r(t),Nr(o),Io(s,i,l),t.document.removeEventListener("mouseenter",p),t.document.removeEventListener("click",g),f&&t.removeEventListener("contextmenu",y),t.removeEventListener(v,I),l.log(`blur/unload listeners removed for windowId: ${s}`),Er(i,t,l,s),S.unsubscribe(),w&&w.unsubscribe(),T&&T.unsubscribe(),m?.()};s!==h.ew||c||(t.document.addEventListener("mouseenter",p),t.document.addEventListener("click",g)),t.addEventListener(v,I),f&&t.addEventListener("contextmenu",y)},yr=(e,t,n)=>{const i=e.leakDetectorService?.create();i?.track(Fo.I.UnwrappedWindow,n),i?.track(Fo.I.WindowWrapper,t)},vr=(e,t,n,i)=>{return(0,l.z)((0,Yo.j)((a=>fr(a,e,t,n,i)),(e=>Cr(e,t)),br,((e,n)=>((e,t,n)=>{let i,a;const o=n.loggerFactory.newLogger("WindowStateManager","core-services-activator");t instanceof Me.G&&Ee.G.isFunction(t.toTelemetryEntry)?(i=t.code,a=t.toTelemetryEntry()):(i=ct.y.CreateWindowError,a=(0,$.u4)(t)),o.error(`Creation for window ${e.id} failed with ${a}. Removing window from cache`),n.commandChangeReportingService.report({context:{target:"window-state-manager",errorInfo:i,errorMessage:a},correlationId:e.correlation.id,type:dt.B.Failure}),Io(e.id,n,o)})(e,n,t))),Ir([ir(t),nr(t),sr(t),er(t)]),(a=t.platformService.config.clientType===An.Bh.Web,o=e=>Tr(e,t),e=>a?e.pipe((0,g.b)((e=>o(e)))):e));var a,o},fr=(e,t,n,i,a)=>{const{id:o,activeEntities:r,correlation:s,screenState:l,isMainWindow:c,isNotificationsWindow:d,layoutConfig:{layoutMode:u},isInitialWindowStateHidden:m,userContextId:p,windowOptions:g}=e,{mainEntity:h,endEntity:y}=r,v=new le(n.diagnosticsService,o),f=v.newLogger("WindowStateManager","core-services-activator"),S={...n,loggerFactory:v},k=No(S,o,s,(0,Ao.YR)(c,u),p||""),C=k.findScenario(H.RG.WindowLaunchTime);let b;return C?.appendEventData({mainEntityType:h.type,endEntityType:y?.type}),b=a?a({coreServices:n,isResize:!0,entityType:h.type,windowOptions:g})||{}:((e,t,n)=>{const i=e.appsRegistryService.getApp({entityType:t.type}),a=i?.getAppWindowFeatures?.({coreServices:e,isResize:!0,entityType:t.type,windowOptions:n});return a||{}})(S,h,g??h.windowOptions),Sr(t,p,S,o,h,f,k,b,s,l,c,d,u,m,g,i,a)},Sr=(e,t,n,i,a,o,s,l,c,d,u,m,p,g,y,v,f)=>{const S=new r.X({userContextId:t,correlation:c}),k=((e,t,n,i,a,o,r,s,l,c,d,u,m,p,g)=>{Eo(i,H.ck.BeginWindowCreation),n.log(`mainEntityId: ${o.id}, mainEntityType: ${o.type}, mainEntityAction: ${o.action}`);const y=e.windowProvider;return t===h.ew?(hr(void 0,y,o.type,e,c,i,u,t,n),y):dr(y,e,t,n,i,a,o,r,s,l,c,d,u,m,p,g)})(n,i,o,s,l,a,d,u,m,p,g,S,y,v,f),C=((e,t,n,i)=>fo(e.client,t).subscribe((a=>So(a,n,t,e.commandChangeReportingService,e.experienceChangeReportingService,e.hostCommunicationService,i))))(n,i,k,o),b=n.clientState.getChildWindowStateProvider(k,n.loggerFactory,n.coreSettings),w=kr(k,i,S,C,b,e,s,a,u&&"standard"===p,u&&"minimode"===p,m,n.loggerFactory,n.leakDetectorService);return Eo(s,H.ck.WindowContextProvider),n.commandChangeReportingService.report({context:{target:"window-state-manager-create-window",layoutMode:p},correlationId:c.id,type:dt.B.WindowCreated,isMainWindow:u,userContextId:t}),w},kr=(e,t,n,i,a,o,r,s,l,c,d,u,m)=>({id:t,window:e,windowStateSubscription:i,clientState:a,leakDetectorService:m,loggerFactory:u,userContextId$:n,context$:wo(r,t,e,a,s,l,c,d,n,o)}),Cr=({clientState:e,id:t,window:n,windowStateSubscription:i,loggerFactory:a,leakDetectorService:o},r)=>{const s=a.newLogger("WindowStateManager","core-services-activator");s.log(`Destroy called on window ${t}`),t!==h.ew&&(n&&n.close(),s.log(`Window.close() called for window ${t}`),n?.destroy(500)),i?.unsubscribe(),o?.cleanup(),e.dispose(),r.appsRegistryService.removeWindowViewState(t)},br=({activeEntities:e,correlation:t,id:n,isMainWindow:i,isNotificationsWindow:a,layoutConfig:o,userContextId:r},{context$:s,window:l,userContextId$:c})=>(c.next({userContextId:r,correlation:t}),{activeEntities:e,context$:s,id:n,isMainWindow:i,isNotificationsWindow:a,layoutConfig:o,userContextId:r,window:l});let wr;const Tr=(e,t)=>{const n=t.loggerFactory.newLogger("WindowStateManager","core-services-activator"),{isChatHybridArchitectureEnabled:i}=t.coreSettings.get(b.J.Host);if(i){if(!e.find((e=>e.id===h.ew)))return}const a=t.windowProvider,o="onpagehide"in a?"pagehide":"unload";a.removeEventListener(o,wr),wr=()=>{n.log(`Global window unload handler called for ${e.length} windows`),e.forEach((e=>{e.id!==h.ew&&e.window.close()}))},a.addEventListener(o,wr,{once:!0})},Ir=e=>(0,Jo.R)(((t,n)=>(n.forEach((n=>{const i=t.find((e=>e.id===n.id));e.forEach((e=>{e.isChanged(n,i)&&e.execute(n,i)}))})),n)),[]),Nr=e=>{e.stopScenarioIfActive(H.RG.WindowLaunchTime,{},"abandoned")},Er=(e,t,n,i)=>{(e=>{const{enableCdlRegistration:t}=e.coreSettings.get(b.J.Core);return!!t})(e)&&(t.opener.postMessage(O.rY.CdlRegistration,{childWindowId:i,eventType:"unregister"}),n.log(`CdlRegistration: windowId: '${i}', eventType: unregister`))},Ar=(e,t,n,i)=>{const a=new URL(i);e.windowLeakInfo={windowLeakInfoStartTime:(new Date).toISOString(),windowLeakInfoEntityType:a.searchParams.get("entityType")||i,windowLeakInfoViewportContext:n,windowLeakInfoWindowId:t}},_r=e=>{e.windowLeakInfo||(e.windowLeakInfo={}),e.windowLeakInfo.windowLeakInfoEndTime=(new Date).toISOString()};var Fr=n(308489),Dr=n(739720),Pr=n(928322);const Mr=["#/_","#/alerts","#/analytics/myteams","#/apps","#/bizChatCopilotApp","#/broadcast-intermediate-screen","#/broadcastPlaybackScreen","#/calendar","#/calendarv2","#/calendarv2owa","#/calling-intermediate-screen","#/calling","#/callingProtocol","#/calls","#/channel-hub","#/channelDashboard","#/channels","#/chatProtocol","#/chats","#/communities","#/conversations","#/debug","#/l/meeting-share","#/l/meeting","#/l/meetingrecap","#/l/meetnow-join","#/l/meetup-join","#/modern-calling","#/scheduling-form","#deepLink=core","#deepLink=default","#deepLink=flyout"],xr=["ctx=channel","ctx=chat","MyLearning"],Rr=["/_","//path-to-file","/alerts","/analytics/myteams","/apps","/bizChatCopilotApp","/broadcast-intermediate-screen","/broadcastPlaybackScreen","/calendar","/calendarv2","/calendarv2owa","/calling-intermediate-screen","/calling","/callingProtocol","/calls","/channel-hub","/channelDashboard","/channels","/chatProtocol","/chats","/communities","/communitiesDashboard","/communitiesOnboarding","/debug","/deepLinkAutoInstallNotification","/deepLinkDiscoverAppsNotifications","/deepLinkFreemiumUpgrade","/deepLinkLobNotifications","/deepLinkOnboardingNotifications","/deviceLicenseError","/discover","/discoverSurface","/download","/error","/files/oneupviewer","/force_resync_data","/freemium-upsell","/getUserMedia","/guestLicense","/help","/l/app","/l/auth-callback","/l/auth/google","/l/call","/l/claim","/l/community","/l/file","/l/fileDownload","/l/help","/l/home","/l/invite","/l/manage-teams","/l/meeting-share","/l/meeting","/l/meetingrecap","/l/meetnow-join","/l/meetup-join","/l/present","/l/search","/l/settings/recognition","/l/stage","/l/task","/l/virtualevent","/l/virtualevent/new","/l/voiceassistant","/licenseError","/manageteams/myinvites","/manageteams/myteams","/manageTenant","/meet","/meeting/meet/list","/message","/modern-calling","/my","/non-members-placeholder","/oops","/people","/post-calling","/post-echo-bot-call","/pre-join-calling","/rigel-console-broadcast","/rigel-console-cortana","/rigel-console-home-page","/rigel-console-join-by-code","/rigel-console-post-call","/rigel-console-pre-call","/rigel-console","/scheduling-form","/school","/search","/sections","/sfbfrequickstartvideo","/smart-devices-guest-screen","/smart-devices-home-screen","/smart-devices-login-screen","/smbWelcome","/start-meeting","/subscriptionManagement","/surface-hub-home-screen","/team-overview","/teamCreate","/teamDashboard","/teamsGallery","/tenantSwitch","/toolkit","/unsupportedBrowser","/unsupportedIE","/v2/","\\path-to-file"],jr=["callto:","ftp:","ftps:","http:","https:","im:","mailto:","msteams:","onenote:","sip:","sips:","tel:","vscode-insiders:","vscode:","vsls:"],Lr=["","a","allowXTenantAccess","anon","appId","appTenantId","attachmentCount","attachmentSize","attendees","authId","btype","calendarType","card","ccRecipients","channelId","chatId","cloudAttachments","cloudAttachmentsRaw","completionBotId","content","contentType","context","contextType","correlationId","ctx","deeplinkId","defaultFocusArea","defaultRightTab","displayName","displayProperties","emailHtmlLink","endTime","environment","eventId","eventType","fileType","fileTypes","fqdn","from","groupId","height","iCalUid","id","installAppPackage","isBroadcast","isBroadcastMeeting","IsBroadcastMeeting","isPublic","isWatchParty","loginHint","meetingjoin","meetingType","messageId","messageId","MessageId","name","objectUrl","Oid","openInMeeting","organizerId","organizerId","outlookSmtpAddress","outlookTid","outlookUid","p","parentMessageId","pp","pptContext","prid","recordingId","replyChainId","result","ring","role","roleHint","schema","scope","serviceName","shareUrl","source","sourceVersion","startTime","subject","subType","tagId","templateId","templateInstanceId","tenantId","threadId","tid","Tid","timestamp","title","toRecipients","uid","url","user","userEmail","users","ver","viewState","width"],Or=e=>{const{pathname:t,protocol:n,hash:i,search:a}=e,o={hashstart:void 0,hashend:void 0,pathname:void 0,protocol:void 0};let r;o.protocol=Wr(n),o.pathname=Br(t),o.hashstart=$r(i),o.hashend=Ur(i);try{r=Hr(a)}catch(e){r=`SEARCH_METADATA_ERR:${e.name}`}if(void 0===o.pathname&&void 0===o.protocol&&void 0===o.hashstart&&void 0===o.hashend&&void 0===r)return"unsupported";const s=(0,$.u4)(o);return r?`${s}::search::${r}`:s},$r=e=>Mr.find((t=>e.startsWith(t))),Ur=e=>xr.find((t=>e.endsWith(t))),Br=e=>{const t=Fr.Hl.find((t=>e.startsWith(t)));return t||Rr.find((t=>e.startsWith(t)))},Wr=e=>jr.find((t=>e===t)),Hr=e=>{if(!e||0===e.length)return;const t=new URLSearchParams(e),n=Array.from(t.keys()).sort(),i=n.filter((e=>Lr.includes(e)));if(0===i.length)return`unsupported_searchparams_keys_${n.length}`;const a=Vr(t,i);return(0,$.u4)(a)},Vr=(e,t)=>{const n={};return t.forEach((t=>{const i=e.get(t);if(i){const e=Gr(i);n[t]=e}else n[t]="undefined"})),n},Gr=e=>{const t=(e=>{try{return JSON.parse(e),!0}catch{return!1}})(e);let n;t&&(n=(e=>{const t=Object.keys(e).sort();if(0===t.length)return t;const n=t.filter((e=>Lr.includes(e)));return 0===n.length?["unsupported_json_parsed_keys"]:n})(JSON.parse(e)));return{canJsonParse:t,jsonParsedKeys:n}},zr=new Map,qr=1e3,Jr=/^\/|\/$/g,Qr=0,Kr=1,Yr=2,Xr=3;function Zr(e,t){return new URL(e,t.get(b.J.Host).deepLinkDomain||void 0)}function es(e){return e.toLowerCase()}function ts(e){const{hash:t,search:n}=e;let i=n;if(t&&!(0,W.isEmpty)(t)){const e=t.indexOf("?");e>=0&&(i=t.substr(e+1,t.length-1))}const a=function(e){return(0,Pr.parse)(e||"")}(i),o=a;let r;return o.correlationId&&o.startTimestamp&&o.source&&(r={id:o.correlationId,startTimestamp:o.startTimestamp,source:o.source}),r}function ns({clientLaunchId:e,location:t}){return e??(t&&os(t,"clientId"))??(0,Re.v4)()}function is(e,t){let n=ts(e);return n=n||je({deeplinkId:os(e,"deeplinkId"),scenarioName:H.RG.NavigationCommand,source:t,externalId:as(e,"correlationId")}),n}function as(e,t){const{hash:n}=e;if(n){const e=cs(n);if(e)try{const n=new URL(e.deepLink,void 0);return(0,Pr.parse)(n.search)[t]}catch(e){return}}}function os(e,t){const{hash:n}=e;if(n){const e=cs(n);return e&&e[t]}}function rs(e){const{action:t,id:n,type:i}=e;if(t===Se.uk.default)switch(e.type){case Se.py.default:return Fr.n0.default;case Se.py.flyout:return Fr.n0.flyout}return n?`/${i}/${n}/${t}`:`/${i}/${t}`}function ss(e){const{experienceBasePath:t,location:n,loggerFactory:i}=e,{hash:a,href:o,pathname:r}=n,s=i.newLogger(Bt,"core-services-deeplink");if(!a&&!o&&!r)return;if(o){const e=Or(new URL(o));s.infoToTelemetry&&s.infoToTelemetry(`locationMetadata::${e}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}const l=function(e,t){if(!e.pathname||"/"===e.pathname)return!0;return!!t&&ls(e.pathname)===ls(t)}(n,t);if(a||!l){if(a){s.log("generateDeepLinkFromLocation::hash");const{deepLink:e,crash:t,relaunch:n,source:i,userContextId:o,windowType:r,homeCloud:c}=cs(a);if(e)return{deepLink:e,homeCloud:c,crash:t,relaunch:n,relaunchSource:i,isDesktopDeeplink:!0,userContextId:o,windowType:r};if(l)return{deepLink:a.startsWith("#")?a.substring(1):a,isDesktopDeeplink:!1}}return o?(s.log("generateDeepLinkFromLocation::href"),{deepLink:o,crash:!1,relaunch:!1,relaunchSource:void 0}):void 0}}function ls(e){return e.replace(/^\/|\/$/g,"")}function cs(e){const{deepLink:t,crash:n,relaunch:i,source:a,clientId:o,deeplinkId:r,userContextId:s,window:l,homeCloud:c}=(0,Pr.parse)(e);return{deepLink:"string"==typeof t?t:"",crash:"true"===n,relaunch:"true"===i,source:"string"==typeof a?Dr.d[a]:void 0,clientId:"string"==typeof o?o:void 0,deeplinkId:"string"==typeof r?r:void 0,userContextId:"string"==typeof s?s:void 0,windowType:"string"==typeof l?l:void 0,homeCloud:"string"==typeof c?c:void 0}}function ds(e){if(!e||0===e.length)return;const t=zr.get(e);if(t)return t;const n=e.replace(Jr,"");if(0===n.length)return;const i=n.split("/");try{let t;if(i){let e=i.length-1;for(;e>=0;){const t=i[e].toLowerCase();if(Se.py[t]&&(!Se.uk[t]||e!==i.length-1))break;e--}e>=0&&(t=function(e){let t;switch(e.length){case Xr:t={type:es(e[Qr]),id:e[Kr],action:es(e[Yr])};break;case Yr:{const n=e[Kr].toLowerCase();t=Se.uk[n]?{type:es(e[Qr]),action:es(e[Kr])}:{type:es(e[Qr]),id:e[Kr],action:Se.uk.view};break}case Kr:t={type:es(e[Qr]),action:Se.uk.default};break;default:throw new Error("Invalid entity fragment format found. Valid type, id or action is required.")}return t}(i.splice(e)))}return zr.size<=qr&&t&&zr.set(e,t),t}catch(e){throw new Error(`Unable to parse path into proper command. ${e.message}`)}}var us=n(625540);const ms=new Set(["chats","channels"]),ps="active_windows_history",gs="ActiveWindowsHistoryService:: ";class hs{constructor(e,t,n,i,a,o,r,s,l){this._client=t,this._experienceChangeReportingService=n,this._localStorage=i,this._rebootService=a,this._scenarioFactory=o,this._userContextId=r,this._windowProvider=s,this._activeWindowsService=l,this.cleanup=e=>{switch(e){case"quit":case"restart":this.unsubscribe();break;default:this.unsubscribe(),this.clearCache()}},this.unsubscribe=()=>{this._activeWindowsSubscription?.unsubscribe(),this._windowOptionsSubscription?.unsubscribe()},this._logger=e.newLogger("ActiveWindowsHistoryService","core-services-active-windows-history"),this._logger.log(`${gs}constructed`)}initialize(){const e=this.cleanup;this._rebootService.registerCleanupCallback(e);const{crash:t,relaunch:n}=cs(this._windowProvider.location.hash);this._logger.log(`${gs}crash: ${t} or relaunch: ${n}`),this.restoreWindows(t||n)&&this.subscribeWindows()}restoreWindows(e){if(!e)return this.clearCache(),!0;const t=this._scenarioFactory.newScenario(H.RG.ActiveWindowsHistoryRestore),n=e=>{this.cleanup();const n={reason:e};t.fail(n)};let i;if(i=this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsService.getActiveWindows():(0,us.F$)(this._client),!i)return n("Failed to read activeWindows from Apollo."),!1;const a=this.filterWindows(i),o=this.readCache();if(!o)return n("Failed to read from localStorage."),!1;const r=o.filter((e=>!a.find((t=>t.activeEntities.mainEntity.id===e.activeEntities.mainEntity.id))));if(r.length)if(r.forEach((e=>{e.activeEntities.entityExtension=null})),this._activeWindowsService.enableDecoupleCommandingFromApollo)this._activeWindowsService.setActiveWindows(i.concat(r));else if(!(0,us.bF)(this._client,i.concat(r)))return n("Failed to write activeWindows to Apollo."),!1;return a.length&&!this.persistCache(a.concat(r))?(n("Failed to write to localStorage."),!1):(t.stop(),!0)}persistActiveWindowsInCache(e){const t=this.filterWindows(e);this.persistCache(t)||(this.cleanup(),this._logger.errorToTelemetry?.(`Failed to write ${t.length} windows to localStorage.`,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0))}subscribeWindows(){this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsSubscription=this._activeWindowsService.getActiveWindowsObservable().subscribe((e=>{this.persistActiveWindowsInCache(e)})):this._activeWindowsSubscription=(0,us.OB)(this._client).subscribe((async({errors:e,loading:t,data:n})=>{if(t)return;if(e)return void this._logger.errorToTelemetry?.(`subscribeWindows::watchActiveWindows::${(0,$.u4)(e)}`,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0);const{activeWindows:i=[]}=n;this.persistActiveWindowsInCache(i)})),this._windowOptionsSubscription=this._experienceChangeReportingService.observeChanges().subscribe((async e=>{if(e.type!==gt.FV.WindowOptionsChange||!e.windowId||this._userContextId&&e.userContextId!==this._userContextId)return;const t=e=>{this.cleanup(),this._logger.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_active_windows_history",void 0,!0)},n=this.readCache();if(!n)return void t("subscribeWindows::windowOptions::Failed to read from localStorage.");const i=n.find((t=>t.id===e.windowId));if(!i)return;const{height:a,left:o,top:r,width:s}=e.context;i.windowOptions={__typename:"WindowOptions",height:a,left:o,top:r,width:s},this.persistCache(n)||t(`subscribeWindows::windowOptions::Failed to write ${n.length} windows to localStorage.`)}))}filterWindows(e){return e.filter((e=>((e,t)=>"focus"===e.layoutConfig.layoutMode&&!e.isMainWindow&&(!t||t===e.userContextId)&&ms.has(e.activeEntities.mainEntity.type))(e,this._userContextId)))}clearCache(){this._logger.log("ClearCache::ACTIVE_WINDOWS_HISTORY_STORAGE_KEY"),this._localStorage.remove(ps,"UserAndExperience")}persistCache(e){return this._logger.debug(`Persist ${e.length} windows to cache.`),this._localStorage.trySet(ps,JSON.stringify(e),"Framework","UserAndExperience")}readCache(){try{const e=JSON.parse(this._localStorage.get(ps,"UserAndExperience")||"[]");return this._logger.debug(`Read ${e.length} windows from cache.`),e}catch{return}}}var ys=n(907203);class vs extends _e{constructor(){super(h.Yg.CreateActiveWindowsHistoryTask,["activeWindowsService","authenticationUser","client","coreSettings","experienceChangeReportingService","localStorage","loggerFactory","rebootService","scenarioFactory","windowProvider"]),this.isAuthenticatedUser=e=>e?.role===ys.w4.Member||e?.role===ys.w4.Guest}async execute(e){const{authenticationUser:t,coreSettings:n}=e,i=n?.get(b.J.Core);if(!i?.enableActiveWindowsHistoryRecovery||!this.isAuthenticatedUser(t))return;const{activeWindowsService:a,client:o,experienceChangeReportingService:r,localStorage:s,loggerFactory:l,rebootService:c,scenarioFactory:d,windowProvider:u}=e,m=(0,xe.b4)(t);e.activeWindowsHistoryService=new hs(l,o,r,s,c,d,m,u,a)}}var fs=n(336378);const Ss={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationIsInUse"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365Application"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isInUse"}}]}}]},ks={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365Apps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationsWithInUseStatus"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationsWithInUseStatus"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationConnection"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"CoreServicesAppbarUpdateApplicationInUseFragment_applicationIsInUse"}}]}}]}}]}},...Ss.definitions]}.definitions]};function Cs(e,t,n,i){e.writeFragment({id:`${n}:${t}`,fragment:Ss,data:{__typename:n,id:t,isInUse:i}})}class bs{constructor(e,t,n,i){this._experienceChangeReportingService=e,this._userContextId=t,this._client=n,this._logger=i,this._appBarObservable=this._experienceChangeReportingService.observeChanges().pipe((0,m.h)((e=>e.userContextId===this._userContextId&&e.type===gt.yU.AppSelectionChanged&&e.context.appId!==this._currentValue)),(0,d.U)((e=>{this._previousValue=this._currentValue;const t=e;return this._currentValue=t.context.appId,this._client.viewSchemaClient?function(e,t,n){try{const t=e.readQuery({query:ks});if(t){let i,a;for(const[,e]of(0,W.entries)(t))if(i||(i=e.edges.find((e=>e.node.isInUse))),a||(a=e.edges.find((e=>e.node.id===n))),i&&a)break;if(i?.node.id===a?.node.id)return;i&&Cs(e,i.node.id,i.node.__typename,!1),a&&Cs(e,a.node.id,a.node.__typename,!0)}}catch(e){t.error("Error thrown updating Nova AppBar selection.")}}(this._client.viewSchemaClient,this._logger,this._currentValue):this._logger.error("Viewclient store isn't available for updating  AppBar selection."),{previousApplicationSelection:this._previousValue,newApplicationSelection:this._currentValue}}))).pipe((0,fs.B)()),this._appBarSubscription=this._appBarObservable.subscribe()}cleanup(){this._appBarSubscription?.unsubscribe()}observe(){return this._appBarObservable}current(){return this._currentValue}}class ws extends _e{constructor(){super(h.Yg.CreateAppBarServiceTask,["client","authenticationUser","experienceChangeReportingService","loggerFactory"])}async execute(e){const{authenticationUser:t,experienceChangeReportingService:n,client:i,loggerFactory:a}=e,o=a.newLogger("AppBarService","core-services-tasks"),r=new bs(n,(0,xe.b4)(t),i,o);return e.appBarService=r,()=>{r.cleanup()}}}var Ts=n(576045);function Is(e){switch(e){case h.eT.InCall:case h.eT.InBroadcast:case h.eT.Presenting:return Fe.pk.VeryActive;case h.eT.Interactive:return Fe.pk.Active;case h.eT.Inactive:return Fe.pk.Inactive;case h.eT.LongInactive:return Fe.pk.LongInactive;case h.eT.Disabled:return Fe.pk.Unrecoverable;default:return}}var Ns,Es=n(242111);class As{constructor(e,t,n,i,a){this._host=t,this.timesToSendUntilIdle=2,this._logger=n.newLogger("ClientStateSender","core-services-client-state");const{appIdleTimeoutInMs:o}=i.get(b.J.Core);this.msUntilResend=o?Math.round(o/this.timesToSendUntilIdle):a,this._subscriptionToStateChange=e.pipe((0,Es.x)()).subscribe((e=>this.handleStateChange(e))),this._logger.log("Initialized")}dispose(){this.stopRecurringSending(),this._subscriptionToStateChange.unsubscribe()}handleStateChange(e){try{e===Fe.pk.Active||e===Fe.pk.VeryActive?this.sendStateRecurringly(e):(this.stopRecurringSending(),this.sendState(e))}catch(t){this._logger.error(`Failed to send client state update: ClientState=${e}, Error: ${t}`)}}sendStateRecurringly(e){this._logger.log(`Starting recurring sending of client state: ${e}`);try{this.sendStateAndStartTimer(e)}catch(t){this._logger.error(`Failed to start recurring sending of client state: ClientState=${e}, Error: ${t}`)}}stopRecurringSending(){this.stopTimer(),this._logger.log("Stopped recurring client state sending")}stopTimer(){if(void 0!==this._recurringSendCountdownTimer)try{this._host.clearInterval(this._recurringSendCountdownTimer),this._recurringSendCountdownTimer=void 0}catch(e){this._logger.error(`Failed to stop sending of client state: ${e}`)}}sendStateAndStartTimer(e){this.sendState(e),this.stopTimer(),this._recurringSendCountdownTimer=this._host.setInterval((()=>this.sendState(e)),this.msUntilResend)}sendState(e){const t=function(e){switch(e){case Fe.pk.Unrecoverable:return h.eT.Disabled;case Fe.pk.Inactive:return h.eT.Inactive;case Fe.pk.LongInactive:return h.eT.LongInactive;case Fe.pk.VeryActive:return h.eT.InCall;default:return h.eT.Interactive}}(e);this._logger.log(`Sending state to main window: ${t} (ClientState=${e})`),this._host.opener.postMessage(O.rY.UpdateWindowState,{childSettings:{appState:t}})}}class _s{constructor(e,t,n,i){this._coreClientStateObservable=e,this._idleTracker=n,this._initialClientState=i,this._coreClientStateSubscription=null,this._logger=t.newLogger("ChildClientStateProvider","core-services-client-state"),this._logger.log(`Initializing clientState with state=${this._initialClientState}`),this._childClientStateBehaviorSubject=new r.X(this._initialClientState),this._coreClientStateSubscription=this._coreClientStateObservable.subscribe((e=>{e!==this.getState()&&(this._logger.log(`Client state is ${e}.`),this._childClientStateBehaviorSubject.next(e))})),this._logger.log("Initialized")}observe(){return this._childClientStateBehaviorSubject.asObservable()}getState(){return this._childClientStateBehaviorSubject.value}getChildWindowStateProvider(e,t,n){const i=this._idleTracker.createChildWindowIdleTracker(e,t,n);return new _s(this._coreClientStateObservable,t,i,this.getState())}dispose(){this._idleTracker.dispose(),this._coreClientStateSubscription?.unsubscribe(),this._childClientStateBehaviorSubject.complete()}}class Fs{constructor(e,t,n,i,a,o){this._host=e,this._idleTracker=n,this._defaultClientState=Fe.pk.Active,this._initializing=!0,this._clientStateSubscription=null,this._idleTrackerStateSubscription=null,this.handleAppStateSyncMessage=e=>{const t=e?.payload?.appState;void 0!==t&&(this._logger.log(`Handling pushed host appState update change to ${t}.`),this.handleMainWindowStateChange(t))},this._logger=t.newLogger("ClientStateProvider","core-services-client-state");let s=this._defaultClientState;if(void 0!==o){const e=Is(o);void 0!==e&&(s=e)}this._logger.log(`Initializing clientState with state=${s}`),this._clientStateBehaviorSubject=new r.X(s),this._setupEventHandlers(t,i,a),this.restartIdleTimerWhenActiveState(),this._initializing=!1,this._logger.log("Initialized")}observe(){return this._clientStateBehaviorSubject.asObservable()}getState(){return this._clientStateBehaviorSubject.value}getChildWindowStateProvider(e,t,n){const i=this._idleTracker.createChildWindowIdleTracker(e,t,n);return new _s(this.observe(),t,i,this.getState())}dispose(){this._host.opener.removeEventListener(O.rY.AppStateSyncMessage,this.handleAppStateSyncMessage),this._idleTracker.dispose(),this._stateSender&&this._stateSender.dispose(),this._clientStateBehaviorSubject.complete(),this._clientStateSubscription?.unsubscribe(),this._idleTrackerStateSubscription?.unsubscribe()}startVeryActive(e){this._logger.log(`startVeryActive(): Client state is set to very active by ${e}.`),this.setClientState(Fe.pk.VeryActive)}stopVeryActive(e){this._logger.log(`stopVeryActive(): Client state is set to active by ${e}.`),this.setClientState(Fe.pk.Active)}_setupEventHandlers(e,t,n){this._clientStateSubscription=this.observe().subscribe((e=>{this._logger.log(`Client state is ${e}.`)})),this._host.opener.addEventListener(O.rY.AppStateSyncMessage,this.handleAppStateSyncMessage),this._idleTrackerStateSubscription=this._idleTracker.observe().subscribe((e=>this.handleIdleChange(e))),n&&t&&t.get(b.J.Core)?.enableUpdateAngularOnClientStateChange&&(this._stateSender=new As(this.observe(),this._host,e,t,Ts.u.MsUntilIdleDefault))}handleIdleChange(e){this._logger.log(`Handling idleness change to ${e}.`),this._clientStateBehaviorSubject.value!==Fe.pk.VeryActive&&(this._initializing||this.setClientState(function(e){switch(e){case Ts.R.Inactive:return Fe.pk.Inactive;case Ts.R.LongInactive:return Fe.pk.LongInactive;default:return Fe.pk.Active}}(e),!1))}setClientState(e,t=!0){e!==Fe.pk.Active&&e!==Fe.pk.VeryActive||!t||this._idleTracker.restartIdleTimer(),e===Fe.pk.Inactive&&this._clientStateBehaviorSubject.value===Fe.pk.LongInactive||this._clientStateBehaviorSubject.value!==e&&(this._logger.log(`Updating client state from=${this._clientStateBehaviorSubject.value} to=${e}.`),this._clientStateBehaviorSubject.next(e))}handleMainWindowStateChange(e){const t=Is(e);t!==Fe.pk.Active&&t!==Fe.pk.VeryActive||this.setClientState(t)}restartIdleTimerWhenActiveState(){this.getState()!==Fe.pk.Active&&this.getState()!==Fe.pk.VeryActive||this._idleTracker.restartIdleTimer()}}!function(e){e.Initializing="Initializing",e.Unrecoverable="Unrecoverable",e.LongInactive="LongInactive",e.Inactive="Inactive",e.Active="Active",e.VeryActive="VeryActive"}(Ns||(Ns={}));class Ds{constructor(e=h.eT.Interactive){this._appState$=new r.X(e);(0,L.J)().opener.addEventListener(O.rY.AppStateSyncMessage,(e=>{const t=e?.payload?.appState;this.setAppState(t)}))}observe(){return this._appState$.asObservable().pipe((0,Es.x)())}getState(){return this._appState$.value}setAppState(e){void 0!==e&&e!==this.getState()&&this._appState$.next(e)}}const Ps="HostComms:: ";var Ms,xs;!function(e){e.LoadModuleCoreFailed="LoadModuleCoreFailed",e.LoadModuleOsUtilsFailed="LoadModuleOsUtilsFailed",e.LoadModuleScenarioFailed="LoadModuleScenarioFailed",e.LoadModuleTelemetryFailed="LoadModuleTelemetryFailed",e.LoadModuleWebClientStatesFailed="LoadModuleWebClientStatesFailed",e.ExecuteCommandFailed="ExecuteCommandFailed",e.RegisterForAppStateChangedFailed="RegisterForAppStateChangedFailed",e.ReportReadyToQuitFailed="ReportReadyToQuitFailed"}(Ms||(Ms={})),function(e){e.LoadModuleCoreSuccess="LoadModuleCoreSuccess",e.ExecuteCommandSuccess="ExecuteCommandSuccess"}(xs||(xs={}));var Rs=n(24208);class js{constructor(e,t,n,i,a,o){this._host=e,this._logger=t,this._hostCommunicationService=n,this._clientStateProvider=a,this._getMachineLockState=o,this._machineIdleThresholdMs=3e5,this._machineIdlePollingIntervalMs=2e4,this._disableSystemIdlePolling=void 0,this._machineIdleStateSubject=new r.X(Fe.fI.Active),this.subscribeToSettingsChanges(i),this.subscribeMachineIdleToClientState()}observe(){return this._machineIdleStateSubject.asObservable()}getState(){return this._machineIdleStateSubject.getValue()}handleMachineLockStateChange(e){this.evaluateCurrentState()}dispose(){this.stopPollingSystemIdleTime(),this._clientStateSubscription?.unsubscribe(),this._clientStateSubscription=void 0,this._settingsSubscription?.unsubscribe(),this._settingsSubscription=void 0}evaluateCurrentState(){return this._getMachineLockState()===Fe.UV.Locked?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(Fe.fI.Idle)):this._clientStateProvider.getState()===Fe.pk.VeryActive||this._clientStateProvider.getState()===Fe.pk.Active?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(Fe.fI.Active)):this._disableSystemIdlePolling?(this.stopPollingSystemIdleTime(),void this.updateMachineIdleState(Fe.fI.Idle)):void this.pollSystemIdleTime()}subscribeToSettingsChanges(e){this._settingsSubscription=e.getObservable(b.J.Core,["machineIdleThresholdMs","disableSystemIdlePolling","machineIdlePollingIntervalMs"]).subscribe((({machineIdleThresholdMs:e,disableSystemIdlePolling:t,machineIdlePollingIntervalMs:n})=>{null!=e&&(this._machineIdleThresholdMs=e),null!==t&&(this._disableSystemIdlePolling=t,this._disableSystemIdlePolling&&this.stopPollingSystemIdleTime()),null!=n&&(this._machineIdlePollingIntervalMs=n)}))}checkSystemIdleTime(){if(this._checkSystemIdleTimePromise)return this._checkSystemIdleTimePromise;const{promise:e,cancel:t}=this.getSystemIdleTime(),n=e.then((e=>this.handleSystemIdleTime(e)),(()=>{})).finally((()=>{this._checkSystemIdleTimePromise=void 0}));return this._checkSystemIdleTimePromise={promise:n,cancel:()=>t?.()},this._checkSystemIdleTimePromise}getSystemIdleTime(){let e;this._logger.debug("getting system idle time");return{promise:new Promise(((t,n)=>{e=n,this._hostCommunicationService.loadModule("osutils").then((e=>{void 0===e?.getSystemIdleTime?t(void 0):e?.getSystemIdleTime().then((e=>{this._logger.debug(`system idle time=${e}sec`),t(e)}))})).catch((()=>{this._logger.errorToTelemetry?.('Error happened while loading "osutils"',"webclient_framework_host_comms",void 0,!0),t(void 0)}))})),cancel:()=>e?.()}}subscribeMachineIdleToClientState(){this._clientStateSubscription=this._clientStateProvider.observe().subscribe((()=>this.evaluateCurrentState()))}handleSystemIdleTime(e){if(this._getMachineLockState()===Fe.UV.Locked)return void this.updateMachineIdleState(Fe.fI.Idle);if(this._clientStateProvider.getState()===Fe.pk.VeryActive||this._clientStateProvider.getState()===Fe.pk.Active)return void this.updateMachineIdleState(Fe.fI.Active);if(!e&&0!==e)return void this.updateMachineIdleState(Fe.fI.Idle);1e3*e>=this._machineIdleThresholdMs?this.updateMachineIdleState(Fe.fI.Idle):this.updateMachineIdleState(Fe.fI.Active)}updateMachineIdleState(e){const t=this._machineIdleStateSubject.getValue();e!==t&&(this._logger.log(`Updating machine idle state from=${t} to=${e}.`),this._machineIdleStateSubject.next(e))}pollSystemIdleTime(){this._disableSystemIdlePolling?this.handleSystemIdleTime(void 0):void 0===this._pollSystemIdleTimeInterval&&(this._pollSystemIdleTimeInterval=this._host.setInterval((async()=>this.checkSystemIdleTime()),this._machineIdlePollingIntervalMs),this.checkSystemIdleTime())}stopPollingSystemIdleTime(){void 0!==this._pollSystemIdleTimeInterval&&(this._host.clearInterval(this._pollSystemIdleTimeInterval),this._pollSystemIdleTimeInterval=void 0),this._checkSystemIdleTimePromise&&(this._checkSystemIdleTimePromise.cancel?.(),this._checkSystemIdleTimePromise=void 0)}}class Ls{constructor(e,t,n,i,a){this.handleMachineLockUpdate=e=>{const t=e?.payload?.isMachineLocked;void 0!==t&&(this._logger.log(`Handling pushed machineLock update change: isMachineLocked = ${t}.`),this.updateMachineLockState(t))},this._logger=t.newLogger("HostStateProvider","core-sercices-host-state"),this._hostStateSubject=new r.X({windowState:Fe.kZ.InFocus,machineLockState:Fe.UV.Active,machineIdleState:Fe.fI.Active,suspendedState:Fe.V9.Initialized}),this.registerForStateChanges(e,n),this._machineIdleTracker=new js(e,this._logger,n,i,a,(()=>this.getState().machineLockState)),this._machineIdleSubscription=this._machineIdleTracker.observe().subscribe((e=>{this.updateMachineIdleState(e)}))}observe(){return this._hostStateSubject.asObservable()}getState(){return{...this._hostStateSubject.value}}dispose(){this._machineStateChangedSubscription?.(),this._machineIdleSubscription.unsubscribe(),this._machineIdleTracker.dispose()}registerForStateChanges(e,t){e.opener.addEventListener(O.rY.AppStateSyncMessage,this.handleMachineLockUpdate),t.loadModule("osutils").then((e=>{this._machineStateChangedSubscription=e?.registerForSessionStateChanged?.((e=>{this._logger.log(`Handling pushed machineLock update change: machine SessionStatus= ${e.status}.`),e.status===Rs.$y.Suspending||e.status===Rs.$y.Resumed?this.updateSuspendedState(e.status===Rs.$y.Suspending):this.updateMachineLockState(e.status===Rs.$y.Locked)}))})).catch((()=>{this._logger.errorToTelemetry?.('Error happened while loading "osutils"',"webclient_framework_host_comms",void 0,!0)}))}updateMachineLockState(e){const t=e?Fe.UV.Locked:Fe.UV.Active,n=this.getState().machineLockState;if(t!==n){this._logger.log(`Updating machine lock state from=${n} to=${t}.`);const e=this.getState();e.machineLockState=t,this._hostStateSubject.next(e),this._machineIdleTracker.handleMachineLockStateChange(t)}}updateSuspendedState(e){const t=e?Fe.V9.Suspending:Fe.V9.Resumed,n=this.getState().suspendedState;if(t!==n){this._logger.log(`Updating machine suspended state from=${n} to=${t}.`);const e=this.getState();e.suspendedState=t,this._hostStateSubject.next(e)}}updateMachineIdleState(e){const t=this.getState().machineIdleState;if(e!==t){this._logger.log(`Updating machine idle state from=${t} to=${e}.`);const n=this.getState();n.machineIdleState=e,this._hostStateSubject.next(n)}}}var Os=n(43195);class $s{constructor(e,t,n){this.scenarioFactory=n,this.observe=()=>this.networkStateBehaviorSubject.asObservable(),this.getState=()=>this.networkStateBehaviorSubject.getValue(),this.observeIsOnline=()=>this.isOnlineObservable,this.isOnline=()=>this.convertToIsOnline(this.getState()),this.observeDetailedNetworkState=()=>this.detailedNetworkStateBehaviorSubject.asObservable(),this.convertToIsOnline=e=>e===Os.G.Online,this.getDetailedState=()=>this.detailedNetworkStateBehaviorSubject.getValue(),this.logger=e.newLogger(t,"core-services-network-state");const i=Os.G.Online,a=Os.T.Unknown;this.networkStateBehaviorSubject=new r.X(i),this.isOnlineObservable=this.networkStateBehaviorSubject.asObservable().pipe((0,d.U)((e=>this.convertToIsOnline(e))),(0,Es.x)()),this.logger.log(`Network state is initialized as ${Os.G[i]}`),this.sendStateChangeTelemetry(i),this.detailedNetworkStateBehaviorSubject=new r.X(a)}dispose(){this.networkStateBehaviorSubject.complete(),this.detailedNetworkStateBehaviorSubject.complete(),this.previousNetworkStateChangeTime=void 0}setNetworkState(e,t){this.logger.log(`Set network state to ${Os.G[e]}${t?` due to ${t}`:""}`),this.setDetailedNetworkState(this.convertToIsOnline(e)?Os.T.Online:Os.T.Offline),this.getState()!==e&&(this.networkStateBehaviorSubject.next(e),this.logger.log(`Network is ${Os.G[e]}`),this.sendStateChangeTelemetry(e,t))}setDetailedNetworkState(e){this.getDetailedState()!==e&&this.detailedNetworkStateBehaviorSubject.next(e)}sendStateChangeTelemetry(e,t){if(!this.scenarioFactory)return;let n=-1;const i=(new Date).getTime();if(this.previousNetworkStateChangeTime&&(n=i-this.previousNetworkStateChangeTime),this.previousNetworkStateChangeTime=i,-1===n)return;const a=e===Os.G.Online?H.RG.NetworkOnline:H.RG.NetworkOffline;this.scenarioFactory.newScenario(a).stop({offsetCurrentTimeInMs:n,reason:t})}}class Us{constructor(e){this.logger=e,this.subscriptions=[],this.currentState=void 0}getLastState(){return this.currentState}subscribeToStateChange(e){const t=this;t.subscriptions.push(e);return()=>{const n=t.subscriptions.indexOf(e);n>=0&&t.subscriptions.splice(n,1)}}cleanUpSubscriptions(){this.subscriptions=[],this.currentState=void 0}notifyAboutStateChange(e){this.currentState=e,this.subscriptions.forEach((t=>t(e)))}doOverrideOfLastState(e){this.currentState=e}}class Bs extends Us{constructor(e,t,n){super(e),this.label=t,this.onOverrideLastState=n,this.handleNetworkStateNotification=e=>{this.logger.debug(`${this.label} received ${Os.G[e]}`),this.getLastState()!==e&&(this.logger.log(`${this.label} network state is ${Os.G[e]}`),this.notifyAboutStateChange(e))}}overrideLastState(e){const t=this.getLastState();this.logger.debug(`NetworkStateTracker state is overriden from ${void 0===t?"undefined":Os.G[t]} to ${Os.G[e]}`),this.doOverrideOfLastState(e),this.onOverrideLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions()}}class Ws extends Us{constructor(e,t){super(e),this.handleNetworkStateNotification=e=>{const t=e?Os.G.Online:Os.G.Offline;this.logger.debug("Endpoints network state is "+(e?"online":"offline")),this.getLastState()!==t&&(this.logger.log("Endpoints network state is "+(e?"online":"offline")),this.notifyAboutStateChange(t))};const n={next:this.handleNetworkStateNotification,complete:()=>this.subscription?.unsubscribe()};this.subscription=t.observeIsOnline().subscribe(n)}overrideLastState(e){const t=this.getLastState();this.logger.debug(`EndpointsNetworkStateListener state is overriden from ${void 0===t?"undefined":Os.G[t]} to ${Os.G[e]}`),this.doOverrideOfLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.subscription&&!this.subscription.closed&&this.subscription?.unsubscribe(),this.subscription=void 0}}var Hs=n(37718),Vs=n(833990);class Gs extends Us{constructor(e){super(e),this.failed_to_fetch_subContext="rejectHttpError",this.processResponse=e=>{e.status===Hs.qb.NETWORK_AUTHENTICATION_REQUIRED?this.handleNetworkStateNotification(Os.G.Offline):void 0!==e.status&&e.status!==Hs.qb.NOT_MODIFIED&&e.status!==Hs.qb.GATEWAY_TIMEOUT&&this.handleNetworkStateNotification(Os.G.Online)},this.processResponseError=e=>{e&&(e.serverResponse?this.handleNetworkStateNotification(Os.G.Online):e.context===h.w5.RejectHttpError&&e.code===h.jK.RemoteOperationFailed&&e.subContext===this.failed_to_fetch_subContext?this.handleNetworkStateNotification(Os.G.Offline):this.logger.log(`Not network related error: ${e.message||e}`))},this.handleNetworkStateNotification=e=>{this.logger.debug(`Send network state is ${Os.G[e]}`),this.getLastState()!==e&&(this.logger.log(`Send network state listener is ${Os.G[e]}`),this.notifyAboutStateChange(e))},this.unsubscribeFromSendTracking=(0,Vs.z)(this.processResponse,this.processResponseError)}overrideLastState(e){const t=this.getLastState();this.logger.debug(`Send state listener's state is overriden from ${void 0===t?"undefined":Os.G[t]} to ${Os.G[e]}`),this.doOverrideOfLastState(e)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.unsubscribeFromSendTracking&&this.unsubscribeFromSendTracking(),this.unsubscribeFromSendTracking=void 0}}var zs=n(945151);const qs=(e,t)=>Promise.resolve({apiName:t,constructRequest:(n,i)=>{const a=e();return a.searchParams.set("cb",Date.now().toString()),{apiName:t,url:a.href,method:"HEAD",timeout:1e4,headers:{"cache-control":"no-store"},cancellationToken:n.token,correlationId:i}},transformResponse:e=>e.status===Hs.qb.GATEWAY_TIMEOUT?Promise.reject("GATEWAY_TIMEOUT"):e.status===Hs.qb.NETWORK_AUTHENTICATION_REQUIRED?Promise.reject("NETWORK_AUTHENTICATION_REQUIRED"):Promise.resolve()}),Js=e=>{const{coreSettings:t,platformService:n}=e;return{serviceName:zs.E.NetworkPing,models:{getNetworkStatus:qs((()=>new URL(t.get(b.J.Core).networkPingUrl||"/diagnostics/network",n.config.currentUrl)),"networkPing"),getNetworkStatusFallback:qs((()=>new URL(t.get(b.J.Core).networkPingFallbackPingUrl||"/evergreen-assets/icons/1x1-000000ff.png",n.config.staticsPath)),"networkFallbackPing")}}};var Qs=n(933609),Ks=n(994007);function Ys(e,t,n,i=Qs.A.TimedOut){let a;const o=new Promise((e=>{a=t.setTimeout(e,n)}));return Promise.race([e,o.then((()=>{throw(0,Ks.T)(i)}))]).then((e=>(t.clearTimeout(a),e)))}function Xs(e,t){return new Promise(((n,i)=>{if(e<0)i((0,Ks.T)(Qs.A.InvalidParameters));else{let i=0;i=t.setTimeout((()=>{t.clearTimeout(i),n()}),e)}}))}const Zs=[5e3,1e4,3e4],el="cancelled_ping";class tl{constructor(e,t,n,i,a){this.coreSettings=e,this.endpointsManager=t,this.scenarioFactory=n,this.host=i,this.ping=e=>{const t=this.coreSettings.get(b.J.Core).networkPingDisableFallback||!1,n=this.scenarioFactory.newScenario(H.RG.NetworkPing);n.appendEventData({correlationId:e});let i=this.endpointsManager.createCancelToken(),a=!1;const o=()=>a;return{promise:this.pingEndpoint("initial ping",(()=>this.endpoints.getNetworkStatus(i,e)),n,!t,o).then((a=>a||t?Promise.resolve(a):(i=this.endpointsManager.createCancelToken(),this.pingEndpoint("fallback ping",(()=>this.endpoints.getNetworkStatusFallback(i,e)),n,!1,o)))),cancel:()=>(i.cancel(),void(a=!0))}},this.pingEndpoint=async(e,t,n,i,a)=>{n.appendEventData({operation:e});try{return await t(),a()?this.markPingScenarioCancelled(e,n):this.markPingScenarioSuccess(e,n)}catch(t){return a()?this.markPingScenarioCancelled(e,n):t?.serverResponse?this.markPingScenarioSuccess(e,n):(t?.reason===Qs.A.TimedOut?this.logger.log(`${e} timed out`):this.logger.log(`${e} failed`),!i&&this.markPingScenarioFailed(e,t,n))}},this.getRetryIntervals=()=>{const e=this.coreSettings.get(b.J.Core).networkPingRetryIntervals||Zs;return Object.assign([],e)},this.updatePingResult=e=>{this.latestPingResult={isOnline:e,timestamp:Date.now()}},this.logger=a.newLogger("NetworkPingService","core-services-network-state"),this.endpoints=t.createApi(Js),this.logger.log("Initialized")}detectCurrentNetworkStatus(e){const t=this.coreSettings.get(b.J.Core).networkPingDebounceDelay||3e4;return!(this.coreSettings.get(b.J.Core).networkPingDisableDebounce||!1)&&this.latestPingResult&&this.latestPingResult.isOnline&&this.latestPingResult.timestamp&&Date.now()-this.latestPingResult.timestamp<t?(this.logger.log(`Skipping network detection as last online check succeeded less than ${t}ms ago.`),{promise:Promise.resolve(!0),cancel:()=>{}}):(this.logger.log("doing network ping"),this.ping(e))}whenNetworkOnline(e){if(this.whenNetworkOnlinePromise)return this.whenNetworkOnlinePromise;const t=this.getRetryIntervals();let n=!1;const i=()=>{this.whenNetworkOnlinePromise=void 0,n=!0};let a;const o=new Promise((async(o,r)=>{let s;a=()=>{s?.(),i(),r(el)};let l=t[0];for(let i=0;!n;i++){const{promise:a,cancel:o}=this.ping(e);s=()=>{o?.(),s=()=>{}};try{const e=await a;if(s=()=>{},e||n)break;i<t.length&&(l=t[i]),await Xs(l,this.host)}catch(e){this.logger.log("whenNetworkOnline ping rejected")}}i(),o()}));return this.whenNetworkOnlinePromise={promise:o,cancel:()=>a?.()},this.whenNetworkOnlinePromise}markPingScenarioSuccess(e,t){return t.stop({message:`${e} successful!`},"success"),this.logger.log(`${e} successful!`),this.updatePingResult(!0),!0}markPingScenarioFailed(e,t,n){const i=t?.reason?t.reason:"undefined",a=t?.serverResponse?.status;return n.fail({errors:`${e} failed. error reason: ${i}. Response status: ${a}`}),this.updatePingResult(!1),!1}markPingScenarioCancelled(e,t){return t.stop({message:`${e} cancelled`},"abandoned"),this.logger.log(`${e} cancelled`),this.updatePingResult(!0),Promise.reject(el)}}class nl extends $s{constructor(e,t,n,i,a,o,r,s){super(e,"NetworkStateProvider",n),this.loggerFactory=e,this.coreSettings=t,this.host=i,this.clientStateProvider=a,this._defaultNetworkOnlineDetectionTimeoutInMs=15e3,this.coreContextID="",this._contextListeners=new Map,this._skipNetworkDetectionDelay=!0,this.authStateSubscriptions=[],this.createNetworkStateTracker=(e,t,n)=>{const i=new Bs(this.logger,t,n),a={next:i.handleNetworkStateNotification,dispose:i.cleanUpSubscriptions};return this._addToContextListeners(e,i),i.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`${t} network state is ${Os.G[e]}`))),a},this._handleNetworkStateUpdate=(e,t)=>{if(this.logger.debug(`Update network to ${Os.G[e]} due to ${t}`),e===Os.G.Offline){if(this.getState()===Os.G.Offline)return;this._suspectOffline()}else this._cancelNetworkOnlineDetection(t),this.getState()!==e?this.setNetworkState(e,t):(this.setDetailedNetworkState(Os.T.Online),this._updateAllListenersTo(Os.G.Online));this._skipNetworkDetectionDelay&&(this._skipNetworkDetectionDelay=!1)},this._handleWindowOnline=()=>{this.logger.log("browser network online"),this.isOnline()||(this._updateAllListenersTo(Os.G.Offline),this._kickOffNetworkOnlineDetection(Os.G.Online))},this._handleWindowOffline=()=>{if(this.logger.log("browser network offline"),this.coreSettings.get(b.J.Core).disableWindowEventsNetworkDetectionV2){if(this.getState()===Os.G.Offline)return;this.setNetworkState(Os.G.Offline,"browser offline"),this._updateAllListenersTo(Os.G.Offline),this._kickOffNetworkOnlineDetection(Os.G.Offline)}else this._suspectOffline()};try{this._networkPingService=new tl(this.coreSettings,o,n,this.host,this.loggerFactory)}catch(e){this.logger.errorNoPii?.("NetworkPingService initialization has failed")}this._subscribeToSendNetworkState(),this.subscribeToEndpointsNetworkStateTracking(this.coreContextID,o.networkState),this._subscribeToWindowNetworkEvents(),this._subscribeToSuspendedStateResumeEvent(r),this.subscribeAuthStateEvent(s)}dispose(){super.dispose(),this._cancelNetworkOnlineDetection("dispose"),this.disposeAllContexts(),this._unsubscribeFromWindowNetworkEvents(),this.suspendedStateSubscription?.unsubscribe(),this.suspendedStateSubscription=void 0,this.authStateSubscriptions.forEach((e=>e.unsubscribe())),this.authStateSubscriptions=[]}disposeContext(e){const t=this._contextListeners.get(e);t&&(t.forEach((e=>{e.cleanUpSubscriptions()})),this._contextListeners.delete(e))}subscribeToEndpointsNetworkStateTracking(e,t){const n=new Ws(this.logger,t);return this._addToContextListeners(e,n),n.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`Endpoints network state is ${Os.G[e]}`)))}subscribeAuthStateEvent(e){if(this.coreSettings.get(b.J.Core).disableNetworkDetectionOnResume)return;const t=e?.observe();t&&this.authStateSubscriptions.push(t.subscribe((e=>{switch(e.customError?.errorCode){case"NoNetwork":case"NetworkOffline":case"NetworkTemporarilyUnavailable":this._skipNetworkDetectionDelay=!0,this._handleNetworkStateUpdate(Os.G.Offline,"auth state network related error")}})))}setNetworkState(e,t){super.setNetworkState(e,t),this._updateAllListenersTo(e)}_subscribeToSendNetworkState(){const e=new Gs(this.logger);this._addToContextListeners(this.coreContextID,e),e.subscribeToStateChange((e=>this._handleNetworkStateUpdate(e,`Send network state is ${Os.G[e]}`)))}_subscribeToWindowNetworkEvents(){this.host.addEventListener("online",this._handleWindowOnline),this.host.addEventListener("offline",this._handleWindowOffline),this.host.navigator&&(this.host.navigator.onLine?this._handleWindowOnline():this._handleWindowOffline())}_unsubscribeFromWindowNetworkEvents(){this.host.removeEventListener("online",this._handleWindowOnline),this.host.removeEventListener("offline",this._handleWindowOffline)}_subscribeToSuspendedStateResumeEvent(e){if(!e||this.coreSettings.get(b.J.Core).disableNetworkDetectionOnResume)return;const t=e?.observe().pipe((0,d.U)((e=>e.suspendedState)),(0,Es.x)());this.suspendedStateSubscription=t?.subscribe((e=>{e===Fe.V9.Resumed&&(this._skipNetworkDetectionDelay=!0,this._handleNetworkStateUpdate(Os.G.Offline,"resumed from suspended"))}))}_updateAllListenersTo(e){this._contextListeners.forEach((t=>t.forEach((t=>t.overrideLastState?.(e)))))}_addToContextListeners(e,t){this._contextListeners.has(e)?this._contextListeners.get(e)?.push(t):this._contextListeners.set(e,[t])}_suspectOffline(){const{enableSkipNetworkDetectionTimeoutOnOfflineStart:e,useVeryActiveForNetworkOnlineDetection:t,enableNetworkOnlineDetectionTimeout:n,networkOnlineDetectionTimeoutInMs:i}=this.coreSettings.get(b.J.Core);if(t&&this.clientStateProvider.getState()===Fe.pk.VeryActive)return this.logger.log("Network detection cancelled due to VeryActive client state."),this._updateAllListenersTo(Os.G.Online),void this.setDetailedNetworkState(Os.T.Online);const a=this._skipNetworkDetectionDelay&&!!e;if(!(this._networkDetectionTimeout&&!a||this._detectCurrentNetworkStatusPromise||this._networkPing))if(this._updateAllListenersTo(Os.G.Offline),this.setDetailedNetworkState(Os.T.SuspectedOffline),n&&!a){const e=i||this._defaultNetworkOnlineDetectionTimeoutInMs;void 0!==this._networkDetectionTimeout||this._detectCurrentNetworkStatusPromise||(this.logger.log(`Starting ${e}ms timeout before kicking off network online detection.`),this._networkDetectionTimeout=this.host.setTimeout((()=>{this._networkDetectionTimeout=void 0,this.logger.log("Timeout expired."),this._kickOffNetworkOnlineDetection(Os.G.Offline)}),e))}else this._kickOffNetworkOnlineDetection(Os.G.Offline)}_kickOffNetworkOnlineDetection(e){if(!this._networkPingService||!this._canPerformPing())return void(this.getState()!==e&&this.setNetworkState(e));if(this._detectCurrentNetworkStatusPromise||this._networkPing)return;this.logger.log("Kicking off network status detection.");const t=(0,Re.v4)(),n=this._networkPingService;this._detectCurrentNetworkStatusPromise=n.detectCurrentNetworkStatus(t),this._detectCurrentNetworkStatusPromise.promise.then((e=>{void 0!==this._detectCurrentNetworkStatusPromise?(this._detectCurrentNetworkStatusPromise=void 0,e?(this.logger.log("Network status verified as online."),this.setNetworkState(Os.G.Online,"http online")):(this.setNetworkState(Os.G.Offline,"http offline"),this._startNetworkPing(n,t))):this.logger.log("Network detection cancelled, ignoring result.")})).catch((e=>{e===el?this.logger.log("Network detection is cancelled"):this.logger.warn(`Network status verification error: ${e}`),this._detectCurrentNetworkStatusPromise=void 0}))}_canPerformPing(){const{enablePingService:e}=this.coreSettings.get(b.J.Core);return!!e||(this.logger.warn("Network detection is disabled."),!1)}_startNetworkPing(e,t){this.logger.log("Started recurring network ping."),this._networkPing=e.whenNetworkOnline(t),this._networkPing.promise.then((()=>{this._networkPing?(this._networkPing=void 0,this.getState()!==Os.G.Online&&this.setNetworkState(Os.G.Online,"Network ping succeded")):this.logger.log("Network ping cancelled, ignoring result.")})).catch((e=>{this.logger.log(`network detection by ping terminated due to ${e?.message?e.message:e}`)}))}_cancelNetworkPing(e){this._networkPing&&(this.logger.log(`Cancelling network ping due to ${e}`),this._networkPing.cancel?.(),this._networkPing=void 0)}_cancelNetworkOnlineDetection(e){void 0!==this._networkDetectionTimeout&&(this.logger.log(`Cancelling network detection timeout due to ${e}`),this.host.clearTimeout(this._networkDetectionTimeout),this._networkDetectionTimeout=void 0),this._detectCurrentNetworkStatusPromise&&(this.logger.log(`Cancelling network detection due to ${e}`),this._detectCurrentNetworkStatusPromise.cancel?.(),this._detectCurrentNetworkStatusPromise=void 0),this._cancelNetworkPing(e)}disposeAllContexts(){this._contextListeners.forEach((e=>{e.forEach((e=>{e.cleanUpSubscriptions()}))})),this._contextListeners.clear()}}class il extends Us{constructor(e,t){super(e),this.handleLegacyApplicationStateChange=e=>{const t=this.isOnlineAndConnectedInternal(e);this.logger.log(`LegacyApplicationState changed to ${h.eT[e]}`),this.notifyAboutStateChange(t)},this.isOnlineAndConnectedInternal=e=>{switch(e){case h.eT.Disabled:case h.eT.Offline:return Os.G.Offline;default:return Os.G.Online}},this.legacyApplicationStateSubscription=t.observe().pipe((0,Es.x)()).subscribe(this.handleLegacyApplicationStateChange)}cleanUpSubscriptions(){super.cleanUpSubscriptions(),this.legacyApplicationStateSubscription&&(this.legacyApplicationStateSubscription.unsubscribe(),this.legacyApplicationStateSubscription=void 0)}}class al extends $s{constructor(e,t,n,i,a,o){super(t,"LegacyNetworkStateProvider",n),this.hostCommunicationService=o,this._legacyAppStateListener=void 0,this._suspectedStateListeners=[],this._handleNetworkListenerUpdate=async(e,t)=>{e!==this.getState()?(this.logger.debug(`Network suspected ${Os.G[e]}${t?" due to ":""}${t}`),await this._sendSuspectedNetworkStateThrottled(this._convertToIsOnline(e))):void 0!==this._suspectedIsOnline&&this.convertToIsOnline(e)!==this._suspectedIsOnline&&this._resetSuspectedState()},this._sendSuspectedNetworkState=async e=>{this.logger.log(`Sending network state to main window: ${e}`);const t=await this.hostCommunicationService.loadModule("core");t?.notifyCoreStateChanged?t.notifyCoreStateChanged({isNetworkOnline:e}):this.logger.warn("notifyCoreStateChanged is missing in HostComms")},this._initSuspectedThrottleFunc=()=>{this._throttledSuspectedIsOnline=(0,W.throttle)(this._sendSuspectedNetworkState,2e3)},this._convertToIsOnline=e=>e!==Os.G.Offline,this._updateSuspectedStateListenersTo=e=>this._suspectedStateListeners.forEach((t=>t.overrideLastState?.(e))),this._subscribeToLegacyAppStateTracking(e),this._subscribeToSuspectedNetworkState(a,i)}dispose(){super.dispose(),this._legacyAppStateListener?.cleanUpSubscriptions(),this._legacyAppStateListener=void 0,this._suspectedStateListeners.forEach((e=>e.cleanUpSubscriptions())),this._suspectedStateListeners=[],this._clearSuspectedState(),this._throttledSuspectedIsOnline=void 0}_subscribeToLegacyAppStateTracking(e){this._legacyAppStateListener=new il(this.logger,e);const t=this;this._legacyAppStateListener.subscribeToStateChange((e=>t._updateNetworkState(e,`LegacyApplicationState changed to ${Os.G[e]}`)));const n=this._legacyAppStateListener.getLastState();void 0!==n&&this._updateNetworkState(n,"initial LegacyApplicationState")}_subscribeToSuspectedNetworkState(e,t){const{enableNetworkTrackingForLegacyNetworkState:n}=t.get(b.J.Core);n&&(this._initSuspectedThrottleFunc(),this._subscribeToSendNetworkState(),this._subscribeToEndpointsNetworkStateTracking(e.networkState))}_subscribeToSendNetworkState(){const e=new Gs(this.logger);this._suspectedStateListeners.push(e),e.subscribeToStateChange((e=>this._handleNetworkListenerUpdate(e,`Send network state is ${Os.G[e]}`)))}_subscribeToEndpointsNetworkStateTracking(e){const t=new Ws(this.logger,e);this._suspectedStateListeners.push(t),t.subscribeToStateChange((e=>this._handleNetworkListenerUpdate(e,`Endpoints network state is ${Os.G[e]}`)))}_updateNetworkState(e,t){this.logger.log(`Update network to ${Os.G[e]}${t?" due to ":""}${t}`),this.getState()!==e&&(this.setNetworkState(e),this._resetSuspectedState())}async _sendSuspectedNetworkStateThrottled(e){e!==this._suspectedIsOnline?(this._resetSuspectedState(),this._suspectedIsOnline=e):this._updateSuspectedStateListenersTo(this.getState()),this._throttledSuspectedIsOnline&&await this._throttledSuspectedIsOnline(e)}_clearSuspectedState(){void 0!==this._suspectedIsOnline&&(this._suspectedIsOnline=void 0),this._throttledSuspectedIsOnline?.cancel(),this._updateSuspectedStateListenersTo(this.getState())}_resetSuspectedState(){this._clearSuspectedState(),this._initSuspectedThrottleFunc()}}const ol=512,rl="tmp.";function sl(e,t){return(e.length+t.length)/ol}class ll extends _e{constructor(){super(h.Yg.CreateAppState,[]),this.clientStateStorageKey="tmp.clientState",this._updateTelemetryOnClientStateChange=(e,t)=>{e.observe().subscribe((e=>{t.setCoreContext("AppInfo.ClientState",e)}))},this._updateTelemetryOnNetworkStateChange=(e,t)=>{e.observeIsOnline().subscribe((e=>{const n=e?"Online":"Offline";t.setCoreContext("AppInfo.NetworkState",n)}));e.observeDetailedNetworkState().subscribe((e=>{t.setCoreContext("AppInfo.DetailedNetworkState",e)}))},this._updateTelemetryOnHostStateChange=(e,t)=>{e.observe().pipe((0,d.U)((e=>e.suspendedState)),(0,Es.x)()).subscribe((e=>{t.setCoreContext("AppInfo.Suspended",e)}));e.observe().pipe((0,d.U)((e=>e.machineLockState)),(0,Es.x)()).subscribe((e=>{t.setCoreContext("AppInfo.MachineLock",e)}))},this._updateHostOnClientStateChange=(e,t,n)=>{const i=n.newLogger("updateHostOnClientStateChange","core-services-tasks");e.observe().subscribe((e=>t.loadModule("webclientstates").then((t=>{if(t&&t.notifyWebClientStateChange){const n=Ns[e];t.notifyWebClientStateChange(n),i.log(`messaged host new ClientState (${e}). WebClientState sent: ${n}`)}else i.warn(`${Ms.LoadModuleWebClientStatesFailed} or webclientstates.notifyWebClientStateChange is not loaded`)})).catch((e=>{i.errorToTelemetry&&i.errorToTelemetry(`Error happened: ${e.message||e}`,"webclient_framework_host_comms",void 0,!0)}))))},this._trackClientStateForGlassjar=(e,t)=>{e.observe().subscribe((e=>t.localStorage.setItem(this.clientStateStorageKey,e)))},this._calculateLocalStorageUseOnIdle=(e,t,n)=>{const i=t.newLogger("calculatelocalstorageuseonidle","core-services-tasks");e.observe().subscribe((e=>{if(e===Fe.pk.LongInactive){const e=function(e){return Object.keys(e.localStorage).reduce(((t,n)=>t+sl(n,e.localStorage[n])),0)}(n);i.infoToTelemetry?.(`Used local storage: ${e} KB`,"localstorage_size",{size:e},!0)}}))}}async execute(e){const{coreSettings:t,hostCommunicationService:n,hostSettings:i,loggerFactory:a,platformService:o,scenarioFactory:r,telemetryService:s,windowProvider:l}=e,c=i?.hostSettings?.appState,d=void 0!==c?c:h.eT.Inactive;e.appStateService=new Ds(d);const u=new Ts.u(l,a,t);e.clientState=new Fs(l,a,u,t,!0,c);const m=new Ls(l,a,n,t,e.clientState);e.hostState=m;const p=this._createNetworkStateProvider(e,e.clientState,e.appStateService);e.networkState=p,e.errorState=new xa(l,r,o,p,e.diagnosticsService,t),this._updateTelemetryOnClientStateChange(e.clientState,s),this._updateTelemetryOnNetworkStateChange(p,s),this._updateTelemetryOnHostStateChange(m,s);const{enableUpdateHostOnClientStateChange:g,disableLocalStorageUsageTelemetry:y}=t.get(b.J.Core,["enableUpdateHostOnClientStateChange","disableLocalStorageUsageTelemetry"]);g&&this._updateHostOnClientStateChange(e.clientState,n,a),y||this._calculateLocalStorageUseOnIdle(e.clientState,a,l);const{isRunningGlassjar:v}=t.get(b.J.Test);v&&this._trackClientStateForGlassjar(e.clientState,l)}_createNetworkStateProvider(e,t,n){const{coreSettings:i,loggerFactory:a,scenarioFactory:o,windowProvider:r,endpointsManager:s,hostCommunicationService:l,hostState:c,authStateProvider:d}=e,{enableNetworkOnlineDetection:u}=i.get(b.J.Core);return u?new nl(a,i,o,r,t,s,c,d):new al(n,a,o,i,s,l)}}var cl=n(382008),dl=n(277572);class ul extends _e{constructor(){super(h.Yg.CreateAsyncMediaAuth,["gtmRegistry","discover","loggerFactory","coreSettings","scenarioFactory","windowProvider","platformService","endpointsManager","localStorage","authenticationService","config","authenticationUser","clientState","networkState","hostState"]),this.lifeCycleSubscriptions=[h.sM.OnUserAuthenticated,h.sM.OnUserAuthenticated_MTMA]}async execute(e){e.mediaAuthService||(e.mediaAuthService=new dl.b(cl.l,e.gtmRegistry,e.discover,e.loggerFactory,e.coreSettings,e.scenarioFactory,e.windowProvider,e.platformService,e.endpointsManager,e.localStorage,e.authenticationService,e.config,e.authenticationUser,e.clientState,e.networkState,e.hostState))}}var ml=n(823774),pl=n(516341),gl=n(354608),hl=n(774735),yl=n(894638),vl=n(7487),fl=n(506688);class Sl{constructor(e,t,n){this._coreSettings=t,this._accountId=n,this._criticalResources=[],this.cleanup=new kn.xQ,this.currentAuthState=new r.X({state:hl.j.Up}),this.resourceTokenStates=new Map,this.logSubscriptions=[],this.stateChangeLogs=[],this.skypeState=hl.Q.Success,this.skypeTokenState=new r.X(hl.Q.Unknown),this._logger=e.newLogger("AuthStateProvider","core-services-auth"),this._logger.log("[AuthState] Initializing auth state to Up.");const{criticalResources:i,authStateChangeTimeout:a}=this._coreSettings?.get(b.J.Auth)||{};this._criticalResources=i||[],this._authStateChangeTimeout=a??3e4,this.badTokenStates=new Map,this.skypeLogSubscription=this.skypeTokenState.pipe((0,yn.R)(this.cleanup)).pipe((0,Es.x)()).subscribe((e=>{this._logger.log(`[AuthState] Skype token state changed to: ${e}`),this.recordStateChange("SkypeToken",e)})),this.telemetryInterval=globalThis.window.setInterval((()=>{this.publishAuthStateTelemetry()}),gi.rF.ONE_HOUR),n&&(0,fl.kh)(this.currentAuthState.value.state,n)}observe(){return this.currentAuthState}getState(){return this.currentAuthState.value}getInteractionRequiredResource(){const e=this.badTokenStates.entries();let t=e.next();for(;!t.done;){if(t.value[1]===hl.Q.InteractionRequired)return t.value[0];t=e.next()}}reportResourceTokenState(e,t,n){(this._criticalResources.includes(e)||e===gi.ej.SIGNIN_RESTRICTIONS_KEY)&&(this.updateTokenStateMap(e,t),t===hl.Q.Success?this.badTokenStates.has(e)&&(this.badTokenStates.clear(),this.skypeState=t):this.badTokenStates.set(e,t),this.evaluateCurrentState(n))}observeResourceTokenState(e){if(!this._criticalResources.includes(e)&&e!==gi.ej.SIGNIN_RESTRICTIONS_KEY)throw new Error("Unsupported resource, contact Auth team if you need your resource added.");let t=this.resourceTokenStates.get(e);return t||(t=this.updateTokenStateMap(e,hl.Q.Unknown)),t.pipe((0,yn.R)(this.cleanup)).pipe((0,Es.x)())}reportSkypeTokenState(e,t){this.skypeTokenState.next(e),e!==this.skypeState&&(this.skypeState=e,this.evaluateCurrentState(t))}observeSkypeTokenState(){return this.skypeTokenState.pipe((0,yn.R)(this.cleanup)).pipe((0,Es.x)())}getSkypeTokenState(){return this.skypeTokenState.value}cleanupObservables(){this._logger.log("[AuthState] Cleanup function called."),this.publishAuthStateTelemetry(),globalThis?.window?.clearInterval(this.telemetryInterval),this.cleanup.next(!0),this.cleanup.complete(),this.skypeTokenState.complete(),this.resourceTokenStates.forEach((e=>e.complete())),this.resourceTokenStates.clear(),this.skypeLogSubscription.unsubscribe(),this.logSubscriptions.forEach((e=>e.unsubscribe())),this.logSubscriptions=[]}recordStateChange(e,t){t!==hl.Q.Unknown&&this.stateChangeLogs.push(`${Date.now()}|${e}->${t}`)}publishAuthStateTelemetry(){if(this.stateChangeLogs.length<1)return;const e=yl.cv.create({subContext:"AuthState",correlation:{id:(0,vl.pW)(),source:"auth-state-provider",scenarioName:H.RG.AuthPublishState}});e.addEventData(this.stateChangeLogs),e.closeScenario(),this.stateChangeLogs=[]}updateTokenStateMap(e,t){let n=this.resourceTokenStates.get(e);return n?n.next(t):(n=new r.X(t),this.resourceTokenStates.set(e,n),this.logSubscriptions.push(n.pipe((0,yn.R)(this.cleanup)).pipe((0,Es.x)()).subscribe((t=>{this._logger.log(`[AuthState] ${e} token state changed to: ${t}`),this.recordStateChange(e,t)})))),n}evaluateCurrentState(e){let t;if(0===this.badTokenStates.size)t=this.skypeState===hl.Q.LicenseError?hl.j.LicenseError:this.skypeState!==hl.Q.Success?hl.j.SkypeReconnecting:hl.j.Up;else{const e=this.badTokenStates.values();let n=e.next();for(;!n.done;){if(n.value===hl.Q.InteractionRequired){t=hl.j.InteractionRequired;break}t=n.value===hl.Q.SignInRestriction?hl.j.SignInRestriction:hl.j.AADReconnecting,n=e.next()}}t&&this.changeAuthState(t,e)}changeAuthState(e,t){if(this.shouldChangeStateToImmediately(e))this.pendingStateClearTimeout&&(globalThis.window.clearTimeout(this.pendingStateClearTimeout),this.pendingState=void 0,this.pendingStateClearTimeout=void 0),this.changeTo({state:e,customError:kl(t)});else if(this.pendingState)this.pendingState={state:e,customError:kl(t)};else{if(e===this.currentAuthState.value.state)return;this.pendingState={state:e,customError:kl(t)},this.pendingStateClearTimeout=globalThis.window.setTimeout((()=>{this.pendingState&&this.changeTo(this.pendingState),this.pendingState=void 0,this.pendingStateClearTimeout=void 0}),this._authStateChangeTimeout)}}shouldChangeStateToImmediately(e){switch(e){case hl.j.Up:case hl.j.InteractionRequired:case hl.j.LicenseError:case hl.j.SignInRestriction:return!0;default:return!1}}changeTo(e){e.state!==this.currentAuthState.value.state&&(this._logger.warn(`[AuthState] Transition from ${this.currentAuthState.value} to ${e}`),this.recordStateChange("AuthState",e.state),this.currentAuthState.next(e),this._accountId&&(0,fl.kh)(e.state,this._accountId,e.customError))}}const kl=e=>e&&{errorCode:e.errorCode||e.code,message:e.message,context:e.context,isExpected:e.isExpected,correlationId:e.correlationId,subContext:e.subContext};var Cl=n(68401),bl=n(826457),wl=n(327204),Tl=n(109553),Il=n(6842),Nl=n(823806),El=n(357859);const Al="Login Rate limit exceeded",_l={AdminUserLicenseNotPresentForbidden:"AdminUserLicenseNotPresentForbidden",AdminTeamsDisabledForTenantForbidden:"AdminTeamsDisabledForTenantForbidden",UserLicenseNotPresentForbidde:"UserLicenseNotPresentForbidde",TeamsDisabledForTenantForbidden:"TeamsDisabledForTenantForbidden",UserLicenseNotPresentTrialEligible:"UserLicenseNotPresentTrialEligible",TrialLicenseTenantNotReady:"TrialLicenseTenantNotReady",NewFederatedUsersNotAllowed:"NewFederatedUsersNotAllowed"},Fl=(e,t)=>(t<0||Date.now()-t>=bl.gT.MILLISECONDS_PER_HOUR)&&((0,de.o7)(e)||[Hs.qb.THROTTLED,Hs.qb.NOT_AUTHORIZED,-1].indexOf(e)>-1),Dl=async(e,t,n,i,a)=>{const o=(0,Tl.uc)(i),{serverResponse:{status:r,body:s}={}}=e;o?.appendEventData({statusCode:r}),(0,de.o7)(r??0)?o?.fail({message:(0,vl.VK)(e),errorCode:h.jK.ServiceUnavailable,statusCode:r}):-1!==r?(s.message?.indexOf(Al)>-1&&(o?.incomplete({message:(0,vl.VK)(e),errorCode:Al,statusCode:r}),a.error(`DiscoverRetryPolicy: Delaying skype token fetch for ${El.b3.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD}' .`),(0,Il._)(El.b3.DEFAULT_SKYPE_TOKEN_COOL_OFF_PERIOD)),await Pl(e,t,n,i,a)):o?.incomplete({message:(0,vl.VK)(e),errorCode:h.jK.TimedOut,statusCode:r})},Pl=async(e,t,n,i,a)=>{const o=(0,Tl.uc)(i),{serverResponse:{status:r,body:s,headers:l}={}}=e;let c;try{const e=await s.json();c=e?.error?.code}catch(e){a.error(`Body jsonify failed: ${e}`)}switch(a.error(`Getting errorCode: [${c}] from response`),r){case Hs.qb.NOT_AUTHORIZED:await xl(l,n,a,t.options?.userIdentifier),o?.incomplete({message:(0,vl.VK)(e),errorCode:c??h.jK.Unauthorized,statusCode:r});break;case Hs.qb.FORBIDDEN:((e,t)=>e===Hs.qb.FORBIDDEN&&!!t&&t in _l)(r,c)&&Ml(c,t,i),o?.cancel({message:(0,vl.VK)(e),errorCode:c??h.jK.Forbidden,statusCode:r});break;case Hs.qb.THROTTLED:default:o?.incomplete({message:(0,vl.VK)(e),errorCode:c??h.jK.Throttled,statusCode:r})}},Ml=(e,t,n)=>{const i=(0,Tl.uc)(n);if(e===_l.NewFederatedUsersNotAllowed)return t.headerUpdate||(t.headerUpdate={strongConsistencyValue:(a=El.vu.strongConsistencyMsInternalUserSignup,El.vu.strongConsistencyDefaultValue.replace("{id}",a))}),void i?.mark(_l.NewFederatedUsersNotAllowed);var a;e===_l.UserLicenseNotPresentTrialEligible?(i?.mark(_l.UserLicenseNotPresentTrialEligible),t.lastLicenseErrorTime=-1):t.lastLicenseErrorTime=Date.now()},xl=async(e,t,n,i)=>{e&&0!==Object.keys(e)?.length?await t(e,i):n.error("DiscoverUnauthorizeError: header is empty")};const Rl=async(e,t,n,i)=>jl(e,t,Ll)({policy:n,delay:n.createDelay(),retryCount:0,retriesTable:{},startTime:Date.now().valueOf(),forever:n.foreverCheck,headerUpdate:void 0,lastLicenseErrorTime:-1,options:{userIdentifier:i??void 0}}),jl=(e,t,n)=>async i=>{for(;;){const a=t;i.headerUpdate?.strongConsistencyValue&&(a.headers||(a.headers={}),a.headers.ConsistencyLevel=i.headerUpdate.strongConsistencyValue);try{return await e(a)}catch(e){await n(e,i)}}},Ll=async(e,t)=>{if(!e.serverResponse)throw e;const n=!await t.forever(),{serverResponse:{status:i}}=e;if(-1!==t.startTime&&Date.now().valueOf()-t.startTime>=t.policy.retryMaxTimeMs&&(t.startTime=-1,t.policy.retryMaxTimeCallback(n)),i&&t.policy.isOnline()&&(t.retryCount++<t.policy.maxRetryCount&&!n||n)&&t.policy.shouldRetry(i,t.lastLicenseErrorTime))return t.retriesTable[i]=(t.retriesTable[i]||0)+1,t.policy.errorHandler(e,t);throw e};var Ol=n(118789),$l=n(26073),Ul=n(327372),Bl=n(474454),Wl=n(759795);class Hl{constructor(e,t,n,i,a,o,s,l,c,d,u,m,p,g,y=(0,L.J)()){this._authenticationService=e,this._coreSettings=i,this._scenarioFactory=a,this._networkStateProvider=o,this._hostCommunicationService=s,this._i18n=l,this._authStateProvider=c,this.onDiscoverSuccess=d,this.onDiscoverFail=u,this.isCDLWorker=m,this.cdlAuthClient=p,this._clientConfiguration=g,this.globalScope=y,this._skypeToken=new r.X(null),this._localStorageKeys=[],this._firstMTTokenEstablished=!1,this.cleanup=()=>{this._onlineSubscription?.unsubscribe(),this._onlineSubscription=void 0,this._awakeSubscription?.unsubscribe(),this._awakeSubscription=void 0},this.clearDiscoveryCacheForLogout=async e=>{const t=(0,gl.Xx)(e);this.clearDiscoveryCache(t,["^fn:clearDiscoveryCacheForLogout"])},this.clearDiscoveryCache=(e,t,n)=>{this._skypeToken.next(null),ml.Jt.del((0,Tl.Z2)(e)),t?.push("skypeCacheClear"),n||(ml.Jt.del((0,Tl.Mu)(e)),t?.push("userDetailsCacheClear"),ml.Jt.del((0,Tl.S9)(e)),t?.push("regionGtmsCacheClear")),this._clearFromLocalStorage(n),t?.push("localstorageCacheClear"),this._logger.log(`[clearDiscoveryCache] Discover cache cleared, tokenOnly: ${!!n}.`)},this._getDiscoverResponse=async e=>{const{correlationId:t=(0,vl.pW)(),eventData:n=[]}=e;n?.push("_getDiscoverResponse|startScenario");const i=this._scenarioFactory.newScenario(H.RG.GetSkypeToken);let a;try{if(!this._isAppOnline())throw(0,hi.Tr)({...Tl.bO,correlationId:t});if(!this._coreSettings.get(b.J.Auth).ignoreInteractionRequiredCache&&this._authStateProvider?.getState()?.state===hl.j.InteractionRequired)throw(0,hi.Tr)({...Tl.BD,correlationId:t});a=await this._discoverProvider({...e,correlationId:t,eventData:n}),(0,Tl.nH)(a,this._coreSettings,this._telemetryProvider,this._logger,this._authenticationService)}catch(e){const t=e.errorCode||e.code,{serverResponse:{status:a}={}}=e;throw a===Hs.qb.FORBIDDEN?(this._authStateProvider?.reportSkypeTokenState(hl.Q.LicenseError,e),n?.push("authState:license-error")):t===gi.SM.InteractionRequired?(this._authStateProvider?.reportSkypeTokenState(hl.Q.InteractionRequired,e),n?.push("authState:interactionRequired")):(this._authStateProvider?.reportSkypeTokenState(hl.Q.Failure,e),n?.push("authState:failure")),this.onDiscoverFail&&this.onDiscoverFail(!!this._bootstrapData),(0,Tl.lm)(e,n,this._isAppOnline(),i,this._logger,this._coreSettings)}this._authStateProvider?.reportSkypeTokenState(hl.Q.Success);const o=(0,Tl.ZC)(a,this._logger);await(0,Tl.ut)(e.userIdentifier,o,n,t,this._logger,this._scenarioFactory,this.globalScope,this._hostCommunicationService,this._coreSettings);const r=await(0,Tl.qW)(this._authenticationService,this._logger,n);return(0,gl.FG)(e?.userIdentifier,r)||!e?.userIdentifier?this._skypeToken.next(a.skypeToken):this._logger.error(`[_getDiscoverResponse][${t}] option uid:${e?.userIdentifier}`),i?.stop({reason:n.join(";")}),this.onDiscoverSuccess&&this.onDiscoverSuccess(),a},this._isSkypeTokenValidInMemory=async e=>{const t=e??await(0,Tl.qW)(this._authenticationService,this._logger,[]);return!!ml.Jt.getValue((0,Tl.Z2)(t))},this._retryMaxTimeCallback=e=>e?(this._authStateProvider?.reportSkypeTokenState(hl.Q.Failure),this._logger.error("[_retryMaxTimeCallback]Reporting skype token failure to authState"),!1):(this._logger.warn("[_retryMaxTimeCallback] Reached retry max time."),!1),this._getResponseFromLocalStorage=(e,t)=>{if(!t||!e)return;const n=this._getFromLocalStorage(e,t,"auth.gtm.table"),i=this._getFromLocalStorage(e,t,"auth.skype.token");return n&&i?{...i.userDetails,skypeToken:i.skypeToken,expires:new Date(i.expiration),regionGtms:n}:void 0},this._getCachedResponseWrapper=async e=>this._getResponseFromLocalStorage(e?.profile?.oid,e?.profile?.tid),this._acquireSkypeTokenWeb=async e=>{e.eventData?.push("fn:_acquireSkypeTokenWeb");let t=await this._authenticationService.getUser({accountId:e.userIdentifier.id,userIdentifier:e.userIdentifier,correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:H.RG.AuthWebUser}});if(e.eventData?.push("user:"+ +!!t,"uid:"+ +!!e.userIdentifier,"currentToken:"+ +!!e.currentSkypeToken),!t){if(t=await this._authenticationService.getUser({correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:H.RG.AuthWebUser}}),!t)throw(0,hi.Tr)({context:El.xm,subContext:"_acquireSkypeTokenWeb",errorCode:gi.SM.UserNotFoundError,message:"User not found for provided userIdentifier nor globally.",correlationId:e.correlationId,isExpected:!1});(0,Tl.nD)(e,t,this._logger)}const n=await this._getCachedResponseWrapper(t);if(n)return e.eventData?.push("cache:1"),n;const i=ml.Jt.getValue((0,Tl.Mu)((0,gl.Xx)(t))),a=(0,Tl.TB)(t,e.correlationId,this._coreSettings,this._logger,this._i18n,!!i,this._clientConfiguration),o=this._scenarioFactory.findScenario(H.RG.GetSkypeToken);o?.appendEventData({message:`url: ${a.url}`});let r=await this._sendRequest(e,a,o);return this._coreSettings.get(b.J.Auth).disableRetryOnSameTokenFromAuthZ||r.skypeToken!==e.currentSkypeToken||(e.eventData.push("same-token"),o?.mark(El.j.SKYPE_RECEIVED_SAME_TOKEN,(0,Tl.nd)(e.eventData,this._isAppOnline(),this._coreSettings)),a.authOptions={...a.authOptions,forceRenew:!0},r=await this._sendRequest(e,a,o)),r},this._sendRequest=async(e,t,n)=>{n?.mark(El.j.SKYPE_SEND_REQUEST,(0,Tl.nd)(e.eventData,this._isAppOnline(),this._coreSettings));const i=await this.send({userIdentifier:e.userIdentifier,correlationId:e.correlationId})(t);return e.eventData?.push("response:1"),n?.mark(El.j.SKYPE_RECEIVED_RESPONSE,(0,Tl.nd)(e.eventData,this._isAppOnline(),this._coreSettings)),n&&(n.eventData.authzCorrelationId=i.headers["correlation-id"]??e.correlationId,n.eventData.correlationTags=i.headers["correlation-tags"],n.eventData.correlationId=e?.correlationId),(0,Tl.Qe)(i,e,this._logger,this._coreSettings.get(b.J.Auth).disableAuthzErrorResponseLogging)},this._acquireSkypeTokenDesktop=async e=>{e.eventData?.push("fn:_acquireSkypeTokenDesktop");const t=await this._authenticationService.getUser({accountId:e.userIdentifier.id,userIdentifier:e.userIdentifier,correlation:{id:e.correlationId,source:"discoverV2::_acquireSkypeTokenWeb",scenarioName:H.RG.AuthWebUser}}),n=await this._getCachedResponseWrapper(t);if(n)return n;e.eventData?.push("cache:0");const i=this._scenarioFactory.findScenario(H.RG.GetSkypeToken);i?.mark(El.j.SKYPE_SEND_REQUEST_DESKTOP);const a=await this.globalScope.opener.requestMessage(O.rY.GetStateData,{requestType:"skypeToken",timeout:bl.lP.ACQUIRE_TOKEN_TIMEOUT});i?.mark(El.j.SKYPE_RECEIVED_RESPONSE);const o=a?.skypeTokenData;i&&(i.eventData.correlationId=a?.correlationId);return{userId:(0,Tl.LO)(o?.token?.skypeToken,this._logger),userDetails:o?.userDetails,skypeToken:o?.token?.skypeToken,regionGtms:o?.regionGtms,expires:new Date(o?.token.expiration)}},this._acquireSkypeTokenWorker=async e=>{const{eventData:t}=e;if(t.push("fn:_acquireSkypeTokenWorker"),!this.cdlAuthClient)throw(0,hi.Tr)({context:El.xm,subContext:"_acquireSkypeTokenWorker",errorCode:h.jK.NotPresent,message:"CDL worker auth client unavailable",correlationId:e.correlationId,isExpected:!1});const n=!1!==e.forceRenew,i=this._scenarioFactory.findScenario(H.RG.GetSkypeToken);i?.mark(El.j.SKYPE_SEND_REQUEST_WORKER);const a=await this.cdlAuthClient.getSkypeToken(n);return i?.mark(El.j.SKYPE_TOKEN_RECEIVED_WORKER),{userId:(0,Tl.LO)(a.skypeToken,this._logger),...a.userDetails,skypeToken:a.skypeToken,regionGtms:a.regionGtms,expires:new Date(a.expiration)}},this._getRetryForSend=e=>{const{authzResource:t,disableRetryInDiscoverV2:n}=this._coreSettings.get(b.J.Auth);return i=>{const a=i.correlationId??(0,vl.pW)();if(!this._authenticationService.authorizeV2)throw(0,hi.Tr)({context:El.xm,subContext:"_getRetryForSend",errorCode:"AuthorizeV2NotFound",message:"AuthorizeV2 endpoint not accessible",correlationId:a,isExpected:!1});const o=this._authenticationService.authorizeV2.bind(this._authenticationService),r=()=>(0,wl.B)(o(e,t||bl.ej.MT_AAD_KEY,{userIdentifier:i.userIdentifier}),Hs.qb.OK);return n?r():function(e,t,n){return i=>Rl(e,i,t,n)}(r(),((e,t,n,i,a,o)=>({shouldRetry:Fl,errorHandler:async(i,a)=>{const o=(0,Tl.uc)(t),{serverResponse:{status:r,headers:s}={}}=i;if(!r||!a.retriesTable[r])throw i.reason={...i.reason,scenarioStep:"fail"},i.message=`dicoverRetryPolicy: retry count for ${r} is empty`,i;const l=s?.["correlation-id"],c=s?.["correlation-tags"];o?.appendEventData({authzCorrelationId:l,correlationTags:c}),a.headerUpdate=void 0,await Dl(i,a,n,t,e),e.error(`[DiscoverRetryPolicy]: retrying '[${a.retryCount}]' times due to response status - '[${r}], wait for '[${a.delay.next()}] for next retry..'`);const d=await a.forever();if(a.retryCount>=a.policy.maxRetryCount&&d)throw e.log(`[DiscoverRetryPolicy]: maxTimeReached count: ${a.retryCount} and tokenValid, cancel forever`),i.reason=["LoggedAlready"],i;return(0,Il._)(a.delay.next())},retryMaxTimeMs:bl.lP.DEFAULT_SKYPE_MAX_RETRY_DURATION_MS,maxRetryCount:bl.lP.DEFAULT_SKYPE_MAX_RETRY_COUNT,createDelay:()=>new Nl.df(bl.lP.DEFAULT_SKYPE_MIN_RETRY_INTERVAL_MS,bl.lP.DEFAULT_SKYPE_EXP_DELAY_FACTOR,bl.lP.DEFAULT_SKYPE_MAX_DELAY_TIME_MS),isOnline:i,retryMaxTimeCallback:a,foreverCheck:o}))(this._logger,this._scenarioFactory,this.unauthorizedErrorHandler,this._isAppOnline,this._retryMaxTimeCallback,this._isSkypeTokenValidInMemory),i.userIdentifier)}},this._isRefreshInBackgroundRequired=(e,t,n,i)=>{e?.shouldRefresh&&(n?.push("shouldrefreshbg"),this._debouncedGetDiscoverResponse((0,$.u4)(t),{userIdentifier:t,correlationId:i,eventData:n}).catch((e=>{(0,Tl.H)(e,e?.message,n,this._logger)})))},this._populateDiscoverResponseFromBootstrapdata=()=>{this._bootstrapData=this._coreSettings.get(b.J.Host).authBootstrapData,this._bootstrapData},this._isAppOnline=()=>this._networkStateProvider.getState()===Os.G.Online,this.unauthorizedErrorHandler=async(e,t)=>{(0,Tl.qO)(e,t,this._authenticationService,this._coreSettings,this._logger)},this._logger=t.newLogger(El.xm,"core-services-discover"),(0,$l.g)(this,"DiscoverV2",this._getConfig("mockApi"),this._getConfig("enableMockApi")),this.send=this._getRetryForSend(n),this._debouncedGetDiscoverResponse=(0,Ul.k)(this._getDiscoverResponse);(0,ml.ky)(y,(e=>i?.get(b.J.Auth,[e])?.[e])),this._populateDiscoverResponseFromBootstrapdata(),this._discoverProvider=this.resolveProvider(),this._authenticationService?.registerCleanUpOnLogoutCallback?.(C.D.Discover,this.clearDiscoveryCacheForLogout),this._tokenObserver=this._authenticationService.observeMiddleTierToken?.()?.subscribe((e=>{if(void 0===e)this._logger.log("MT token appears as undefined, deleting skype token for relevant user."),(0,Tl.qW)(this._authenticationService,this._logger,[]).then((e=>{e&&ml.Jt.del((0,Tl.Z2)(e))}));else if(""!==e){const e=this._firstMTTokenEstablished;this._firstMTTokenEstablished=!0,this._logger.log(`Get Skype token on new MT token forceRenew: ${e}.`),this.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:e})}}));const{enableTokenRefreshOnOnline:v,enableTokenRefreshOnWakeUp:f}=this._coreSettings?.get(b.J.Auth);v&&(this._logger.log("Subscribing to Online state for Skype token."),this._onlineSubscription=Wl._i.observeMachineOnline().subscribe((()=>{this._logger.log("Getting skype token on Online."),this.getSkypeTokenInfoFromDiscoveryResponse()}))),f&&(this._logger.log("Subscribing to Suspended state for Skype token."),this._awakeSubscription=Wl._i.observeMachineAwake().subscribe((()=>{this._logger.log("Getting skype token on Suspended."),this.getSkypeTokenInfoFromDiscoveryResponse()}))),this._telemetryProvider=(0,ii.Yf)(),this._logger.log("[ctor]Service initialized.")}observeSkypeToken(){return this._skypeToken.pipe((0,m.h)((e=>null!==e)),(0,Es.x)())}shouldThrowErrorIfSkypeTokenIsEmpty(){return!this._coreSettings.get(b.J.Auth).disableThrowingErrorIfSkypeTokenIsEmpty}getSettingToDisableSkypeTokenValidation(e,t){return(0,Tl.wh)(e,t,this._coreSettings,this._logger,this._scenarioFactory)}shouldSkipTokenRefreshForAnon(){return!this._coreSettings.get(b.J.Auth).disableSkipTokenRefreshForAnon}async regionGtm(e,t){const n=(0,vl.pW)(),i=["^fn:regionGtm:uid:"+ +!!t];try{const a=await this.regionGtmTable(t,n,i),o=a?.[e];if(o)return o===El.sW?o:(0,Qo.m)(o);throw(0,hi.Tr)({correlationId:n,message:`${El.xm}[regionGtm][${n}] ${e} not found in regionGtms table`,isExpected:!0,context:El.xm,subContext:"regionGtm",errorCode:"RegionGtmNotFoundInRespone"})}catch(e){throw(0,Tl.WA)(e,"regionGtm",n),(0,Tl.H)(e,e?.message,i,this._logger)}}async regionGtmTable(e,t=(0,vl.pW)(),n=[]){const i=e??await(0,Tl.qW)(this._authenticationService,this._logger,n);let a=ml.Jt.getValue((0,Tl.S9)(i));if(!a){this._logger.log(`[regionGtm][${t}] No cached regionGtm, start network call..`),n.push("cache:0");const e=await this._debouncedGetDiscoverResponse((0,$.u4)(i),{userIdentifier:i,correlationId:t,eventData:n});a=e?.regionGtms,n.push(`InResponse:${!!a}`)}return a}async skypeid(e){const t=(0,vl.pW)(),n=["^fn:skypeid:uid:"+ +!!e];try{const n=await this.getUser(t,e);if(!n){const e=`[skypeid][${t}] No userDetail for getting skypeId`;throw this._logger.error(e),new Error(`${El.xm} No user for getting skypeId`)}return n.id}catch(e){throw(0,Tl.WA)(e,"skypeid",t),(0,Tl.H)(e,e?.message,n,this._logger)}}async validateSkypeToken(e){return(await this.validateSkypeTokenV2(e)).skypeToken}async validateSkypeTokenV2(e){const t=(0,vl.pW)(),n=["^fn:validateSkypeToken:uid:"+ +!!e?.userIdentifier];try{const i=e?.userIdentifier??await(0,Tl.qW)(this._authenticationService,this._logger,n),a=ml.Jt.get((0,Tl.Z2)(i)),o=a?.item;if(n.push(`cache:${!!o}`),o&&await(0,Ol.p)(o,this.globalScope,this._scenarioFactory,this._hostCommunicationService,this._coreSettings),i?.accountType===ys.Ch.Anonymous&&o?.skypeToken&&!this._coreSettings.get(b.J.Auth).disableIgnoringForceRenewForAnon)return this._authStateProvider?.reportSkypeTokenState(hl.Q.Success),{skypeToken:o.skypeToken,fromCache:!0};const r=e?.forceRenew,s=e?.invalidSkypeToken;if(!r&&o&&o.skypeToken&&o.skypeToken!==s&&o.expiration&&o.expiration>Date.now())return this._isRefreshInBackgroundRequired(a,i,n,t),this._skypeToken.value||this._skypeToken.next(o.skypeToken),this._authStateProvider?.reportSkypeTokenState(hl.Q.Success),{skypeToken:o.skypeToken,fromCache:!0};this.clearDiscoveryCache(i,n,!0),this._logger.log(`[validateSkypeToken][${t}] Skype token not valid during ping of forceRenew:${r}, clear old cache and start wire request.`);const l=await this._debouncedGetDiscoverResponse((0,$.u4)(i),{userIdentifier:i,correlationId:t,eventData:n,currentSkypeToken:o?.skypeToken});return this._logger.log(`[validateSkypeToken][${t}] SkypeToken fetched from network.`),n.push(`InResponse:${!!l.skypeToken}`),{skypeToken:l.skypeToken,fromCache:!1}}catch(e){throw(0,Tl.WA)(e,"validateSkypeToken",t),(0,Tl.H)(e,e?.message,n,this._logger)}}async getRegion(e){const t=(0,vl.pW)(),n=["^fn:getRegion:uid:"+ +!!e];try{const i=e??await(0,Tl.qW)(this._authenticationService,this._logger,n),a=ml.Jt.getValue((0,Tl.Mu)(i));if(a)return a.region;n.push("cache:0"),this._logger.log(`[getRegion][${t}] No user details found in cache. Getting it from request.`);const o=await this._debouncedGetDiscoverResponse((0,$.u4)(i),{userIdentifier:i,correlationId:t,eventData:n});return n.push(`InResponse:${!!o.region}`),o.region}catch(e){throw(0,Tl.WA)(e,"getRegion",t),(0,Tl.H)(e,e?.message,n,this._logger)}}async getUserRegionAndPartitionForMultiGeo(e){const t=(0,vl.pW)(),n=["^fn:getUserRegionAndPartitionForMultiGeo:uid:"+ +!!e];try{const i=e??await(0,Tl.qW)(this._authenticationService,this._logger,n),a=ml.Jt.getValue((0,Tl.Mu)(i));if(a)return{userRegion:a?.userRegion,partition:a?.partition,userPartition:a?.userPartition};n.push("cache:0"),this._logger.log(`[getUserRegionAndPartitionForMultiGeo][${t}] No user details found in cache. Getting it from request.`);const o=await this._debouncedGetDiscoverResponse((0,$.u4)(i),{userIdentifier:i,correlationId:t,eventData:n});return n.push(`InResponse|userRegion:${!!o.userRegion}|partition:${!!o.partition}|userPartition:${!!o.userPartition}`),{userRegion:o?.userRegion,partition:o?.partition,userPartition:o?.userPartition}}catch(e){throw(0,Tl.WA)(e,"userRegionAndPartition",t),(0,Tl.H)(e,e?.message,n,this._logger)}}async getUser(e=(0,vl.pW)(),t){const n=["^fn:getUser:uid:"+ +!!t];try{const i=t??await(0,Tl.qW)(this._authenticationService,this._logger,n);let a=ml.Jt.getValue((0,Tl.Mu)(i));if(a||(this._logger.log(`[getUser][${e}]No cache, start network call...`),n.push("cache:0"),n.push(`IsCDL:${this.isCDLWorker&&this.cdlAuthClient}`),a=this.isCDLWorker&&this.cdlAuthClient?(await this.cdlAuthClient.getUserDetails())?.userDetails:(0,Tl.br)(n,this._bootstrapData,this._logger)||(await this.getSkypeTokenInfoFromDiscoveryResponse({silent:!1,correlationId:e,userIdentifier:t,eventData:n}))?.userDetails),!a)throw new Error(`${El.xm}[getUser][${e}] UserDetails fetched failure from network request`);return(0,Tl.wC)(a,this._logger)}catch(t){(0,Tl.WA)(t,"getUser",e);const i=(0,Tl.H)(t,t?.message,n,this._logger);throw new Bl.l(i)}}async getSkypeTokenInfoFromDiscoveryResponse(e){const{correlationId:t=(0,vl.pW)(),userIdentifier:n}=e||{},i=e?.eventData??[];i?.push("fn:getSkypeTokenInfoFromDiscoveryResponse");try{const a=n??await(0,Tl.qW)(this._authenticationService,this._logger,i),o=e?.forceRenew,r=ml.Jt.get((0,Tl.Z2)(a));if(a?.accountType===ys.Ch.Anonymous&&r?.item?.skypeToken&&!this._coreSettings.get(b.J.Auth).disableIgnoringForceRenewForAnon)return this._authStateProvider?.reportSkypeTokenState(hl.Q.Success),r.item;let s;if(r&&r.item&&!o)this._isRefreshInBackgroundRequired(r,a,i,t),s=r.item;else{i?.push("cache:"+ +!!r?.item,`forceRenew:${o}`),this._logger.log(`[getSkypeTokenInfoFromDiscoveryResponse][${t}] No response retrieved from cache.`),this.clearDiscoveryCache(a,i,!0);const n=await this._debouncedGetDiscoverResponse((0,$.u4)(a),{...e,userIdentifier:a,eventData:i,currentSkypeToken:r?.item.skypeToken});s=(0,Tl.ZC)(n,this._logger)}return this._authStateProvider?.reportSkypeTokenState(hl.Q.Success),s}catch(e){throw(0,Tl.WA)(e,"getSkypeTokenInfoFromDiscoveryResponse",t),(0,Tl.H)(e,e?.message,i,this._logger)}}unsubscribeMtToken(){this._tokenObserver?.unsubscribe()}async getConsumerLicenseDetails(e){const t=(0,vl.pW)(),n=["^fn:getConsumerLicenseDetails:uid:"+ +!!e];try{const i=e??await(0,Tl.qW)(this._authenticationService,this._logger,n);if(!(i.accountType===ys.Ch.MsaLife))return this._logger.log(`[getConsumerLicenseDetails][${t}] User account type is not MsaLife.`),Promise.resolve(void 0);const a=ml.Jt.getValue((0,Tl.Mu)(i)),o=a?.licenseDetails?.consumerLicenseDetails;if(o)return o;n.push("cache:0"),this._logger.log(`[getConsumerLicenseDetails][${t}] No user license details found in cache. Getting it from request.`);const r=await this._debouncedGetDiscoverResponse((0,$.u4)(i),{userIdentifier:i,correlationId:t,eventData:n});return n.push(`InResponse:${!!r?.consumerLicenseDetails}`),r?.consumerLicenseDetails}catch(e){throw(0,Tl.WA)(e,"getConsumerLicenseDetails",t),(0,Tl.H)(e,e?.message,n,this._logger)}}_clearFromLocalStorage(e){this.globalScope?.localStorage&&(e?this._localStorageKeys.forEach((e=>{e.indexOf("auth.skype.token")>-1&&this.globalScope.localStorage.removeItem(e)})):this._localStorageKeys.forEach((e=>{this.globalScope.localStorage.removeItem(e)})),this._localStorageKeys=[])}resolveProvider(){return this._bootstrapData?this._acquireSkypeTokenDesktop:this.isCDLWorker?this._acquireSkypeTokenWorker:this._acquireSkypeTokenWeb}_getFromLocalStorage(e,t,n){if(!this.globalScope?.localStorage)return;let i=`ts.${t}-${e}.${n}`,a=this.globalScope.localStorage.getItem(i);if(a||(i=`ts.${e}.${n}`,a=this.globalScope.localStorage.getItem(i)),a){this._localStorageKeys.push(i);try{return JSON.parse(a)}catch(e){this._logger.error(`[_getFromLocalStorage] ${e}`)}}}_getConfig(e){return this._coreSettings.get(b.J.Auth,[e])[e]}}const Vl=(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,y)=>{const{enableRequireDiscoverV2:v}=i.get(b.J.Auth);return v?new Hl(e,t,n,i,a,r,s,l,c,u,m,p,g,y,h):new Cl.Jq(e,t,n,i,a,o,d,u,m,p,g,h)};var Gl=n(877684);class zl extends _e{constructor(){super(h.Yg.CreateAuthMTMA,["appStateService","loggerFactory","scenarioFactory","networkState","coreSettings","authenticationService","authenticationUser","telemetryService","i18n","deeplinkService","userBiService","hostCommunicationService","platformService"])}async execute(e){const{appStateService:t,loggerFactory:n,scenarioFactory:i,networkState:a,coreSettings:o,authenticationService:r,authenticationUser:s,telemetryService:l,i18n:c,deeplinkService:d,userBiService:u,hostCommunicationService:m,platformService:p}=e,{enableUserAuthT2:g}=o.get(b.J.Auth)||{};if(!g)return;(0,yl.u)(s?.id,u);const h=ql(s);try{if(!s)throw new Error("No AuthenticationUserContext found during User Auth init.");if(!r.createUserAuth)throw new Error("No User Auth Creation API exposed.");const u=new Sl(n,o,s.id);e.authStateProvider=u,h.addEventData(["authState:created"]);const g=r.createUserAuth?.(s,"create-auth-mtma-task",u,d);e.authenticationService=g,h.addEventData(["userAuth:created"]);const y=(0,Gl.Gg)(t);let v;if(o.get(b.J.Telemetry).useTelemetryServicesCache){v=l.getTelemetryServicesCache().get(s.id);const e=ml.Jt.getValue((0,pl.VF)({id:s.id}).telemetryInfo);h.setUserToTelemetryContext({id:s.id,oid:s.profile.objectId,tid:s.profile.tenantId,type:s.type,role:s.role,subType:s.subType,isCrossCloudUser:!!e?.isCrossCloudUser,isExternal:(0,gl.b9)(s.id,s.homeAccountId)})}const f=Vl(g,n,cl.l,o,v?.coreScenarioFactory||i,y,a,m,c,u,void 0,void 0,void 0,void 0,void 0,void 0,{clientVersion:p.config.clientVersion,clientType:p.config.clientType});return e.discover=f,h.addEventData(["discover:created"]),f.validateSkypeToken(),o.get(b.J.Telemetry).useTelemetryServicesCache&&f.getRegion().then((e=>h.setUserDetailsToTelemetryContext({region:e||""}))),h.closeScenario(),Jl(u,l,s.id),e=>{switch(e){case"quit":case"restart":break;default:f.cleanup?.(),u?.cleanupObservables()}}}catch(e){const t=e instanceof Bl.l?e:new Bl.l(e);throw h.closeScenario({error:t.prevError??e}),t}}}const ql=e=>{const t={id:(0,vl.pW)(),scenarioName:H.RG.AuthUserInit,source:"create-auth-mtma-task::execute"};return yl.cv.create({correlation:t,subContext:"createAuthMTMATask",timeoutMs:gi.rF.ONE_HOUR,scenarioEventData:{context:`id:${!!e?.id}`,accountId:e?.id}})},Jl=(e,t,n)=>{e.observe().subscribe((e=>{t.setContext("UserInfo.AuthState",e.state,void 0,n)}))},Ql="auth-cache",Kl="key",Yl=async(e,t,n)=>new Promise((async(i,a)=>{try{const o=await Zl(e),r=Xl(o,"readwrite",i,a),s=((e,t)=>({[Kl]:t,value:e}))(t,n),l=r.put(s);l.onerror=e=>{o.close(),a(`[putToIDB] error: ${e}`)},l.onsuccess=()=>{o.close(),i()}}catch(e){a(`[putToIDB][catch] error: ${e}`)}})),Xl=(e,t,n,i)=>{ec(e,i)||i("Transaction not valid");const a=e.transaction(Ql,t);return a.onerror=t=>{e.close(),i(t)},a.oncomplete=()=>{e.close(),n()},a.onabort=t=>{e.close(),i(t)},a.objectStore(Ql)},Zl=e=>new Promise(((t,n)=>{const i=e.open("Teams:auth",1);i.onsuccess=()=>{const e=i.result;t(e)},i.onerror=()=>{n(`IndexedDB error: ${i.error}`)},i.onblocked=()=>{n("IndexedDB error: BLOCKED")},i.onupgradeneeded=e=>{const t=i.result;if(!t.objectStoreNames.contains(Ql)||e.oldVersion<1){const e=t.createObjectStore(Ql,{keyPath:Kl});e&&!e.indexNames.contains("key")&&e.createIndex("key",Kl)}t.close()}})),ec=(e,t)=>e?!!e.objectStoreNames.contains(Ql)||(t(`objectStore does not exists: ${Ql}`),!1):(t("You need to use the openDatabase function to create a database before you query it!"),!1);class tc{constructor(e){this._indexedDbStorage=e.indexedDB}async put(e,t){await Yl(this._indexedDbStorage,t,e)}async getValue(e){return(async(e,t)=>new Promise((async(n,i)=>{try{const a=await Zl(e),o=Xl(a,"readonly",n,i).get(t);o.onerror=e=>{a.close(),i(`[IndexDB][getFromIDB] error: ${e}`)},o.onsuccess=e=>{a.close(),n(e?.target?.result?.value)}}catch(e){i(`[getFromIDB][catch] error: ${e}`)}})))(this._indexedDbStorage,e)}async del(e){await(async(e,t)=>new Promise((async(n,i)=>{try{const a=await Zl(e),o=Xl(a,"readwrite",n,i).delete(t);o.onsuccess=e=>{a.close(),n(e?.target)},o.onerror=e=>{a.close(),i(`Error in deleteRequest: ${e}`)}}catch(e){i(`[deleteFromIDB][catch] error: ${e}`)}})))(this._indexedDbStorage,e)}}var nc=n(970076),ic=n(581302),ac=n(23279),oc=n(527098);const rc=(e,t,n)=>{const{environment:i}=n.get(b.J.Metadata,["environment"])??{},{clientType:a,currentUrl:o,hostingParent:r,isInIframe:s,isInCypressFrame:l,browser:c,browserVersion:d,osPlatform:u,osVersion:m,clientVersion:p}=t.config;return{...e,clientType:a,currentUrl:o,hostingParent:r,isInIframe:s,isInCypressFrame:l,browser:c,browserVersion:d,osPlatform:u,osVersion:m,environment:i,clientVersion:p}},sc=async e=>{e.initializeAuthenticationService&&await e.initializeAuthenticationService()},lc=(e,t,n,i)=>{const a={id:(0,vl.pW)(),scenarioName:H.RG.AuthStart,source:"core-auth-tasks::init"};return ml.Jt.put(pl.Jl.authSessionId,a.id),yl.cv.create({correlation:a,subContext:"createAuthenticationServiceInstance",timeoutMs:gi.rF.ONE_HOUR,scenarioEventData:{context:`env:${e}||host:${t}||v2:${+!!n}||global:${+!!i}`}})},cc=async(e,t,n)=>{e.registerCleanUpOnLogoutCallback?.("BatchAuthTelemetry",(e=>(0,ic.mM)(t,n,(0,gl.Xx)(e))))};class dc extends _e{constructor(){super(h.Yg.CreateAuth,[])}async execute(e){e.authenticationService=await(async e=>{const{loggerFactory:t,scenarioFactory:i,config:a,appStateService:o,coreSettings:r,windowProvider:s,platformService:l,authStateProvider:c,hostCommunicationService:d,telemetryService:u,i18n:m,rebootService:p,userBiService:g,endpointsManager:h,crossTabsService:y,networkState:v,hostState:f}=e,S=(0,ml.ky)(s,(e=>r?.get(b.J.Auth,[e])?.[e])),k=new tc(s),C=(0,nc.N)(k);(0,yl.Tu)(i,C,u),(0,Wl.rt)(f,v),(0,yl.u)(void 0,g);const w=(0,oc.fZ)(t,y),T=rc(a,l,r),I=(0,Gl.Gg)(o),{enableAuthV2:N,enableUserAuthT2:E,deleteBatchScenarioFromStorage:A,enableAsyncBatchScenario:_}=r?.get(b.J.Auth,["enableAuthV2","enableUserAuthT2","deleteBatchScenarioFromStorage","enableAsyncBatchScenario"])||{},F=lc(T.environment??"",s?.location?.hostname,!!N,!!E);let D;try{D=N?E?new((await(0,ac.mT)((()=>Promise.all([n.e(33682),n.e(399082),n.e(608983)]).then(n.bind(n,672465))),"global-auth",i)).GlobalAuthService)(t,i,T,s,d,w,m,r,p,h):new((await(0,ac.mT)((()=>Promise.all([n.e(33682),n.e(399082),n.e(496106)]).then(n.bind(n,196340))),"auth_v2",i)).AuthenticationService)(t,i,T,s,d,w,m,c,r):new((await(0,ac.mT)((()=>Promise.all([n.e(8653),n.e(439351),n.e(159818)]).then(n.bind(n,183240))),"auth",i)).AuthenticationService)(t,i,I,T,s,u,r,d),await sc(D),_&&await cc(D,i,C),A&&(0,ic.Q7)(S),F.closeScenario()}catch(e){const t=e instanceof Bl.l?e:new Bl.l(e);throw F.closeScenario({error:t.prevError??e}),t}return D})(e)}}var uc=n(697968),mc=n(602870);const pc=(e,t,n,i)=>{if(i?.get(b.J.Auth)?.enableMtoCoachMark){const i=t?.some((e=>"DefaultHidden"===e?.userTenantState&&"MTO"===e?.tenantRelationship));i&&e?.recordAuthUserBiTelemetry(n,{scenario:uc.dX.authMtoUser})}const a=t?.some((e=>"MTO"===e?.tenantRelationship));a&&e?.recordAuthUserBiTelemetry(n,{scenario:uc.dX.authHasMtoTenant})},gc=(e,t)=>yl.cv.create({correlation:e,subContext:"createAuthTenantsTask",timeoutMs:gi.rF.ONE_HOUR,scenarioEventData:{accountId:t?.id}});class hc extends _e{constructor(){super(h.Yg.CreateAuthTenants,[])}async execute(e){const t=e;await(async e=>{const{coreSettings:t,authenticationUser:n,endpointsManager:i,authenticationService:a}=e,{enableUserAuthT2:o,enableMultiTenants:r}=t.get(b.J.Auth)||{};if(!n)throw new Error("No AuthenticationUserContext found during OnUserAuthenticated_MTMA hook");const{testAutomation:s}=t.get(b.J.Test)||{};if(!o||!r||!(0,mc.Kf)(n))return;const l={id:(0,vl.pW)(),scenarioName:H.RG.AuthWebSetUpTenants,source:"create-auth-tenants-task::setupTenantService"},c=gc(l,n);try{if(!a.setUpTenantsService||!a.getTenants)throw new Error("No TenantsService Set Up found duringGetTenants Task");const e={accountId:n.id,correlation:c.correlation,forceRefresh:!s};try{await a.setUpTenantsService(i,e)}catch(e){return void c.closeScenario({error:e})}c.addEventData(["tenantService:created"]),a.getTenants(e).then((e=>{c.appendScenarioEventData({tenantCount:e?.length}),pc(c,e,n.id,t),c.closeScenario()})).catch((e=>{c.closeScenario({error:e})}))}catch(e){const t=e instanceof Bl.l?e:new Bl.l(e);throw c.closeScenario({error:t.prevError??e}),t}})(t);const{enableTenantPolling:n}=t.coreSettings.get(b.J.Auth);if(!n)return;const i=await(async e=>{const{coreSettings:t,authenticationService:n,windowProvider:i,authenticationUser:a,correlation:o}=e;if(!a)throw new Error("No AuthenticationUserContext found during OnUserAuthenticated_MTMA hook");if(a.homeAccountId!==a.id||!(0,mc.Kf)(a))return;const r=t.get(b.J.Auth)?.tenantPollingMiliseconds||gi.rF.ONE_DAY,s=i.setInterval((async()=>{const e={id:o.id,scenarioName:H.RG.AuthWebGetTenantsInterval,source:"create-auth-tenants-task::tenantPollingInterval"},r=gc(e,a);try{const i={accountId:a.id,forceRefresh:!0,correlation:e};if(!n.getTenants)throw new Error("No valid getTenants function inside tenant polling interval");const o=await n.getTenants(i);pc(r,o,a.id,t),r.addEventData(["tenantService:AuthWebTenantPolling"]),r.appendScenarioEventData({tenantCount:o?.length}),r.closeScenario()}catch(e){r.closeScenario({error:e}),i.clearInterval(s)}}),r);return Promise.resolve(s)})(t);return e=>{i&&"signout"===e&&t.windowProvider.clearInterval(i)}}}var yc=n(645742),vc=n(965517);function fc(e){const t=e.get(b.J.Host),n=t?.userType??"";return"user"===n||""===n?"False":"True"}var Sc=n(330760);class kc{constructor(e,t,n){this.aad=e,this.discover=t,this.coreSettings=n,this.cmdMTAuthResource=e=>this._cmdMtAuthorize(e),this.mtAuthResource=e=>{const{requireSkypetokenForMT:t}=this.coreSettings.get(b.J.Auth);return this._mtAuthorize(e,t||!1)},this.skypeAuthResource=async e=>this._authorizeWithSkypeTokenMigration(e),this.skypeAuthorizeAuthResource=e=>this._authorizeWithSkypeTokenMigration(e,"Authorization"),this.skypeXTokenAuthResource=e=>this._authorizeWithSkypeTokenMigration(e,"x-skypetoken"),this.mtAuthWithSkypeXTokenResource=e=>this._mtAuthorize(e,!0),this.authorizeByUrl=(e,t)=>{const n=new URL(e.url),i=t?"/":"",a=`${n.protocol}//${n.host}${i}`;return this.aad.authorizeRequest(e,a)},this._migrateSkypeToken=(e,t,n)=>{e.headers&&(e.headers[gi.kI]="True",e.headers[gi.lG]=fc(this.coreSettings));const{ic3NonCaeResource:i,ic3CaeResource:a}=this.coreSettings.get(b.J.Auth),o=t===vc.Zw.CAE?a??gi.ej.IC3_GATEWAY_CAE_KEY:i??gi.ej.IC3_GATEWAY_AAD_KEY,r=this._composeAuthResourcesForStm((e=>this.aad.authorizeRequest(e,o)),n);return r(e)},this._cmdMtAuthorize=e=>this.aad.getUser().then((()=>{const{cmdMeetingArtifactsServiceResource:t}=this.coreSettings.get(b.J.CMDMeetingArtifactsService);return(e=>this.aad.authorizeRequest(e,t??""))(e)})),this._mtAuthorize=(e,t)=>this.aad.getUser().then((()=>{const{enableSkypeTokenMigrationForMT:n}=this.coreSettings.get(b.J.Auth);if(n&&t){const{stmHeader:n,overwrittenRequireSkypetokenForMT:i}=this._getStmInfoForSources(e);t=i,e.headers={...e.headers,...n}}const i=(0,Tl.JY)(this.coreSettings),a=e=>this.aad.authorizeRequest(e,i);return(t?this.composeAuthResources(a,this.skypeXTokenAuthResource):a)(e)})),this._getStmInfoForSources=e=>{const{stmSourceList:t=[]}=this.coreSettings.get(b.J.Auth),n=e.authOptions||{},i={stmHeader:{},overwrittenRequireSkypetokenForMT:!0},a=t?.find((e=>e?.source===n?.source));return a?(i.stmHeader={[gi.kI]:"True",[gi.lG]:fc(this.coreSettings)},a?.disableSkypeTokenInHeader&&(i.overwrittenRequireSkypetokenForMT=!1),i):i},this.skype=new yc.q(this.discover)}composeAuthResources(e,t){return async n=>e(n).then((e=>t(e.request).then((t=>({request:t.request,resolver:async(n,i)=>{const a=await t.resolver(n,i);return await e.resolver(n,a||i)}})))))}_authorizeWithSkypeTokenMigration(e,t){const{skypeTokenMigrationEnabled:n}=this.coreSettings.get(b.J.Auth);return n?this.aad.getUser().then((n=>{const i=e.authOptions||{};let a=i?.source?(0,Sc.xT)(i?.source,this.coreSettings,void 0,n):vc.Zw.Skype;const{disableSTMFallback:o}=this.coreSettings.get(b.J.Auth),{skypeTokenFallbackMap:r}=this.aad;if(!o&&i?.source&&r){const e=(0,Sc.eH)(r,i?.source,this.coreSettings);void 0!==e&&(a=(0,Sc.JX)([e],a))}return i?.source&&a!==vc.Zw.Skype?this._migrateSkypeToken(e,a,t):this.skype.authorizeRequest(e,t)})).catch((()=>{const{disableSTMFallback:n}=this.coreSettings.get(b.J.Auth);if(n)throw(0,hi.Tr)({context:"authentication-resources",subContext:"disableSTMFallback",errorCode:gi.SM.InvalidToken,message:"disableSTMFallback: true, STM fallback logic blocked",correlationId:"",isExpected:!0});return this.skype.authorizeRequest(e,t)})):this.skype.authorizeRequest(e,t)}_composeAuthResourcesForStm(e,t){return async n=>e(n).then((e=>({request:e.request,resolver:async(n,i)=>{try{return await e.resolver(n,i)}catch(e){if(e?.errorCode===gi.SM.FallbackWithSkypeToken){i?.headers&&delete i.headers.Authorization;return(await this.skype.authorizeRequest(i,t)).request}throw e}}})))}}class Cc extends _e{constructor(){super(h.Yg.CreateAuthenticationResources,["authenticationService","discover","coreSettings"])}async execute(e){e.authenticationResources=new kc(e.authenticationService,e.discover,e.coreSettings)}}class bc extends _e{constructor(){super(h.Yg.CreateAuthStateTask,["loggerFactory","coreSettings","telemetryService"]),this._updateTelemetryOnClientStateChange=(e,t)=>{e.observe().subscribe((e=>{t.setCoreContext("AppInfo.AuthState",e)}))}}async execute(e){const{loggerFactory:t,coreSettings:n,telemetryService:i}=e,{enableAuthState:a,enableUserAuthT2:o}=n.get(b.J.Auth);if(!a||o)return;const r=new Sl(t,n);e.authStateProvider=r,this._updateTelemetryOnClientStateChange(r,i)}}class wc extends _e{constructor(){super(h.Yg.CreateCacheClearing,["clientState","windowProvider"]),this._clearCacheOnClientStateChangeToInactive=(e,t)=>{e.observe().subscribe((async e=>{e===Fe.pk.Inactive&&(await(this.dataEvictionService?.evict()),t.clearCache())}))}}async execute(e){const{clientState:t,windowProvider:n,dataEvictionService:i}=e;this.dataEvictionService=i,this._clearCacheOnClientStateChangeToInactive(t,n)}}class Tc{constructor(e,t,n,i){this._caches=e,this._tenantId=t,this._userId=n,this._experienceName=i}setUserAndTenantIds(e,t){this._tenantId=e,this._userId=t}createRequest(e,t,n,i,a=!1,o=this._experienceName){const r=this._getFormatKey(t,o,n,a);return{cacheName:e,request:new Request(r,i)}}async add({cacheName:e,request:t}){return(await this._caches.open(e)).add(t)}async addAll(e){const{cacheName:t}=e[0],n=e.map((({request:e})=>e));return(await this._caches.open(t)).addAll(n)}async delete({request:e,cacheName:t},n){return(await this._caches.open(t)).delete(e,n)}async keys(e,t,n){return(await this._caches.open(e)).keys(t,n)}async match({request:e,cacheName:t},n){return(await this._caches.open(t)).match(e,n)}async matchAll({request:e,cacheName:t},n){return(await this._caches.open(t)).matchAll(e,n)}async put({request:e,cacheName:t},n){return(await this._caches.open(t)).put(e,n)}async clear(e){return this._caches.delete(e)}_getFormatKey(e,t,n,i){try{return new URL(e),e}catch{let a="";switch(n){case"Experience":a=`${t}/${e}`;break;case"User":if(!this._tenantId||!this._userId)throw new Error("tenantId and userId must be defined for storage scope User.");a=`${this._tenantId}/${this._userId}/${e}`;break;case"Global":a=e;break;case"UserAndExperience":if(!this._tenantId||!this._userId)throw new Error("tenantId and userId must be defined for storage scope UserAndExperience.");a=`${this._tenantId}/${this._userId}/${this._experienceName}/${e}`;break;default:return`/${e}`}return i?`//${a}`:a}}}class Ic{constructor(e,t){this._cacheStorage=e,this._cacheName="offline-cache-manager",this._logger=t.newLogger("OfflineCacheManager","services-io-browser-cache-storage")}setUserAndTenantIds(e,t){this._cacheStorage.setUserAndTenantIds(e,t)}async save(e,t,n,i=!0){if(!e)throw this._error("get","Invalid key");try{this._logger.log(`saving item to offline cache: ${e}`);const a=this._getScopedRequest(e,n,i);return await this._cacheStorage.put(a,t),a.request.url}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name}, message${e.message}`),this._error("save","Failed to save object to cache")}}async saveDynamic(e,t,n=!0){const i=(0,Re.v4)();return[i,await this.save(i,e,t,n)]}async get(e,t,n,i=!0){if(!e)throw this._error("get","Invalid key");try{const n=this._getScopedRequest(e,t,i),a=await this._cacheStorage.match(n);if(!a)throw this._error("get","Object not found");return a}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name}, message${e.message}`),this._error("get","Failed to get item from cache")}}async getAll(e,t,n){try{return await this._cacheStorage.keys(this._cacheName,e?this._getScopedRequest(e,t).request:void 0,n)}catch(e){throw e instanceof DOMException&&this._logger.error(`DOMException name:${e.name} code:${e.code}`),this._error("getAll","Failed to get keys from cache")}}async delete(e,t){if(!e)throw this._error("get","Invalid key");this._logger.log(`deleting item from offline cache: ${e}`);const n=this._getScopedRequest(e,t);return this._cacheStorage.delete(n)}async clear(){return this._logger.log("clearing offline cache"),this._cacheStorage.clear(this._cacheName)}getCachedUrlByKey(e,t){return this._getScopedRequest(e,t).request.url}_error(e,t){const n=(0,de.Tr)("OfflineCacheManager",h.jK.Undefined,e,void 0,t);return this._logger.error(n.message),n}_getScopedRequest(e,t,n=!0){return this._cacheStorage.createRequest(this._cacheName,`${this._cacheName}/${e}`,"UserAndExperience",t,n)}}class Nc extends _e{constructor(){super(h.Yg.CreateCacheStorageAndCacheManagers,[])}async execute(e){const{authenticationUser:t,windowProvider:n,config:i,loggerFactory:a}=e;t&&(e.cacheStorage=new Tc(n.caches,t.profile.tenantId,t.profile.objectId,i.experienceName)),e.cacheStorage&&(e.offlineCacheManager=new Ic(e.cacheStorage,a))}}var Ec=n(459529),Ac=n(682881);class _c{constructor(e){this.context=e,this._appServiceStateMap=this._newAppServiceStateMap(),this._logger=e.loggerFactory.newLogger("CDLApplicationStateService","core-services-app-state")}notifyServiceUp(e,t,n){this.notifyAppServiceStateChange(e,t,Ac.l.ONLINE,n)}notifyServiceDown(e,t,n,i){this.notifyAppServiceStateChange(e,t,Ac.l.OFFLINE,n,i)}observeAppServiceState(){const e=Array.from(Object.values(this._appServiceStateMap)).map((e=>e.asObservable().pipe((0,ut.g)("currentState"))));return(0,Ec.T)(...e)}_newAppServiceStateMap(){return Object.values(Ac.Q).reduce(((e,t)=>{var n;return e[t]=(n=t,new r.X({appService:n,currentState:Ac.l.UNKNOWN})),e}),{})}notifyAppServiceStateChange(e,t,n,i,a){if(!!this.context.coreSettings.get(b.J.CdlWorker).enableUserContextWorkerRegistration&&this.context.cdlWorkerRegistrarService?.mainWindowWorkerId!==e.workerId)return void this._logger.infoToTelemetry?.(`Filtered out appService state changed from worker (originating worker = ${e.workerId}, main window worker id = ${this.context.cdlWorkerRegistrarService.mainWindowWorkerId})`,"cdl_app_state_notification_filtered_out",{origin:e.workerId,target:this.context.cdlWorkerRegistrarService.mainWindowWorkerId,context:t},!0);const o=this._appServiceStateMap[t],r={appService:t,previousState:o.getValue().currentState,currentState:n,currentStateChangeTimestamp:new Date,currentStateChangeReason:i,currentStateChangeCode:a};this._logger.infoToTelemetry?.(`Received appService state change for ${t} (current state = ${r.currentState}, previous state = ${r.previousState}) from worker '${e.workerId}'`,"cdl_app_state_change_notification",{origin:e.workerId,target:this.context.cdlWorkerRegistrarService.mainWindowWorkerId,context:t},!0),o.next(r)}}class Fc{constructor(e){this.logger=e}log(e,t){return e?this.safeWrapILoggerCall(((e,t)=>this.logger.log(e,t)),e,t):ne.V.None}warn(e,t){return e?this.safeWrapILoggerCall(((e,t)=>this.logger.warn(e,t)),e,t):ne.V.None}debug(e,t){return this.safeWrapILoggerCall(((e,t)=>this.logger.debug(e,t)),e,t)}error(e,t,n){return e&&n?this.safeWrapILoggerCall(((e,t)=>this.logger.error(e,t)),e,t,n):ne.V.None}errorToTelemetry(e,t,n,i){return this.logger.errorToTelemetry?this.logger.errorToTelemetry(e,t,n,i):this.logger.error(e)}warnToTelemetry(e,t,n,i){return this.logger.warnToTelemetry?this.logger.warnToTelemetry(e,t,n,i):this.logger.warn(e)}debugToTelemetry(e,t,n,i){return this.logger.debugToTelemetry?this.logger.debugToTelemetry(e,t,n,i):this.logger.debug(e)}infoToTelemetry(e,t,n,i){return this.logger.infoToTelemetry?this.logger.infoToTelemetry(e,t,n,i):this.logger.log(e)}safeWrapILoggerCall(e,t,n,i){return function(e){return(0,W.isObject)(e)&&"hostRendererId"in e&&"component"in e}(n)?e(this.serializeMessageFromParams(t,n,i),{loggerName:n.component}):e(t,{loggerName:"CDLNoLoggingContext"})}serializeMessageFromParams(e,t,n){const i={...n?{errorCode:n}:{},...t?{requestId:t.requestId,component:t.component,requestRendererId:t.requestRendererId,requestWindowId:t.requestWindowId,operationType:t.operationType,operationName:t.operationName,requestType:t.requestType,timeOfRequest:t.timeOfRequest,correlationId:t.correlationId,callerInfo:t.callerInfo,callerScenarioId:t.callerScenarioId}:{},message:e,...t};return JSON.stringify(i,void 0,"").replace(/\\|"/g,"")}}const Dc=(e,t,n,i,a,o,r,s,l,c,d,u,m,p=!1,g)=>{let h={};if(e&&(h={experienceName:e}),t&&(h={...h,ring:t}),n&&(h={...h,environment:n}),i&&(h={...h,sessionId:i}),a&&(h={...h,platformId:a}),o&&(h={...h,buildVersion:o}),r&&(h={...h,localeCode:r}),s&&(h={...h,workerId:s}),l&&(h={...h,preAuthUserId:l}),u&&(h={...h,publicPath:u}),void 0!==d?h={...h,userConsoleLogLevel:d}:void 0!==c&&(h={...h,preECSConsoleLogLevel:c}),m&&(h={...h,deviceId:m}),p){const e=new Date(Date.now());h={...h,date:`${e.getMonth()}-${e.getDate()}`}}return g&&(h={...h,telemetryWorkerBroadcast:g}),JSON.stringify(h)};let Pc;const Mc=(e,t,n,i,a,o)=>class{constructor(r){const s=i?`${r}#${i}`:r,l=typeof e==typeof Worker?"cdlWorker":"cdlsharedWorker";xc(t,s,!1,l,n),a?.(s);const c=((e,t,n)=>{if(Pc)return Pc;try{const e=n||"@msteams/core-cdl-worker-common#create-cdl-worker";return Pc=window.trustedTypes?.createPolicy(e,{createScriptURL:e=>Rc(e,t)}),Pc}catch(n){t.errorToTelemetry?.(`Create CDL worker URL trustedType policy failed. This is not a critical error, falling back to function validation. Error ${n}`,"cdl_worker_startup_error_trusted_policy",{endpointUrl:e},!0)}})(s,t,o);if(c){const t=c.createScriptURL(s);return new e(t)}const d=Rc(s,t);return new e(d)}},xc=(e,t,n,i,a)=>{e.log(`{"hostRendererId":${i},"component":${a} Creating CDL Worker with ${n?"passed":"determined"} url ${t} }`)};function Rc(e,t){try{const t=new URL(e,jc().location.origin);let n=!0,i="CDL Web worker URL is invalid.";if(t.origin!==jc().location.origin&&(i=i.concat("OriginValidationFailed"),n=!1),n)return e;throw new Error(i)}catch(n){t.errorToTelemetry?.("CDL web worker url is not valid","cdl_worker_startup_error_invalid_url",{endpointUrl:e},!0);const i=new Error(n.message);throw i.name="InvalidUrl",i}}function jc(){return window}var Lc=n(321713),Oc=n.n(Lc);class $c{constructor(e,t){this.logger=e,this.loggingContext=t,this.isCompleted=!1,this.subscriptions=new Set,this.observable$=new(Oc())((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e){return this.isCompleted&&this.logger.error("Subject - tried to subscribe to a complete observable",this.loggingContext,h.jK.NotPresent),this.observable$.subscribe(e)}onNext(e){this.subscriptions.forEach((t=>{t.next(e)}))}onComplete(){this.isCompleted=!0,this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.isCompleted=!0,this.subscriptions.forEach((t=>{t.error(e)}))}}class Uc{constructor(e){this._state=null,this._checkpoints=new Set,this._context={bootstrapServices:e.bootstrapServices,loggingContext:{hostRendererId:e.loggingContext.hostRendererId,component:"CDLGlobalState"}},this.subject=new $c(e.bootstrapServices.logger,this._context.loggingContext)}get current(){return this._state}setState(e,t){if(!e)throw new TypeError("state should have name specified");this.hasReachedCheckpoint(e)||(this._context.bootstrapServices.logger.log(`Global state has reached checkpoint ${e}`,this._context.loggingContext),this._checkpoints.add(e),this._state=e,this.subject.onNext({newState:e,args:t}))}subscribe(e){return this.subject.subscribe(e)}hasReachedCheckpoint(e){if(!e)throw new TypeError("state should have name specified");return this._checkpoints.has(e)}}var Bc=n(88462),Wc=n(834651);class Hc{constructor(e,t,n,i){this._context=i,this._clients=new Map,t.forEach(((t,a)=>{const o=new t((t=>e(t)),n,i,a);this._clients.set(a,o)})),i.bootstrapServices.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Success",stepName:"ClientResponseRouterCreated"})}get cdlControlClient(){return this._clients.get(Bc.k.control)}get cdlDiagnosticsClient(){return this._clients.get(Bc.k.diagnostics)}get cdlAuthClient(){return this._clients.get(Bc.k.auth)}get cdlAppServiceClient(){return this._clients.get(Bc.k.appService)}get cdlAppStateClient(){return this._clients.get(Bc.k.appState)}get cdlDatabaseClient(){return this._clients.get(Bc.k.database)}get cdlSyncEngineClient(){return this._clients.get(Bc.k.syncEngine)}get cdlGraphQLClient(){return this._clients.get(Bc.k.graphql)}get cdlNetworkStateClient(){return this._clients.get(Bc.k.networkState)}get cdlEndpointsHealthClient(){return this._clients.get(Bc.k.endpointHealth)}get telemetryClient(){return this._clients.get(Bc.k.telemetry)}handleResponse(e){const t=this._clients.get(e.type);if(!t)throw this._context.bootstrapServices.logger.errorToTelemetry?.(`no client is configured for response type ${e.type}`,"cdl_client_no_client_configured_error",{...(0,Wc.n)(this._context.loggingContext),queryId:e.requestId,windowId:e.windowId,origin:"CDLClientResponseRouter",errorCode:h.jK.Unknown},!0),new TypeError(`no client is configured for response type ${e.type}`);return t.handleResponse(e)}cleanup(){this._clients.forEach((e=>{Object.keys(e).forEach((t=>e[t]=void 0))})),Object.keys(this).forEach((e=>this[e]=void 0))}}class Vc{constructor(e,t,n,i){this._bootstrapServices=e,this._stateAndRequestHandlers=i,this._globalState=n,this._context={component:"CDLServer",hostRendererId:t},this._bootstrapServices.logger.log("Booted up server",this._context),this._bootstrapServices.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Success",stepName:"CDLServerCreated"})}handleRequest(e,t,n){const i=performance.now(),a=this._stateAndRequestHandlers.get(e.type);return a?a.stateMachine.isCompleted().then((o=>{const r=performance.now(),s={requestStartTime:i,stateMachineTime:r-i};return this._handleMessage(e,t,a.requestHandler,s,n,o).catch((t=>{!!(0,de.Wc)(t)||this._bootstrapServices.logger.errorToTelemetry?.(`Failed to process request due to error ${(0,de.VK)(t)}`,"cdl_server",{...(0,Wc.n)(this._context),origin:e.requestId,correlationId:e.rendererId,conversationId:e.windowId,type:e.type},!0)}))})).catch((n=>this._returnCriticalError(e,t,`State machine init failed for request of type ${e.type} with error ${(0,de.VK)(n)}`,n))):this._returnCriticalError(e,t,`StateMachine and requestHandler not defined for request of type ${e.type}`)}start(){this._globalState.setState("Server_Start")}cleanup(){this._stateAndRequestHandlers.forEach((e=>{Object.keys(e).forEach((t=>e[t]=void 0))})),Object.keys(this).forEach((e=>this[e]=void 0))}_handleMessage(e,t,n,i,a,o){const r=this._decorateResponseCallback(e,t,i);return n.handle(e,r,{bootstrapServices:this._bootstrapServices,loggingContext:{hostRendererId:this._context.hostRendererId,requestId:e.requestId,requestRendererId:e.rendererId,requestWindowId:e.windowId,requestType:e.type},portId:a},o)}_decorateResponseCallback(e,t,n){return i=>{const a=performance.now()-n.requestStartTime,o=a-n.stateMachineTime;if(n={...n,handlerResponseTime:o},"graphql"===e.type){const n=i.response;n.extensions={...n.extensions},n.extensions.perfStats={...n.extensions.perfStats,workerResponseTime:a,dataStorePerfStats:[]},t({requestId:e.requestId,rendererId:e.rendererId,windowId:e.windowId,type:e.type,extensions:n.extensions,...i})}else t({requestId:e.requestId,rendererId:e.rendererId,windowId:e.windowId,type:e.type,...i,...n,extensions:{},workerResponseTime:a})}}_returnCriticalError(e,t,n,i){return Promise.reject(t({windowId:e.windowId,requestId:e.requestId,type:e.type,response:{errors:n,errorCode:i?.errorCode||i?.code,error:i},status:"failure",rendererId:e.rendererId,extensions:{},workerResponseTime:-1}))}}function Gc(e,t,n,i){e.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"InProgress",stepName:"CDLPeerCreated"});const a=new Hc((e=>t.postMessageCallback(JSON.stringify(e))),t.clients,{rendererId:i},{bootstrapServices:e,loggingContext:{hostRendererId:i}}),o=new Vc(e,i,n.globalState,n.requestAndStateHandlers);return e.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Success",stepName:"CDLPeerCreated"}),{workerServer:o,workerClientResponseRouter:a,onMessageCallback:(t,n,r)=>{const s=Date.now(),l=t.data&&JSON.parse(t.data);if(l&&l.rendererId===i){const e=l.response?.extensions?.perfStats;e&&(e.payloadLength=t.data.length),a.handleResponse(l)}else l&&l.status?e.logger.errorToTelemetry?.(`Received response with rendererId mismatch ${JSON.stringify(t)}`,"cdl_peer_creation",{origin:"CDLPeer",correlationId:i},!0):l?o.handleRequest(l,(e=>(e=>{const t=Date.now();if("graphql"===e.type){const n=e.response;n.extensions?.perfStats&&(n.extensions.perfStats.requestReceivedTime=s,n.extensions.perfStats.responseSendTime=t),e.extensions.perfStats&&(e.extensions.perfStats.requestReceivedTime=s,e.extensions.perfStats.responseSendTime=t)}else e.requestReceivedTime=s,e.responseSendTime=t;n(JSON.stringify(e))})(e)),r):e.logger.errorToTelemetry?.(`Unknown message received that doesn't conform to CDL format ${JSON.stringify(t)}`,"cdl_peer_creation",{origin:"CDLPeer",correlationId:i},!0)}}}var zc=n(248427);class qc{constructor(){this.isSubscriptionRequest=e=>e instanceof $c,this._rendererRequestMap=new Map}addRequest(e,t){if(!e.rendererId)throw new TypeError("No rendererId in request");if(!e.requestId)throw new TypeError("No requestId in request");const n=this.getRequestRegistrationKey(e);let i=this._rendererRequestMap.get(n);if(i||(i=new Map,this._rendererRequestMap.set(n,i)),i.has(e.requestId))throw new Error(`Request ${e.requestId} for renderer ${n} already exists, something is off here`);if(t&&this.isSubscriptionRequest(t))return i.set(e.requestId,{resolution:t,request:e}),Promise.resolve(void 0);const a=(0,zc.P)();return i.set(e.requestId,{resolution:a,request:e}),a.promise}reconcileResponse(e){if(!e.rendererId)throw new TypeError("No rendererId in response");if(!e.requestId)throw new TypeError("No requestId in response");const t=this.getRequestRegistrationKey(e);if(!this._rendererRequestMap.has(t))throw new Error(`Response ${t} is not found in map`);const n=this._rendererRequestMap.get(t);if(!n)throw new Error(`Request map for renderer/window ${t} does not exist`);const i=n.get(e.requestId);if(!i)throw new Error(`Request ${e.requestId} for renderer/window ${t} does not exist`);"success"===e.status?this.handleSuccessResponse(e,i):this.handleErrorResponse(e,i),this.isSubscriptionRequest(i.resolution)&&"failure"!==e.status||n.delete(e.requestId),0===n.size&&this._rendererRequestMap.delete(t)}handleSuccessResponse(e,t){this.isSubscriptionRequest(t.resolution)?t.resolution.onNext(e):t.resolution.resolve(e)}handleErrorResponse(e,t){this.isSubscriptionRequest(t.resolution)?t.resolution.onError(e):t.resolution.reject(e)}getRequestRegistrationKey(e){return`${e.rendererId}${e.windowId?`_${e.windowId}`:""}`}}class Jc{constructor(e){this.requestType=e,this.counter=0}toString(){return`${this.getOperationPrefix(this.currentCounterRequestType)||this.requestType}-${this.counter}`}next(e){return this.safeIncrementCounter(),this.currentCounterRequestType=e,this.toString()}getOperationPrefix(e){switch(e){case"mutation":return"m";case"subscription":return"s";case"query":return"q";default:return e}}safeIncrementCounter(){return this.counter===Jc.MAX_COUNTER_VALUE&&(this.counter=0),this.counter++}}Jc.MAX_COUNTER_VALUE=Number.MAX_SAFE_INTEGER;class Qc{constructor(e,{rendererId:t,windowId:n},i,a){this._context=i,this._loggingContext={component:"CDLClient",hostRendererId:t,requestWindowId:n},this._rendererId=t,this._windowId=n,this._clientRequestType=a,this._postMessage=t=>e(t),this._requestRegistrar=new qc,this.requestId=new Jc(a)}sendRequest(e,t){const n={rendererId:this._rendererId,windowId:this._windowId,requestId:this.requestId.next(),type:this._clientRequestType,payload:e},i=this._requestRegistrar.addRequest(n,t);return this._postMessage(n),i}handleResponse(e){return new Promise(((t,n)=>{try{this._requestRegistrar.reconcileResponse(e),t()}catch(t){this._context.bootstrapServices.logger.errorToTelemetry?.(`Error occurred on reconciling response ${t}`,"cdl_client_response_error",{...(0,Wc.n)(this._loggingContext),correlationId:e.requestId,windowId:e.windowId,errorCode:h.jK.Unknown},!0),n(t)}}))}}const Kc="MainRenderer",Yc="GQL_STOP";class Xc extends Qc{constructor(e,{rendererId:t,windowId:n},i,a){super(e,{rendererId:t,windowId:n},i,a)}sendFilteredAppStateRequest(e){const t=e.context.appState;return this._rendererId===Kc&&(e.context.appState=this.filterWorkerAppState(t)),super.sendRequest(e)}filterWorkerAppState(e){return e}}class Zc{constructor(){this.onResponseReceived=e=>{if(this.onMessage){const t=this.transformLegacyClientFields(e.payload.dataLayer);this.onMessage(t)}}}transformLegacyClientFields(e){return e.error&&(e.errors=e.error),e.extensions||(e.extensions={}),e.perfStats&&(e.extensions.perfStats=e.perfStats),e}}class ed extends Zc{constructor(e,{rendererId:t,windowId:n},i,a){super(),this._context=i,this._loggingContext={hostRendererId:t,component:"CDLClient",requestWindowId:n},this.sendMessage=t=>e({requestId:t.requestId,rendererId:t.rendererId,windowId:t.windowId,payload:t.request,operationName:t.operationName,type:a,cdlOperationCustomContext:t.cdlOperationCustomContext})}handleResponse(e){return this._context.bootstrapServices.logger.debug("Received message",{...this._loggingContext,requestId:e.requestId,requestRendererId:e.rendererId,requestWindowId:e.windowId}),Promise.resolve(this.onResponseReceived({payload:{dataLayer:{rendererId:e.rendererId,requestId:e.requestId,windowId:e.windowId,data:e.response.data,errors:e.response.errors?e.response.errors:void 0,errorCode:e.response?.errorCode,extensions:e.response.extensions}}}))}}class td{constructor(e,t,n,i,a){this.stateMachineName=a,this.completionAwaiter=(0,zc.P)(),this.completedStates=[],this.bootstrapContext={...i,loggingContext:{...i.loggingContext,component:"CDLStateMachine"}},this.actionStateMap=t,this.globalState=e,this._currentState=e.current,this.workerStartupTelemetryService?.onStart(this.stateMachineName),this.completedStates.push(n),this.globalState.hasReachedCheckpoint(n)?this.transitionToNextState(n):this.subscribeToGlobalState()}isCompleted(){return this.completionAwaiter.promise}hasCompletedState(e){return-1!==this.completedStates.indexOf(e)}get currentState(){return this._currentState}errorStateMachine(e){this.unsubscribeStateTransition&&this.unsubscribeStateTransition.unsubscribe(),this.completionAwaiter.reject(e),"coreGraphql"===this.stateMachineName&&this.bootstrapContext.bootstrapServices.workerCacheManager?.saveWorkerStatusToCacheStorage({error:JSON.stringify(e),state:"Failure",stepName:`${this.currentState}::Fail`}),e&&e.code===h.jK.Disabled?this.bootstrapContext.bootstrapServices.logger.log(e.message,this.bootstrapContext.loggingContext):this.bootstrapContext.bootstrapServices.logger.errorToTelemetry?.(`State machine is erroring out: ${(0,de.VK)(e)}`,"cdl_state_managers",{...(0,Wc.n)(this.bootstrapContext.loggingContext)},!0),this.workerStartupTelemetryService?.onFail(this.stateMachineName,e)}completeStateMachine(e){this.unsubscribeStateTransition&&this.unsubscribeStateTransition.unsubscribe(),this.completionAwaiter.resolve(e),this.bootstrapContext.bootstrapServices.logger.log("State machine is reaching completion",this.bootstrapContext.loggingContext),this.workerStartupTelemetryService?.onComplete(this.stateMachineName)}execute(e,t,n){this.workerStartupTelemetryService?.onStepStart(this.stateMachineName,e);const i=e,a=this.actionStateMap.get(i);if(!a)return this.bootstrapContext.bootstrapServices.logger.log(`State machine is transitioning from ${this.currentState} to ${e}, skipping action invoke as none is defined`,this.bootstrapContext.loggingContext),this.emitState(e,n);this.bootstrapContext.bootstrapServices.logger.log(`State machine is invoking action for transition state ${this.currentState} to ${e}`,this.bootstrapContext.loggingContext),a.action(t,n).then((t=>{this.bootstrapContext.bootstrapServices.logger.log(`State machine is transitioning from ${this.currentState} to ${e}`,this.bootstrapContext.loggingContext),a.eventData&&this.workerStartupTelemetryService?.appendEventData(this.stateMachineName,a.eventData),this.emitState(e,t)})).catch((e=>{this.errorStateMachine(e)}))}transitionToNextState(e,t){this._currentState=e,this.completedStates.push(e),this.transitionState(e,t)}subscribeToGlobalState(){this.unsubscribeStateTransition=this.globalState.subscribe({next:e=>{const{newState:t,args:n}=e;this.transitionToNextState(t,n)}})}emitState(e,t){this.globalState.hasReachedCheckpoint(e)?this.transitionToNextState(e,t):(this.unsubscribeStateTransition||this.subscribeToGlobalState(),this.globalState.setState(e,t))}get workerStartupTelemetryService(){return this.bootstrapContext.bootstrapServices.workerStartupTelemetryService}}class nd extends td{transitionState(e,t){switch(e){case"authLoaded":this.execute("authServiceInjected",t,void 0);break;case"authServiceInjected":this.completeStateMachine(!0)}}}class id extends td{transitionState(e,t){switch(e){case"appService:Loaded":this.execute("appService:Injected",t,void 0);break;case"appService:Injected":this.completeStateMachine(!0)}}}class ad{constructor(e){this._componentName=e,this._handlerMap=new Map}addHandlers(e){e.forEach((e=>{this._handlerMap.set(e.requestType,e.handlerFunc)}))}handle(e,t,n,...i){const a=e.payload;return new Promise(((e,o)=>{const r=this._handlerMap.get(a.requestOperationtype);if(!r){n.bootstrapServices.logger.errorToTelemetry?.(`No handler found for request type ${a.requestOperationtype}`,"cdl_request_handler_no_handler_error",{origin:this._componentName,errorCode:h.jK.NotImplemented,...(0,Wc.n)(n.loggingContext)},!0);const e={response:{statusMsg:`Unknown request type: ${a.requestOperationtype}`,data:void 0},status:"failure"};return t(e),o(e)}r(a,n,...i,t).then((n=>e(ad.callResponseCallback(t,n,"success")))).catch((e=>{const n={response:e,status:"failure"};return t(n),o(n)}))}))}static callResponseCallback(e,t,n){e({response:t,status:n})}static onHandlerError(e,t,n,i,a,o=!1){o?e.bootstrapServices.logger.errorToTelemetry?.(n,"cdl_request_handler_on_error",{origin:a,errorCode:t,...(0,Wc.n)(e.loggingContext)},!0):e.bootstrapServices.logger.error(n,{component:a,...e.loggingContext},t);const r={statusMsg:i,data:void 0};return Promise.reject(r)}}var od,rd,sd,ld;!function(e){e.AadGetToken="aadGetToken",e.AadGetCurrentUser="aadCurrentUser",e.AadClearCache="aadClearCache",e.StartupApiToken="startupApiToken",e.GetSkypeTokens="getSkypeTokens",e.GetUserDetails="getUserDetails",e.SubscribeToAuthState="subscribeToAuthState"}(od||(od={}));class cd{constructor(e){this._requestUtility=new ad("CDLAuthHandler");let t=[];t=e===Kc?[{requestType:od.AadGetToken,handlerFunc:cd.getAadTokensAngular},{requestType:od.AadGetCurrentUser,handlerFunc:cd.getUserInformationAngular},{requestType:od.GetSkypeTokens,handlerFunc:cd.getSkypeTokensAngular},{requestType:od.GetUserDetails,handlerFunc:cd.getUserDetailsAngular},{requestType:od.SubscribeToAuthState,handlerFunc:cd.subscribeToAuthState}]:[{requestType:od.AadGetToken,handlerFunc:cd.getAadTokens},{requestType:od.AadGetCurrentUser,handlerFunc:cd.getUserInformation},{requestType:od.GetSkypeTokens,handlerFunc:cd.getSkypeTokens},{requestType:od.GetUserDetails,handlerFunc:cd.getUserDetails},{requestType:od.SubscribeToAuthState,handlerFunc:cd.subscribeToAuthState}],this._requestUtility.addHandlers(t)}injectDependentServices(e){return new Promise((t=>{if(!e)throw new TypeError("Cannot injectDependentServices of undefined");if("function"==typeof e.getAuthTokens&&(e={authenticationService:e,discover:void 0}),!e.authenticationService)throw new TypeError("Cannot inject authentication service that is not defined");if(this._authenticationService)throw new TypeError("injectDependentServices has been called again, even though it's already initialized");return this._authenticationService=e.authenticationService,this._discover||(this._discover=e.discover),this._authStateProvider||(this._authStateProvider=e.authStateProvider),t()}))}handle(e,t,n){return this._requestUtility.handle(e,t,n,this._authenticationService,this._discover,this._authStateProvider)}static convertAngularPromise(e){return new Promise(((t,n)=>{e.then((e=>t(e))).catch((e=>n(e)))}))}static handleAuthResult(e,t,n){const i=t.bootstrapServices.newScenario(H.RG.AuthHandlerRequest);i.appendEventData({operation:n}),i.mark("handle_auth_result_start");const a=performance.now();return e.then((e=>{if(null==e){i.mark("handle_auth_result_returns_undefined_or_null",{arrivalTime:performance.now()-a});const e="response payload is empty";throw i.fail({message:e,commandSource:n}),new Error(e)}i.mark("handle_auth_result_returns_defined_value",{arrivalTime:performance.now()-a});const t={statusMsg:`${n} request in main renderer has been processed`,data:e};return i.stop({message:t.statusMsg,commandSource:n}),t})).catch((e=>{i.mark("handle_auth_result_error_caught");const a=cd.getErrorMessage(n,e),o=!!(0,de.Wc)(e);ad.onHandlerError(t,h.jK.UnhandledPromiseRejection,"the auth handler has exception",a,"CDLAuthHandler",!o&&"response payload is empty"!==e?.message),e.isExpected?i.incomplete({message:a,commandSource:n}):i.fail({message:a,commandSource:n});try{"string"==typeof e&&(e=new Error(e)),e.reason||(e.reason={}),e.reason.cdlClient="auth"}catch(n){t.bootstrapServices.logger.warn(`Failed to handle auth error. Original error: ${(0,de.VK)(e)}. Handling error: ${(0,de.VK)(n)}`,{component:"CDLAuthHandler",...t.loggingContext})}throw e}))}static getAadTokensAngular(e,t,n){const i=e.context.resource,a=e.context.options;return cd.logStartHandle(e,t,i),cd.handleAuthResult(cd.convertAngularPromise(n.getAuthToken(i,a?.claim,a?.silent,e.context?.forceRenew)).then((e=>{if(!e)return;return{token:e.token,expires:e.expiration,tokenType:e.tokenType,fromCache:!1}})),t,od.AadGetToken)}static getAadTokens(e,t,n){const{resource:i,options:a}=e.context;let o;return cd.logStartHandle(e,t,i),o=n.acquireTokenV2?n.acquireTokenV2(i,a):n.acquireToken(i,a).then((e=>({token:e}))),cd.handleAuthResult(o,t,od.AadGetToken)}static getUserInformationAngular(e,t,n){return cd.logStartHandle(e,t),cd.handleAuthResult(cd.convertAngularPromise(n.getUserInformation()),t,od.AadGetCurrentUser)}static getUserDetailsAngular(e,t,n){return cd.logStartHandle(e,t),cd.handleAuthResult(cd.convertAngularPromise(n.getUserDetails()),t,od.GetUserDetails)}static async getUserDetails(e,t,n,i){cd.logStartHandle(e,t);const a=await i.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:!!e.context?.forceRenew}),o=a?{userDetails:a.userDetails,id:a.userDetails.id}:void 0;return cd.handleAuthResult(Promise.resolve(o),t,od.GetUserDetails)}static async subscribeToAuthState(e,t,n,i,a,o){if(!a){t.bootstrapServices.logger.log("Auth-Handler - auth state provider not provided. Not subscribing.",{component:"CDLAuthHandler",...t.loggingContext});const e=(0,de.Tr)("AuthStateProvider not provided - This will should be an error in the RWC experience",h.jK.MissingParameter,"Auth-Handler");return Promise.reject(e)}const r=a.observe().subscribe((async e=>{const n=await cd.handleAuthResult(Promise.resolve(e?.state),t,od.SubscribeToAuthState);ad.callResponseCallback(o,n,"success")}),(async e=>{ad.callResponseCallback(o,{statusMsg:cd.getErrorMessage(od.SubscribeToAuthState,e),data:e},"failure")}),(async()=>{r.unsubscribe(),ad.callResponseCallback(o,{statusMsg:"AuthStateProvider Completed",data:void 0},"failure")}));return cd.handleAuthResult(Promise.resolve(a.getState()?.state),t,od.SubscribeToAuthState)}static getSkypeTokensAngular(e,t,n){cd.logStartHandle(e,t);const i=n.getSkypeTokens(!!e.context?.forceRenew).then((e=>{if(!e)return;return{expiration:e.tokenExpiration||0,skypeToken:e.skypeToken,userDetails:e.userDetails,regionGtms:e.regionGtms}}));return cd.handleAuthResult(i,t,od.GetSkypeTokens)}static getSkypeTokens(e,t,n,i){return cd.logStartHandle(e,t),cd.handleAuthResult(i.getSkypeTokenInfoFromDiscoveryResponse({forceRenew:!!e.context?.forceRenew}),t,od.GetSkypeTokens)}static getUserInformation(e,t,n){return cd.logStartHandle(e,t),cd.handleAuthResult(n.getUser({correlation:{source:"AuthHandlerRequest",id:"na",scenarioName:"CentralDataLayerBootstrapAuthGetUser"}}),t,od.AadGetCurrentUser)}static logStartHandle(e,t,n){const i=n?` for resource ${n}`:"";t.bootstrapServices.logger.log(`Auth handler started serving request ${e.requestOperationtype}${i}`,{component:"CDLAuthHandler",...t.loggingContext})}}cd.getErrorMessage=(e,t)=>`the request type for ${e} failed due to ${(0,de.VK)(t)}`,function(e){e.MachineActive="MachineActive",e.MachineInactive="MachineInactive",e.MachineLongInactive="MachineLongInactive",e.MachineLocked="MachineLocked"}(rd||(rd={})),function(e){e.NotifyAppState="NotifyAppState",e.NotifyTokenRefresh="NotifyTokenRefresh",e.NotifyCoreClientState="NotifyCoreClientState",e.NotifyCoreMachineState="NotifyCoreMachineState",e.NotifyCoreSuspendedState="NotifyCoreSuspendedState",e.NotifyCoreMachineIdleState="NotifyCoreMachineIdleState",e.NotifyServiceUp="NotifyServiceUp",e.NotifyServiceDown="NotifyServiceDown"}(sd||(sd={})),function(e){e[e.ChatSync=0]="ChatSync",e[e.Presence=1]="Presence",e[e.Files=2]="Files",e[e.OneNote=3]="OneNote",e[e.Groups=4]="Groups",e[e.Video=5]="Video",e[e.MasterTab=6]="MasterTab",e[e.IndexDb=7]="IndexDb",e[e.AdalTokens=8]="AdalTokens",e[e.AdalLogin=9]="AdalLogin",e[e.AdalReauth=10]="AdalReauth",e[e.SkypeTokens=11]="SkypeTokens",e[e.SkypeLicense=12]="SkypeLicense",e[e.SupportedBrowser=13]="SupportedBrowser",e[e.MSAGuestLicense=14]="MSAGuestLicense",e[e.AppSession=15]="AppSession",e[e.CSAStartup=16]="CSAStartup"}(ld||(ld={}));class dd{constructor(e,t){this.workerId=t,this._requestUtility=new ad("CDLAppServiceHandler");let n=[];n=e===Kc?[{requestType:sd.NotifyServiceUp,handlerFunc:dd.notifyServiceUpAngular},{requestType:sd.NotifyServiceDown,handlerFunc:dd.notifyServiceDownAngular}]:[{requestType:sd.NotifyServiceUp,handlerFunc:dd.notifyServiceUp},{requestType:sd.NotifyServiceDown,handlerFunc:dd.notifyServiceDown}],this._requestUtility.addHandlers(n)}injectAppState(e){return new Promise((t=>{if(this.appService)throw new TypeError("injectAppStateService has been called again, even though it's already initialized");return this.appService=e,t()}))}handle(e,t,n){return this._requestUtility.handle(e,t,n,this.appService,this.workerId)}static notifyServiceUp(e,t,n,i){return new Promise((a=>{t.bootstrapServices.logger.log(`App service change is received (worker ${i}), ${e.context.appService} is up and running`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:o,reason:r}=e.context,s={workerId:i};return n.notifyServiceUp(s,o,r),a()}))}static notifyServiceUpAngular(e,t,n){return new Promise((i=>{t.bootstrapServices.logger.log(`App service change is received, ${e.context.appService} is up and running. Notifying Angular.`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:a,reason:o}=e.context,r=ld[a];return n.notifyServiceUp(r,o),i()}))}static notifyServiceDown(e,t,n,i){return new Promise((a=>{t.bootstrapServices.logger.log(`App service change is received (worker ${i}), ${e.context.appService} is down`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:o,reason:r,code:s}=e.context,l={workerId:i};return n.notifyServiceDown(l,o,r,s),a()}))}static notifyServiceDownAngular(e,t,n){return new Promise((i=>{t.bootstrapServices.logger.log(`Angular app service change is received, ${e.context.appService} is down. Notifying Angular.`,{component:"CDLAppStateHandler",...t.loggingContext});const{appService:a,reason:o,code:r}=e.context,s=ld[a];return n.notifyServiceDown(s,o,r),i()}))}}class ud{constructor(e){this.workerId=e}handle(e,t,n){return new Promise((i=>{n.bootstrapServices.logger.log(`Network state received from CDL worker ${this.workerId}. Network state: ${e.payload.networkState}`,{component:"NetworkStateHandler",...n.loggingContext}),this.networkStateChangeHandler?.next(e.payload.networkState);i(t({response:{statusMsg:"Network state received success.",data:void 0},status:"success"}))}))}injectNetworkStateTracker(e){return new Promise((t=>{if(this.networkStateChangeHandler)throw new TypeError("injectNetworkStateTracker has been called again, even though it's already initialized");return this.networkStateChangeHandler=e,t()}))}}class md extends td{transitionState(e,t){switch(e){case"networkState:Loaded":this.execute("networkState:Injected",t,void 0);break;case"networkState:Injected":this.completeStateMachine(!0)}}}class pd{constructor(){this._componentName="EndpointsHealthMessageHandler"}handle(e,t,n){return new Promise((i=>{(!e.payload||void 0===e.payload.healthState&&void 0===e.payload.endpointHealth)&&(this.log("Endpoints health message received from CDL. Payload is empty.",n),i(t(this.getSuccessMessage()))),e.payload.endpointHealth&&(this.log(`Endpoints health message received from CDL. Update: ${JSON.stringify(e.payload.endpointHealth)}.`,n),this.endpointsHealthUpdateHandler?.handleEndpointHealthUpdate(e.payload.endpointHealth),i(t(this.getSuccessMessage()))),e.payload.healthState&&(this.log("Endpoints state dump message received from CDL.",n),this.endpointsHealthUpdateHandler?.handleStateDump(e.payload.healthState),i(t(this.getSuccessMessage())))}))}injectEndpointsHealthUpdateHandler(e){return new Promise((t=>{if(this.endpointsHealthUpdateHandler)throw new TypeError("injectEndpointsHealthUpdateHandler has been called again, even though endpointsHealthUpdateHandler is already initialized");return this.endpointsHealthUpdateHandler=e,t()}))}log(e,t){t.bootstrapServices.logger.log(e,{component:this._componentName,...t.loggingContext})}getSuccessMessage(){return{response:{statusMsg:"Endpoints health received success.",data:void 0},status:"success"}}}class gd extends td{transitionState(e,t){switch(e){case"endpointsHealthUpdateHandler:Loaded":this.execute("endpointsHealthUpdateHandler:Injected",t,void 0);break;case"endpointsHealthUpdateHandler:Injected":this.completeStateMachine(!0)}}}function hd(e,t,n,i){const{authStateMachine:a,authHandler:o}=yd(e,t,i),{appServiceStateMachine:r,appServiceMessageHandler:s}=vd(e,t,i,n),{networkStateHandlerStateMachine:l,networkStateHandler:c}=fd(e,t,i,n),{endpointsHealthHandlerStateMachine:d,endpointsHealthHandler:u}=Sd(e,t,i);return new Map([[Bc.k.auth,{stateMachine:a,requestHandler:o}],[Bc.k.appService,{stateMachine:r,requestHandler:s}],[Bc.k.networkState,{stateMachine:l,requestHandler:c}],[Bc.k.endpointHealth,{stateMachine:d,requestHandler:u}]])}const yd=(e,t,n)=>{const i=new cd(t),a={action:i.injectDependentServices.bind(i)},o=new Map;o.set("authServiceInjected",a);return{authHandler:i,authStateMachine:new nd(n,o,"authLoaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:"auth",component:"CreateWorkerStateAndRequestHandlers"}},"auth")}},vd=(e,t,n,i)=>{const a=new dd(t,i),o={action:a.injectAppState.bind(a)},r=new Map;r.set("appService:Injected",o);return{appServiceMessageHandler:a,appServiceStateMachine:new id(n,r,"appService:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:"appService",component:"CreateWorkerStateAndRequestHandlers"}},"appService")}},fd=(e,t,n,i)=>{const a=new ud(i),o={action:a.injectNetworkStateTracker.bind(a)},r=new Map;r.set("networkState:Injected",o);return{networkStateHandler:a,networkStateHandlerStateMachine:new md(n,r,"networkState:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:Bc.k.networkState,component:"CreateWorkerStateAndRequestHandlers"}},"networkState")}},Sd=(e,t,n)=>{const i=new pd,a={action:i.injectEndpointsHealthUpdateHandler.bind(i)},o=new Map;o.set("endpointsHealthUpdateHandler:Injected",a);return{endpointsHealthHandler:i,endpointsHealthHandlerStateMachine:new gd(n,o,"endpointsHealthUpdateHandler:Loaded",{bootstrapServices:e,loggingContext:{hostRendererId:t,requestType:Bc.k.endpointHealth,component:"CreateWorkerStateAndRequestHandlers"}},"endpointsHealth")}};function kd(){return new SharedWorker("/v2/worker/precompiled-shared-worker-8456a6aff3afe3e3.js")}function Cd(){return new Worker("/v2/worker/precompiled-web-worker-606f7884bce55601.js")}const bd=-1,wd=e=>({loaded:e.hasReachedCheckpoint("loaded")?1:0,healthCheck:e.hasReachedCheckpoint("health_checked")?1:0,syncEngine:e.hasReachedCheckpoint("syncEngine:Initialized")?1:e.hasReachedCheckpoint("syncEngine:FailedToInitialize")?2:0,authLoaded:e.hasReachedCheckpoint("authLoaded")?1:0}),Td=e=>{const t=wd(e);return`LD${t.loaded}:HC${t.healthCheck}:SE${t.syncEngine}:AL${t.authLoaded}`},Id=e=>{const t=wd(e);return{"WorkerStartupState.Loaded":1===t.loaded,"WorkerStartupState.HealthCheck":1===t.healthCheck,"WorkerStartupState.SyncEngine":t.syncEngine,"WorkerStartupState.AuthLoaded":1===t.authLoaded}},Nd=(e,t)=>{if(e.hasOwnProperty("code")){const t=e;if(t.code!==h.jK.Unknown)return t.code}return t.hasReachedCheckpoint("loaded")?t.hasReachedCheckpoint("syncEngine:FailedToInitialize")?h.jK.NotInitialized:t.hasReachedCheckpoint("health_checked")&&t.hasReachedCheckpoint("syncEngine:Initialized")?h.jK.UnhandledRuntimeException:h.jK.TimedOut:h.jK.ScriptLoadError},Ed=e=>e&&e.message&&e.message.includes("AsyncIterableObserver buffer is full")?"AsyncIterableBufferOverflow":"Unknown",Ad=120*bl.gT.MILLI_PER_SECOND,_d="CDLWorkerManager",Fd="default";function Dd(e,t,n,i,a,o,r,s,l,c,d,u,m){const p={hostRendererId:t,component:"CDLWorker"};let g;const h=function(){const e=new Map;return e.set(Bc.k.appState,Xc),e.set(Bc.k.control,Qc),e.set(Bc.k.database,Qc),e.set(Bc.k.diagnostics,Qc),e.set(Bc.k.endpointHealth,Qc),e.set(Bc.k.graphql,ed),e.set(Bc.k.networkState,Qc),e.set(Bc.k.syncEngine,Qc),e.set(Bc.k.supportedResolvers,Qc),e.set(Bc.k.telemetry,Qc),e}();return e.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"InProgress",stepName:"CreateCDLWorker"}),void 0!==c?.telemetryWorkerBroadcast&&u?.localStorage?.setItem("tmp.telemetryBroadcastEnabledCache",c.telemetryWorkerBroadcast.toString()),g=n?function(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g){if(c){xc(e.logger,c,!0,e.hostRendererId,_d);const d=p?.loader?.getSharedWorker?.(),h=d||new SharedWorker(c);return d&&(p?.loader?.clearWorker(),e.logger.log("Cleared Precore Init shared worker",s)),Pd(e,i,a,l,t,n,(e=>h.port.postMessage(e)),(e=>{h.port.onmessage=t=>e(t,(e=>h.port.postMessage(e)))}),(e=>{h.onerror=t=>e(t)}),"shared-worker",o,r,s,m,g,u?.workerId)}const h=Dc(u?.experienceName,u?.ring,u?.environment,u?.sessionId,u?.platformId,u?.buildVersion,u?.localeCode,u?.workerId,void 0,u?.preECSConsoleLogLevel,u?.userConsoleLogLevel,u?.publicPath,void 0,u?.telemetryWorkerBroadcast),y=SharedWorker;SharedWorker=Mc(y,e.logger,_d,h,d);const v=new kd;return SharedWorker=y,Pd(e,i,a,l,t,n,(e=>v.port.postMessage(e)),(e=>{v.port.onmessage=t=>e(t,(e=>v.port.postMessage(e)))}),(e=>{v.onerror=t=>e(t)}),"shared-worker",o,r,s,m,g,u?.workerId)}(e,t,h,i,a,o,r,p,s,l&&l.cdlSharedWorkerUrl,(e=>{l&&(l.cdlSharedWorkerUrl=e)}),c,d,u,m):function(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g){if(c){xc(e.logger,c,!0,e.hostRendererId,_d);const d=p?.loader?.getWorker?.(),h=d||new Worker(c);return d&&(p?.loader?.clearWorker(),e.logger.log("Cleared Precore Init web worker",s)),Pd(e,i,a,l,t,n,(e=>h.postMessage(e)),(e=>{h.onmessage=t=>e(t,(e=>h.postMessage(e)))}),(e=>{h.onerror=t=>e(t)}),"web-worker",o,r,s,m,g,u?.workerId)}const h=Dc(u?.experienceName,u?.ring,u?.environment,u?.sessionId,u?.platformId,u?.buildVersion,u?.localeCode,u?.workerId,u?.preAuthUserId,u?.preECSConsoleLogLevel,u?.userConsoleLogLevel,u?.publicPath,u?.deviceId,u?.telemetryWorkerBroadcast),y=Worker;Worker=Mc(y,e.logger,_d,h,d);const v=new Cd;return Worker=y,Pd(e,i,a,l,t,n,(e=>v.postMessage(e)),(e=>{v.onmessage=t=>e(t,(e=>v.postMessage(e)))}),(e=>{v.onerror=t=>e(t)}),"web-worker",o,r,s,m,g,u?.workerId)}(e,t,h,i,a,o,r,p,s,l&&l.cdlWebWorkerUrl,(e=>{l&&(l.cdlWebWorkerUrl=e)}),c,d,u,m),g}function Pd(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h=Fd){return new Promise((async(y,v)=>{const f=new Uc({bootstrapServices:e,loggingContext:m});f.setState("bootstrapped"),p?.mark(H.ck.CdlWorkerBootstrapped);const S=Gc(e,{postMessageCallback:e=>r(e),clients:o},{globalState:f,requestAndStateHandlers:hd(e,a,h,f)},a);S.workerServer.start(),s(((e,t)=>S.onMessageCallback(e,t,bd))),l((t=>{v(Md(t,e,m,"workerOnError",u,k.state))}));const k={workerServer:S.workerServer,workerClientResponseRouter:S.workerClientResponseRouter,state:f,workerType:c,syncEngineInitializationPromise:d};k.state.setState("loaded");try{await async function(e,t,n,i,a){const o=t.workerClientResponseRouter.cdlControlClient.sendRequest({type:"health_check",bootstrapData:i,initiatorExperience:n});let r;r=a?(await o).response:(await(0,V.E)(o,e)).response;t.cdlWorkerSessionId=r.cdlWorkerSessionId,t.cdlWorkerSupportedResolvers=r.cdlWorkerSupportedResolvers,t.state.setState("health_checked")}(t||Ad,k,n,i,g)}catch(t){v(Md(t,e,m,"healthCheckException",u,k.state))}y(k)}))}function Md(e,{logger:t,workerCacheManager:n},i,a,o,r){const s=Nd(e,r),l=Td(r),c=`err: ${(0,de.VK)(e.error)};message: ${(0,de.VK)(e.message)}`,d=(0,de.Tr)(h.w5.DataLayerClient,s,c,void 0,`Uncaught ${a} in Worker: ${(0,de.VK)(e.message)} Auth: ${o} WorkerState: ${l}`),u=`CDL Worker OnError for ${a}::Auth${o}::workerState:${l}::${Ed(e)}`;return t.errorToTelemetry?t.errorToTelemetry(u,"cdl_worker_startup_error",Id(r),!0):t.error(u,i,s),n?.saveWorkerStatusToCacheStorage({state:"Failure",stepName:"CDLWorkerOnError",error:c}),d}const xd=e=>{switch(e){case"clean":return"Clean";case"upgrade:blocking":return"UpgradeBlocking";case"upgrade:non-blocking":return"UpgradeNonBlocking";case"warm":return"Warm"}};var Rd=n(864727),jd=n(303303),Ld=n(730850);const Od=(0,Rd.p)(jd.A),$d=()=>{let e;return async(t,n,i)=>{if(void 0===e){const a=await Ud(t,n,i);return e=a,a}return e}},Ud=async(e,t,n)=>{if(!e)return t.log("WebWorkerURL is undefined",n),!0;let i;t.infoToTelemetry?.("Pinging PDS / ServiceWorker to verify if worker script is up","cdl_worker_startup_error_verify_worker_script",{endpointUrl:e},!0);const a=new Date,o=performance.now();try{i=await Od({url:e,method:"HEAD"})}catch(e){return t.errorToTelemetry?.(e.toString(),"cdl_worker_startup_error_verify_worker_script",{statusCode:-1},!0),!1}const r={totalRequestTime:performance.now()-o,statusCode:i.status,size:Number(i.headers["content-length"]??-1),correlationId:i.headers["x-msedge-ref"],callId:i.headers["x-ms-request-id"],contentType:i.headers["x-cache"]};return t.infoToTelemetry?.("Finished pinging PDS / ServiceWorker","cdl_worker_startup_error_verify_worker_script",r,!0),t.log(`precompiled-web-worker header x-msedge-ref: ${i.headers["x-msedge-ref"]}`,n),function(e,t){const n="Ref C: ";if(!e)return!0;let i;if(!(i=e.indexOf(n)))return!0;const a=e.slice(i+n.length),o=new Date(a);if(!(0,Ld.q)(o))return!0;return t.getTime()<o.getTime()}(i.headers["x-msedge-ref"],a)||t.log("Request is likely served from service worker, since PDS response time is before the request time",n),i.status!==Hs.qb.OK?(t.errorToTelemetry?.(`PDS returned ${i.status} for worker script`,"cdl_worker_startup_error_verify_worker_script",r,!0),!1):(t.log("Worker script fetched successfully.",n),!0)};const Bd=(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,y,v,f)=>new Promise((async(S,k)=>{const C=performance.now();"sharedworker"===t&&v?.setContext("cdlSharedWorkerSessionId",l?.sessionId);let b=m?.workerStartupScenario,w=m?.workerStartupScenarioTimeout;const T=Wd(t);if(!b){const e=Hd(n.newScenario,o,T,n.workerCacheManager,d,u,g,n.logger);b=e.workerStartupScenario,w=e.workerStartupScenarioTimeout}if(b.appendEventData({origin:r}),f&&g?.getUser&&!b.isPaused){await(g?.getUser())||b.pause({reason:h.jK.Authentication,pauseReason:"AuthNoUser_InteractionRequired"})}v?.setCoreContext("AppInfo.CDLState","Initializing");const I=Gd(e);u?.getState()?.state===hl.j.InteractionRequired&&(n.logger.warn("Worker startup - User is in InteractionRequired state. pausing worker startup scenario",I),b?.pause({reason:h.jK.Authentication,pauseReason:"InteractionRequired"}));const N=u?.observe()?.subscribe({next:e=>{e.state!==hl.j.InteractionRequired||b?.isPaused?e.state===hl.j.Up&&b?.isPaused&&(n.logger.log("Worker startup - User came out of InteractionRequired state. Resuming worker startup scenario",I),b?.resume({reason:"ValidToken"})):(n.logger.warn("Worker startup - User is in InteractionRequired state. Pausing worker startup scenario",I),b?.pause({reason:h.jK.Authentication,pauseReason:"InteractionRequired"}))}}),E=b;d&&n.logger.log(`Initializing worker manager from renderer with host: ${d.location.host} protocol: ${d.location.protocol} port: ${d.location.port}`,I);const A=$d();let _;p||(_=d?.setTimeout((async()=>{const t=Gd(e);E.mark("ScriptLoadTimedOut"),await A(T?i?.cdlSharedWorkerUrl:i?.cdlWebWorkerUrl,n.logger,t)||E.mark("ScriptPingFailed")}),4e4)),async function(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,y,v,f,S){let k=!1;g&&t.logger.log(`Initializing worker manager from renderer with host: ${g.location.host} protocol: ${g.location.protocol} port: ${g.location.port}`,{hostRendererId:e,component:"CDLWorkerManager"});try{const d=(0,zc.P)();c.appendEventData({newState:"beforeCreateCDLWorker"});const v=await Dd(t,e,o,i,a,d.promise,y?y.getState()?.state:hl.j.Up,u,n,m,c,g,f).finally((()=>{g?.clearTimeout?.(l),g?.clearTimeout(s)}));return k=!0,c.appendEventData({newState:H.ck.CdlWorkerManagerHealthChecked,searchSessionId:v.cdlWorkerSessionId}),v.state.setState("initialized"),S?.setCoreContext("AppInfo.CDLState","Running"),zd(c),c.mark("CDLWorkerManagerInitialized"),async function(e,t,n,i,a,o,r,s,l){const c=Gd(n);try{const{response:n}=await e.workerClientResponseRouter.cdlSyncEngineClient.sendRequest({type:"startup_info",subType:"Messaging",params:void 0}),o=n;if(o&&"string"!=typeof o&&"error"===o.type){const e="string"==typeof o.details?o.details:JSON.stringify(o.details);throw t.logger.warn(`Sync engine for Messaging strategy: ${e}`,c),e}const d="clean"===o?"cold":"warm";s?.appendEventData({messagingSyncEngineStartupMode:o,appLaunchMode:d,workerResponseTime:performance.now()-r}),a.resolve({isSyncEngineInitialized:!0,bootType:xd(o)}),l?.setCoreContext("AppInfo.LaunchMode",d),e.state.setState("syncEngine:Initialized"),zd(i),i.stop({dataSource:o})}catch(n){const r=await Vd(o,t.workerCacheManager),s="Init SyncEngine failed",l=`err: ${(0,de.VK)(n)}`,d=n.code||n.response?.error?.code||h.jK.Unknown;t.logger.errorToTelemetry?.(`${s}:: ${l}`,"cdl_worker_manager_get_messaging_sync_engine_startup_info_error",{...(0,Wc.n)(c),errorCode:d},!0),t.logger.errorToTelemetry?.(`${s}:: WSM: ${r}`,"cdl_worker_manager_get_messaging_sync_engine_startup_info_error",{...(0,Wc.n)(c),errorCode:d},!0),zd(i);const u=`${s}:: WSM: ${r}:: ${l}`,m=n.response?.error?.isExpected||!1,p={errors:u,isAccepted:m,errorCode:d,dataSource:n.response?.error?.startupMode,reason:n.response?.error?.message,statusCode:n.response?.error?.statusCode};m?i.cancel(p):i.fail(p),e.state.setState("syncEngine:FailedToInitialize"),a.resolve({isSyncEngineInitialized:!1,isExpected:m})}}(v,t,e,c,d,o,r,p,S),v}catch(i){const a=await async function(e,t,n,i,a,o,r,s,l,c,d){const u=await Vd(a,t.workerCacheManager),m=`Failed to initialize CDL Worker :: err: ${(0,de.VK)(e)}`,p=`${m}, workerResponseTime: ${performance.now()-c}ms, ${u}`;d?.setCoreContext("AppInfo.CDLState","Failed");const g=Gd(n);let y={errors:p,errorCode:t.workerCacheManager?e.code:h.jK.NotInitialized};if(s&&!l)try{if(!await r(a?o?.cdlSharedWorkerUrl:o?.cdlWebWorkerUrl,t.logger,g)){e.code=h.jK.ScriptLoadError;y={errors:"CDL Worker Script load error",errorCode:h.jK.ScriptLoadError}}}catch(t){e.code=h.jK.ScriptLoadError;y={errors:`CDL Worker Script load error :: ${t.message}`,errorCode:h.jK.ScriptLoadError}}const v=(0,de.Tr)("CDLWorkerManager",e.code,JSON.stringify(g),void 0,p);t.logger.errorToTelemetry?.(m,"cdl_worker_manager_handle_initialize_worker_manager_failure_error",{...(0,Wc.n)(g),errorCode:v.code},!0),t.logger.errorToTelemetry?.(u,"cdl_worker_manager_handle_initialize_worker_manager_failure_error",{...(0,Wc.n)(g),errorCode:v.code},!0),zd(i),e&&e.code===h.jK.TimedOut?i.stop(y,"timeout"):i.fail(y);return t.workerCacheManager?.saveWorkerStatusToCacheStorage({state:"Failure",stepName:"CreateCDLWorker",error:p}),v}(i,t,e,c,o,n,d,!k,!!v,r,S);throw a}}(e,n,i,a,r,T,C,_,w,b,A,s,l,c,d,u,p,y,v).then((e=>S(e))).catch((e=>{N?.unsubscribe(),k(e)})).finally((()=>N?.unsubscribe()))})),Wd=e=>"electron"===e||"sharedworker"===e;function Hd(e,t,n,i,a,o,r,s){const l=300*z.kg,c=t||l,d=e(H.RG.CentralDataLayerWorkerManagerStartup,c);let u=!0;r?.getUser&&(u=!1,r?.getUser().then((()=>u=!0)));const m=a?.setTimeout?.((()=>{u||(s?.warn("Worker startup - getUser is still not available. Cancelling Worker Scenario"),d.cancel({reason:"GetUser"}));(o?o.getState()?.state:hl.j.Up)===hl.j.InteractionRequired&&(s?.warn("Worker startup - User is in InteractionRequired state. Cancelling Worker Scenario"),d.cancel({reason:"InteractionRequired"})),Vd(n,i).then((e=>{d.appendEventData({errors:e})}))}),c-500);return{workerStartupScenario:d,workerStartupScenarioTimeout:m}}async function Vd(e,t){const n=e?"shared-worker":"web-worker";let i="";if(t)try{const e=await t.getWorkerStartupStatus(n);return"WorkerStartupStatus: "+(e?`lastError: ${JSON.stringify(e.lastError)}:: lastState: ${JSON.stringify(e.lastState)}`:"Unable to get CDL worker startup status")}catch(e){i=`Unable to get CDL worker startup status. Reason: ${(0,de.VK)(e)}`}else i="Unable to get CDL worker startup status. Reason: workerCacheManager is undefined";return i}function Gd(e){return{hostRendererId:e,component:"CDLWorkerManager"}}function zd(e){e.appendEventData({"Thread.Id":"",threadId:""})}var qd=n(79283);class Jd{constructor(e,t,n){this._cacheStorage=e,this._cacheName="cdl-worker-cache-manager",this.lastSavePromise=Promise.resolve(null),this._logger=t,this._scenarioFactory=n}async save(e,t,n,i,a){let o="";try{if(!e)throw this._error("get","Invalid key");a?.appendEventData({context:i}),o=JSON.stringify(t),this._logger.log(`[CDLWorkerCacheManager]: Saving item to ${this._cacheName} key: ${e}`);const r=new Response(o),s=this._getScopedRequest(e,n,i);return await this._cacheStorage.put(s,r),a?.stop(),s.request.url}catch(t){const n=this._error("save",`[CDLWorkerCacheManager]: Failed to save object to cache, err: ${t?.message}, key: ${e}, experienceName: ${i}`);return this._logger.warnToTelemetry?.(n.message,"cdl_worker_cache_manager_save_error",{origin:e,context:i},!0),a?.fail({message:n.message,errorCode:n.name,errors:n.message}),null}}async get(e,t,n,i){try{if(!e)throw this._error("get","Invalid key");i?.appendEventData({context:n});const a=this._getScopedRequest(e,t,n),o=await this._cacheStorage.match(a);return o&&o.body?(i?.stop({cached:!0}),await o.json()):(this._logger.log(`[CDLWorkerCacheManager]: Get from cache for key ${e} could not find a result, returning null.`),i?.stop({cached:!1}),null)}catch(t){const a=this._error("get",`[CDLWorkerCacheManager]: Failed to get item from cache for key ${e}, err: ${t?.message}`);throw this._logger.errorToTelemetry?.(a.message,"cdl_worker_cache_manager_get_error",{origin:e,context:n},!0),i?.fail({errors:a.message,errorCode:a.code,message:a.message}),a}}async delete(e,t,n){try{if(!e)throw this._error("get","Invalid key");this._logger.log(`[CDLWorkerCacheManager]: Deleting item from cdl worker cache key: ${e}, experienceName: ${n}`);const i=this._getScopedRequest(e,t,n),a=await this._cacheStorage.delete(i);return Promise.resolve(a)}catch(t){const i=this._error("delete",`[CDLWorkerCacheManager]: Failed to delete item from cache key: ${e}, experienceName: ${n}, err: ${t?.message}`);return this._logger.errorToTelemetry?.(i.message,"cdl_worker_cache_manager_delete_error",{origin:e,context:n},!0),!1}}async clear(){try{return this._logger.log("[CDLWorkerCacheManager]: Clearing cdl-worker cache"),this._cacheStorage.clear(this._cacheName)}catch(e){const t=this._error("clear",`[CDLWorkerCacheManager]: Failed to clear the cache: ${this._cacheName}, err: ${e?.message}`);return this._logger.errorToTelemetry?.(t.message,"cdl_worker_cache_manager_clear_error",{origin:this._cacheName},!0),!1}}getCachedUrlByKey(e,t){return this._getScopedRequest(e,t).request.url}async saveWorkerStatusToCacheStorage(e){let t;return await this.lastSavePromise,this.lastSavePromise=this.get(qd.QC).then((e=>{t=e})).catch((()=>{this._logger.warn(`WorkerCacheManager couldn't get cache key ${qd.QC}, setting to default`)})).then((()=>{t||(t={}),"Failure"===e.state?t.lastError=e:t.lastState=e,t.statusLogs=t.statusLogs||[];const n={timestamp:(new Date).getTime(),status:e};return t.statusLogs.push(n),this.save(qd.QC,t)})),this.lastSavePromise}async getWorkerStartupStatus(e){return this.get(qd.QC,void 0,e)}saveWorkerVerboseLog(e){return this.save(qd._1,e,void 0)}async getWorkerVerboseLog(e){try{const t=await this.get(qd._1,void 0,e);return t||""}catch(e){return""}}async getAggregatedUserData(e){try{const t=this._scenarioFactory?.newScenario(H.RG.MTMAAggregatorUserDataRead);return await this.get(`${qd.fl}/${e}`,void 0,"cdl-worker",t)}catch(e){return null}}async getGlobalUserData(){try{return await this.get(qd.nx,void 0,"cdl-worker")}catch(e){const t=this._error("getGlobalUserData",`[CDLWorkerCacheManager]: Failed to get global user data from cache, err: ${e?.message},`);return this._logger.errorToTelemetry?.(t.message,"cdl_worker_cache_manager_get_global_user_data_error",void 0,!0),null}}async getSecureGlobalUserData(){try{return await this.get(qd.g4,void 0,"cdl-worker")}catch(e){const t=this._error("getSecureGlobalUserData",`[CDLWorkerCacheManager]: Failed to get secure global user data from cache, err: ${e?.message},`);return this._logger.errorToTelemetry?.(t.message,"cdl_worker_cache_manager_get_secure_global_user_data_error",void 0,!0),null}}async getAllKeys(e){try{const t=await this._cacheStorage.keys(this._cacheName);if(e?.stop(),!t)return[];return t.map((e=>e.url))}catch(t){const n=this._error("getAllKeys",`[CDLWorkerCacheManager]: Failed to get all keys from cache, err: ${t?.message},`);return this._logger.warnToTelemetry?.(n.message,"cdl_worker_cache_manager_get_all_keys_error",{origin:this._cacheName},!0),e?.fail({message:n.message,errorCode:n.code,errors:n.message}),[]}}_error(e,t){return(0,de.Tr)("CDLWorkerCacheManager",h.jK.Undefined,e,void 0,t)}_getScopedRequest(e,t,n){return this._cacheStorage.createRequest(this._cacheName,`${this._cacheName}/${e}`,"Experience",t,!0,n)}}const Qd=(e,t,n)=>{try{const i=new Jd(new Tc(caches,"","",e),t,n);return i.delete(qd.QC),i}catch(e){return void t.error(`[createCDLWorkerCacheManager]: Error occurred while creating CDLWorkerCacheManager: ${(0,de.VK)(e)}`)}};async function Kd(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,y,v){const{workerStartScenarioTimeoutInMs:f}=o.get(b.J.CdlWorker),S=(e,t,n)=>a.newScenario(e,{callback:n,timeoutMs:t}),k=Qd(t.experienceName,i.newLogger("CDL:DataClientCoreWorkerManager","core-services-cdl-worker"),a),C=Zd(l,o),w=Hd(S,f,Wd(C),k,e,u,r,c),T=v&&e.loader?.getCdlSharedWorkerUrl?e.loader?.getCdlSharedWorkerUrl():eu(o,e,a,c),I=v&&e.loader?.getCdlWorkerUrl?e.loader?.getCdlWorkerUrl():void 0,N=Yd(l,o,a,e,c);w.workerStartupScenario.appendEventData({contentType:N.toString(),newState:"beforeBootstrapData"}),function(e,t,n,i){i.log(`Initializing workerType ${e} ${t?"as Worker host":`as non-Worker host with sharedWorkerUrl ${n}`}`)}(C,N,T,c);try{let a;if(N){const e=S(H.RG.CentralDataLayerBootstrapData);try{a=await async function(e,t,n,i,a,o,r){o.mark("getBootstrapDataStart");const s=await async function(e,t,n,i,a,o){let r;a.appendEventData({newState:"beforeAuthUserData"});const s=1e4,l=o.get(b.J.CdlWorker).timeToGetUserFromAuthMs||s;try{r=await(0,V.E)(e.getUser(),l)}catch(e){n.error(`Worker bootstrap authentication error - cannot authenticationService.getUser: ${e?.code}`)}if(!r)return{};let c;a.appendEventData({newState:"beforeDiscoverUserData"});try{c=await(0,V.E)(t.getUser(),l)}catch(e){n.error(`Worker bootstrap authentication error - cannot discover.getUser: ${e?.code}`)}if(!c)return{userInformation:r};const d=c?.id;return{userInformation:r,userDetails:{userDetails:{licenseDetails:{...c,exploratoryTrialLicenseEndDate:Xd(c?.exploratoryTrialLicenseEndDate)},region:c?.region,userRegion:c?.userRegion,partition:c?.partition,userPartition:c?.userPartition,id:d},id:d},authState:i?.getState()?.state||hl.j.Up}}(e,t,n,i,o,r),l=r.get(b.J.CdlWorker).enableGtmTableInWorkerBootstrapData;l&&(o.mark("getGtmTable"),s.gtm=await async function(e,t,n,i){const a=3e3,o=t.get(b.J.CdlWorker).timeToGetGtmTableMs||a;try{return await(0,V.E)(e.regionGtmTable?.()||Promise.resolve(void 0),o)}catch(e){i.mark("getGtmTableError",{errors:e?.code||"no error code"}),n.error(`Worker bootstrap authentication error - cannot get GTM table from Discover: ${e?.code}`)}return}(t,r,n,o),o.mark("getBootstrapDataComplete"));return{hostSettings:a.hostSettings,auth:s}}(r,s,c,u,n,e,o),e.stop()}catch(t){throw e.fail({error:"Unexpected error getting worker bootstrap data"}),t}}w.workerStartupScenario.appendEventData({newState:"beforeInitializeWorkerManagerFromDataClientCore"});const v=await async function(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,y,v,f,S){const{ring:k,environment:C}=d.get(b.J.Metadata),{enableWorkerBroadcast:w}=d.get(b.J.Telemetry),{sessionId:T}=d.get(b.J.Platform),{enablePassingPlatformIdInWorkerUrlHash:I}=d.get(b.J.Core),{workerStartTimeoutInMs:N,workerStartScenarioTimeoutInMs:E,disablePingingPDSIfWorkerStartupFails:A,shouldDisableHealthCheckTimeout:_,enablePausingWorkerScenarioWhenAuthDoesNotHaveUser:F}=d.get(b.J.CdlWorker),D=C?(0,W.get)(pt.s,C):void 0;return h.workerStartupScenario.appendEventData({newState:"beforeInitializeWorkerManager"}),Bd(e,t,{logger:new Fc(s.newLogger("CDL:DataClientCoreWorkerManager","core-services-cdl-worker")),newScenario:g,offlineCacheManager:r,workerCacheManager:c,hostRendererId:e},{cdlSharedWorkerUrl:n||"",cdlWebWorkerUrl:i||""},N||void 0,E||void 0,a,o,{experienceName:a,ring:k?.id||void 0,environment:D,platformId:I?l.config.platformId:void 0,sessionId:T||void 0,buildVersion:l.config.buildVersion,localeCode:y,workerId:p,publicPath:u.__webpack_public_path__,preECSConsoleLogLevel:u.defaultConsoleLogLevel?.preECSConsoleLogLevel,userConsoleLogLevel:u.defaultConsoleLogLevel?.userConsoleLogLevel,deviceId:l.host.deviceId,telemetryWorkerBroadcast:!!w},v,u,m,h,!!A,f,!!_,S,!!F)}(t.clientId,C,T,I,t.experienceName,a,d,i,l,k,o,e,u,p,S,w,g,h,r,y);return!!o?.get(b.J.CdlWorker)?.enableUserContextWorkerRegistration&&(p&&a?.auth.userDetails?.id?m.mapUserIdToRegisteredWorker(p,a.auth.userDetails.id):c.errorToTelemetry?.(`Unable to register worker '${p}' to user through worker registrar for userId '${a?.auth.userDetails?.id}'`,"cdl_worker_init_register_user_context",{origin:p,userId:a?.auth.userDetails?.id},!0)),v}catch(e){return void c.errorToTelemetry?.(`Failed to start CDL Worker from DataClientCore: ${(0,de.VK)(e)}`,"cdl_services_worker_worker_service_start_client_core_cdl_worker_error",void 0,!0)}}const Yd=(e,t,n,i,a)=>{const o=Zd(e,t),r=eu(t,i,n,a);return"webworker"===o||"web"===o||!r};function Xd(e){try{return e?.toISOString()}catch{return}}function Zd(e,t){let n=e.config.clientType===An.Bh.Web?"webworker":"sharedworker";const i=t.get(b.J.Host).cdlWorkerType,a=t.get(b.J.CdlWorker).cdlWorkerType;return i?n=i:a&&(n=a),n}function eu(e,t,n,i){let{cdlSharedWorkerUrl:a}=e.get(b.J.Host);const o=t.localStorage.getItem("ts.cdlSharedWorkerJsUrl");if(a&&o&&a!==o){i.errorToTelemetry?.(`Worker URL saved in TSW:${a} is different from worker url in TMP:${o}`,"cdl_services_worker_worker_service_get_cdl_shared_worker_url_error",void 0,!0);n.newScenario(H.RG.HostSettingsSync).fail({reason:JSON.stringify({cdlSharedWorkerUrl:a,storedWorkerUrl:o})}),a=o}return a}var tu=n(118359);class nu extends _e{constructor(){super(h.Yg.CreateCDLWorkerAppServiceTask,["windowProvider","scenarioFactory","coreSettings","platformService","loggerFactory"])}async execute(e){const t=(0,tu.Q6)(e.coreSettings),n=!!e.coreSettings.get(b.J.CdlWorker).enableCdlAppStateService;if(!t||!n)return Promise.resolve();const i=new _c(e);return e.cdlAppStateService=i,function(e,t,n,i,a,o,r){Yd(i,n,t,e,a)&&o.getCDLWorkerManager().then((e=>{e?.state.setState("appService:Loaded",r)}))}(e.windowProvider,e.scenarioFactory,e.coreSettings,e.platformService,e.loggerFactory.newLogger("CDLWorkerManager","core-services-tasks"),e.cdlWorkerService,i)}}class iu extends _e{constructor(){super(h.Yg.CreateCDLWorkerAuthTask,["cdlWorkerRegistrarService","cdlWorkerService","scenarioFactory"])}async execute(e){const t=(0,tu.Q6)(e.coreSettings),{cdlWorkerService:n,cdlWorkerRegistrarService:i,scenarioFactory:a}=e;if(t&&n){const{enableCleanUpOnLogout:t,enablePausingWorkerScenarioWhenAuthDoesNotHaveUser:o}=e.coreSettings.get(b.J.CdlWorker);if(o){const e=a.findScenario(H.RG.CentralDataLayerWorkerManagerStartup);e?.isPaused&&e.resume({reason:"UserAuthenticated"})}if(function(e,t,n,i,a,o,r,s,l,c){Yd(o,n,t,e,r)&&s.getCDLWorkerManager().then((e=>{e?.state.setState("authLoaded",{authenticationService:i,discover:a,authStateProvider:c,cdlWorkerRegistrarService:l})}))}(e.windowProvider,e.scenarioFactory,e.coreSettings,e.authenticationService,e.discover,e.platformService,e.loggerFactory.newLogger("CDLWorkerManager","core-services-tasks"),n,i,e.authStateProvider),!t)return;return async t=>{"signout"===t&&await n.logoutCurrentUser(e.coreSettings)}}}}class au{constructor(e,t,n,i){this.cdlWorkerService=i,this._logger=n.newLogger("CDLWorkerStateSender","core-services-cdl-worker"),this._clientStateSubscription=e.observe().subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:sd.NotifyCoreClientState,context:{appState:e}}))),this._machineLockStateSubscription=t.observe().pipe((0,Es.x)(((e,t)=>e.machineLockState===t.machineLockState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:sd.NotifyCoreMachineState,context:{appState:e.machineLockState}}))),this._suspendedStateSubscription=t.observe().pipe((0,Es.x)(((e,t)=>e.suspendedState===t.suspendedState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:sd.NotifyCoreSuspendedState,context:{appState:e.suspendedState}}))),this._machineIdleStateSubscription=t.observe().pipe((0,Es.x)(((e,t)=>e.machineIdleState===t.machineIdleState))).subscribe((e=>this.sendAppStateChangeToWorker({requestOperationtype:sd.NotifyCoreMachineIdleState,context:{appState:e.machineIdleState}})))}dispose(){this._clientStateSubscription&&(this._clientStateSubscription.unsubscribe(),this._clientStateSubscription=void 0),this._machineLockStateSubscription&&(this._machineLockStateSubscription.unsubscribe(),this._machineLockStateSubscription=void 0),this._suspendedStateSubscription&&(this._suspendedStateSubscription.unsubscribe(),this._suspendedStateSubscription=void 0),this._machineIdleStateSubscription&&(this._machineIdleStateSubscription.unsubscribe(),this._machineIdleStateSubscription=void 0)}async sendAppStateChangeToWorker(e){const t=(0,$.u4)(e);let n;try{n=await this.getCdlAppStateClient()}catch{return void this._logger.errorToTelemetry?.(`Failed to send app state change ${t} to CDL. Reason: failed to obtain a CDLAppStateClient. See initialization failures earlier in the logs.`,"cdl_services_worker_worker_state_sender_send_app_state_get_client_error",void 0,!0)}if(n){this._logger.log(`Alerting CDL Worker of host state change: ${t}`);try{await n.sendFilteredAppStateRequest(e)}catch(e){this._logger.errorToTelemetry?.(`Failed to send app state change ${t} to CDL. Reason: ${(0,$.u4)(e)}`,"cdl_services_worker_worker_state_sender_send_app_state_send_request_error",void 0,!0)}}else this._logger.errorToTelemetry?.(`Failed to send app state change ${t} to CDL. Reason: CDLAppStateClient does not exist. See initialization failures earlier in the logs.`,"cdl_services_worker_worker_state_sender_send_app_state_get_client_undefined_error",void 0,!0)}async getCdlAppStateClient(){const e=await this.cdlWorkerService.getCDLWorkerManager();return e?.workerClientResponseRouter.cdlAppStateClient}}class ou extends Zc{constructor(e,t){super(),this.workerClientResponseRouter=e,this.logger=t.loggerFactory.newLogger("CDLControlPlaneCommunicator","cdl-control-plane-communicator")}sendMessage(e){this.getRequestForOperationName(e).then((t=>this.handleResponse(e.rendererId,e.requestId,this.extractPerfStats(t)))).catch((t=>this.handleResponse(e.rendererId,e.requestId,void 0,(0,$.u4)(t)||"Unknown Error")))}getRequestForOperationName(e){const t=e.operationName;if(!t)return Promise.reject(`Request could not be sent: operationName unavailable. RequestId: ${e.requestId}.`);switch(this.logger.log(`Converting GQL operation ${t} to CDL Worker control plane message.`),t){case"notifyWorkerSyncCanStart":return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"sync_can_start"});case"AppsChatNotifyActiveContextChangedMutation":const t=e.request.variables;return this.workerClientResponseRouter.cdlControlClient.sendRequest({type:"active_context_changed",activeContextChangedData:{activeContextId:t.activeContextId,activeContextType:t.activeContextType}})}}handleResponse(e,t,n,i){return Promise.resolve(this.onResponseReceived({payload:{dataLayer:{rendererId:e,requestId:t,data:!i,errors:i,extensions:{perfStats:n}}}}))}extractPerfStats(e){return{workerResponseTime:e.workerResponseTime||0,dataStorePerfStats:[]}}}var ru=n(407271),su=n(396015),lu=n(686708);class cu{constructor(e,t,n,i,a,o,r,s,l){this.configLoader=e,this.coreSettingsContext=n,this.platformService=a,this.primaryUser=o,this.locale=r,this.osLocale=s,this.osLocaleInfo=l,this._settings={},this.logger=i.newLogger("CDLWorkerHostSettingsAggregator","core-services-cdl-worker"),this.coreSettings=t,this.cdlWorkerSettingsAllowlist=this.getCdlWorkerSettingsAllowlist()}get hostSettings(){return 0===Object.keys(this._settings).length&&(this._settings=this.getAllWorkerSettings()),this._settings}startNotifyingCDLWorkerForHostSettingsChanges(e){const t=this.coreSettings.getObservableForAnySettingsChangeForCdlWorker();this.settingsChangedSubscription=t.subscribe((()=>{this.notifyCDLWorkerForSettingsChanges(e)}))}cleanup(){this.settingsChangedSubscription?.unsubscribe(),this.settingsChangedSubscription=void 0}notifyCDLWorkerForSettingsChanges(e){const t=this.getAllWorkerSettings();(0,W.isEqual)(this._settings,t)||(this._settings=t,this.logger.log("Notifying CDL Worker of host settings changes: ",t),e.sendRequest({type:"host_settings_updated",hostSettings:t}))}getCdlWorkerSettingsAllowlist(){const{cdlWorkerOnly:e={},forwardToCdlWorker:t={}}=this.coreSettings.getCdlWorkerSettingsAllowlist()??{},n=[...new Set([...Object.keys(e),...Object.keys(t)])];return Object.fromEntries(n.map((n=>[n,[...new Set([...e[n]||[],...t[n]||[]])]])))}getAllWorkerSettings(){const e=this.getCdlWorkerSettings();return{...e,[b.J.Host]:(0,W.mergeWith)(e.host||{},this.aggregateHostSettings(),su.g)}}aggregateHostSettings(){this.logger.debug("aggregateHostSettings called...");const{enableNetworkStateCommsBetweenCoreAndWorker:e,enableMTMA:t}=this.coreSettings.get(b.J.Core),{electronVersion:n,enableHybridChannelList:i=!1,msgEnableChannelsV2:a=!1,msgEnableChannelsV2Header:o=!1,msgEnableSelfChat:r=!1,userType:s="",windowsInsiderChannel:l}=this.coreSettings.get(b.J.Host),c=this.coreSettingsContext,{enableTPSSyncStrategy:d,enableTPSUpdatesOverTrouter:u,tpsSyncStrategyPollingIntervalMs:m,enablePinnedChannelUpdatesOverTPS:p}=this.coreSettings.get(b.J.CdlWorker);let g={enableNetworkStateCommsBetweenCoreAndWorker:!!e,enableMTMA:!!t,policiesNamespaces:(0,lu.z$)(this.configLoader,this.coreSettings),enableSyncEngine:(0,tu.Q6)(this.coreSettings),enableProfileManagerStore:(0,tu.bE)(this.coreSettings),enableMessagingNotificationsOverTrouter:this.isMessagingNotificationsOverTrouterEnabled(),imageCookieAuthEnabled:!this.coreSettings.get(b.J.Auth).skipAmsAuthRequest,msgEnableChannelsV2:a,msgEnableChannelsV2Header:o,msgEnableSelfChat:r,enableHybridChannelList:i,enableEspInWorker:!!this.coreSettings.get(b.J.Esp).enableEsp,espIrisExperimentFlightIds:this.coreSettings.get(b.J.Esp).espIrisExperimentFlightIds,espIrisPlacementId:this.coreSettings.get(b.J.Esp).espIrisPlacementId,ecsHostUrl:this.platformService.ecsOverrides.hostUrl,desktopVersion:this.platformService.host.hostAppVersion,initialWorkerHostLocationUrl:this.platformService.config.currentUrl,serviceSwitcherSelectedServiceId:c.getServiceSwitcherApiKey(),electronVersion:n,locale:this.locale||h.ZW,osLocale:this.osLocale,osLocaleInfo:this.osLocaleInfo,userType:s,windowsInsiderChannel:l,enableTPSSyncStrategy:!!d,enableTPSUpdatesOverTrouter:!!u,enablePinnedChannelUpdatesOverTPS:!!p,tpsSyncStrategyPollingIntervalMs:m,...this.getCdlWorkerHostSettings(this.coreSettings),...this.getActivityHostSettings(this.coreSettings),...this.getActivityNotificationHostSettings(this.coreSettings),...this.getEndpointsHealthHostSettings(this.coreSettings),...this.getPeopleHostSettings(this.coreSettings),...this.getMessagingHostSettings(this.coreSettings),...this.getTeamsAndChannelsHostSettings(this.coreSettings),...this.getCalendarHostSettings(this.coreSettings),...this.getExternalAccountHostSettings(this.coreSettings),...this.getPresenceHostSettings(this.coreSettings),...this.getDataStoreHostSettings(this.coreSettings),...this.getFilesHostSettings(this.coreSettings),...this.getAuthHostSettings(this.coreSettings),...this.getDiscoverSurfaceHostSettings(this.coreSettings),...this.getMtmaSpecificHostSettings(),...this.getGuardiansHostSettings(this.coreSettings)},y=this.getCoreSettingsTestOverrides(this.coreSettingsContext);const{isRunningGlassjar:v}=this.coreSettings.get(b.J.Test);if(this.platformService.config.isInCypressFrame||v){const e={authOverrides:{authzEndpointUrl:this.coreSettings.get(b.J.Auth).authzEndpointUrl},csaOverrides:{csaHostUrl:this.coreSettings.get(b.J.CsaService).apiConstants?.host}};g={...g,...e},y={localStorageTestOverrides:{...y.localStorageTestOverrides,test:{}},qspTestOverrides:y.qspTestOverrides}}return{...g,...y}}getCdlWorkerSettings(){const e=this.getAllowlistedCdlWorkerSettings(),t=this.getAllowlistedCdlWorkerSettingsByOverrides(),n={[b.J.Messaging]:{allowUserChat:this.getAllowUserChat(this.coreSettings)},[b.J.Calling]:{callGroupMembershipSettings:this.coreSettings.get(b.J.Calling).voiceAdminSettings?.callGroupMembershipSettings}};return this.mergeSettings(e,t,n)}getAllowlistedCdlWorkerSettings(){return this.getCdlWorkerSettingsForAllowlist(this.cdlWorkerSettingsAllowlist)}getAllowlistedCdlWorkerSettingsByOverrides(){const e=this.coreSettings.get(b.J.Core).forwardCdlWorkerSettingsOverrides||[],t={};return e.forEach((e=>{const n=e.category,i=e.featureFlag,a=t[n]||[];void 0===t[n]&&(t[n]=a),a.push(i)})),this.getCdlWorkerSettingsForAllowlist(t)}getCdlWorkerSettingsForAllowlist(e){const t=this.coreSettings.getAllCachedSettings(),n={};return Object.keys(e).forEach((i=>{const a=t[i]??{},o={};e[i]?.forEach((e=>{const t=(0,W.get)(a,e);(0,W.isNil)(t)||(0,W.set)(o,e,t)})),Object.keys(o).length>0&&(n[i]=o)})),n}mergeSettings(...e){const t=Object.values(b.J);return Object.fromEntries(t.map((t=>[t,(0,W.merge)({},...e.map((e=>e[t])))])).filter((e=>Object.keys(e[1]).length>0)))}getAllowUserChat(e){const{allowUserChat:t,messagingPolicy:n}=e.get(b.J.Messaging);return"boolean"==typeof t||!!n?!!t:void 0}getPresenceHostSettings(e){const{enablePresenceInWorker:t,enablePresenceNotificationsOverTrouter:n,enableReportingUserActivityThroughTrouterByPresence:i,enablePriorityContactsSettings:a,enableSendPresenceTokenToUPS:o,upsTrouterConnectEndpointRecreateDelayInMs:r,priorityContactsRefreshIntervalInMs:s}=e.get(b.J.Presence);return{enablePresenceInWorker:Boolean(t),enablePresenceNotificationsOverTrouter:Boolean(n),enableReportingUserActivityThroughTrouterByPresence:Boolean(i),enablePriorityContactsSettings:Boolean(a),enableSendPresenceTokenToUPS:Boolean(o),upsTrouterConnectEndpointRecreateDelayInMs:r??0,priorityContactsRefreshIntervalInMs:s??0}}getAuthHostSettings(e){const{skypeTokenValidationDisabled:t}=e.get(b.J.Auth);return{skypeTokenValidationDisabled:!!t}}getCdlWorkerHostSettings(e){const t=e.get(b.J.CdlWorker);return{enableClassBasedErrors:!!t.enableClassBasedErrors,enablePoliciesSyncEngine:!!t.enablePoliciesSyncEngine,enableCrossTenantPoliciesSyncEngine:!!t.enableCrossTenantPoliciesSyncEngine,enableOpenWindowsSettingsMaglev:!!t.enableOpenWindowsSettingsMaglev,enableSendNudgeAfterInactivityPeriod:!!t.enableSendNudgeAfterInactivityPeriod,enableMeetNowLinksReminder:!!t.enableMeetNowLinksReminder,enableNotificationsEngine:!!t.enableNotificationsEngine,enableAppsUsageSyncEngine:!!t.enableAppsUsageSyncEngine,enableUserPreferencesWorkerFetch:!!t.enableUserPreferencesWorkerFetch,enableAppsPlatformSyncEngine:!!t.enableAppsPlatformSyncEngine,enableAppsPlatformTrouterUpdates:this.isMessagingNotificationsOverTrouterEnabled()&&!!t.enableAppsPlatformTrouterUpdates,enableChatWithUserNetworkFetch:!!t.enableChatWithUserNetworkFetch,enableOfflineActionsSyncEngine:!!t.enableOfflineActionsSyncEngine,enableStartupDeferral:!!t.enableStartupDeferral,enableTenantSyncStrategy:!!t.enableTenantSyncStrategy,enableSearchTopNPopulateStrategy:!!t.enableSearchTopNPopulateStrategy,enableSensitivityLabelSync:!!t.enableSensitivityLabelSync,enableWaitOnAuthUp:!!t.enableWaitOnAuthUp,enableStartupUsingPartialData:!!t.enableStartupUsingPartialData,enableNonRecentChatsStartup:!!t.enableNonRecentChatsStartup,nonRecentChatsStartupPageSize:t.nonRecentChatsStartupPageSize,nonRecentChatsStartupMaxCalls:t.nonRecentChatsStartupMaxCalls,nonRecentChatsStartupWorkflowTimeoutInMS:t.nonRecentChatsStartupWorkflowTimeoutInMS,chatsStartupJobPageSize:t.chatsStartupJobPageSize,chatListCacheDaysThreshold:t.chatListCacheDaysThreshold,partialDataStartupChatsLimit:t.partialDataStartupChatsLimit,partialDataStartupSkipNonRecentMeeting:t.partialDataStartupSkipNonRecentMeeting,skipMeetingChatsInGroupChatSync:!!t.skipMeetingChatsInGroupChatSync,enableChatTitleCache:!!t.enableChatTitleCache,enableMruChannelsMemoryPruning:!!t.enableMruChannelsMemoryPruning,disableUnknownTitleFallback:!!t.disableUnknownTitleFallback,disableTitleCacheRefreshOnDisplayNameChange:!!t.disableTitleCacheRefreshOnDisplayNameChange,disablePartialLoadConversationNetworkFetch:!!t.disablePartialLoadConversationNetworkFetch,enableMultipleReplyChainsUpdatesFromWorker:!!t.enableMultipleReplyChainsUpdatesFromWorker,enableMTMAAggregator:!!t.enableMTMAAggregator,disablePingingPDSIfWorkerStartupFails:t.disablePingingPDSIfWorkerStartupFails,currentConversationTableVersion:t.currentConversationTableVersion,disableMessageContentWrapperDiv:t.disableMessageContentWrapperDiv,enablePriorityJobRunner:!!t.enablePriorityJobRunner,scheduleChannelsConversationSyncAtBackgroundPriority:!!t.scheduleChannelsConversationSyncAtBackgroundPriority,trouterNotifyServiceDownTimerMs:t.trouterNotifyServiceDownTimerMs,chatServiceMaxPageSize:t.chatServiceMaxPageSize,chatReplyChainsToFetch:t.chatReplyChainsToFetch,preloadNamespaces:t.preloadNamespaces}}getActivityHostSettings(e){const t=e.get(b.J.Activity);return{enableActivityManagerStore:!!t.enableActivityManagerStore,enableActivityBellCount:!!t.enableActivityBellCount,feedItemsCountOnAppLoad:t.paginationFirstLoad||0,enableOrderFeedsReplyChainsByMaxVersion:!!t.enableOrderFeedsReplyChainsByMaxVersion,enableChannelFeedItems:!!t.enableChannelFeedItems,enableActivityTranslationInCDL:!!t.enableActivityTranslationInCDL,enableMarkAllAsReadLogic:!!t.enableMarkAllAsReadLogic,enableSharedChannelFeedItems:!!t.enableSharedChannelFeedItems,enableUrgentFeedItems:!!t.enableUrgentFeedItems,enableSyntheticNotificationProcessor:!!t.enableSyntheticNotificationProcessor,enableGraphFeedItems:!!t.enableGraphFeedItems,disableIncomingPstnActivityFeed:!!t.disableIncomingPstnActivityFeed,enableMTMAMissedNotifications:!!t.enableMTMAMissedNotifications,mtmaNotificationsPollingInterval:t.mtmaNotificationsPollingInterval||cu.mtmaNotificationsPollingIntervalDefault}}getActivityNotificationHostSettings(e){const{enableNewSettingsApiUse:t,enableMissedActivityEmails:n}=e.get(b.J.ActivityNotification);return{enableNewSettingsApiUse:!!t,enableMissedActivityEmails:!!n}}getPeopleHostSettings(e){const t=e.get(b.J.People);return{enableBuddyListService:!!t.enableBuddyListService,buddyListRefreshTimeoutInMilliSeconds:t.buddyListRefreshTimeoutInMilliSeconds||0,blockedListRefreshIntervalInMs:t.blockedListRefreshIntervalInMs||0,blockedListPendingActionQueueChunkSize:t.blockedListPendingActionQueueChunkSize||0,enableContactsSync:!!t.enableContactsSync,enableMultipleAliasesForContactsSync:!!t.enableMultipleAliasesForContactsSync,maxNumberOfRoamingDevices:t.maxNumberOfRoamingDevices||0,enableInstantSyncForRoamingDevices:!!t.enableInstantSyncForRoamingDevices,fetchTFLContactsRefreshInterval:t.fetchTFLContactsRefreshInterval||[],enableEndpointsManagerOnAcceptListService:!!t.enableEndpointsManagerOnAcceptListService,enableEndpointsManagerOnBuddyService:!!t.enableEndpointsManagerOnBuddyService,enableEndpointsManagerOnBlockService:!!t.enableEndpointsManagerOnBlockService,contactsSyncDeltaRefreshIntervalInMs:t.contactsSyncDeltaRefreshIntervalInMs||0,contactsSyncFullRefreshIntervalInMs:t.contactsSyncFullRefreshIntervalInMs||0,contactsSyncKeepAliveIntervalInMs:t.contactsSyncKeepAliveIntervalInMs||0,maxBatchSizeforSCDDeletion:t.maxBatchSizeforSCDDeletion||0,lokiTokenResourceUrl:t.lokiTokenResourceUrl||"",buddyServiceEndpointManagerMaxRetries:t.buddyServiceEndpointManagerMaxRetries||0,enableTflTfwFederation:!!t.enableTflTfwFederation,enableProfilePicturesWithObjectId:!!t.enableProfilePicturesWithObjectId,enableMeProfileSyncStrategy:!!t.enableMeProfileSyncStrategy,checkProfileExpiryAndRefreshIntervalInMs:t.checkProfileExpiryAndRefreshIntervalInMs||0,enableTfwToTfwFederatedInviteFree:!!t.enableTfwToTfwFederatedInviteFree,enableBlockedContactsDataStore:!!t.enableBlockedContactsDataStore,enableM365Endpoint:!!t.enableM365Endpoint,enableExtendedDirectory:!!t.enableExtendedDirectory,enableCapiv3ContactsSync:!!t.enableCapiv3ContactsSync,enableSharedChannelPeoplePickerErrorMessages:!!t.enableSharedChannelPeoplePickerErrorMessages,enableProfileFetchFromWorkingSet:!!t.enableProfileFetchFromWorkingSet,enableAtMentionEveryoneInGroupChat:!!t.enableAtMentionEveryoneInGroupChat,enableAtMentionEveryoneInMeetingChat:!!t.enableAtMentionEveryoneInMeetingChat,enableAddAnonDisplayNameTagsInProfile:!!t.enableAddAnonDisplayNameTagsInProfile}}getMessagingHostSettings(e){const t=e.get(b.J.Messaging);return{enableChatWithNonTflUsers:!!t.enableChatWithNonTflUsers,enableCSAChatSummarization:!!t.enableCSAChatSummarization,enableCSAChatSummarizationV2:!!t.enableCSAChatSummarizationV2,chatSummarizationTimeoutOverride:t.chatSummarizationTimeoutOverride,enableTflSmsCreate:!!t.enableTflSmsCreate,enableTfwTflFederation:!!t.enableTfwTflFederation,enableTfwFederationOnTfl:!!t.enableTfwFederationOnTfl,enableTFLSmsFriendlyNameSearch:!!t.enableTFLSmsFriendlyNameSearch,tflSmsAllowedPhoneNumberRegionCodes:t.tflSmsAllowedPhoneNumberRegionCodes||[],disableMessagingSyncEngine:!!t.disableMessagingSyncEngine,enableAutoSendV2:!!t.enableAutoSendV2,disableRendererSideSanitization:!!t.disableRendererSideSanitization,enableTranslationSettings:!!t.enableTranslationSettings,enableSingleInbox:!!t.enableSingleInbox,enableTagsMention:!!t.enableTagsMention}}getTeamsAndChannelsHostSettings(e){const t=e.get(b.J.Channels),n=e.get(b.J.TeamsAndChannels);return{enablePinnedChannelsSyncEngine:!!n.enablePinnedChannelsSyncEngine,maximumPinnedChannelLimit:n.maximumPinnedChannelLimit,pinnedChannelsSyncIntervalInMs:n.pinnedChannelsSyncIntervalInMs,enableFixingPinnedChannelsConflict:!!n.enableFixingPinnedChannelsConflict,enableUserResolutionForChannelModeratorList:!!n.enableUserResolutionForChannelModeratorList,enableRecommendedTeamsSync:!!n.enableRecommendedTeamsSync,allowChannelSharingToExternalUser:!!n.allowChannelSharingToExternalUser,enableChannelInfoPane:!!t.enableChannelInfoPane,enableUseT1LocaleInTranslation:!!t.enableUseT1LocaleInTranslation,enableChannelsUserResolutionInT21:!!t.enableChannelsUserResolutionInT21,allowGuestUser:!!n.allowGuestUser}}getCalendarHostSettings(e){const t=e.get(b.J.Calendar);return{autodiscoverSettings:t.autodiscoverSettings,calendarRESTEnabledAPIs:t.calendarRESTEnabledAPIs,connectedCalendarSettingsRefreshIntervalInMs:t.connectedCalendarSettingsRefreshIntervalInMs||0,enableCalendarSyncEngine:!!t.enableCalendarSyncEngine,enableCalendarV2ApiService:!!t.enableCalendarV2ApiService,enableCalendarV2ApiServiceEnterprise:!!t.enableCalendarV2ApiServiceEnterprise,enableCalendarManagerPrefetchInMemoryData:!!t.enableCalendarManagerPrefetchInMemoryData,enableClientStateCheckForCalendarPolling:!!t.enableClientStateCheckForCalendarPolling,enableMultipleCalendarSyncEngine:!!t.enableMultipleCalendarSyncEngine,enableUnifiedCalendarSyncEngine:!!t.enableUnifiedCalendarSyncEngine,enableConnectedCalendar:!!t.enableConnectedCalendar,enableConnectedCalendarSettingsSync:!!t.enableConnectedCalendarSettingsSync,enableCourseCalendarSyncEngine:t.enableCourseCalendarSyncEngine,enableEventFetchOptimizationUsingLastSync:t.enableEventFetchOptimizationUsingLastSync,enableMeetingArtifactsCollaborationData:t.enableMeetingArtifactsCollaborationData,enablePrefetchCourseCalendarEventsOnStartUp:t.enablePrefetchCourseCalendarEventsOnStartUp,isOnCloud:t.isOnCloud,maxRoomListsToFetch:t.maxRoomListsToFetch,maxRoomsInRoomListToFetch:t.maxRoomsInRoomListToFetch,maxRoomsToFetch:t.maxRoomsToFetch,enableThirdPartyCalendar:!!t.enableThirdPartyCalendar,calendarEventsPollIntervalInMs:t.calendarEventsPollIntervalInMs,calendarEventsPollIntervalWithPushInMs:t.calendarEventsPollIntervalWithPushInMs,isLmsCourseCalendar:!!t.isLmsCourseCalendar,enablePrefetchCalendarEventsOnStartUp:!!t.enablePrefetchCalendarEventsOnStartUp,enableSensitivityLabelInCalendar:!!t.enableSensitivityLabelInCalendar,enableCalendarPushNotifications:!!t.enableCalendarPushNotifications,enableCalendarPollingWithPushNotifications:!!t.enableCalendarPollingWithPushNotifications,enableCalendarGCVOptimizations:!!t.enableCalendarGCVOptimizations,enableCalendarMailBoxDiscoveryHandler:!!t.enableCalendarMailBoxDiscoveryHandler,enablePushCalendarEventsOnSubscription:!!t.enablePushCalendarEventsOnSubscription}}getExternalAccountHostSettings(e){const{enableExternalAccounts:t,requestSource:n,enableUnifiedHardDelete:i}=e.get(b.J.ExternalAccounts);return{enableExternalAccounts:!!t,requestSource:n,enableUnifiedHardDelete:!!i}}getEndpointsHealthHostSettings(e){const{enableWorkerEndpointsHealthMonitor:t,enableWorkerEndpointsHealthService:n}=e.get(b.J.Core);return{enableWorkerEndpointsHealthMonitor:!!t,enableWorkerEndpointsHealthService:!!n}}getDataStoreHostSettings(e){const t=e.get(b.J.CdlWorker);return{enableDbOpenTimeout:!!t.enableDbOpenTimeout,dbOpenTimeoutLengthSeconds:t.dbOpenTimeoutLengthSeconds||60,dataStoreMapType:t.dataStoreMapType||"",disableDataStoreInMemoryProvider:!!t.disableDataStoreInMemoryProvider,disableDataStoreDbProvider:!!t.disableDataStoreDbProvider,rollbackSupportInDataStoreInMemoryProvider:!!t.rollbackSupportInDataStoreInMemoryProvider,disableReplyChainManagerPrefetch:!!t.disableReplyChainManagerPrefetch,dataStoreCreationResiliencyConfig:t.dataStoreCreationResiliencyConfig||{enable:!1},disableRetryOnStoreMissing:!!t.disableRetryOnStoreMissing,dataStoreDbOperationResiliencyConfig:t.dataStoreDbOperationResiliencyConfig,enableConversationTypeIndex:!!t.enableConversationTypeIndex}}getCoreSettingsTestOverrides(e){const t=e;return{localStorageTestOverrides:t.getLocalStorageTestOverrides()||{},qspTestOverrides:t.getQspTestOverrides()||{}}}getFilesHostSettings(e){const{preferGraphOverVroom:t,vroomEndpointBaseUrl:n,graphEndpointBaseUrl:i,graphAuthScope:a,vroomAuthScope:o}=e.get(b.J.Files);return{filesOverrides:{preferGraphOverVroom:!!t,vroomEndpointBaseUrl:n||"",graphEndpointBaseUrl:i||"",graphAuthScope:a||"",vroomAuthScope:o||""}}}getDiscoverSurfaceHostSettings(e){const t=e.get(b.J.DiscoverSurface);return{enableHybridDiscoverSurface:!!t.enableHybridDiscoverSurface,discoverSurfaceTopItemsCount:t.discoverSurfaceTopItemsCount||ru.$O.defaultItemsToFetch,enableNewPollingChanges:!!t.enableNewPollingChanges,disableDiscoverNetworkCall:!!t.disableDiscoverNetworkCall,discoverSurfaceDefaultSection:t.discoverSurfaceDefaultSection||ru.$O.defaultSection,enableDiscoverSurfaceDebugMenu:!!t.enableDiscoverSurfaceDebugMenu,serverCacheRetentionTimeInHrsSinceFirstCall:t.serverCacheRetentionTimeInHrsSinceFirstCall||ru.$O.defaultServerCacheRetentionTimeInHrsSinceFirstCall,enableDiscoverBadging:!!t.enableDiscoverBadging,dataSyncIntervalTime:t.dataSyncIntervalTime||ru.$O.defaultDataSyncIntervalTime,enableDiscoverSurfaceSyncEngine:!!t.enableDiscoverSurfaceSyncEngine}}getMtmaSpecificHostSettings(){const{enableMTMA:e}=this.coreSettings.get(b.J.Core);return e&&this.primaryUser&&this.primaryUser.profile?{primaryUserProfile:{oid:this.primaryUser.profile.objectId,tid:this.primaryUser.profile.tenantId}}:{}}isMessagingNotificationsOverTrouterEnabled(){const e=this.coreSettings.get(b.J.Host).enableMessagingNotificationsOverTrouter;return(0,W.isNil)(e)?!!this.coreSettings.get(b.J.CdlWorker).enableMessagingNotificationsOverTrouter:e}getGuardiansHostSettings(e){const{enableGuardiansPreferredMethodAndSmsInvite:t}=e.get(b.J.Guardians);return{enableGuardiansPreferredMethodAndSmsInvite:t}}}cu.mtmaNotificationsPollingIntervalDefault=3e5;class du{constructor(){this.perfDataByOperationName=new Map,this.cdlSubscriptionAggregatorAllowList=["chatServiceEvent","DataResolversBrowserChatServiceEventsChatServiceBatchEventSubscription","DataResolversBrowserChatServiceEventsChatServiceEventSubscription"]}static getInstance(){return this.subscriptionEventAggregatorSingleton||(this.subscriptionEventAggregatorSingleton=new du),this.subscriptionEventAggregatorSingleton}init(e,t,n,i){this.logger=e.newLogger("SubscriptionEventAggregator","core-cdl-data-layer-client"),n&&(this.cdlSubscriptionAggregatorAllowList=n),this.logger?.log(`Initialized CDLSubscriptionEventAggregator Allow List: ${this.cdlSubscriptionAggregatorAllowList.join(",")}`),this.intervalCancellationToken=setInterval((()=>{this.logStats(t)}),i||z.A_)}addToTimeline(e,t,n,i,a,o,r){if(this.intervalCancellationToken||this.init(n,i,a,r),!t)return void(this.logger&&this.logger.log("Received subscription perf stat without responseSendTime. Ignoring."));const s=Date.now()-t;if(!(s<0)&&(e&&!this.perfDataByOperationName.has(e)&&this.perfDataByOperationName.set(e,{ipcTimes:[],customIdentifierCount:{}}),e)){const t=this.perfDataByOperationName.get(e);if(!t)return void(this.logger&&this.logger.warn(`SubscriptionEventAggregator: No perf data found for operationName ${e}`));if(t.ipcTimes.push(s),o){let e={};e="string"==typeof o?{[o]:1}:o,Object.keys(e).forEach((n=>{const i=e[n];t.customIdentifierCount[n]||(t.customIdentifierCount[n]=0),t.customIdentifierCount[n]+=i}))}}}logStats(e){const t=Array.from(this.perfDataByOperationName.entries());this.perfDataByOperationName.clear();for(const[n,i]of t){if(!this.cdlSubscriptionAggregatorAllowList.includes(n))continue;const t={operationName:n,numberOfRequests:i.ipcTimes.length,averageIPCTimeOneWay:i.ipcTimes.reduce(((e,t)=>e+t),0)/i.ipcTimes.length},a=e.newScenario(H.RG.CentralDataLayerSubscription);(0,W.keys)(i.customIdentifierCount).forEach((e=>{a.mark(e,{size:i.customIdentifierCount[e],type:e})})),a.stop(t)}}}function uu(e,t,n,i){e.measure(t,n,i),e.clearMeasures(t),e.clearMarks(n),i&&e.clearMarks(i)}class mu{constructor(e,t,n){this.isResponse=t,this.internalPerfStat={operationName:n,requestStartTime:{perf:performance.now(),date:Date.now()},responseReceivedTime:{perf:performance.now(),date:Date.now()},workerResponseTime:0,dataStorePerfStats:[]},this.operationName=n||"",this.operationType=e,performance.mark(`${this.getPerformanceName()}-start`)}stopMeasurement(e,t,n){this.internalPerfStat={...this.internalPerfStat,...e,responseReceivedTime:{perf:performance.now(),date:Date.now()}};const i=this.getPerformanceName(),a=`${i}-start`,o=`${i}-end`;!function(e,t){void 0===function(e,t){const n=t.getEntriesByName(e);if(n&&n.length>0)return n[0]}(e,t)&&t.mark(e)}(a,performance),performance.mark(o),uu(performance,i,a,o);const{requestStartTime:r,requestReceivedTime:s,responseSendTime:l,responseReceivedTime:c,workerResponseTime:d}=this.internalPerfStat,u={totalRequestTime:Math.round(c.perf-r.perf),workerResponseTime:Math.round(d),requestTime:Math.round(r.perf),responseTime:Math.round(c.perf)};return t?.length&&(u.otherResponsesReceivedWhileInTransit=t),n&&(u.responseReceiveLatency=n),s&&(u.requestIPCTime=s-r.date),l&&(u.responseIPCTime=c.date-l),u}static markSubscriptionRequest(e){const t=`subscription_request_start_${e}`,n=`subscription_request_${e}`;performance.mark(t),uu(performance,n,t)}static addSubscriptionResponse(e,t,n,i,a,o,r){du.getInstance().addToTimeline(e,t,n,i,o,a,r)}getPerformanceName(){return`cdl-${this.isResponse?"response":"request"}-${this.operationName||this.operationType}`}}const pu=["callParticipantsVoiceLevelsChangedEvent","callParticipantsChangedEvent"],gu=["callingIntent","chat","messageList"],hu=["putConversations"],yu="debug";class vu{constructor(e,t,n,i,a,o,r,s,l,c,d,u=[],m,p,g,h,y,v,f){if(this.variables=n,this._logger=o,this.loggerFactory=r,this.scenarioFactory=s,this.syncEngineInitializationPromise=l,this.rendererId=c,this.requestHealthMonitor=m,this.enableClassBasedErrors=p,this.cdlOperationCustomContext=h,this.splitFetchWaitMarkerInWLT=y,this.dataLayerClientSettings=v,this.enableAllowErrorsInSubscriptions=f,this._perfStats=null,this._perfStatsForResponseProcessing=null,this._scenario=void 0,this._startTime=Date.now(),this._lastUpdateTime=null,this._requestId=e,this._windowId=d,this._requestType=t,"subscription"!==t?this._perfStats=new mu(t,!1,a):mu.markSubscriptionRequest(a),this._requestComplete=!1,this._operationName=a,this._loggingContext={requestId:e,component:"RequestHandler",requestRendererId:this.rendererId,requestWindowId:this.windowId,hostRendererId:i,operationType:t,operationName:a},u=u&&u.length?u:hu,this.subject=new $c(this._logger,this._loggingContext),this.logRequest(),a&&!u.includes(a)&&"subscription"!==t){this._scenario=this.scenarioFactory.newScenario(H.RG.CentralDataLayerRequest),this._scenario.clientName=a;const e=this.getActiveCPM();if(this._scenario.appendEventData({operationName:a,operationType:t,context:this.rendererId,"Panel.WindowID":this.windowId,target:g,correlationId:h?.callerScenarioId,origin:h?.callerInfo,activeCPM:e}),this.isRequestFromWindowLaunch(a,s)){s.startStep(H.RG.WindowLaunchTime,H.ck.FetchWait);const e=this.scenarioFactory.findScenario(H.RG.WindowLaunchTime);this._wltTimestampsAtInit=e?.timestamps.length}}this.requestHealthMonitor?.requestCreated(this),this.syncEngineInitializationPromise.then((e=>{if(!e.isSyncEngineInitialized)throw Error();this._scenario?.appendEventData({messagingSyncEngineStartupMode:e.bootType})})).catch((()=>{this._scenario?.appendEventData({messagingSyncEngineStartupMode:"Error"})}))}get requestId(){return this._requestId}get windowId(){return this._windowId}get response(){return this.subject.observable}get requestType(){return this._requestType}get operationName(){return this._operationName}isComplete(){return this._requestComplete}setResponseAndEndScenario(e,t,n){const i=!e.errors&&e.data;this._otherResponsesReceivedWhileInTransit=t,this._responseReceiveLatency=n,i?(this._perfStatsForResponseProcessing=new mu(this.requestType,!0,this.operationName),this.onSuccess(e)):this.onError(e),this.onComplete(i?"success":"error"),i&&e.extensions?.perfStats&&this._perfStatsForResponseProcessing?.stopMeasurement(e.extensions?.perfStats,t,n)}cancel(){this._requestComplete||(this._requestComplete=!0,this._scenario&&this._scenario.incomplete(),this.onComplete("cancelled"))}toLog(){return{requestId:this.requestId,requestType:this.requestType,operationName:this.operationName,isComplete:this.isComplete(),variables:(0,W.mapValues)(this.variables,((e,t)=>this.variableToLog(t,e))),customContext:this.cdlOperationCustomContext,startTime:this._startTime,lastUpdateTime:this._lastUpdateTime}}onComplete(e){this._requestComplete&&(this.subject.onComplete(),this.requestHealthMonitor?.requestCompleted(this,e))}onSuccess(e){this.mergeAndEndStatsSnapshot(e.extensions),this.logResponse(),this.subject.onNext(e)}onError(e){const t=e?.errors||"Unexpected: data layer query response missing both data and error",n=Array.isArray(t)?t.map((e=>(0,de.VK)(e))).join():(0,de.VK)(t);if(this.mergeAndEndStatsSnapshot(e.extensions,n),this.enableClassBasedErrors)this.subject.onNext(e);else{let t=e.errorCode;!t&&e.errors?.length&&(t=e.errors[0].name||h.jK.RemoteOperationFailed),t||(t=h.jK.InvalidResponse);const i=(0,de.Tr)(h.w5.DataLayerClient,t,"onError",void 0,n);this._logger.error(`error while processing ${this._requestId}: ${i.message} (reason: ${i.reason})`,this._loggingContext,t),this.subject.onError(i)}}mergeAndEndStatsSnapshot(e,t){let n;e&&e.perfStats&&(this._perfStats&&(n=this._perfStats.stopMeasurement(e.perfStats,this._otherResponsesReceivedWhileInTransit,this._responseReceiveLatency)),"subscription"===this.requestType&&(this._lastUpdateTime=Date.now(),mu.addSubscriptionResponse(this.operationName,e.perfStats.responseSendTime,this.loggerFactory,this.scenarioFactory,e.subscriptionCustomIdentifier,this.dataLayerClientSettings?.cdlSubscriptionAggregatorAllowList,this.dataLayerClientSettings?.cdlSubscriptionAggregatorLogIntervalMS))),e&&this._scenario?.appendEventData({dataSource:e.dataSource,size:e.perfStats?.payloadLength}),this._scenario&&(t?this.syncEngineInitializationPromise.then((e=>{this._scenario?.appendEventData({...n,errors:(0,ce.A)(t)}),e.isSyncEngineInitialized?this._scenario?.fail():this._scenario?.incomplete()})):(this._scenario.stop(n),this.isRequestFromWindowLaunch(this.operationName,this.scenarioFactory)&&this.createWltSteps(n)))}logResponse(){this._logger[this.getLogLevel()]("Received response data for request",this._loggingContext)}createWltSteps(e){const t=this.scenarioFactory.findScenario(H.RG.WindowLaunchTime);if(t&&t.currentStep!==H.ck.FetchProcessResponse){if(e){const{requestIPCTime:n,responseIPCTime:i,workerResponseTime:a}=e;if(n&&i&&this.splitFetchWaitMarkerInWLT){if(this._wltTimestampsAtInit&&t.timestamps.length>this._wltTimestampsAtInit)return;t.mark(H.ck.FetchWaitRequestIPC,{offsetCurrentTimeInMs:Math.round(a)+i}),t.mark(H.ck.FetchWaitWorker,{offsetCurrentTimeInMs:i}),t.mark(H.ck.FetchWaitResponseIPC)}else t.mark(H.ck.FetchWaitIPC,{offsetCurrentTimeInMs:Math.round(a)}),t.mark(H.ck.FetchWaitWorker)}t.startStep(H.ck.FetchProcessResponse)}}isRequestFromWindowLaunch(e,t){return!!t.findScenario(H.RG.WindowLaunchTime)&&gu.indexOf(e)>-1}logRequest(){this._logger[yu]("Created new request",this._loggingContext)}getLogLevel(){return pu.indexOf(this._loggingContext.operationName??"")>=0?yu:"log"}getActiveCPM(){const e=[H.RG.ChatSwitch,H.RG.SimpleCollabSwitch,H.RG.ChannelSwitchL1,H.RG.ChannelSwitchL2,H.RG.ChannelL1Deeplink,H.RG.ChannelL2Deeplink,H.RG.ActivitySwitch,H.RG.ApplicationLaunchTime,H.RG.WindowLaunchTime];if(this.scenarioFactory.doesScenariosExist){const t=this.scenarioFactory.doesScenariosExist(e);if(t.length)return t.join(",")}}variableToLog(e,t){return this.dataLayerClientSettings?.loggableOperationVariablesAllowList?.includes(e)||(0,W.isBoolean)(t)||(0,W.isNumber)(t)||(0,W.isNil)(t)?t:"N/A"}}class fu extends vu{onSuccess(e){super.onSuccess(e),this._requestComplete=!0}onError(e){this._requestComplete=!0,super.onError(e)}}class Su extends vu{onSuccess(e){super.onSuccess(e),this._requestComplete=!0}onError(e){this._requestComplete=!0,super.onError(e)}}class ku extends vu{onSuccess(e){super.onSuccess(e)}onError(e){this.enableClassBasedErrors&&this.enableAllowErrorsInSubscriptions&&"data"in e||(this._logger.warn(`Stopping subscription with request-id '${this._requestId}' due to an error while processing.`,this._loggingContext),this._requestComplete=!0),super.onError(e)}}class Cu{static createDataLayerRequest(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,y,v){const f=[e,t,n,i,a,o,r,s,l,c,d,void 0,u,m,p,g,h,y,v];switch(t){case"mutation":return new fu(...f);case"query":return new Su(...f);case"subscription":return new ku(...f)}}}var bu=n(482169);class wu{constructor(e,t,n,i,a){this.config=t,this.timeoutProvider=n,this.syncEngineInitializationPromise=i,this.dataLayerTarget=a,this.isRequestInProcess=!1,this.requestTimer=null,this.openRequests=new Map,this.timedOutDistinctRequestCount=0,this.failedDistinctRequestCount=0,this.timedOutOperationNames=new Set,this.failedOperationNames=new Set,this.lastSucceededRequest=this.firstTimedOutRequest=wu.DefaultRequestLoggingData,this.logger=e.newLogger("RequestHealthMonitor","core-cdl-data-layer-client")}requestCreated(e){if(!this.shouldMonitor(e))return;let t;null!==this.requestTimer||this.isRequestInProcess?t=!1:(this.startTimer(),t=!0),this.openRequests.set(e.requestId,{operationName:e.operationName,shouldTimeout:t,timeAdded:Date.now()})}requestCompleted(e,t){if(!this.shouldMonitor(e))return;this.openRequests.delete(e.requestId)||this.logger.warn(`Unknown request completed. Possibly timed out. RequestId ${e.requestId}, OperationName ${e.operationName}, Target ${this.dataLayerTarget}.`),0===this.openRequests.size&&null!==this.requestTimer&&this.clearTimer(),"success"===t&&this.onSuccess(e),"error"===t&&this.onError(e)}onSuccess(e){this.lastSucceededRequest={requestId:e.requestId,operationName:e.operationName},this.timedOutDistinctRequestCount=0,this.failedDistinctRequestCount=0,this.timedOutOperationNames.clear(),this.failedOperationNames.clear(),this.firstTimedOutRequest=wu.DefaultRequestLoggingData}onError(e){this.failedOperationNames.has(e.operationName)||(this.failedDistinctRequestCount++,this.failedOperationNames.add(e.operationName),this.failedDistinctRequestCount===this.failureCountThreshold&&this.indicateTargetUnhealthy("error"))}onTimeout(){let e=wu.DefaultRequestLoggingData,t=Number.MAX_SAFE_INTEGER;this.openRequests.forEach(((n,i)=>{if(n.shouldTimeout){const a=n.operationName;n.timeAdded<t&&(t=n.timeAdded,e={operationName:a,requestId:i}),this.logger.warn(`Request reached time out in health monitor. RequestId ${i}, OperationName ${a}, Target ${this.dataLayerTarget}.`),this.openRequests.delete(i),this.timedOutOperationNames.has(a)||(this.timedOutDistinctRequestCount++,this.timedOutOperationNames.add(a),this.timedOutDistinctRequestCount===this.timedOutCountThreshold&&this.indicateTargetUnhealthy("timedOut"))}else n.shouldTimeout=!0})),this.firstTimedOutRequest===wu.DefaultRequestLoggingData&&(this.firstTimedOutRequest=e),this.requestTimer=null,this.isRequestInProcess=!1,this.openRequests.size>0&&this.startTimer()}startTimer(){null!==this.requestTimer&&(this.logger.warn(`Health monitor timer already running when attempting to start new. Clearing old timer. Target ${this.dataLayerTarget}.`),this.timeoutProvider.clearTimeout(this.requestTimer)),this.isRequestInProcess=!0,this.syncEngineInitializationPromise.then((e=>{e.isSyncEngineInitialized&&(this.requestTimer=this.timeoutProvider.setTimeout((()=>this.onTimeout()),this.timeOutLengthMs))}))}clearTimer(){null!==this.requestTimer?(this.timeoutProvider.clearTimeout(this.requestTimer),this.requestTimer=null,this.isRequestInProcess=!1):this.logger.warn(`Health monitor timer tried to cancel non-existent timer. Ignoring. Target ${this.dataLayerTarget}.`)}indicateTargetUnhealthy(e){let t="error"===e?`ErrorCount: ${this.failureCountThreshold}.`:`TimedOutCount: ${this.timedOutCountThreshold}. TimeOutMs: ${this.timeOutLengthMs}.`;this.config.memoryMapType&&(t=`${t} MemoryMapType: ${this.config.memoryMapType}.`);const n=`Last succeeded operation: ${this.lastSucceededRequest.operationName}, ${this.lastSucceededRequest.requestId}.`,i=`First timeout operation: ${this.firstTimedOutRequest.operationName}, ${this.firstTimedOutRequest.requestId}`,a=`RequestHealthMonitor: DataLayer is unhealthy due to successive requests failing with ${e}. Target: ${this.dataLayerTarget}. ${t} ${n} ${i}`;this.logger.errorToTelemetry?.(a,"cdl_data_layer_client_request_health_monitor_unhealthy_target",void 0,!0),this.config.unhealthyDataLayerCallback?.(a)}shouldMonitor(e){return"subscription"!==e.requestType}get failureCountThreshold(){return this.config.failureCountThreshold||wu.DefaultFailureCountThreshold}get timeOutLengthMs(){return(this.config.timeoutLengthSeconds||wu.DefaultTimeoutLengthSeconds)*z.NO}get timedOutCountThreshold(){return this.config.timeoutCountThreshold||wu.DefaultTimeoutCountThreshold}}wu.DefaultFailureCountThreshold=5,wu.DefaultTimeoutCountThreshold=5,wu.DefaultTimeoutLengthSeconds=60,wu.DefaultRequestLoggingData={operationName:"na",requestId:"na"};class Tu{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p){this.logger=e,this.scenarioFactory=n,this.syncEngineInitializationPromise=a,this.leakDetectorService=o,this.dataLayerCommunicatorTarget=r,this.timeoutProvider=s,this.enableClassBasedErrors=c,this.trackingOperationsDuringWaitConfig=d,this.dataClientTrackingService=u,this.dataLayerClientSettings=m,this.enableAllowErrorsInSubscriptions=p,this.requestMap=new Map,this.recentlyCancelledRequests=new Map,this.loggingContext={hostRendererId:t,component:"RequestRegistrar"},this.leakDetector=this.leakDetectorService?.create(),l&&l.enableRequestHealthMonitor&&s&&(this.requestHealthMonitor=new wu(i,l,s,this.syncEngineInitializationPromise,r))}createRequest(e,t,n,i,a,o,r,s,l){const c=Cu.createDataLayerRequest(e,t,i,this.loggingContext.hostRendererId,n,this.logger,a,this.scenarioFactory,this.syncEngineInitializationPromise,o,r,this.requestHealthMonitor,this.enableClassBasedErrors,this.dataLayerCommunicatorTarget,s,l,this.dataLayerClientSettings,this.enableAllowErrorsInSubscriptions);return this.leakDetector?.track(`Request-${c.requestType}-${n}`,c),this.requestMap.set(e,c),bu.Q.Instance.processRequest(t,n,e),c}reconcileResponse(e,t){const n=this.requestMap.get(e),i=t.data?t.data&&Object.keys(t.data).toString():"";if(this.recentlyCancelledRequests.has(e))return void this.logger.log(`Received response to a requestId that was recently cancelled. RequestId: ${e}. OperationNameHints: ${i}.`,this.loggingContext);if(!n)return void this.logger.warn(`Received response to a requestId that cannot be found in the map. RequestId: ${e}. operationName ${i}. CallId: ${t.requestId}, WindowId: ${t.windowId}, Target ${this.dataLayerCommunicatorTarget}`,this.loggingContext);const a=t.extensions&&t.extensions.perfStats;let o,r;if(a||this.logger.warn(`Received response without perfStats for request. RequestId: ${e} RendererId: ${t.rendererId}, WindowId: ${t.windowId}, Target ${this.dataLayerCommunicatorTarget}`,this.loggingContext),this.trackingOperationsDuringWaitConfig?.enableTrackingCdlOperationsDuringWait&&a&&a.responseSendTime){this.markResponse(n);const e=a.responseSendTime,t=Date.now();if(r=t-e,r>(this.trackingOperationsDuringWaitConfig?.trackingCdlOperationsDuringWaitThresholdInMs||100)){o=this.getResponsesBetweenStartAndLast(e);const i=o?.reduce(((e,t)=>{const n=e.find((e=>e?.name===t));return n?n.count++:e.push({name:t,count:1}),e}),[]);this.trackingOperationsDuringWaitConfig?.enableLoggingCdlOperationsDuringWait&&this.logger.log(`${n?.operationName}, sendtime: ${e}, receivetime: ${t}, latency: ${t-e}, responses received between send and receive: ${JSON.stringify(i)}`,this.loggingContext)}}const s=a;n.setResponseAndEndScenario(t,o,r),n.isComplete()&&(this.requestMap.delete(e),bu.Q.Instance.processResponse(e,s&&s.workerResponseTime))}cancelRequest({requestId:e,rendererId:t,windowId:n}){const i=this.requestMap.get(e);i?(i.cancel(),this.requestMap.delete(e),this.recentlyCancelledRequests.set(e,(new Date).getTime()),this.scheduleCancelledRequestsMapCleanup()):this.logger.debug(`Nothing to cancel, request no longer in map. RequestId: ${e} RendererId: ${t}, WindowId: ${n}, Target ${this.dataLayerCommunicatorTarget}`,this.loggingContext)}getLogs(){return JSON.stringify((0,W.map)(Array.from(this.requestMap.values()),(e=>e.toLog())),null,2)}scheduleCancelledRequestsMapCleanup(){if(!this.recentlyCancelledRequestsTimer){const e=2,t=(new Date).getTime();this.recentlyCancelledRequestsTimer=this.timeoutProvider?.setTimeout((()=>this.cleanRecentlyCancelledRequestsMap(t)),e*z.A_)}}cleanRecentlyCancelledRequestsMap(e){this.recentlyCancelledRequests.forEach(((t,n)=>{t<e&&this.recentlyCancelledRequests.delete(n)})),this.recentlyCancelledRequestsTimer=void 0}markResponse(e){this.dataClientTrackingService?.markResponse(e.operationName)}getResponsesBetweenStartAndLast(e){const t=this.dataClientTrackingService?.getResponsesBetweenStartAndLast(e);return t||[]}}var Iu,Nu=n(109458),Eu=n(696758);class Au{constructor(e,t,n,i,a,o,r,s,l=!1,c=Promise.resolve({isSyncEngineInitialized:!0}),d,u,m,p,g){this.hostRendererId=e,this.loggerFactory=t,this.scenarioFactory=n,this.dataLayerCommunicator=i,this.leakDetectorService=a,this.splitFetchWaitMarkerInWLT=m,this.loggingContext={component:"DataLayerClient",hostRendererId:e},this.logger=new Fc(t.newLogger("CDL","core-cdl-data-layer-client")),this.logger.log("logger created for renderer",this.loggingContext),this.dataLayerCommunicator.onMessage=this.onMessageReceived.bind(this),this.requestRegistrar=new Tu(this.logger,e,this.scenarioFactory,this.loggerFactory,c,this.leakDetectorService,o,r,s,l,d,u,p,g),this.requestId=new Jc("graphql")}execute(e,t,n,i,a,o){const r=(0,Nu.S)(e,n),s=r&&r.operation||"query";return this.executeWithQueryText(s,(0,Eu.S)(e),t,n,i,a,o)}executeWithQueryText(e,t,n,i,a,o,r){const s=this.requestId.next(e),l=this.requestRegistrar.createRequest(s,e,i||e,n,this.loggerFactory,a,o,r,this.splitFetchWaitMarkerInWLT);this.logger.log("executing graphql request to data layer",{requestId:l.requestId,...this.loggingContext,operationType:e,operationName:i,hostRendererId:this.hostRendererId,requestRendererId:a,requestWindowId:o}),this.dataLayerCommunicator.sendMessage({requestId:s,windowId:o,rendererId:this.hostRendererId,request:{graphqlQuery:t,variables:n},cdlOperationCustomContext:r,operationName:i});return function(e,t){const n=e.subscribe;return e.subscribe=i=>{const a=n.call(e,i),o=a.unsubscribe;return a.unsubscribe=()=>(t(),o.call(a)),a},e}(l.response,this.onUnsubscribe(l,i))}getRequestLogs(){return this.requestRegistrar.getLogs()}onUnsubscribe(e,t){return()=>{e.isComplete()||(this.logger.log("Notifying server of unsubscription",{...this.loggingContext,requestId:e.requestId,requestType:Yc,operationName:t}),this.dataLayerCommunicator.sendMessage({requestId:e.requestId,rendererId:this.hostRendererId,windowId:e.windowId,request:{graphqlQuery:Yc,variables:void 0},operationName:t}),this.requestRegistrar.cancelRequest({requestId:e.requestId,rendererId:this.hostRendererId,windowId:e.windowId}))}}onMessageReceived(e){this.requestRegistrar.reconcileResponse(e.requestId,e)}}class _u{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,y,v,f,S,k,C,w,T){this.host=e,this.config=t,this.loggerFactory=i,this.scenarioFactory=a,this.coreSettings=o,this.cdlWorkerRegistrarService=f,this.workerId=S,this.dataClientTrackingService=k,this.telemetryService=C,this.shouldUsePreInitCoreWorker=T,this.isDisposed=!1,this.hasWorkerFailedStartup=!1,this.logger=i.newLogger("DataClientCoreCDLWorkerService","core-services-cdl-worker"),this.cdlWorkerHostSettingsAggregator=new cu(n,o,r,i,c,m,p,g,h),this.cdlWorkerManagerInitializationPromise=Kd(e,t,this.cdlWorkerHostSettingsAggregator,i,a,o,s,l,c,this.logger,y,v,f,S,p,w,C,this.shouldUsePreInitCoreWorker);if(Yd(c,o,a,e,this.logger)){this.cdlWorkerStateSender=new au(d,u,i,this);const{disableCDLWorkerHostSettingsUpdates:e}=o.get(b.J.Core);e||this.startNotifyingCDLWorkerForHostSettingsChanges()}}async triggerWorkerStartupFailure(e,t){if(this.cdlWorkerRegistrarService.mainWindowWorkerId!==this.workerId)return void this.logger.log("Not triggering failure - this worker is not the main window worker.");if(this.hasWorkerFailedStartup)return void this.logger.warn("Not triggering failure - CDL Worker has already failed startup.");if(!this.coreSettings.get(b.J.Core).isCDLWorkerCriticalToStartup)return void this.logger.log("Not triggering failure - CDL Worker is not critical to startup.");const n=this.coreSettings.get(b.J.CdlWorker).oopsPageOnWorkerStartupFailures;if("sync-engine-failure"!==e&&"sync-engine-expected-failure"!==e||n?.syncEngine){switch(this.logger.errorToTelemetry?.(`Triggering CDL Worker startup failure due to ${e}`,"cdl_worker_startup_error",void 0,!0),e){case"sync-engine-failure":t.execute({command:Nt.CN.showOopsPage({error:new Me.G(Me.$.CDL_WORKER_FAILURE)})}),this.telemetryService?.setCoreContext("AppInfo.CDLState","Failed");break;case"sync-engine-expected-failure":t.execute({command:Nt.CN.showOopsPage({error:new Me.G(Me.$.CDL_WORKER_FAILURE)})}),this.telemetryService?.setCoreContext("AppInfo.CDLState","ExpectedFailure")}this.hasWorkerFailedStartup=!0}else this.logger.log(`Not triggering failure - oops page on worker startup failure not enabled for ${e}.`)}getCDLWorkerManager(){return this.cdlWorkerManagerInitializationPromise}async getDataLayerClient(){if(!this.dataLayerClient){const e=await this.getCDLWorkerManagerOrThrow("getDataLayerClient"),t=this.coreSettings.get(b.J.CdlWorker),{logCdlOperationsDuringWaitSettings:n}=this.coreSettings.get(b.J.Core);this.dataLayerClient=new Au(this.config.clientId,this.loggerFactory,this.scenarioFactory,e.workerClientResponseRouter.cdlGraphQLClient,void 0,"Worker",this.host,{enableRequestHealthMonitor:!!t.enableRequestHealthMonitor,failureCountThreshold:t.requestHealthMonitorFailureCountThreshold,timeoutCountThreshold:t.requestHealthMonitorTimeoutCountThreshold,timeoutLengthSeconds:t.requestHealthMonitorTimeoutLengthSeconds,memoryMapType:(0,tu.qo)(this.coreSettings)},!!t.enableClassBasedErrors,e.syncEngineInitializationPromise,{enableLoggingCdlOperationsDuringWait:n?.enableLoggingCdlOperationsDuringWait,enableTrackingCdlOperationsDuringWait:n?.enableTrackingCdlOperationsDuringWait,trackingCdlOperationsDuringWaitThresholdInMs:n?.trackingCdlOperationsDuringWaitThresholdInMs},this.dataClientTrackingService,!!t.splitFetchWaitMarkerInWLT,{cdlSubscriptionAggregatorAllowList:t.cdlSubscriptionAggregatorAllowList||void 0,loggableOperationVariablesAllowList:t.loggableOperationVariablesAllowList||void 0,cdlSubscriptionAggregatorLogIntervalMS:t.cdlSubscriptionAggregatorLogIntervalMS||void 0},!!t.enableAllowErrorsInSubscriptions)}return this.dataLayerClient}async getControlPlaneCommunicator(){if(!this.controlPlaneCommunicator){const e=await this.getCDLWorkerManagerOrThrow("getControlPlaneCommunicator");this.controlPlaneCommunicator=new ou(e.workerClientResponseRouter,{loggerFactory:this.loggerFactory})}return this.controlPlaneCommunicator}dispose(){this.cdlWorkerStateSender&&this.cdlWorkerStateSender.dispose(),this.cdlWorkerHostSettingsAggregator.cleanup(),this.isDisposed=!0}async logoutCurrentUser(e){const t=e.get(b.J.CdlWorker).maxLogoutTime||5e3;if(this.isDisposed)return void this.logger.warnToTelemetry?.("Unable to cleanup CDL Worker: Already disposed.","cdl_services_worker_worker_service_logout_current_user_error",void 0,!0);const n=await this.getCDLWorkerManager();if(n)try{await(0,V.E)(n.workerClientResponseRouter.cdlSyncEngineClient.sendRequest({type:"logout",subType:"",params:void 0}),t,`logout request to CDL worker timed out after ${t} ms`)}catch(e){const t=(0,ce.A)((0,de.VK)(e));this.logger.errorToTelemetry?.(`Failed to cleanup CDL Worker on logout. ${e&&e.code===h.jK.TimedOut?e.message:""}`,"cdl_services_worker_worker_service_logout_current_user_error",{reason:t},!0)}else this.logger.warnToTelemetry?.("Unable to cleanup CDL Worker: Worker manager not available.","cdl_services_worker_worker_service_logout_current_user_error",void 0,!0)}async getDebugService(){if(!this.debugService){const{DataClientCoreCDLWorkerDebugService:e}=await n.e(583194).then(n.bind(n,640427));this.debugService=new e(this.loggerFactory,this)}return this.debugService}getDataLayerRequestLogs(){if(!this.dataLayerClient)return"Data layer client unavailable.";if(this.coreSettings.get(b.J.CdlWorker).disableOperationsInLogFiles)return"Data layer request logs disabled by setting 'disableOperationsInLogFiles'.";try{const e=this.dataLayerClient.getRequestLogs?.();return e||"Data layer client has not implemented request logs."}catch(e){return`Data layer client failed to get logs: ${(0,de.VK)(e)}.`}}async startNotifyingCDLWorkerForHostSettingsChanges(){let e;try{e=await this.getCDLWorkerManager()}catch(e){return void this.logger.errorToTelemetry?.(`Unable to start notifying CDL Worker for host settings changes: getCDLWorkerManager failed: ${e.message}.`,"cdl_services_worker_worker_service_notify_worker_host_settings_changes_error",void 0,!0)}e?(this.cdlWorkerHostSettingsAggregator.startNotifyingCDLWorkerForHostSettingsChanges(e.workerClientResponseRouter.cdlControlClient),this.logger.log("Start notifying CDL Worker for host settings changes.")):this.logger.log("Unable to start notifying CDL Worker for host settings changes: Worker manager not available.")}async getCDLWorkerManagerOrThrow(e){const t=await this.getCDLWorkerManager();if(!t)throw(0,de.Tr)(_u.ComponentName,h.jK.NotInitialized,e,void 0,"Worker manager is not initialized");return t}}_u.ComponentName="DataClientCoreCDLWorkerService",function(e){e.NoLog="no_logs",e.Activities="activities_logs",e.AllConversations="all_conversations_logs",e.AppsPlatform="apps_platform_logs",e.Calendar="calendar_logs",e.ChannelInfoPane="channel-info-pane",e.ChatInfoPane="chat-info-pane",e.ConversationFolder="conversation-folder",e.Diagnostics="diagnostics_logs",e.Files="files_logs",e.Messaging="messaging_logs",e.People="people_logs",e.Presence="presence_logs",e.MTMAAggregator="mtma_aggregator",e.UserPreferences="user_preferences_logs",e.TeamsAndChannels="teams_and_channels_logs",e.MeetForWork="meet_for_work_logs",e.Discover="discover_logs"}(Iu||(Iu={}));class Fu{constructor(e,t,n,i,a){this.cdlWorkerManager=e,this.logger=t,this.authenticationService=n,this.getDataLayerRequestLogs=i,this.cacheStorage=a,this.workerGetLogsTimeoutMs=18e3,this.logsProviderName="CdlWorkerLogsProvider"}async getLogsFiles(e){let t;const n=this.getWorkerDiagnosticsLogsFromCdlWorkerManager(),i=this.getVerboseWorkerLogs(this.cdlWorkerManager.workerType),a=await this.authenticationService.getUser();if(a&&a.isAuthenticated)t=this.getSyncEngineLogsFromCdlWorkerManager();else{const e="Sync logs cannot be retrieved for unauthenticated users.";t=Promise.resolve([{isPiiFree:!0,fileName:"sync-failure-logs.txt",content:e}]),this.logger.warn(e)}const[o,r,s]=await Promise.all([this.timeoutSafeGetLogsFiles(n,{diagnosticsEvents:void 0,coreSettingsSnapshot:""},"workerDiagnostics"),this.timeoutSafeGetLogsFiles(i,[],"workerVerboseDiagnostics"),this.timeoutSafeGetLogsFiles(t,[],"workerSyncDiagnostics")]);return[{isPiiFree:!o.diagnosticsEvents||!!e,fileName:"cdl-worker-diagnostics-logs.txt",content:o.diagnosticsEvents?(0,x.Mf)(e?o.diagnosticsEvents.filter((e=>e.isPiiFree)):o.diagnosticsEvents):"No logs found"},{isPiiFree:!0,fileName:"cdl-worker-settings.json",content:o.coreSettingsSnapshot},{isPiiFree:!1,fileName:"cdl-worker-requests.txt",content:this.getDataLayerRequestLogs()},...s,...r]}subscribeToCoreSettings(e){if(!e)return void this.logger.error("Failed to subscribe to core settings");e.getObservable(b.J.Diagnostics,["workerGetLogsTimeoutMs"]).subscribe((({workerGetLogsTimeoutMs:e})=>{e&&(this.workerGetLogsTimeoutMs=e)}))}async getVerboseWorkerLogs(e){if(this.cacheStorage){const t=new Jd(this.cacheStorage,this.logger),n=await t.getWorkerVerboseLog(e);if(""!==n)return Promise.resolve([{isPiiFree:!1,fileName:"verbose-worker-logs.txt",content:n}])}return Promise.resolve([])}async getWorkerDiagnosticsLogsFromCdlWorkerManager(){const e=this.cdlWorkerManager.workerClientResponseRouter.cdlDiagnosticsClient;try{const t=await e.sendRequest("get_logs");if(t?.response?.data)return t.response.data;this.logger.warn("Diagnostic event list empty or ill-formed")}catch(e){const t=await this.getSyncEngineInitResultFromCdlWorkerManager(),n=`Unable to retrieve worker diagnostics logs. ${(0,de.VK)(e)}.`,i=`syncEnginePromiseResult: ${t}`;return this.logger.errorToTelemetry?.(`${n}::${i}`,"cdl_worker_diagnostics_logs_error",{errorMessage:n,errors:i},!0),{diagnosticsEvents:[{message:n,level:_.i.Error,isPiiFree:!0,levelName:"error",timeStamp:new Date},{message:i,level:_.i.Error,isPiiFree:!0,levelName:"error",timeStamp:new Date}],coreSettingsSnapshot:""}}return{diagnosticsEvents:void 0,coreSettingsSnapshot:""}}async getSyncEngineInitResultFromCdlWorkerManager(){try{const e=await this.cdlWorkerManager.syncEngineInitializationPromise;return JSON.stringify(e)}catch(e){return(0,de.VK)(e)}}async getSyncEngineLogsFromCdlWorkerManager(){const e=[];for(const t of(0,W.values)(Iu))t!==Iu.NoLog&&t!==Iu.Diagnostics&&e.push(this.getSyncEngineLogsForTypeFromCdlWorkerManager(t));return Promise.all(e)}async getSyncEngineLogsForTypeFromCdlWorkerManager(e){const t=this.cdlWorkerManager.workerClientResponseRouter.cdlSyncEngineClient;let n;try{const i=await t.sendRequest({type:"get_logs",subType:e,params:{conversationId:void 0}});i?.response?n=i.response:(this.logger.warn(`Sync engine logs empty. LogType: ${e}`),n="No logs available.")}catch(e){const t=`Unable to retrieve sync diagnostics logs. ${(0,de.VK)(e)}`;this.logger.error(t),n=t}return{isPiiFree:!1,fileName:`sync-${this.syncEngineLogTypeToFileName(e)}-logs.txt`,content:n}}syncEngineLogTypeToFileName(e){switch(e){case Iu.Messaging:return"messaging";case Iu.AllConversations:return"all_conversations";case Iu.People:return"people";case Iu.Presence:return"presence";case Iu.Calendar:return"calendar";case Iu.AppsPlatform:return"apps-platform";case Iu.Activities:return"activities";case Iu.ChannelInfoPane:return"channel-info-pane";case Iu.ChatInfoPane:return"chat-info-pane";case Iu.ConversationFolder:return"conversation-folder";case Iu.MTMAAggregator:return"mtma-aggregator";case Iu.UserPreferences:return"user-preferences";case Iu.TeamsAndChannels:return"teams-and-channels";case Iu.Files:return"files";case Iu.MeetForWork:return"meet-for-work";case Iu.Discover:return"discover"}}async timeoutSafeGetLogsFiles(e,t,n){try{return await(0,V.E)(e,this.workerGetLogsTimeoutMs)}catch(e){let t=`Failed fetching logs files from CDL Worker Logs Provider - ${n}`;(0,V.T)(e)&&(t=`Timed out fetching logs files from CDL Worker Logs Provider - ${n}`),this.logger.errorToTelemetry?.(t,"cdl_get_logs_error")}return t}}async function Du(e,t=!1){const n=await(e.i18NextWrapper?.osLocale),i=new _u(e.windowProvider,e.config,e.configLoader,e.loggerFactory,e.scenarioFactory,e.coreSettings,e.coreSettingsContext,e.authenticationService,e.discover,e.platformService,e.clientState,e.hostState,e.primaryUser,e.i18NextWrapper?.locale,n,e.i18NextWrapper?.osLocaleInfo,e.offlineCacheManager,e.authStateProvider,e.cdlWorkerRegistrarService,e.workerId,e.dataClientTrackingService,e.telemetryService,e.altScenarioService?.altScenario,t);return function(e,t){const n=e?.altScenario;n&&n.appendEventData({dataStoreName:(0,tu.qo)(t)})}(e.altScenarioService,e.coreSettings),i.getCDLWorkerManager().then((t=>{if(t){const{authenticationService:n,authenticationUser:a,cacheStorage:o,cdlWorkerRegistrarService:r,loggerFactory:s,logsCollectorService:l,workerId:c}=e,d=new Fu(t,s.newLogger("CdlWorkerLogsProvider","core-services-tasks"),n,(()=>i.getDataLayerRequestLogs()),o);d.subscribeToCoreSettings(e.coreSettings);const u=a&&(0,xe.b4)(a);l.registerUserLogsProvider(u||"",d),r.registerWorker(c),function(e,t){const{enableNetworkStateCommsBetweenCoreAndWorker:n}=e.coreSettings.get(b.J.Core);if(n){const n=n=>{const i={networkState:e.networkState.getState(),baselineNetworkStateOverride:n};t.workerClientResponseRouter.cdlNetworkStateClient.sendRequest(i)},i=e.authenticationUser&&(0,xe.b4)(e.authenticationUser)||"",a=e.networkState.createNetworkStateTracker?.(i,`CDL Worker [${i}]`,n);a&&t.state.setState("networkState:Loaded",a);return function(e,t){return()=>{e.unsubscribe(),t.dispose()}}(e.networkState.observe().subscribe((e=>{const n={networkState:e};t.workerClientResponseRouter.cdlNetworkStateClient.sendRequest(n)})),a)}}(e,t),function(e,t){const{enableEndpointsHealthCommsBetweenCoreAndWorker:n}=e.coreSettings.get(b.J.Core);if(n){const n=e.endpointsHealthService;if(n?.getEndpointsHealthUpdateHandler){const e=n.getEndpointsHealthUpdateHandler();t.state.setState("endpointsHealthUpdateHandler:Loaded",e),e.onStateDumpRequest((()=>{const e="get_health_state";t.workerClientResponseRouter.cdlEndpointsHealthClient.sendRequest(e)}))}}}(e,t),function(e){(0,ii.Yf)().setCdlContextCallback(((t,n,i)=>{e.workerClientResponseRouter.telemetryClient.sendRequest({requestOperationtype:"setContext",context:{[t]:n},userContextId:i})}))}(t)}})),await(0,Il._)(1),i}async function Pu(e,t){const n=await Mu(e);return!!n&&!!t&&n.id===t.id}async function Mu(e){const t=await(e?.getCachedUsers?.({...je({source:C.D.Core}),scenarioName:H.RG.AuthWebCachedUser},{isPrimaryUser:!0})),n=t?.[0];if(n)return(0,xe.KQ)(n)}class xu extends _e{constructor(){super(h.Yg.CreateCDLWorkerOnAuthUserTask,["altScenarioService","authenticationService","clientState","config","configLoader","coreSettings","coreSettingsContext","diagnosticsService","discover","endpointsHealthService","hostState","i18NextWrapper","loggerFactory","logsCollectorService","networkState","platformService","scenarioFactory","windowProvider","telemetryService"])}async execute(e){const{altScenarioService:t,authenticationService:n,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,diagnosticsService:l,discover:c,endpointsHealthService:d,hostState:u,i18NextWrapper:m,loggerFactory:p,logsCollectorService:g,networkState:h,platformService:y,scenarioFactory:v,windowProvider:f,telemetryService:S}=e,{authenticationUser:k,authStateProvider:C,cacheStorage:w,cdlWorkerRegistrarService:T,dataClientTrackingService:I,offlineCacheManager:N}=e,E=p.newLogger("CreateCDLWorkerOnAuthUserTask","core-services-tasks"),A=(0,tu.Q6)(r),{enableMTMA:_,disableExperience:F}=r.get(b.J.Core),{crossCloudMeetingEnabled:D}=r.get(b.J.HostCapabilities),P=F&&k?.role!==ys.w4.Anonymous,M=F&&!1===D&&k?.role===ys.w4.Anonymous;if(!A||!_)return E.warn(`Not creating a worker as cdl worker or mtma is not enabled. isCdlWorkerEnabled: ${A}, isMTMAEnabled: ${_}`),Promise.resolve();if(!k||!T)return E.warn("Not creating a worker as authenticated user is not available or cdl worker registrar service is undefined."),Promise.resolve();if(P||M)return E.warn("Not creating a worker as experience is disabled for the user and it is not a CCM/CCA sign in."),Promise.resolve();const x=k.id;if(T.useInitTaskWorker)return E.log(`Not creating a new worker. Using worker created in init task for the user oid: ${k.profile.objectId},\n         tid: ${k.profile.tenantId}`),void(T.useInitTaskWorker=!1);let R;return E.log(`createCDLWorkerOnAuthUserTask for user id ${k.id}: start`),E.log(`Creating a worker with id: ${x} for the user oid: ${k.profile.objectId},\n       tid: ${k.profile.tenantId}`),_&&(R=await Mu(n)),e.cdlWorkerService=await Du({altScenarioService:t,authenticationService:n,authenticationUser:k,authStateProvider:C,cacheStorage:w,cdlWorkerRegistrarService:T,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,dataClientTrackingService:I,diagnosticsService:l,discover:c,endpointsHealthService:d,hostState:u,i18NextWrapper:m,loggerFactory:p,logsCollectorService:g,networkState:h,offlineCacheManager:N,platformService:y,primaryUser:R,scenarioFactory:v,windowProvider:f,workerId:x,telemetryService:S}),E.log(`createCDLWorkerOnAuthUserTask for user id ${k?.id}: done`),async e=>{"signout"===e&&(T.activeWorkers?.delete(x),E.log(`Deleting worker with id: ${x} from active workers on signout`))}}}class Ru extends _e{constructor(){super(h.Yg.CreateCDLWorkerOnInitTask,["altScenarioService","authenticationService","clientState","config","configLoader","coreSettings","coreSettingsContext","diagnosticsService","discover","endpointsHealthService","hostState","i18NextWrapper","loggerFactory","logsCollectorService","networkState","platformService","scenarioFactory","windowProvider","cdlWorkerRegistrarService","telemetryService"])}async execute(e){const{altScenarioService:t,authenticationService:n,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,diagnosticsService:l,discover:c,endpointsHealthService:d,hostState:u,i18NextWrapper:m,loggerFactory:p,logsCollectorService:g,networkState:h,platformService:y,scenarioFactory:v,windowProvider:f,cdlWorkerRegistrarService:S,telemetryService:k}=e,{authenticationUser:C,authStateProvider:w,cacheStorage:T,dataClientTrackingService:I,offlineCacheManager:N}=e,E=p.newLogger("CreateCDLWorkerOnInitTask","core-services-tasks");if(!(0,tu.Q6)(r))return void E.warn("Not creating a worker as CDL worker is not enabled");const A=f.loader?.getWorkerId()??(0,Re.v4)();let _;const{enableMTMA:F}=r.get(b.J.Core);if(F){if(!S)return void E.warn("Not creating a worker as cdlWorkerRegistrarService is undefined");E.log(`Creating a worker with id ${A} for auth user id ${C?.id}`),_=await Mu(n)}e.cdlWorkerService=await Du({altScenarioService:t,authenticationService:n,authenticationUser:C,authStateProvider:w,telemetryService:k,cacheStorage:T,cdlWorkerRegistrarService:S,clientState:i,config:a,configLoader:o,coreSettings:r,coreSettingsContext:s,dataClientTrackingService:I,diagnosticsService:l,discover:c,endpointsHealthService:d,hostState:u,i18NextWrapper:m,loggerFactory:p,logsCollectorService:g,networkState:h,offlineCacheManager:N,platformService:y,primaryUser:_,scenarioFactory:v,windowProvider:f,workerId:A},!0),E.log(`createCDLWorkerOnInitTask for user id ${C?.id}: done`)}}var ju,Lu=n(282050);class Ou{constructor({loggerFactory:e}){this.initTaskWorkerId="",this.mainWindowWorkerId=void 0,this.useInitTaskWorker=!0,this.activeWorkers=new Set,this.userRegisteredActiveWorkers=new Map,this.formatUserId=e=>e.replace(Lu.V.User,""),this.logger=e.newLogger("DataClientCoreCDLWorkerRegistrarService","core-services-cdl-worker")}setMainWindowWorkerByUserId(e){e=this.formatUserId(e),this.userRegisteredActiveWorkers.has(e)?this.mainWindowWorkerId=this.userRegisteredActiveWorkers.get(e):this.logger.errorToTelemetry?.(`No registered active worker for user id ${e}`,"cdl_registrar_service_no_registered_active_worker",void 0,!0)}isWorkerRegistered(e){return this.activeWorkers.has(e)}mapUserIdToRegisteredWorker(e,t){t=this.formatUserId(t),this.isWorkerRegistered(e)||(this.logger.warnToTelemetry?.(`${e} wasn't tracked yet was registered to active user. Tracking worker.`,"cdl_registrar_service_map_user_worker_not_registered",void 0,!0),this.registerWorker(e)),this.userRegisteredActiveWorkers.set(t,e)}registerWorker(e){this.isWorkerRegistered(e)?this.logger.errorToTelemetry?.(`${e} is already being tracked by cdl worker registrar service; skipping.`,"cdl_registrar_service_worker_already_registered",void 0,!0):(this.activeWorkers.add(e),this.initTaskWorkerId||(this.initTaskWorkerId=e,this.mainWindowWorkerId=e))}}class $u extends _e{constructor(){super(h.Yg.CreateCDLWorkerRegistrarServiceTask,["loggerFactory"])}async execute(e){const{loggerFactory:t}=e;return e.cdlWorkerRegistrarService=new Ou({loggerFactory:t}),Promise.resolve()}}!function(e){e.LifeCycleScopeChange="LifeCycleScopeChange"}(ju||(ju={}));class Uu extends _e{constructor(){super(h.Yg.CreateChangeReporting,[])}async execute(e){e.schedulerChangeReporting=new ro,e.experienceChangeReportingService=new ro,e.lifeCycleScopeChangeReportingService=new ro,e.commandResultChangeReportingService=new ro,e.commandChangeReportingService=new ro}}const Bu="local-user-preferences",Wu={theme:{userTheme:"light",followOsTheme:!0,isClassicTheme:!1,isCallingWindowDarkTheme:!1},animation:{disableAnimations:void 0},infoPane:{chatContextualSearch:"closed",channelcontextualsearch:"closed",chatHighlightsDetails:"closed",chatfluidthread:"closed",chatcopilotsynthesis:"closed"},sidePane:{sidePaneOpenState:[]},flyoutCamera:{cameraState:"notSet"},promo:{badgeActionComplete:!1,labelActionComplete:!1,teamsInsiderLabelActionComplete:!1,teamsInsiderBadgeActionComplete:!1,desktopLabelActionComplete:!1,desktopBadgeActionComplete:!1},density:{chatDensity:"comfy"},performance:{mode:"normal"},optimizedPerf:{optimizedPerfMode:"never",isSetByUser:!1},appSwitcher:{checkboxChecked:!1,multipleTabsCheckboxChecked:!1},videoEffect:{lastUsedVideoFilter:void 0,lastUsedBackgroundImage:void 0},backgroundEffect:{lastUsedBackgroundEffect:void 0},avatar:{lastUsedAvatarFilter:void 0,hasUsedInMeeting:!1},teamLayout:{currentLayout:void 0},diagnosticsLogs:{shouldPersistLogsIntoIDB:!1},windowing:{shouldOpenContentInNewWindow:!1},lockScreenInCall:{turnOffMediaOnDeviceLock:void 0},messagePreviews:{messagePreviewsSetting:"default"},composeSpellcheck:{disableDefaultSpellcheck:!1},peopleAppColumns:{persistentPeopleAppColumns:[]},simpleCollab:{hasUserEnabledSimpleCollabApp:!1},staticNowCards:{dismissedStaticNowCards:[]}},Hu={get:()=>null,set:()=>{}};class Vu{constructor(e,t=Hu){this.storage=t,this.subjectCache=new Map,this.logger=e.newLogger("ClientPreferencesService","services-io-browser-client-preferences"),this.clientPreferences=this.hydrateClientPreferences()}getPreferences(e){return this.clientPreferences[e]}getAllPreferences(){return this.clientPreferences}updatePreferences(e){const t=this.clientPreferences;this.clientPreferences=(0,W.mergeWith)({},this.clientPreferences,e,((e,t)=>void 0!==t?.sidePaneOpenState?{sidePaneOpenState:t.sidePaneOpenState}:void 0)),this.storage.set(Bu,JSON.stringify(this.clientPreferences)),this.subjectCache.forEach(((e,n)=>{(0,W.isEqual)(t[n],this.clientPreferences[n])||(this.logger.log(`Notifying subscribers of: '${n}', settings changed to: `,this.clientPreferences[n]),e.next(this.clientPreferences[n]))}))}getPreferenceObservable(e){return this.createOrGetSubjectFromCache(e).asObservable()}createOrGetSubjectFromCache(e){const t=this.subjectCache.get(e);if(t)return t;const n=this.getPreferences(e),i=new r.X(n);return this.subjectCache.set(e,i),this.logger.log(`Creating subject for '${e}' category, settings:`,n),i}hydrateClientPreferences(){try{const e=this.storage.get(Bu);if(!e)return this.logger.log("Client preferences were not found in local storage; returning defaults."),Wu;this.logger.log("Client preferences was found in local storage.");const t=JSON.parse(e);return(0,W.defaultsDeep)(t,Wu)}catch(e){return this.logger.error("Unable fetch client preferences from local storage. ",e),Wu}}}class Gu extends _e{constructor(){super(h.Yg.CreateClientPreferences,["localStorage","loggerFactory"])}async execute(e){const{localStorage:t,loggerFactory:n}=e;e.clientPreferences=new Vu(n,{set:(e,n)=>t.set(e,n,"Framework","Experience"),get:e=>t.get(e,"Experience")})}}class zu extends _e{constructor(){super(h.Yg.CreateCommandDelegator,["activeWindowsService","appsRegistryService","client","clientPreferences","commandChangeReportingService","commandHandler","coreSettings","loggerFactory","scenarioFactory","shortcutExecutionService","userBiService","windowProvider"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,client:i,clientPreferences:a,commandChangeReportingService:o,commandHandler:r,coreSettings:s,loggerFactory:l,scenarioFactory:c,shortcutExecutionService:d,userBiService:u,windowProvider:m}=e,p=(e,r)=>Et({activeWindowsService:t,appsRegistryService:n,client:i,clientPreferences:a,commandChangeReportingService:o,commandHandler:r,commandInput:e,coreSettings:s,loggerFactory:l,scenarioFactory:c,shortcutExecutionService:d,host:m,userBiService:u});e.delegatedCommanding=new Pt(r,p),e.commandDelegator=p}}class qu extends _e{constructor(){super(h.Yg.CreateCommandHandler,["activeWindowsService","appsRegistryService","client","commandChangeReportingService","coreSettings","experienceChangeReportingService","loggerFactory","platformService","scenarioFactory","userBiService","notificationsHandler","clientPreferences","userTrackingService"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,authenticationUser:i,client:a,commandChangeReportingService:o,coreSettings:r,experienceChangeReportingService:s,loggerFactory:l,platformService:c,scenarioFactory:d,userBiService:u,notificationsHandler:m,clientPreferences:p,userTrackingService:g}=e;e.commandHandler=(e,h)=>Vn({activeWindowsService:t,appsRegistryService:n,authenticationUser:i,client:a,commandChangeReportingService:o,coreSettings:r,entityCommandInput:e,experienceChangeReportingService:s,loggerFactory:l,platformService:c,scenarioFactory:d,clientLaunchId:h,userBiService:u,notificationsHandler:m,clientPreferences:p,userTrackingService:g})}}var Ju;!function(e){e[e.Canceled=0]="Canceled",e[e.Failure=1]="Failure",e[e.Incomplete=2]="Incomplete",e[e.Success=3]="Success"}(Ju||(Ju={}));const Qu=[dt.B.Abandoned,dt.B.Close,dt.B.IntentTransferredCrossCloud],Ku=[dt.B.Incomplete,dt.B.WindowNotUpdated],Yu=[dt.B.Blanked,dt.B.CommandHandledByOnCommandReceived,dt.B.CommandHandledPriorToResolution,dt.B.EventHandled,dt.B.Hidden,dt.B.LayoutRendered,dt.B.LayoutRenderUpdated,dt.B.NotHandled,dt.B.Toggled],Xu=[dt.B.Failure,dt.B.SlotPhasedRenderingTimedOut];function Zu(e){switch(e){case dt.B.ApplicationHookReceivedCommand:case dt.B.CommandBeforeGetAppViewEntities:case dt.B.RenderStarted:case dt.B.ChunkLoadStarted:case dt.B.ChunkLoadSucceeded:case dt.B.Rendered:return!0;default:return!1}}const em={[H.RG.ClientStart]:24e4},tm="command-result-service";class nm{constructor(e,t,n,i,a){this.commandChangeReportingService=t,this.commandResultChangeReportingService=n,this.experienceChangeReportingService=i,this.host=a,this.logger=e.newLogger(tm,"core-services-entity-commanding"),this.pendingCommands=new Map}init(){this.commandChangeSubscription=this.setUpCommandChangeSubscriptions()}destroy(){this.pendingCommands.clear(),this.commandChangeSubscription?.unsubscribe()}registerForCommandTimeOut(e,t){const n=this.pendingCommands.get(e);n&&(n.onCommandTimeOut=t)}unRegisterForCommandTimeOut(e){const t=this.pendingCommands.get(e);t&&(t.onCommandTimeOut=void 0)}onCommandChange(e){switch(e.type){case dt.B.ScenarioEventDataAppended:case dt.B.ScenarioMarked:case dt.B.Rendered:case dt.B.CommandMetaDataAdded:break;case dt.B.DelegatedCommandReceived:case dt.B.EventBubbled:{const{context:{correlation:t},correlationId:n}=e;let i=this.pendingCommands.get(n);i||(i=this.createPendingCommand({correlation:t}),this.pendingCommands.set(n,i));break}case dt.B.CommandStart:{const{correlationId:t,context:{entityCommand:n},userContextId:i}=e;let a=this.pendingCommands.get(t);a?a.entityCommand=n:a=this.createPendingCommand({entityCommand:n,userContextId:i}),this.pendingCommands.set(t,a);break}case dt.B.NavigationCommandStart:{const{correlationId:t,context:{correlation:n},userContextId:i}=e;let a=this.pendingCommands.get(t);a||(a=this.createPendingCommand({correlation:n,userContextId:i})),this.pendingCommands.set(t,a);break}case dt.B.Incomplete:case dt.B.Failure:{const{correlationId:t,context:{errorInfo:n,errorMessage:i,showOops:a,eventData:o,isServiceWorkerActive:r,isLoadedFromServiceWorkerCache:s},userContextId:l}=e,c=this.pendingCommands.get(t);c&&this.calculateCommandResult(c,e.type,l,{errorInfo:n,errorMessage:i,showOops:a,eventData:o,isServiceWorkerActive:r,isLoadedFromServiceWorkerCache:s});break}default:{const{type:t,correlationId:n,context:{eventData:i}}=e,a=this.pendingCommands.get(n);if(a&&a.previousEvents.has(t))break;a&&this.calculateCommandResult(a,e.type,e.userContextId,{eventData:i});break}}}createPendingCommand({correlation:e,entityCommand:t,userContextId:n}){if(!(e=e??t?.command.correlation)){const e=new Error("correlation cannot be undefined. A valid entityCommand or correlation should be passed.");throw this.logger.errorToTelemetry&&this.logger.errorToTelemetry(e.message,"webclient_framework_foundation_command_reporting_service_event",void 0,!0),e}const i=e.id,a=this.host.setTimeout(this.getCommandTimeoutHandler(i,n),this.getCommandTimeout(e));return{contentExistsAndHasChanged:void 0,correlation:e,entityCommand:t,previousEvents:new Set,timeoutId:a}}getCommandTimeoutHandler(e,t){return()=>{const n=this.pendingCommands.get(e);if(n){const{previousStep:i}=n,a=function(e){return e&&Zu(e)?ct.y.TimeoutRunningApp:ct.y.TimeoutRunningCore}(i);n.onCommandTimeOut?.(),this.logger.error(`Command error, correlationId: ${e}, reason ${a}, previousStep: ${i}`),this.onCommandResult(Ju.Failure,e,a,i,t,{errorCode:a})}}}setUpCommandChangeSubscriptions(){return this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e)))}getCommandTimeout({id:e,scenarioName:t}){return t&&em[t]?(this.logger.log(`Increasing the command timeout (${em[t]}) during ${t}, correlationId: ${e}`),em[t]):12e4}calculateCommandResult(e,t,n,i){const{previousStep:a,correlation:{id:o}}=e;if(e.previousEvents.add(t),e.previousStep=t,!i||void 0===i.isServiceWorkerActive&&void 0===i.isLoadedFromServiceWorkerCache||(i.eventData={...i.eventData||{},isServiceWorkerActive:i.isServiceWorkerActive,isLoadedFromServiceWorkerCache:i.isLoadedFromServiceWorkerCache}),function(e){return Yu.includes(e)}(t))this.onCommandResult(Ju.Success,o,t,a,n,{eventData:i?.eventData});else if(function(e){return Xu.includes(e)}(t)){const e=(r=t,s=i?.errorInfo,r===dt.B.SlotPhasedRenderingTimedOut?ct.y.SlotPhasedRenderingTimedOut:s||ct.y.UnknownCommandError),l=i?.errorMessage||i?.eventData?.errors;this.logger.error(`Command error, correlationId: ${o}, reason ${e}, previousStep: ${a}`),this.onCommandResult(Ju.Failure,o,e,a,n,{errorCode:e,errorMessage:l,eventData:i?.eventData})}else if(function(e){return Qu.includes(e)}(t)){const e=function(e,t){return e===dt.B.Close?t&&Zu(t)?ct.y.WindowCloseRunningApp:ct.y.WindowCloseRunningCore:e===dt.B.Abandoned?dt.B.Abandoned:e===dt.B.IntentTransferredCrossCloud?dt.B.IntentTransferredCrossCloud:ct.y.UnknownCommandError}(t,a);this.onCommandResult(Ju.Canceled,o,e,a,n,{errorCode:e,eventData:i?.eventData}),this.logger.log(`Command abandoned, correlationId: ${o}, reason ${e}, previousStep: ${a}`)}else if(function(e){return Ku.includes(e)}(t)){const e=i?.errorInfo||t;this.onCommandResult(Ju.Incomplete,o,e,a,n,{errorCode:e,eventData:i?.eventData}),this.logger.log(`Command incomplete, correlationId: ${o}, reason ${t}, previousStep: ${a}`)}var r,s}onCommandResult(e,t,n,i,a,o){const r=this.pendingCommands.get(t);r&&(this.reportCommandResult(t,a,e,n,i,r,o),this.cleanUpPendingCommand(t,r))}cleanUpPendingCommand(e,{timeoutId:t}){this.host.clearTimeout(t),this.pendingCommands.delete(e)}reportCommandResult(e,t,n,i,a,o,r){const{entityCommand:s,correlation:{scenarioName:l}}=o;this.commandResultChangeReportingService.report({correlationId:e,userContextId:t,context:{entityCommand:s,error:r?.errorCode||r?.errorMessage?{errorCode:r?.errorCode,errorMessage:r?.errorMessage}:void 0,previousStep:a,reason:i,target:tm,eventData:r?.eventData},type:n}),l===H.RG.ClientStart&&n!==Ju.Failure&&this.experienceChangeReportingService.report({type:gt.yU.ClientStartFinished,correlationId:e,userContextId:t,context:{target:"command-result-service",mainEntityType:s?.entity.type}})}}var im;!function(e){e.ExpLoader="ExpLoader",e.Core="Core",e.App="App"}(im||(im={}));var am=n(871471);const om={eventId:"executeEntityCommand"};function rm(e,t,n,i){const{replyContent:a}=e,{id:o,type:r}=t;if(i)switch(r){case Se.py.chats:return function({actionType:e,convId:t,userContextId:n,toastType:i},a,o){let r=ei.unknown;if("quickReply"===e)r=ei.quickReply;else{const e=`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unknown chats action Type`;o.errorToTelemetry&&o.errorToTelemetry(e,"webclient_framework_host_comms",void 0,!0)}return{actionType:r,convId:t||void 0,message:a,userContextId:n,toastType:i}}(i,a,n);case Se.py.calls:return function({actionType:e,userContextId:t,toastType:n},i,a){return e||(a.errorToTelemetry&&a.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unknown calls action type`,"webclient_framework_host_comms",void 0,!0),e="Unknown"),{actionType:e,toastId:i||void 0,toastType:n,userContextId:t}}(i,o,n);case Se.py.communities:case Se.py.communitiesjoinrequest:case Se.py.communitiesmembers:return function({actionType:e,userContextId:t,toastType:n,teamId:i,messageId:a},o){return n||(o.errorToTelemetry&&o.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unknown communities toast type`,"webclient_framework_host_comms",void 0,!0),n="Unknown"),{actionType:e,toastType:n,userContextId:t,messageId:a,teamId:i}}(i,n);case Se.py.callingdeeplink:return function({actionType:e,userContextId:t,toastType:n},i,a){return e||(a.errorToTelemetry&&a.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unknown calls action type`,"webclient_framework_host_comms",void 0,!0),e=ei.unknown),{actionType:e,toastId:i||void 0,toastType:n,userContextId:t}}(i,o,n);default:return void(n.errorToTelemetry&&n.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Unkown target entity type received from host for toast activation command`,"webclient_framework_host_comms",void 0,!0))}else n.errorToTelemetry&&n.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host without target host entity options`,"webclient_framework_host_comms",void 0,!0)}function sm(e,t){switch(e){case y.A$.mutate:return Se.uk.mutate;case y.A$.view:return Se.uk.view;case y.A$.list:return Se.uk.list;case y.A$.join:return Se.uk.join;default:return t.errorToTelemetry&&t.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unknown entity action. Defaulting to view.`,"webclient_framework_host_comms",void 0,!0),Se.uk.view}}function lm(e,t){const{entity:n,entityOptions:i,command:a}=e,{visibilityState:o,correlation:r}=a,{id:s,startTimestamp:l,source:c}=r,d=i?.toastActivationEntityOptions;if(t.log(`Converting host entity command, type ${n?.type}, action ${n?.action}, id ${n?.id}`),t.log(`toastActivationEntityOptions ${d}, visibilityState ${o}`),!d)return om;if(!n)return om;const{optionsJson:u}=n,m=function(e,t){const{id:n,type:i,action:a,linkedEntity:o}=e;return{action:sm(a,t),id:n,linkedEntity:km(o,t),type:dm(i,t)}}(n,t),p=u?(0,am.D)(u,void 0):void 0;return{...om,payload:{entity:m,command:{visibilityState:um(o,t),correlation:{id:s,startTimestamp:l?l.getTime():void 0,source:c,scenarioName:H.RG.ToastActivation},stateTransition:Cm(n.type,t)},entityOptions:cm(p),dataOptions:n.action===y.A$.mutate||n.type===y.dt.communities||n.type===y.dt.reminders||n.type===y.dt.callingdeeplink||n.type===y.dt.communitiesjoinrequest||n.type===y.dt.communitiesmembers?rm(d,m,t,p):{userContextId:p.userContextId}}}}function cm(e){if(e?.deepLinkId&&!e?.coordinates)return{deepLinkId:e.deepLinkId};if(e?.deepLinkId&&e?.coordinates)return{deepLinkId:e.deepLinkId,deeplinkId:e.deepLinkId,coordinates:e.coordinates};if(e?.campaignType)return{campaignType:e.campaignType};if(!e?.messageId)return;const{messageId:t,focusOnLoad:n}=e;return{messageId:t,focusOnLoad:n}}function dm(e,t){switch(e){case y.dt.chats:case y.dt.reminders:return Se.py.chats;case y.dt.calls:return Se.py.calls;case y.dt.extensions:return Se.py.extensions;case y.dt.activity:return Se.py.activity;case y.dt.campaignnotifications:return Se.py.campaignnotifications;case y.dt.channels:return Se.py.channels;case y.dt.communities:return Se.py.communities;case y.dt.communitiesevents:return Se.py.communitiesevents;case y.dt.callingdeeplink:return Se.py.callingdeeplink;case y.dt.communitiesjoinrequest:return Se.py.communitiesjoinrequest;case y.dt.communitiesmembers:return Se.py.communitiesmembers;default:return t.errorToTelemetry&&t.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unknown entity type. Defaulting to chats`,"webclient_framework_host_comms",void 0,!0),Se.py.chats}}function um(e,t){switch(e){case y.S1.show:return ke.fe.show;case y.S1.hide:return ke.fe.hide;default:return t.errorToTelemetry&&t.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unknown visibility state. Defaulting to show`,"webclient_framework_host_comms",void 0,!0),ke.fe.show}}function mm(e,t){const{command:n}=e,{correlation:i,visibilityState:a}=n;let o;return i?.startTimestamp&&(o=new Date(+i.startTimestamp),o=Tm(o)?o:void 0),{correlation:{id:i?.id??(0,Re.v4)(),startTimestamp:o,source:y.tq.toastFromWeb},visibilityState:Sm(a,t)}}function pm(e,t){try{const{entity:n}=e,{action:i,id:a,type:o}=n;return{action:gm(i,t),id:a,type:vm(o)}}catch(e){throw t.errorToTelemetry&&t.errorToTelemetry(`${Ps}${(0,$.u4)(e)}`,"webclient_framework_host_comms",void 0,!0),e}}function gm(e,t){switch(e){case Se.uk.mutate:return y.A$.mutate;case Se.uk.view:return y.A$.view;case Se.uk.list:return y.A$.list;case Se.uk.join:return y.A$.join;default:return t.errorToTelemetry&&t.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing}: EntityAction. Defaulting to HostEntityAction.view`,"webclient_framework_host_comms",void 0,!0),y.A$.view}}function hm(e){const{id:t,linkedEntity:n,action:i,type:a,dataOptions:o}=e;return{action:i,id:t,linkedEntity:n,type:a,optionsJson:(0,$.u4)(o)}}function ym(e){!function(e){if(!e)throw(0,de.Tr)(h.w5.Commanding,li.f.RequiredFieldMissing,Se.py.toasts,void 0,`${li.f.RequiredFieldMissing}: entityOptions`);const t=e;if(!(t.targetEntity&&t.targetEntity.action&&t.targetEntity.type&&t.targetEntity.dataOptions&&t.time&&(t.title||""===t.title)))throw(0,de.Tr)(h.w5.Commanding,li.f.RequiredFieldMissing,Se.py.toasts,void 0,`${li.f.RequiredFieldMissing}: hostEntityOptions?.toastEntityOptions`)}(e);const{buttons:t,targetEntity:n,textInput:i,time:a,isUrgent:o,bypassOsLevelDoNotDisturb:r}=e;return{toastEntityOptions:{...e,isUrgent:o||r,targetEntity:hm(n),time:a,buttons:wm(t),textInput:fm(i)}}}function vm(e){if(e===Se.py.toasts)return y.dt.toasts;throw(0,de.Tr)(h.w5.Commanding,li.f.RequiredFieldMissing,Se.py.toasts,void 0,`${li.f.RequiredFieldMissing}: EntityType`)}function fm(e){if(!e)return;const{placeholderText:t,sendButton:n}=e;return{placeholderText:t,sendButton:n?bm(n):void 0}}function Sm(e,t){switch(e){case ke.fe.hide:return y.S1.hide;case ke.fe.show:return y.S1.show;default:return t.errorToTelemetry&&t.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing}: EntityVisibilityState. Defaulting to HostEntityVisibilityState.show`,"webclient_framework_host_comms",void 0,!0),y.S1.show}}function km(e,t){if(!e)return;const{id:n,type:i,action:a}=e;return{action:a?sm(a,t):void 0,id:n,type:dm(i,t)}}function Cm(e,t){switch(e){case y.dt.chats:case y.dt.channels:case y.dt.calls:case y.dt.campaignnotifications:return ke.su.new;case y.dt.extensions:case y.dt.reminders:case y.dt.activity:case y.dt.communities:case y.dt.communitiesevents:case y.dt.callingdeeplink:case y.dt.communitiesjoinrequest:case y.dt.communitiesmembers:return ke.su.flush;default:return t.errorToTelemetry&&t.errorToTelemetry(`${Ps}${li.f.RequiredFieldMissing} Toast activation command received from host with unhandled host entity type - ${e}.`,"webclient_framework_host_comms",void 0,!0),ke.su.new}}function bm(e){const{image:t,targetEntity:n,text:i,preferImageOnly:a,style:o}=e;return{image:t,preferImageOnly:a,style:o,targetEntity:hm(n),text:i}}function wm(e){if(e)return e.map(bm)}const Tm=e=>e instanceof Date&&!isNaN(e.getTime());async function Im(e,t,n,i){if(e.entity.type!==Se.py.toasts)return;let a,o,r;if(e.command.correlation?.id&&(a=i.findScenarioByNameAndId(H.RG.CrossClientToastView,e.command.correlation.id),o=i.findScenarioByNameAndId(H.RG.WebToastShow,e.command.correlation.id)),e.entityOptions){const t=e.entityOptions;t?.crossClientScenarioName&&t?.callId&&(r=i.findScenarioByNameAndId(t?.crossClientScenarioName,t?.callId))}const s=await async function(e,t){let n;try{n=await e.loadModule("core"),t.log(`${Ps}${xs.LoadModuleCoreSuccess}`)}catch(e){const n=`${Ps}${Ms.LoadModuleCoreFailed} ${(0,$.u4)(e)}`;t.errorToTelemetry&&t.errorToTelemetry(n,"webclient_framework_host_comms",void 0,!0)}return n}(t,n);if(!s||!s.executeCommand)return n.errorToTelemetry&&n.errorToTelemetry(`${Ps}${Ms.LoadModuleCoreFailed}`,"webclient_framework_host_comms",void 0,!0),a?.fail({errorCode:Ms.LoadModuleCoreFailed}),o?.fail({errorCode:Ms.LoadModuleCoreFailed}),void r?.fail({errorCode:Ms.LoadModuleCoreFailed});try{const t=function(e,t){return{command:mm(e,t),entity:pm(e,t),entityOptions:ym(e?.entityOptions)}}(e,n);await(s?.executeCommand(t)),n.log(`${Ps}${xs.ExecuteCommandSuccess}`),a?.mark(H.ck.CrossClientHostEventSent),r?.mark(H.ck.CrossClientHostEventSent),o?.stop()}catch(e){n.errorToTelemetry&&n.errorToTelemetry(`${Ps}${Ms.ExecuteCommandFailed} ${(0,$.u4)(e)}`,"webclient_framework_host_comms",void 0,!0),a?.fail({errorCode:Ms.ExecuteCommandFailed}),o?.fail({errorCode:Ms.ExecuteCommandFailed}),r?.fail({errorCode:Ms.ExecuteCommandFailed})}}class Nm{constructor(e,t,n,i){this.commandChangeReportingService=e,this.commandResultChangeReportingService=t,this.scenarioFactory=n,this.pendingCommands=new Map,this.logger=i.newLogger("CommandTelemetryService","core-services-entity-commanding"),this.commandSequence=0}init(){this.commandChangeSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e))),this.commandResultChangeSubscription=this.commandResultChangeReportingService.observeChanges().subscribe((e=>this.onCommandResultChange(e)))}destroy(){this.pendingCommands.clear(),this.commandChangeSubscription?.unsubscribe(),this.commandResultChangeSubscription?.unsubscribe(),this.lifeCycleScopeChangeSubscription?.unsubscribe()}onCommandChange(e){switch(e.type){case dt.B.ScenarioEventDataAppended:{const{correlationId:t,context:{eventData:n}}=e;this.appendScenarioEventData(t,n);break}case dt.B.ScenarioMarked:{const{correlationId:t,context:{step:n,eventData:i,status:a,monitoringData:o}}=e;this.addScenarioMark(t,n,e.type,i,a,o);break}case dt.B.Rendered:case dt.B.CommandMetaDataAdded:break;case dt.B.DelegatedCommandReceived:{const{context:{correlation:t}}=e;this.startCommandTelemetry(t.id,{correlation:t});break}case dt.B.EventBubbled:{const{context:{correlation:t,eventType:n}}=e;this.startCommandTelemetry(t.id,{correlation:t,eventType:n});break}case dt.B.CommandStart:{const{correlationId:t,context:{entityCommand:n}}=e,{scenarioEventData:i}=n;this.startCommandTelemetry(t,{entityCommand:n}),i&&this.appendScenarioEventData(t,i);break}case dt.B.NavigationCommandStart:{const{correlationId:t,context:{clientLaunchId:n,correlation:i,eventData:a}}=e;this.startCommandTelemetry(t,{correlation:i,clientLaunchId:n}),a&&this.appendScenarioEventData(t,a);break}default:{const{type:t,correlationId:n,context:{eventData:i}}=e,a=this.pendingCommands.get(n);if(a&&a.previousEvents.has(t))break;a?.previousEvents.add(t),Zu(t)&&a?.commandScenario.appendEventData({scenarioPhase:im.App}),i&&this.appendScenarioEventData(n,i),this.addScenarioMark(n,t,t,i);break}}}findExistingNavigationCommandScenario(e,t){const n=t.scenarioName||H.RG.NavigationCommand;let i=this.scenarioFactory.findScenarioByNameAndId(n,e);return i?.eventData["EventInfo.CorrelationId"]!==t.id&&(i=null),i||t.scenarioName!==H.RG.ClientStart||(i=this.scenarioFactory.findScenario(H.RG.ClientStart)),i||void 0}findExistingActivitySwitchScenario(e){const t=e?.id;if(e?.source===C.D.ActivityFeedBellClick){const e=Array.from(this.pendingCommands.values());for(const n of e)if(n.correlation.scenarioName===H.RG.ActivitySwitch||n.correlation.scenarioName===H.RG.NavigationCommand){const e=n.correlation.id;this.logger.log(`Command was sent by activity app as a result of a bell click, correlationId ${t}. Combining scenario with existing ${n.correlation.scenarioName} of correlationId ${e}`);const i=n.commandScenario;return this.pendingCommands.delete(e),i}}}startCommandTelemetry(e,{entityCommand:t,correlation:n,clientLaunchId:i,eventType:a}){let o,r=this.pendingCommands.get(e);if(i&&n&&(o=this.findExistingNavigationCommandScenario(i,n)),!o&&t){const{scenarioName:e,id:n}=t.command.correlation;e&&(o=this.scenarioFactory.findScenarioByNameAndId(e,n))}o||(o=this.findExistingActivitySwitchScenario(n||t?.command.correlation)),r?t&&(this.logger.log(`Updating command\n\tscenarioName: ${r.commandScenario.name}\n\tcorrelationId: ${e}\n\tentityType: ${t.entity.type}\n\tentityAction: ${t.entity.action}`),r.commandScenario.appendEventData({mainEntityAction:t.entity.action,mainEntityType:t.entity.type})):r=this.createPendingCommand(e,{commandScenario:o,entityCommand:t,correlation:n,clientLaunchId:i,eventType:a}),this.pendingCommands.set(e,r)}createPendingCommand(e,{entityCommand:t,correlation:n,clientLaunchId:i,commandScenario:a,eventType:o}){if(!(n=n??t?.command.correlation)){const e=new Error("correlation cannot be undefined. A valid entityCommand or correlation should be passed.");throw this.logger.errorToTelemetry&&this.logger.errorToTelemetry(e.message,"webclient_framework_foundation_command_reporting_service_event",void 0,!0),e}if(n.scenarioName=n.scenarioName??H.RG.EntityCommand,!a){this.logger.log(`Creating new scenario with scenarioName: ${n.scenarioName}, correlationId ${e}`);const{startTimestamp:o}=n,r=o&&Tm(new Date(+o))?+o:void 0,s=i;(a=this.scenarioFactory.newScenario(n.scenarioName,{startTime:r,clientId:s})).appendEventData({"EventInfo.CorrelationId":e,commandSequence:++this.commandSequence,commandSource:n.source,mainEntityAction:t?.entity.action,mainEntityType:t?.entity.type,scenarioPhase:im.Core})}return this.logger.log(o?`Starting to track a new event\n\teventType: ${o}\n\tscenarioName: ${n.scenarioName}\n\tcorrelationId: ${e}\n\t`:`Starting to track a new command\n\tscenarioName: ${n.scenarioName}\n\tcorrelationId: ${e}\n\tentityType: ${t?.entity.type}\n\tentityAction: ${t?.entity.action}\n\tclientId: ${i}`),{correlation:n,commandScenario:a,previousEvents:new Set}}appendScenarioEventData(e,t){const n=this.pendingCommands.get(e);n&&n.commandScenario.appendEventData((0,W.omitBy)(t,W.isUndefined))}addScenarioMark(e,t,n,i,a,o){const r=this.pendingCommands.get(e);r&&(n!==dt.B.ScenarioMarked&&this.logger.log(`${r.commandScenario.name} addScenarioMark, step:${t}, correlationId: ${e}, step: ${t}, eventData: ${JSON.stringify(i)}`),r.commandScenario.mark(t,i&&(0,W.omitBy)(i,W.isUndefined),a,o))}onCommandResultChange(e){const{context:{error:t,reason:n,previousStep:i,eventData:a,entityCommand:o},correlationId:r,type:s}=e,l=this.pendingCommands.get(r);if(!l)return void(n!==dt.B.Abandoned&&this.logger.warn(`Command Result of ${n} and correlationId ${r} was reported but no pending command was found`));const c=l?.commandScenario,d=(0,W.omitBy)(o&&Nm.overrideMainEntityForExtensionCommand(a,o)||a,W.isUndefined);switch(s){case Ju.Canceled:{const{errorCode:e}=t||{};this.logger.warn(`${c.name} Cancelled, correlationId: ${r}, reason: ${e}, previousStep: ${i}`),c.cancel({errorCode:e,reason:e,...d});break}case Ju.Failure:{const{errorCode:e,errorMessage:n}=t||{};this.logger.error(`${c.name} Failed, correlationId: ${r}, reason: ${e}, errorMessage: ${n}, previousStep: ${i}`),c.fail({errorCode:e,reason:e,errors:n&&(0,ce.A)(n),...d});break}case Ju.Incomplete:{const{errorCode:e}=t||{};this.logger.warn(`${c.name} Incomplete, correlationId: ${r}, reason: ${e}, previousStep: ${i}`),c.incomplete({errorCode:e,reason:e,...d});break}case Ju.Success:this.logger.log(`${c.name} Successful, correlationId: ${r}, reason: ${n}, previousStep: ${i}`),c.stop({reason:n,...d})}this.pendingCommands.delete(r)}static overrideMainEntityForExtensionCommand(e,t){return t.command.stateTransition!==ke.su.extend?e:{...e,modalEntityType:t.entity.type,modalEntityAction:t.entity.action}}}const Em=[dt.B.ApplicationHookReceivedCommand,dt.B.ApplicationHookContinuedCommand],Am=[dt.B.ChunkLoadStarted,dt.B.ChunkLoadSucceeded,dt.B.ScenarioEventDataAppended,dt.B.ScenarioMarked];class _m{constructor(e,t){this._host=t,this.commandTimedOutAtHostHandler=e=>{const{correlationId:t,reason:n}=e.payload,i=this._pendingCommands.get(t);i&&(i.onCommandTimeOut&&i.onCommandTimeOut(n),this.cleanUpPendingCommand(t))},this._logger=e.newLogger("CommandReportingServiceHybrid","core-services-entity-commanding"),this._pendingCommands=new Map,this._host.opener.addEventListener(O.rY.EntityCommandTimedOutAtHost,this.commandTimedOutAtHostHandler)}registerNavigationCommandStart(){}registerCommandStart(e){const t=e.command.correlation.id;if(!t)return void this._logger.error("registerCommandStart called without a command correlation id");const n=this._pendingCommands.get(t);n&&(this._logger.log(`registerCommandStart called with a pending command with correlation id ${t}, overwriting and starting new timeout interval`),this._host.clearTimeout(n.timeoutId));const i=n?.entityCommand.entityOptions?.timeout,a=i||9e4,o=this._host.setTimeout((()=>{this.reportCommandEvent(t,dt.B.CommandReportingTimedOut),this.cleanUpPendingCommand(t)}),a);this._logger.log(`Starting to track command with correlation Id ${t}`),this._pendingCommands.set(t,{entityCommand:e,timeoutId:o,previousEvents:new Set})}appendCommandEventData(e,t){const n=this._pendingCommands.get(e);n?this._pendingCommands.set(e,{...n,eventData:{...n.eventData,...t}}):this._logger.warn(`appendCommandEventData called with correlationId ${e}, but there was no such pending command`)}reportCommandEvent(e,t,n,i,a,o){const r=this._pendingCommands.get(e);if(!r)return;if(!Am.includes(t)&&r.previousEvents.has(t))return;r.previousEvents.add(t);const{entityCommand:s,eventData:l}=r,c={entityCommand:s,commandEvent:t,...l,...n,timestamp:Date.now(),scenarioEventData:i,step:a,status:o};t===dt.B.CommandReportingTimedOut||Em.includes(t)||this._logger.log(`Command event reported ${t} for correlation id ${e}`),Em.includes(t)||this._host.opener.postMessage(w.W.CommandChangeType,c)}registerForCommandTimeOut(e,t){const n=this._pendingCommands.get(e);n&&(n.onCommandTimeOut=t)}unRegisterForCommandTimeOut(e){const t=this._pendingCommands.get(e);t&&(t.onCommandTimeOut=void 0)}appendScenarioEventData(e,t){this.reportCommandEvent(e,dt.B.ScenarioEventDataAppended,void 0,t)}addScenarioMark(e,t,n,i){this.reportCommandEvent(e,dt.B.ScenarioMarked,void 0,n,t,i)}cleanUpPendingCommand(e){const t=this._pendingCommands.get(e);t&&(this._host.clearTimeout(t.timeoutId),this._pendingCommands.delete(e))}}class Fm{constructor(e,t){this.legacyCommandReportingService=e,this.commandChangeReportingService=t,this.commandChangeSubscription=this.setUpCommandChangeSubscriptions()}destroy(){this.commandChangeSubscription.unsubscribe()}changeToCommandReportingService(e){switch(e.type){case dt.B.AfterOnCommandReceived:case dt.B.AfterOnEventReceived:case dt.B.BeforeOnCommandReceived:case dt.B.BeforeOnEventReceived:case dt.B.CommandHandledByOnCommandReceived:case dt.B.EventBubbled:case dt.B.EventHandled:case dt.B.DelegatedCommandReceived:break;case dt.B.ScenarioEventDataAppended:{const{context:{eventData:t},correlationId:n}=e;this.legacyCommandReportingService.appendScenarioEventData(n,t);break}case dt.B.ScenarioMarked:{const{context:{step:t,eventData:n,status:i,monitoringData:a},correlationId:o}=e;this.legacyCommandReportingService.addScenarioMark(o,t,n,i,a);break}case dt.B.CommandStart:{const{context:{entityCommand:t,executionContextEntity:n},correlationId:i}=e,{scenarioEventData:a}=t;this.legacyCommandReportingService.registerCommandStart(t),a&&this.legacyCommandReportingService.appendScenarioEventData(i,a),this.legacyCommandReportingService.reportCommandEvent(i,dt.B.CommandReceived,{executionContextEntity:n});break}case dt.B.NavigationCommandStart:{const{context:{clientLaunchId:t,correlation:n,eventData:i},correlationId:a}=e;this.legacyCommandReportingService.registerNavigationCommandStart(t,n),this.legacyCommandReportingService.addScenarioMark(a,dt.B.DeeplinkReceived),i&&this.legacyCommandReportingService.appendScenarioEventData(a,i);break}case dt.B.CommandMetaDataAdded:{const{context:{target:t,...n},correlationId:i}=e;this.legacyCommandReportingService.appendCommandEventData(i,n);break}case dt.B.NotHandled:{const{correlationId:t,type:n}=e;this.legacyCommandReportingService.reportCommandEvent(t,n);break}default:{const{context:{target:t,eventData:n,...i},correlationId:a,type:o}=e;this.legacyCommandReportingService.reportCommandEvent(a,o,i,n);break}}}setUpCommandChangeSubscriptions(){return this.commandChangeReportingService.observeChanges().subscribe((e=>this.changeToCommandReportingService(e)))}}class Dm{constructor(e,t,n){this.commandChangeReportingService=e,this.lifeCycleScopeChangeReportingService=t,this.logger=n.newLogger("CommandAppLifeCycleListenerService","core-services-entity-commanding"),this.lifeCycleScopeChangeSubscription=this.subscribeToLifeCycleScopeChange()}destroy(){this.lifeCycleScopeChangeSubscription?.unsubscribe()}subscribeToLifeCycleScopeChange(){return this.lifeCycleScopeChangeReportingService.observeChanges().pipe((0,d.U)((({correlationId:e,context:{apps:t}})=>{let n=!1;return t.forEach((({id:t,type:i})=>{i===gt.c4.Initialized&&(n=!0,this.logger.log(`${t} initialized, correlationId: ${e}`))})),{appInitialized:n,correlationId:e}})),(0,m.h)((({appInitialized:e})=>e))).subscribe((({correlationId:e,appInitialized:t})=>{this.commandChangeReportingService.report({correlationId:e,type:dt.B.ScenarioEventDataAppended,context:{target:"commandAppLifeCycle",eventData:{appInitialized:t}}})}))}}class Pm{constructor(e){this.commandChangeReportingService=e}init(){this.commandsHistory&&this.destroy(),this.commandsHistory=new En.B(30),this.initCommandChangeReportingSubscription()}destroy(){this.commandChangeReportingSubscription?.unsubscribe(),this.commandChangeReportingSubscription=void 0,this.commandsHistory=void 0}get CommandsHistory(){return this.commandsHistory}initCommandChangeReportingSubscription(){this.commandChangeReportingSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>this.onCommandChange(e)))}onCommandChange(e){const{correlationId:t}=e;if(this.commandsHistory)if(e.type===dt.B.CommandStart){const{context:{entityCommand:n}}=e;let i=this.commandsHistory.get(t);const a={entityCommand:n,isCommandTargetedToMainWindow:!1,steps:[]};i=i?{...i,entityCommand:n}:a,this.commandsHistory.set(t,i)}else{const n=this.commandsHistory.get(t);n?.steps.push({event:e.type,timestamp:Date.now()-(parseInt(n.entityCommand.command.correlation.startTimestamp,10)||0)})}}}function Mm(e,t,...n){const{coreSettings:i}=t,a=i?.get(b.J.Core).enableCoreErrorsV2??!1,o=[];for(const i of n)if(!t[i]&&(o.push(i),!a)){const t=`${e}: ${i} is missing`;throw(0,de.Tr)(h.w5.Core,h.jK.CoreServiceMissing,e,void 0,t)}if(a&&o.length>0)throw Ae.fromMissingDependencies(e,o);return t}class xm extends _e{constructor(){super(h.Yg.CreateCommandReportingService,[])}async execute(e){const t="CreateCommandReportingServiceTask",{commandChangeReportingService:n,coreSettings:i,lifeCycleScopeChangeReportingService:a,loggerFactory:o,scenarioFactory:r,windowProvider:s,experienceChangeReportingService:l}=Mm(t,e,"coreSettings","commandChangeReportingService","lifeCycleScopeChangeReportingService","loggerFactory","scenarioFactory","windowProvider","experienceChangeReportingService");if(i.get(b.J.Core)?.enableStandaloneCommandReportingService){const{commandResultChangeReportingService:a}=Mm(t,e,"commandResultChangeReportingService"),c=new nm(o,n,a,l,s);c.init(),e.commandResultService=c,new Nm(n,a,r,o).init(),this.initCommandHistoryService(e,n,i)}else e.commandReportingService=new _m(o,s),new Fm(e.commandReportingService,n);new Dm(n,a,o),this.initCommandHistoryService(e,n,i)}initCommandHistoryService(e,t,n){e.commandHistoryService=new Pm(t),n?.get(b.J.Diagnostics).isDiagnosticsPanelEnabled&&e.commandHistoryService.init()}}class Rm extends _e{constructor(){super(h.Yg.CreateCommandResultHooksService,[])}async execute(e){const{appsRegistryService:t,coreSettings:n,client:i,commandResultChangeReportingService:a,entityCommanding:o,loggerFactory:r,scenarioFactory:s}=Mm("CreateCommandReportingServiceTask",e,"appsRegistryService","client","commandResultChangeReportingService","coreSettings","entityCommanding","loggerFactory","scenarioFactory");return n.get(b.J.Core)?.enableStandaloneCommandReportingService&&(e.commandResultHooksService=new Ea(t,i,a,n,o,r,s,e.authenticationUser&&(0,xe.b4)(e.authenticationUser)),e.commandResultHooksService.init()),Promise.resolve()}}var jm=n(787465);const Lm=(e,t,n,i)=>{const a=`${e}::TypeError::`;try{return new URL(t,n||void 0)}catch(e){let o=`${a}base::${n}`;throw i&&(o=o.concat(`::url::${t}`)),new jm.Y("URL_PARSE_FAILED",new Error(o))}},Om=(e,t,n)=>{let i=!1,a=!1,o=!1,r=!1,s=!1,l=`${e}::`;const c="ProtocolValidationFailed::",d="OriginValidationFailed::";if(t.protocol&&n.protocol?a=!0:l=l.concat(`${c}EmptyProtocol::'${t.protocol}'::'${n.protocol}'`),t.protocol!==n.protocol?l=l.concat(`${c}'${t.protocol}' !== '${n.protocol}'`):o=!0,t.origin&&n.origin?r=!0:l=l.concat(`${d}EmptyOrigin::'${t.origin}'::'${n.origin}'`),t.origin!==n.origin?l=l.concat(`${d}'${t.origin}' !== '${n.origin}'`):s=!0,i=a&&o&&r&&s,!i)throw new jm.Y("URL_VALIDATION_FAILED",new Error(l))},$m=[{id:"@msteams/services-io-calling-service-adapters#cmdb-calling-bundle-loader-service-adapter",getConfig:e=>({createScriptURL:(t,n)=>{const i="callingBundleLoaderPolicy",a=e.get(b.J.Security).callingBundleLoaderAllowedOrigin;if(!a)throw new jm.Y("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList callingBundleLoaderAllowedOrigin is undefined or empty`));let o;const r=Lm(i,t,n,!0);try{const e=Lm(i,a,void 0,!0);return Om(i,r,e),r.href}catch(e){o=e}throw o}})},{id:"@msteams/services-utilities-google-authentication#google-client-library-loader",getConfig:e=>({createScriptURL:(t,n)=>{const i="googleClientLibraryLoaderPolicy",a=e.get(b.J.Security).googleClientLibraryLoaderAllowedOrigin??[];if(!Array.isArray(a)||0===a.length)throw new jm.Y("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList googleClientLibraryLoaderAllowedOrigin is undefined or empty`));let o;const r=Lm(i,t,n,!0);for(const e of a)try{const t=Lm(i,e,void 0,!0);return Om(i,r,t),r.href}catch(e){o=e}throw o}})},{id:"@msteams/components-location-bing-map#location-sdk-api",getConfig:e=>({createScriptURL:(t,n)=>{const i="locationSdkApiPolicy",a=e.get(b.J.Security).bingApiAllowedOrigin;if(!a)throw new jm.Y("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList bingApiAllowedOrigin is undefined or empty`));let o;const r=Lm(i,t,n,!0);try{const e=Lm(i,a,void 0,!0);return Om(i,r,e),r.href}catch(e){o=e}throw o}})},{id:"@msteams/components-calling-ppt-sharing#components-calling-ppt-sharing",getConfig:e=>({createScriptURL:(t,n)=>{const i="pptLivePolicy",a=e.get(b.J.Security).pptLiveAllowedOrigin??[];if(!Array.isArray(a)||0===a.length)throw new jm.Y("URL_VALIDATION_FAILED",new Error(`${i}::TypeError::allowedOriginList pptLiveAllowedOrigin is undefined or empty`));let o;const r=Lm(i,t,n,!0);for(const e of a)try{const t=Lm(i,e,void 0,!0);return Om(i,r,t),r.href}catch(e){o=e}throw o}})}],Um=[{id:"@msteams/no-op",getConfig:()=>({createHTML:e=>e,createScriptURL:e=>e})},{id:"@msteams/services-utilities-common#ChunkLoader",getConfig:e=>({createScriptURL:(t,n)=>{const i="chunkLoaderPolicy";let a,o,r,s=!1,l=!1;const c=Lm(i,t,n,!0),d=e.get(b.J.Platform).staticsPath??"";if(!d)throw new jm.Y("URL_PARSE_FAILED",new Error(`${i}::TypeError::allowListUrl staticsPath is undefined`));try{r=Lm(i,d,void 0,!0),Om(i,c,r),s=!0}catch(e){a=e}if(s)return c.href;try{r=Lm(i,Wm,void 0,!0),Om(i,c,r),l=!0}catch(e){o=e}if(l)return c.href;if(a)throw a;throw o}})},{id:"@msteams/services-io-browser-web-client-update#register-service-worker",getConfig:()=>({createScriptURL:(e,t)=>{const n="registerServiceWorkerPolicy";let i,a,o=!1;const r=Lm(n,e,t,!0);try{a=Lm(n,Wm,void 0,!0),Om(n,r,a),o=!0}catch(e){i=e}if(o)return r.pathname;throw i}})},{id:"@msteams/core-services-telemetry-worker#TelemetryWorker",getConfig:e=>({createScriptURL:(e,t)=>{const n="telemetryWorkerPolicy";let i,a,o=!1;const r=Lm(n,e,t,!0);try{a=Lm(n,Wm,void 0,!0),Om(n,r,a),o=!0}catch(e){i=e}if(o)return r.pathname+r.hash;throw i}})}];function Bm(){return window}const Wm=Bm().location.origin;class Hm{constructor(e,t){this.coreSettings=e,this.logger=t.newLogger("CoreSecurityService","core-services-security"),this.configMap=new Map,this.policyMap=new Map,this.initializeTrustedTypeConfigMap(),this.setIsTrustedTypePoliciesEnabled()}getTrustedTypePolicy(e){let t;if(this.isTrustedTypePoliciesEnabled||(e="@msteams/no-op"),t=this.policyMap.get(e),t)return t;if(t=this.createTrustedTypePolicyOnDemand(e),t)return this.policyMap.set(e,t),t;const n=new jm.Y("POLICY_NOT_FOUND",new Error(`${e}`));throw this.logger.errorToTelemetry?.(`${n.code}::${n.prevError?.message}`,"webclient_framework_foundation_core_services_security",void 0,!0),n}createTrustedTypePolicyOnDemand(e){const t=this.configMap.get(e);if(!t)return;const n=Bm().trustedTypes;if(!this.isTrustedTypePoliciesEnabled||!n)return this.getOptionsAsTrustedTypePolicy(t);try{return n.createPolicy(t.id,t.getConfig(this.coreSettings))}catch(t){const n=new jm.Y("CREATE_POLICY_FAILED",new Error(`${e}${t?.message}`));throw this.logger.errorToTelemetry?.(`${n.code}::${n.prevError?.message}`,"webclient_framework_foundation_core_services_security",void 0,!0),n}}getOptionsAsTrustedTypePolicy(e){return e.getConfig(this.coreSettings)}initializeConfigs(){$m.forEach((e=>{this.setConfig(e)}))}initializeCoreConfigs(){Um.forEach((e=>{this.setConfig(e)}))}initializeTrustedTypeConfigMap(){this.initializeCoreConfigs(),this.initializeConfigs()}setConfig(e){if(this.configMap.has(e.id))throw new jm.Y("DUPLICATE_POLICY_FOUND",new Error(`CoreSecurityService::${e.id}`));this.configMap.set(e.id,e)}setIsTrustedTypePoliciesEnabled(){const{enableTrustedTypePolicies:e}=this.coreSettings.get(b.J.Core);this.isTrustedTypePoliciesEnabled=!!e}}class Vm extends _e{constructor(){super(h.Yg.CreateCoreSecurityTask,["coreSettings","loggerFactory","windowProvider"])}async execute(e){const{coreSettings:t,loggerFactory:n,windowProvider:i}=e,a=n.newLogger("CoreSecurityService","core-services-tasks"),o=new Hm(t,n);e.coreSecurityService=o,i.chunkLoader.configureCoreSecurityService(o),a.log("CoreSecurityService Initialized")}}var Gm,zm,qm;!function(e){e.Merge="merge",e.Override="override"}(Gm||(Gm={})),function(e){e[e.Configuration=0]="Configuration",e[e.Override=1]="Override",e[e.ClientFilters=2]="ClientFilters",e[e.Policy=3]="Policy",e[e.TestOverride=4]="TestOverride"}(zm||(zm={}));class Jm{constructor(){this.providers={[zm.Configuration]:[],[zm.Override]:[],[zm.ClientFilters]:[],[zm.Policy]:[],[zm.TestOverride]:[]}}registerProvider(e,t){this.providers[t].push(e)}getSettings(e){const t=this.mergeProviders(zm.Configuration,e),n=this.mergeProviders(zm.Override,e,t),i=this.mergeProviders(zm.ClientFilters,e),a=this.combineConfigs(n,i,this.filterAndConfigMergeRule),o=this.mergeProviders(zm.Policy,e),r=this.combineConfigs(a,o,this.policyAndConfigMergeRule);return this.mergeProviders(zm.TestOverride,e,r)}mergeProviders(e,t,n={}){return this.providers[e].map((e=>e.getSettings())).filter((e=>!!e)).map((e=>(0,W.pick)(e,t))).reduce(((e,t)=>((0,W.mergeWith)(e,t,su.g),e)),n)}combineConfigs(e,t,n){return Object.keys(t).map((i=>{const a=(0,W.get)(e,i)||{},o=(0,W.get)(t,i)||{};Object.keys(o).map((t=>{const r=(0,W.get)(a,t),s=(0,W.get)(o,t),l=n(r,s);(0,W.set)(a,t,l),(0,W.set)(e,i,a)}))})),e}policyAndConfigMergeRule(e,t){return(0,W.isNil)(e)?t:(0,W.isNil)(t)?void 0:(0,W.isBoolean)(t)?e&&t:t}filterAndConfigMergeRule(e,t){return(0,W.isNil)(e)?t:(0,W.isBoolean)(t)?t&&e:t}}class Qm{constructor(e){this.value=e,this.observers=new Map}getObservable(e){return new Cn.y((t=>(e.forEach((e=>this.getOrCreateObservers(e).push(t))),t.next(this.value),{unsubscribe:()=>{e.forEach((e=>{const n=this.getOrCreateObservers(e),i=n.indexOf(t);i>=0&&n.splice(i,1)}))}})))}next(e,t){this.value=t;const n=(0,W.reduce)(e.map((e=>this.getOrCreateObservers(e))),((e,t)=>e.concat(t)));new Set(n).forEach((e=>e.next&&e.next(t)))}getOrCreateObservers(e){let t=this.observers.get(e);return void 0===t&&(t=[],this.observers.set(e,t)),t}}class Km{constructor(e,t,n){this.cachedCategorySettings=new Map,this.allCachedCategorySettings={},this.categoryBehaviorSubjectMap=new Map,this.perCategoryFilteredSubjects={},this.behaviorSubjectForAnySettingsChangeForCdlWorker=new r.X(void 0),this.providerSubscriptions=[],this.enableFilteredSettingsSubject=!1,this.notifySettingsChanged=()=>{const e=[...new Set([...this.cachedCategorySettings.keys(),...Object.keys(this.allCachedCategorySettings)])];this.logger.log(`Settings have changed, checking for differences in these categories: ${e.join(", ")}`);const t=this.allCachedCategorySettings,{filteredSettings:n,allSettings:i}=this.getLatestSettingsForCategories(e);this.allCachedCategorySettings={...this.allCachedCategorySettings,...i};const a={};e.forEach((e=>{const t=this.cachedCategorySettings.get(e)||{},i=n[e]||{},o=this.getKeysForUpdatedSettingsInCategory(t,i);o.length>0&&(a[e]=o,this.cachedCategorySettings.set(e,i))})),this.logger.log(`Settings updated for categories: ${Object.keys(a).join(", ")}`),(0,W.isEqual)(t,this.allCachedCategorySettings)||this.behaviorSubjectForAnySettingsChangeForCdlWorker.next();const o=this.scenarioFactory?.newScenario(H.RG.SettingsChangedNotificationSync);try{this.getObservedCategories().forEach((e=>{const t=this.createOrGetBehaviorSubjectFromCache(e),i=n[e]||{},r=a[e]||[];0!==r.length&&(this.logger.log(`Notifying subscribers of: '${e}', settings are changed.`),t.next(i),o?.mark(H.ck.SettingsChangedNotificationSyncCategoryNotified,{category:e,selectedSettings:!1}),this.getOrCreateFilteredSubject(e).next(r,i),o?.mark(H.ck.SettingsChangedNotificationSyncCategoryNotified,{category:e,selectedSettings:!0}))}))}finally{o?.stop()}},this.logger=t.newLogger(`CoreSettings/Service(${e})`,"core-services-settings"),this.ruleEngine=new Jm,this.logger.log("Created."),this.cdlWorkerSettingsAllowlist=n}cleanup(){this.logger.log("Cleaning up."),this.providerSubscriptions.forEach((e=>e.unsubscribe())),this.categoryBehaviorSubjectMap.clear(),this.perCategoryFilteredSubjects={}}get(e,t){const n=this.cachedCategorySettings.get(e);if(n)return n;const i=this.getLatestSettingsForCategory(e);return this.cachedCategorySettings.set(e,i),this.logger.log(`Creating cache for '${e}' category.`),i}getObservable(e,t){const n=this.createOrGetBehaviorSubjectFromCache(e);return this.enableFilteredSettingsSubject&&void 0!==t?this.getOrCreateFilteredSubject(e).getObservable(t):n.asObservable()}getCdlWorkerSettingsAllowlist(){return this.cdlWorkerSettingsAllowlist}getAllCachedSettings(){const e=this.getCdlWorkerAllowlistCategories(),t=Object.keys(this.allCachedCategorySettings),n=e.filter((e=>!t.includes(e)));if(n.length>0){this.logger.log(`getAllCachedSettings(): Missing needed CDL Worker categories from allCachedCategorySettings, missing categories: ${n.join(", ")}`);const{allSettings:e}=this.getLatestSettingsForCategories(n);this.allCachedCategorySettings={...this.allCachedCategorySettings,...e}}return this.allCachedCategorySettings}getObservableForAnySettingsChangeForCdlWorker(){return this.behaviorSubjectForAnySettingsChangeForCdlWorker.asObservable()}registerProvider(e,t){this.ruleEngine.registerProvider(e,t);const n=e.subscribe(this.notifySettingsChanged);this.providerSubscriptions.push(n)}setScenarioFactory(e){this.scenarioFactory=e}readEnableFilteredSettingsSubject(){this.enableFilteredSettingsSubject=!!this.getLatestSettingsForCategory(b.J.Core).enableFilteredSettingsSubject}createOrGetBehaviorSubjectFromCache(e){let t=this.categoryBehaviorSubjectMap.get(e);if(!t){const n=this.get(e);t=new r.X(n),this.categoryBehaviorSubjectMap.set(e,t),this.logger.log(`Creating subject for '${e}' category.`)}return t}getOrCreateFilteredSubject(e){let t=this.perCategoryFilteredSubjects[e];return void 0===t&&(t=new Qm(this.get(e)),this.perCategoryFilteredSubjects[e]=t),t}getLatestSettingsForCategory(e){const{filteredSettings:t,allSettings:n}=this.getLatestSettingsForCategories([e]);return this.allCachedCategorySettings={...this.allCachedCategorySettings,...n},t[e]||{}}getLatestSettingsForCategories(e){e.includes(b.J.Core)||e.push(b.J.Core);const t=this.ruleEngine.getSettings(e),n=t[b.J.Core]?.forwardCdlWorkerSettingsOverrides||[],i=this.getCategoriesAndSettingsToFilterOut(n,this.cdlWorkerSettingsAllowlist);return{filteredSettings:Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(0,W.omit)(t,i[e]||[])]))),allSettings:t}}getKeysForUpdatedSettingsInCategory(e,t){return(0,W.reduce)(t,((t,n,i)=>(0,W.isEqual)(n,e[i])?t:t.concat(i)),[])}getObservedCategories(){let e=Array.from(this.categoryBehaviorSubjectMap.keys());return e=e.concat(Object.keys(this.perCategoryFilteredSubjects)),e=Array.from(new Set(e)),e}getCdlWorkerAllowlistCategories(){if(void 0===this.cdlWorkerSettingsAllowlist)return[];const{cdlWorkerOnly:e={},forwardToCdlWorker:t={}}=this.cdlWorkerSettingsAllowlist,n=(this.get(b.J.Core)?.forwardCdlWorkerSettingsOverrides||[]).map((e=>e.category));return[...new Set([...Object.keys(e),...Object.keys(t),...n])]}getCategoriesAndSettingsToFilterOut(e,t){const n={},i=t?.cdlWorkerOnly||{};return Object.keys(i).forEach((e=>{n[e]=[...n[e]||[],...i[e]||[]]})),e.forEach((e=>{const t=e.category,i=e.featureFlag,a=e.hideFromMainThread??!1,o=new Set([...n[t]||[]]);a?o.add(i):o.delete(i),n[t]=[...o]})),n}}class Ym{constructor(e,t){this.coreSettingsContext=t,this.providers=[],this.logsProviderName="CoreSettingsLogsProvider",this.logger=e.newLogger("CoreSettingsLogsProvider","core-services-settings")}async getLogsFiles(){return[{isPiiFree:!1,fileName:"settings.json",content:await this.getCurrentSettingsSnapshot()||"Could not fetch settings"}]}registerProvider(e,t){this.providers.push({provider:e,type:t})}async getCurrentSettingsSnapshot(){try{const e=await this.coreSettingsContext.getDebugService(),t=e.getSettings(!0),n=new Map;this.providers.forEach((({provider:e})=>{const t=e.getDiagnosticsInfo();t&&n.set(e.providerName,t)}));const i={settings:this.getGroupedSettings(t),rawPolicies:e.getRawPolicies()||"",providersInfo:[...n.entries()]};return JSON.stringify(i)}catch(e){this.logger.error("Diagnostics: Failed to get settings snapshot: ",e)}return""}getGroupedSettings(e){if(!e||0===e.length)return"";const t=e.reduce(((e,t)=>{if(void 0===t.value&&(!t.providers||0===t.providers.length))return e;e[t.category]=e[t.category]||{},e[t.category][t.key]={};let n=!1;return t.providers?.forEach((i=>{e[t.category][t.key][i.shortName]=i.value,(0,W.isEqual)(t.value,i.value)||(n=!0)})),n&&t.providers&&(t.providers.length>1||void 0===t.value)&&(e[t.category][t.key].value=void 0===t.value?"undefined":t.value),e}),{});return t}}!function(e){e[e.Valid=0]="Valid",e[e.Expired=1]="Expired",e[e.NoData=2]="NoData",e[e.NoCache=3]="NoCache"}(qm||(qm={}));class Xm{constructor(){this.callbacks=[]}subscribe(e){if(!(0,W.isFunction)(e))throw Error("Callback is not a valid function.");const t=this;t.callbacks.push(e);return{unsubscribe:()=>{const n=t.callbacks.indexOf(e);n>=0&&t.callbacks.splice(n,1)}}}getRawSettings(){}getDiagnosticsInfo(){}cleanup(){}notifySettingsChanged(e){this.callbacks.forEach((t=>t(e)))}}function Zm(e,t,n){const i={};return(0,W.forOwn)(e,((e,a)=>{const o={};(0,W.forOwn)(e,((e,i)=>{(0,W.forEach)(e,(e=>!function(e,t){let n=!0;return(0,W.forOwn)(e,((e,i)=>{const a=(0,W.get)(t,i),o=(0,W.isNil)(a)||a instanceof Array&&0===a.length;return null==e?(n=n&&o,n):(o||(a instanceof Array?a.length>0&&(n=n&&a.includes(e)):n=n&&a===e),n)})),n}(t,e)||(o[i]=e.value,!1))),!o[i]&&n&&(o[i]=!1)})),o&&!(0,W.isEmpty)(o)&&(i[a]=o)})),i}class ep extends Xm{constructor(e,t,n,i,a){super(),this.providerName=e,this.configs=t,this.platformService=n,this.logger=a.newLogger("CoreSettings/ConfigProviderDynamic","core-services-settings"),this.applyFiltersAndNotify(),i&&this.setClientPreferences(i)}cleanup(){this.clientPreferencesSubscription?.unsubscribe()}getSettings(){return this.settings||{}}setLocale(e){this.locale=e,this.applyFiltersAndNotify()}setClientPreferences(e){const t=this.settings?.core?.enableLowPerformanceModeCoreSettingsFilter;t&&(this.clientPreferencesSubscription&&this.clientPreferencesSubscription.unsubscribe(),this.clientPreferencesSubscription=e.getPreferenceObservable("performance").subscribe((({mode:e})=>{this.currentPerformanceMode=e,this.applyFiltersAndNotify()})))}applyFiltersAndNotify(){const e=this.getFilters(),t=Zm(this.configs,e);this.logger.log("Filters:",e),this.logger.log("Filtered settings:",t),this.settings?(0,W.isEqual)(this.settings,t)||(this.settings=t,this.notifySettingsChanged()):this.settings=t}getFilters(){const{ecsOverrides:{environment:e},config:{platformId:t,vdi:n,osPlatform:i,buildType:a,isPwa:o}}=this.platformService;return{buildType:a,environment:e,locale:this.locale,isPwa:o,os:i,performanceMode:this.currentPerformanceMode,platform:t,virtualization:n?.configFilter}}}const tp=e=>e!==Fe.pk.VeryActive;function np(e,t,n,i){let a;const o=()=>{a?.unsubscribe(),a=void 0,s?.cancel()},r=n=>{e(n),o(),t.debug("Notified about settings change")},s=(0,W.throttle)(((e,n)=>{tp(e)?r(n):t.log("Throttle executed with VeryActive state, waiting for next state change")}),i||0,{leading:!1,trailing:!0}),l=e=>!n||tp(n.getState())?(r(e),!0):(a||(a=n.observe().subscribe((n=>{tp(n)&&!i?r(e):i&&(t.log("Throttled function called"),s(n,e))}))),t.log(`Postponed settings change notification due to client state being ${Fe.pk[n.getState()]}`),!1);return l.cancel=o,l}class ip extends Xm{constructor(e,t,n,i,a){super(),this.settings={},this.providerName="HostProvider",this.logger=t.newLogger("CoreSettings/HostProvider","core-services-settings"),n?(this.logger.log("Host settings found."),this.updateSettingsAndCheckForChanges(n)):this.logger.log("No host settings found."),this.notifySettingsChangedDeferred=np((()=>this.notifySettingsChanged()),this.logger,i,a),e.opener?.addEventListener(O.rY.UpdateWindowState,(e=>{if(e?.payload){let t=e.payload;e.payload?.hostSettings?.hostSettings&&(t=e.payload.hostSettings),this.logger.log("Host settings update received, payload:",t),this.updateSettingsAndCheckForChanges(t)&&this.notifySettingsChangedDeferred()}}))}getSettings(){return this.settings}cleanup(){super.cleanup(),this.notifySettingsChangedDeferred.cancel()}updateSettingsAndCheckForChanges(e){const t={...this.settings.host},n={...this.settings.metadata};e.hostSettings&&Object.assign(t,e.hostSettings),e.desktopSettings&&Object.assign(t,e.desktopSettings),this.updateSettings(t,n,e);const i={[b.J.Host]:t,[b.J.Metadata]:n};return(0,W.isEqual)(this.settings,i)?(this.logger.log("Host settings did not change."),!1):(this.settings=i,this.logger.log("Host settings updated to:",this.settings),!0)}updateSettings(e,t,n){if(n.bootstrapData&&(e.authBootstrapData=n.bootstrapData),n.hostSettings?.hostETag&&(t.hostETag=n.hostSettings.hostETag),n.dataLayerSettings){const t=n.dataLayerSettings,i=t.query||[],a=t.mutation||[],o=t.subscription||[];e.dataLayerSettings={query:i,mutation:a,subscription:o}}}}const ap=e=>"localMigratedSettings"===e.name,op=(e,t)=>{if(null==e)return{};if("string"!=typeof e)return t.errorNoPii?.(`Failed to parse localMigratedSettings. Type is not string, got ${typeof e}.`),{};let n;try{n=JSON.parse(e)}catch{return t.errorNoPii?.("Failed to parse localMigratedSettings. Value is not valid JSON."),{}}const i={chatDensity:dp(n),language:rp(n,"language"),messagePreviewShown:mp(n),performanceMode:up(n),callingSelectedDevices:gp(n,"calling_selected_devices"),callingSelectedCameraDevice:gp(n,"calling_selected_camera_device"),callingSelectedSpeakerDevice:gp(n,"calling_selected_speaker_device"),callingSelectedMicrophoneDevice:gp(n,"calling_selected_microphone_device"),callingSelectedSecondaryRingerDevice:gp(n,"calling_selected_secondary_ringer_device"),agcEnabled:sp(n,"agcEnabled"),autoAdjustEnabled:sp(n,"call.setAutoAdjust"),hfmmEnabled:sp(n,"hfmmEnabled"),ignoreMirrorMyVideoSettingsSelected:sp(n,"ignoreMirrorMyVideoSettingsSelected"),noiseSuppressionMode:pp(n),touchUpEnabled:sp(n,"call.setTouchUp"),touchUpStrength:lp(n,"call.setTouchUpStrength"),spatialAudioEnabled:sp(n,"spatialAudioEnabled"),ttyEnabled:sp(n,"ttyEnabled"),cachedImage:hp(n,"cachedImage"),reservedMetadata:yp(n)};return(0,W.omitBy)(i,W.isUndefined)},rp=(e,t)=>{const n=e[t];return"string"==typeof n?n:void 0},sp=(e,t)=>{const n=e[t];return"boolean"==typeof n?n:"string"==typeof n?"true"===n:void 0},lp=(e,t)=>{const n=e[t];return"number"==typeof n&&Number.isFinite(n)?n:void 0},cp=(e,t)=>{const n=e[t];try{return"string"==typeof n?new Date(n).toISOString():void 0}catch{return}},dp=e=>{switch(e.chatDensity){case"comfy":return"Comfy";case"compact":return"Compact";default:return}},up=e=>{switch(e.performanceMode){case"Normal":return"Normal";case"Low":return"Low";default:return}},mp=e=>{switch(e.messagePreviewsShown){case"default":return"Default";case"show-previews":return"ShowPreviews";case"hide-previews":return"HidePreviews";default:return}},pp=e=>{switch(e.noiseSuppressionMode){case"Off":return"Off";case"Auto":return"Auto";case"Low":return"Low";case"High":return"High";case"Pns":return"Pns";case"HeadsetNS":return"HeadsetNS";default:return}},gp=(e,t)=>{const n=(0,W.pickBy)(e[t],((e,t)=>["microphone","speaker","camera","audioIngestDevice"].includes(t)&&"string"==typeof e));return Object.keys(n).length>0?n:void 0},hp=(e,t)=>{const n=(0,W.pickBy)(e[t],((e,t)=>["imageId","path","imageSrc"].includes(t)&&"string"==typeof e));return Object.keys(n).length>0?n:void 0},yp=e=>{if(!e.reservedMetadata)return;const t=e.reservedMetadata,n=(0,W.omitBy)({version:lp(t,"version"),correlationId:rp(t,"correlationId"),created:cp(t,"created"),reason:vp(t)},W.isUndefined);return Object.keys(n).length>0?n:void 0},vp=e=>{switch(rp(e,"reason")){case"pear-app-install":return"PearAppInstall";case"direct-install":return"DirectInstall";default:return}};class fp extends Xm{constructor(e,t){super(),this.host=e,this.settings={},this.providerName="LocalMigratedSettingsProvider",this.logger=t.newLogger("CoreSettings/LocalMigratedSettingsProvider","core-services-settings"),this.loadLocalMigratedSettings()}loadLocalMigratedSettings(){const e=this.host.localStorage.getItem("tmp.localMigratedSettings"),t=op(e,this.logger);this.settings={[b.J.LocalMigrated]:{...t}},this.notifySettingsChanged()}getSettings(){return this.settings}}class Sp extends Xm{constructor(e){super(),this.settings={},this.providerName="MaglevHostProvider",this.logger=e.newLogger("CoreSettings/MaglevHostProvider","core-services-settings")}async initialize(e){const{windowsInsiderChannel:t,windowsInsiderRing:n,installedThroughAppSwitcher:i}=await this.getHostSettings(e),{hostCapabilitiesSettings:a,localMigratedSettings:o}=await this.fetchHostInitialCapabilities(e);this.settings={[b.J.Host]:{windowsInsiderChannel:t,windowsInsiderRing:n,installedThroughAppSwitcher:i},[b.J.HostCapabilities]:{...a},[b.J.LocalMigrated]:{...o}},this.notifySettingsChanged()}async onPreWarm(e){try{const t=await e.loadModule("m365link"),n=await(t?.isBrowserPreferenceEnabled?.()),i=await this.getHostCapabilities(e),a=await this.getMemoryInfo(e);this.mergeSettings({[b.J.Host]:{enableM365LinksSettings:n},[b.J.HostCapabilities]:{...i},[b.J.Calling]:{totalMemoryInBytes:a}}),t?.registerForIsBrowserPreferenceEnabled?.((e=>{this.mergeSettings({[b.J.Host]:{enableM365LinksSettings:e}})}))}catch(e){this.logger.warn("Unable to get host settings post alt:",e)}}getSettings(){return this.settings}mergeSettings(e){this.settings={[b.J.Host]:{...this.settings.host,...e.host},[b.J.HostCapabilities]:{...this.settings.hostCapabilities,...e.hostCapabilities},[b.J.Calling]:{...this.settings.calling,...e.calling}},this.notifySettingsChanged()}async getHostSettings(e){let t;try{if(t=await e.loadModule("ecs"),t?.getHostSettings)return await(t?.getHostSettings())}catch(e){this.logger.warn("Unable to get host settings:",e)}return{}}async fetchHostInitialCapabilities(e){const t=[];try{const n=await e.loadModule("hostcapabilities"),i=await(n?.getInitialCapabilities?.());i&&t.push(...i)}catch(e){this.logger.warn("Unable to get host capabilities settings:",e)}let n=t.filter((e=>!ap(e))).reduce(((e,t)=>(Object.assign(e,{[t.name]:t.value}),e)),{});const i=t.find((e=>ap(e)))?.value;return n={...n,fullLaunchIntent:await this.getFullLaunchIntent(e)},{hostCapabilitiesSettings:n,localMigratedSettings:op(i,this.logger)}}async getFullLaunchIntent(e){let t="";try{const n=await e.loadModule("telemetry"),i=await(n?.getContext?.({columns:["launchIntent"]}));if(i&&0!==i.length){t=i.reduce(((e,t)=>({...e,[t.column]:t.value})),{}).launchIntent}}catch(e){this.logger.warn("Unable to get launch intent with full name:",e)}return t}async getHostCapabilities(e){try{const t=await e.loadModule("hostcapabilities"),n=["crossCloudMeetingEnabled","hardwareAccelerationAvailable","isLowSpecDevice","isThirdPartyDevicesManagerEnabled","installedThroughAppSwitcher","storagePartition","phoneLinkingBlocked","windowsInsiderChannel","windowsInsiderRing","t1AppSwitcherEffectivePolicy","t1AppSwitcherCohort"];return(await(t?.getCapabilities?.(n))??[]).reduce(((e,t)=>(Object.assign(e,{[t.name]:t.value}),e)),{})}catch(e){this.logger.warn("Unable to get host capabilities settings:",e)}return{}}async getMemoryInfo(e){try{const t=await e.loadModule("osutils"),n=await(t?.getSystemMemoryInfo?.()),i=Number(n?.totalPhysicalMemoryBytes);return isNaN(i)?void 0:i}catch(e){this.logger.warn("Unable to get memory info:",e)}}}class kp extends Xm{constructor(e,t,n){super(),this.loggerFactory=e,this.configLoader=t,this.resolutionStrategy=n,this.settings={},this.providerName="ClientFiltersProvider",this.logger=this.loggerFactory.newLogger("CoreSettings/ClientFiltersProvider","core-services-settings")}initialize(e){this.settings=this.filterSettings(e),this.notifySettingsChanged()}getSettings(){return this.settings}filterSettings(e){const t=Zm(this.configLoader(this.getConfigFileName()),e,this.resolutionStrategy===Gm.Merge);return this.logger.debug(`Calculated client ${this.resolutionStrategy} filters for ${(0,$.u4)(e)}:`,t),t}getConfigFileName(){switch(this.resolutionStrategy){case Gm.Merge:return"clientFiltersMerge";case Gm.Override:default:return"clientFiltersOverride"}}}const Cp="tmp";var bp;function wp(e){return[Cp,e.experienceName,e.userId,e.tenantId,e.environment,e.ring,e.virtualization,e.type].filter((e=>!(0,W.isNil)(e))).join(".")}!function(e){e.TestOverrides="settings",e.EcsCache="ecs-settings-cache",e.PolicyCache="policy-cache"}(bp||(bp={}));const Tp="CachedProvider";class Ip extends Xm{constructor(e,t,n){super(),this.storage=e,this.options=n,this.providerName=Tp,this.logger=t.newLogger("CoreSettings/CachedProvider","core-services-settings")}async initialize(){this.settings=await this.loadCache()}async setProvider(e){this.cleanup(),this.provider=e,this.providerName=`${Tp}:${this.provider.providerName}`,this.subscription=this.provider.subscribe((e=>this.updateCache(e))),await this.updateCache()}getProvider(){return this.provider}getSettings(){return this.settings}getDiagnosticsInfo(){return this.provider?this.provider.getDiagnosticsInfo():super.getDiagnosticsInfo()}get cacheState(){return this.getCacheState()}async cleanup(e=!1){this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),this.providerName=Tp,this.provider?.cleanup(),e&&this.storage.removeItem(this.getStorageKey())}getCacheState(){return this.settings?qm.Valid:qm.NoData}getStorageKey(){if(!this._storageKey){if(!this.options)throw new Error("No storage options are passed to the CachedProvider.");this._storageKey=wp(this.options)}return this._storageKey}async updateCache(e){if(!this.provider)return;const t=e?.settings??this.provider.getSettings(),n=this.getStorageKey();t&&0!==Object.keys(t).length?(this.settings=t,await this.storage.setItem(n,JSON.stringify(this.settings)),this.logger.log(`Cache '${n}' updated.`),this.notifySettingsChanged()):this.logger.log(`Got empty settings from provider. Cache State: ${qm[this.cacheState]} (Storage key: ${n})`)}async loadCache(){let e;const t=this.getStorageKey();try{const n=await this.storage.getItem(t);n?(e=JSON.parse(n),this.logger.log(`Cache successfully loaded: ${t}`)):this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}return e}}class Np extends Ip{constructor(e,t,n){super(e,t,n)}getExpiration(){const e=this.settings?.metadata?.expires;return e&&!isNaN(Date.parse(e))?new Date(e):void 0}getCacheState(){if(!this.settings)return qm.NoData;const e=this.getExpiration();return e&&e.valueOf()>Date.now()?qm.Valid:qm.Expired}}var Ep=n(452772),Ap=n(346584),_p=n(752709),Fp=n(472930);function Dp(e){return e.replace(/-([a-z])/g,((e,t)=>t.toUpperCase())).replace(/^[a-z]/,(e=>e.toUpperCase()))}const Pp="CoreSettings/EcsClientProvider";class Mp extends Xm{constructor(e,t,n){super(),this.loggerFactory=n,this.providerName="EcsClientProvider",this.clientStarted=!1,this.onEcsClientConfigurationFetch=e=>{if(!this.fetchProps)throw new Error("Must call initializeClient() before fetching");const{incompleteBootAttemptsCounter:t,notifySettingsChangedDeferred:n,scenarioFactory:i}=this.fetchProps;this.handleEcsConfigurationData(e,this.createScenario(!1,i),t,n)},this.logger=this.loggerFactory.newLogger(Pp,"core-services-settings"),this.cacheOptions={storage:e,partitionBy:Ep.F4.ConsumerKey,consumerKey:wp(t)}}async initializeLocal(){this.ecsClient=await(0,Ap.un)({serviceName:Pp,cacheOptions:this.cacheOptions,loggerFactory:this.loggerFactory})}async initializeClient(e,t,n,i,a,o,r,s,l){switch(this.fetchProps={ecsParameters:e,host:n,scenarioFactory:r,incompleteBootAttemptsCounter:s,notifySettingsChangedDeferred:np((e=>this.notifySettingsChanged(e)),this.logger,i,t.get(b.J.Core).ecsNotifySettingsChangedDelayInMs)},this.ecsClient?.clientType){case"EcsClient":return!1;case"LocalEcsClient":return this.ecsClient=this.ecsClient.createClient({ecsParameters:e,endpointsManager:o,loggerFactory:this.loggerFactory,fetchPrecheck:this.fetchPrecheck(i,a).bind(this),transformData:this.transformDataToSettings.bind(this,l,t.get(b.J.Core).TeamsBuildNamespace)}),!0;default:return this.ecsClient=await(0,Ap.fh)({serviceName:Pp,cacheOptions:this.cacheOptions,loggerFactory:this.loggerFactory,ecsParameters:e,endpointsManager:o,fetchPrecheck:this.fetchPrecheck(i,a).bind(this),transformData:this.transformDataToSettings.bind(this,l)}),!0}}async startClient(e){if("EcsClient"!==this.ecsClient?.clientType||!this.fetchProps)throw new Error("Must call initializeClient() before startClient()");let t=!0;const n=this.fetch(!0);return e&&(t=await n),this.ecsClient.startFetchSchedule(this.fetchProps.host,this.onEcsClientConfigurationFetch),this.clientStarted=!0,t}getClientType(){return this.ecsClient?.clientType}getCacheState(){return this.ecsClient?this.ecsClient.cacheState:qm.NoCache}getSettings(){return this.ecsClient?.get()?.ecsConfiguration}async updateParametersAndFetch(e){if("EcsClient"!==this.ecsClient?.clientType||!this.fetchProps)throw new Error("Must call initializeClient() before updateEcsParameters()");this.fetchProps.ecsParameters={...e};this.ecsClient.updateParameters(this.fetchProps.ecsParameters)?(this.logger.log("Refresh required, manually fetching settings ..."),await this.fetch(!1)):this.logger.log("No refresh required, ECS parameters haven't changed.")}cleanup(){super.cleanup(),this.fetchProps?.notifySettingsChangedDeferred.cancel(),"EcsClient"===this.ecsClient?.clientType&&this.ecsClient.dispose()}async fetch(e){if("EcsClient"!==this.ecsClient?.clientType||!this.fetchProps)throw new Error("Must call initializeClient() before fetching");const{incompleteBootAttemptsCounter:t,notifySettingsChangedDeferred:n,scenarioFactory:i}=this.fetchProps,a=this.createScenario(e,i);try{this.logger.debug("Awaiting manual ECS fetch...");const e=await this.ecsClient.fetch();return this.logger.debug("Manual ECS fetch complete."),this.handleEcsConfigurationData(e,a,t,n)}catch(e){return a.fail({errors:e.message}),this.logger.warn("Manual ECS fetch failed.",e),!1}}handleEcsConfigurationData(e,t,n,i){n.markBootAttemptComplete();let a=!1,o=!1;switch(e.requestStatus){case _p.m.Success:if(!e.ecsConfiguration){t.fail({errors:"Empty ECS configuration"});break}o=i({settings:e.ecsConfiguration}),this.logger.log("Settings updated to:",e.ecsConfiguration),t.stop({size:JSON.stringify(e.ecsConfiguration).length,message:JSON.stringify({settingsUpdated:!0,notified:o})}),a=!0;break;case _p.m.Success_NoChanges:o=i({settings:e.ecsConfiguration}),this.logger.debug("Settings are the same."),t.stop({message:JSON.stringify({settingsUpdated:!1,headersUpdated:!0,notified:o})}),a=!0;break;case _p.m.Abandoned_ClientVeryActive:this.logger.debug("Skipping override settings check due to app being in a very active state."),t.stop({message:"very active"},"abandoned");break;case _p.m.Abandoned_NoNetwork:this.logger.debug("Skipping override settings check due to app being offline."),t.stop({message:"no network"},"abandoned");break;case _p.m.Error_BrowserError:t.stop({errors:`${e.errorMessage} - BrowserError`},"abandoned");break;case _p.m.Error_TimedOut:t.stop({errors:e.errorMessage},"timeout");break;case _p.m.Error_TransformFailed:case _p.m.Error_Unknown:t.fail({errors:e.errorMessage});break;case _p.m.NotStarted:t.fail({errors:"ECS client is in a corrupt state - received a 'NotStarted' request status"});break;default:t.fail({errors:`Received unknown request status value of ${e.requestStatus}`})}return a}fetchPrecheck(e,t){return()=>t&&!1===t.isOnline()?{errorMessage:"Skipping ECS configuration fetch due to app being offline",requestStatus:_p.m.Abandoned_NoNetwork}:!e||e.getState()!==Fe.pk.VeryActive||{errorMessage:"Skipping ECS configuration fetch due to app being very active",requestStatus:_p.m.Abandoned_ClientVeryActive}}createScenario(e,t){const n=t.newScenario(H.RG.EcsProviderFetch);return n.appendEventData({endpointUrl:this.ecsClient?.getDiagnosticInfo().fetchUrl,operation:e?"initial":"refresh",correlationId:n.id,timeSinceCacheExpired:(0,Fp.mN)(this.ecsClient?.expiration)}),n}transformDataToSettings(e,t,n){const{ecsConfiguration:i,headers:a}=n;if(!this.fetchProps)throw new Error("Must call initializeClient() before transforming data");if(!i||!a)throw new Error("Data is missing ecsConfiguration or headers");if((0,W.isNil)(this.fetchProps.ecsParameters.agents))return{...n,ecsConfiguration:{}};let o={};const r=[],s=[],{agents:l=[],criticalAgents:c=[]}=this.fetchProps.ecsParameters;return l.forEach((n=>{const a=c?.includes(n);if(a){const e=i[n];if((0,W.isNil)(e))throw new Error(`ECS configuration is missing configurations for critical namespace '${n}'`);o={...o,...e}}if(n===t){const t=i[n],a=Dp(e),r=t?.BuildSettings?.[a]?.BuildVersion;r&&(o={...o,teamsBuilds:{buildUpdateVersion:r}})}const l=i?.ConfigIDs?.[n];if(l){const e=l.split(",");r.push(...e.filter((e=>e.startsWith("P-E")))),s.push(...e.filter((e=>e.startsWith("P-R"))))}})),o={...o,metadata:{...o.metadata,eTag:a.ETag,expires:a.Expires.toString(),countryCode:a.CountryCode,configIds:{experiments:r,rollouts:s}}},{...n,ecsConfiguration:o}}}class xp extends Xm{constructor(e,t){super(),this.workerHostSettings=t,this.providerName="WorkerHostProvider",this.logger=e.newLogger("CoreSettings/WorkerHostSettingsProvider","core-services-settings"),this.settings={},this.testSettings={},this.logger.log("Worker host settings is initialized",this.settings),t.subscribeToHostSettingsUpdates((async()=>{const e=await t.getHostSettings();this.settings=e.settings,this.testSettings=e.testSettings,this.notifySettingsChanged()}))}async initialize(){const e=await(0,V.E)(this.workerHostSettings.getHostSettings(),1e4).catch((e=>(this.logger.error(`retrieve worker host setting timed out, the error is ${e}`),{settings:{},testSettings:{}})));this.settings=e.settings,this.testSettings=e.testSettings,this.logger.log("Worker host setting is being initialized")}getSettings(){return{...this.settings,[b.J.Test]:this.testSettings}}}class Rp extends Xm{constructor(e,t,n){super(),this.loggerFactory=e,this.configLoader=n,this.providerName="ViewportOverrideProvider",this.logger=this.loggerFactory.newLogger("CoreSettings/ViewportOverrideProvider","core-services-settings"),this.settings=this.filterSettings(t)}getSettings(){return this.settings}hasOverrides(){return!(0,W.isEmpty)(this.settings)}hasDifferences(e){const t=this.filterSettings(e);return!(0,W.isEqual)(this.settings,t)}updateSettings(e){const t=this.filterSettings(e);(0,W.isEqual)(this.settings,t)||(this.settings=t,this.notifySettingsChanged())}filterSettings(e){const t=Zm(this.configLoader("viewportOverrides"),e);return this.logger.debug(`Calculated overrides for ${(0,$.u4)(e)}:`,t),t}}class jp extends Xm{constructor(e,t,n){super(),this.host=e,this.providerName="LocalStorageProvider",this.onStorageEvent=e=>{e.key===this.storageKey&&(this.logger.log("Local storage settings updated."),this.settings=this.loadStorageSettings(),this.notifySettingsChanged())},this.logger=t.newLogger("CoreSettings/LocalStorageProvider","core-services-settings"),this.storageKey=wp(n),this.settings=this.loadStorageSettings(),this.host.addEventListener("storage",this.onStorageEvent)}getSettings(){return this.settings}cleanup(){this.host.removeEventListener("storage",this.onStorageEvent)}setSettings(e){try{this.host.localStorage.setItem(this.storageKey,(0,$.u4)(e))}catch(e){this.logger.log("Could not write settings to local storage, error:",e)}this.settings=e,this.notifySettingsChanged()}clearSettings(){this.host.localStorage.removeItem("tmp.settings"),this.settings={}}loadStorageSettings(){const e=this.host.localStorage.getItem(this.storageKey);if(e)try{return JSON.parse(e)}catch(e){this.logger.log(`Could not parse settings stored in local storage, key: ${this.storageKey}, error: ${e}`)}return{}}}class Lp extends Xm{constructor(e,t){super(),this.clientPreferencesService=e,this.providerName="ClientPreferencesProvider",this.logger=t.newLogger("CoreSettings/ClientPreferencesProvider","core-services-settings"),this.settings=this.loadClientPreferences(),this.setupSubscription()}getSettings(){return this.settings}cleanup(){this.clientPreferencesSubscription?.unsubscribe()}loadClientPreferences(){const e=this.clientPreferencesService.getPreferences("diagnosticsLogs");if(void 0!==e?.shouldPersistLogsIntoIDB)try{return{diagnostics:{clientExtendedDiagnosticsData:!!e?.shouldPersistLogsIntoIDB}}}catch(t){this.logger.log(`Could not parse client preferences, ${e}, error: ${t}`)}return{}}setupSubscription(){const e=this.clientPreferencesService.getPreferenceObservable("diagnosticsLogs");this.clientPreferencesSubscription=e.subscribe((e=>this.clientPreferenceUpdateHandler(e)))}clientPreferenceUpdateHandler(e){!!e?.shouldPersistLogsIntoIDB!=!!this.settings?.diagnostics?.clientExtendedDiagnosticsData&&(this.settings={diagnostics:{clientExtendedDiagnosticsData:!!e?.shouldPersistLogsIntoIDB}},this.notifySettingsChanged())}}class Op extends Xm{constructor(e){super(),this.providerName="ApiServiceProvider",this.logger=e.newLogger(this.providerName,"core-services-settings"),this.settings=this.loadApiSwitcherSettings()}getSettings(){return this.settings}setOverrides(e){this.settings=this.loadApiSwitcherSettings(e),this.notifySettingsChanged()}loadApiSwitcherSettings(e){if(e?.configs&&e?.id)try{const t=e.configs,n=e.id;return{apiService:{serviceConfig:t},auth:this.getAuthOverrides(e.configs),metadata:{serviceId:n}}}catch(e){this.logger.log(`Could not parse settings stored in local storage , error: ${e}`)}return{}}getAuthOverrides(e){return{authzEndpointUrl:e?.authzEndpointUrl,authzUrl:e?.authzEndpointUrl,authzResource:e?.authzResource,regionGtmsEnv:e?.regionGtmsEnv,ic3NonCaeResource:e?.ic3NonCaeResource,ic3CaeResource:e?.ic3CaeResource}}}class $p{constructor(e){this.logger=e.newLogger("CoreSettings/QspSettingsParser","core-services-settings")}parse(e,t={}){return new URLSearchParams(e).forEach(((e,n)=>{const i=this.parseQspSetting(n,e);i&&(this.logger.log("QSP override: ",i.key,i.value),(0,W.set)(t,i.key,i.value))})),t}parseQspSetting(e,t){const n=this.extractQspKeyObject(e);if("config"===n.config)return{key:`${n.category}.${n.featureName}`,value:this.tryGetParsedValueOrReturnOriginalValue(t)}}extractQspKeyObject(e){const t=e.split(".");let n="";for(let e=2;e<t.length;e++)n+=t[e],e<t.length-1&&(n+=".");return{config:t[0],category:t[1],featureName:n}}tryGetParsedValueOrReturnOriginalValue(e){const t=e.toLowerCase();return"true"===t||"false"===t?"true"===t:e.startsWith("[")&&e.endsWith("]")?this.getStringArrayValue(e.substring(1,e.length-1)):encodeURIComponent(e)}getStringArrayValue(e){if(0===e.length)return[];const t=e.split(","),n=[];for(const e of t)n.push(encodeURIComponent(e));return n}}class Up extends Xm{constructor(e,t,n,i){super(),this.host=e,this.platformService=t,this.experienceName=i,this.providerName="QspProvider",this.settings={},(this.platformService.config.isInternalUser||"meeting-options"===this.experienceName)&&(this.parser=new $p(n))}getSettings(){return this.parseQsp(),this.settings}parseQsp(){if(!this.parser)return;const e={};this.host.location.search&&this.parser.parse(this.host.location.search,e);const t=this.getQueryStringFromHash();t&&this.parser.parse(t,e),this.platformService.config.isInternalUser?this.settings=e:"meeting-options"===this.experienceName&&this.populateAllowList(e)}getQueryStringFromHash(){const e=this.host.location.hash;if(!e)return null;const t=e.indexOf("?");return t>-1?e.substr(t):null}populateAllowList(e){const t={};e&&(e.meetingOptions&&(t.meetingOptions={},e.meetingOptions.isClientSideInviteeListSupported&&(t.meetingOptions.isClientSideInviteeListSupported=e.meetingOptions.isClientSideInviteeListSupported),e.meetingOptions.isClientSideSensitivityLabelSupported&&(t.meetingOptions.isClientSideSensitivityLabelSupported=e.meetingOptions.isClientSideSensitivityLabelSupported)),e.host&&(t.host={},e.host.skin&&(t.host.skin=e.host.skin),e.host.headless&&(t.host.headless=e.host.headless),e.host.theme&&(t.host.theme=e.host.theme))),this.settings=t}}var Bp,Wp,Hp=n(507751);!function(e){e.None="0",e.CitrixXenDesktop="1",e.CitrixXenApp="2",e.VMWare="3",e.WVD="5"}(Bp||(Bp={})),function(e){e.none="none",e.windows365="Windows365"}(Wp||(Wp={}));class Vp extends Xm{constructor(e){super(),this.platformService=e,this.providerName="PlatformProvider",this.platformSettings={[b.J.Platform]:{browser:this.getBrowser(),browserVersion:this.platformService.config.browserVersion?.toString(),buildType:this.platformService.config.buildType,buildVersion:this.platformService.config.buildVersion,clientVersion:this.platformService.config.clientVersion,deviceInfo:this.platformService.host.deviceInfo,enableSlotBorderRadius:this.getEnableSlotBorderRadius(),isHtmlInputSelectApiSupported:this.getIsHtmlInputSelectApiSupported(),isOcdi:this.platformService.config.isOcdi,isScreenRecordingPermissionRequired:this.getIsScreenRecordingPermissionRequired(),sessionId:this.platformService.host.sessionId,staticsPath:this.platformService.config.staticsPath,thirdPartyCookieSupport:An.Yv.Unknown,useMacKeyboardLayout:this.getUseMacKeyboardLayout(),vdi:this.getVdiSettings()},[b.J.Metadata]:{environment:this.platformService.ecsOverrides.environment,ring:{id:this.platformService.ecsOverrides.ring},isUserInTargetedRelease:this.getIsUserInTargetedRelease()},[b.J.Host]:{desktopVersion:this.platformService.host.hostAppVersion}}}getSettings(){return this.platformSettings}updateSettings(e){let t={...this.platformSettings.metadata};e.region&&(t={...t,region:e.region});let n={...this.platformSettings.platform};e.bootType&&(n={...n,bootType:e.bootType}),e.localeCode&&(n={...n,localeCode:e.localeCode}),e.thirdPartyCookieSupport&&(n={...n,thirdPartyCookieSupport:e.thirdPartyCookieSupport}),this.platformSettings={...this.platformSettings,[b.J.Platform]:n,[b.J.Metadata]:t},this.notifySettingsChanged()}getBrowser(){const{browser:e}=this.platformService.config;switch(e){case An.AR.Chrome:return"Chrome";case An.AR.Edge:return"Edge";case An.AR.Safari:return"Safari";case An.AR.Firefox:return"Firefox";case An.AR.Electron:return"Electron";default:return"Unknown"}}getVdiSettings(){const{vdi:e}=this.platformService.config;if(e){const{provider:t,mode:n,isAvRemoted:i,configFilter:a,vdiOptimizationMode:o,subProvider:r}=e,s=e=>{switch(e){case Bp.CitrixXenDesktop:return"CitrixXenDesktop";case Bp.CitrixXenApp:return"CitrixXenApp";case Bp.VMWare:return"VMWare";case Bp.WVD:return"WVD";default:return"None"}};return{provider:s(t),subProvider:r,mode:n,isAvRemoted:i,configFilter:a,vdiOptimizationMode:o}}}getIsHtmlInputSelectApiSupported(){return this.platformService.config.osPlatform!==An.NR.IOS}getUseMacKeyboardLayout(){return this.platformService.config.osPlatform===An.NR.Mac}getIsScreenRecordingPermissionRequired(){if(this.platformService.config.platformId===An.us.MaglevMacT21)return!0;if(this.platformService.config.clientType===An.Bh.Web||this.platformService.config.osPlatform!==An.NR.Mac||!this.platformService.config.osVersion)return!1;const e=this.platformService.config.osVersion.toString();return(0,Hp.compare)(e,"10.15",">=")}getEnableSlotBorderRadius(){return this.platformService.config.osPlatform===An.NR.Mac}getIsUserInTargetedRelease(){return"ring3_6"===this.platformService.ecsOverrides.ring&&this.platformService.ecsOverrides.isAssignedRing}}class Gp extends Xm{constructor(e,t){super(),this.workerHostSettings=t,this.providerName="WorkerHostTestOverridesProvider",this.logger=e.newLogger("CoreSettings/WorkerHostTestOverridesProvider","core-services-settings"),this.settings={},t.subscribeToHostSettingsUpdates((async()=>{const e=await t.getHostSettings();this.settings=(0,W.merge)({},e.localStorageTestOverrides,e.qspTestOverrides),this.notifySettingsChanged()}))}async initialize(){const e=await(0,V.E)(this.workerHostSettings.getHostSettings(),1e4).catch((e=>(this.logger.error(`Retrieving worker host setting timed out, the error is ${e}`),{localStorageTestOverrides:{},qspTestOverrides:{}})));this.settings=(0,W.merge)({},e.localStorageTestOverrides,e.qspTestOverrides),this.logger.log("Worker host test overrides setting is being initialized")}getSettings(){return this.settings}}class zp{constructor(e,t,n,i,a,o,r,s,l,c){this.id=e,this.experienceName=t,this.cache=n,this.loggerFactory=i,this.platformService=a,this.clientPreferences=o,this.configLoader=r,this.partitionCacheByExperience=s,this.localStorage=l,this.cdlWorkerSettingsAllowlist=c,this.initialStateHints={primaryUserHadPolicyCache:!1},this.logger=this.loggerFactory.newLogger(`CoreSettings/Context(${e})`,"core-services-settings"),this.cleanupFunctions=[],this.settingsService=new Km(this.id,this.loggerFactory,this.cdlWorkerSettingsAllowlist),this.cleanupFunctions.push((()=>{this.settingsService.cleanup()})),this.logsProvider=new Ym(this.loggerFactory,this),this.logger.log("Created.")}cleanup(e){this.cache.release(this.id,(()=>{this.logger.log("Cleaning up."),this.cleanupFunctions.forEach((t=>t(e)))}))}getCoreSettings(){return this.settingsService}getLogsProvider(){return this.logsProvider}async getDebugService(){if(!this.debugSettingsService){const{DebugSettingsService:e}=await n.e(226842).then(n.bind(n,343550));this.debugSettingsService=new e(this,this.loggerFactory,this.id)}return this.debugSettingsService}updatePlatformProviderSettings(e){this.platformProvider&&this.platformProvider.updateSettings(e)}updateViewportOverrideProviderSettings(e){this.viewportOverrideProvider&&this.viewportOverrideProvider.updateSettings(e)}setScenarioFactory(e){this.scenarioFactory=e,this.settingsService&&this.settingsService.setScenarioFactory(e)}setLocale(e){this.enableLocaleFilterForFeatureFlags&&(this.locale=e,this.configProvider&&this.configProvider.setLocale(e))}getInitialStateHints(){return this.initialStateHints}registerAllProviders(){this.registerProvider(zm.Configuration,this.configProvider),this.registerProvider(zm.Configuration,this.platformProvider),this.registerProvider(zm.Configuration,this.hostProvider),this.registerProvider(zm.Configuration,this.localMigratedSettingsProvider),this.registerProvider(zm.Configuration,this.maglevHostProvider),this.registerProvider(zm.Configuration,this.workerHostProvider),this.registerProvider(zm.Configuration,this.clientPreferencesProvider),this.registerProvider(zm.Configuration,this.ecsCachedProvider),this.registerProvider(zm.Override,this.clientFiltersOverrideProvider),this.registerProvider(zm.Override,this.viewportOverrideProvider),this.registerProvider(zm.ClientFilters,this.clientFiltersMergeProvider),this.registerProvider(zm.Policy,this.policyCachedProvider),this.registerProvider(zm.TestOverride,this.apiServiceProvider),this.registerProvider(zm.TestOverride,this.localStorageProvider),this.registerProvider(zm.TestOverride,this.qspProvider),this.registerProvider(zm.TestOverride,this.workerTestProvider),this.registerProvider(zm.TestOverride,this.workerHostTestOverridesProvider),this.settingsService.readEnableFilteredSettingsSubject()}registerProvider(e,t){t&&(this.settingsService.registerProvider(t,e),this.getLogsProvider().registerProvider(t,e))}async createConfigProviderForMainThread(){this.configProvider=await async function(e){const t=function(e){const{ecsOverrides:{environment:t}}=e;return`${t}`}(e.platformService),n=await(0,ac.mT)((()=>e.configLoader(t)),"core-settings-base-configs");return new ep("ConfigProviderAsync",n,e.platformService,e.clientPreferences,e.loggerFactory)}({clientPreferences:this.clientPreferences,configLoader:this.configLoader,loggerFactory:this.loggerFactory,platformService:this.platformService}),this.locale&&this.configProvider.setLocale(this.locale),this.cleanupFunctions.push((()=>{this.configProvider?.cleanup()}))}createConfigProviderForCDLWorker(){this.configProvider=function(e){const t=e.configLoader("config");return new ep("ConfigProviderSync",t,e.platformService,e.clientPreferences,e.loggerFactory)}({clientPreferences:this.clientPreferences,configLoader:this.configLoader,loggerFactory:this.loggerFactory,platformService:this.platformService}),this.locale&&this.configProvider.setLocale(this.locale),this.cleanupFunctions.push((()=>{this.configProvider?.cleanup()}))}createHostProvider(e,t){this.hostProvider=new ip(e,this.loggerFactory,t),this.cleanupFunctions.push((()=>{this.hostProvider?.cleanup()}))}createLocalMigratedSettingsProvider(e){this.localMigratedSettingsProvider=new fp(e,this.loggerFactory),this.cleanupFunctions.push((()=>{this.localMigratedSettingsProvider?.cleanup()}))}createMaglevHostProvider(){this.maglevHostProvider=new Sp(this.loggerFactory),this.cleanupFunctions.push((()=>{this.maglevHostProvider?.cleanup()}))}createClientFiltersProviders(){this.clientFiltersMergeProvider=new kp(this.loggerFactory,this.configLoader,Gm.Merge),this.clientFiltersOverrideProvider=new kp(this.loggerFactory,this.configLoader,Gm.Override),this.cleanupFunctions.push((()=>{this.clientFiltersMergeProvider?.cleanup(),this.clientFiltersOverrideProvider?.cleanup()}))}async createEcsCachedProvider(e){const{ring:t,environment:n}=this.platformService.ecsOverrides,i="general"===t?void 0:t,a="prod"===n?void 0:n,o=this.partitionCacheByExperience?this.experienceName:void 0;this.ecsCachedProvider=new Np(e,this.loggerFactory,{type:bp.EcsCache,experienceName:o,ring:i,environment:a,virtualization:this.getVirtualization()}),await this.ecsCachedProvider.initialize(),this.cleanupFunctions.push((()=>{this.ecsCachedProvider?.cleanup()}))}getVirtualization(){return this.platformService.config.clientType===An.Bh.Maglev?this.platformService.config.vdi?.configFilter??void 0:void 0}async createEcsClientProvider(e){const{ring:t,environment:n}=this.platformService.ecsOverrides,i="general"===t?void 0:t,a="prod"===n?void 0:n,o=this.partitionCacheByExperience?this.experienceName:void 0,r={type:bp.EcsCache,experienceName:o,ring:i,environment:a,virtualization:this.getVirtualization()};this.ecsClientProvider=new Mp(e,r,this.loggerFactory),await this.ecsClientProvider.initializeLocal(),this.cleanupFunctions.push((()=>{this.ecsClientProvider?.cleanup()}))}async createWorkerTestProvider(e){this.workerTestProvider=new Ip(e,this.loggerFactory,{type:bp.TestOverrides}),await this.workerTestProvider.initialize(),this.cleanupFunctions.push((()=>{this.workerTestProvider?.cleanup()}))}async createWorkerHostTestOverridesProvider(e){this.workerHostTestOverridesProvider=new Gp(this.loggerFactory,e),await this.workerHostTestOverridesProvider.initialize(),this.cleanupFunctions.push((()=>{this.workerHostTestOverridesProvider?.cleanup()}))}async createWorkerHostProvider(e){this.workerHostProvider=new xp(this.loggerFactory,e),await this.workerHostProvider.initialize(),this.cleanupFunctions.push((()=>{this.workerHostProvider?.cleanup()}))}createViewportOverrideProvider(e){this.viewportOverrideProvider=new Rp(this.loggerFactory,e,this.configLoader),this.cleanupFunctions.push((()=>{this.viewportOverrideProvider?.cleanup()}))}async createPolicyCachedProvider(e,t){this.policyCachedProvider=new Ip(e,this.loggerFactory,{type:bp.PolicyCache,userId:t?.id}),await this.policyCachedProvider.initialize(),this.cleanupFunctions.push((e=>{const t="signout"===e;this.policyCachedProvider?.cleanup(t)}))}createLocalStorageProvider(e){this.localStorageProvider=new jp(e,this.loggerFactory,{type:bp.TestOverrides}),this.cleanupFunctions.push((()=>{this.localStorageProvider?.cleanup()}))}createClientPreferencesProvider(e){this.clientPreferencesProvider=new Lp(e,this.loggerFactory),this.cleanupFunctions.push((()=>{this.clientPreferencesProvider?.cleanup()}))}createApiServiceProvider(){this.apiServiceProvider=new Op(this.loggerFactory),this.cleanupFunctions.push((()=>{this.apiServiceProvider?.cleanup()}))}createQspProvider(e){this.qspProvider=new Up(e,this.platformService,this.loggerFactory,this.experienceName),this.cleanupFunctions.push((()=>{this.qspProvider?.cleanup()}))}createPlatformProvider(e){this.platformProvider=new Vp(e),this.cleanupFunctions.push((()=>{this.platformProvider?.cleanup()}))}populateInitialStateHints(){this.policyCachedProvider?.cacheState===qm.Valid&&(this.initialStateHints.primaryUserHadPolicyCache=!0)}get enableLocaleFilterForFeatureFlags(){const e=this.getCoreSettings(),{enableLocaleFilterForFeatureFlags:t}=e.get(b.J.Core,["enableLocaleFilterForFeatureFlags"]);return!!t}}var qp,Jp,Qp,Kp=n(609930);!function(e){e[e.AbortWhenVeryActive=0]="AbortWhenVeryActive",e[e.ContinueWhenVeryActive=1]="ContinueWhenVeryActive"}(qp||(qp={})),function(e){e[e.Offline=0]="Offline",e[e.Online=1]="Online"}(Jp||(Jp={})),function(e){e.Initializing="Initializing",e.Unrecoverable="Unrecoverable",e.LongInactive="LongInactive",e.Inactive="Inactive",e.Active="Active",e.VeryActive="VeryActive"}(Qp||(Qp={}));class Yp{constructor(e,t,n,i,a,o,r,s=qp.AbortWhenVeryActive){this.host=i,this.applicationStateProvider=o,this.networkStateProvider=r,this.clientVeryActiveMode=s,this.ecsClient=(0,Ap.bn)({serviceName:`TeamsEcsClient-${t}`,ecsParameters:e,loggerFactory:a,endpointsManager:n,fetchPrecheck:this.fetchPreCheck.bind(this)})}updateParameters(e){return this.ecsClient.updateParameters(e)}getDiagnosticInfo(){return{...this.ecsClient.getDiagnosticInfo(),clientVeryActiveMode:this.clientVeryActiveMode,configIds:this.ecsClient.get()?.ecsConfiguration?.ConfigIDs}}async getConfigurationAsync(){return this.ecsClient.fetch()}startWhenExpiredFetchSchedule(e){return this.ecsClient.startFetchSchedule(this.host,e)}stopFetchSchedule(){return this.ecsClient.dispose()}fetchPreCheck(){return this.networkStateProvider&&this.networkStateProvider.getState()!==Jp.Online?{errorMessage:"Skipping ECS configuration fetch due to app being offline",requestStatus:_p.m.Abandoned_NoNetwork}:this.clientVeryActiveMode!==qp.AbortWhenVeryActive||this.applicationStateProvider?.getState()!==Qp.VeryActive||{errorMessage:"Skipping ECS configuration fetch due to app being very active",requestStatus:_p.m.Abandoned_ClientVeryActive}}}class Xp extends Xm{constructor(e,t,n,i,a,o,r,s,l,c,d){super(),this.coreSettings=t,this.loggerFactory=n,this.scenarioFactory=i,this.host=a,this.clientStateProvider=o,this.networkStateProvider=r,this.endpointsManager=s,this.incompleteBootAttemptsCounter=l,this.experienceName=c,this.getExtraScenarioEventData=d,this._isInitialized=!1,this.providerName="EcsProvider",this.onEcsClientConfigurationFetch=e=>{this.handleEcsConfigurationData(e,this.createScenario(!1))};const u=`CoreSettings/${this.providerName}`;this.logger=n.newLogger(u,"core-services-settings"),this.ecsClientFetchMode=Kp.z.Manual,this.ecsParameters={...e},this.ecsClient=new Yp(this.ecsParameters,u,this.endpointsManager,this.host,this.loggerFactory,this.clientStateProvider,this.networkStateProvider,qp.AbortWhenVeryActive),this.notifySettingsChangedDeferred=np((e=>this.notifySettingsChanged(e)),this.logger,o,this.coreSettings.get(b.J.Core).ecsNotifySettingsChangedDelayInMs)}async initialize(e){if(this.isInitialized)return!1;let t=!0;const n=this.performManualFetch(!0);e&&(t=await n);const i=this.coreSettings.get(b.J.Core).ecsProviderFetchMode;if(this.ecsClientFetchMode=(0,Fp.JX)(i)??Kp.z.WhenExpired,this.ecsClientFetchMode!==Kp.z.WhenExpired)throw new Error(`${Kp.z[this.ecsClientFetchMode]} fetch mode is not supported`);return this.ecsClient.startWhenExpiredFetchSchedule(this.onEcsClientConfigurationFetch),this._isInitialized=!0,t}get isInitialized(){return this._isInitialized}getSettings(){return this.settings}getParameters(){return this.ecsParameters}getDiagnosticsInfo(){return this.ecsClient.getDiagnosticInfo()}cleanup(){super.cleanup(),this.notifySettingsChangedDeferred.cancel(),this.ecsClient.stopFetchSchedule()}async updateEcsParametersAndFetchSettings(e){this.ecsParameters={...e};this.ecsClient.updateParameters(e)?this.isInitialized?(this.logger.log("Refresh required, manually fetching settings ..."),await this.performManualFetch(!1)):this.logger.log("Refresh required but provider not initialized, skipping settings fetch."):this.logger.log("No refresh required, ECS parameters haven't changed.")}async performManualFetch(e){const t=this.createScenario(e);try{this.logger.debug("Awaiting manual ECS fetch...");const e=await this.ecsClient.getConfigurationAsync();return this.logger.debug("Manual ECS fetch complete."),this.handleEcsConfigurationData(e,t)}catch(e){return this.appendExtraScenarioEventData(t),t.fail({errors:e.message}),this.logger.warn("Manual ECS fetch failed.",e),!1}}notifyEcsFetchComplete(){this.incompleteBootAttemptsCounter.markBootAttemptComplete()}appendExtraScenarioEventData(e){const t=this.getExtraScenarioEventData?.();t&&e.appendEventData(t)}handleEcsConfigurationData(e,t){this.notifyEcsFetchComplete(),this.appendExtraScenarioEventData(t);let n=!1,i=!1;switch(e.requestStatus){case _p.m.Success:if(!e.ecsConfiguration||!e.headers){t.fail({errors:"Empty headers or ECS configuration"});break}try{this.settings=this.extractSettings(e.ecsConfiguration,e.headers)}catch(e){t.fail({errors:`Extracting settings failed - ${e?.message||"unknown error"}`});break}i=this.notifySettingsChangedDeferred({settings:this.settings}),this.logger.log("Settings updated..."),t.stop({size:JSON.stringify(e.ecsConfiguration).length,message:JSON.stringify({settingsUpdated:!0,notified:i})}),n=!0;break;case _p.m.Success_NoChanges:if(!e.headers){t.fail({errors:"Empty headers"});break}this.settings={...this.settings,metadata:{...this.settings?.metadata,expires:e.headers.Expires.toString()}},i=this.notifySettingsChangedDeferred({settings:this.settings}),this.logger.debug("Settings are the same."),t.stop({message:JSON.stringify({settingsUpdated:!1,headersUpdated:!0,notified:i})}),n=!0;break;case _p.m.Abandoned_ClientVeryActive:this.logger.debug("Skipping override settings check due to app being in a very active state."),t.stop({message:"very active"},"abandoned");break;case _p.m.Abandoned_NoNetwork:this.logger.debug("Skipping override settings check due to app being offline."),t.stop({message:"no network"},"abandoned");break;case _p.m.Error_BrowserError:t.stop({errors:`${e.errorMessage} - BrowserError`},"abandoned");break;case _p.m.Error_TimedOut:t.stop({errors:e.errorMessage},"timeout");break;case _p.m.Error_TransformFailed:case _p.m.Error_Unknown:t.fail({errors:e.errorMessage});break;case _p.m.NotStarted:t.fail({errors:"ECS client is in a corrupt state - received a 'NotStarted' request status"});break;default:t.fail({errors:`Received unknown request status value of ${_p.m[e.requestStatus]}`})}return n}createScenario(e){const t=this.scenarioFactory.newScenario(H.RG.EcsProviderFetch);return t.appendEventData({endpointUrl:this.ecsClient.getDiagnosticInfo().fetchUrl,operation:e?"initial":"refresh",correlationId:t.id}),t}extractSettings(e,t){if((0,W.isNil)(this.ecsParameters.agents))return{};let n={};const i=[],a=[],{TeamsBuildNamespace:o}=this.coreSettings.get(b.J.Core),{agents:r=[],criticalAgents:s=[]}=this.ecsParameters;return r.forEach((t=>{const r=s?.includes(t);if(r){const i=e[t];if((0,W.isNil)(i))throw new Error(`ECS payload is missing configurations for critical namespace '${t}'`);n={...n,...i}}if(t===o){const i=e[t],a=Dp(this.experienceName),o=i?.BuildSettings?.[a]?.BuildVersion;o&&(n={...n,teamsBuilds:{buildUpdateVersion:o}})}const l=e?.ConfigIDs?.[t];if(l){const e=l.split(",");i.push(...e.filter((e=>e.startsWith("P-E")))),a.push(...e.filter((e=>e.startsWith("P-R"))))}})),n={...n,metadata:{...n.metadata,eTag:t.ETag,expires:t.Expires.toString(),countryCode:t.CountryCode,configIds:{experiments:i,rollouts:a}}},n}}class Zp extends Xm{constructor(e,t,n,i){super(),this.policiesDataProvider=t,this.configLoader=n,this.enablePoliciesDefaultValues=i,this.providerName="PolicyProvider",this.refreshSettings=e=>{this.rawPolicies=e;const t=this.policySettings,n=this.mapPoliciesToSettings(e);if(this.enablePoliciesDefaultValues){const e=(0,W.cloneDeep)(this.policySettingsDefaults);this.policySettings=(0,W.mergeWith)(e,n,su.g)}else this.policySettings=n;(0,W.isEqual)(t,this.policySettings)?this.logger.log("No changes detected."):(this.logger.log("Policy settings updated..."),this.notifySettingsChanged())},this.logger=e.newLogger("CoreSettings/PolicyProvider","core-services-settings"),this.policiesDataProvider.subscribeForSettingsUpdates(this.refreshSettings),this.policySettingsDefaults={},this.rawPolicies={}}async initialize(){this.policiesJson=this.configLoader("policies").mappings,this.enablePoliciesDefaultValues&&this.policiesJson&&(this.policySettingsDefaults=this.getPolicySettingsDefaults(this.policiesJson),this.policySettings=(0,W.cloneDeep)(this.policySettingsDefaults),this.logger.log("Loaded default for policies settings...")),await this.policiesDataProvider.initialize(!0),this.logger.log("Initial fetch completed.")}getSettings(){return this.policySettings}getRawSettings(){return this.rawPolicies}cleanup(){this.policiesDataProvider.cleanup()}getPolicySettingsDefaults(e){const t={};return Object.keys(e).map((e=>{const n={},i=(0,W.get)(this.policiesJson,e);Object.keys(i).map((e=>{const t=(0,W.get)(i,e);if(t&&(0,W.has)(t,"defaultValue")){const i=(0,W.get)(t,"defaultValue");(0,W.set)(n,e,i)}})),(0,W.set)(t,e,n)})),t}mapPoliciesToSettings(e){const t={};return this.policiesJson&&Object.keys(this.policiesJson).map((n=>{const i={},a=(0,W.get)(this.policiesJson,n);Object.keys(a).map((t=>{const n=(0,W.get)(a,t);if(n&&(0,W.has)(n,"name")){const a=(0,W.get)(n,"name"),o=(0,W.get)(e,a);(0,W.set)(i,t,o)}})),(0,W.set)(t,n,i)})),t}}class eg{constructor(e){this.host=e}setItem(e,t){return this.host.localStorage.setItem(e,t),Promise.resolve()}getItem(e){const t=this.host.localStorage.getItem(e);return Promise.resolve(t)}removeItem(e){return this.host.localStorage.removeItem(e),Promise.resolve()}}const tg=["EducationStudent","EducationFaculty","SmbLicense"],ng=["A1","A3","A5","Other"];function ig(e,t,n){const i=function(e,t){let n,i;const{isTeamsSmb:a,eduLicenseSkuAndCategory:o,region:r}=e,s=r?.toLowerCase();if(a&&t)i="SmbLicense";else if(o&&o.trim().length>0&&o.includes("_")){const[e,t]=o.split("_");e&&t&&ng.find((t=>t===e))&&tg.find((e=>e===t))&&(n=e,i=t)}return{userLicenseSku:n,userLicenseCategory:i,region:s}}(e,t);return{...i,...n}}class ag{constructor(e){this.cacheMap=new Map,this.logger=e.newLogger("CoreSettings/ContextCache","core-services-settings")}cache(e,t){if(this.cacheMap.has(e))throw new Error(`Context '${e}' already stored.`);this.cacheMap.set(e,{context:t,refCount:1}),this.logger.debug(`Context '${e}' cached.`)}acquire(e,t){const n=this.cacheMap.get(e);if(n)return n.refCount++,this.logger.debug(`Acquiring context '${e}', ref count: '${n.refCount}'.`),n.context;if(!t)throw new Error(`Context '${e}' not found in cache.`);this.logger.debug(`Context '${e}' not found in cache, constructing...`);const i=t();return this.cache(e,i),i}release(e,t){const n=this.cacheMap.get(e);if(!n)throw new Error(`Cannot release context '${e}', not found in cache.`);n.refCount--,this.logger.debug(`Releasing context '${e}', ref count: '${n.refCount}'.`),0===n.refCount&&(t(),this.cacheMap.delete(e))}}const og="incomplete-boot-attempts";class rg{constructor(e,t,n){if(this.coreSettings=e,this.storage=n,this.pastAttemptsCount=0,this.logger=t.newLogger("CoreSettings/IncompleteBootAttemptsCounter","core-services-settings"),!n)return void this.logger.debug("Disabled because no storage is available.");this.pastAttemptsCount=function(e){if(!e)return 0;try{return parseInt(e,10)}catch{return 0}}(n.get(og));const i=this.pastAttemptsCount+1;n.trySet(og,`${i}`,"Framework"),this.logger.debug(`Set past incomplete boot count to ${i}.`)}markBootAttemptComplete(){this.storage&&(this.pastAttemptsCount>0&&this.logger.debug("Boot attempt complete, incomplete boot counter reset to 0."),this.storage.trySet(og,"0","Framework"),this.pastAttemptsCount=0)}get tooManyPastAttempts(){if(!this.storage)return this.logger.debug("No blocking fetch because storage is unavailable."),!1;const e=this.coreSettings.get(b.J.Core).maxBootAttemptsWithoutEcsFetch;if(!e)return this.logger.debug("No blocking fetch because incomplete boot count limit is unset or zero."),!1;const t=this.pastAttemptsCount>=e;return this.logger.debug(`Too many attempts: ${t}`),t}}const sg="cachedPrimaryUser";class lg{constructor(e,t){this.localStorage=e,this.logger=t.newLogger("CoreSettings/PrimaryUserCache","core-services-settings")}get(){return void 0===this.inMemoryCachedUser&&this.loadFromLocalStorage(),this.inMemoryCachedUser}update(e){const t={...this.inMemoryCachedUser,...e},n=!(0,W.isEqual)(t,this.inMemoryCachedUser);return this.inMemoryCachedUser=t,this.persistToLocalStorage(),n}clear(){const e=!!this.inMemoryCachedUser;return this.inMemoryCachedUser=null,this.clearLocalStorage(),e}loadFromLocalStorage(){const e=this.localStorage.get(sg,"Experience");if(e)try{return void(this.inMemoryCachedUser=JSON.parse(e))}catch(e){this.logger.warn("Cannot parse cached primary user",e)}this.inMemoryCachedUser=null}persistToLocalStorage(){try{this.localStorage.trySet(sg,(0,$.u4)(this.inMemoryCachedUser),"Settings","Experience")}catch(e){this.logger.error("Unable to cache primary user")}}clearLocalStorage(){this.localStorage.remove(sg,"Experience")}}class cg extends zp{constructor(e,t,n,i,a,o,r,s,l,c,d){super(e,t,n,i,a,o,r,s,l,d),this.primaryUserCache=c,this.fetchEcsSettingsIfApplicable=async()=>{if(this.enable1JSEcsClient)return this.fetchEcsSettingsFromEcsClientProvider();const e=this.ecsCachedProvider?.getProvider();if(e&&!e.isInitialized){const t=!0;await e.initialize(t)}},this.getServiceSwitcherApiKey=()=>this.localStorage?.get("serviceId","Experience"),this.getChildId=e=>`${this.id}/${e}`,this.getEcsParameters=e=>{const t=this.enableLocaleFilterForFeatureFlags?this.locale:void 0,n=(e&&e.profile?{userId:e.profile.objectId,tenantId:e.profile.tenantId}:void 0)||(()=>{const e=this.primaryUserCache?.get();return e&&e.userId&&e.tenantId?e:void 0})();return(0,Fp.xb)({coreSettings:this.getCoreSettings(),experienceName:this.experienceName,hostExperienceName:this.hostExperienceName,platformService:this.platformService,user:n,locale:t,logger:this.logger})},this.fetchEcsSettingsFromEcsClientProvider=async()=>{"EcsClient"===this.ecsClientProvider?.getClientType()&&(this.ecsClientProvider.clientStarted||await this.ecsClientProvider.startClient(!0))}}static async createContext(e,t,n,i,a,o,r,s){const l=new ag(i),c=new lg(r,i),d=n("forwardCdlWorkerAllowlist"),u=new cg("g",t.experienceName,l,i,a,e,n,t.partitionCacheByExperience,r,c,d);await u.createConfigProviderForMainThread(),u.createHostProvider(o,s),u.createLocalMigratedSettingsProvider(o),u.createMaglevHostProvider(),u.createPlatformProvider(a),u.createViewportOverrideProvider({viewportContext:o.viewportContext,entityType:null});const m=new eg(o);return await u.createEcsCachedProvider(m),await u.createEcsClientProvider(m),u.createClientFiltersProviders(),await u.createPolicyCachedProvider(m),u.createLocalStorageProvider(o),u.createApiServiceProvider(),u.createQspProvider(o),u.createClientPreferencesProvider(e),u.populateInitialStateHints(),u.registerAllProviders(),l.cache(u.id,u),u}static createContextForWorker(e,t,n,i,a){const o=new ag(t),r=new cg("cdl-worker","cdl-worker",o,t,n,i,a);return r.hostExperienceName=e,r.createConfigProviderForCDLWorker(),r.createPlatformProvider(n),r.createClientFiltersProviders(),r.registerAllProviders(),o.cache(r.id,r),r}async createContextForUser(e,t){if(this.primaryUserCache?.get()?.userId===e.profile.objectId)return this.cache.acquire(this.id);const n=this.getChildId(`u-${e.id}`),i=this.cache.acquire(n,(()=>this.clone(n)));i.createClientFiltersProviders();const a=new eg(t);return await i.createPolicyCachedProvider(a,e),i.registerAllProviders(),i}createContextForViewport(e){if(this.logger.log("Acquiring context for viewport params: ",e),!this.viewportOverrideProvider||this.viewportOverrideProvider?.hasDifferences(e)){const{enableUpdateViewportOverride:t}=this.getCoreSettings().get(b.J.Core),n=`v-${e.viewportContext}-${e.entityType}${t?e.id:""}`,i=this.getChildId(n);return this.cache.acquire(i,(()=>{const t=this.clone(i);return t.createViewportOverrideProvider(e),t.registerAllProviders(),t}))}return this.cache.acquire(this.id)}async setPrimaryUser(e,t,n){this.logger.log(`Setting primary user to: ${e?.id}`);let i=!1;e?(i=this.primaryUserCache?.update({userId:e.profile?.objectId,tenantId:e.profile?.tenantId,teamsLicenseCategories:t?.experimentationTeamsLicenseCategories,teamsAddOnPlans:t?.experimentationTeamsAddOnPlans,mtmaCount:n})||!1,await this.reinitializeEcsProvider(i)):await this.clearPrimaryUser()}async clearPrimaryUser(){this.logger.log("Clearing primary user cache.");const e=this.primaryUserCache?.clear()||!1;await this.reinitializeEcsProvider(e)}setUserTrackingService(e){this.userTrackingSubscription&&(this.userTrackingSubscription.unsubscribe(),this.userTrackingSubscription=void 0),this.userTrackingSubscription=e.getAccountCountCurrentCloudObservable().subscribe((async e=>{const t=this.primaryUserCache?.update({mtmaCount:e})||!1;await this.reinitializeEcsProvider(t)}),(e=>{this.logger.error("Error occurred in user tracking subscription: ",e)}))}initializeProvidersWithCachedPrimaryUser(){const e=this.primaryUserCache?.get();if(e){this.updatePlatformProviderSettings({region:e.region});const{preReleaseFeaturesAllowed:t}=this.getCoreSettings().get(b.J.Metadata),{enableSmbLicenseClientFilter:n}=this.getCoreSettings().get(b.J.Smb),i=ig(e,!!n,{preReleaseFeaturesAllowed:t});this.initializeClientFiltersProviders(i)}}async initializeProvidersWithDiscoveredUser(e,t,n){const{enableSmbLicenseClientFilter:i}=this.getCoreSettings().get(b.J.Smb),a=ig(e,!!i,n);if(await this.initializeClientFiltersProviders(a),this.updatePlatformProviderSettings({region:e?.region}),t){const{isTeamsSmb:t,eduLicenseSkuAndCategory:n,region:i}=e;this.primaryUserCache?.update({isTeamsSmb:t,eduLicenseSkuAndCategory:n,region:i})}}async initializeMaglevHostProvider(e){await(this.maglevHostProvider?.initialize(e))}async initializeMaglevHostProviderPostAltSettings(e){await(this.maglevHostProvider?.onPreWarm(e))}async initializeEcsProvider({authenticationUser:e,scenarioFactory:t,networkState:n,clientState:i,windowProvider:a,endpointsManager:o,alwaysFetchEcsSettings:r}){if(this.enable1JSEcsClient)return this.initializeEcsClientProvider({authenticationUser:e,scenarioFactory:t,networkState:n,clientState:i,windowProvider:a,endpointsManager:o,alwaysFetchEcsSettings:r,experienceName:this.experienceName});const s=await this.getEcsParameters(e),l=this.getCoreSettings(),c=new rg(l,this.loggerFactory,this.localStorage),d=new Xp(s,l,this.loggerFactory,t,a,i,n,o,c,this.experienceName,(()=>({timeSinceCacheExpired:(0,Fp.mN)(this.ecsCachedProvider?.getExpiration())}))),u=this.ecsCachedProvider?.cacheState!==qm.NoData,m=!u||c.tooManyPastAttempts;m||r?(this.logger.log(`Initializing ECS provider: awaitInitialSync? ${m}, hasCacheData? ${u}, alwaysFetch? ${r}`),await d.initialize(m)):this.logger.log("Cache is valid, delaying ECS fetch until WARM."),await(this.ecsCachedProvider?.setProvider(d))}async initializePolicyProvider(e){const{enablePoliciesDefaultValues:t}=this.getCoreSettings().get(b.J.Core),n=new Zp(this.loggerFactory,e,this.configLoader,!!t);if(this.policyCachedProvider){const e=n.initialize();this.policyCachedProvider.cacheState===qm.NoData&&(this.logger.log("Policy cache is empty, waiting to fetch policies."),await e),await this.policyCachedProvider.setProvider(n)}}async initializeWorkerProviders(e,t){await this.createWorkerHostProvider(t),await this.createEcsCachedProvider(e),await this.createEcsClientProvider(e),await this.createWorkerTestProvider(e),await this.createWorkerHostTestOverridesProvider(t),this.registerProvider(zm.Configuration,this.workerHostProvider),this.registerProvider(zm.Configuration,this.ecsCachedProvider),this.registerProvider(zm.TestOverride,this.workerTestProvider),this.registerProvider(zm.TestOverride,this.workerHostTestOverridesProvider),this.settingsService.notifySettingsChanged()}async initializeWorkerProvidersWithoutHostSettings(e,t){await this.createEcsCachedProvider(e),await this.createEcsClientProvider(e),await this.createWorkerTestProvider(e),await this.createWorkerHostTestOverridesProvider(t),this.registerProvider(zm.Configuration,this.ecsCachedProvider),this.registerProvider(zm.TestOverride,this.workerTestProvider),this.registerProvider(zm.TestOverride,this.workerHostTestOverridesProvider),this.settingsService.notifySettingsChanged()}async initializeHostWorkerProviders(e){await this.createWorkerHostProvider(e),this.registerProvider(zm.Configuration,this.workerHostProvider),this.settingsService.notifySettingsChanged()}async initializeApiServiceProvider(){const e=this.getSelectedServiceConfigs();e&&this.apiServiceProvider?.setOverrides(e)}getLocalStorageTestOverrides(){return this.localStorageProvider?.getSettings()}getQspTestOverrides(){return this.qspProvider?.getSettings()}cleanup(e){this.userTrackingSubscription?.unsubscribe(),this.userTrackingSubscription=void 0,super.cleanup(e)}clone(e){const t=new cg(e,this.experienceName,this.cache,this.loggerFactory,this.platformService,this.clientPreferences,this.configLoader,this.partitionCacheByExperience,this.localStorage,this.primaryUserCache,this.cdlWorkerSettingsAllowlist);return this.scenarioFactory&&t.setScenarioFactory(this.scenarioFactory),t.getInitialStateHints=this.getInitialStateHints,t.hostExperienceName=this.hostExperienceName,t.configProvider=this.configProvider,t.ecsCachedProvider=this.ecsCachedProvider,t.ecsClientProvider=this.ecsClientProvider,t.hostProvider=this.hostProvider,t.localMigratedSettingsProvider=this.localMigratedSettingsProvider,t.maglevHostProvider=this.maglevHostProvider,t.clientFiltersMergeProvider=this.clientFiltersMergeProvider,t.clientFiltersOverrideProvider=this.clientFiltersOverrideProvider,t.policyCachedProvider=this.policyCachedProvider,t.qspProvider=this.qspProvider,t.localStorageProvider=this.localStorageProvider,t.apiServiceProvider=this.apiServiceProvider,t.platformProvider=this.platformProvider,t}initializeClientFiltersProviders(e){const{enableClientFiltersProvider:t}=this.getCoreSettings().get(b.J.Core);t&&(this.clientFiltersMergeProvider?.initialize(e),this.clientFiltersOverrideProvider?.initialize(e))}getSelectedServiceConfigs(){const e=this.getServiceSwitcherApiKey()||this.getCoreSettings()?.get(b.J.Host)?.serviceSwitcherSelectedServiceId;if(!e)return;const t=this.getCoreSettings()?.get(b.J.Core)?.availableServiceSwitcherApis,n=t?.find((t=>t.id===e));if(n)this.logger.infoToTelemetry?.("Service config found","service_switch_load",{newState:e},!0);else{const t=`No service config found for ${e}`;this.logger.errorToTelemetry?.(t,"service_switch_load",{newState:e,error:t},!0)}return n}async reinitializeEcsProvider(e){if(this.enable1JSEcsClient)return this.reinitializeEcsClientProvider(e);const t=this.ecsCachedProvider?.getProvider();if(!t)return;const n=await this.getEcsParameters();!t.isInitialized&&e?await t.initialize(!0):await t.updateEcsParametersAndFetchSettings(n)}get enable1JSEcsClient(){const e=this.getCoreSettings(),{enable1JSEcsClient:t}=e.get(b.J.Core,["enable1JSEcsClient"]);return Boolean(t)}async initializeEcsClientProvider({authenticationUser:e,scenarioFactory:t,networkState:n,clientState:i,windowProvider:a,endpointsManager:o,alwaysFetchEcsSettings:r}){if(!this.ecsClientProvider)throw new Error("initializeEcsClientProvider() called without this.ecsClientProvider present");const s=await this.getEcsParameters(e),l=this.getCoreSettings(),c=new rg(l,this.loggerFactory,this.localStorage);this.ecsClientProvider.initializeClient(s,l,a,i,n,o,t,c,this.experienceName);const d=this.ecsClientProvider.getCacheState(),u=d===qm.Valid||d===qm.Expired,m=!u||c.tooManyPastAttempts;m||r?(this.logger.log(`Initializing ECS provider: awaitInitialSync? ${m}, hasCacheData? ${u}, alwaysFetch? ${r}`),await this.ecsClientProvider.startClient(m)):this.logger.log("Cache is valid, delaying ECS fetch until WARM.")}async reinitializeEcsClientProvider(e){if("EcsClient"!==this.ecsClientProvider?.getClientType())return;const t=this.getEcsParameters();!this.ecsClientProvider.clientStarted&&e?await this.ecsClientProvider.startClient(!0):await this.ecsClientProvider.updateParametersAndFetch(t)}}class dg extends _e{constructor(){super(h.Yg.CreateSettings,[]),this.registerShellHandlers=(e,t)=>{e.opener?.addEventListener(O.rY.GetSettings,(async()=>t.getCurrentSettingsSnapshot().then((t=>e.opener.postMessage(O.rY.GetSettings,{settings:t})),(()=>e.opener.postMessage(O.rY.GetSettings,{settings:""})))))}}async execute(e){const{hostSettings:t}=e,{clientPreferences:n,config:i,configLoader:a,diagnosticsService:o,loggerFactory:r,logsCollectorService:s,platformService:l,windowProvider:c,localStorage:d,postTaskSchedulerDiagnosticsService:u}=Mm("CreateCoreSettingsTask",e,"clientPreferences","config","configLoader","diagnosticsService","loggerFactory","logsCollectorService","platformService","windowProvider","localStorage","postTaskSchedulerDiagnosticsService"),m=await cg.createContext(n,i,a,r,l,c,d,t),p=m.getCoreSettings();m.initializeProvidersWithCachedPrimaryUser();const g=m.getLogsProvider();e.coreSettingsContext=m,e.coreSettings=p,d?.subscribeToCoreSettings?.(p),o.subscribeToCoreSettings(p),s.subscribeToCoreSettings(p),u.subscribeToCoreSettings(p);p.get(b.J.Core).enableMTMA||s.registerUserLogsProvider("",g),this.registerShellHandlers(c,g)}}class ug extends _e{constructor(){super(h.Yg.CreateSettingsUserContext,["authenticationUser","coreSettingsContext","logsCollectorService","windowProvider"])}async execute(e){const{authenticationUser:t,coreSettingsContext:n,logsCollectorService:i,windowProvider:a}=e,o=await n.createContextForUser(t,a);e.coreSettingsContext=o,e.coreSettings=o.getCoreSettings();const r=o.getLogsProvider();return i.registerUserLogsProvider(t.id,r),e=>{switch(e){case"quit":case"signout":o.cleanup(e);break;default:return}}}}class mg{constructor(e,t,n,i,a,o,r,s,l){this._delegatedCommanding=e,this._client=t,this._experienceChangeReportingService=n,this._authenticationUser=i,this._hostCommunicationService=a,this._loggerFactory=o,this._activeWindowsService=r,this._shortcutRegistryService=s,this._config=l,this._logger=this._loggerFactory.newLogger("core-shortcut-service","core-shortcut-service"),this._registeredDesktopShortcuts=[]}addAppWideShortcut(e,t,n,i){this._shortcutRegistryService?.addAppWideShortcut(e,t,n,i)}removeAppWideShortcut(e){this._shortcutRegistryService?.removeAppWideShortcut(e)}getAppWideShortcutHandler(e){return this._shortcutRegistryService?.getAppWideShortcutHandler(e)}async addDesktopClientShortcut(e,t,n,i){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;if(!i)return void this._logger.warn(`Missing windowId for command: ${t}`);const a=await this._hostCommunicationService.loadModule("windowcontrols");try{const o=await(a?.addShortcut?.(i,e));return o&&(this._logger.log(`Added desktop shortcut for command ${t} and shortuctId ${o}`),this._registeredDesktopShortcuts.push({commandId:t,shortcutId:o,commandHandler:n,windowId:i})),o}catch(n){return this._logger.error(`Failed addShortcut for command ${t} and shortuctId ${e.mac}`),""}}async removeDesktopClientShortcut(e,t){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;this._logger.debug(`Removing desktop shortcut for commandId ${e}`);const n=this._registeredDesktopShortcuts.find((n=>n.commandId===e&&n.windowId===t));if(n){const i=await this._hostCommunicationService.loadModule("windowcontrols");await(i?.removeShortcut?.(n.windowId,n.shortcutId)),this._logger.log(`Removed desktop shortcut for command ${e} and shortuctId ${n.shortcutId}`),this._registeredDesktopShortcuts=this._registeredDesktopShortcuts.filter((n=>!(n.commandId===e&&n.windowId===t)))}}async addGlobalShortcut(e,t,n){return this._shortcutRegistryService?.addGlobalShortcut(e,t,n)}async removeGlobalShortcut(e){return this._shortcutRegistryService?.removeGlobalShortcut(e)}async addEventListener(e,t){if(!this._config.enableShortcutPropagation)return;const n=await this.getMainWindow();n?.id===e&&(this._mainShortcutServiceCallback=t)}async processEvent(e,t){if(!this._config.enableShortcutPropagation)return;await this.getMainWindow()?this._mainShortcutServiceCallback?.(e):(this._mainShortcutServiceCallbackWithPayload=()=>{this._mainShortcutServiceCallback?.(e)},this._subscribeToChangeReportingService()),await this.openMainApp()}async registerForDesktopClientKeyDownShortcuts(){if(!this._config.enableShortcutRegistrationWithDesktopClient)return;const e=await this._hostCommunicationService.loadModule("windowcontrols");this._disposeDesktopShortcutKeyDowEventRegistration=e?.registerForKeyDown?.((e=>this._handleDesktopShortcut(e)))}async registerForGlobalShortcutActivated(){return this._shortcutRegistryService?.registerForGlobalShortcutActivated()}async destroy(e){if(this._shortcutRegistryService?.destroy(e),this._config.enableShortcutRegistrationWithDesktopClient&&this._disposeDesktopShortcutKeyDowEventRegistration?.(),this._config.enableShortcutPropagation){const e=this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsService.getActiveWindows():await(0,us.XD)(this._client),t=e.find((e=>e.isMainWindow&&e.layoutConfig.layoutMode===ke.lO.standard));t||(this._mainShortcutServiceCallback=void 0),0!==e.length&&this._authenticationUser&&t?.userContextId===(0,xe.b4)(this._authenticationUser)||(this._mainShortcutServiceCallbackWithPayload=void 0,this._mainShortcutServiceCallback=void 0,this._subscription&&this._subscription.unsubscribe())}}async getMainWindow(){return this._activeWindowsService.enableDecoupleCommandingFromApollo?this._activeWindowsService.getStandardMainWindow():await(0,us.jW)(this._client)}async openMainApp(){return this._delegatedCommanding.execute({command:Nt.CN.defaultCommand({})})}_handleDesktopShortcut(e){const t=this._registeredDesktopShortcuts.find((t=>t.shortcutId===e.shortcutId));t?(this._logger.debug(`Executing command handler for desktop shortcut: ${t.commandId} / ${e.shortcutId}`),t.commandHandler()):this._logger.warn(`Can't execute desktop shortcut with id ${e.shortcutId}. No record found.`)}_subscribeToChangeReportingService(){const e=this._experienceChangeReportingService.observeChanges();this._subscription=e.pipe((0,d.U)((async e=>{if(e.type!==gt.FV.LayoutRenderComplete)return;const t=await this.getMainWindow();e.windowId===t?.id&&this._onMainWindowLayoutRenderComplete()}))).subscribe()}_onMainWindowLayoutRenderComplete(){this._mainShortcutServiceCallbackWithPayload?.(),this._mainShortcutServiceCallbackWithPayload=void 0,this._subscription&&this._subscription.unsubscribe()}}class pg extends _e{constructor(){super(h.Yg.CreateCoreShortcutService,["activeWindowsService","client","coreSettings","experienceChangeReportingService","hostCommunicationService","loggerFactory","shortcutRegistryService","delegatedCommanding"])}async execute(e){const{activeWindowsService:t,authenticationUser:n,client:i,coreSettings:a,experienceChangeReportingService:o,hostCommunicationService:r,loggerFactory:s,shortcutRegistryService:l,delegatedCommanding:c}=e,{enableShortcutPropagation:d,enableShortcutRegistrationWithDesktopClient:u,enableGlobalShortcuts:m,enableAppWideShortcuts:p}=a.get(b.J.Shortcuts);(d||m||u||p)&&(e.coreShortcutService=new mg(c,i,o,n,r,s,t,l,{enableShortcutPropagation:!!d,enableShortcutRegistrationWithDesktopClient:!!u,enableGlobalShortcuts:!!m,enableAppWideShortcuts:!!p}))}}class gg extends _e{constructor(){super(h.Yg.CreateCoreUtilities,["isEntityInView"])}async execute(e){const{isEntityInView:t}=e;e.coreUtilities={isEntityInView:t}}}class hg{constructor(e,t){this.channelName=e,this.host=t,this.subscriptions=[],this.hostResumeEventHandler=()=>{this.closeChannel(),this.initializeChannel()},this.initializeChannel(),this.subcribeToHostLifecycleEvents()}canPostMessage(){return!!this.broadcastChannel}postMessage(e){return this.broadcastChannel?(this.broadcastChannel.postMessage(e),"success"):"failure"}subscribeToMessage(e){this.subscriptions.push(e),this.broadcastChannel?.addEventListener("message",(t=>e(t.data)))}dispose(){this.unsubscribeFromHostLifecycleEvents(),this.closeChannel(),this.subscriptions=[]}initializeChannel(){const e=new BroadcastChannel(this.channelName);this.broadcastChannel=e,this.subscriptions.forEach((t=>e.addEventListener("message",(e=>t(e.data)))))}closeChannel(){this.broadcastChannel?.close(),this.broadcastChannel=void 0}subcribeToHostLifecycleEvents(){this.host.addEventListener("resume",this.hostResumeEventHandler)}unsubscribeFromHostLifecycleEvents(){this.host.removeEventListener("resume",this.hostResumeEventHandler)}}class yg{constructor(e,t){this.logger=e,this.host=t,this.subscriptions=new Map,this.channel=new hg(yg.CrossTabsCommsBusKey,this.host),this.initializeSubscriptions(),this.logger.logNoPii?.("Initialized")}postMessage(e,t){if(!this.channel.canPostMessage())return"failure";const n=this.toCrossTabsMessagePayload(e,t);return this.channel.postMessage(n)}subscribeToMessage(e,t){const n=this.subscriptions.get(e)||new Set;n.add(t),this.subscriptions.set(e,n);const i=()=>{const n=this.subscriptions.get(e);n?.has(t)&&n.delete(t)};return()=>i()}dispose(){this.channel.dispose(),this.subscriptions.clear()}broadcastedMessageHandler(e){this.logger.logNoPii?.(`Message received: type=${e.messageType}, id={${e.messageId}}, correlationId={${e.correlationId}}`);const t=e.messageType;if(t){const n=this.subscriptions.get(t);n&&n.forEach((t=>t({...e})))}}initializeSubscriptions(){this.channel.subscribeToMessage((e=>this.broadcastedMessageHandler(e)))}toCrossTabsMessagePayload(e,t){return{messageType:e,timestamp:Date.now(),messageId:(0,ae.GW)(),correlationId:t?.responseRequired?(0,ae.GW)():void 0,...t}}}yg.CrossTabsCommsBusKey="CrossTabsBus";class vg{constructor(e,t,n){this.baseCrossTabsService=e,this.logger=t,this.host=n,this.subscribeToTabsSearch()}areOtherTabsDetected(){return new Promise((e=>{let t=0;const n=this.baseCrossTabsService.subscribeToMessage("SearchTabsResponse",(()=>{t&&this.host.clearTimeout(t),n(),e(!0)}));"failure"===this.baseCrossTabsService.postMessage("SearchTabs",{responseRequired:!0})&&(n(),e(!1)),t=this.host.setTimeout((()=>{e(!1)}),1e3)}))}subscribeToTabsSearch(){this.baseCrossTabsService.subscribeToMessage("SearchTabs",(e=>{this.baseCrossTabsService.postMessage("SearchTabsResponse",{correlationId:e.correlationId}),this.logger.logNoPii?.(`SearchTabs received. CorrelationId: ${e.correlationId}`)}))}}const fg=3e5;class Sg{constructor(e,t,n,i){this.baseCrossTabsService=e,this.logger=t,this.host=n,this.timestampOfLastCountTabsResponse=0,this.waitForTabsCountTimeoutMs=5e3,this.waitForTabsCountResponsesTimeoutMs=3e3,this.tabsRecountIntervalMs=fg,this.tabInitializationTimestamp=Date.now(),this.tabClosingEventHandler=()=>{this.logger.logNoPii?.("Tab might to be closing. Sending TabClosed message."),this.baseCrossTabsService.postMessage("TabClosed")},this.activeTabsCountBehaviorSubject=new r.X(1),this.activeTabsLimitReachedBehaviorSubject=new r.X(!1),this.subscribeToSettings(i)}observeActiveTabsCount(){return this.activeTabsCountBehaviorSubject.asObservable()}getActiveTabsCount(){return this.activeTabsCountBehaviorSubject.getValue()}observeIsActiveTabsLimitReached(){return this.activeTabsLimitReachedBehaviorSubject.asObservable()}isActiveTabsLimitReached(){return this.activeTabsLimitReachedBehaviorSubject.getValue()}dispose(){this.stopTabsCounting(),this.coreSettingsSubscription?.unsubscribe(),this.activeTabsCountBehaviorSubject.complete()}subscribeToSettings(e){const t=e.getObservable(b.J.Core,["disableActiveTabsCounting","crossTabsRecountIntervalMs","crossTabsWaitCountTabsResponseIntervalMs","crossTabsWaitForTabsCountTimeoutMs","crossTabsActiveTabsLimit"]);this.coreSettingsSubscription=t.subscribe((e=>{const{disableActiveTabsCounting:t,crossTabsRecountIntervalMs:n,crossTabsWaitCountTabsResponseIntervalMs:i,crossTabsWaitForTabsCountTimeoutMs:a,crossTabsActiveTabsLimit:o}=e;this.tabsRecountIntervalMs=n??fg,this.waitForTabsCountResponsesTimeoutMs=i??3e3,this.waitForTabsCountTimeoutMs=a??5e3,this.activeTabsLimit=o??void 0,void 0!==this.disableActiveTabsCounting&&this.disableActiveTabsCounting===!!t||(this.disableActiveTabsCounting=!!t,this.disableActiveTabsCounting?this.stopTabsCounting():this.initializeTabsCounting())}))}initializeTabsCounting(){this.initializeTabClosingHandlers(),this.subscribeToTabsCountingEvents(),this.restartTabsCountingTimer(),this.countTabs(!0)}stopTabsCounting(){this.clearTabsCountingTimer(),this.clearWaitForTabsCountTimer(),this.countTabsPromise?.cancel?.(),this.countTabsPromise=void 0,this.unsubscribeFromHostLifecycleEvents(),this.unsubscribeFromTabsCountingEvents(),this.activeTabsCountBehaviorSubject.next(1)}subscribeToTabsCountingEvents(){this.unsubscribeFromTabsCountMessage=this.baseCrossTabsService.subscribeToMessage("TabsCount",(e=>{this.clearWaitForTabsCountTimer(),this.logger.logNoPii?.(`TabsCount ${e.tabsCount} received. CorrelationId: ${e.correlationId}`),this.updateActiveTabsCount(e.tabsCount,e.lastResponseTimestamp),this.restartTabsCountingTimer()})),this.unsubscribeFromCountTabsMessage=this.baseCrossTabsService.subscribeToMessage("CountTabs",(e=>{this.baseCrossTabsService.postMessage("CountTabsResponse",{correlationId:e.correlationId,tabTimestamp:this.tabInitializationTimestamp}),this.logger.logNoPii?.(`CountTabs received. CorrelationId: ${e.correlationId}`),this.startWaitForTabsCountTimer()}))}unsubscribeFromTabsCountingEvents(){this.unsubscribeFromCountTabsMessage?.(),this.unsubscribeFromTabsCountMessage?.()}countTabs(e=!1){if(this.countTabsPromise)return this.countTabsPromise.promise;let t;const n=new Promise((n=>{let i=0;const a=(0,ae.GW)();let o=1,r=Date.now();const s=[this.tabInitializationTimestamp],l=this.baseCrossTabsService.subscribeToMessage("CountTabsResponse",(e=>{e.correlationId===a&&(o++,r=Date.now(),s.push(e.tabTimestamp))}));t=()=>{l(),i&&this.host.clearTimeout(i),i=0,n()};const c=this.baseCrossTabsService.postMessage("CountTabs",{correlationId:a}),d=Date.now(),u=()=>{l();const i=this.getActiveTabsCount().toString();let c=!1;if(this.activeTabsLimit){s.sort(((e,t)=>e-t));s[this.activeTabsLimit-1]<this.tabInitializationTimestamp&&(c=!0,o--)}this.updateActiveTabsCount(o,r),this.baseCrossTabsService.postMessage("TabsCount",{tabsCount:o,correlationId:a,lastResponseTimestamp:r});const u=r>=d?r-d:-1;this.logger.infoToTelemetry?.(`tabs counting timespan is ${u}`,"crosstabs_tabs_counting_timespan",{delta:u},!0),this.logger.infoToTelemetry?.(`tabs count is ${o}; tab disabled: ${c}`,"crosstabs_tabs_count",{currentState:e?void 0:i,newState:o.toString(),disabled:c},!0),t=void 0,this.updateTabsLimitReachedState(c),n()};"failure"===c?(this.logger.errorToTelemetry?.("countTabs can't post message","crosstabs_tabs_counting_error"),u()):i=this.host.setTimeout((()=>{u()}),this.waitForTabsCountResponsesTimeoutMs)})).then((()=>{this.countTabsPromise=void 0}));return this.countTabsPromise={promise:n,cancel:()=>t?.()},this.countTabsPromise.promise}updateActiveTabsCount(e,t){e&&e!==this.activeTabsCountBehaviorSubject.getValue()&&t>this.timestampOfLastCountTabsResponse?(this.timestampOfLastCountTabsResponse=t,this.activeTabsCountBehaviorSubject.next(e)):this.logger.logNoPii?.(`Tabs count is not updated. timestampOfLastCountTabsResponse: ${this.timestampOfLastCountTabsResponse}, lastResponseTimestamp for update: ${t}`)}restartTabsCountingTimer(){this.clearTabsCountingTimer(),this.nextTabsRecountTimerId=this.host.setInterval((()=>{void 0===this.waitForTabsCountTimerId&&this.countTabs()}),this.tabsRecountIntervalMs)}clearTabsCountingTimer(){void 0!==this.nextTabsRecountTimerId&&(this.host.clearInterval(this.nextTabsRecountTimerId),this.nextTabsRecountTimerId=void 0)}startWaitForTabsCountTimer(){this.waitForTabsCountTimerId||(this.waitForTabsCountTimerId=this.host.setTimeout((()=>{this.waitForTabsCountTimerId=void 0,this.restartTabsCountingTimer(),this.countTabs()}),this.waitForTabsCountTimeoutMs))}clearWaitForTabsCountTimer(){void 0!==this.waitForTabsCountTimerId&&(this.host.clearTimeout(this.waitForTabsCountTimerId),this.waitForTabsCountTimerId=void 0)}initializeTabClosingHandlers(){this.host.addEventListener("beforeunload",this.tabClosingEventHandler),this.unsubscribeFromTabClosedMessage=this.baseCrossTabsService.subscribeToMessage("TabClosed",(()=>{this.clearWaitForTabsCountTimer(),this.logger.logNoPii?.("TabClosed received."),this.startWaitForTabsCountTimer()}))}unsubscribeFromHostLifecycleEvents(){this.host.removeEventListener("beforeunload",this.tabClosingEventHandler),this.unsubscribeFromTabClosedMessage?.()}updateTabsLimitReachedState(e){e!==this.isActiveTabsLimitReached()&&(e&&(this.clearTabsCountingTimer(),this.clearWaitForTabsCountTimer(),this.unsubscribeFromTabsCountingEvents(),this.unsubscribeFromHostLifecycleEvents()),this.activeTabsLimitReachedBehaviorSubject.next(e))}}class kg{constructor(e,t,n){this.logger=e.newLogger("CrosstabService","services-io-browser-crosstabs"),this.basicCrossTabsService=new yg(this.logger,t),this.tabsFinderHelper=new vg(this.basicCrossTabsService,this.logger,t),this.tabsCounterHelper=new Sg(this.basicCrossTabsService,this.logger,t,n),this.loggingActiveTabsCountSubsciption=this.observeActiveTabsCount().subscribe((e=>{this.logger.logNoPii?.(`Active tabs count: ${e}`)})),this.logger.logNoPii?.("Initialized")}observeActiveTabsCount(){return this.tabsCounterHelper.observeActiveTabsCount()}getActiveTabsCount(){return this.tabsCounterHelper.getActiveTabsCount()}observeIsActiveTabsLimitReached(){return this.tabsCounterHelper.observeIsActiveTabsLimitReached()}isActiveTabsLimitReached(){return this.tabsCounterHelper.isActiveTabsLimitReached()}postMessage(e,t){return this.basicCrossTabsService.postMessage(e,t)}subscribeToMessage(e,t){return this.basicCrossTabsService.subscribeToMessage(e,t)}areOtherTabsDetected(){return this.tabsFinderHelper.areOtherTabsDetected()}dispose(){this.basicCrossTabsService.dispose(),this.tabsCounterHelper.dispose(),this.loggingActiveTabsCountSubsciption.unsubscribe()}}var Cg=n(125912);class bg extends _e{constructor(){super(h.Yg.CreateCrossTabsService,["coreSettings","localStorage","loggerFactory","windowProvider"])}async execute(e){const{coreSettings:t,localStorage:n,loggerFactory:i,windowProvider:a}=e,{enableCrossTabsCommunication:o}=t.get(b.J.Core,["enableCrossTabsCommunication"]);if(o){const o=function(e,t,n){try{return new kg(e,t,n)}catch(t){const n=e.newLogger("CrosstabService","services-io-browser-crosstabs"),i="Can't be initialized.";return void n.errorToTelemetry?.(i,"cross_tabs_init_failed",void 0,!0)}}(i,a,t);e.crossTabsService=o,o&&o.subscribeToMessage("T2WebOptOut",(()=>this.onT2WebOptOut(i,n,o)))}}onT2WebOptOut(e,t,n){const i=e.newLogger("T2WebOutOutMessageHandler","t2-web-opt-out-message-handler");i.logNoPii?.("T2WebOptOut message received, redirecting this tab to T1");new Cg.BZ(t,e,n).redirectThisTabToT1("CrossTabMessage")}}var wg=n(520452),Tg=n(668939),Ig=n(549426);const Ng=["activeCalls","activeMeetings","activeWindow","activeWindowForEntity","activeWindows","allClientPreferences","appReadyTriggerStatus","appInstallOptions","appsInstalledByCurrentUser","appsUsage","attendeeCaptionsVisibility","bannerNotificationQueue","byodState","cachedAppList","callingScreenLayout","callingScreenStatus","clientPreferences","currentCallingState","currentEspSurfaceId","espState","fetchDynamicCommandsV2","isEntityInActiveWindow","isUbarRenderComplete","localizationSettings","meetingRoomFrontOfRoomCallPanelsState","meetingRoomLayoutToggleState","pinnedMeetings","pptSharingSession","recentMeetings","shouldLaunchWhiteboardOnLoad","whiteboardSharingSession","whiteboardWalkUpState","liveStreamIdMetadata","liveStreamCaptionsState"],Eg=["addSharedPlatformCachedApps","executeEntityCommand","changeMonitorSlotContent","changeSlotsVisibility","performWindowHistoryNavigation","navigateToWindowHistoryIndex","recordAppActionUsage","recordAppSceneUsage","recordAppUsage","removeSharedPlatformCachedApps","removeUserActiveWindows","removeWindow","resizeHeaderSlot","resizeSlotDimensions","pushToWindowHistory","removeFromWindowHistory","saveReactiveVarsToHistory","setActiveCalls","setByodState","setCallingScreenLayout","setCallingScreenStatus","setDisplayMirroring","setDisplayConfigType","setUbarRenderComplete","toggleHideMyselfVideo","togglePinMyself","toggleMyselfInGrid","toggleParticipantPin","updateActiveCalls","updateAttendeeCaptionsVisibility","updateClientPreferences","updateCurrentLocale","updateEntity","updateEntityState","updateExtendedEntityContainerState","updateMeetingRoomLayoutToggleState","updateSharedPlatformCachedApps","updateShouldLaunchWhiteboardOnLoad","updateWhiteboardWalkUpState","setMeetingRoomFrontOfRoomCallPanelsState","recordEspCompletedActions","recordDisplayedSurface","recordEligibleSurface","startLiveStream","setLiveStreamCaptionsData","toggleLiveStreamCaptions","setLiveStreamSubtitleTrack"],Ag=["appsInstalledByCurrentUserEvent","appsUsageUpdateEvent","callParticipantPinnedEventv2","dynamicCommandsUpdateEvent"],_g=["activeWindow","activeWindowForEntity","activeWindows","allClientPreferences","appReadyTriggerStatus","cachedAppList","clientPreferences","currentEspSurfaceId","espGlobalState","isEntityInActiveWindow","localizationSettings","poppedOutWindowState"],Fg=[..._g,"activeCalls","activeMeetings","appInstallOptions","appsInstalledByCurrentUser","appsUsage","bannerNotificationQueue","byodState","callingScreenLayout","callingScreenStatus","currentCallingState","fetchDynamicCommandsV2","meetingRoomLayoutToggleState","meetingTemplateDescriptions","pinnedMeetings","pptSharingSession","recentMeetings","whiteboardSharingSession","espState","userPreferencesForSimpleCollab"],Dg=["addSharedPlatformCachedApps","executeEntityCommand","changeMonitorSlotContent","changeSlotsVisibility","removeWindow","setPoppedOutWindowState","resizeHeaderSlot","performWindowHistoryNavigation","navigateToWindowHistoryIndex","removeSharedPlatformCachedApps","removeUserActiveWindows","resizeSlotDimensions","pushToWindowHistory","removeFromWindowHistory","saveReactiveVarsToHistory","updateClientPreferences","updateCurrentLocale","updateEntity","updateEntityState","updateExtendedEntityContainerState","updateSharedPlatformCachedApps","setEspGlobalState","createNotificationsWindow","removeNotificationsWindow"],Pg=[...Dg,"setActiveCalls","setByodState","setCallingScreenLayout","setCallingScreenStatus","setDisplayMirroring","setDisplayConfigType","toggleParticipantPin","toggleHideMyselfVideo","toggleMyselfInGrid","togglePinMyself","updateActiveCalls","updateMeetingRoomLayoutToggleState","recordEspCompletedActions","recordDisplayedSurface","recordEligibleSurface","recordAppActionUsage","recordAppSceneUsage","recordAppUsage","updateUserPreferencesForSimpleCollab"],Mg=[],xg=[...Mg,"appsInstalledByCurrentUserEvent","appsUsageUpdateEvent","callParticipantPinnedEventv2","callHideMyselfVideoEvent","dynamicCommandsUpdateEvent","callMyselfVideoPinnedEvent","userPreferencesChangedEventForSimpleCollab"],Rg=["chat","messages","installedAppsV2"],jg=[...Ng,"lpcState","pinnedChannels","joinedTeamsAndChannels","oneGql_me"],Lg=(e,t,n)=>{const i=(0,Tg.p$)(e),{operation:a,selectionSet:{selections:o},variableDefinitions:r}=i,s=$g[a],l=r?.some((e=>!!e.defaultValue))?function(e,t={}){const n={};for(const i of e){const e=i.variable.name.value;t.hasOwnProperty(e)?n[e]=t[e]:i.defaultValue&&(n[e]=(0,Ig.M)(i.defaultValue))}return n}(r,t):t;return o.filter((e=>"Field"===e.kind&&!jg.includes(e.name.value))).map((e=>({id:s,fieldName:e.name.value,args:Og(e,l),schemaId:n})))};function Og(e,t){if(!e?.arguments?.length)return;const n={};for(const i of e.arguments){const e=(0,Ig.M)(i.value,t);void 0!==e&&(n[i.name.value]=e)}return n}const $g={query:"ROOT_QUERY",mutation:"ROOT_MUTATION",subscription:"ROOT_SUBSCRIPTION"};var Ug;!function(e){e[e.DefaultSchema=0]="DefaultSchema",e[e.ViewSchema=1]="ViewSchema"}(Ug||(Ug={}));var Bg=n(48934),Wg=n(290982),Hg=n.n(Wg);var Vg=n(727688);class Gg{constructor(e){this._inactiveOperations=new Map,this._forcedActiveOperations=new Map,this._windowToDataMap=new Map,this._dataToWindowMap=new Map,this._activeOperations=e?.activeOperationLimit?new Vg.Z({maxSize:e.activeOperationLimit,onEviction:this.markLeastRecentlyUsedOperation.bind(this)}):new Map}trackOperation(e,t,n=Ug.DefaultSchema,i){const{fetchPolicy:a,variables:o}=e,r=e.query||e.mutation;if("no-cache"===a)return;if(e.mutation&&!e.keepRootFields)return;Lg(r,o,n).forEach((e=>{const n=(e=>{const t=Hg()(e);return(0,Bg.Z)(t)})(e);this._activeOperations.set(n,e),"boolean"==typeof i&&this.forceActive(n,i),this.addDataForWindow(t,n),this._inactiveOperations.has(n)&&this._inactiveOperations.delete(n)}))}markDataForWindowAsInactive(e){const t=this._windowToDataMap.get(e)||[];this._windowToDataMap.delete(e),t.forEach((t=>{const n=this._dataToWindowMap.get(t);if(n&&(n.delete(e),n.size))return;const i=this._activeOperations.get(t);i&&this._inactiveOperations.set(t,i),this._dataToWindowMap.delete(t),this._activeOperations.delete(t)}))}flush(e=this._inactiveOperations.size){const t=[],n=[];let i=0;return this._inactiveOperations.forEach(((a,o)=>{i>=e||(t.push(a),n.push(o),Rg.includes(a.fieldName)&&(i=e),i++)})),n.forEach((e=>this._inactiveOperations.delete(e))),{descriptors:t,hasMore:!!this._inactiveOperations.size}}DEBUG_ONLY_getInactiveOperations(){return this._inactiveOperations}addDataForWindow(e,t){let n=this._windowToDataMap.get(e);n||(n=new Set,this._windowToDataMap.set(e,n)),n.add(t);let i=this._dataToWindowMap.get(t);i||(i=new Set,this._dataToWindowMap.set(t,i)),i.add(e)}forceActive(e,t){const n=(this._forcedActiveOperations.get(e)??0)+(t?1:-1);0!==n?this._forcedActiveOperations.set(e,n):this._forcedActiveOperations.delete(e)}markLeastRecentlyUsedOperation(e,t){(this._forcedActiveOperations.get(e)??0)>0?this._activeOperations.set(e,t):this._inactiveOperations.set(e,t)}}class zg{constructor(e,t,n,i){this.dataOpsRepository=e,this.scenarioFactory=t,this.windowProvider=i,this.clients=new Set,this.logger=n.newLogger("EvictionService","data-client-core")}register(e){this.clients.add(e)}unregister(e){this.clients.delete(e)}async evict(){this.lastEvictionResult={entriesEvicted:0,entriesNotEvicted:0,entriesGCed:0};let e=!0;do{e=await this.evictByWindowRequestIdleCallback()}while(e)}DEBUG_ONLY_getInactiveOperations(){return this.dataOpsRepository.DEBUG_ONLY_getInactiveOperations()}DEBUG_ONLY_getClients(){return this.clients}DEBUG_ONLY_lastResult(){return this.lastEvictionResult}evictByWindowRequestIdleCallback(){return new Promise((e=>{this.windowProvider.requestIdleCallback((t=>{let n=!1,i=0;do{const e=performance.now(),a=t.timeRemaining();this.logger.debug("Time remaining at start",a);const o=this.scenarioFactory.newScenario(H.RG.CacheEviction);n=this.evictInternal(o);const r=t.timeRemaining(),s=performance.now();i=r>0?r:a-(s-e);const l={"Eviction.TimeRemaining":i};o.stop(l),this.logger.debug("Time remaining at end",i)}while(n&&i>10);e(n)}))}))}evictInternal(e){const{descriptors:t,hasMore:n}=this.dataOpsRepository.flush(10);let i=0,a=0;const o=this.groupCachesBySchema(),r=new Set;t.forEach((e=>{const t=o.get(e.schemaId)??[];let n=!1;t.forEach((t=>{t.evict(e)&&(r.add(t),n=!0)})),n?i++:a++}));const s={"Eviction.EntriesEvicted":i,"Eviction.EntriesNotEvicted":a};e.mark("eviction",s);let l=0;r.forEach((e=>{const t=e.gc();l+=t.length}));const c={"Eviction.EntriesCollected":l};return e.mark("gc",c),this.logger.debug("Eviction results",{entriesEvicted:i,entriesNotEvicted:a,entriesGCed:l}),this.lastEvictionResult&&(this.lastEvictionResult.entriesEvicted+=i,this.lastEvictionResult.entriesNotEvicted+=a,this.lastEvictionResult.entriesGCed+=l),n}groupCachesBySchema(){const e=new Map;return this.clients.forEach((t=>{let n=e.get(t.schemaId);n||(n=new Set,e.set(t.schemaId,n)),n.add(t.cache)})),e}}var qg=n(537041),Jg=n(943380),Qg=n(255764);const Kg={possibleTypes:{MeetingCoordinates:["LegacyMeetingCoordinates","MeetingDataCoordinates"],CallingWindowingContentChangedEvent:["CallingWindowingConversationOrReplyChainContentUpdate","CallingWindowingContainerContent"],CallCreatedRemovedUpdatedEvent:["CallAdded","CallRemoved","CallUpdated"],CallingServiceEvent:["CallAdded","CallRemoved","CallUpdated","CallAlertsUpdated","CallDeviceListUpdated","ParticipantsOnCallConnected"],CallTransfer:["CallTransferred","CallTransferredFailed","CallTransferredSucceeded"],ParticipantsChangedEvent:["ParticipantsChanged","ParticipantCountsChanged"],CallContentSharingEvent:["CallContentSharingJoinIncomplete"],CallAudienceBotDataChannel:["CallAudienceSceneChanged","CallAudienceSelectSceneAck"],UserVideoBackgroundImageResult:["UserVideoBackgroundImage","UserVideoBackgroundImageError"],CortanaEvent:["CortanaInvocationStateChanged","CortanaStateChanged"],ExplicitRecordingConsentUpdateResult:["ExplicitRecordingConsentState","ExplicitRecordingConsentTransactionEnd"],ParkedCall:["RegularParkedCall","SLAParkedCall"],CallingAppEventType:["CallingContentEvent","CallingAppSetupEvent"],CallingContent:["AutoBrbDialogContent","CallingBannerContent","CallingBreakoutRoomPanelContent","CallingDialogContent","CallingLocalRecordingNotificationContent","CallingNotificationContent","CallingToChatContent","CallingToChatListContent","CallingToCallListContent","CallingToSettingsPaneContent","CallingWindowingContent","CrossCloudMeetingJoinContent","MainAppContent"],ThirdPartyDevicesEvent:["ThirdPartyDevicePairingRequest","ThirdPartyDeviceMeetingReactionRequest","ThirdPartyDeviceToggleRequest"],HolographicAnnotationEvent:["HolographicAnnotationCreatedEvent","HolographicAnnotationModifiedEvent","HolographicAnnotationRemovedEvent","HolographicInteractionEnabledEvent","HolographicInteractionInitializedEvent","HolographicInteractionComponentChangedEvent","HolographicSnapshotEnabledEvent","HolographicResetEvent","HolographicFreezeFrameEvent"],LiveMeetingStatusBarResult:["LiveMeetingStatusBarPayload","LiveMeetingError"],DismissedLiveMeetingsResult:["LiveMeetingStatusBarPayload","LiveMeetingError"],AddMeetingToLiveMeetingStatusBarResult:["AddMeetingToLiveMeetingStatusBarPayload","LiveMeetingError"],RemoveMeetingFromLiveMeetingStatusBarResult:["RemoveMeetingFromLiveMeetingStatusBarPayload","LiveMeetingError"],RemoveAllMeetingsFromLiveMeetingStatusBarResult:["RemoveAllMeetingsFromLiveMeetingStatusBarPayload","LiveMeetingError"],VideoBackgroundImageResult:["VideoBackgroundImage","VideoBackgroundImageError"],VideoEffectConfigChanged:["TouchUpToggleChanged","TouchUpStrengthChanged","AutoAdjustToggleChanged","EyeContactToggleChanged"],ContentSharingSession:["PptSharingSession","WhiteboardSharingSession"],ActionStatusEvent:["SendMessageActionData","ReactionsActionData","ErrorActionData"],CallCoordinates:["LegacyMeetingCoordinates","MeetingDataCoordinates","ExistingCallCoordinates","OneToOneCoordinates","GroupCallCoordinates","AgentMonitorSessionCoordinates"],CallJoinOptions:["JoinOptions","MeetingJoinOptions","OneToOneJoinOptions","GroupCallJoinOptions"],MeetingArtifactV2Union:["MeetingArtifactV2Transcript","MeetingArtifactV2TranscriptV2","MeetingArtifactV2Recording","MeetingArtifactV2Notes","MeetingArtifactV2MeetingContent","MeetingArtifactV2Default"],MeetingArtifactV2Interface:["MeetingArtifactV2Transcript","MeetingArtifactV2TranscriptV2","MeetingArtifactV2Recording","MeetingArtifactV2Notes","MeetingArtifactV2MeetingContent","MeetingArtifactV2Default"],IConnection:["ContactsSuggestionsConnection","ActiveDirectoryGroupConnection","ActiveDirectoryGroupMemberConnection","ActivitySliceListConnection","ActivitiesConnection","AppDetailsDiscoverMoreAppsDeveloperConnection","AppDetailsDiscoverMoreAppsCategoryConnection","AppReviewsConnection","AppReviewCommentsConnection","SearchUsersAndGroupsResultsConnection","CallHistoryConnection","PinnedPostsConnection","RecentFilesConnection","ReplyChainSummaryConnection","ReplyChainMessageConnection","CommentStreamMessageConnection","ExtensibilityAppPickerConnection","ReplyChainListConnection","SearchTeamConnection"],IEdge:["ContactsSuggestionsEdge","ActiveDirectoryGroupEdge","ActiveDirectoryGroupMemberEdge","ActivitySliceEdge","ActivityEdge","InstalledAppEdge","AppReviewEdge","AppReviewCommentEdge","SearchUsersAndGroupsResults","CallHistoryItemEdge","PinnedPostSummaryEdge","RecentSharedFilesEdge","ReplyChainSummaryEdge","ReplyChainMessagesEdge","CommentStreamMessageEdge","ExtensibilityAppPickerAppEdge","ReplyChainListItemEdge","SearchTeamsEdge"],IEdgeNode:["ContactsSuggestionsItem","GroupChatSuggestionsItem","Conversation","CallLogItem","PinnedPostSummary","ActiveDirectoryGroup","ActiveDirectoryGroupMember","ActivitySliceItem","FeedActivity","AppReview","AppReviewComment","InstalledApp","UsersAndGroupsSearchResult","RecentSharedFilesType","ReplyChainSummary","ReplyChainMessageNode","CommentStreamMessage","ReplyChainListItem","DiscoverTeamDetails"],IMessage:["Message","LastMessage","ReplyChainMessage","MeetingReplyMessage","StandardPostMessage","AnnouncementPostMessage","EmailPostMessage","MeetingPostMessage","ConnectorPostMessage","GuardiansPostMessage"],BaseTeam:["NonMemberSharedTeam","Team"],TeamUnion:["Team","NonMemberSharedTeam"],BaseChannel:["DeletedChannel","NonMemberChannel","Channel"],ChannelUnion:["Channel","DeletedChannel","NonMemberChannel"],ChannelEmailSettings:["ChannelEmailSettingsSuccess","ChannelEmailSettingsError"],ChannelSystemMessage:["BaseChannelSystemMessage","AddDeleteMemberSystemMessage","ChannelUpdatesSystemMessage","PinnedItemSystemMessage","ManageMembersSystemMessage","ChannelAddDeleteSystemMessage","SharedInSpacesSystemMessage","RoleUpdateSystemMessage","UpdateFavDefaultSystemMessage"],ChannelSystemMessageType:["BaseChannelSystemMessage","AddDeleteMemberSystemMessage","ChannelUpdatesSystemMessage","PinnedItemSystemMessage","ManageMembersSystemMessage","ChannelAddDeleteSystemMessage","SharedInSpacesSystemMessage","RoleUpdateSystemMessage","UpdateFavDefaultSystemMessage"],Dimension:["DimensionInFloat","DimensionInString"],CommunitiesUpdateEvent:["CommunitiesUpdate"],TeamsAndChannelsUpdateEvent:["TeamUpdate","ChannelUpdate"],TeamAndChannelListUpdateEvent:["TeamUpdate","ChannelUpdate"],PinnedConversationItemInfo:["Message"],CalendarMultiSlotEventPayload:["CalendarFormCacheSyncEvent","CalendarFormSpinnerEvent","CalendarFormShareDialogEvent","CalendarFormErrorEvent","CalendarToggleTabEvent"],InviteUsersToCommunityResponse:["CommunityResponse","InviteUsersToCommunityError"],CreateCommunityResponse:["Community","CreateCommunityPartialSuccessResponse","CreateCommunityErrorResponse"],MeetingRoomAppEventContent:["MeetingRoomMainWindowNavigationEventContent","MeetingRoomFrontOfRoomWindowEventContent","MeetingRoomAppSetupEventContent"],MeetingRoomMainWindowNavigationParams:["RigelConsoleBroadcastParams","RigelConsolePreCallParams","RigelConsolePostCallParams","RigelConsoleJoinbyCodeParams","RigelConsoleParams","MeetingRoomMainWindowNavigationNoParams"],Mentionable:["TagCard","User","ChannelMentionSearchResult","AppDefinition","CommandDefinition"],ActivityReadStatusUpdate:["FeedActivity","ActivityReadStatusUpdateError"],ActivityContextualSettingsResponseType:["ActivityContextualSettingsUpdatedResponse","ActivityContextualSettingsNotUpdatedResponse"],ActivityMAARResponse:["MarkAllActivitiesAsReadSuccess","MarkAllActivitiesAsReadError"],ActivityMAARStatus:["MarkAllActivitiesAsReadSuccess","MarkAllActivitiesAsReadError"],ActivityFeedItemDeletionResult:["ActivityFeedItemDeletionErrorResult","DeletedActivityInfo"],FeedLocationLocaleParams:["DefaultFeedLocaleParams","ChannelFeedLocationLocaleParams","CommunitiesFeedLocationLocaleParams"],FeedTitleLocaleParams:["DefaultFeedLocaleParams","ChannelFeedTitleLocaleParams","CommunitiesFeedTitleLocaleParams"],MeetingThreadInstallOption:["ChannelMeetingThreadInstallOption","ChatMeetingThreadInstallOption"],AppInstallOptionMeeting:["AppInstallOptionChannelMeeting","AppInstallOptionChatMeeting"],M365Application:["M365HubApplication","M365PlatformApplication"],M365AppLink:["M365PlatformAppLink"],M365ApplicationIcon:["InternalIcon","RemoteImage"],M365ApplicationBadge:["M365ApplicationNumericBadge","M365ApplicationDotBadge","M365ApplicationStringBadge"],EventTrigger:["AppAcquisitionLink","AppSecondaryAction"],CopilotCommandType:["BlurVideoCommand","CreateMeetingCommand","CreateWhiteboardCommand","FindFilesCommand","NudgeUserCommand"],InvokeAdaptiveCardTabResult:["AdaptiveCardTabContinue","AdaptiveCardTabDone","AdaptiveCardTabAuth"],InvokeTaskModuleResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone"],MessageExtensionTaskResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone","MessageExtensionResult"],BotConfigTaskResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone","BotConfigResult"],AdaptiveCardTabTaskResult:["TaskModuleTaskContinue","TaskModuleTaskMessage","TaskModuleTaskDone","AdaptiveCardTabContinue"],CalendarSyncPayloads:["CalendarSyncPayload","ConnectedCalendarSyncPayload","MultiCalendarSyncPayload","CalendarLeftRailSettingsSyncPayload"],CalendarCreateUpdateEventResult:["CalendarEvent","CalendarErrorResponse"],ClassicalAttachmentContentResult:["ClassicalAttachmentContentBytesPayload","CalendarErrorResponse"],GroupCalendarEventsResult:["FilteredEvents","CalendarErrorResponse"],UnifiedCalendarEventsResult:["CalendarEvents","CalendarErrorResponse"],CalendarSettingsUpdateResult:["CalendarSettings","CalendarErrorResponse"],IPostMessage:["StandardPostMessage","AnnouncementPostMessage","EmailPostMessage","MeetingPostMessage","ConnectorPostMessage","GuardiansPostMessage"],ChannelPostMessage:["StandardPostMessage","AnnouncementPostMessage","EmailPostMessage","MeetingPostMessage","ConnectorPostMessage","GuardiansPostMessage"],ChannelReplyMessage:["ReplyChainMessage","MeetingReplyMessage"],ChannelMessage:["ReplyChainMessage","MeetingReplyMessage","StandardPostMessage","AnnouncementPostMessage","EmailPostMessage","MeetingPostMessage","ConnectorPostMessage","GuardiansPostMessage"],LastConversationUpdate:["LastMessage","Presence"],ConversationPinnedResult:["ConversationPinnedUpdate","SetChatPinnedMaxLimitReachedError"],ChatServiceEvent:["NewMessage","MessageUpdate","ThreadUpdate","ConversationUpdate","ConversationFullUpdate","ConsumptionHorizonUpdate","ResolveConversationLie","DiscardConversation","NotificationUpdate","CommentStreamEvent"],ChatListItem:["Conversation","ChatListChannelConversation"],SharedItemNode:["FileItemNode","LinkItemNode"],ChatPinnedMessageEvent:["ChatPinnedMessageAddedEvent","ChatPinnedMessageRemovedEvent"],FeaturedCommunityResponse:["FeaturedCommunitySuccess","FeaturedCommunityError"],MemberRoleUpdateResult:["Communities","MemberRoleUpdateError"],CommunitiesEditResponse:["Communities","CommunitiesEditErrorResponse"],CommunityEditNicknameResponse:["CommunityMember","CommunitiesEditNicknameErrorResponse"],CommunityCreateChannelResponse:["CommunityChannel","CommunityCreateChannelPartialSuccessResponse","CommunityCreateChannelErrorResponse"],ImageBlobURI:["Image","ThumbnailImage"],Overview:["OverviewEntry","DeviceDetailEntry"],TechSpecs:["TechSpecEntry","DeviceDetailEntry"],DiscoverSurfaceContainerEntity:["DiscoverSurfaceContainerEntityChannel"],DiscoverSurfaceUserPreferenceForEntity:["DiscoverSurfaceUserPreferenceForEntityActorKind","DiscoverSurfaceUserPreferenceForEntityContainerKind"],SelectorResolutionResult:["SelectorResolution","EspTargetError"],EspResource:["EspNotLocalizedResource","EspLocalizedResource"],EspUserInterfaceControl:["EspTextControl","EspImageControl","EspVideoControl","EspButtonControl","EspSpaceControl","EspInfoItemControl"],EspSurfaceParams:["EspModalParams","EspCoachmarkParams","EspNotificationParams","EspTfwNotificationParams","EspQuickGuideParams","EspIrisParams","EspEntityCommandParams"],EspAction:["EspNoParamsAction","EspEntityCommandAction","EspDeeplinkNavigationAction","EspFollowUpSurfaceAction","EspFollowUpModalAction","EspUrlNavigationAction"],SetExternalCalendarEmailAddressResult:["User","SetExternalCalendarEmailAddressError"],GuardiansChatIdResult:["GuardiansChatIdSuccess","GuardiansChatIdNotFoundError"],InviteRedeemResponse:["InviteRedeemResponseSuccess","InviteRedeemError"],LiveMeetingStatusBarEvent:["LiveMeeting","UserCallJoinEvent"],ClientPreferenceCategoryTypes:["AnimationPreferences","DensityPreferences","FlyoutCameraPreferences","InfoPanePreferences","SidePanePreferences","PerformancePreferences","OptimizedPerfPreferences","AppSwitcherPreferences","ThemePreferences","VideoEffectPreferences","BackgroundEffectPreferences","AvatarPreferences","PromoBadgePreferences","TeamLayoutPreferences","DiagnosticsLogsPreferences","WindowingPreferences","LockScreenInCallPreferences","MessagePreviewsPreferences","ComposeSpellcheckPreferences","PeopleAppColumnsPreferences","SimpleCollabPreferences","StaticNowCardsPreferences"],CalendarUpdateEventResult:["CalendarEvent","CalendarErrorResponse"],Mentionable3:["TagCard","User","ChannelMentionSearchResult3","AppDefinition","CommandDefinition"],EmojiSearchResult:["EmojiCategoryConnection","EmojiConnection"],CustomEmojiCreationResponse:["CustomEmoji","CustomEmojiMetadataCreationError"],Emoji:["TeamsEmoji","CustomEmoji"],NotificationsEngineData:["NotificationXDaysOfInactiveStatus","NotificationTflMeetingLinks","NotificationConversationsReminder"],BaseTabInterface:["ExtensionTab","CalendarTab","StaticExtensionTab","BasicTab","FileViewTab","DocumentLibraryTab","LegacyDocumentLibraryTab","OneNoteTab","PowerBiTab","WikiTab","LegacyWikiTab","WebsiteTab","PlaceholderTab"],PlatformTabsConnectionEvent:["PlatformTabAddedEvent","PlatformTabsConnectionUpdatedEvent"],PlatformTab:["BasicTab","ExtensionTab","WikiTab","FileViewTab","PowerBiTab","WebsiteTab","DocumentLibraryTab","OneNoteTab","StaticExtensionTab","LegacyWikiTab","LegacyDocumentLibraryTab","PlaceholderTab","CalendarTab"],PlatformTabsConnection:["ChannelTabsConnection"],PresenceError:["PresenceErrorGeneric","PresenceErrorNetworkOffline"],PresenceResult:["PresenceSuccess","PresenceErrorNetworkOffline","PresenceErrorGeneric"],SBGroupLayout:["SBGroupLayoutSingleRenderer","SBGroupLayoutMultiRenderer"],CalendarInsight:["Quorum","OutOfRoutine","Conflicts"],CalendarArtifact:["AttachmentGroupType","RelatedEmailType"],AllSearchResults:["SearchMessageResult","SearchFileResult","PeopleSearchResult","SearchEmailResult","SearchTeamsChannelsResult","SearchGroupResult"],SmartRepliesResult:["SmartRepliesNavigatorResult","SmartRepliesSuggestionsResult"],RestoreChannelResponse:["Channel","RestoreChannelError"],CreateChannelResponseV2:["Channel","CreateK2ChannelResponse","CreateChannelConversationError"],UpdateMuteForThreadMemberResult:["ThreadMember","UpdateMuteForThreadMemberError"],UpdateMuteForTeamResult:["MuteTeamResult","UpdateMuteForTeamError"],TflFeaturedItem:["TflMeetingLinkInfo","CalendarEvent","StaticNowCards","TflNoForYouCardInfo"],TflForYouMeetingInfo:["TflMeetingLinkInfo","TflNoForYouCardInfo"],TflForYouScheduledMeetingInfo:["CalendarEvent","TflNoForYouCardInfo"],TflForYouStaticNowCardInfo:["StaticNowCard","TflNoForYouCardInfo"],UserPreferencesCategoryValue:["PersonalFileSiteDetailsValue","UserSettingsValue","FirstLoginInformationValue","ReadReceiptsEnabledValue","IsSingleUserTenantValue","CortanaSettingsValue","ControllerConnectedServicesEnabledValue","SuggestedRepliesSettingsValue","SuggestedScheduleMessageDeliverySettings","TranslationSettingsValue","FavoritesValue","TeamOrdersValue","AutoUnfavoriteTeamsValue","ShowInMeetingReportValue","MobileContactsSyncValue","UserPinnedAppValue","CallAccessibilitySettingsValue","TranscriptAndCaptionSettingsValue","SelfChatSettingsValue","EnableChannelsV2Value","SimpleCollabUserSettingsValue","VivaTopicsSettingsValue","EduSimplifiedUxListDefaultValue","PreferredSkinToneIndexValue","UserEnableSurveysNotificationValue","ApplicationIntegrationValue","RccViewSettingsValue","PhonelinkSmsPairingDeviceIdValue","DefaultMessageReactionsValue","AppConsumptionHorizonValue","LastStaleTeamsRunJobTimestampValue","StaleTeamsConsumptionTimestampValue","EnablePushToTalkValue"],UserPreferencesResponse:["UserPreferences","UserPreferencesError"],UpdateUserResponse:["User","UpdateUserError"],Node:["OneGQL_Person","OneGQL_Me","OneGQL_UnifiedGroup","OneGQL_MePresence","OneGQL_PersonPresence","OneGQL_Tenant","OneGQL_SystemDefinedConversationFolder","OneGQL_UserDefinedConversationFolder","OneGQL_OneOnOneChatConversation","OneGQL_BotChatConversation","OneGQL_Call","OneGQL_ChannelConversation","OneGQL_DeletedChannel","OneGQL_NonMemberChannel","OneGQL_SelfChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_ConversationMessage","OneGQL_UnjoinedChannelMessage","OneGQL_NonMemberTeam","OneGQL_Team","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation","QueueRealTime","QueueRealTimeAutoAttendant","QueueRealTimeCallQueue","QueueRealTimeAgent","QueueRealTimeAllAgentsSummary"],ConnectionEdge:["OneGQL_PersonContactEdge","OneGQL_PersonaOrganizationEdge","QueueRealTimeAgentEdge","QueueRealTimeCallQueueEdge","QueueRealTimeAutoAttendantEdge"],ConnectionEdgeWithCursorPagination:["OneGQL_PersonContactEdge","OneGQL_PersonaOrganizationEdge","QueueRealTimeAgentEdge","QueueRealTimeCallQueueEdge","QueueRealTimeAutoAttendantEdge"],Connection:[],ConnectionWithCursorPagination:["OneGQL_PersonContactConnection","OneGQL_PersonaOrganizationConnection","QueueRealTimeAgentConnection","QueueRealTimeCallQueueConnection","QueueRealTimeAutoAttendantConnection","SpeedDialContactsConnection"],MutationFailure:["OneGQL_AddPersonToFavoritesError","OneGQL_RemovePersonFromFavoritesError","OneGQL_BlockPersonError","OneGQL_UnblockPersonError","OneGQL_AddTagForPersonFailure","OneGQL_RemoveTagFromPersonFailure","OneGQL_ContactMutationErrorGeneric","OneGQL_ContactMutationErrorNetworkOffline","OneGQL_AddPersonToSpeedDialMutationError","OneGQL_RemovePersonFromSpeedDialMutationError","OneGQL_PresenceMutationFailure","OneGQL_PresenceMutationFailureNetworkOffline","QueueRealTimeError","SpeedDialContactsError"],OneGQL_NodeWithContacts:["OneGQL_Me"],OneGQL_AddPersonToFavoritesMutationResult:["OneGQL_AddPersonToFavoritesSuccess","OneGQL_AddPersonToFavoritesError"],OneGQL_RemovePersonFromFavoritesMutationResult:["OneGQL_RemovePersonFromFavoritesSuccess","OneGQL_RemovePersonFromFavoritesError"],OneGQL_BlockPersonMutationResult:["OneGQL_BlockPersonSuccess","OneGQL_BlockPersonError"],OneGQL_UnblockPersonMutationResult:["OneGQL_UnblockPersonSuccess","OneGQL_UnblockPersonError"],OneGQL_AddTagForPersonMutationResult:["OneGQL_AddTagForPersonSuccess","OneGQL_AddTagForPersonFailure"],OneGQL_RemoveTagFromPersonMutationResult:["OneGQL_RemoveTagFromPersonSuccess","OneGQL_RemoveTagFromPersonFailure"],OneGQL_Individual:["OneGQL_Person","OneGQL_Me"],OneGQL_PersonaComplexTypeBaseRaw:["OneGQL_PersonNameRaw","OneGQL_PersonaPhoneRaw","OneGQL_PersonaEmailAddressRaw","OneGQL_PersonaImAddressRaw","OneGQL_PersonaWebsiteRaw","OneGQL_PersonAnnotationRaw","OneGQL_PersonaAddressRaw","OneGQL_PersonWorkPositionRaw","OneGQL_PersonRelatedEntityRaw","OneGQL_PersonAnniversaryRaw","OneGQL_PersonTag","OneGQL_PersonCustomAttribute"],OneGQL_PersonaComplexTypeBaseDeduplicated:["OneGQL_PersonName","OneGQL_PersonaPhone","OneGQL_PersonaEmailAddress","OneGQL_PersonaImAddress","OneGQL_PersonaWebsite","OneGQL_PersonAnnotation","OneGQL_PersonaAddress","OneGQL_PersonWorkPosition","OneGQL_PersonRelatedEntity","OneGQL_PersonAnniversary"],OneGQL_PersonNameBase:["OneGQL_PersonNameRaw","OneGQL_PersonName"],OneGQL_PersonaPhoneBase:["OneGQL_PersonaPhoneRaw","OneGQL_PersonaPhone"],OneGQL_PersonaEmailAddressBase:["OneGQL_PersonaEmailAddressRaw","OneGQL_PersonaEmailAddress"],OneGQL_PersonaImAddressBase:["OneGQL_PersonaImAddressRaw","OneGQL_PersonaImAddress"],OneGQL_PersonaWebsiteBase:["OneGQL_PersonaWebsiteRaw","OneGQL_PersonaWebsite"],OneGQL_PersonAnnotationBase:["OneGQL_PersonAnnotationRaw","OneGQL_PersonAnnotation"],OneGQL_PersonaAddressBase:["OneGQL_PersonaAddressRaw","OneGQL_PersonaAddress"],OneGQL_PersonWorkPositionBase:["OneGQL_PersonWorkPositionRaw","OneGQL_PersonWorkPosition"],OneGQL_PersonRelatedEntityBase:["OneGQL_PersonRelatedEntityRaw","OneGQL_PersonRelatedEntity"],OneGQL_PersonAnniversaryBase:["OneGQL_PersonAnniversaryRaw","OneGQL_PersonAnniversary"],OneGQL_ContactMutationResult:["OneGQL_ContactMutationErrorGeneric","OneGQL_ContactMutationErrorNetworkOffline","OneGQL_ContactMutationSuccess"],OneGQL_EntityWithPersonaPhoto:["OneGQL_Person","OneGQL_Me","OneGQL_UnifiedGroup","OneGQL_OneOnOneChatConversation","OneGQL_BotChatConversation","OneGQL_ChannelConversation","OneGQL_SelfChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_NonMemberTeam","OneGQL_Team","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation"],OneGQL_Persona:["OneGQL_Person","OneGQL_Me","OneGQL_UnifiedGroup"],OneGQL_AddPersonToSpeedDialMutationResult:["OneGQL_AddPersonToSpeedDialMutationSuccess","OneGQL_AddPersonToSpeedDialMutationError"],OneGQL_RemovePersonFromSpeedDialMutationResult:["OneGQL_RemovePersonFromSpeedDialMutationSuccess","OneGQL_RemovePersonFromSpeedDialMutationError"],OneGQL_Presence:["OneGQL_MePresence","OneGQL_PersonPresence"],OneGQL_PresenceStatusNoteExpiry:["OneGQL_PresenceStatusNoteExpiryCustom","OneGQL_PresenceStatusNoteExpiryPreDefined"],OneGQL_PresenceMutationResult:["OneGQL_PresenceMutationFailure","OneGQL_PresenceMutationFailureNetworkOffline","OneGQL_PresenceMutationSuccess"],OneGQL_ConversationUpdate:["OneGQL_MePresence","OneGQL_PersonPresence","OneGQL_ConversationFolderActivityStatusUpdate","OneGQL_ConversationFolderUpdateEvent","OneGQL_ConversationFoldersOrderUpdate","OneGQL_ChannelActivityEvent","OneGQL_NewMessageEvent","OneGQL_MessageReadEvent","OneGQL_TeamAddEvent","OneGQL_TeamReorderEvent","OneGQL_TeamRemoveEvent","OneGQL_NoOpEvent","OneGQL_ConversationAddEvent","OneGQL_ConversationRemoveEvent","OneGQL_ChatReorderEvent","OneGQL_ChannelAddEvent","OneGQL_ChannelRemoveEvent","OneGQL_ConversationUpdateEvent","OneGQL_ConversationAddToRecentEvent","OneGQL_ConversationRemoveFromRecentEvent","OneGQL_ChannelUpdateEvent","OneGQL_ConversationFolderAddEvent","OneGQL_ConversationFolderRemoveEvent","OneGQL_ShowHiddenChannelEvent","OneGQL_ChannelHideEvent","OneGQL_TeamHideEvent","OneGQL_ShowHiddenTeamEvent","OneGQL_ShowOnlyChannelsWithUnreadPersonalMentionEvent","OneGQL_RecentChannelsAddEvent","OneGQL_RecentChannelsRemoveEvent","OneGQL_RecentChannelsReorderEvent","OneGQL_ConversationFolderSortEvent","OneGQL_FolderViewTypeUpdateEvent"],OneGQL_SetFolderViewTypeResult:["OneGQL_SetFolderViewTypeSuccess","OneGQL_SetFolderViewTypeError"],OneGQL_ConversationFolder:["OneGQL_SystemDefinedConversationFolder","OneGQL_UserDefinedConversationFolder"],OneGQL_BaseConversationFolder:["OneGQL_SystemDefinedConversationFolder","OneGQL_UserDefinedConversationFolder"],OneGQL_ConversationFoldersResult:["OneGQL_ConversationFoldersConnection","OneGQL_ConversationFoldersError"],OneGQL_CreateConversationFolderResult:["OneGQL_ConversationFoldersEdge","OneGQL_CreateConversationFolderError"],OneGQL_RemoveConversationFolderResult:["OneGQL_RemoveConversationFolderSuccess","OneGQL_RemoveConversationFolderError"],OneGQL_RemoveConversationFromFolderResult:["OneGQL_RemoveConversationFromFolderSuccess","OneGQL_RemoveConversationFromFolderError"],OneGQL_SetConversationTeamExpandedStateResult:["OneGQL_Team","OneGQL_SetConversationTeamExpandedStateError"],OneGQL_ReorderConversationFoldersResult:["OneGQL_ConversationFoldersConnection","OneGQL_ReorderConversationFoldersError"],OneGQL_SetConversationFolderExpandedStateResult:["OneGQL_ConversationFoldersEdge","OneGQL_SetConversationFolderExpandedStateError"],OneGQL_MoveItemToConversationFolderResult:["OneGQL_MoveItemToConversationFolderSuccess","OneGQL_MoveItemToConversationFolderError"],OneGQL_DndItemToConversationFolderResult:["OneGQL_DndItemToConversationFolderSuccess","OneGQL_DndItemToConversationFolderError"],OneGQL_RenameConversationFolderResult:["OneGQL_UserDefinedConversationFolder","OneGQL_RenameConversationFolderError"],OneGQL_SetChannelRecommendationResult:["OneGQL_ChannelConversation","OneGQL_SetChannelRecommendationError"],OneGQL_ReorderConversationFolderListResult:["OneGQL_ReorderConversationFolderListSuccess","OneGQL_ReorderConversationFolderListError"],OneGQL_BaseConversation:["OneGQL_OneOnOneChatConversation","OneGQL_BotChatConversation","OneGQL_ChannelConversation","OneGQL_SelfChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_Team","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation"],OneGQL_BaseChatConversation:["OneGQL_OneOnOneChatConversation","OneGQL_BotChatConversation","OneGQL_SelfChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation"],OneGQL_SinglePartyConversation:["OneGQL_OneOnOneChatConversation","OneGQL_BotChatConversation"],OneGQL_MultiPartyConversation:["OneGQL_ChannelConversation","OneGQL_Team"],OneGQL_Conversation:["OneGQL_OneOnOneChatConversation","OneGQL_GroupChatConversation","OneGQL_ChannelConversation","OneGQL_Team","OneGQL_MeetingChatConversation","OneGQL_SelfChatConversation","OneGQL_BotChatConversation","OneGQL_NoOpEvent","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation"],OneGQL_ChatConversation:["OneGQL_OneOnOneChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_SelfChatConversation","OneGQL_BotChatConversation","OneGQL_NewChatConversation","OneGQL_BizChatMetaOSConversation"],OneGQL_BaseConversationActivityStatus:["OneGQL_ChannelConversationActivityStatus","OneGQL_ChatConversationActivityStatus","OneGQL_TeamActivityStatus"],OneGQL_Channel:["OneGQL_ChannelConversation","OneGQL_DeletedChannel","OneGQL_NonMemberChannel"],OneGQL_BaseChannel:["OneGQL_ChannelConversation","OneGQL_DeletedChannel","OneGQL_NonMemberChannel"],OneGQL_ConversationMessageUnion:["OneGQL_ConversationMessage","OneGQL_UnjoinedChannelMessage"],OneGQL_BaseTeam:["OneGQL_NonMemberTeam","OneGQL_Team"],OneGQL_ToggleChannelVisibilityResult:["OneGQL_ChannelConversation","OneGQL_ToggleChannelVisibilityError"],OneGQL_RestoreArchivedChannelResult:["OneGQL_ChannelConversation","OneGQL_RestoreArchivedChannelError"],OneGQL_ToggleTeamVisibilityResult:["OneGQL_Team","OneGQL_ToggleTeamVisibilityError"],OneGQL_SetChatConversationMuteStatusResult:["OneGQL_OneOnOneChatConversation","OneGQL_GroupChatConversation","OneGQL_MeetingChatConversation","OneGQL_BotChatConversation","OneGQL_SetChatConversationMuteStatusError"],OneGQL_SetBotChatConversationBlockStatusResult:["OneGQL_BotChatConversation","OneGQL_SetBotChatConversationBlockStatusError"],OneGQL_SetConversationConsumptionHorizonBookmarkResult:["OneGQL_SetConversationConsumptionHorizonBookmarkSuccess","OneGQL_SetConversationConsumptionHorizonBookmarkError"],OneGQL_SetConversationConsumptionHorizonResult:["OneGQL_SetConversationConsumptionHorizonSuccess","OneGQL_SetConversationConsumptionHorizonError"],OneGQL_SetDiscardDraftChatResult:["OneGQL_SetDiscardDraftChatSuccess","OneGQL_SetDiscardDraftChatError"],OneGQL_SortConversationFolderResult:["OneGQL_SortConversationFolderSuccess","OneGQL_SortConversationFolderError"],QueueRealTimeEntityDetail:["QueueRealTimeCallQueue","QueueRealTimeAgent","QueueRealTimeAutoAttendant","QueueRealTimeAllAgentsSummary","QueueRealTimeError"],QueueRealTimeResult:["QueueRealTime","QueueRealTimeError"],QueueAnalyticsChartingWidget:["QueueAnalyticsDonutWidget","QueueAnalyticsSimpleCardWidget","QueueAnalyticsStackedBarWidget","QueueAnalyticsColumnChartWidget","QueueAnalyticsBarChartWidget","QueueAnalyticsLineChartWidget"],QueueAnalyticsChartWidgetSeries:["QueueAnalyticsColumnChartWidgetSeries","QueueAnalyticsLineChartWidgetSeries","QueueAnalyticsBarChartWidgetSeries"],SetSpeedDialSystemTagMutationResult:["SetSpeedDialSystemTagMutationSuccess","SpeedDialContactsError"],SpeedDialContactsResult:["SpeedDialContactsError","SpeedDialContactsConnection"],VirtualConsumerEventResult:["VirtualConsumerEvent","VirtualConsumerEventsError"],VirtualConsumerEventsResult:["VirtualConsumerEvents","VirtualConsumerEventsError"]}}.possibleTypes;var Yg=n(676518),Xg=n(948281),Zg=n(103931),eh=n(908340),th=n(701429);function nh(e){return function(t,{args:n,toReference:i,canRead:a}){if(a(t))return t;const o=e(n);return a(o)?i(o):void 0}}const ih={merge:["callTranscriptState","activeWindow","activeWindowForEntity","messages","userPreferences"],replace:["activeWindows","callingAlerts","workWeekDays","dateRange","activeCalls","listBreakoutRoomsWithDetails"]},ah={Query:{fields:{user:nh((e=>({__typename:"User",id:e?.userId}))),presence:nh((e=>({__typename:"Presence",id:`${e?.userId}_ups`}))),call:nh((e=>({__typename:"Call",id:e?.id}))),streamDetails:nh((e=>({__typename:"StreamDetailsInfo",id:e?.id}))),breakoutRoomsDetails:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]],read:nh((e=>({__typename:"BreakoutRoomsDetails",id:e?.coordinates.threadId})))},extensibilityAppPicker:{keyArgs:["scope","conversationId","config"]},searchForMentionV2:{keyArgs:["teamId","searchQuery","includeBots","channelText","teamText","generalText","channelType","hostTenantId","enableScheduledTags","enableOwnersTag"]},breakoutRoomSettings:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},listBreakoutRoomsWithDetails:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},breakoutRoomsClientState:{keyArgs:["coordinates",["messageId","organizerId","tenantId","threadId"]]},localizationSettings:{keyArgs:["currentLocale"]},prejoinState:{merge:(e,t,{mergeObjects:n})=>t?.timestamp&&e?.timestamp&&t.timestamp<e.timestamp?e:n(e,t)},searchConversation:{keyArgs:["searchTerm","conversationId","filters","isFromTopics"],merge:(e,t)=>t?e?{...t,Results:[...e.Results,...t.Results]}:t:e},searchConversationTopics:{keyArgs:["searchTerm","conversationId","filters","isFromTopics"],merge:(e,t)=>t?e?{...t,Results:[...e.Results,...t.Results]}:t:e},myGroupSettings:{merge:(e,t)=>{if(!t)return[...e];if(!e)return[...t];return[{...t[0],...e[0]}]}},...ih.merge.reduce(((e,t)=>({[t]:{merge:!0},...e})),{}),...ih.replace.reduce(((e,t)=>({[t]:{merge:!1},...e})),{})}},Subscription:{fields:{chatServiceEvent:{merge:!1},callRecordingStateChangedEvent:{merge:!1},callingServiceEvent:{merge:!1}}},CallParticipantsCounts:{keyFields:["teamsCallId"]},ParticipantCountsChanged:{keyFields:["teamsCallId"]},ParticipantsChanged:{keyFields:["teamsCallId"]},MessagesResult:{keyFields:!1},WindowHistoryItem:{keyFields:!1},SelectedDevices:{keyFields:!1},Window:{fields:{windowHistory:{merge:!1},activeEntities:{merge:!0},correlation:{merge:!0},extendedEntityContainerState:{merge:!0}}},DeviceList:{fields:{cameras:{merge:!1},camerasSupportingAutoFraming:{merge:!1},microphones:{merge:!1},selectedDevices:{merge:!0}}},Call:{fields:{extendedCallType:{merge:!0},capabilities:{merge:!0},breakoutRoomDetails:{merge:!0}}},RoomCoordinates:{keyFields:["threadId"]},BasicParticipant:{keyFields:["participantId"]},BreakoutRoomsDetails:{fields:{breakoutRooms:{merge:!1}}},BreakoutRoom:{fields:{clientActionState:{read:e=>e||null},participants:{merge:!1}}},CalendarEvent:{keyFields:["objectId"]},InDayEvents:{keyFields:["mailboxAddress","date"],fields:{events:{merge:!1}}},AllDayEvents:{keyFields:["mailboxAddress","date"],fields:{events:{merge:!1}}},Building:{keyFields:["address"]},RecurrenceEvents:{keyFields:["mailboxAddress","cleanGlobalObjectId"]},MeetingCompositeKey:{keyFields:["conversationId","messageId","eventId","modifiedStamp"]},Translation:{keyFields:!1},DiagnosticInfo:{keyFields:!1},EmailUser:{keyFields:["smtp"]},AuthenticationUserProfile:{keyFields:["objectId","tenantId"]},FluidPendingMention:{keyFields:["atMentionId"]},Participant:{keyFields:["participantId"]},Rectangle:{keyFields:!1},AudienceSceneExtent:{keyFields:!1},AudienceSceneParticipant:{keyFields:!1},ChatMessageMentionType:{keyFields:!1},Feed:{fields:{section:{keyArgs(e,{variables:t}){if(t)return t.section},merge:(e,t)=>e?t?.deltaRequestDetails?.deltaRequestId&&t.deltaRequestDetails.deltaRequestId===e?.requestId?{...t,dataReceivedOnClientTimestamp:e.dataReceivedOnClientTimestamp,items:[...e.items,...t.items]}:t?.deltaRequestDetails?.deltaRequestId===e?.deltaRequestDetails?.deltaRequestId&&t?.requestId===e?.requestId?t:t.deltaRequestDetails?.deltaRequestId?e:t:t}}},FeedItemType:{keyFields:["uri"]},FilesListResult:{keyFields:["threadId"]},PaymentDetails:{keyFields:["eventId"]},Channel:{fields:{defaultFileSettings:{merge:!0},membershipSummary:{merge:!0},spaceAdminSettings:{merge:!0}}},Team:{fields:{membershipSummary:{merge:!0},teamSettings:{merge:!0},teamGuestSettings:{merge:!0},teamSiteInformation:{merge:!0},sensitivityLabel:{merge:!0}}},TeamSettings:{fields:{funControl:{merge:!0}}},OneGQL_ViewData:{merge:!0},OneGQL_SimpleCollabViewData:{merge:!0},OneGQL_SimpleCollabLeftRailViewData:{merge:!0},OneGQL_ChannelCardViewData:{merge:!0},OneGQL_ChannelCardHeaderViewData:{merge:!0},OneGQL_ChannelCardContentViewData:{merge:!0},OneGQL_Person:{merge:!0},OneGQL_Timespan:{merge:!0},OneGQL_TimeZone:{merge:!0},OneGQL_Duration:{merge:!0},OneGQL_Me:{merge:!0},OneGQL_PersonContactConnection:{merge:!0},OneGQL_PersonContactEdge:{merge:!0},OneGQL_PersonContactFilterAggregation:{merge:!0},OneGQL_AddPersonToFavoritesError:{merge:!0},OneGQL_AddPersonToFavoritesSuccess:{merge:!0},OneGQL_RemovePersonFromFavoritesError:{merge:!0},OneGQL_RemovePersonFromFavoritesSuccess:{merge:!0},OneGQL_BlockPersonError:{merge:!0},OneGQL_BlockPersonSuccess:{merge:!0},OneGQL_UnblockPersonError:{merge:!0},OneGQL_UnblockPersonSuccess:{merge:!0},OneGQL_AddTagForPersonSuccess:{merge:!0},OneGQL_AddTagForPersonFailure:{merge:!0},OneGQL_RemoveTagFromPersonSuccess:{merge:!0},OneGQL_RemoveTagFromPersonFailure:{merge:!0},OneGQL_PersonSkill:{merge:!0},OneGQL_PersonTopic:{merge:!0},OneGQL_PersonExtendedUserInfo:{merge:!0},OneGQL_PersonTopicSuggestion:{merge:!0},OneGQL_PersonaOrganizationConnection:{merge:!0},OneGQL_PersonaOrganizationEdge:{merge:!0},OneGQL_PersonRawCollections:{merge:!0},OneGQL_PersonNameRaw:{merge:!0},OneGQL_PersonName:{merge:!0},OneGQL_PersonPhoneticName:{merge:!0},OneGQL_PersonaPhoneRaw:{merge:!0},OneGQL_PersonaPhone:{merge:!0},OneGQL_PersonaEmailAddressRaw:{merge:!0},OneGQL_PersonaEmailAddress:{merge:!0},OneGQL_PersonaImAddressRaw:{merge:!0},OneGQL_PersonaImAddress:{merge:!0},OneGQL_PersonaWebsiteRaw:{merge:!0},OneGQL_PersonaWebsite:{merge:!0},OneGQL_PersonAnnotationRaw:{merge:!0},OneGQL_PersonAnnotation:{merge:!0},OneGQL_PersonaAddressRaw:{merge:!0},OneGQL_PersonaAddress:{merge:!0},OneGQL_PersonaAddressDetail:{merge:!0},OneGQL_PersonaGeoCoordinates:{merge:!0},OneGQL_PersonWorkPositionRaw:{merge:!0},OneGQL_PersonWorkPosition:{merge:!0},OneGQL_PersonPositionDetail:{merge:!0},OneGQL_PersonCompanyDetail:{merge:!0},OneGQL_PersonRelatedEntityRaw:{merge:!0},OneGQL_PersonRelatedEntity:{merge:!0},OneGQL_PersonAnniversaryRaw:{merge:!0},OneGQL_PersonAnniversary:{merge:!0},OneGQL_PersonTag:{merge:!0},OneGQL_PersonCustomAttribute:{merge:!0},OneGQL_ContactMutationSuccess:{merge:!0},OneGQL_ContactMutationErrorGeneric:{merge:!0},OneGQL_ContactMutationErrorNetworkOffline:{merge:!0},OneGQL_PersonaPhoto:{merge:!0},OneGQL_PersonaCoin:{merge:!0},OneGQL_PersonaTimespan:{merge:!0},OneGQL_AddPersonToSpeedDialMutationError:{merge:!0},OneGQL_RemovePersonFromSpeedDialMutationError:{merge:!0},OneGQL_AddPersonToSpeedDialMutationSuccess:{merge:!0},OneGQL_RemovePersonFromSpeedDialMutationSuccess:{merge:!0},OneGQL_UnifiedGroup:{merge:!0},OneGQL_PresenceAvailability:{merge:!0},OneGQL_PresenceOutOfOfficeStatus:{merge:!0},OneGQL_PresenceForcedAvailability:{merge:!0},OneGQL_PresenceStatusNote:{merge:!0},OneGQL_PresenceStatusNoteExpiryPreDefined:{merge:!0},OneGQL_PresenceStatusNoteExpiryCustom:{merge:!0},OneGQL_PresenceShifts:{merge:!0},OneGQL_PresenceShift:{merge:!0},OneGQL_PresenceWorkLocation:{merge:!0},OneGQL_MePresence:{merge:!0},OneGQL_PersonPresence:{merge:!0},OneGQL_PresenceMutationSuccess:{merge:!0},OneGQL_PresenceMutationFailure:{merge:!0},OneGQL_PresenceMutationFailureNetworkOffline:{merge:!0},OneGQL_ContactsMutationEventResult:{merge:!0},OneGQL_PresenceAvailabilityEventResult:{merge:!0},OneGQL_MembershipSummary:{merge:!0},OneGQL_ConversationSensitivityLabel:{merge:!0},OneGQL_TeamSettings:{merge:!0},OneGQL_TeamSiteInformation:{merge:!0},OneGQL_PossibleFolderDestinationConnection:{merge:!0},OneGQL_PossibleFolderDestinationEdge:{merge:!0},OneGQL_Tenant:{merge:!0},OneGQL_NoOpEvent:{merge:!0},OneGQL_ConversationFolderUpdateEvent:{merge:!0},OneGQL_TeamAddEvent:{merge:!0},OneGQL_TeamReorderEvent:{merge:!0},OneGQL_TeamRemoveEvent:{merge:!0},OneGQL_ChannelActivityEvent:{merge:!0},OneGQL_ChannelAddEvent:{merge:!0},OneGQL_ShowOnlyChannelsWithUnreadPersonalMentionEvent:{merge:!0},OneGQL_ChannelUpdateEvent:{merge:!0},OneGQL_ShowHiddenChannelEvent:{merge:!0},OneGQL_ChannelRemoveEvent:{merge:!0},OneGQL_ChannelHideEvent:{merge:!0},OneGQL_TeamHideEvent:{merge:!0},OneGQL_ConversationAddToRecentEvent:{merge:!0},OneGQL_ConversationRemoveFromRecentEvent:{merge:!0},OneGQL_ConversationAddEvent:{merge:!0},OneGQL_ConversationFolderAddEvent:{merge:!0},OneGQL_ConversationFolderRemoveEvent:{merge:!0},OneGQL_ConversationFolderSortEvent:{merge:!0},OneGQL_ChatReorderEvent:{merge:!0},OneGQL_ConversationRemoveEvent:{merge:!0},OneGQL_ShowHiddenTeamEvent:{merge:!0},OneGQL_RecentChannelsAddEvent:{merge:!0},OneGQL_RecentChannelsRemoveEvent:{merge:!0},OneGQL_RecentChannelsReorderEvent:{merge:!0},OneGQL_FolderViewTypeUpdateEvent:{merge:!0},OneGQL_NewMessageEvent:{merge:!0},OneGQL_MessageReadEvent:{merge:!0},OneGQL_ConversationUpdateEvent:{merge:!0},OneGQL_ConversationFoldersOrderUpdate:{merge:!0},OneGQL_ConversationFolderActivityStatusUpdate:{merge:!0},OneGQL_SetFolderViewTypeSuccess:{merge:!0},OneGQL_SetFolderViewTypeError:{merge:!0},OneGQL_ConversationFoldersConnection:{merge:!0},OneGQL_ConversationFoldersEdge:{merge:!0},OneGQL_SystemDefinedConversationFolder:{merge:!0},OneGQL_UserDefinedConversationFolder:{merge:!0},OneGQL_ConversationFolderActivityStatus:{merge:!0},OneGQL_ConversationFoldersError:{merge:!0},OneGQL_CreateConversationFolderError:{merge:!0},OneGQL_RemoveConversationFolderSuccess:{merge:!0},OneGQL_RemoveConversationFolderError:{merge:!0},OneGQL_RemoveConversationFromFolderError:{merge:!0},OneGQL_RemoveConversationFromFolderSuccess:{merge:!0},OneGQL_SetConversationTeamExpandedStateError:{merge:!0},OneGQL_ReorderConversationFoldersError:{merge:!0},OneGQL_SetConversationFolderExpandedStateError:{merge:!0},OneGQL_MoveItemToConversationFolderError:{merge:!0},OneGQL_MoveItemToConversationFolderSuccess:{merge:!0},OneGQL_DndItemToConversationFolderError:{merge:!0},OneGQL_DndItemToConversationFolderSuccess:{merge:!0},OneGQL_RenameConversationFolderError:{merge:!0},OneGQL_ReorderConversationFolderListSuccess:{merge:!0},OneGQL_ReorderConversationFolderListError:{merge:!0},OneGQL_SetChannelRecommendationError:{merge:!0},OneGQL_MultiPartyConversationParticipantsConnection:{merge:!0},OneGQL_MultiPartyConversationParticipantEdge:{merge:!0},OneGQL_OneOnOneChatConversation:{merge:!0},OneGQL_BotChatConversation:{merge:!0},OneGQL_ConversationsConnection:{merge:!0},OneGQL_ConversationsEdge:{merge:!0},OneGQL_Call:{merge:!0},OneGQL_ChannelConversationActivityStatus:{merge:!0},OneGQL_ChatConversationActivityStatus:{merge:!0},OneGQL_TeamActivityStatus:{merge:!0},OneGQL_ChannelConversation:{merge:!0},OneGQL_DeletedChannel:{merge:!0},OneGQL_NonMemberChannel:{merge:!0},OneGQL_SelfChatConversation:{merge:!0},OneGQL_GroupChatConversation:{merge:!0},OneGQL_MeetingChatConversation:{merge:!0},OneGQL_ConversationConsumptionHorizon:{merge:!0},OneGQL_ConversationMessage:{merge:!0},OneGQL_UnjoinedChannelMessage:{merge:!0},OneGQL_ChannelConnection:{merge:!0},OneGQL_ChannelConnectionEdge:{merge:!0},OneGQL_NonMemberTeam:{merge:!0},OneGQL_Team:{merge:!0},OneGQL_RestoreArchivedChannelError:{merge:!0},OneGQL_ToggleChannelVisibilityError:{merge:!0},OneGQL_ToggleTeamVisibilityError:{merge:!0},OneGQL_SetChatConversationMuteStatusError:{merge:!0},OneGQL_SetBotChatConversationBlockStatusError:{merge:!0},OneGQL_SetConversationConsumptionHorizonBookmarkSuccess:{merge:!0},OneGQL_SetConversationConsumptionHorizonBookmarkError:{merge:!0},OneGQL_SetConversationConsumptionHorizonSuccess:{merge:!0},OneGQL_SetConversationConsumptionHorizonError:{merge:!0},OneGQL_MiniConversation:{merge:!0},OneGQL_NewChatConversation:{merge:!0},OneGQL_BizChatMetaOSConversation:{merge:!0},OneGQL_SetDiscardDraftChatSuccess:{merge:!0},OneGQL_SetDiscardDraftChatError:{merge:!0},OneGQL_SortConversationFolderSuccess:{merge:!0},OneGQL_SortConversationFolderError:{merge:!0},OneGQL_Settings:{merge:!0}};function oh(e,t,n,i,a){if(n){const{config:{publicPath:n,buildType:o,buildVersion:r}}=i;if(!n)return;const s=window;if(s.__APOLLO_CLIENTS__||(s.__APOLLO_CLIENTS__=[]),s.__APOLLO_KEY_FIELDS__||(s.__APOLLO_KEY_FIELDS__=function(){const e={};for(const t of Object.keys(ah))ah[t].keyFields&&(e[t]=ah[t].keyFields);return e}()),"production"===o)"multi-window"===a?s.__REMPL_APOLLO_DEVTOOLS_URL__=`/multi-window/apollo-devtools?version=${r}`:"react-web-client"===a&&(s.__REMPL_APOLLO_DEVTOOLS_URL__="/v2/apollo-devtools");else{const e=n.endsWith("/")?n:n.concat("/");s.__REMPL_APOLLO_DEVTOOLS_URL__=`${e}apollo-devtools.html`}s.__APOLLO_GLOBAL_OPERATIONS__||(s.__APOLLO_GLOBAL_OPERATIONS__={globalMutations:Eg,globalQueries:Ng,globalSubscriptions:Ag}),s.__APOLLO_CLIENTS__.push({client:e,clientId:t})}}class rh extends Error{constructor(e,t){super(`Accessing client ${e}/${t} after destroy`)}}var sh=n(197490);const lh=new eh.i((()=>{throw new Error("This client has been destroyed!")}));class ch{constructor(e,t,n,i,a,o){this.name=i,this.storeType=a,this.disposed=!1,this.schemaId=Ug.DefaultSchema,this.ctx=t,this.services=e,this._client=n,this._relayEnvironment=o,this.services.leakDetector?.track(Fo.I.DataClient,this),this.services.dataOpsTracker&&this.setupWatchQueryTracking(this.client),this.services.dataEvictionService&&this.services.dataEvictionService?.register(this),this.registerClient(this.client)}get client(){if(!this._client)throw new rh(this.constructor.name,this.name);return this._client}get cache(){return this.client.cache}get link(){return this.client.link}get relayEnvironment(){return this._relayEnvironment}updateContext(e,t){this.ctx=e,this._client?.setLink(t)}async destroy(){this.services?.dataEvictionService&&this.services.dataEvictionService.unregister(this),this.destroyRelayEnvironment(),await this.destroyClient(),this.ctx=void 0,this.services=void 0}async clearCache(){this.clearRelayEnvironmentStore(),await(this._client?.clearStore())}getServices(){return this.services}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:null,selfIsMainClient:!1}}async mutate(e){const t=this.getApolloClientInstance(e.mutation);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,Jg.z.mutate);const n=this.patchOptions(e),i=await t.mutate(n);return this.trackReadOperation(t,e),i}async query(e){const t=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,Jg.z.query);const n=this.patchOptions(e),i=await t.query(n);return this.trackReadOperation(t,e),i}readQuery(e,t){const n=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(n)?.trackCall(this.storeType,Jg.z.readQuery);const i=n.readQuery(e,t);return this.trackReadOperation(n,e),i}subscribe(e){const t=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,Jg.z.subscribe);const n=this.patchSubscriptionOptions(e);return t.subscribe(n).map((n=>(this.trackReadOperation(t,e),this.maybeGetGraphQLStoreStatsReporterService(t)?.trackSubscribeEvent(this.storeType),n)))}watchQuery(e){try{const t=this.getApolloClientInstance(e.query);this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,Jg.z.watchQuery);const n=this.patchOptions(e);return t.watchQuery(n)}catch(e){return new th.y((t=>t.error(e)))}}writeQuery(e){const t=this.getApolloClientInstance(e.query);return this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,Jg.z.writeQuery),this.trackWriteOperation(t,e),t.writeQuery(e)}writeFragment(e){const t=this.getApolloClientInstance(e.fragment);return this.maybeGetGraphQLStoreStatsReporterService(t)?.trackCall(this.storeType,Jg.z.writeFragment),this.trackWriteOperation(t,e),t.writeFragment(e)}readFragment(e,t){const n=this.getApolloClientInstance(e.fragment);return this.maybeGetGraphQLStoreStatsReporterService(n)?.trackCall(this.storeType,Jg.z.readFragment),n.readFragment(e,t)}get defaultOptions(){return this.client.defaultOptions}set defaultOptions(e){this.client.defaultOptions=e}get disableNetworkFetches(){return this.client.disableNetworkFetches}set disableNetworkFetches(e){this.client.disableNetworkFetches=e}getApolloClientInstance(e){return this.client}patchOptions(e){const{context:t,patched:n,...i}=e;return n?e:{...i,context:t?{...this.ctx,...t}:this.ctx,patched:!0}}patchSubscriptionOptions(e){return e.context||(e.context={}),e.context.windowId||(e.context.windowId=this.ctx?.windowId),e}registerClient(e){e.dataClients||(e.dataClients=[]),e.dataClients.push(this)}unregisterClient(e){return e.dataClients=e.dataClients?.filter((e=>e!==this)),0===(e.dataClients?.length??0)}async disposeClient(e,t){const n=this.unregisterClient(e);if(n&&((0,Xg.$Z)(e),(0,Xg.$Z)(e.cache),function(e){let t=window;for(t.__APOLLO_CLIENTS__&&(t.__APOLLO_CLIENTS__=t.__APOLLO_CLIENTS__.filter((t=>t.client!==e)));t;)t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__&&t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__.ApolloClient===e&&(t.__APOLLO_DEVTOOLS_GLOBAL_HOOK__.ApolloClient=void 0),t.__APOLLO_CLIENT__&&t.__APOLLO_CLIENT__===e&&(t.__APOLLO_CLIENT__=void 0),t=t.parent===t?null:t.parent}(e)),n&&t){const{scenarioFactory:t}=this.services??{},n=t?.newScenario(H.RG.ApolloClientDisposion);try{e.stop(),await e.clearStore(),e.setLink(lh),e.setResolvers([]),n?.stop()}catch(e){n?.fail({reason:String(e)})}}}async disposeClients(e){this._client&&(await this.disposeClient(this._client,e),e&&(this._client=void 0))}async destroyClient(){if(!this.disposed){this.disposed=!0;const{enableApolloClientDisposion:e}=this.services?.coreSettings.get(b.J.Core)??{};await this.disposeClients(e??!1)}}destroyRelayEnvironment(){this._relayEnvironment&&((0,sh.O8)(this._relayEnvironment.getStore()),this.clearRelayEnvironmentStore(),this._relayEnvironment=void 0)}clearRelayEnvironmentStore(){if(this._relayEnvironment){this._relayEnvironment.getStore().getSource().clear()}}setupWatchQueryTracking(e){const t=e.cache;if(ch.patchedCaches.has(t))return;const n=t.watch;t.watch=(i,...a)=>{this.trackReadOperation(e,i,!0);const o=n.call(t,i,...a);return()=>(this.trackReadOperation(e,i,!1),o())},ch.patchedCaches.set(t,n)}trackReadOperation(e,t,n){this.ctx&&this.services&&(e instanceof ch||this.services.dataOpsTracker?.trackOperation(t,this.name,this.schemaId,n))}trackWriteOperation(e,t){this.ctx&&this.services&&(e instanceof ch||this.services.dataReleaseService?.trackWriteOperation(t))}maybeGetGraphQLStoreStatsReporterService(e){return e instanceof ch||!this.services?.graphqlStoreStatsReporterService?null:this.services?.graphqlStoreStatsReporterService}}ch.patchedCaches=new WeakMap;const dh=e=>e;class uh extends ch{constructor(e,t,n,i,a,o,r){super(e,i,n,a||"INVALID",o,r),this.parent=t}getApolloClientInstance(e){const t=(0,Tg.p$)(e);if("OperationDefinition"===t.kind||"FragmentDefinition"===t.kind){const{selectionSet:{selections:n}}=t,i=this.getSharedGlobalOperationsList(t),a=n.map((e=>"Field"===e.kind&&-1===i.indexOf(e.name.value)));if(a.every(dh))return this.client;if(a.some(dh)){throw(0,de.Tr)(this.className,h.jK.InvalidInput,"route",{operation:e},"Operation contains mix of shared and window private selections")}}return this.parent}getSharedGlobalOperationsList(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation?this.parentMutations:"OperationDefinition"===e.kind&&"subscription"===e.operation?this.parentSubscriptions:this.parentQueries}}class mh extends uh{constructor(e,t,n,i,a){super(e,t,n,i,i.windowId,a)}get relayEnvironment(){return this.parent.relayEnvironment}get parentQueries(){return Ng}get parentSubscriptions(){return Ag}get parentMutations(){return Eg}get className(){return"ChildDataClient"}clone(e){throw new Error("Trying to clone child instance")}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}}class ph extends ch{constructor(e,t,n,i,a){super(e,n,t,n.windowId||"INVALID",i),this.parent=a}get relayEnvironment(){return this.parent?.relayEnvironment}clone(e){throw new Error("Trying to clone child instance")}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:null,selfIsMainClient:!!this.ctx&&this.ctx.windowId===h.ew}}}class gh extends ph{constructor(){super(...arguments),this.schemaId=Ug.ViewSchema}subscribe(e){const t=this.getApolloClientInstance(e.query),n=this.patchOptions(e);return t.subscribe(n)}}var hh=n(910125),yh=n.n(hh);class vh extends ch{constructor(e,t,n,i,a){super(e,n,t({windowId:n.windowId||h.ew,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"core",storeType:Jg.t.core}),n.windowId||h.ew,Jg.t.core,a),this.createApolloClient=t,this.overrideLink=null,this.viewSchemaClient=null,this.overrideLink=null,i&&(this.viewSchemaClient=i({windowId:n.windowId||h.ew,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"core-viewSchema",storeType:Jg.t.viewSchema}),this.registerClient(this.viewSchemaClient))}updateContext(e,t){super.updateContext(e,t),this.overrideLink=t}clone(e){return e.windowId===h.ew?new ph(this.getServices(),this.client,{...this.ctx,...e},this.storeType,this):new mh(this.getServices(),this,this.createApolloClient({windowId:e.windowId,entityType:e.entityType,viewportContext:e.windowProvider.viewportContext,name:`child-${e.windowId}`,overrideLink:this.overrideLink,storeType:Jg.t.window}),{...this.ctx,...e},Jg.t.window)}cloneForViewSchema(e){return yh()(this.viewSchemaClient,"View schema must be avaliable"),new gh(this.getServices(),this.viewSchemaClient,{...this.ctx,...e},Jg.t.viewSchema)}async disposeClients(e){await Promise.all([super.disposeClients(e),(async()=>{this.viewSchemaClient&&(await this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})()])}}class fh extends ch{constructor(e,t,n){super(e,n,t,n.windowId||h.ew,Jg.t.embed)}clone(e){return new ph(this.getServices(),this.client,{...this.ctx,...e},this.storeType)}}var Sh=n(730479),kh=n(414908),Ch=n(536890);const bh={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"WriteCallingDefaults"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingDebugTool"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"visible"}},{kind:"Field",name:{kind:"Name",value:"passiveBarHiddenParticipantsCount"}}]}},{kind:"Field",name:{kind:"Name",value:"streamPermissionsDebug"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"acknowledged"}},{kind:"Field",name:{kind:"Name",value:"acknowledgementRequired"}},{kind:"Field",name:{kind:"Name",value:"url"}}]}},{kind:"Field",name:{kind:"Name",value:"pptSharingSession"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"_"}}]}},{kind:"Field",name:{kind:"Name",value:"isFake"}},{kind:"Field",name:{kind:"Name",value:"calls"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};const wh={callingDebugTool:{__typename:"CallingDebugTool",visible:!0,passiveBarHiddenParticipantsCount:0},streamPermissionsDebug:{__typename:"StreamPermissionsDebug",acknowledged:!1,acknowledgementRequired:!1,url:"https://www.microsoft.com/"},pptSharingSession:{__typename:"ActivePptSession",id:0,_:!1},isFake:!1,calls:[]},Th={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"lpcState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lpcState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isLivePersonaCardInitialized"}},{kind:"Field",name:{kind:"Name",value:"lastLoggedInUserMri"}}]}}]}}]},Ih={Query:{lpcState:(e,t,{cache:n})=>n.readQuery({query:Th})},Mutation:{setLpcState(e,{newLpcState:t},{cache:n}){const i={lpcState:{...t,__typename:"LpcState"}};return n.writeQuery({query:Th,data:i}),i.lpcState}}};var Nh=n(958434);const Eh=(e,t,n)=>{(0,Nh.k)(e),function(e,t){const n=t.newLogger("writeCallingDefaults","data-client-calling");(0,Sh.tW)(e),(0,Sh.bC)(e);try{e.writeQuery({query:bh,data:wh})}catch(e){n.error(`Fail to write calling defaults - ${e}`)}try{e.writeQuery({query:kh.a,data:{shouldShowVideoEffectsPreview:!1}})}catch(e){n.error(`Fail to write default value of shouldShowVideoEffectsPreview - ${e}`)}try{e.writeQuery({query:Ch.z,data:{shouldKeepPreviewWindowInSidePanelOpen:!1}})}catch(e){n.error(`Fail to write default value of shouldKeepPreviewWindowInSidePanelOpen - ${e}`)}}(e,t),function(e){e.writeQuery({query:Th,data:{lpcState:{__typename:"LpcState",isLivePersonaCardInitialized:!1,lastLoggedInUserMri:null}}})}(e),n&&Ah(e,n,t)},Ah=(e,t,n)=>{const i=n.newLogger("appDefaults","data-client-core"),a=t.length;i.log(`Writing ${a.toString()} app default values to the Apollo cache.`),t.forEach((t=>{try{const{queryFieldName:n,gqlTypeName:i}=t,a={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:`${i}DefaultQuery`},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:n},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}}]},o={[n]:{__typename:i}};e.writeQuery({query:a,data:o})}catch(e){const n=`Failed to write ${t.gqlTypeName} to cache as Query field ${t.queryFieldName}.`;i.errorToTelemetry?.(n,"webclient_framework_foundation_core_services_active_application_hooks",void 0,!0)??i.error(n)}}))};class _h extends Zc{constructor(e){super(),this.shellWindow=e,this.shellWindow.opener.addEventListener(O.rY.CentralDataLayerResponse,(e=>{this.onResponseReceived(e)}))}sendMessage(e){this.shellWindow.opener.postMessage(O.rY.CentralDataLayerRequest,{dataLayer:e})}}function Fh(e){return new eh.i((t=>{const{query:n,variables:i,operationName:a}=t,o=t.getContext(),r={callerInfo:o?.callerInfo,callerScenarioId:o?.callerScenarioId};return e.execute(n,i,a,o?.rendererId,o?.windowId,r)}))}const Dh={mutation:new Set(["notifyWorkerSyncCanStart","notifyActiveContextChangedToCDLWorker"]),query:new Set,subscription:new Set};var Ph=n(493525);function Mh({resolvers:e,contextValue:t}){return new eh.i(((n,i)=>{const a=function(e,t){const{query:n}=e,i=(0,Tg.p$)(n);if("OperationDefinition"!==i.kind)return;const{operation:a,selectionSet:{selections:o}}=i;if("mutation"!==a)return;const r=function(e,t){let n;return e.forEach((e=>{if("Field"===e.kind){const i=function(e,t){let n;return t.forEach((({Mutation:t})=>{t[e]&&(n=n||t[e])})),n}(e.name.value,t);if(i){if(n)throw new Error("There cannot be more than 1 matching forward resolver for a document");n={selection:e,resolver:i}}}})),n}(o,t);if(!r)return;return function(e){if(!e.arguments.every((({name:e,value:t})=>"Variable"!==t.kind||t.name.value===e.value))){const t=e.arguments.map((e=>e.name.value)).join(","),n=e.arguments.map((e=>e.value.name.value)).join(",");throw new Error(`Argument name mismatch. Mutation queries, which have forward mutation resolvers should \n                    have a 1-1 name match between the document variable names and the field resolver variable names.\n                    Allowed argument names ${t} does not match the supplied argument names ${n}`)}}(r.selection),r.resolver}(n,e);if(!a)return i(n);const o=n.getContext();return(0,Ph.p)(a(n.variables,{...t,...o})).flatMap((e=>(n.variables=e,i(n))))}))}var xh=n(513830);function Rh(){return new eh.i(((e,t)=>t(e).map((t=>{if(!t.data||!e.query)return t;const{definitions:n}=e.query,i=n.find((e=>e.kind===xh.h.OPERATION_DEFINITION));if(!i||!i.selectionSet)return t;try{const e=i.selectionSet.selections,n=jh(Lh(t.data),e);return t.data=n,t}catch(e){return t}}))))}function jh(e,t){for(const n of t){if(n.kind!==xh.h.FIELD)continue;const t=n.name.value;if("__typename"!==t)if(t in e){if(null!==e[t]&&n.selectionSet&&n.selectionSet.selections){e[t]=Lh(e[t]);const i=n.selectionSet.selections;jh(e[t],i)}}else e[t]=null}return e}function Lh(e){return Array.isArray(e)?e.slice():"object"==typeof e?{...e}:e}var Oh=n(804117);function $h(e){return"subscription"===e.operationType}function Uh(e){const{operation:t,graphQLErrors:n,operationType:i}=e,a=t.getContext(),o={operationName:t.operationName,operationType:i,rendererId:a.windowId};return n&&n.length>0&&(o.errors=n.map((e=>function(e,t){let n=h.jK.UnhandledRuntimeException;const i={path:t};if(!e)return i;e.code?n=e.code:"Failed to fetch"===e.message&&(n=h.jK.FailedToFetch);if(i.code=n,e.hasOwnProperty("serverResponse")&&e.serverResponse){"number"==typeof e.serverResponse.status&&(i.status=e.serverResponse.status),i.mscv=e.serverResponse.headers["ms-cv"],i.xmsCorrelationId=e.serverResponse.headers["x-ms-correlation-id"];try{i.contextId=JSON.stringify(e.serverResponse.headers.contextid)}catch(e){}}return i}(e.originalError,e.path&&e.path.join("::"))))),o}function Bh(e,t,n){!Wh(e)&&n&&function(e,t,n){const i=Uh(e);if(i.errors&&i.errors.length>0){!function(e,t){const{operation:n,operationType:i}=e;t.error(`'${n.operationName}' operation of type '${i}' failed.`)}(e,t);const a={...i,errors:"","Panel.WindowID":i.rendererId};i.errors[0].code===h.jK.FailedToFetch?n.cancel(a):n.fail(a)}else n.stop({operationName:i.operationName,operationType:i.operationType,"Panel.WindowID":i.rendererId})}(e,t,n)}function Wh(e){return $h(e)}function Hh(e,t,n,i,a){const o=e.newLogger("TrackRequestLink","data-resolvers-browser-common");return new eh.i(((e,r)=>{const{query:s}=e,{operation:l}=(0,Nu.S)(s,null),c=r(e);let d;return n&&a?.addOperation(e.operationName,l,"Request"),i&&(d=function(e,t){let n;return Wh(e)||(n=t.newScenario(H.RG.QueryExecution)),n}({operationType:l,operation:e},t)),new th.y((t=>{let r;try{r=c.subscribe({next:r=>{i&&(r.errors&&r.errors.length>0?Bh({operation:e,operationType:l,graphQLErrors:r.errors,response:r},o,d):function(e,t){if(!$h(e)&&t){const n=Uh(e);t.mark(H.ck.QueryResult,{operationName:n.operationName,operationType:n.operationType,"Panel.WindowID":n.rendererId})}}({operation:e,operationType:l,response:r},d)),n&&a?.addOperation(e.operationName,l,"Response"),t.next(r)},error:r=>{const s=(e=>e&&e.result?e.result.errors:e instanceof Error?[new Oh._("Unhandled exception",void 0,void 0,void 0,void 0,e)]:[new Oh._("Unknown error payload provided from forward link")])(r);i&&Bh({operation:e,operationType:l,graphQLErrors:s},o,d),n&&a?.addOperation(e.operationName,l,"Error"),t.error(r)},complete:()=>{i&&Bh({operationType:l,operation:e},o,d),d=void 0,t.complete()}})}catch(t){throw i&&Bh({operationType:l,operation:e,graphQLErrors:[new Oh._("Unhandled exception in forward link",void 0,void 0,void 0,void 0,t)]},o,d),d=void 0,t}return()=>{i&&Bh({operationType:l,operation:e},o,d),d=void 0,r&&r.unsubscribe()}}))}))}const Vh=new class{constructor(){this.map=new Map}destroy(e){const t=this.map.get(e);t&&(t.subscriptions.forEach((e=>{e.next(void 0),e.complete()})),t.subscriptions.length=0,this.map.delete(e))}register(e){if(!this.map.has(e)){const t=new th.y((t=>{const{subscriptions:n}=this.map.get(e)||{};n&&n.push(t)}));this.map.set(e,{cancellationObservable:t,subscriptions:[]})}return this.map.get(e).cancellationObservable}};function Gh(e){Vh.destroy(e)}function zh(e,t){const n=e.newLogger("TrackSubscriptionLinks","data-resolvers-browser-common");return new eh.i(((e,i)=>{const{eventsWithoutCancellationListener:a}=t.get(b.J.Calling),{operationName:o,query:r}=e,{operation:s}=(0,Nu.S)(r,null);if("subscription"!==s||a?.includes(o))return i(e);const l=(0,Re.v4)(),c=Vh.register(l);return n.debug(`Forwarding request ${l} for operation ${o}`),e.setContext({cancellationListener:c}),new th.y((t=>{let n;try{const a=i(e);n=a.subscribe({next:e=>{e?.errors?.length&&Gh(l),t.next(e)},error:e=>{Gh(l),t.error(e)},complete:()=>{Gh(l),t.complete()}})}catch(e){throw Gh(l),e}return()=>{Gh(l),n&&n.unsubscribe()}}))}))}function qh(e){Vh.destroy(e)}function Jh(e,t=void 0,n=!1){const i=new Map,a=new Map;if(!e)throw new Error("Need an operation name to support");return new eh.i(((o,r)=>{if(!((e,t)=>{const{query:n}=e,i=(0,Tg.p$)(n);if(!i||"OperationDefinition"!==i.kind)return!1;const{selectionSet:{selections:a}}=i,{operation:o}=(0,Nu.S)(n,null);if("subscription"!==o)return!1;if(a.length>1)throw new Error("There cannot be more than 1 selection for this link");const r=a[0];if("Field"===r.kind&&r.name.value===t){if(r.arguments.every((({name:e,value:t})=>"Variable"!==t.kind||t.name.value===e.value)))return!0;throw new Error("Argument name must match value")}return!1})(o,e))return r(o);const s=(e=>{const t=e.getContext(),n=JSON.stringify(Object.keys(e.variables).sort().map((t=>{const n=e.variables[t];if(-1!==["boolean","string"].indexOf(typeof n)||null===n||Number.isSafeInteger(n))return[t,n];throw new Error("Unsupported argument type")})));return t.windowId?`${e.operationName}.${n}.${t.windowId}`:`${e.operationName}.${n}`})(o);return new th.y((e=>{const l=i.get(s);if(l)l.observersCollection.push(e),n&&a.has(s)&&e.next(a.get(s));else{let l="";if(t&&t.get(b.J.Calling).enableSubscriptionCancellationListener){l=(0,Re.v4)();const e=Vh.register(l);o.setContext((t=>({...t,cancellationListener:e})))}try{const t=r(o).subscribe({next:e=>{n&&a.set(s,e);i.get(s).observersCollection.slice().forEach((t=>{t.next(e)}))},error:e=>{const{observersCollection:t}=i.get(s);i.delete(s);for(const n of t)n.error(e)},complete:()=>{const{observersCollection:e}=i.get(s);i.delete(s);for(const t of e)t.complete()}});i.set(s,{observersCollection:[e],forwardSubscription:t,requestId:l})}catch(e){throw null!==l&&""!==l&&qh(l),e}}return()=>{const t=i.get(s);if(!t)return;const{observersCollection:n,forwardSubscription:o,requestId:r}=t,l=n.indexOf(e);-1!==l&&(n.splice(l,1),0===n.length&&(i.delete(s),a.delete(s),null!==r&&""!==r&&qh(r),o&&o.unsubscribe()))}}))}))}function Qh(e,t){return function(e){const t=e();return new eh.i(((e,n)=>{const i=t.then((t=>t.request(e,n)));return new th.y((e=>{let t;return i.then((n=>{e.closed||(t=n?.subscribe(e))}),(t=>{e.closed||e.error(t)})),()=>t?.unsubscribe()}))}))}((async()=>(await(0,ac.mT)((()=>Promise.all([n.e(989150),n.e(512161),n.e(33682),n.e(155770),n.e(253506)]).then(n.bind(n,43747))),"supermassive-incremental-link",t)).supermassiveIncrementalSchemaLink(e,t)))}var Kh=n(511420),Yh=n(858466),Xh=n(389719);function Zh(e,t,n,i,a){let o=`Uncaught error in a GraphQL resolver for operation "${e}"`;a&&(o=`${o}, at field selection path "${a}"`),!n&&t.errorToTelemetry&&t.errorToTelemetry(o,"cdl_links_data_client_core",void 0,!0),t.error(`${o} - ${i}`)}const ey=(e,t,n)=>(0,Xh.q)((({graphQLErrors:i,operation:a})=>{const o=e.newLogger(t,"data-client-core");if(i){(({graphQLErrors:e,operationName:t,logger:n,disableTelemetryLogging:i})=>{e&&0!==e.length&&("string"!=typeof e?e.forEach((e=>Zh(t,n,i,JSON.stringify(e),e.path?e.path.map((e=>"number"==typeof e?`[${e.toString()}]`:`${e}`)).join("."):void 0))):Zh(t,n,i,e))})({graphQLErrors:i,operationName:a.operationName,logger:o,disableTelemetryLogging:n})}}));class ty{static async createSingletonLink(e){if(ty._singletonLink)throw new Error("Links are already created");return ty._singletonLink=eh.i.from(await ty.createDefaultLinks(e)),ty._singletonLink}static async createLink(e){return eh.i.from(await ty.createDefaultLinks(e))}static get singletonLink(){return ty._singletonLink}static createViewSchemaLink(e){this._viewSchemaImportPromise||(this._viewSchemaImportPromise=Promise.all([n.e(818814),n.e(989150),n.e(299818),n.e(512161),n.e(576929),n.e(933181)]).then(n.bind(n,614219)));const t=!!e.coreSettings.get(b.J.Core).disableGraphQLErrorTelemetry;return eh.i.from([ey(e.loggerFactory,"viewSchema_resolverUncaughtErrorBoundary__doNotAssignToGraphQLTeam",t),this.createLazyViewSchemaTerminatingLink(e,this._viewSchemaImportPromise)])}static createLazyViewSchemaTerminatingLink(e,t){let n;return this._viewSchemaImport&&this._viewSchemaExecutor?this._viewSchemaImport.createViewSchemaTerminatingLink(e,this._viewSchemaExecutor):new eh.i(((i,a)=>new th.y((o=>{let r,s=!1;return t.then((t=>(this._viewSchemaExecutor||(this._viewSchemaExecutor=new t.ViewSchemaExecutor),this._viewSchemaImport||(this._viewSchemaImport=t),n||(n=t.createViewSchemaTerminatingLink(e,this._viewSchemaExecutor)),n))).then((e=>{s||(r=e.request(i,a)?.subscribe({next:o.next.bind(o),error:o.error.bind(o),complete:o.complete.bind(o)}))})).catch(o.error.bind(o)),()=>{s=!0,r&&r.unsubscribe()}}))))}static createPatchVariablesLink(e,t=[]){return Mh({contextValue:e,resolvers:t})}static async createTerminatingLink({config:e,contextValue:t,cdlWorkerService:n,dataClientTrackingService:i,loggerFactory:a,scenarioFactory:o,coreSettings:r,leakDetectorService:s,windowProvider:l},c){const d=ty.createMainRendererTerminatingLink(e.clientId,a,o,l,r,s,i),{enableClassBasedErrors:u,enableDirectiveCheck:m,disableEnhancedLinkDebugging:p}=r.get(b.J.Core),g=Qh({contextValue:t,enableClassBasedErrors:!!u},o),h=a.newLogger("getAggregatedCDLAngularResolvers","data-client-core"),y=(0,Yh.Om)(r,h,!!p);let v=eh.i.split((e=>function(e,t,n,i,a){const{enableCentralDataLayer:o}=n.get(b.J.Host);return!!o&&ny(e,t,i,a,"MainRenderer")}(e,y,r,a,!!m)),(0,Kh.z)(Rh(),d),g);if((0,tu.Q6)(r)&&!c){const t=a.newLogger("createCDLWorkerTerminatingLink","data-client-core");v=await ty.createCDLWorkerTerminatingLink(n,e,a,o,r,t,v)}return v}static createMainRendererTerminatingLink(e,t,n,i,a,o,r){const s=a.get(b.J.Cdl),{logCdlOperationsDuringWaitSettings:l}=a.get(b.J.Core),c=this.createDataLayerClientSettings(a);return Fh(new Au(e,t,n,new _h((0,L.J)()),o,"Angular",i,{enableRequestHealthMonitor:!!s.enableRequestHealthMonitor,failureCountThreshold:s.requestHealthMonitorFailureCountThreshold,timeoutCountThreshold:s.requestHealthMonitorTimeoutCountThreshold,timeoutLengthSeconds:s.requestHealthMonitorTimeoutLengthSeconds},void 0,void 0,{enableLoggingCdlOperationsDuringWait:l?.enableLoggingCdlOperationsDuringWait,enableTrackingCdlOperationsDuringWait:l?.enableTrackingCdlOperationsDuringWait,trackingCdlOperationsDuringWaitThresholdInMs:l?.trackingCdlOperationsDuringWaitThresholdInMs,trackingCdlOperationsDuringWaitBufferSize:l?.trackingCdlOperationsDuringWaitBufferSize},r,void 0,c,!1))}static createDataLayerClientSettings(e){const{cdlSubscriptionAggregatorAllowList:t,loggableOperationVariablesAllowList:n,cdlSubscriptionAggregatorLogIntervalMS:i}=e.get(b.J.CdlWorker);return{cdlSubscriptionAggregatorAllowList:t||void 0,loggableOperationVariablesAllowList:n||void 0,cdlSubscriptionAggregatorLogIntervalMS:i||void 0}}static async createCDLWorkerTerminatingLink(e,t,n,i,a,o,r){if(!e)return o.warnToTelemetry?.("Not creating CDL Worker terminating link. Worker is enabled, but service is unavailable.","cdl_links_data_client_core",void 0,!0),r;const s=await e.getCDLWorkerManager();if(!s)return o.warnToTelemetry?.("Not creating CDL Worker terminating link. Worker is enabled, service is available but workerManager is not defined.","cdl_links_data_client_core",void 0,!0),r;const l=Fh(await e.getDataLayerClient());s.cdlWorkerSupportedResolvers||o.errorToTelemetry?.("CDL link is configured but will not accept any operations. Worker is enabled, service is available, but workerManager.cdlWorkerSupportedResolvers is undefined.","cdl_links_data_client_core",void 0,!0);const{disableEnhancedLinkDebugging:c}=a.get(b.J.Core),d=(0,Yh.Ng)(a,o,s.cdlWorkerSupportedResolvers,!!c),{enableDirectiveCheck:u}=a.get(b.J.Core);return r=eh.i.split((e=>function(e,t,n,i){return ny(e,t,n,i,"CDLWorker")}(e,d,n,!!u)),(0,Kh.z)(Rh(),l),r),a.get(b.J.CdlWorker).enableControlPlaneLink&&(r=await ty.createCDLWorkerControlPlaneTerminatingLink(e,t,n,i,r,a)),r}static async createCDLWorkerControlPlaneTerminatingLink(e,t,n,i,a,o){const r=await e.getControlPlaneCommunicator(),s=Fh(new Au(t.clientId,n,i,r,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,this.createDataLayerClientSettings(o),void 0)),{enableDirectiveCheck:l}=o.get(b.J.Core);return a=eh.i.split((e=>function(e,t,n){return ny(e,Dh,t,n,"CDLWorkerControl")}(e,n,!!l)),(0,Kh.z)(Rh(),s),a),a}}function ny(e,t,n,i,a){if(!t||0===Object.keys(t).length)return!1;const o=e.query,r=(0,Tg.$H)(o);if(!r)throw new Error(`Expected a parsed GraphQL document with a query, mutation, or subscription operation. Got: ${JSON.stringify(o)}`);const s=r.operation,l=function(e,t){const n=iy(e,t.selectionSet);if(0===n.length)throw new Error(`Expected a GraphQL operation with root-field selections. Got: ${JSON.stringify(e)}`);return n}(o,r);let c=!1;return l.every((o=>!(!i||function(e,t){if(!e.directives||0===e.directives.length||!t)return!0;const n=e.directives.find((e=>"skip"===e.name.value));if(n)return!ay(n,t);const i=e.directives.find((e=>"include"===e.name.value));if(i)return ay(i,t);return!0}(o,e.variables))||!!function(e,t,n,i,a,o,r){const s=e[n];if(!s){const e=r.newLogger("isDataLayerClientOperationSupported","data-client-core");return e.errorToTelemetry?.(`Missing operation type '${n}' for ${a} when looking for '${t}' for operation '${o}'`,"cdl_links_data_client_core",void 0,!0),!1}return s instanceof Set?function(e,t,n,i,a,o){if(e.has(t))return!0;if(n){const e=o.newLogger("isDataLayerClientOperationSupported","data-client-core");e.errorToTelemetry?.(`Unexpected partially supported operation for '${i}' for operation '${a}' - unsupported selection = ${t}`,"cdl_links_data_client_core",void 0,!0)}return!1}(s,t,i,a,o,r):function(e,t,n,i,a,o){if(e[t]){const r=e[t];if(r.active)return!0;if(n){const e=o.newLogger("isDataLayerClientOperationSupported","data-client-core");e.errorToTelemetry?.(`Unexpected partially supported operation for '${i}' for operation '${a}' - unsupported selection= ${t}, found only in '${r.configurationDescription}'`,"cdl_links_data_client_core",void 0,!0)}}else if(n){const e=o.newLogger("isDataLayerClientOperationSupported","data-client-core");e.errorToTelemetry?.(`Unexpected partially supported operation for '${i}' for operation '${a}' - unsupported selection = ${t} not found in any source`,"cdl_links_data_client_core",void 0,!0)}return!1}(s,t,i,a,o,r)}(t,o.name.value,s,c,a,e.operationName,n)&&(c=!0,!0)))}function iy(e,t){return t.selections.reduce(((t,n)=>{switch(n.kind){case"Field":t.push(n);break;case"FragmentSpread":const i=e.definitions.find((e=>"FragmentDefinition"===e.kind&&e.name.value===n.name.value));if(!i)throw new Error(`Fragment ${n.name.value} not found in document`);n=i;case"InlineFragment":t.push(...iy(e,n.selectionSet))}return t}),[])}function ay(e,t){const n=e.arguments?.find((e=>"if"===e.name.value));if(!n)return!1;if("Variable"===n.value.kind){const e=n.value.name.value;if(t.hasOwnProperty(e))return!!t[e]}return!1}ty._singletonLink=null,ty._viewSchemaExecutor=null,ty.createDefaultLinks=async e=>{const{contextValue:t,loggerFactory:n,scenarioFactory:i,coreSettings:a,noCDLTerminatingLink:o,UNSAFE_resolvers:r}=e,s=await ty.createTerminatingLink(e,o),l=ty.createPatchVariablesLink(t,r),c=a.get(b.J.Core).enableGraphQlOpsCount,d=a.get(b.J.Core).enableTrackRequestsLink,u=c||d?[Hh(n,i,c,d,t.graphqlOpsCountService)]:[],m=a.get(b.J.Calling).enableSubscriptionCancellationListener?[zh(n,a)]:[],p=Jh("presenceUpdateEvent",a,!0),g=Jh("callParticipantUpdatedEvent",a),h=Jh("callParticipantsChangedEvent",a),y=Jh("callParticipantsVoiceLevelsChangedEvent",a),v=Jh("chatServiceEvent",a),f=Jh("blockedContactChangedEvent",a,!0),S=!!a.get(b.J.Core).disableGraphQLErrorTelemetry;return[...u,...m,l,ey(n,"resolverUncaughtErrorBoundary__doNotAssignToGraphQLTeam",S),p,g,h,y,v,f,s]};var oy=n(331944);const ry=()=>(0,oy.ZB)(["filter","typeFilter"]),sy=()=>(0,oy.ZB)(["filter","typeFilter"]);function ly(e,t){return t("timestamp",e||{})||""}const cy=()=>{const{read:e,merge:t,...n}=(0,oy.ZB)(!1);return{...n,merge:(e,n,i)=>{if("function"==typeof t){const a=t(e,n,i),{readField:o,mergeObjects:r}=i;let s=(0,W.uniqBy)(a.edges,(e=>o("id",e.node)));const l=[];s=s.filter((e=>{const t=o("deleteTime",e.node);return t&&l.push(o("id",e.node)??""),!t}));const c=o("deletedActivityInfo",a),d=r(c??{},{id:o("id",c),deletedActivityIds:(0,W.uniq)([...o("deletedActivityIds",c)??[],...l])});return{...a,edges:s,deletedActivityInfo:d,pageInfo:{...a?.pageInfo,startCursor:o("timestamp",(0,W.head)(s)?.node),endCursor:o("timestamp",(0,W.last)(s)?.node)}}}return t},read:(...t)=>{const n=t[0],{readField:i}=t[1];if(!n||!e)return;if(!n.edges)return n;const a=[...n.edges].sort(((e,t)=>function(e,t,n){const i=e?.node,a=t?.node,o=ly(i,n),r=ly(a,n);return o?r?parseInt(r,10)-parseInt(o,10):-1:1}(e,t,i)));return{...e(...t),edges:a}}}};const dy=()=>{const{merge:e,...t}=(0,oy.ZB)(!1);return{...t,merge:(t,n,i)=>{if(uy(e)){if(!t)return n;const{readField:a}=i,o=e(t,n,i),r="objectId",s=(0,W.uniqBy)(o.edges,(e=>a(r,e.node)));return{...o,edges:s,pageInfo:{...o.pageInfo}}}return e}}},uy=e=>"function"==typeof e,my=e=>{const t=ah.Query||{fields:{}};return{...ah,...e,Query:{...t,fields:{...t.fields,chats:ry(),recentsChats:ry(),pinnedChats:ry(),activities:cy(),suggestedContactsInChatList:sy(),frequentlyUsedContacts:sy(),replyChainMessages:{...(0,oy.ZB)(["channelId","replychainId"]),read:e=>e,merge:(e,t)=>t},replyChainSummaries:{...(0,oy.ZB)(["channelId"]),read:e=>e,merge:(e,t)=>t},fluidMessages:{merge:(e,t)=>[...t]},feed:{merge:!0},calendarEventsV3WithPagination:dy(),pinnedChannels:{merge:!1}}}}},py=e=>"cache-and-network"===e||"network-only"===e?"cache-first":e;var gy=n(491454);const hy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"quotedReply"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"quotedReply"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"preview"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}}]}}]}}]},yy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatForwardCardQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"forwardCard"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardCardMessageFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardCardMessageFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ForwardMessage"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardCardMessageCardFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataClientChatForwardMessageFileFragment"}}]}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"isImportant"}},{kind:"Field",name:{kind:"Name",value:"importance"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"translatedSubject"}},{kind:"Field",name:{kind:"Name",value:"translatedContent"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageName"}},{kind:"Field",name:{kind:"Name",value:"sourceLanguageCode"}},{kind:"Field",name:{kind:"Name",value:"channelPostSubject"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardCardMessageCardFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ClientCard"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"cardClientId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}},{kind:"Field",name:{kind:"Name",value:"userSpecificContent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}},{kind:"Field",name:{kind:"Name",value:"version"}},{kind:"Field",name:{kind:"Name",value:"authBlockLastUsedOn"}}]}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"DataClientChatForwardMessageFileFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"File"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"itemId"}},{kind:"Field",name:{kind:"Name",value:"chicletBreadcrumbs"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sourceTeamName"}},{kind:"Field",name:{kind:"Name",value:"sourceChannelName"}}]}},{kind:"Field",name:{kind:"Name",value:"baseUrl"}},{kind:"Field",name:{kind:"Name",value:"objectUrl"}},{kind:"Field",name:{kind:"Name",value:"shareId"}},{kind:"Field",name:{kind:"Name",value:"shareUrl"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"previewUrl"}},{kind:"Field",name:{kind:"Name",value:"previewHeight"}},{kind:"Field",name:{kind:"Name",value:"previewWidth"}},{kind:"Field",name:{kind:"Name",value:"progressComplete"}},{kind:"Field",name:{kind:"Name",value:"hasUploadFailed"}},{kind:"Field",name:{kind:"Name",value:"serviceName"}},{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"providerDataV2"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}}]}.definitions]}.definitions]};var vy=n(811957),fy=n(725952),Sy=n(367901);var ky=n(472632),Cy=n(982635),by=n(15051),wy=n(938641);const Ty={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chat"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"}},{kind:"Field",name:{kind:"Name",value:"isDisabled"}},{kind:"Field",name:{kind:"Name",value:"chatSubType"}},{kind:"Field",name:{kind:"Name",value:"chatType"}},{kind:"Field",name:{kind:"Name",value:"isSfB"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isMeeting"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isMuted"}},{kind:"Field",name:{kind:"Name",value:"isFederated"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isRetentionHorizonSet"}},{kind:"Field",name:{kind:"Name",value:"isModerator"}},{kind:"Field",name:{kind:"Name",value:"hasBotMember"}},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"}},{kind:"Field",name:{kind:"Name",value:"disabledReason"}},{kind:"Field",name:{kind:"Name",value:"extendedData"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonFields"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizonBookmark"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"userConsumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"botMembers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userFields"}}]}},{kind:"Field",name:{kind:"Name",value:"creator"}},{kind:"Field",name:{kind:"Name",value:"meetingInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"meetingInformationFields"}}]}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}},...ky.T.definitions,...Cy.v.definitions,...by.f.definitions,...wy.q.definitions]},Iy=e=>({__typename:"ChatDisabledContext",isUIDisabled:e.isUIDisabled,disabledReason:e.disabledReason,extendedData:e.extendedData,lastUpdatedTime:e.lastUpdatedTime}),Ny=()=>({__typename:"ChatDisabledContext",isUIDisabled:!1,disabledReason:"UnknownReason",extendedData:null,lastUpdatedTime:null}),Ey=()=>({__typename:"ChatDisabledContext",isUIDisabled:!1,disabledReason:"ChatDisabledDueToBotStatus",extendedData:null,lastUpdatedTime:null}),Ay={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidMessages"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidMessages"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}}]}}]}}]},_y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidManifestEntries"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"locale"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidManifestEntries"},arguments:[{kind:"Argument",name:{kind:"Name",value:"locale"},value:{kind:"Variable",name:{kind:"Name",value:"locale"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"locale"}},{kind:"Field",name:{kind:"Name",value:"entries"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}}]}}]}}]},Fy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"fluidPendingMentions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"componentHash"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fluidPendingMentions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"componentHash"},value:{kind:"Variable",name:{kind:"Name",value:"componentHash"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"atMentionId"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"contentId"}},{kind:"Field",name:{kind:"Name",value:"navigationPath"}}]}}]}}]};const Dy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"composeState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"composeState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isExpanded"}}]}}]}}]},Py={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"imageAltText"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"imageAltText"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};var My=n(673946),xy=n(271061);const Ry={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messagePaneScrolledToStartState"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messagePaneScrolledToStartState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isScrolledToStart"}}]}}]}}]},jy={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"messageFieldsForTranslation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"translation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"fromLanguage"}}]}}]}}]},Ly={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"twoWaySmsFriendlyName"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"twoWaySmsFriendlyName"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};var Oy=n(68156);const $y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatInsertTvcComposeQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"insertTVCComposeQuery"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cacheId"}}]}}]}}]},Uy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientChatInsertTriggerStreamCameraQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"insertTriggerStreamCamera"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cameraTriggerSource"}}]}}]}}]},By={Query:{fluidManifestEntries:(e,{locale:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{try{const n=e.readQuery({query:_y,variables:{locale:t}});return n?.fluidManifestEntries}catch(e){return void n.newLogger("fluid-manifest-entries","data-client-chat").error("Failed to retrieve the cached fluid manifest json")}})(n,t,i)||null},Conversation:{isFederated:e=>e.isFederated??(0,vy.eX)(e.id),isMeeting:e=>e.isMeeting??(0,vy.e9)(e.id),isSfB:e=>e.isSfB??(0,fy.Jn)(e.id),chatDisabledContext:e=>(e=>{if(!e)return null;if(!e.chatDisabledContext){const t=e;return t&&t.isDisabled&&t.isOneOnOne&&t.hasBotMember?Ey():Ny()}return e.chatDisabledContext})(e),isHighImportance:()=>null,isUrgentImportance:()=>null,activeCallsCount:()=>null,datatid:()=>null,displayName:()=>null,hasActiveCalls:()=>null,hasFailedMessages:()=>null,otherMemberMris:()=>null,isNewChat:()=>null,isBotBlocked:()=>null,isBotUser:()=>null,isHidden:()=>null,isContactTagged:()=>null,pictureUpn:()=>null,pinnedIndex:()=>null,showAtMention:()=>null,showMarkers:()=>null,tooltipTitle:()=>null,longTitle:()=>null,pictureGroup:()=>null,lastMessageTime:()=>null,messagePreview:()=>null,messagePreviewAria:()=>null,isLastMessageText:()=>null,plGroupKey:()=>null,presenceSource:()=>null,hasActions:()=>null,canBeDiscarded:()=>null,canBotBeBlocked:()=>null,canBePinned:()=>null,canBeMuted:()=>null,canBeLeft:()=>null,canBeHidden:()=>null,canBeFavorited:()=>null,canTagContact:()=>null,canPopOut:()=>null,canManageApps:()=>null},Mutation:{untranslateMessage:(e,{messageId:t},{cache:n,loggerFactory:i})=>function(e,t,n){if(!t)return null;const i=Sy.Ps`
    fragment originalMessageFields on Message {
      id
      content
    }
  `;try{const n=e.readFragment({id:`Message:${t}`,fragment:i});return n?n.content:null}catch(e){return n.error(`Failed to get message from cache: ${e}`),null}}(n,t,i.newLogger("untranslateMessage","data-client-chat")),updateChatDisabledContext:(e,{convId:t,isUIDisabled:n,disabledReason:i,extendedData:a},{cache:o})=>((e,t,n,i,a)=>{const o={convId:t},r={__typename:"ChatDisabledContextResponse",message:"",success:!1,chatDisabledContext:Ny()};try{const t=e.readQuery({query:Ty,variables:o});if(!t||!t.chat)return r.message="Could not update chatDisabledContext for a null chat conversation",r;const s=Date.now().toString();t.chat.chatDisabledContext&&(r.chatDisabledContext={...t.chat.chatDisabledContext});const l={__typename:"ChatDisabledContext",isUIDisabled:n,disabledReason:i,extendedData:a,lastUpdatedTime:s},c={chat:{...t.chat,chatDisabledContext:l}};e.writeQuery({query:Ty,variables:o,data:c}),r.success=!0,c&&c.chat&&c.chat.chatDisabledContext&&(r.chatDisabledContext=Iy(c.chat.chatDisabledContext))}catch(e){r.message=`Exception: Failed to update chatDisabledContext for conversation ${t}. Exception Details: ${e.message}`}return r})(o,t,n,i,a),resetQuotedReply:(e,{convId:t},{cache:n})=>((e,t)=>(t.writeQuery({query:hy,variables:{convId:e},data:{quotedReply:null}}),!0))(t,n),setQuotedReply:(e,{convId:t,quotedReply:n},{cache:i})=>((e,{displayName:t,from:n,messageId:i,preview:a,timestamp:o},r)=>{const s={quotedReply:{__typename:"QuotedReply",displayName:t,from:n,messageId:i,preview:a,timestamp:o}};return r.writeQuery({query:hy,variables:{convId:e},data:s}),!0})(t,n,i),setInsertTVCCompose(e,{convId:t,cacheId:n},{cache:i}){try{return i.writeQuery({query:$y,variables:{convId:t},data:{insertTVCComposeQuery:{__typename:"InsertedTVC",cacheId:n}}}),!0}catch(e){return!1}},setTriggerStreamCamera(e,{convId:t,cameraTriggerSource:n},{cache:i}){try{const e={insertTriggerStreamCamera:{__typename:"CameraTriggerSource",cameraTriggerSource:n}};return i.writeQuery({query:Uy,variables:{convId:t},data:e}),!0}catch(e){return!1}},resetTriggerStreamCamera(e,{convId:t},{cache:n}){try{const e={insertTriggerStreamCamera:null};return n.writeQuery({query:Uy,variables:{convId:t},data:e}),!0}catch(e){return!1}},deleteForwardCard:(e,{convId:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{const i={forwardCard:null};try{t.writeQuery({query:yy,variables:{convId:e},data:i})}catch(e){return n.error("Failed to delete forward card from cache"),!1}return!0})(t,n,i.newLogger("deleteForwardCard","data-client-chat")),saveForwardCard:(e,{convId:t,message:n},{cache:i,loggerFactory:a})=>((e,t,n,i)=>{const a={forwardCard:{...t,__typename:"ForwardMessage"}};try{n.writeQuery({query:yy,variables:{convId:e},data:a})}catch(e){return i.error("Failed to save forward card to cache"),!1}return!0})(t,n,i,a.newLogger("saveForwardCard","data-client-chat")),async updateComposeState(e,{id:t,isExpanded:n},{cache:i,loggerFactory:a}){const o={__typename:"ComposeMessageState",id:t,isExpanded:n};try{i.writeQuery({query:Dy,variables:{id:t},data:{composeState:{...o,__typename:"ComposeMessageState"}}})}catch(e){a.newLogger("update-compose-state","data-client-chat").error(`Failed to write to client cache the compose state query. Error: ${e.message}`)}return o},async setImageAltText(e,{altText:t},{cache:n,loggerFactory:i}){const a={imageAltText:t};try{n.writeQuery({query:Py,data:a})}catch(e){i.newLogger("update-image-alt-text","data-client-chat").error(`Failed to write to client cache the image alt text query. Error: ${e.message}`)}return!0},async insertHyperlink(e,{displayText:t,address:n},{cache:i,loggerFactory:a}){const o={__typename:"FluidInsertedHyperlink",displayText:t,address:n};try{i.writeQuery({query:My.D,data:{insertedHyperlink:{...o,__typename:"FluidInsertedHyperlink"}}})}catch(e){a.newLogger("insert-hyperlink-dialog-data","data-client-chat").error(`Failed to write to client cache the insert hyperlink dialog data query. Error: ${e.message}`)}return!0},async setTwoWaySmsFriendlyName(e,{twoWaySmsFriendlyName:t},{cache:n,loggerFactory:i}){const a={twoWaySmsFriendlyName:t};try{n.writeQuery({query:Ly,data:a})}catch(e){i.newLogger("update-tfl-two-way-sms-friendly-name","data-client-chat").error(`Failed to write to client cache the tfl two way sms friendly name query. Error: ${e.message}`)}return!0},async updateMessagePaneScrolledToStartState(e,{id:t,isScrolledToStart:n},{cache:i,loggerFactory:a}){const o={__typename:"MessagePaneScrolledToStartState",id:t,isScrolledToStart:n};try{i.writeQuery({query:Ry,variables:{id:t},data:{messagePaneScrolledToStartState:{...o,__typename:"MessagePaneScrolledToStartState"}}})}catch(e){a.newLogger("update-chat-bottom-state","data-client-chat").error(`Failed to write to client cache the chat bottom state query. Error: ${e.message}`)}return o},async setDlpDialogData(e,{isReport:t,isOverride:n,justification:i},{cache:a,loggerFactory:o}){const r={__typename:"DlpDialogData",isReport:t,isOverride:n,justification:i};try{a.writeQuery({query:xy.C,data:{dlpDialogData:{...r,__typename:"DlpDialogData"}}})}catch(e){o.newLogger("set-dlp-dialog-data","data-client-chat").error(`Failed to write to client cache the set dlp dialog data query. Error: ${e.message}`)}return r},setFluidMessage:(e,{fluidMessage:t,remove:n},{cache:i,loggerFactory:a})=>(({messageId:e,originalArrivalTime:t},n,i,a)=>{try{const a=i.readQuery({query:Ay}),o=n?function(e,t){return{fluidMessages:e?.fluidMessages?.filter((e=>e.messageId!==t))||[]}}(a,e):function(e,t,n){const i=[],a={__typename:"FluidMessage",id:t,messageId:t,originalArrivalTime:n};let o=!1;if(e?.fluidMessages)for(const t of e.fluidMessages)t.originalArrivalTime<a.originalArrivalTime&&!o&&(i.push(a),o=!0),i.push(t);return o||i.push(a),{fluidMessages:i}}(a,e,t);return i.writeQuery({query:Ay,data:o}),!0}catch(e){return a.newLogger("set-fluid-messages-pending-load","data-client-chat").error(`Failed to write to client cache the set fluid message pending load query. Error: ${e.message}`),!1}})(t,!!n,i,a),setFluidManifestEntries:(e,{locale:t,entries:n},{cache:i,loggerFactory:a})=>((e,t,n,i)=>{try{const i={fluidManifestEntries:{__typename:"FluidManifestEntries",locale:e,entries:t,timestamp:Date.now()}};return n.writeQuery({query:_y,variables:{locale:e},data:i}),!0}catch(e){return i.newLogger("fluid-manifest-entries","data-client-chat").error(`Failed to write to client cache that set fluid manifest json query. Error: ${e.message}`),!1}})(t,n,i,a),updateFluidPendingMentions:(e,{componentHash:t,pendingMention:n,remove:i},{cache:a,loggerFactory:o})=>((e,t,n,i,a)=>{try{const a={__typename:"FluidPendingMention",...t},o={componentHash:e},r=i.readQuery({query:Fy,variables:o}),s=(r?.fluidPendingMentions||[]).filter((e=>a.userPrincipalName!==e.userPrincipalName)),l=n?s:[...s,a];return i.writeQuery({query:Fy,variables:o,data:{fluidPendingMentions:l}}),!0}catch(e){return a.newLogger("fluid-resolvers-update-pending-fluid-mentions","data-client-chat").error(`Failed to write pending mentions to the cache, error="${e.message}"`),!1}})(t,n,!!i,a,o),clearFluidPendingMentions:(e,{componentHash:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{try{const n={componentHash:e};return t.writeQuery({query:Fy,variables:n,data:{fluidPendingMentions:[]}}),!0}catch(e){return n.newLogger("fluid-resolvers-clear-fluid-pending-mentions","data-client-chat").error(`Failed to clear pending mentions from the cache, error="${e.message}"`),!1}})(t,n,i),resetSmartReplyFileSuggestion:(e,{convId:t},{cache:n,loggerFactory:i})=>((e,t,n)=>{const i={smartReplyFileSuggestion:null};try{return t.writeQuery({query:Oy.v,variables:{convId:e},data:i}),!0}catch(e){return n.newLogger("ResetSmartReplyFileSuggestion","data-client-chat").error(`Failed to reset smart reply file suggestion in cache: ${e}`),!1}})(t,n,i),setSmartReplyFileSuggestion:(e,{convId:t,fileSuggestion:n},{cache:i,loggerFactory:a})=>((e,{fileName:t,url:n},i,a)=>{try{const a={smartReplyFileSuggestion:{__typename:"SmartReplyFileSuggestion",fileName:t,url:n}};return i.writeQuery({query:Oy.v,variables:{convId:e},data:a}),!0}catch(e){return a.newLogger("SetSmartReplyFileSuggestion","data-client-chat").error(`Failed to set smart reply file suggestion in cache: ${e}`),!1}})(t,n,i,a)},Message:{deletionInfo:(e,t,{cache:n})=>(0,gy.sE)(n,e),translation:(e,t,{cache:n})=>{try{const t=`Message:${e.id}`,i=n.readFragment({id:t,fragment:jy})?.translation;return i?{...i,__typename:"Translation"}:null}catch{return null}},diagnosticInfo:()=>({__typename:"DiagnosticInfo",diagnosticErrorCode:-1,diagnosticMessage:null})}},Wy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormBlockingTasksQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormBlockingTasks"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}}]}}]},Hy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormTerminatingActionQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormTerminatingAction"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},Vy={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientCalendarSchedulingFormActiveTabQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"schedulingFormActiveTab"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}}]},Gy={Query:{schedulingFormActiveTab(e,t,{cache:n,loggerFactory:i}){try{const e=n.readQuery({query:Vy});return e?.schedulingFormActiveTab??null}catch{const e=i.newLogger("scheduling-form-active-tab","data-client-calendar");return e.errorToTelemetry?.("schedulingFormActiveTab: Failed to fetch scheduling form active tab from cache.","calendar_form_active_tab"),null}},schedulingFormBlockingTasks(e,t,{cache:n,loggerFactory:i}){try{const e=n.readQuery({query:Wy});return e?.schedulingFormBlockingTasks??[]}catch(e){const t=i.newLogger("scheduling-form-blocking-task","data-client-calendar");return t.errorToTelemetry?.("schedulingFormBlockingTasks: Failed to fetch scheduling form blocking task from cache.","calendar_form_blocking_tasks"),[]}},schedulingFormTerminatingAction(e,t,{cache:n,loggerFactory:i}){try{return n.readQuery({query:Hy})?.schedulingFormTerminatingAction??null}catch{const e=i.newLogger("scheduling-form-terminating-action","data-client-calendar");return e.errorToTelemetry?.("schedulingFormTerminatingAction: Failed to fetch scheduling form terminating action from cache.","calendar_form_terminating_action"),null}}},Mutation:{addSchedulingFormBlockingTask(e,{input:{task:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("add-scheduling-form-blocking-task","data-client-calendar"),o=(0,Re.v4)();try{const e=n.readQuery({query:Wy})?.schedulingFormBlockingTasks??[],i=e.find((e=>e.type===t.type));if(i&&"Active"===i.state)return a.errorToTelemetry?.("addSchedulingFormBlockingTask: Failed to write scheduling form blocking task in cache. Existing active task of same type already exists.","calendar_form_blocking_tasks"),null;const r=(i?e.filter((e=>e.type!==t.type)):e).concat([{__typename:"SchedulingFormTask",...t,id:o}]);n.writeQuery({query:Wy,data:{schedulingFormBlockingTasks:r}})}catch{return a.errorToTelemetry?.("addSchedulingFormBlockingTask: Failed to write scheduling form blocking task in cache.","calendar_form_blocking_tasks"),null}return{...t,id:o,__typename:"SchedulingFormTask"}},updateSchedulingFormBlockingTask(e,{input:{type:t,state:n}},{cache:i,loggerFactory:a}){const o=a.newLogger("update-scheduling-form-blocking-task","data-client-calendar");try{let e=-1;const a=(i.readQuery({query:Wy})?.schedulingFormBlockingTasks??[]).map(((i,a)=>i?.type===t?(e=a,{...i,state:n}):i));return-1===e?(o.errorToTelemetry?.("updateSchedulingFormBlockingTask: Failed to update scheduling form blocking task in cache. Task does not exist.","calendar_form_blocking_tasks"),null):a[e]}catch(e){return o.errorToTelemetry?.("updateSchedulingFormBlockingTask: Failed to update scheduling form blocking task in cache.","calendar_form_blocking_tasks"),null}},removeSchedulingFormBlockingTask(e,{input:{type:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("remove-scheduling-form-blocking-task","data-client-calendar");try{const e=n.readQuery({query:Wy})?.schedulingFormBlockingTasks??[],i=e.find((e=>e.type===t));if(!i)return null;const a=e.filter((e=>e?.type!==t));return n.writeQuery({query:Wy,data:{schedulingFormBlockingTasks:a}}),i}catch(e){return a.errorToTelemetry?.("removeSchedulingFormBlockingTask: Failed to remove scheduling form blocking task from cache.","calendar_form_blocking_tasks"),null}},setSchedulingFormActiveTab(e,{input:t},{cache:n,loggerFactory:i}){const a=null===t?null:{...t,__typename:"SchedulingFormTab"};try{return n.writeQuery({query:Vy,data:{schedulingFormActiveTab:a}}),a}catch{const e=i.newLogger("scheduling-form-active-tab","data-client-calendar");return e.errorToTelemetry?.("setSchedulingFormActiveTab: Failed to set scheduling form active tab in cache.","calendar_form_active_tab"),null}},setSchedulingFormTerminatingAction(e,{input:{type:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("set-scheduling-form-terminating-action","data-client-calendar");try{n.writeQuery({query:Hy,data:{schedulingFormTerminatingAction:t}})}catch{return a.errorToTelemetry?.("setSchedulingFormTerminatingAction: Failed to update scheduling form terminating task in cache.","calendar_form_terminating_action"),!1}return!0}}};var zy=n(848014);var qy=n(90178);const Jy={Mutation:{addFileUpload(e,{fileToAdd:t},{cache:n}){const{fileContainerId:i}=t,a=(({uploadId:e,fileName:t,serviceName:n,context:i})=>({title:t,status:"PROGRESS",id:e,itemId:null,type:(0,zy.mD)(t),objectUrl:"",baseUrl:"",progress:1,fileId:"",isReferencedFile:!1,shareUrl:"",shareId:"",previewUrl:"",chicletBreadcrumbs:null,context:i??null,permissionScope:null,previewHeight:null,previewWidth:null,progressComplete:null,state:"active",hasUploadFailed:!1,serviceName:n,externalFileShareInfo:"",sharepointIds:null,publication:null,site:null,__typename:"FileUpload"}))(t);return(0,qy.zz)([a],n,i),!0},removeFileUpload(e,{input:t},{cache:n}){const{uploadId:i,fileContainerId:a}=t;return(0,qy.Fj)(i,a,n),!0}}};var Qy=n(939010);const Ky=e=>{if(e){const{appIcon:t,appId:n,appName:i,contentType:a,content:o,locale:r}=e;return{__typename:"PlatformCard",appIcon:t||null,appId:n||null,appName:i||null,content:o,contentType:a,locale:r||null}}return null};var Yy=n(687297);var Xy=n(749392);var Zy=n(159441);var ev=n(293213);const tv={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"platformAppsFetchPolicyFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PlatformAppsFetchPolicy"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"forceNetworkFetch"}},{kind:"Field",name:{kind:"Name",value:"scope"}},{kind:"Field",name:{kind:"Name",value:"convId"}}]}}]},nv="PlatformAppsFetchPolicy",iv="PlatformAppsFetchPolicyMetadata",av=Sy.Ps`
  fragment PlatformAppsFetchPolicyMetadata_FetchPolicyIds on PlatformAppsFetchPolicyMetadata {
    fetchPolicyIds
  }
`,ov=Sy.Ps`
  fragment PlatformAppsFetchPolicy_ForceNetwork on PlatformAppsFetchPolicy {
    forceNetworkFetch
  }
`,rv=(e,t)=>{let n=`${nv}:${e}`;return t&&(n=`${n}:${t}`),n},sv=(e,t,n,i)=>{let a=!0;try{const a=rv(t.scope,t.convId);e.writeFragment({id:a,fragment:tv,data:t});const{enableContextlessFetchPolicyUpdates:o}=n.get(b.J.Extensibility);o&&dv(e,a,i)}catch(e){a=!1}return a},lv=(e,t,n)=>{let i=`${e}`;return t&&(i=`${i}:${t}`),{__typename:nv,id:i,scope:e,forceNetworkFetch:n,convId:t??null}},cv=e=>{try{const t=e.readFragment({id:iv,fragment:av});return t?.fetchPolicyIds??[]}catch(e){throw e}},dv=(e,t,n)=>{const i=n.newLogger("updateFetchPolicyIds","data-client-platform");try{let n=cv(e);if(n.includes(t))return;n=n.concat(t),e.writeFragment({id:iv,fragment:av,data:{__typename:iv,fetchPolicyIds:n}})}catch(e){i.errorToTelemetry?.(`updateFetchPolicyIds: failed to update fetch policy ids when adding ${t}`,"platform_apps_fetch_policy_update_ids_resolver")}};var uv=n(941237);var mv=n(645027);var pv=n(695920);const gv={__typename:"MessageExtensionsAppsState",toggleRefetch:!1},hv=(e,t)=>{try{const n=e.readQuery({query:pv.F,variables:{convId:t}});if(!n)throw new Error("Unable to read ME apps state from cache");return n}catch(e){throw e}};var yv=n(205815);var vv=n(352914);var fv=n(203868);var Sv=n(124438);var kv=n(900783),Cv=n(807907);var bv=n(562154);var wv=n(60044);var Tv=n(628444);var Iv=n(622923);var Nv=n(219395);const Ev="AppCaching resolver: ",Av={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformCachedAppListQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cachedAppList"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedSourceWindow"}},{kind:"Field",name:{kind:"Name",value:"apps"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"globalAppId"}},{kind:"Field",name:{kind:"Name",value:"isCachedAndHidden"}},{kind:"Field",name:{kind:"Name",value:"lastLoaded"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}}]}}]}}]}}]},_v=(e,t,n,i,a)=>{if(!e)return!1;const{lastUpdatedSourceWindow:o}=e;try{const r=t.readQuery({query:Av}),s=n({input:e,cacheData:r,coreSettings:a,logger:i});if((0,W.isEqual)(s,r?.cachedAppList.apps))i?.warn("cache write skipped, data unchanged");else{i?.log("cached app list updated, writing query");const e={cachedAppList:{__typename:"CachedAppList",id:"appcaching",apps:s,lastUpdatedSourceWindow:o}};t.writeQuery({query:Av,data:e})}return!0}catch{return!1}},Fv=e=>{const t={};return e.forEach((e=>t[e.globalAppId]=e)),t},Dv=e=>e.length&&e[0].appId?{"App.Id":e[0].appId}:void 0,Pv=e=>{const{cacheData:t,input:n,logger:i}=e;return(({apps:e},t,n)=>{const i=Fv(t),a=e.filter((e=>!i[e.globalAppId]));return a.length!==e.length&&n?.warnToTelemetry?.("duplicate apps found in mutation input","platform_app_caching_duplciate_apps_in_mutation_input",Dv(e),!0),t.concat(a.map((e=>({...e,__typename:"CachedApp",lastLoaded:e.lastLoaded??null,appId:e.appId??null,appName:e.appName??null}))))})(n,t?.cachedAppList.apps??[],i)},Mv=e=>{const{cacheData:t,input:{apps:n},logger:i}=e,a=Fv(n);let o=[];return t?.cachedAppList.apps&&(o=t?.cachedAppList.apps.filter((e=>!a[e.globalAppId])),o.length===t?.cachedAppList.apps.length&&i?.errorToTelemetry?.("app to remove is not in the cached app list","platform_app_caching_missing_cached_app_on_update",Dv(n),!0)),o},xv=(e,t,n)=>{let i,a=-1;for(const n of e)(!i||n.lastLoaded&&n.lastLoaded<i)&&(a=t.indexOf(n),i=n.lastLoaded);const o=[...t];return-1!==a&&(o.splice(a,1),n?.log("app removed from global cache due to exceeding shared cache size")),o},Rv=e=>{const{cacheData:t,input:{apps:n},coreSettings:i,logger:a}=e,o=i?.get(b.J.Extensibility),r=o?.appCachingMaxSizeNS;let s=[];if(t?.cachedAppList.apps){const e=Fv(t?.cachedAppList.apps);s=n.map((t=>{let n;const i=e[t.globalAppId];i?n=i:(n=t,a?.log("adding app to cache that was not found during update."));const o=t.lastLoaded??null,r=t.isCachedAndHidden,s=n.appId??null,l=n.appName??null;return{...n,__typename:"CachedApp",lastLoaded:o,appId:s,isCachedAndHidden:r,appName:l}}));const i=Fv(s);s=s.concat(t.cachedAppList.apps.filter((e=>!i[e.globalAppId])))}return r?((e,t,n)=>{const i=e.filter((e=>e.isCachedAndHidden));return!i.length||i.length<=t?e:xv(i,e,n)})(s,r,a):s};var jv=n(472694);var Lv=n(162013);var Ov=n(65138);const $v={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformMetaosApplicationSearchHandlerStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"metaosApplicationSearchHandlerState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"registered"}}]}}]}}]},Uv={Query:{platformAppsBatchFetchPolicy:(e,{options:t},{cache:n})=>{const i=t.map((({scope:e,convId:t})=>((e,{scope:t,convId:n})=>{let i;try{const a=rv(t,n),o=e.readFragment({id:a,fragment:tv});i=o?.forceNetworkFetch}catch(e){i=!1}return lv(t,n,i??!1)})(n,{scope:e,convId:t})));return i},messageExtensionsAppsState:()=>gv},Mutation:{toggleAppsRefetch:(e,{convId:t},{cache:n})=>{try{const e=hv(n,t),{messageExtensionsAppsState:i}=e,a=!i.toggleRefetch,o={messageExtensionsAppsState:{...i,toggleRefetch:a}};n.writeQuery({query:pv.F,variables:{convId:t},data:o});return hv(n,t).messageExtensionsAppsState.toggleRefetch}catch(e){throw e}},updateTaskModuleResult:(e,{text:t,taskModuleId:n,draftId:i,card:a,conversationId:o,adaptiveCardTabResult:r,reason:s,entryPoint:l},{cache:c})=>{try{const e={taskModuleResult:{__typename:"TaskModuleResult",text:t??null,card:Ky(a),adaptiveCardTabResult:(r&&r.map((e=>Ky(e))))??null,taskModuleId:n,draftId:i??null,conversationId:o??null,reason:s,entryPoint:l}};return c.writeQuery({query:Qy.s,data:e}),!0}catch{return!1}},resetTaskModuleResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:Qy.s,data:{taskModuleResult:null}}),!0}catch{return!1}},updateAppDetailsResult:(e,{input:t},{cache:n})=>{try{if(!t)throw new Error("No appInstallDetails input received");const{appId:e,appInstallId:i,isAppInstalled:a,errorCode:o}=t,r={appDetailsResult:{__typename:"AppDetailsResult",appInstallId:i,appId:e,isAppInstalled:a,errorCode:o||null}};return n.writeQuery({query:Yy.i,data:r}),!0}catch{return!1}},updateInContextStoreLaunchInstalledAppResult:(e,{input:t},{cache:n})=>{try{let e;if(t){const{id:n,appId:i,capability:a,appDisplayName:o=null,draftId:r=null,botId:s=null,appCommand:l=null}=t;e={inContextStoreLaunchInstalledAppResult:{__typename:"InContextStoreLaunchInstalledAppResult",id:n,appId:i,capability:a,appDisplayName:o,draftId:r,botId:s,appCommand:l}}}else e={inContextStoreLaunchInstalledAppResult:null};return n.writeQuery({query:Xy.I,data:e}),!0}catch{return!1}},setPlatformAppsFetchPolicy:(e,{input:t},{cache:n,loggerFactory:i,coreSettings:a})=>((e,t,n,i)=>{let a=!0;for(const o of t){let t=!0;const r={__typename:nv,forceNetworkFetch:"Network"===o.fetchSource,scope:o.scope,convId:o.convId??null};t=sv(e,r,n,i),a=a&&t}return a})(n,t,a,i),updateAllPlatformAppsFetchPolicies:(e,{fetchSource:t},{cache:n,loggerFactory:i,scenarioFactory:a})=>{let o=!0;const r=i.newLogger("updateAllPlatformAppsFetchPolicies","data-client-platform"),s=a.newScenario(H.RG.UpdateAllPlatformAppsFetchPolicies),l=cv(n),c=l.length;s.appendEventData({appCount:c});for(const e of l)try{n.writeFragment({id:e,fragment:ov,data:{__typename:nv,forceNetworkFetch:"Network"===t}})}catch(n){o=!1,r.errorToTelemetry?.(`updateAllPlatformAppsFetchPolicies: failed to update fetch policy for ${e} to ${t}`,"platform_apps_fetch_policy_update_all_resolver")}return o?(s.stop(),!0):(s.fail(),!1)},updateTabConfigurationResult:(e,{id:t,tabId:n},{cache:i})=>{try{const e={tabConfigurationResult:{__typename:"tabConfigurationResult",id:t,tabId:n}};return i.writeQuery({query:yv.s,variables:{threadId:t},data:e}),!0}catch{return!1}},updateTabDeletionResult:(e,{threadId:t,channelMeetingMessageId:n,tabId:i},{client:a})=>{try{const e={tabDeletionResult:{__typename:"TabDeletionResult",threadId:t,channelMeetingMessageId:n,tabId:i}};return a.writeQuery({query:vv.r,variables:{threadId:t,channelMeetingMessageId:n},data:e}),!0}catch{return!1}},updateMessageToParentResult:(e,{appId:t,message:n},{cache:i})=>{try{const e={messageToParentResult:{__typename:"messageToParentResult",appId:t,message:n}};return i.writeQuery({query:fv.y,variables:{appId:t},data:e}),!0}catch{return!1}},updateMessageToChildResult:(e,{appId:t,message:n},{cache:i})=>{try{const e={messageToChildResult:{__typename:"messageToChildResult",appId:t,message:n}};return i.writeQuery({query:Sv.n,variables:{appId:t},data:e}),!0}catch{return!1}},updateAppButtonSettings:(e,{appId:t,action:n},{cache:i})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={appButtonResult:{__typename:"AppButtonResult",appId:t,action:n}};return i.writeQuery({query:bv.E,variables:{appId:t},data:e}),!0}catch{return!1}},updateChangeSettings:(e,{id:t,status:n,appId:i,tabId:a},{cache:o})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={changeSettingsResult:{__typename:"ChangeSettingsResult",id:t,status:n,appId:i??null,tabId:a??null}};return o.writeQuery({query:kv.L,variables:{id:t},data:e}),!0}catch{return!1}},triggerChangeSettings:(e,{id:t,message:n,appId:i,tabId:a},{cache:o})=>{if(!t)throw new Error("Incorrect input received; id is required");try{const e={changeSettingsTriggerResult:{__typename:"ChangeSettingsTriggerResult",id:t,message:n,appId:i??null,tabId:a??null}};return o.writeQuery({query:Cv.N,variables:{id:t},data:e}),!0}catch{return!1}},updateSelectMediaResult:(e,{input:t},{cache:n})=>{try{const{selectMediaError:e,mediaUrls:i}=t,a={selectMediaResult:{__typename:"SelectMediaResult",selectMediaError:e??null,mediaUrls:i??null}};return n.writeQuery({query:uv.a,data:a}),!0}catch{return!1}},resetSelectMediaResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:uv.a,data:{selectMediaResult:null}}),!0}catch{return!1}},updateViewImagesResult:(e,{input:t},{cache:n})=>{try{const{viewImagesError:e,errorCode:i}=t,a={viewImagesResult:{__typename:"ViewImagesResult",viewImagesError:e??null,errorCode:i??null}};return n.writeQuery({query:mv.R,data:a}),!0}catch{return!1}},resetViewImagesResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:mv.R,data:{viewImagesResult:null}}),!0}catch{return!1}},updateMapCoordinateResult:(e,{locationApiResult:t},{cache:n})=>{try{const{latitude:e,longitude:i,locationApiError:a}=t,o={mapCoordinateResult:{__typename:"MapCoordinateResult",latitude:e??null,longitude:i??null,locationApiError:a??null}};return n.writeQuery({query:Zy.i,data:o}),!0}catch{return!1}},resetMapCoordinateResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:Zy.i,data:{mapCoordinateResult:null}}),!0}catch{return!1}},resetSelectPeoplePickerResult:(e,t,{cache:n})=>{try{return n.writeQuery({query:ev.k,data:{selectPeoplePickerResult:[]}}),!0}catch{return!1}},updateSelectPeoplePickerResult:(e,{selectPeoplePickerResult:t},{cache:n})=>{try{const e={selectPeoplePickerResult:t.map((e=>({__typename:"SelectPeoplePickerResult",objectId:e.objectId,displayName:e.displayName||"",email:e.email||""})))};return n.writeQuery({query:ev.k,data:e}),!0}catch{return!1}},updateCustomAppUploadResult:(e,{input:t},{cache:n})=>{try{if(!t)throw new Error("No customAppUpload input received");const{customAppType:e}=t,i={customAppUploadResult:{__typename:"CustomAppUploadResult",customAppType:e}};return n.writeQuery({query:wv.k,data:i}),!0}catch{return!1}},updateShowLocationResult:(e,{response:t},{cache:n})=>{try{const e={showLocationResponse:t??null};return n.writeQuery({query:Tv.F,data:e}),!0}catch{return!1}},resetShowLocationResponse:(e,t,{cache:n})=>{try{return n.writeQuery({query:Tv.F,data:{showLocationResponse:null}}),!0}catch{return!1}},updateWebhookConfirmationResult:(e,{input:t},{cache:n})=>{try{if(!t)throw new Error("No webhookConfirmation input received");const e={webhookConfirmationResult:t};return n.writeQuery({query:Iv.S,data:e}),!0}catch{return!1}},setAppDevicePermissionsUpdated:(e,{input:t},{cache:n})=>{if(!t||!t.id||!t.status)throw new Error("Incorrect input received; id and status are required");try{const{id:e,status:i}=t,a={appDevicePermissionsUpdated:{__typename:"AppDevicePermissionsUpdated",id:e,status:i}};return n.writeQuery({query:Nv.g,data:a,variables:{input:e}}),a.appDevicePermissionsUpdated}catch{return null}},addSharedPlatformCachedApps:(e,{input:t},{cache:n,loggerFactory:i})=>_v(t,n,Pv,i?.newLogger(`${Ev}addSharedPlatformCachedApps`,"data-client-platform")),removeSharedPlatformCachedApps:(e,{input:t},{cache:n,loggerFactory:i})=>_v(t,n,Mv,i?.newLogger(`${Ev}removeSharedPlatformCachedApps`,"data-client-platform")),updateSharedPlatformCachedApps:(e,{input:t},{cache:n,loggerFactory:i,coreSettings:a})=>_v(t,n,Rv,i?.newLogger(`${Ev}updateSharedPlatformCachedApps`,"data-client-platform"),a),setLocalFrameContext:(e,{localFrameContext:t},{cache:n})=>{try{const e={localFrameContext:{__typename:"LocalFrameContext",id:t.id,threadId:t.threadId??null,messageId:t.messageId??null,tabId:t.tabId??null,websiteUrl:t.websiteUrl??null,contentUrl:t.contentUrl??null}};return n.writeQuery({query:jv.O,data:e}),e.localFrameContext}catch{return null}},resetLocalFrameContext:(e,t,{cache:n})=>{try{return n.writeQuery({query:jv.O,data:{localFrameContext:null}}),null}catch(e){throw e}},setAppsBadgeRead:(e,{isRead:t},{cache:n})=>{try{return n.writeQuery({query:Lv.Q,data:{appsBadgeRead:!!t}}),!0}catch{return!1}},setBackButtonHandlerState:(e,{backButtonHandlerState:t},{cache:n})=>{try{const e={backButtonHandlerState:{__typename:"BackButtonHandlerState",id:t.id,registered:t.registered??!1}};return n.writeQuery({query:Ov.i,data:e}),e.backButtonHandlerState}catch{return null}},resetBackButtonHandlerState:(e,t,{cache:n})=>{try{return n.writeQuery({query:Ov.i,data:{backButtonHandlerState:null}}),null}catch(e){throw e}},setMetaosApplicationSearchHandlerState:(e,{metaosApplicationSearchHandlerState:t},{cache:n})=>{try{const e={metaosApplicationSearchHandlerState:{__typename:"MetaosApplicationSearchHandlerState",id:t.id,registered:t.registered??!1}};return n.writeQuery({query:$v,data:e}),e.metaosApplicationSearchHandlerState}catch{return null}},resetMetaosApplicationSearchHandlerState:(e,t,{cache:n})=>{try{return n.writeQuery({query:$v,data:{metaosApplicationSearchHandlerState:null}}),null}catch(e){throw e}}}};var Bv=n(82523),Wv=n(386698),Hv=n(674262),Vv=n(505429),Gv=n(466648);const zv="1ded03cb-ece5-4e7c-9f73-61c375528078",qv=10,Jv="emptyLinkedEntityId",Qv=()=>({__typename:"Entity",action:Se.uk.view,entityState:{__typename:"EntityState",flushableByLinkedEntity:!0},id:h.ew,linkedEntity:null,type:Se.py.blank,options:null,windowOptions:null});function Kv(){return{__typename:"ActiveEntities",midNavEntity:null,subNavEntity:null,startEntity:null,headerEntity:null,mainEntity:Qv(),endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}}function Yv(e,t){return!(!e||!t)&&(e.id===t.id&&e.type===t.type&&e.action===t.action)}function Xv(e,t){return Yv(e,t.midNavEntity)||Yv(e,t.subNavEntity)||Yv(e,t.headerEntity)||Yv(e,t.mainEntity)}function Zv(e,t){return!e&&!t||!(!e||!t)&&(e.id===t.id&&e.type===t.type&&e.action===t.action&&e?.entityState.flushableByLinkedEntity===t?.entityState.flushableByLinkedEntity&&e?.options===t?.options&&function(e,t){if(!e&&!t)return!0;if(e&&t)return e.action===t.action&&e.id===t.id&&e.type===t.type;return!1}(e?.linkedEntity,t?.linkedEntity))}function ef(e,t,n){const i=new Map,a=new Map;for(const o of e){if(n&&!n(o))continue;const{mainEntity:e,endEntity:r}=o.activeEntities,s=o.userContextId;i.set(t(e,s),[o,e]);const{linkedEntity:l}=e;if(l&&a.set(t(l,s),[o,l]),r){i.set(t(r,s),[o,r]);const{linkedEntity:e}=r;e&&a.set(t(e,s),[o,e])}}return[i,a]}function tf(e,t){return`${e.type}-${e.id}-${t}`}function nf(e){return!!e.activeEntities}function af(e,t){if(!t)return{midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:null,endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null};const{__typename:n,...i}=t,a={...i};if(!e)return a;const{midNavEntity:o,subNavEntity:r,headerEntity:s,startEntity:l,mainEntity:c,endEntity:d,entityExtension:u,monitorEntity:m,inAppNotificationsEntity:p}=e,{midNavEntity:g,subNavEntity:h,headerEntity:y,startEntity:v,mainEntity:f,endEntity:S,entityExtension:k,monitorEntity:C,inAppNotificationsEntity:b}=t;return a.subNavEntity=Yv(r,h)?null:h,a.midNavEntity=Yv(o,g)?null:g,a.headerEntity=Yv(s,y)?null:y,a.startEntity=Yv(l,v)?null:v,a.mainEntity=Yv(c,f)?null:f,a.endEntity=Yv(d,S)?null:S,a.entityExtension=Yv(u,k)?null:k,a.monitorEntity=Yv(m,C)?null:C,a.inAppNotificationsEntity=Yv(p,b)?null:b,a}function of(e,t){const n=nf(e)?e.activeEntities:null,i=nf(t)?t.activeEntities:null;if(!n||!i)return!0;const{midNavEntity:a,subNavEntity:o,headerEntity:r,startEntity:s,mainEntity:l,endEntity:c,entityExtension:d,monitorEntity:u,inAppNotificationsEntity:m}=n,{midNavEntity:p,subNavEntity:g,headerEntity:h,startEntity:y,mainEntity:v,endEntity:f,entityExtension:S,monitorEntity:k,inAppNotificationsEntity:C}=i;return!(e.userContextId===t.userContextId&&e.extendedEntityContainerState.containerState===t.extendedEntityContainerState.containerState&&function(e,t){if(e&&t)return e.blockedCommand?.stateTransition===t.blockedCommand?.stateTransition&&e.blockedCommand?.visibilityState===t.blockedCommand?.visibilityState&&Zv(e.blockedEntity,t.blockedEntity)&&e.blockedEntityOptions===t.blockedEntityOptions;if(!e&&!t)return!0;return!1}(e.blockingEntityExtension,t.blockingEntityExtension)&&Zv(a,p)&&Zv(o,g)&&Zv(r,h)&&Zv(s,y)&&Zv(l,v)&&Zv(c,f)&&Zv(d,S)&&Zv(u,k)&&Zv(m,C))}function rf(e){return!(e.midNavEntity||e.subNavEntity||e.headerEntity||e.startEntity||e.mainEntity||e.endEntity||e.entityExtension)}const sf=e=>({midNavEntity:e?.midNavEntity||null,subNavEntity:e?.subNavEntity||null,headerEntity:e?.headerEntity||null,startEntity:e?.startEntity||null,mainEntity:e?.mainEntity||null,endEntity:e?.endEntity||null,entityExtension:e?.entityExtension||null,monitorEntity:e?.monitorEntity||null,inAppNotificationsEntity:e?.inAppNotificationsEntity||null});function lf(e,t,n=!1){if(!t)return sf(e);const i={...t};if(!e)return i;const{midNavEntity:a,subNavEntity:o,headerEntity:r,startEntity:s,mainEntity:l,endEntity:c,entityExtension:d,monitorEntity:u,inAppNotificationsEntity:m}=e,{midNavEntity:p,subNavEntity:g,headerEntity:h,startEntity:y,mainEntity:v,endEntity:f,entityExtension:S,monitorEntity:k,inAppNotificationsEntity:C}=t,b=n?(e,t)=>Zv(e,t):(e,t)=>Yv(e,t);return i.subNavEntity=b(o,g)?null:g??o,i.headerEntity=b(r,h)?null:h??r,i.startEntity=b(s,y)?null:y??s,i.mainEntity=b(l,v)?null:v??l,i.midNavEntity=b(a,p)?null:p??a,i.endEntity=b(c,f)?null:f??c,i.entityExtension=b(d,S)?null:S??d,i.monitorEntity=b(u,k)?null:k??u,i.inAppNotificationsEntity=b(m,C)?null:C??m,i}function cf(e){return!!(e.mainEntity||e.endEntity||e.entityExtension||e.monitorEntity)}function df(){return{__typename:"ExtendedEntityContainerState",containerState:ke.oq.Closed,isExternal:!1}}const uf=()=>({id:(0,Re.v4)(),startTimestamp:Date.now().toString(),source:C.D.Unknown});function mf(e){if(!e)return null;const{action:t=null,entityState:n={flushableByLinkedEntity:!0},id:i,linkedEntity:a=null,options:o=null,type:r,windowOptions:s=null}={...e};return{action:t??Se.uk.view,entityState:{flushableByLinkedEntity:n.flushableByLinkedEntity,__typename:"EntityState"},id:i||null,linkedEntity:a&&gf(a)||null,options:o,type:r,windowOptions:s?{...s,__typename:"WindowOptions"}:null,__typename:"Entity"}}function pf(e,t,n){return{id:e.id||null,type:e.type,action:e.action,options:t||null,windowOptions:n?{...n,__typename:"WindowOptions"}:null,linkedEntity:e.linkedEntity&&gf(e.linkedEntity)||null,entityState:{flushableByLinkedEntity:!0,__typename:"EntityState"},__typename:"Entity"}}function gf(e){return{action:e.action||null,id:e.id?e.id:Jv,type:e.type,__typename:"LinkedEntity"}}const hf=e=>e?{...e,options:null}:null,yf=e=>({...e,midNavEntity:hf(e.midNavEntity),subNavEntity:hf(e.subNavEntity),headerEntity:hf(e.headerEntity),startEntity:hf(e.startEntity),mainEntity:hf(e.mainEntity),endEntity:hf(e.endEntity)}),vf=e=>e?(0,xe.b4)(e):null,ff=(e,t,n)=>{const i=t&&e.getApp({entityType:t.type})?.manifest.id;i&&n.add(i)},Sf=(e,t)=>{const{midNavEntity:n,subNavEntity:i,headerEntity:a,startEntity:o,mainEntity:r,endEntity:s}=t,l=new Set;return ff(e,n,l),ff(e,i,l),ff(e,a,l),ff(e,o,l),ff(e,r,l),ff(e,s,l),l};function kf({appsRegistryService:e,currentWindowId:t,newReactiveValues:n}){n&&(e.resetAllViewState(t),Object.keys(n).forEach((i=>{e.setReactiveValuesForApp(t,i,n[i])})))}const Cf=e=>{if(!e)return;let t={};return t=Object.keys(e).reduce(((t,n)=>({...t,[n]:e[n].read()})),{}),t},bf=(e,t={resetMonitor:!0})=>(e.layoutConfig.slots={...wf(),...!t.resetMonitor&&{monitor:e.layoutConfig.slots?.monitor}},e),wf=()=>{const e={__typename:"SlotLayoutConfig",height:null,isHidden:!1,width:null};return{__typename:"SlotsLayoutConfig",contextualNotifications:e,end:e,header:e,main:e,monitor:e,nav:e,notifications:e,inAppNotifications:e,start:e,midNav:e,subNav:e,titleBar:e,toasts:e}};var Tf=n(827571);function If(e,t){return e.replace(/\n/g,`\n${"  ".repeat(t)}`)}function Nf(e,t){if(!e)return"{}";if(t)return If(Nf(e),t);const{id:n,type:i,action:a,linkedEntity:o,entityState:r}={...e};return`{\n  id: ${n},\n  type: ${i},\n  action: ${a},${o?`\n  linkedEntity: {\n    id: ${o.id},\n    type: ${o.type}\n  },`:""}${r?`\n  entityState: {\n    flushableByLinkedEntity: ${r.flushableByLinkedEntity}\n  }`:""}\n}`}function Ef(e,t){return e?t?If(Ef(e),t):`{\n  id: ${e.id},\n  startTimestamp: ${e.startTimestamp},\n  source: ${e.source}\n}`:"{}"}function Af(e,t){const{midNavEntity:n,subNavEntity:i,headerEntity:a,startEntity:o,mainEntity:r,endEntity:s,monitorEntity:l,inAppNotificationsEntity:c,entityExtension:d}=e;n&&t.log(`midNavEntity: ${Nf(n)}`),i&&t.log(`subNavEntity: ${Nf(i)}`),a&&t.log(`headerEntity: ${Nf(a)}`),o&&t.log(`startEntity: ${Nf(o)}`),t.log(`mainEntity: ${Nf(r)}`),s&&t.log(`endEntity: ${Nf(s)}`),l&&t.log(`monitorEntity: ${Nf(l)}`),c&&t.log(`inAppNotificationsEntity: ${Nf(c)}`),d&&t.log(`entityExtension: ${Nf(d)}`)}function _f(e,t){const{id:n,correlation:i,isMainWindow:a,layoutConfig:o}=e,r=Ff(o);t.log(`{\n  id: ${n},\n  correlation: ${Ef(i,1)},\n  isMainWindow: ${a},\n  layoutMode: ${o.layoutMode},\n  layoutOverrides: ${r?.toString()}\n}`),nf(e)?(t.log("activeEntities for window:"),Af(e.activeEntities,t)):t.log("activeEntities: undefined")}const Ff=e=>e.slots&&Object.keys(e.slots).reduce(((t,n)=>("__typename"===n||(e.slots?.[n]?.height||e.slots?.[n]?.width||e.slots?.[n]?.isHidden)&&t.push(`${n}:height(${e.slots?.[n]?.height}),width(${e.slots?.[n]?.width}),isHidden(${e.slots?.[n]?.isHidden})`),t)),[]);function Df(e,t){if(void 0===e)return t.log("undefined - app not ported to multi slot");if(null===e)return t.log("null - no app supports this entity");const{midNavEntity:n,subNavEntity:i,headerEntity:a,startEntity:o,mainEntity:r,endEntity:s}=e;n&&t.log(`midNavEntity: ${Nf(n)}`),i&&t.log(`subNavEntity: ${Nf(i)}`),a&&t.log(`headerEntity: ${Nf(a)}`),o&&t.log(`startEntity: ${Nf(o)}`),r&&t.log(`mainEntity: ${Nf(r)}`),s&&t.log(`endEntity: ${Nf(s)}`)}const Pf=e=>e.midNavEntity??e.subNavEntity??e.headerEntity??e.startEntity??e.mainEntity,Mf=({entity:e,currentEntities:t,shouldUseNewEntity:n})=>n?{appEntity:e.linkedEntity??e,contextEntity:e.linkedEntity?e:null}:t?{appEntity:Pf(t),contextEntity:e}:{appEntity:e,contextEntity:null},xf=e=>({infoPane:e.getPreferences("infoPane"),teamLayout:e.getPreferences("teamLayout"),sidePane:e.getPreferences("sidePane")}),Rf=({appsRegistryService:e,clientPreferences:t,contextEntity:n,coreSettings:i,entity:a,layoutMode:o})=>{if(!a)throw new Error("entity used to match app is null");const r=e.getApp({entityType:a.type});if(!r)return;if(!r.getAppViewEntities)return;const s=r.getAppViewEntities({contextEntity:n,coreSettings:i,entity:a,layoutMode:o,userPreferences:xf(t)}),l=s&&{midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:null,endEntity:null,...s};if((a.type===Se.py.activity||a.type===Se.py.simplecollab)&&n&&l){const a=e.getApp({entityType:n.type});if(!a||!a.getAppViewEntities)return l;const r=a.getAppViewEntities({entity:n,contextEntity:n,coreSettings:i,layoutMode:o,userPreferences:xf(t)});r&&Object.assign(l,{endEntity:r.endEntity})}return l},jf={midNavEntity:{children:["subNavEntity","headerEntity","startEntity","mainEntity","endEntity"]},subNavEntity:{children:["headerEntity","startEntity","mainEntity","endEntity"]},headerEntity:{children:["startEntity","mainEntity","endEntity"]},startEntity:{children:["mainEntity","endEntity"]},mainEntity:{children:["endEntity"]},endEntity:{children:null}},Lf=e=>!(!e||"monitorEntity"===e||"inAppNotificationsEntity"===e);function Of(e){return e&&e.viewEntityName&&Lf(e?.viewEntityName)?e.viewEntityName:"subNavEntity"}function $f({executionContext:e,viewEntityName:t}){return Of(e)===t}function Uf({executionContext:e,viewEntityName:t}){const n=Of(e),{children:i}=jf[n];return!(!i||!i.includes(t))}var Bf=n(713410);const Wf=(e,t)=>({endEntity:mf(e.endEntity),headerEntity:mf(e.headerEntity),mainEntity:mf(e.mainEntity)||t,midNavEntity:mf(e.midNavEntity),startEntity:mf(e.startEntity),subNavEntity:mf(e.subNavEntity),monitorEntity:null,inAppNotificationsEntity:null,entityExtension:null,__typename:"ActiveEntities"}),Hf=(e,t,n,i,a)=>{const{appsRegistryService:o,coreSettings:r,clientPreferences:s}=e,l=Pf(t),c=o.getApp({entityType:l?.type}),d=Pf(a),u=o.getApp({entityType:d?.type}),m=c?.onBeforeNavigationFromHistory?.(t,{coreSettings:r,layoutMode:n,userPreferences:xf(s)},u?.manifest.id===c?.manifest.id?a:void 0);return m?(i.log(`${c?.manifest.name} app declared history invalid. New set of entities:`),Df(m,i),Wf(m,Kv().mainEntity)):t},Vf=(e,t,n,i)=>{const a=e.get((0,Bf.bM)(Bf.WD,n),"Experience");if(a)try{const e=JSON.parse(a);return i&&n!==e.userContextId?null:Jf(e.activeEntities,t)}catch{t.errorToTelemetry?.(`Could not restore active entities from local storage. Stored string was in an invalid JSON format. String: ${a}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}return null},Gf=({localStorage:e,logger:t,appsRegistryService:n,userContextId:i,entityType:a,appId:o})=>{const r=o||n.getApp({entityType:a})?.manifest.id,s=e.get((0,Bf.bM)(`${Bf.av}-${r}`,i),"Experience");if(s)try{return Jf(JSON.parse(s),t)}catch(e){t.errorToTelemetry?.(`Could not restore active entities from local storage. Stored string was in an invalid JSON format error ${e}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),t.log("String in local storage: ",s)}return null},zf=(e,t,n)=>{const i=e.windowHistory.map((e=>({...e,activeEntities:yf(e.activeEntities),reactiveVars:{}})));if(t.trySet((0,Bf.bM)(Bf.ax,e.userContextId),JSON.stringify(i),"Framework","Experience")){!t.trySet((0,Bf.bM)(Bf.Hs,e.userContextId),JSON.stringify({windowHistoryIndex:e.currentWindowHistoryIndex,userContextId:e.userContextId}),"Framework","Experience")&&n.errorToTelemetry?.(`Failed to save history index ${e.currentWindowHistoryIndex}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}else n.errorToTelemetry?.(`Failed to save main window history to local storage with history length ${i.length}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)},qf=({action:e,type:t,id:n,entityState:i,linkedEntity:a,options:o,windowOptions:r})=>e&&t?{action:e,entityState:{flushableByLinkedEntity:i&&i.flushableByLinkedEntity||!1,__typename:"EntityState"},id:n||null,linkedEntity:a&&a.type?{id:a.id||Jv,action:a.action||Se.uk.view,type:a.type,__typename:"LinkedEntity"}:null,options:o||null,type:t,windowOptions:r?{left:r.left||0,top:r.top||0,width:r.width||0,height:r.height||0,__typename:"WindowOptions"}:null,__typename:"Entity"}:null,Jf=(e,t)=>e.mainEntity?{__typename:"ActiveEntities",midNavEntity:e.midNavEntity&&qf(e.midNavEntity)||null,subNavEntity:e.subNavEntity&&qf(e.subNavEntity)||null,headerEntity:e.headerEntity&&qf(e.headerEntity)||null,startEntity:e.startEntity&&qf(e.startEntity)||null,mainEntity:e.mainEntity&&qf(e.mainEntity)||Qv(),endEntity:e.endEntity&&qf(e.endEntity)||null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}:(t.log("No main entity in entities stored in local storage"),null),Qf=(e,t)=>e.reduce(((e,n)=>{const i=((e,t)=>{if(!e.activeEntities)return t.log("No activeEntities in window history item in local storage"),null;const n=Jf(e.activeEntities,t);return n?{activeEntities:n,reactiveVars:{},__typename:"WindowHistoryItem"}:null})(n,t);return i&&e.push(i),e}),[]);function Kf(e,t,n=e.windowHistory.length-1,i){const{maxWindowHistoryLength:a}=i.get(b.J.Core);if(!nf(e))return;const o=e.windowHistoryNavigationState,r=e.windowHistory;n<0&&(n=-1),e.currentWindowHistoryIndex=n;const s=r.length>0&&r[r.length-1].activeEntities.mainEntity,l=e.activeEntities.mainEntity,c=!!s&&Yv(s,l);o.canNavigateBack=!(0===r.length||1===r.length&&c)&&n>0,o.canNavigateForward=n<e.windowHistory.length-1;let d=n;n!==e.windowHistory.length-1&&(d=n-1),o.backHistory=Yf(0,d,e.windowHistory);const u=o.backHistory,m=e.activeEntities.mainEntity;u.length>0&&Yv(m,u[u.length-1].entity)&&(u.pop(),t.log("windowHistoryNavigationState back history entry was popped.")),o.backHistory=u.reverse().slice(0,a||qv),o.forwardHistory=Yf(n+1,e.windowHistory.length-1,e.windowHistory).slice(0,a||qv),t.log(`Reset windowHistoryNavigationState. size: ${e.windowHistory.length}, windowHistoryIndex: ${n}`),t.log(`Reset windowHistoryNavigationState. canNavigateBack: ${o.canNavigateBack}, canNavigateForward: ${e.windowHistoryNavigationState.canNavigateForward}, backHistory size: ${e.windowHistoryNavigationState.backHistory.length}, forwardHistory size: ${o.forwardHistory.length}`)}function Yf(e,t,n){if(!n)return[];const i=[];for(let a=e;a<=t;a++)i.push({__typename:"WindowHistoryNavigationItem",windowHistoryIndex:a,entity:n[a].activeEntities.mainEntity});return i}const Xf=(e,t,n)=>{const i=i=>!i||n(t.getApp({entityType:i.type}),{mainEntity:e.mainEntity,subNavEntity:e.subNavEntity});return i(e.mainEntity)&&i(e.subNavEntity)},Zf=(e,t,n)=>Xf(e,t,((e,t)=>{try{return!e?.onBeforeAddToNavigation?.shouldAddEntitiesToWindowHistory||e.onBeforeAddToNavigation.shouldAddEntitiesToWindowHistory(t)}catch(t){return n.errorToTelemetry?.(`App ${e.manifest.name} failed to execute entity command hook 'ShouldAddEntitiesToWindowHistory' with ""${t.name}"" error`,"entity_command_hook",{errors:`${t.name}`},!0),!0}}));function eS({appIdsForReactiveVarChange:e,context:t,isUserContextSwitch:n,logger:i,newActiveEntities:a,windowContentState:o,skipMoveToTop:r,forcePush:s}){const{appsRegistryService:l,windowProvider:c,clientPreferences:d,coreSettings:u}=t,{currentWindowHistoryIndex:m,windowId:p}=o;let{windowHistory:g}=o;const{enableHostHistoryNavigation:h,maxWindowHistoryLength:y}=u.get(b.J.Core);n&&(i.log("User context switch, clearing out history"),g=[]),i.log(`handleWindowHistoryPush called: current length: ${g.length} current index ${m}`);const v=tS(a,l,d,u,o.layoutMode),f=Sf(l,v);if(e&&!e.some((e=>f.has(e))))return i.log(`Not storing rv change to history b/c rv changes made for app not being stored in history ${e} `),[g,!1];if(!Zf(v,l,i))return i.log("Not saving to history b/c app shouldAddEntitiesToWindowHistory hook has returned false"),[g,!1];const S={};f.forEach((e=>{const{navigationalReactiveValues:t,nonNavigationalReactiveValues:n}=l.getAppViewStateForWindow(p,e)||{};(t||n)&&(S[e]=Cf({...t,...n}))}));let k=g;const C=g[m];if(!C||e||cf(af(a,C.activeEntities))||s){if(!r&&m<g.length-1){i.log("Current index not at top stack");const e=g.splice(m,1);g.push(e[0]),i.log("Moving to top of stack: "),Af(e[0].activeEntities,i),i.log(`Pushed windowHistory navigation item at index ${m} to the top of the history stack.`)}const e={__typename:"WindowHistoryItem",activeEntities:{...v,monitorEntity:null,inAppNotificationsEntity:null},reactiveVars:S};return k=[...g,e],h?(c.history.pushState({windowHistoryIndex:k.length-1},""),i.log(`Added browser history entry with windowHistoryIndex: ${k.length}.`)):y?k=k.slice(-y):0===y&&(k=[]),i.log(`windowHistory length after push ${k.length}`),[k,!0]}return i.log("Did not push to window history"),[k,!1]}const tS=(e,t,n,i,a)=>{const o=t.getApp({entityType:Pf(e).type});return o&&o.manifest.shouldDeferNavigationToMainSlotApp?nS(e,t,n,i,a):e},nS=(e,t,n,i,a)=>{const{appEntity:o,contextEntity:r}=Mf({currentEntities:e,entity:e.mainEntity,shouldUseNewEntity:!0}),s=Rf({appsRegistryService:t,clientPreferences:n,contextEntity:r,coreSettings:i,entity:o,layoutMode:a});return s&&s.mainEntity?Wf(s,e.mainEntity):e};function iS(e,t,n,i=!0){try{const{activeWindows:t=[]}=n.enableDecoupleCommandingFromApollo?{activeWindows:n.getActiveWindows()}:e.readQuery({query:Tf.i8})||{};return i?(0,W.cloneDeep)(t):t}catch(e){return t.errorToTelemetry?.(`activeWindowsQuery cache read failed - ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),t.log("activeWindowsQuery entry not found in cache"),[]}}function aS(e,t,n,i,a,o,r){const{activeWindowsService:s,cache:l,commandChangeReportingService:c}=e,d=a||n?.correlation.id||(0,Re.v4)(),u=n?function(e,t,n,i){let a;const o=t.slice(0);if(nf(e)){const t=o.findIndex((t=>t.id===e.id));a=e,-1===t?o.push(a):o[t]=a}else{const t=e.windowHistory.length;if(t>0&&!e.windowHistory[t-1].activeEntities)throw n.errorToTelemetry?.("Unable to resolve active entities, trying to pop back to empty window","webclient_framework_foundation_core_services_entity_commanding"),(0,de.Tr)(h.w5.Commanding,h.jK.Undefined,"executeEntityCommand",e.correlation,"Unable to resolve to active entities");a=o.splice(o.findIndex((t=>t.id===e.id)),1)[0],n.log(`Window has no active entities so destroying for correlation ${i}`)}return o}(n,t,i,d):t;try{s.enableDecoupleCommandingFromApollo?(s.setActiveWindows(u,o),n&&n?.activeEntities&&s.getWindowLayoutService(n.id)?.modalManager.updateModalState(n),n&&n?.activeEntities&&s.getWindowLayoutService(n.id)?.modalManager.setBlockingEntityExtension(n.blockingEntityExtension?.entity)):l.writeQuery({query:Tf.i8,data:{activeWindows:u}})}catch(e){return i.errorToTelemetry?.(`activeWindowsQuery cache write failed - ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),c.report({correlationId:d,type:dt.B.Failure,context:{target:"executeEntityCommand",errorInfo:ct.y.WindowCacheFailedToUpdate,errorMessage:e.message}}),!1}return!n||n.isNotificationsWindow||r||(rS(u,n,i,e),oS(e,u,n,d)),i.log(`After updating window cache, there are ${u.length} active windows`),!0}const oS=({appsRegistryService:e,experienceChangeReportingService:t},n,i,a)=>{if(nf(i)&&lS(n,i.id)){const n=Pf(i.activeEntities),o=e.getPlatformAppIdForEntity(n);t.report({correlationId:a,type:gt.yU.AppSelectionChanged,context:{target:"entity-command-resolver",appId:o}})}},rS=(e,t,n,{appsRegistryService:i,clientPreferences:a,coreSettings:o,localStorage:r})=>{const{enableWriteActiveEntitiesToLocalStorage:s,enableWriteAppHistoryToLocalStorage:l,enableWindowHistoryRestorationOnStandardMain:c}=o.get(b.J.Core);if(nf(t)&&lS(e,t.id)){const e={...t.activeEntities,monitorEntity:null,inAppNotificationsEntity:null};if(((e,t,n)=>Xf(e,t,((e,t)=>{try{return!e?.onBeforeAddToNavigation?.shouldRestoreClientToEntities||e.onBeforeAddToNavigation.shouldRestoreClientToEntities(t)}catch(t){return n.errorToTelemetry?.(`App ${e.manifest.name} failed to execute entity command hook 'ShouldRestoreClientToEntities' with ""${t.name}"" error`,"entity_command_hook",{errors:`${t.name}`},!0),!0}})))(e,i,n)&&s&&r.set((0,Bf.bM)(Bf.WD,t.userContextId),JSON.stringify({activeEntities:e,userContextId:t.userContextId}),"Framework","Experience"),l){const{activeEntities:n}=t,s=Pf(n),l=i.getApp({entityType:s.type});if(l?.onBeforeAddToNavigation?.shouldStoreLastVisitedInAppHistory?.(n.mainEntity)){const n=l?.manifest.id;r.set((0,Bf.bM)(`${Bf.av}-${n}`,t.userContextId),JSON.stringify(yf(e)),"Framework","Experience")}else if(l?.manifest.shouldDeferNavigationToMainSlotApp){const s=i.getApp({entityType:n.mainEntity.type}),l=s?.manifest;if(s?.onBeforeAddToNavigation?.shouldStoreLastVisitedInAppHistory?.(n.mainEntity)){const n=nS(e,i,a,o,t.layoutConfig.layoutMode);r.set((0,Bf.bM)(`${Bf.av}-${l?.id}`,t.userContextId),JSON.stringify(yf(n)),"Framework","Experience")}}}c&&zf(t,r,n)}},sS=(e,t)=>e.find((e=>e.layoutConfig.layoutMode===t&&e.isMainWindow)),lS=(e,t)=>{const n=sS(e,ke.lO.standard);return t===h.ew||t===n?.id},cS=e=>e===h.ew;function dS(e,t){const n=e.get(t);return n&&n[0]}function uS(e,t){return e.find((e=>e.id===t))}function mS(e,t,n,i,a){let o=dS(t,tf(e,i));const{linkedEntity:r}=e;let s=!1;!o&&r&&(o=dS(t,tf(r,i)),s=!!o),!o&&e.id&&(o=dS(n,tf({id:e.id,type:e.type},i)),s=!!o);const{enableLinkedEntityMatching:l}=a.get(b.J.Core);return l&&!o&&r&&(o=dS(n,tf(r,i)),s=!!o),[o,s]}const pS="windowStateEvent";function gS({pubsub:e,fromWindowId:t,isFromWindowMain:n,sourceWindowId:i,diff:a,targetWindow:o,targetVisibilityState:r,stateTransition:s,correlation:l,logger:c}){!function(e,t,n,i,a,o,r){nf(o)&&o.id!==h.ew&&hS(t,a)&&(n.log(`Focusing window ${r} for correlation ${e.id}`),i.publish(`${pS}-${r}`,{windowStateEvent:{isFocused:!0,correlation:e}}))}(l,a,c,e,r,o,i),function(e,t,n,i,a,o,r,s,l){!hS(t,s)||i||l.isMainWindow||l.id===n||r!==ke.su.flush&&r!==ke.su.forceFlush||(a.log(`Closing ${n} for correlation ${e.id}`),o.publish(`${pS}-${n}`,{windowStateEvent:{correlation:e,shouldClose:!0}}))}(l,a,t,n,c,e,s,r,o)}function hS(e,t){return t===ke.fe.show||t===ke.fe.toggle&&cf(e)}const yS=(e,t,n,i,a)=>{const o=e.activeEntities.monitorEntity,r=e.activeEntities;e.activeEntities=Hf(a,e.windowHistory[t].activeEntities,e.layoutConfig.layoutMode,n,r),(e=bf(e,{resetMonitor:null===o})).activeEntities={...e.activeEntities,monitorEntity:o};const s=e.windowHistory[t].reactiveVars;return kf({appsRegistryService:a.appsRegistryService,currentWindowId:e.id,newReactiveValues:s}),Kf(e,n,t,a.coreSettings),n.log("Window after navigating in history: "),_f(e,n),aS(a,i,e,n)},vS={Query:{},Mutation:{changeMonitorSlotContent:(e,{windowId:t,entityType:n,entityAction:i,entityOptions:a},o)=>{const{cache:r,loggerFactory:s,activeWindowsService:l}=o,c=s.newLogger("changeSlotsVisibility-mutation","data-client-entity-command"),d=t||l.getMainWindowWithLayoutMode(ke.lO.standard)?.id||h.ew,u=iS(r,c,l),m=uS(u,d);if(!m)return c.error("mutation fails as targetWindow is not found."),null;let p=!1,g=!1;return i===Se.uk.view?(m.activeEntities={...m.activeEntities,monitorEntity:{id:null,action:i,type:n,entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"},linkedEntity:null,options:a||null,windowOptions:null,__typename:"Entity"}},g=!0):i===Se.uk.leave&&m.activeEntities.monitorEntity?.type===n&&(m.activeEntities={...m.activeEntities,monitorEntity:null},g=!0),p=g&&aS(o,u,m,c),p&&nf(m)?m:null},changeSlotsVisibility:(e,{slotNames:t,windowId:n,isHidden:i},a)=>{const{cache:o,loggerFactory:r,activeWindowsService:s}=a,l=r.newLogger("changeSlotsVisibility-mutation","data-client-entity-command"),c=iS(o,l,s),d=uS(c,n);if(!d)return l.error("mutation fails as targetWindow is not found."),null;let u=!1,m=!1;const p=t.reduce(((e,t)=>{const n=(e=>e.replace(/-./g,(e=>e[1].toUpperCase())))(t),a=d.layoutConfig.slots?.[n];return m||a?.isHidden===i||(m=!0),e[n]={...a,isHidden:i},e}),{});return m&&(d.layoutConfig.slots={__typename:"SlotsLayoutConfig",...d.layoutConfig.slots,...p},u=aS(a,c,d,l)),u&&nf(d)?d:null},resizeHeaderSlot:(e,{height:t,windowId:n},i)=>{const{cache:a,loggerFactory:o,activeWindowsService:r}=i,s=o.newLogger("resizeHeaderSlot-mutation","data-client-entity-command"),l=iS(a,s,r),c=uS(l,n);if(!c)return null;let d=!1;return c.layoutConfig.slots?.header?.height!==t&&(c.layoutConfig.slots={...c.layoutConfig.slots,__typename:"SlotsLayoutConfig",header:{...c.layoutConfig.slots?.header,__typename:"SlotLayoutConfig",height:t,width:c.layoutConfig.slots?.header?.width||null}},d=aS(i,l,c,s)),d&&nf(c)?c:null},resizeSlotDimensions:(e,{windowId:t,slotName:n,width:i},a)=>{const{cache:o,loggerFactory:r,activeWindowsService:s}=a,l=r.newLogger("resizeSlotDimensions-mutation","data-client-entity-command"),c=iS(o,l,s),d=uS(c,t);if(!d)return null;let u=!1;return"SUBNAV"===n?d.layoutConfig.slots={...d.layoutConfig.slots,__typename:"SlotsLayoutConfig",subNav:{...d.layoutConfig.slots?.subNav,__typename:"SlotLayoutConfig",height:d.layoutConfig.slots?.subNav?.height||null,width:i}}:"END"===n&&(d.layoutConfig.slots={...d.layoutConfig.slots,__typename:"SlotsLayoutConfig",end:{...d.layoutConfig.slots?.end,__typename:"SlotLayoutConfig",height:d.layoutConfig.slots?.end?.height||null,width:i}}),u=aS(a,c,d,l),u&&nf(d)?d:null}}};function fS(e,t,n,i,a,o){const{enableOpenerHandleFlow:r}=a.get(b.J.Core);if(r&&cf(e)){const r=!!CS(e,t,a),s=!!bS(e,IS),l=!!bS(e,ES),c=!!bS(e,_S),d=!!bS(e,FS),u=!!bS(e,DS),m=!!bS(e,PS),p=!!bS(e,MS),g=!!bS(e,US),y=!!bS(e,BS),v=!!bS(e,xS),f=!!bS(e,GS),S=!!bS(e,ZS),k=!!bS(e,qS),C=!!bS(e,JS),w=!!bS(e,QS),T=function(e,t,n){const{enableNewConsumerTasksChatTabNavigation:i}=t.get(b.J.Chat);return!i&&!!bS(e,(e=>AS(e,n)))}(e,a,o),I=function(e,t){const{enableAliasVisibilitySettingsCommand:n}=t.get(b.J.People);return!n&&!!bS(e,NS)}(e,a),N=function(e,t,n){const{enableReactTaskModuleForBIM:i,launchAngularDialog:a,enableReactWorkflowsInBIM:o,enableReactTaskModuleForHWC:r,enableModernPurchaseFlow:s}=t.get(b.J.Extensibility);return function(e,t,n){return t===h.ew&&!n&&!!bS(e,WS)}(e,n,i)||function(e,t,n){return t===h.ew&&!n&&!!bS(e,HS)}(e,n,r)||function(e,t){return!!t&&!!bS(e,zS)}(e,a)||function(e,t){return!(t||!bS(e,YS)&&!bS(e,XS))}(e,o)||function(e){return!!bS(e,VS)}(e)||function(e,t){return!t&&!!bS(e,KS)}(e,s)}(e,a,t),E=function(e,t){const{enableBrb:n}=t.get(b.J.Brb);return!n&&!!bS(e,$S)}(e,a),A=function(e,t){const{enableHybridChannelList:n,msgEnableChannelsV2:i}=t.get(b.J.Host);return!(i||n||!bS(e,RS))}(e,a),_=function(e,t){const{isCalendarSurfaceHybridArchitectureEnabled:n}=t.get(b.J.Host),i=!!bS(e,OS);if(i&&n)return!1;return i}(e,a),F=function(e,t){const{isSchedulingFormHybridArchitecureEnabled:n}=t.get(b.J.Host),{enableMultiWindowCalendarSchedulingForm:i}=t.get(b.J.Calendar),a=!!bS(e,jS);if(i&&a)return!1;return a&&!n}(e,a),D=function(e,t,n,i,a){const{isSchedulingFormHybridArchitecureEnabled:o}=a.get(b.J.Host),{enableMultiWindowCalendarSchedulingFormViewAndEdit:r}=a.get(b.J.Calendar),s=!!bS(e,LS);if(s&&i)return!1;if(o&&s)return!1;if(r&&s)return!(t!==h.ew||!n);return s}(e,t,n,i,a),P=function(e,t,n,i){const{isChatHybridArchitectureEnabled:a}=t.get(b.J.Host),o=bS(e,TS);let r=!!o;o&&(i.log(`Checking if opener should handle chat ${o.id}: isChatHybridArchitectureEnabled\n      ${a}, and isNotNewNorNoneOnMainContext ${n}`),r=!1===a&&n,i.log(`Opener should handle chat ${o.id} ${r}`));return r}(e,a,n,o);return r||s||l||c||d||u||m||p||g||y||v||f||S||k||C||w||T||I||N||E||A||_||F||D||P}return!1}function SS(e,t,n,i,a,o){let r=!1,s=null;return s=CS(t,i,o)||function(e,t){let n=null;return kS.forEach((t=>{const i=bS(e,t);i&&(n=i)})),n||bS(e,(e=>AS(e,t)))}(t,a),s&&(n.report({correlationId:e.id,type:dt.B.NotHandled,context:{target:"openerHandleEntityChange"}}),r=!0),r}const kS=[PS,IS,ES,_S,FS,DS,MS,zS,RS,OS,function(e){return!(!e||e.type!==Se.py.schedulingform)},qS,JS,$S,US,BS,WS,TS,xS,GS,ZS,QS,KS,YS,XS,NS,VS];function CS(e,t,n){const i=wS.bind(null,n);return t===h.ew?bS(e,i):null}function bS(e,t){const{mainEntity:n,endEntity:i,entityExtension:a}=e;let o=null;return n&&t(n)&&(o=n),i&&t(i)&&(o=i),a&&t(a)&&(o=a),o}function wS(e,t){if(!t)return!1;switch(t.type){case Se.py.channels:return[Se.uk.leave,Se.uk.share].indexOf(t.action)>=0;case Se.py.channelroster:return t.action===Se.uk.manage;case Se.py.eduteamcreate:return t.action===Se.uk.view;case Se.py.teams:return t.action===Se.uk.delete;case Se.py.channelnotificationsettings:{const{enableChannelNotificationSettingsInT21:n}=e.get(b.J.Activity);return!n&&t.action===Se.uk.view}case Se.py.channelconnectors:{const{enableChannelConnectorV2:n}=e.get(b.J.TeamsAndChannels);return!n&&t.action===Se.uk.view}case Se.py.channelworkflows:{const{legacyChannelConnectorsToWorkflows:n}=e.get(b.J.TeamsAndChannels);return!n&&t.action===Se.uk.view}case Se.py.crosspostchannelselectiondialog:return t.action===Se.uk.view}return[Se.py.addchannel,Se.py.addmember,Se.py.addmembernewteam,Se.py.broadcastliveevent,Se.py.channeldeeplink,Se.py.channeldelete,Se.py.channeledit,Se.py.channelemail,Se.py.channelmoderators,Se.py.showChannelOwners,Se.py.restorechannel,Se.py.teamarchive,Se.py.teamcreate,Se.py.teamdeeplink,Se.py.teamedit,Se.py.teamjoincode,Se.py.teamleave,Se.py.teampicture,Se.py.teamrenewal,Se.py.teamrestore,Se.py.sharedchannelacceptinvitation,Se.py.sharedchanneldeclineinvitation,Se.py.showformemberdialog,Se.py.stopsharingchannelwithteam].indexOf(t.type)>=0}function TS(e){return e&&e.type===Se.py.chats}function IS(e){const t=!(!e||e.type!==Se.py.extensions||e.id!==ke.oz.organization);if(t&&!e?.linkedEntity)throw(0,de.Tr)(h.w5.Commanding,h.jK.Undefined,"CommandChangeNotification",void 0,"Org chart entity defined without a linked entity. Cannot notify host of route change.");return t}function NS(e){return e.type===Se.py.settingsstore&&e.id===ke.oz.privacyManageVisibility}function ES(e){const t=!(!e||e.type!==Se.py.extensions||e.id!==Se.py.linkedin);if(t&&!e?.linkedEntity)throw(0,de.Tr)(h.w5.Commanding,h.jK.Undefined,"CommandChangeNotification",void 0,"LinkedIn entity defined without a linked entity. Cannot notify host of route change.");return t}function AS(e,t){if(e&&e.type===Se.py.extensions&&e.action===Se.uk.view&&e.linkedEntity?.type===Se.py.chats){let n;try{e?.id&&(n=JSON.parse(e.id||"").appId)}catch(e){t.warn("isConsumerTasksChatTab, failed to parse appId")}return!(n!==zv)}return!1}function _S(e){return e?.type===Se.py.transcripttab}function FS(e){return e?.type===Se.py.meetingrecaptab}function DS(e){return!(!e||e.type!==Se.py.platformapps||e.action!==Se.uk.list)}function PS(e){const t=!(!e||e.type!==Se.py.platformStage||e.action!==Se.uk.view),n=!(!e||e.type!==Se.py.platformTabGallery);return t||n}function MS(e){return!(!e||e.type!==Se.py.platformapps||e.action!==Se.uk.manage)}function xS(e){return!(!e||(e.type!==Se.py.file||e.action!==Se.uk.view&&e.action!==Se.uk.update)&&e.type!==Se.py.fileopensettings)}function RS(e){return!(!e||e.type!==Se.py.channels||!e.id)}function jS(e){return!(!e||e.type!==Se.py.schedulingform||e.action!==Se.uk.create)}function LS(e){return!(!e||e.type!==Se.py.schedulingform||e.action!==Se.uk.view)}function OS(e){return!(!e||e.type!==Se.py.calendar)}function $S(e){return!(!e||e.type!==Se.py.brbfeedbackdialog)}function US(e){return!(!e||e.type!==Se.py.open3sfeedback)}function BS(e){return!(!e||e.type!==Se.py.livepersonacard)}function WS(e){return!(!e||e.type!==Se.py.taskmodule)}function HS(e){return!(!e||e.type!==Se.py.hwctaskmodule)}function VS(e){return!(!e||e.type!==Se.py.settingsdialog)}function GS(e){return!(!e||e.type!==Se.py.accounts)}function zS(e){return!(!e||e.type!==Se.py.platformapp||e.action!==Se.uk.info)}function qS(e){return!(!e||e.type!==Se.py.platformappdetails||e.action!==Se.uk.config&&e.action!==Se.uk.update)}function JS(e){return!(!e||e.type!==Se.py.incontextstore||e.action!==Se.uk.config&&e.action!==Se.uk.update)}function QS(e){return!(!e||e.type!==Se.py.platformapp||e.action!==Se.uk.view)}function KS(e){return!(!e||e.type!==Se.py.platformsubscriptionplans||e.action!==Se.uk.info)}function YS(e){return!(!e||e.type!==Se.py.workflows||e.action!==Se.uk.create)}function XS(e){return!(!e||e.type!==Se.py.workflows||e.action!==Se.uk.manage)}function ZS(e){return!(!e||e.type!==Se.py.customapp||e.action!==Se.uk.create)}function ek(e,t,{entity:n,stateTransition:i,logger:a,window:o,correlation:r,commandChangeReportingService:s,entityOptions:l}){if(!o.blockingEntityExtension)throw(0,de.Tr)(h.w5.Commanding,h.jK.Undefined,"executeEntityCommand",o.correlation,"Unable to resolve blockingEntityExtension");const c={activeEntities:t,windowHistory:[...o.windowHistory],currentWindowHistoryIndex:o.windowHistory.length-1,layoutMode:o.layoutConfig.layoutMode,userContextId:o.userContextId,windowId:o.id};a.log("Blocking command transition due to blockingEntityExtension");const d=df();c.activeEntities={...t,entityExtension:o.blockingEntityExtension.entity};const u={...o.blockingEntityExtension,blockedEntity:n,blockedEntityOptions:l||null,blockedCommand:{stateTransition:i,visibilityState:e,correlation:r,__typename:"EntityCommand"}};s.report({correlationId:r.id,type:dt.B.CommandMetaDataAdded,context:{target:"blockTransitionAndShowExtension",transitionBlockedByExtension:!0}});const m=o.windowHistoryNavigationState,p={...m,backHistory:[...m.backHistory??[]],forwardHistory:[...m.forwardHistory??[]]};return{...o,...c,correlation:r,extendedEntityContainerState:d,blockingEntityExtension:u,windowHistoryNavigationState:p}}const tk=(e,t,n)=>{const i=e.activeEntities.entityExtension;if(!i)return t.error(`Unable to create hide command for extension in the given window. The window does not have an active extension. Window ID: ${e.id}`),null;const a=uf();a.source=C.D.CoreResolvers;const o={correlation:a,stateTransition:ke.su.extend,visibilityState:ke.fe.hide};return n.report({type:dt.B.CommandStart,correlationId:a.id,context:{target:"createAndRegisterHideExtensionCommand",entityCommand:{entity:i,command:{...o,correlation:{...a,startTimestamp:parseInt(a.startTimestamp,10)}}}}}),{entity:i,command:o}},nk=(e,t,n)=>{if(nf(e)){const i=tk(e,t,n),a=i?.command.correlation?.id;a&&(t.log(`Closing external dialog, sending hide command with new correlation ${a}`),n.report({type:dt.B.NotHandled,correlationId:a,context:{target:"sendHideExternalExtensionCommand"}}))}},ik=(e,t,n,i,a)=>{const{commandChangeReportingService:o}=a;e.extendedEntityContainerState.isExternal?(n.log(`Routing externally - closing external dialog for correlation ${i.id}`),nk(e,n,o)):(n.log(`Routing externally - closing BIM dialog from command with correlation ${i.id}`),((e,t,n,i,a)=>{nf(t)&&aS(a,n,ak(t,i),e)})(n,e,t,i,a))};function ak(e,t){const{activeEntities:n}=e;return{...e,correlation:t,extendedEntityContainerState:{...e.extendedEntityContainerState,containerState:ke.oq.Closed},activeEntities:{...n,entityExtension:null}}}const ok="CN:",rk={Query:{},Mutation:{createNotificationsWindow:(e,t,n)=>lk(e,t,n),removeNotificationsWindow:(e,t,n)=>sk(e,t,n)}},sk=(e,t,n)=>{const{cache:i,loggerFactory:a,activeWindowsService:o}=n,r=a.newLogger("NotificationsResolver","data-client-entity-command");try{const e=iS(i,r,o),t=e.filter((e=>!0!==e.isNotificationsWindow));if(t.length===e.length)return r.log(`${ok}Cannot remove notifications window as it does not exist.`),!0;const a=aS(n,t,void 0,r);return!1===a&&r.errorToTelemetry?.(`${ok}Error updating windows cache after deleting notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),a}catch(e){return r.errorToTelemetry?.(`${ok}Error occured trying to delete notifications window: ${e.message}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),!1}},lk=(e,t,n)=>{const{cache:i,loggerFactory:a,activeWindowsService:o}=n,r=a.newLogger("NotificationsResolver","data-client-entity-command");try{const e=iS(i,r,o),t=e.find((e=>!0===e.isNotificationsWindow));if(t)return r.log(`${ok}Notifications window has already been created. windowId: ${t.id}`),!0;const a=sS(e,ke.lO.standard),s={...uf(),__typename:"Correlation",clientLaunchId:a?a.correlation.clientLaunchId:(0,Re.v4)()},l=aS(n,e,dk(s,null),r,s.id);return!1===l&&r.errorToTelemetry?.(`${ok}Error updating windows cache with newly created notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),l}catch(e){return r.errorToTelemetry?.(`${ok}Error occured trying to create notifications window: ${e.message}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),!1}},ck=({activeWindows:e,context:t,command:n,correlation:i,entity:a,entityOptions:o,logger:r,notificationsHandler:s,newEntity:l})=>{const c=((e,t)=>{let n;try{e&&(n=JSON.parse(e))}catch(e){t.errorToTelemetry?.(`${ok}Ignoring error while parsing entity options for toasts.`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)}return n})(o,r),d=c?.targetEntity.id||n.correlation.id;r.log(`${ok}${d}Received entity command to render notification. correlationId:${n.correlation.id} tartetEntityType:${c?.targetEntity.type} actionType:${c?.targetEntity.dataOptions.actionType} visibility:${n.visibilityState} isIncomingCall:${c?.isIncomingCall} callId: ${c?.callId} userContextId: ${c?.targetEntity?.dataOptions?.userContextId}`);const{callId:u,crossClientScenarioName:m}=c||{};if(s.sendTelemetry({callId:u,toastScenarioClientId:i.id,callingScenarioName:m,stepName:H.ck.CommandResolutionStarted}),s.isInAppNotificationsEnabled(c))return((e,t,n,i,a,o,r)=>{const s=uS(e,h.ew);if(!s)return r.errorToTelemetry?.(`${ok}Error occured trying to execute notifications command, targetWindow is not found`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),null;let l=!1,c=!1;return a.action===Se.uk.view&&("hide"===t.visibilityState&&s.activeEntities.inAppNotificationsEntity?.type===a.type?(s.activeEntities={...s.activeEntities,inAppNotificationsEntity:null},c=!0):"show"===t.visibilityState&&(s.activeEntities={...s.activeEntities,inAppNotificationsEntity:{id:a.id||i.id,action:a.action,type:a.type,entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"},linkedEntity:null,options:o||null,windowOptions:null,__typename:"Entity"}},c=!0)),l=c&&aS(n,e,s,r),l&&nf(s)?s:null})(e,n,t,i,a,o,r);{const{enableInAppNotifications:e,enableBrowserToasts:n}=t.coreSettings.get(b.J.Notifications);if(e||n)return s.sendTelemetry({toastScenarioClientId:i.id,stepName:H.ck.ToastRenderCancelled,reason:`in app notifications disabled for: ${a.type}`}),null}if(!s.isCustomNotificationsEnabled(c))return function(e,t,n,i,a,o){const r=!!i.coreSettings.get(b.J.Core).enableCommandToHostCommService;return r&&a.sendCommandToHost(e,t,n,o),null}(n,i.id,a,t,s,c);let p;const g=e.findIndex((e=>!0===e.isNotificationsWindow));-1===g?(r.warnToTelemetry?.(`${ok}${d}Notifications window does not exist to display this notification. Creating a new one now...`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),s.sendTelemetry({callId:u,toastScenarioClientId:i.id,callingScenarioName:m,stepName:H.ck.RecreatingNotificationsWindow}),p=dk(i,null)):(p=e[g],s.sendTelemetry({callId:u,toastScenarioClientId:i.id,callingScenarioName:m,stepName:H.ck.NotificationsWindowFound})),l.id=(0,Re.v4)(),((e,t)=>{t.activeEntities.mainEntity=e})(l,p);return!1===aS(t,e,p,r,i.id)?(r.errorToTelemetry?.(`${ok}${d}Error updating the active windows cache with notifications window. correlationId:${i.id}`,"webclient_framework_foundation_resolvers_notifications",void 0,!0),s.sendTelemetry({callId:u,toastScenarioClientId:i.id,callingScenarioName:m,stepName:H.ck.FailedToUpdateWindowsCache}),null):(s.sendTelemetry({callId:u,toastScenarioClientId:i.id,callingScenarioName:m,stepName:H.ck.CommandResolved}),p)};function dk(e,t){const n={__typename:"Entity",id:null,type:Se.py.toasts,action:Se.uk.view,options:null,windowOptions:null,linkedEntity:null,entityState:{__typename:"EntityState",flushableByLinkedEntity:!0}};return{__typename:"Window",id:(0,Re.v4)(),windowOptions:null,windowHistory:[],currentWindowHistoryIndex:0,windowHistoryNavigationState:{__typename:"WindowHistoryNavigationState",canNavigateBack:!1,canNavigateForward:!1,backHistory:[],forwardHistory:[]},correlation:{...e,__typename:"Correlation"},extendedEntityContainerState:df(),blockingEntityExtension:null,isMainWindow:!1,isNotificationsWindow:!0,isInitialWindowStateHidden:!1,userContextId:t,layoutConfig:{__typename:"LayoutConfig",layoutMode:ke.lO.minimal,isFullscreen:!1,slots:{__typename:"SlotsLayoutConfig",contextualNotifications:null,end:null,header:null,main:{__typename:"SlotLayoutConfig",height:null,isHidden:!1,width:null},nav:null,notifications:null,inAppNotifications:null,start:null,midNav:null,subNav:null,titleBar:null,toasts:null,monitor:null}},activeEntities:{__typename:"ActiveEntities",mainEntity:n,midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,endEntity:null,entityExtension:null,monitorEntity:null,inAppNotificationsEntity:null}}}const uk="webclient_framework_foundation_core_services_entity_commanding";function mk(e,t,n,i,a){let o;const{windowHistory:r,activeEntities:s}=e;let l=r;const{appsRegistryService:c,coreSettings:d}=n,{enableOpenerHandleFlow:u}=d.get(b.J.Core),m=r.slice().reverse().find((e=>{return t=s,n=e.activeEntities,i=Pf(t),a=Pf(n),!(i.type===a.type&&i.action===a.action);var t,n,i,a}));if(m){o=m.activeEntities,a.log(`Found app switch in window history ${t.id}. Switching to: `),Af(o,a),kf({appsRegistryService:c,currentWindowId:e.id,newReactiveValues:m.reactiveVars});const i={activeEntities:s,windowHistory:r,currentWindowHistoryIndex:e.currentWindowHistoryIndex,layoutMode:e.layoutConfig.layoutMode,userContextId:e.userContextId,windowId:e.id};(!u||o.mainEntity.type!==Se.py.blank)&&([l]=eS({context:n,isUserContextSwitch:!1,logger:a,newActiveEntities:o,windowContentState:i}))}else if(a.log(`No app switch found in history ${t.id}`),e.id===h.ew){const r=c.getDefaultCommand(n.coreSettings);if(r){a.log(`Using default command for main window ${t.id}`);const o=uf();return o.source=C.D.CoreResolvers,a.log(`Sending new command with correlation ${o.id}`),Lk({entity:r,command:{stateTransition:"forceFlush",visibilityState:"show",correlation:o},windowId:e.id,clientLaunchId:e.correlation.clientLaunchId},n,i)||{...e,correlation:t,activeEntities:void 0}}o=Kv()}else a.log(`No app switch found in child window ${e.id}, so should close ${t.id}`);return{...e,correlation:t,activeEntities:o,windowHistory:l}}function pk({commandChangeReportingService:e,correlation:t,entitiesMap:n,entity:i,logger:a,userContextId:o,window:r},s){const{id:l}=t;return a.log(`Hiding main entity and popping history - ${Nf(i)} and correlation ${l}`),e.report({correlationId:t.id,type:dt.B.CommandMetaDataAdded,context:{target:"hideMainEntity",popWindowHistory:!0}}),function({window:e,entitiesMap:t,correlation:n,logger:i,userContextId:a,context:o}){let r;const{windowHistory:s,activeEntities:l}=e,{appsRegistryService:c,coreSettings:d}=o;let u=s[s.length-1];if(rf(lf(l,u?.activeEntities||null))&&(s.pop(),u=s[s.length-1]),u&&i.log("Using most recent item in history: "),u&&Af(u.activeEntities,i),u){if(dS(t,tf(u.activeEntities.mainEntity,a))||u.activeEntities.endEntity&&dS(t,tf(u.activeEntities.endEntity,a)))return i.log(`Active entities from history already exists in another window so emptying out current window ${e.id}`),r=void 0,c.resetAllViewState(e.id),{...e,correlation:n,activeEntities:r};r=Hf(o,u.activeEntities,e.layoutConfig.layoutMode,i,l),kf({appsRegistryService:c,currentWindowId:e.id,newReactiveValues:u.reactiveVars}),Kf(e,i,void 0,d)}else e.id===h.ew&&(i.log("No window history in main to pop so setting window to blank"),r=Kv(),c.resetAllViewState(e.id));return i.log(`Popping window history, window history length: ${s.length}`),{...e,correlation:n,activeEntities:r}}({window:r,entitiesMap:n,correlation:t,logger:a,userContextId:o,context:s})}function gk({activeEntities:e,correlation:t,entity:n,logger:i,window:a}){const o=a;return Yv(e.startEntity,n)?(i.log(`Hiding start entity - ${Nf(n)} and correlation ${t.id}`),{...o,activeEntities:{...e,startEntity:null},correlation:t}):Yv(e.endEntity,n)?(i.log(`Hiding end entity - ${Nf(n)} and correlation ${t.id}`),{...o,activeEntities:{...e,endEntity:null},correlation:t}):void 0}function hk({commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l},c,d){if(nf(s)){const{activeEntities:u}=s;if(s.blockingEntityExtension&&"extend"!==r)return ek("hide",u,{commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l});if("forceFlush"===r&&Xv(a,u))return function({commandChangeReportingService:e,correlation:t,logger:n,window:i},a,o){const{id:r}=t;if(!nf(i))return i;n.log(`Closing app with correlation correlation ${r}`);const s=mk(i,t,a,o,n),l=nf(s)?Pf(s.activeEntities):void 0;return e.report({correlationId:t.id,type:dt.B.CommandMetaDataAdded,context:{target:"closeApp",popWindowHistory:!1,entityDisplayedAfterHide:nf(s)?{mainEntity:s.activeEntities.mainEntity,contextEntity:l}:void 0}}),s}({commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l},c,d);if((!n||"flush"===r)&&Yv(u.mainEntity,a))return e.report({correlationId:t.id,type:dt.B.Hidden,context:{target:"handleHideCommandAction"}}),pk({commandChangeReportingService:e,correlation:t,enableMultiSlotHide:n,entitiesMap:i,entity:a,logger:o,stateTransition:r,window:s,...l},c);if(!n||"none"===r){const n=gk({entity:a,logger:o,window:s,correlation:t,activeEntities:u});if(n)return e.report({correlationId:t.id,type:dt.B.Hidden,context:{target:"handleHideCommandAction"}}),n}if(Yv(u.entityExtension,a))return o.log(`Closing extended entity container with correlation ${t.id}`),ak(s,t);e.report({correlationId:t.id,type:dt.B.Incomplete,context:{target:"handleHideCommandAction"}}),o.warn(`Hide command issued for an entity but that entity is not present - ${Nf(a)}`)}else o.warn(`Hide command issued for an entity but are no active entities - ${Nf(a)}`);return s}function yk({appViewEntities:e,commandChangeReportingService:t,coreSettings:n,correlation:i,enableMultiSlotNone:a,entity:o,executionContext:r,logger:s,userContextId:l,window:c}){let d;const u={activeEntities:Ck(c),windowHistory:[...c.windowHistory],currentWindowHistoryIndex:c.currentWindowHistoryIndex,layoutMode:c.layoutConfig.layoutMode,userContextId:c.userContextId,windowId:c.id},{enableMTMACommanding:m}=n.get(b.J.Core);if(m&&l!==c.userContextId)throw s.errorToTelemetry?.("Different user context sent for toggle command",uk),new Error("Different user context sent for toggle command");if(nf(c)){const{activeEntities:n}=c,l=gk({activeEntities:n,correlation:i,entity:o,logger:s,window:c});if(l)return function({commandChangeReportingService:e,correlation:t,logger:n,newEntity:i}){e.report({correlationId:t.id,type:dt.B.Toggled,context:{target:"logHideToggle"}}),n.log(`Toggling entity (hide) - ${Nf(i)} and correlation ${t.id}`)}({commandChangeReportingService:t,logger:s,newEntity:o,correlation:i}),l;Yv(n.mainEntity,o)||(t.report({correlationId:i.id,type:dt.B.Incomplete,context:{target:"handleToggleCommandAction"}}),s.log(`Toggling end entity (show) - ${Nf(o)} and correlation ${i.id}`),d=bk({activeEntities:n,appViewEntities:e,correlation:i,enableMultiSlotNone:a,executionContext:r,logger:s,newEntity:o,windowContentState:u}).activeEntities)}else t.report({correlationId:i.id,type:dt.B.Incomplete,context:{target:"handleToggleCommandAction"}}),s.warn(`Toggle command only supported when active entities set - ${o}`);return{...c,correlation:i,activeEntities:d}}function vk({activeEntities:e,stateTransition:t,executionContext:n}){const i=e.mainEntity.entityState.flushableByLinkedEntity,a=!e.endEntity||e.endEntity.entityState.flushableByLinkedEntity,o=Uf({executionContext:n,viewEntityName:"mainEntity"});return"forceFlow"===t||o&&i&&"flow"===t||!o&&a&&"flow"===t}function fk({mainEntity:e,entity:t,stateTransition:n,matchedLinkedEntity:i}){const a=e.entityState.flushableByLinkedEntity;return"forceFlush"===n||a&&("flush"===n||"new"===n)||i&&t.type!==Se.py.byodchat&&t.type!==Se.py.chats&&t.type!==Se.py.devicesettings&&t.type!==Se.py.contentcamerasetup&&t.type!==Se.py.transcript&&t.type!==Se.py.meetingdetails&&t.type!==Se.py.roster&&t.type!==Se.py.byodroster&&t.type!==Se.py.breakoutroomspanel&&t.type!==Se.py.yammerqna&&t.type!==Se.py.accessibilitypanel&&t.type!==Se.py.extensions&&t.type!==Se.py.videobackgrounds&&t.type!==Se.py.roomremote&&t.type!==Se.py.videoeffectsandsettings&&t.type!==Se.py.audiosettings}function Sk(e,t){const n={__typename:"Entity",action:"view",entityState:{__typename:"EntityState",flushableByLinkedEntity:!0},id:null,linkedEntity:null,type:Se.py.hybridplaceholder,options:null,windowOptions:null};return"Activity"===t||"NonHybridLeftRail"===t?n:mf(e)}function kk({currentEntity:e,entityFromAppViewEntities:t,isExecutionContextUpstreamOfEntity:n}){const i=!e||e.entityState.flushableByLinkedEntity;return n&&i&&!!t}function Ck(e){return nf(e)?e.activeEntities:void 0}function bk({activeEntities:e,appViewEntities:t,correlation:n,enableMultiSlotNone:i,executionContext:a,logger:o,newEntity:r,windowContentState:s}){return i&&t?(o.log("Using multi slot none behavior"),function({activeEntities:e,appViewEntities:t,executionContext:n,logger:i,windowContentState:a}){return t.endEntity||t.startEntity||i.warn("Attempting to show side rail slots (start or end) but appViewEntities has returned null for startEntity and endEntity"),{...a,activeEntities:{...e,startEntity:kk({currentEntity:e.startEntity,entityFromAppViewEntities:t.startEntity,isExecutionContextUpstreamOfEntity:Uf({executionContext:n,viewEntityName:"startEntity"})||$f({executionContext:n,viewEntityName:"startEntity"})})?mf(t.startEntity):e.startEntity,endEntity:kk({currentEntity:e.endEntity,entityFromAppViewEntities:t.endEntity,isExecutionContextUpstreamOfEntity:Uf({executionContext:n,viewEntityName:"endEntity"})||$f({executionContext:n,viewEntityName:"endEntity"})})?mf(t.endEntity):e.endEntity}}}({activeEntities:e,appViewEntities:t,logger:o,executionContext:a,windowContentState:s})):(o.log("Falling back to default none behavior"),function(e,t,n,i,a){return i.log(`Adding as end entity - ${Nf(n)} and correlation ${a}`),{...e,activeEntities:{...t,endEntity:n}}}(s,e,r,o,n.id))}function wk({appViewEntities:e,correlation:t,enableMultiSlotNone:n,entity:i,executionContext:a,isCurrentEntitiesInvalid:o,isInputDefaultEntity:r,logger:s,matchedLinkedEntity:l,sourceHint:c,stateTransition:d,window:u,userContextId:m,...p},g){const{coreSettings:h}=g,y=Ck(u);let v=u.extendedEntityContainerState,f={activeEntities:y,windowHistory:[...u.windowHistory],currentWindowHistoryIndex:u.currentWindowHistoryIndex,layoutMode:u.layoutConfig.layoutMode,userContextId:u.userContextId,windowId:u.id};if(u.blockingEntityExtension&&y&&"extend"!==d)return ek("show",y,{appViewEntities:e,correlation:t,enableMultiSlotNone:n,entity:i,executionContext:a,isCurrentEntitiesInvalid:o,isInputDefaultEntity:r,logger:s,matchedLinkedEntity:l,sourceHint:c,stateTransition:d,window:u,userContextId:m,...p});if(!y||fk({mainEntity:y.mainEntity,entity:i,stateTransition:d,matchedLinkedEntity:l}))f=function({appViewEntities:e,context:t,correlation:n,isInputDefaultEntity:i,isCurrentEntitiesInvalid:a,logger:o,newEntity:r,sourceHint:s,userContextId:l,window:c,windowContentState:d}){const{midNavEntity:u=null,subNavEntity:m=null,headerEntity:p=null,startEntity:g=null,mainEntity:h=null,endEntity:y=null,monitorEntity:v=null,inAppNotificationsEntity:f=null}={...e},{coreSettings:S}=t,{activeEntities:k}=d,{action:C,type:w}=r,{enableMTMACommanding:T}=S.get(b.J.Core),I=!!T&&l!==c.userContextId;if(!I&&!a&&(("default"===C||"default"===w&&"view"===C)&&k&&w===Pf(k).type||d.activeEntities&&i))return d;const N={__typename:"ActiveEntities",midNavEntity:mf(u),subNavEntity:Sk(m,s),headerEntity:mf(p),startEntity:mf(g),mainEntity:mf(h)??r,endEntity:mf(y),entityExtension:null,monitorEntity:v,inAppNotificationsEntity:f},[E,A]=eS({context:t,logger:o,windowContentState:d,newActiveEntities:N,isUserContextSwitch:I});return o.log(`Flushing window - ${Nf(r)} and correlation ${n.id}`),{activeEntities:N,windowHistory:E,currentWindowHistoryIndex:A?E.length-1:d.currentWindowHistoryIndex,layoutMode:c.layoutConfig.layoutMode,userContextId:l,windowId:c.id}}({appViewEntities:e,context:g,correlation:t,isCurrentEntitiesInvalid:o,isInputDefaultEntity:r,logger:s,newEntity:i,sourceHint:c,userContextId:m,window:u,windowContentState:f});else if(vk({activeEntities:y,stateTransition:d,executionContext:a}))f=function({activeEntities:e,appViewEntities:t,context:n,executionContext:i,logger:a,window:o,windowContentState:r}){const s=Uf({executionContext:i,viewEntityName:"headerEntity"}),l=s||Uf({executionContext:i,viewEntityName:"startEntity"}),c=l||Uf({executionContext:i,viewEntityName:"mainEntity"}),d=c||Uf({executionContext:i,viewEntityName:"endEntity"});a.log(`Issuing flow command on window - headerEntity ${s}, startEntity ${l}, \n        mainEntity ${c}, endEntity ${d}`);const u={...e,headerEntity:s?mf(t?.headerEntity):e.headerEntity,startEntity:l?mf(t?.startEntity):e.startEntity,mainEntity:c?mf(t?.mainEntity)??e.mainEntity:e.mainEntity,endEntity:d?mf(t?.endEntity):e.endEntity},[m]=eS({context:n,isUserContextSwitch:!1,logger:a,newActiveEntities:u,windowContentState:r});return{activeEntities:u,windowHistory:m,currentWindowHistoryIndex:m.length-1,layoutMode:o.layoutConfig.layoutMode,userContextId:o.userContextId,windowId:o.id}}({activeEntities:y,appViewEntities:e,context:g,executionContext:a,logger:s,window:u,windowContentState:f});else if(function(e,t,n){return!!e&&(Yv(e.mainEntity,t)||Yv(e.endEntity,t))&&"extend"!==n}(y,i,d))!function(e,t,n,i){e!==ke.su.new&&t.log(`Entity already exists in the active entities no state transition made - ${Nf(n)} and correlation ${i}`)}(d,s,i,t.id),f=function(e,t,n,i,a){const{activeEntities:o}=n;if(!o)return n;const{mainEntity:r,endEntity:s}=o,l={...o},{entityState:c,...d}=i;Yv(r,i)?l.mainEntity={...r,...d}:s&&Yv(s,i)&&(l.endEntity={...s,...d});const[u]=eS({context:e,isUserContextSwitch:!1,logger:t,newActiveEntities:o,windowContentState:n});return{activeEntities:l,windowHistory:u,currentWindowHistoryIndex:u.length-1,layoutMode:a.layoutConfig.layoutMode,userContextId:a.userContextId,windowId:a.id}}(g,s,f,i,u);else if("extend"===d){const e=function({activeEntities:e,extendedEntityContainerState:t,logger:n,newEntity:i,windowContentState:a}){const o=t.containerState===ke.oq.Confirmed,r=t.containerState===ke.oq.Error,s=e.entityExtension&&t.isExternal;if("platformapp"===i.type&&"create"===i.action||"devicedetails"===i.type&&"view"===i.action||"storecartcheckout"===i.type&&"view"===i.action||"storecart"===i.type&&"view"===i.action||!e.entityExtension||o||r||s)return t=df(),a.activeEntities={...e,entityExtension:i},[t,a];n.log(`Not showing extension: exists ${!!e.entityExtension}, isConfirmed ${o}, \n  hasError ${r}, hasExternalDialog ${s}`)}({activeEntities:y,extendedEntityContainerState:v,logger:s,newEntity:i,windowContentState:f});if(!e)throw new Error(`Extension already rendered, only one extension command request can be processed at a time. \n        Extension shown: ${y.entityExtension?.type}; Extension requested: ${i.type}.`);v=e[0],f=e[1]}else f=bk({activeEntities:y,appViewEntities:e,correlation:t,enableMultiSlotNone:n,newEntity:i,executionContext:a,logger:s,windowContentState:f});if(function(e,t,n,i){const{enableMTMACommanding:a}=e.get(b.J.Core);return!(!a||t||!n||!i.userContextId||n===i.userContextId)}(h,"flush"===d||"forceFlush"===d||"extend"===d,m,u))throw new Error("Different user context sent for non-flush and non-extend command");const S=u.windowHistoryNavigationState,k={...S,backHistory:[...S.backHistory??[]],forwardHistory:[...S.forwardHistory??[]]};return{...u,...f,correlation:t,extendedEntityContainerState:v,windowHistoryNavigationState:k}}function Tk(e,t,n,i){switch(e){case"hide":return hk(t,n,i);case"toggle":return yk(t);case"show":case"showWithoutFocusing":return wk(t,n)}}function Ik(e,t){if(void 0!==t){const n=t?gf(t):null;e.linkedEntity=n}}function Nk(e,t,n,i,a){const{visibilityState:o,stateTransition:r,layoutMode:s,targetWindow:l}=e;if("hide"!==o){if(i&&"new"===r)return(0,Re.v4)();if(a&&n===h.ew||"main"===l){if(!sS(t,s??ke.lO.standard))return(0,Re.v4)()}else if(function(e,t){return t===h.ew&&!uS(e,h.ew)}(t,n))return h.ew}}function Ek({activeWindows:e,command:t,coreSettings:n,correlation:i,entitiesMap:a,entity:o,isNewContextSupportEnabled:r,layoutMode:s,linkedEntitiesMap:l,logger:c,userContextId:d,windowId:u,webNrcEnabled:m}){const{stateTransition:p,targetWindow:g}=t,y="forceFlush"===p||"main"===g,v="flow"===p,f="extend"===p,[S,k]=!r||y||v||f?[void 0,!1]:mS(o,a,l,d,n);S&&(c.log(`Entity matched matched via linked entity ${k} for correlation ${i.id} to window`),_f(S,c));const C=S||function({command:e,activeWindows:t,windowId:n,correlation:i,logger:a,isNewContextSupportEnabled:o,layoutMode:r,userContextId:s,webNrcEnabled:l}){const c=Nk(e,t,n,o,l);return void 0!==c?(a.log(`Creating new window with id ${c} for correlation ${i.id}`),function(e,t,n,i,a,o,r){const{visibilityState:s,stateTransition:l,targetWindow:c}=a;return{__typename:"Window",id:t,windowOptions:null,windowHistory:[],currentWindowHistoryIndex:0,windowHistoryNavigationState:{__typename:"WindowHistoryNavigationState",canNavigateBack:!1,canNavigateForward:!1,backHistory:[],forwardHistory:[]},correlation:{...e,__typename:"Correlation"},extendedEntityContainerState:df(),blockingEntityExtension:null,isMainWindow:!r||l!==ke.su.new&&i===h.ew||"main"===c,isNotificationsWindow:!1,isInitialWindowStateHidden:s===ke.fe.showWithoutFocusing,userContextId:o,layoutConfig:{__typename:"LayoutConfig",layoutMode:n??(t===h.ew||l!==ke.su.new||"main"===c?ke.lO.standard:ke.lO.focus),isFullscreen:!1,slots:wf()}}}(i,c,r,n,e,s,o)):cS(n)||"main"===e.targetWindow?(a.log(`Retrieving mainWindow with layoutMode ${r} for correlation ${i.id}`),sS(t,r??ke.lO.standard)):(a.log(`Retrieving window with id ${n} for correlation ${i.id}`),uS(t,n))}({activeWindows:e,command:t,correlation:i,isNewContextSupportEnabled:r,layoutMode:s,logger:c,userContextId:d,windowId:u,webNrcEnabled:m});if(!C)throw function(e,t){return t.errorToTelemetry?.("Unable to get source window",uk,void 0,!0),(0,de.Tr)(h.w5.Commanding,h.jK.UndefinedWindowError,"CommandResolvers",e,"Unable to find applicable target window")}(i,c);return[C,k]}function Ak(e,t,n,i,a){const o=pf(e),{webNrcEnabled:r}=a.get(b.J.Host),s=r?e=>e.id!==h.ew:void 0,[l,c]=ef(t,tf,s),[d]=mS(o,l,c,i,a);return d&&(n.log(`Found window for entity ${Nf(o)}`),_f(d,n)),d||null}function _k(e,t,n,i){const a=e.activeEntities;return!!a?.entityExtension&&(a.entityExtension=null,e.extendedEntityContainerState.containerState=ke.oq.Error,aS(t,n,e,i))}const Fk=(e,t,n,i,a,o)=>{const{appsRegistryService:r,cache:s,commandChangeReportingService:l,localStorage:c,coreSettings:d,windowId:u,...m}=n,p={...e,extendedEntityContainerState:{...e.extendedEntityContainerState,...t}},g=e.blockingEntityExtension;p.blockingEntityExtension=null;const h=aS(n,a,p,i),y=((e,t,n)=>{const i=e?.blockedEntity,a=e?.blockedCommand,o=e?.blockedEntityOptions;if(!i||!a)return t.warn("Unable to re-create the command which was blocked and saved."),null;const r=uf();r.source=C.D.CoreResolvers;const s={entity:i,command:{...a,correlation:r},entityOptions:o};return n.report({type:dt.B.CommandStart,correlationId:s.command.correlation.id,context:{target:"createAndRegisterBlockedCommandOnConfirm",entityCommand:{...s,entityOptions:o?JSON.parse(o):void 0}}}),s})(g,i,l);if(y){const{entity:e,command:t,entityOptions:n}=y;return!!Lk({entity:e,command:t,entityOptions:n,windowId:u,clientLaunchId:p.correlation.clientLaunchId},{appsRegistryService:r,cache:s,commandChangeReportingService:l,coreSettings:d,localStorage:c,windowId:u,...m},o)}return h},Dk=({entity:e,windowId:t},n)=>{const{cache:i,loggerFactory:a,activeWindowsService:o}=n,r=a.newLogger("removeFromWindowHistory-mutation","data-client-entity-command"),s=pf(e);r.log(`Removing entity from history: ${Nf(s)}`);const l=iS(i,r,o),c=uS(l,t);return c?((({window:e,entity:t,logger:n,context:i,activeWindows:a})=>{const{localStorage:o,coreSettings:r,appsRegistryService:s}=i;let l=0,c=!1;const d=[];e.windowHistory.forEach(((n,i)=>{Xv(t,n.activeEntities)?i<e.currentWindowHistoryIndex?l++:i===e.currentWindowHistoryIndex&&(c=!0):d.push(n)}));const u=e.currentWindowHistoryIndex===e.windowHistory.length-1||c?void 0:e.currentWindowHistoryIndex-l;if(e.windowHistory=d,Kf(e,n,u,r),lS(a,e.id)){const{enableWindowHistoryRestorationOnStandardMain:i,enableWriteAppHistoryToLocalStorage:a,enableWriteActiveEntitiesToLocalStorage:l,enableMTMACommanding:c}=r.get(b.J.Core);if(i&&zf(e,o,n),a&&s.appsWithAppHistoryStored.forEach((i=>{const a=Gf({localStorage:o,logger:n,appsRegistryService:s,userContextId:e.userContextId,entityType:void 0,appId:i});a&&Xv(t,a)&&o.remove((0,Bf.bM)(`${Bf.av}-${i}`,e.userContextId),"Experience")})),l){const i=Vf(o,n,e.userContextId,c);i&&Xv(t,i)&&o.remove((0,Bf.bM)(Bf.WD,e.userContextId),"Experience")}}})({window:c,entity:s,logger:r,context:n,activeWindows:l}),aS(n,l,c,r,void 0,void 0,!0)):(r.warn(`Could not retrieve window with id ${t}`),!1)},Pk=({logger:e,appsRegistryService:t,coreSettings:n,layoutMode:i})=>{const a=t.getDefaultCommand(n,i);return a?(e.log("Default command found"),a):(e.error("No default command defined"),null)},Mk=({context:e,correlation:t,logger:n,newEntity:i,shouldUseNewEntity:a,sourceWindow:o,stateTransition:r})=>{const{commandChangeReportingService:s,clientPreferences:l,appsRegistryService:c,coreSettings:d}=e,{appEntity:u,contextEntity:m}=Mf({currentEntities:nf(o)?o.activeEntities:void 0,entity:i,shouldUseNewEntity:a});t&&s.report({type:dt.B.CommandBeforeGetAppViewEntities,context:{target:"executeEntityCommand"},correlationId:t.id});let p=null;try{p=Rf({appsRegistryService:c,clientPreferences:l,contextEntity:m,coreSettings:d,entity:u,layoutMode:o.layoutConfig.layoutMode}),(({appViewEntities:e,stateTransition:t,appEntity:n,linkedEntity:i})=>t!==ke.su.none&&null===e&&n===i)({appEntity:u,appViewEntities:p,linkedEntity:i.linkedEntity,stateTransition:r})&&(n.log(`Initial getAppViewEntities for ${u} returned null`),p=Rf({entity:i,clientPreferences:l,contextEntity:null,coreSettings:d,layoutMode:o.layoutConfig.layoutMode,appsRegistryService:c}))}catch(e){t&&s.report({type:dt.B.Failure,context:{errorInfo:ct.y.CommandGetAppViewEntitiesFailure,errorMessage:e.message,target:"executeEntityCommand"},correlationId:t.id})}return p},xk=({isInputDefaultEntity:e,sourceWindow:t,context:n,userContextId:i,newEntity:a,matchedLinkedEntity:o,stateTransition:r,executionContext:s,correlation:l,logger:c})=>{const{localStorage:d,coreSettings:u,appsRegistryService:m,clientPreferences:p}=n,{enableWriteActiveEntitiesToLocalStorage:g,enableMTMACommanding:h,enableWriteAppHistoryToLocalStorage:y}=u.get(b.J.Core);let v=null,f=!1;e&&t.isMainWindow&&g?v=Vf(d,c,i,h):"default"===a.action&&t.isMainWindow&&y&&(v=Gf({localStorage:d,logger:c,appsRegistryService:m,userContextId:i,entityType:a.type}));const S=nf(t)?t.activeEntities:void 0;if(v){c.log("Got appViewEntities from local storage history: "),Df(v,c);const e=Uk(v,m),n=Uk(S,m),i=e?.onBeforeNavigationFromHistory?.(v,{coreSettings:u,layoutMode:t.layoutConfig.layoutMode,userPreferences:xf(p)},n?.manifest.id===e?.manifest.id?S:void 0),a=i&&{midNavEntity:null,subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:null,endEntity:null,...i};f=!!i,f&&(c.log("App declared history invalid. New set of entities:"),Df(a,c)),v=a||v}else{const e=(({currentEntities:e,newEntity:t,matchedLinkedEntity:n,stateTransition:i,executionContext:a})=>!e||fk({entity:t,mainEntity:e.mainEntity,matchedLinkedEntity:n,stateTransition:i})||vk({activeEntities:e,stateTransition:i,executionContext:a}))({currentEntities:S,newEntity:a,matchedLinkedEntity:o,stateTransition:r,executionContext:s});c.log(`Should use entity from command input for getAppViewEntities ${e} `),v=Mk({context:n,correlation:l,logger:c,newEntity:a,shouldUseNewEntity:e,sourceWindow:t,stateTransition:r})}return{appViewEntities:v,isCurrentEntitiesInvalid:f}},Rk=({context:e,correlation:t,logger:n,newEntity:i,pubsub:a,sourceWindow:o,stateTransition:r,userContextId:s})=>{n.log(`Targeting main window, but userContextId of command ${s} does not match main window user ${o.userContextId}`);const{coreSettings:l,appsRegistryService:c}=e,d=(({appsRegistryService:e,coreSettings:t,newEntity:n,stateTransition:i})=>{let a=!1;return"flush"===i&&(a=e.getApp({entityType:n.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:t,entity:n})||!1),a})({appsRegistryService:c,coreSettings:l,newEntity:i,stateTransition:r});return n.log(`allowUserWindowingPreference: ${d}`),d?(n.log("Popping out"),Lk({entity:i,command:{stateTransition:"new",visibilityState:"show",correlation:t},windowId:o.id,clientLaunchId:o.correlation.clientLaunchId,executionContext:{userContextId:s},entityOptions:i.options},e,a),null):(({correlation:e,sourceWindow:t,logger:n,context:i,pubsub:a,userContextId:o,newEntity:r})=>{n.log("Launching switch account dialog");const{authenticationService:s}=i;return o?(s.getUser({accountId:o,correlation:e}).then((s=>(n.log(`Got user from auth service ${s.id}`),Lk({entity:{type:"switchaccountdialog",action:"view"},command:{stateTransition:"extend",visibilityState:"show",correlation:e},entityOptions:JSON.stringify({originalCorrelation:e,originalEntity:r,userContextId:o,userName:s.userName}),windowId:t.id,clientLaunchId:t.correlation.clientLaunchId},i,a)))).catch((e=>{n.errorToTelemetry?.("Unable to getUser from auth",uk,void 0,!0)})),null):(n.log("UserContextId is undefined so unable to launch switch account dialog"),null)})({correlation:t,sourceWindow:o,logger:n,context:e,pubsub:a,userContextId:s,newEntity:i})},jk=({command:e,context:t,correlation:n,entitiesMap:i,entityOptions:a,executionContext:o,logger:r,matchedLinkedEntity:s,pubsub:l,sourceHint:c,sourceWindow:d,userContextId:u,windowOptions:m,newEntity:p,defaultEntityBehindExtension:g})=>{const{coreSettings:h,commandChangeReportingService:y}=t,{enableEmptyWindowDialogForDeeplink:v}=h.get(b.J.Core),{stateTransition:f,targetWindow:S}=e;if("extend"===f){if("extend"===f&&v&&(!nf(d)||null===d.userContextId&&null!=u)&&d.isMainWindow){const e=(({context:e,correlation:t,entitiesMap:n,entityOptions:i,executionContext:a,logger:o,matchedLinkedEntity:r,pubsub:s,sourceHint:l,sourceWindow:c,userContextId:d,windowOptions:u,defaultEntityBehindExtension:m})=>{const{authenticationUser:p,coreSettings:g,appsRegistryService:h,commandChangeReportingService:y,clientPreferences:v,windowProvider:f}=e,{enableMultiSlotHide:S,enableMultiSlotNone:k}=g.get(b.J.Core);if(p?.role===ys.w4.Anonymous){const e=ct.y.EmptyWindowError;return o.log(`Anonymous user - extension command error ${e}`),y.report({correlationId:t.id,type:dt.B.Incomplete,context:{errorInfo:e,target:"executeEntityCommand"}}),null}o.log("Extension command - creating main window");const C=m||Pk({logger:o,appsRegistryService:h,coreSettings:g,layoutMode:c.layoutConfig.layoutMode});if(!C)throw new Error("No default entity. Unable to show extension");const w=pf(C,i,u),{appViewEntities:T,isCurrentEntitiesInvalid:I}=xk({isInputDefaultEntity:!0,sourceWindow:c,context:e,userContextId:d,newEntity:w,matchedLinkedEntity:!1,stateTransition:"flush",executionContext:a,correlation:t,logger:o});return o.log(`Extension command - flushing with entity ${Nf(w)}`),Df(T,o),c=Tk("show",{appsRegistryService:h,appViewEntities:T||void 0,clientPreferences:v,commandChangeReportingService:y,correlation:t,coreSettings:g,enableMultiSlotHide:S,enableMultiSlotNone:k,entitiesMap:n,entity:w,entityOptions:i,executionContext:a,host:f,isCurrentEntitiesInvalid:I,isInputDefaultEntity:!0,logger:o,matchedLinkedEntity:r,sourceHint:l,stateTransition:"flush",userContextId:d,window:c},e,s),o.log("Extension command - created source window"),_f(c,o),c})({context:t,correlation:n,entitiesMap:i,entityOptions:a,executionContext:o,logger:r,matchedLinkedEntity:s,pubsub:l,sourceHint:c,sourceWindow:d,userContextId:u,windowOptions:m,defaultEntityBehindExtension:g});if(!e)return null;if(!nf(d=e))return r.log("Tried creating main window for dialog but window is empty"),y.report({correlationId:n.id,type:dt.B.Incomplete,context:{errorInfo:ct.y.EmptyWindowError,target:"executeEntityCommand"}}),null}if(!(k=p,"switchaccountdialog"===k.type&&"view"===k.action||d.userContextId===u||null===d.userContextId))return r.log("User context of source window does not match user context of command. Rejecting command"),y.report({correlationId:n.id,type:dt.B.Incomplete,context:{errorInfo:ct.y.UserContextMismatch,target:"executeEntityCommand"}}),null}else if((({sourceWindow:e,stateTransition:t,targetWindowType:n,userContextId:i})=>"main"===n&&("forceFlush"===t||"flush"===t)&&e.userContextId!==i)({sourceWindow:d,stateTransition:f,targetWindowType:S,userContextId:u}))return Rk({context:t,correlation:n,logger:r,newEntity:p,pubsub:l,sourceWindow:d,stateTransition:f,userContextId:u});var k;return d},Lk=({clientLaunchId:e,command:t,entity:n,entityOptions:i,executionContext:a,windowId:o,windowOptions:r,defaultEntityBehindExtension:s},l,c)=>{const{appsRegistryService:d,authenticationUser:u,cache:m,clientPreferences:p,commandChangeReportingService:g,coreSettings:y,experienceChangeReportingService:v,loggerFactory:f,notificationsHandler:S,windowProvider:k,scenarioFactory:C,activeWindowsService:w}=l,T=f.newLogger("executeEntityCommand-mutation","data-client-entity-command"),{visibilityState:I,stateTransition:N,correlation:E,layoutMode:A}=t;try{const f=o||h.ew,_=((e,t)=>t?{...t,clientLaunchId:e??null,__typename:"Correlation"}:{...uf(),clientLaunchId:e??null,__typename:"Correlation"})(e??null,E);g.report({correlationId:_.id,type:dt.B.CommandResolutionStarted,context:{target:"executeEntityCommand"}});const F=iS(m,T,w),[D,P]=ef(F,tf,(e=>!lS(F,e.id)&&!((e,t)=>{const n=sS(e,ke.lO.minimal);return t===n?.id})(F,e.id)&&!((e,t)=>{const n=sS(e,ke.lO.minimode);return t===n?.id})(F,e.id))),M=(e=>e.action===Se.uk.default&&e.type===Se.py.default)(n),x=(e=>e.action===Se.uk.view&&e.type===Se.py.default)(n),R=E?.sourceHint,j=(({entity:e,isInputDefaultEntity:t,isInputDefaultViewEntity:n,logger:i,appsRegistryService:a,coreSettings:o,layoutMode:r})=>t||n?Pk({logger:i,appsRegistryService:a,coreSettings:o,layoutMode:r}):e)({entity:n,isInputDefaultEntity:M,isInputDefaultViewEntity:x,logger:T,appsRegistryService:d,coreSettings:y,layoutMode:A});if(!j)return T.errorToTelemetry?.("Unable to use entity from command input",uk,void 0,!0),null;const L=pf(j,i,r);if(function(e){return e.type===Se.py.toasts}(L))return ck({activeWindows:F,context:l,command:t,correlation:_,entity:n,entityOptions:i,logger:T,notificationsHandler:S,newEntity:L});T.log(`Command received for entity ${Nf(L)}`),T.log(`Command received :${function(e){return`{\n  visibilityState: ${e.visibilityState},\n  stateTransition: ${e.stateTransition},\n  correlation: ${Ef(e.correlation,1)},\n  layoutMode: ${e.layoutMode},\n  targetWindow: ${e.targetWindow}\n}`}(t)}`),T.log(`Command with id ${_.id} received on window context ${f}`),T.log(`Command received with execution context: ${a?.viewEntityName}`),((e,t,n,i)=>{const{stateTransition:a,targetWindow:o}=e,{enableCommandingMainWindowTargeting:r}=i.get(b.J.Core);if(o&&!r||"main"===o&&"extend"!==a&&"forceFlush"!==a&&"flush"!==a)throw t.errorToTelemetry?.(`Invalid command targetWindow ${o} stateTransition ${a}`,uk,void 0,!0),(0,de.Tr)(h.w5.Commanding,h.jK.InvalidInput,"CommandResolvers",n,`Invalid command ${o} stateTransition ${a}`)})(t,T,_,y);const{isNewContextSupportEnabled:O,webNrcEnabled:$}=y.get(b.J.Host),{enableMultiSlotHide:U,enableMultiSlotNone:B,enableWindowNotUpdatedEvent:W,enableMTMACommanding:V,forceFocusLayoutMode:G,enableWindowHistoryRestorationOnStandardMain:z,enableTrimmingWindowHistoryBeforeRestoration:q}=y.get(b.J.Core),J=sS(F,"standard"),Q=V&&(a?.userContextId||vf(u)||"extend"===N&&J&&J.userContextId)||null;T.log(`isNewContextSupportEnabled ${O}, enableMultiSlotHide ${U}, enableMultiSlotNone ${B}`);const K=((e,t)=>t?ke.lO.focus:e&&(e.layoutMode||ke.lO.focus))(k.Cypress,!!G),Y=Ek({activeWindows:F,command:t,coreSettings:y,correlation:_,entitiesMap:D,entity:L,isNewContextSupportEnabled:O??!0,layoutMode:K??A,linkedEntitiesMap:P,logger:T,userContextId:Q,windowId:f,webNrcEnabled:$??!1});let[X]=Y;const[,Z]=Y;let ee=!1;z&&X&&!nf(X)&&X.isMainWindow&&"standard"===X.layoutConfig.layoutMode&&(X=((e,t,n,i,a,o,r)=>{const s=n.get((0,Bf.bM)(Bf.Hs,a),"Experience");if(s)try{const l=JSON.parse(s);if(o&&a!==l.userContextId)return i.warnToTelemetry?.("User context of window doesn't match user context of stored history","webclient_framework_foundation_core_services_entity_commanding",void 0,!0),e;let c=parseInt(l.windowHistoryIndex,10);if(isNaN(c))return i.warnToTelemetry?.(`Store window history has invalid history index. CurrentWindowHistoryIndex ${l.windowHistoryIndex}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0),e;const d=n.get((0,Bf.bM)(Bf.ax,a),"Experience");if(d){let n=Qf(JSON.parse(d),i);const a=n.length,o=t.history.length;return r&&a>o&&(i.log(`Trimming window history to match host history size. windowHistorySize: ${a}, hostHistorySize: ${o}`),n=n.slice(0-o),c=Math.max(0,c-(a-o)),i.log(`New windowHistory size: ${n.length}, new currentWindowHistoryIndex: ${c}`)),{...e,windowHistory:n,currentWindowHistoryIndex:c}}i.warn("Could not restore history from storage")}catch(e){i.errorToTelemetry&&i.errorToTelemetry(`Could not restore main window nav history from local storage ${e.message}`,"webclient_framework_foundation_core_services_entity_commanding",void 0,!0)}else i.warn("Could not restore main window nav history index from local storage. IndexAndUserFromStorage is null");return e})(X,l.windowProvider,l.localStorage,T,Q,V,q),X.windowHistory.length>0&&(T.log("Restored main window navigation history from local storage"),ee=!0));const te=jk({command:t,context:l,correlation:_,entitiesMap:D,entityOptions:i,executionContext:a,logger:T,matchedLinkedEntity:Z,pubsub:c,sourceHint:R,sourceWindow:X,userContextId:Q,windowOptions:r,newEntity:L,defaultEntityBehindExtension:s});if(null===te)return null;X=te;const{appViewEntities:ne,isCurrentEntitiesInvalid:ie}=xk({isInputDefaultEntity:M,sourceWindow:X,context:l,userContextId:Q,newEntity:L,matchedLinkedEntity:Z,stateTransition:N,executionContext:a,correlation:_,logger:T});if(g.report({type:dt.B.CommandAfterGetAppViewEntitiesSucceeded,context:{target:"executeEntityCommand"},correlationId:_.id}),T.log("Final appViewEntities: "),Df(ne,T),T.log(`Before updating cache, There are ${F.length} active windows`),T.log("Source window: "),_f(X,T),null===ne)throw T.errorToTelemetry?.("No app supports entity command",uk,void 0,!0),new Error("no app view entities for entity input");let ae=Tk(I,{appsRegistryService:d,appViewEntities:ne,clientPreferences:p,commandChangeReportingService:g,correlation:_,coreSettings:y,enableMultiSlotHide:U,enableMultiSlotNone:B,entitiesMap:D,entity:L,entityOptions:i,executionContext:a,host:k,isCurrentEntitiesInvalid:ie,isInputDefaultEntity:M,logger:T,matchedLinkedEntity:Z,sourceHint:R,stateTransition:N,userContextId:Q,window:X},l,c);T.log("Target window: "),_f(ae,T),nf(X)&&nf(ae)&&X.activeEntities?.monitorEntity&&(ae.activeEntities.monitorEntity=X.activeEntities?.monitorEntity),nf(X)&&nf(ae)&&X.activeEntities?.inAppNotificationsEntity&&t.visibilityState!==ke.fe.hide&&(ae.activeEntities.inAppNotificationsEntity=X.activeEntities?.inAppNotificationsEntity);const oe=function(e,t){return af(nf(e)?e.activeEntities:null,nf(t)?t.activeEntities:null)}(X,ae);!function(e,t,n,i,a,o,r){const s=(0,Ao.YR)(e,n);r.log(`ViewportContext: ${s}`);const l={"Panel.WindowID":t,"Window.ViewportContext":s};a.report({correlationId:i,type:dt.B.ScenarioEventDataAppended,context:{target:"setViewportContextOnLaunchScenarios",eventData:l}});const c=o.findScenario(H.RG.WindowLaunchTime);c?.appendEventData(l)}(ae.isMainWindow,ae.id,ae.layoutConfig.layoutMode,_.id,g,C,T);const re=X.id===h.ew&&"new"!==N&&"none"!==N;if(fS(oe,f,re,"flow"===N||"none"===N,y,T)){T.log(`Opener will handle the requested entity change with correlationId ${_.id} and entityId ${n.id}`);let e=!0;oe.entityExtension&&(ae.extendedEntityContainerState.isExternal=!0,e=aS(l,F,ae,T));const t=uS(F,h.ew);if(t&&(e=>!(!e.activeEntities.entityExtension||e.extendedEntityContainerState.containerState===ke.oq.Closed))(t)&&ik(t,F,T,_,l),e)try{return(({correlation:e,diff:t,commandChangeReportingService:n,windowId:i,logger:a,targetWindow:o,context:r,activeWindows:s})=>{if(SS(e,t,n,i,a,r.coreSettings))return null;throw _k(o,r,s,a),a.errorToTelemetry?.("Unable to update cache, opener did not handle change",uk),(0,de.Tr)(h.w5.Commanding,h.jK.UnhandledRuntimeException,"executeEntityCommand",void 0,"Unable to update cache, opener did not handle the entity change")})({correlation:_,diff:oe,commandChangeReportingService:g,windowId:f,logger:T,targetWindow:ae,context:l,activeWindows:F})}catch(e){throw _k(ae,l,F,T),T.errorToTelemetry?.("Unable to update cache, errored while having opener handle change",uk,{errors:`${e.message}`}),(0,de.Tr)(h.w5.Commanding,h.jK.UnhandledRuntimeException,"executeEntityCommand",e,"Unable to update cache, opener threw an exception and did not handle the entity change")}}if(((e,t,n)=>{const i=nf(e)?e.activeEntities.entityExtension:null,a=nf(t)?t.activeEntities.entityExtension:null;return!(t.extendedEntityContainerState.containerState===ke.oq.Closed||!(i&&cf(n)||!a))})(X,ae,oe)&&(ae=((e,t,n,i,a)=>{let o=e;return e.extendedEntityContainerState.isExternal?n.log(`Internal routing - closing external dialog for correlation ${a.id}`):(n.log(`Internal routing - closing internal dialog for correlation ${a.id}`),nf(e)&&(o=ak(e,a))),e.id===h.ew&&(n.log(`Internal routing - send close extension to angular for correlation ${a.id}`),nk(t,n,i)),o})(ae,X,T,g,_)),T.log(`Handling the requested entity command internally for correlation ${_.id}`),gS({pubsub:c,fromWindowId:f,isFromWindowMain:lS(F,f),sourceWindowId:X.id,diff:oe,targetWindow:ae,targetVisibilityState:I,stateTransition:N,correlation:_,logger:T}),Kf(ae,T,ee?ae.currentWindowHistoryIndex:void 0,y),W&&!of(X,ae))return g.report({correlationId:_.id,type:dt.B.WindowNotUpdated,context:{target:"executeEntityCommand"}}),null;if(X.correlation.id!==_.id){const e=nf(X)?X.activeEntities:void 0;e&&g.report({correlationId:_.id,type:dt.B.ScenarioEventDataAppended,context:{target:"executeEntityCommand",eventData:{fromMainEntityType:e.mainEntity.type,fromMainEntityAction:e.mainEntity.action}}}),g.report({correlationId:X.correlation.id,type:dt.B.Abandoned,context:{target:"executeEntityCommand"}}),v.report({correlationId:_.id,type:gt.yU.ActiveEntitiesDestroyed,context:{target:"entity-command-resolver"},windowId:X.id})}!Yv(nf(ae)?ae.activeEntities.mainEntity:null,nf(X)?X.activeEntities.mainEntity:null)&&nf(X)&&(ae=bf(ae,{resetMonitor:null===X.activeEntities.monitorEntity}));const se=()=>{const e=function(e){const t=[];return Object.keys(e).map((n=>{const i=e[n];i&&t.push(i)})),t}(oe);e.length>0&&v.report({correlationId:_.id,type:gt.yU.ActiveEntitiesResolved,context:{target:"entity-command-resolver",entities:e},windowId:ae.id}),g.report({correlationId:_.id,type:dt.B.WindowUpdated,context:{target:"executeEntityCommand"}})},le=aS(l,F,ae,T,_.id,se);return le&&!w.enableDecoupleCommandingFromApollo&&se(),le&&nf(ae)?ae:null}catch(e){throw T.errorToTelemetry?.(`Unable to execute entity command ${I} ${N} -  ${e.message}`,uk,{mainEntityType:n.type,mainEntityAction:n.action,correlationId:E.id},!0),e}},Ok=(e,t,{cache:n,windowId:i,commandChangeReportingService:a,...o},r)=>{if(!e.activeEntities.entityExtension)return!1;const s=tk(e,t,a);if(s){const{entity:t,command:l}=s;return Lk({entity:t,command:l,windowId:i,clientLaunchId:e.correlation.clientLaunchId},{cache:n,windowId:i,commandChangeReportingService:a,...o},r)}return!1},$k=e=>({Query:{activeWindow(e,{windowId:t},{cache:n,coreSettings:i,loggerFactory:a,activeWindowsService:o}){const r=a.newLogger("activeWindow","data-client-entity-command"),{webNrcEnabled:s}=i.get(b.J.Host),l=t||h.ew;let c;const d=iS(n,r,o,!1);if(c=l===h.ew&&s?sS(d,"standard"):d.find((e=>e.id===l)),!c)throw new Error(`Requesting activeWindow for unknown windowId ${l}`);return c},activeWindowForEntity(e,{entity:t},{cache:n,loggerFactory:i,authenticationUser:a,coreSettings:o,activeWindowsService:r}){const s=i.newLogger("activeWindowForEntity-query","data-client-entity-command"),l=iS(n,s,r),{enableMTMACommanding:c}=o.get(b.J.Core);return Ak(t,l,s,c?vf(a):null,o)},isEntityInActiveWindow(e,{entity:t,windowId:n},{cache:i,loggerFactory:a,activeWindowsService:o}){const r=a.newLogger("isEntityInActiveWindow-query","data-client-entity-command"),s=uS(iS(i,r,o),n),l=pf(t);if(r.log(`Querying window ${n} for entity: ${Nf(l)}`),!s)return r.errorToTelemetry?.(`No window found for windowId ${n}`,uk,void 0,!0),!1;const c=function(e,t){return Yv(e,t.midNavEntity)||Yv(e,t.subNavEntity)||Yv(e,t.headerEntity)||Yv(e,t.startEntity)||Yv(e,t.mainEntity)||Yv(e,t.endEntity)}(l,s.activeEntities);return r.log(`entityExist: ${c}`),c}},Mutation:{navigateToWindowHistoryIndex:(e,t,n)=>(({windowId:e,windowHistoryIndex:t},n)=>{const{cache:i,loggerFactory:a,activeWindowsService:o}=n,r=a.newLogger("navigateToWindowHistoryIndex-mutation","data-client-entity-command");r.log(`Navigating to windowHistoryIndex ${t} on window ${e}.`);const s=iS(i,r,o),l=uS(s,e);if(!l)throw new Error("Could not find window.");return!(0===l.windowHistory?.length||t<0||t>l.windowHistory.length-1)&&yS(l,t,r,s,n)})(t,n),performWindowHistoryNavigation:(e,t,n)=>(({windowId:e,navigationDirection:t},n)=>{const{cache:i,loggerFactory:a,activeWindowsService:o}=n,r=a.newLogger("performWindowHistoryNavigation-mutation","data-client-entity-command");r.log(`Navigating ${e} with direction ${t}.`);const s=iS(i,r,o),l=uS(s,e);if(!l)throw new Error("Could not find window.");if(0===l.windowHistory?.length)return!1;let c=l.currentWindowHistoryIndex;const d=e=>r.warn(`Could not navigate ${t}. Index ${e} is out of the bounds of the window history.`);if("back"===t){if(c--,c<0)return d(c),!1}else if(++c,c>l.windowHistory.length-1)return d(c),!1;return yS(l,c,r,s,n)})(t,n),pushToWindowHistory:(e,t,n)=>(({entity:e,entityOptions:t,windowId:n},i)=>{const{cache:a,loggerFactory:o,activeWindowsService:r,coreSettings:s}=i,l=o.newLogger("pushToWindowHistory-mutation","data-client-entity-command"),c=pf(e,t);l.log(`Saving entity to history: ${Nf(c)}`);const d=iS(a,l,r),u=uS(d,n);if(!u)return l.warn(`Could not retrieve window with id ${n}`),!1;const m=Mk({context:i,logger:l,newEntity:c,shouldUseNewEntity:!0,sourceWindow:u,stateTransition:"flush"}),{midNavEntity:p=null,subNavEntity:g=null,headerEntity:h=null,startEntity:y=null,mainEntity:v=null,endEntity:f=null,monitorEntity:S=null,inAppNotificationsEntity:k=null}={...m},C={__typename:"ActiveEntities",midNavEntity:mf(p),subNavEntity:Sk(g,void 0),headerEntity:mf(h),startEntity:mf(y),mainEntity:mf(v)??c,endEntity:mf(f),entityExtension:null,monitorEntity:S,inAppNotificationsEntity:k},b={activeEntities:u.activeEntities,windowHistory:u.windowHistory,currentWindowHistoryIndex:u.currentWindowHistoryIndex,layoutMode:u.layoutConfig.layoutMode,userContextId:u.userContextId,windowId:u.id},[w]=eS({context:i,isUserContextSwitch:!1,logger:l,newActiveEntities:C,windowContentState:b,skipMoveToTop:!0,forcePush:!0});return u.windowHistory=w,Kf(u,l,void 0,s),aS(i,d,u,l)})(t,n),removeFromWindowHistory:(e,t,n)=>Dk(t,n),updateEntity(e,{entity:t,entityOptions:n,viewEntityName:i,windowId:a},o){const{cache:r,loggerFactory:s,activeWindowsService:l}=o,c=a||h.ew,d=s.newLogger("updateEntity-mutation","data-client-entity-command"),u=iS(r,d,l),m=uS(u,c);if(!m)return d.warn("Trying to update entity in window that does not exist"),!1;if(m.userContextId&&o.authenticationUser&&m.userContextId!==vf(o.authenticationUser))return d.warn("Trying to update entity in for a different user context than currently present on the window"),!1;const p=pf(t,n);return d.log(`Updating entity with input: ${Nf(p)}`),function({entity:e,window:t,viewEntityName:n,context:i,logger:a}){const{coreSettings:o}=i,r=rf(lf(t.activeEntities,t.windowHistory[t.windowHistory.length-1]?.activeEntities||null,!0));if(t.activeEntities[n]={...t.activeEntities[n],...e},r){t.windowHistory.pop(),Kf(t,a,void 0,o);const e={activeEntities:t.activeEntities,windowHistory:t.windowHistory,currentWindowHistoryIndex:t.currentWindowHistoryIndex,layoutMode:t.layoutConfig.layoutMode,userContextId:t.userContextId,windowId:t.id},[n]=eS({context:i,isUserContextSwitch:!1,logger:a,newActiveEntities:t.activeEntities,windowContentState:e});t.windowHistory=n,Kf(t,a,void 0,o)}}({window:m,entity:p,viewEntityName:i,context:o,logger:d}),aS(o,u,m,d)},updateEntityState(e,{entity:t,entityState:n},i){const{authenticationUser:a,cache:o,coreSettings:r,loggerFactory:s,activeWindowsService:l}=i,{enableMTMACommanding:c}=r.get(b.J.Core),d=s.newLogger("updateEntityState-mutation","data-client-entity-command"),u=iS(o,d,l),m=Ak(t,u,d,c?vf(a):null,r);if(!m)return d.warn("Trying to update flushable entity that does not exist"),!1;return function(e,t,n,i){const{mainEntity:a,endEntity:o}=e.activeEntities,{flushableByLinkedEntity:r,linkedEntityUpdate:s}=n;Yv(a,t)?(null!=r&&(a.entityState.flushableByLinkedEntity=r),Ik(a,s)):o&&Yv(o,t)?(i.log("Updating entity state for end entity"),Ik(o,s)):i.warn(`Updating entity state for entity the does not exist ${t}`)}(m,pf(t),n,d),aS(i,u,m,d),!0},async updateExtendedEntityContainerState(t,n,i){const{cache:a,loggerFactory:o,windowId:r,windowProvider:s,activeWindowsService:l}=i,c=o.newLogger("updateExtendedEntityContainerState-mutation","data-client-entity-command"),d=iS(a,c,l),u=uS(d,r);if(u)if(((e,t)=>e===ke.oq.Confirmed&&t.blockingEntityExtension?.entity&&Yv(t.activeEntities.entityExtension,t.blockingEntityExtension.entity))(n.containerState,u))u.id===h.ew&&s.opener.postMessage(w.W.MainWindowBlockedState,{isBlocked:"Confirmed",entity:null}),Fk(u,n,i,c,d,e);else{if(n.containerState!==ke.oq.Closed)return u.extendedEntityContainerState={...u.extendedEntityContainerState,...n},aS(i,d,u,c);Ok(u,c,i,e)}return!1},executeEntityCommand:(t,n,i)=>Lk(n,i,e),addBlockingExtension:(t,{entity:n,entityOptions:i,windowId:a,removeBlock:o},{cache:r,loggerFactory:s,windowProvider:l,activeWindowsService:c,coreSettings:d,...u})=>{const m=s.newLogger("addBlockingExtension-mutation","data-client-entity-command");m.log(`${o?"Removing":"Adding"} an entity extension blocker of type ${n.type}`);const p=iS(r,m,c),g=uS(p,a);if(g){const t={...n,id:n.id||null,linkedEntity:null,options:i||null,windowOptions:null,__typename:"Entity",entityState:{flushableByLinkedEntity:!1,__typename:"EntityState"}};if(o&&g.blockingEntityExtension)return((e,t,n,i,a,o)=>{const{windowProvider:r}=o;if(!t.blockingEntityExtension||!Yv(t.blockingEntityExtension.entity,e))return!1;const s={...t,blockingEntityExtension:null},l=aS(o,n,s,i);return s.id===h.ew&&r.opener.postMessage(w.W.MainWindowBlockedState,{isBlocked:"Unblocked",entity:null}),Ok(t,i,o,a),l})(t,g,p,m,e,{cache:r,loggerFactory:s,windowProvider:l,activeWindowsService:c,coreSettings:d,...u});if(!o)return((e,t,n,i,a)=>{const{windowProvider:o}=a,r={entity:e,__typename:"BlockingEntityExtension",blockedEntity:null,blockedCommand:null,blockedEntityOptions:null},s={...t,blockingEntityExtension:r};if(s.id===h.ew)try{o.opener.postMessage(w.W.MainWindowBlockedState,{isBlocked:"Blocked",entity:r.entity,entityOptions:e.options&&JSON.parse(e.options)})}catch(e){i.errorToTelemetry?.("Unable to parse and post addBlockingExtension to main window",uk)}return aS(a,n,s,i)})(t,g,p,m,{cache:r,windowProvider:l,loggerFactory:s,activeWindowsService:c,coreSettings:d,...u})}return!1},setWindowFullscreen:(e,{isFullscreen:t,windowId:n},i)=>{const{cache:a,loggerFactory:o,activeWindowsService:r}=i,s=o.newLogger("setWindowFullscreen-mutation","data-client-entity-command"),l=iS(a,s,r),c=uS(l,n);if(!c)return null;let d=!1;return c.layoutConfig.isFullscreen!==t&&(c.layoutConfig.isFullscreen=t,d=aS(i,l,c,s)),d&&nf(c)?c:null},removeUserActiveWindows:(e,{userContextId:t},n)=>{const{cache:i,loggerFactory:a,activeWindowsService:o}=n,r=a.newLogger("removeUserActiveWindowsMutation-mutation","data-client-entity-command"),s=((e,t)=>e.filter((e=>e.isMainWindow||e.userContextId!==t)))(iS(i,r,o),t);return aS(n,s,void 0,r)},saveReactiveVarsToHistory(e,{windowId:t,appIds:n},i){const{cache:a,loggerFactory:o,activeWindowsService:r}=i,s=o.newLogger("saveReactiveVarsToHistory-mutation","data-client-entity-command"),l=t||h.ew,c=iS(a,s,r),d=uS(c,l);if(!d)return s.warn("Trying to save reactive var history for window that does not exist"),!1;if(0===d.windowHistory.length)return!1;const u={activeEntities:d.activeEntities,windowHistory:d.windowHistory,currentWindowHistoryIndex:d.currentWindowHistoryIndex,layoutMode:d.layoutConfig.layoutMode,userContextId:d.userContextId||null,windowId:d.id},[m,p]=eS({appIdsForReactiveVarChange:n,context:i,isUserContextSwitch:!1,logger:s,newActiveEntities:d.activeEntities,windowContentState:u});if(!p)return s.log("Did not update history"),!1;const g={...d,windowHistory:m};return Kf(g,s,void 0,i.coreSettings),aS(i,c,g,s),!0}}}),Uk=(e,t)=>{if(e){const n=Pf(e);return t.getApp({entityType:n.type})}};var Bk=n(974286),Wk=n(979963),Hk=n(244740),Vk=n(414784),Gk=n(342689);const zk={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientVirtualEventsVirtualEventActionQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"virtualEventAction"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},qk={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientVirtualEventsVirtualEventSchedulingFormDataQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"virtualEventSchedulingFormData"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasUnsavedChanges"}}]}}]}}]},Jk={Query:{virtualEventAction(e,t,{cache:n,loggerFactory:i}){try{return n.readQuery({query:zk})?.virtualEventAction??null}catch{const e=i.newLogger("virtual-event-action","data-client-virtual-events");return e.errorToTelemetry?.("virtualEventAction: Failed to fetch virtual event action from cache.","virtual_event_form_action"),null}},virtualEventSchedulingFormData(e,t,{cache:n,loggerFactory:i}){try{return n.readQuery({query:qk})?.virtualEventSchedulingFormData??null}catch{const e=i.newLogger("virtual-event-scheduling-form-data","data-client-virtual-events");return e.errorToTelemetry?.("virtualEventSchedulingFormData: Failed to fetch virtual event scheduling form data from cache.","virtual_event_scheduling_form_data"),null}}},Mutation:{setVirtualEventAction(e,{input:{type:t}},{cache:n,loggerFactory:i}){const a=i.newLogger("set-virtual-event-action","data-client-virtual-events");try{n.writeQuery({query:zk,data:{virtualEventAction:t}})}catch{return a.errorToTelemetry?.("setVirtualEventStateAction: Failed to update virtual event action task in cache.","virtual_event_form_action"),null}return t},updateVirtualEventSchedulingFormData(e,{virtualEventSchedulingFormDataInput:t},{cache:n,loggerFactory:i}){const a=i.newLogger("update-virtual-event-scheduling-form-data","data-client-virtual-events"),o={virtualEventSchedulingFormData:{__typename:"VirtualEventSchedulingFormData",hasUnsavedChanges:t.hasUnsavedChanges??!1}};try{n.writeQuery({query:qk,data:o})}catch{return a.errorToTelemetry?.("updateVirtualEventSchedulingFormData: Failed to update virtual event scheduling form data in cache.","virtual_event_scheduling_form_data"),null}return o.virtualEventSchedulingFormData}}};var Qk=n(57281),Kk=n(287068);const Yk={Mutation:{updateArchiveTeamInfo:(e,{info:t},{cache:n})=>{if(!t)throw new Error("No archiveTeamInfo received");try{const{archiveSharepointSite:e}=t,i={archiveTeamResult:{__typename:"ArchiveTeamResult",archiveSharepointSite:!!e}};return n.writeQuery({query:Kk.r,data:i}),!0}catch{return!1}}}};var Xk=n(14866);class Zk{constructor(){}static create(e){if(Zk._clientResolvers)throw new Error("ClientResolvers are already created");return Zk._clientResolvers=function(e){return(0,W.merge)((0,Bk.w)(),Wv.w,Gy,By,(0,Bv.wf)(),function(){let e;const t=t=>i=>async(a,o,r)=>{if(!e){const{broadcastClientResolvers:t}=await Promise.all([n.e(996875),n.e(181360),n.e(682273),n.e(791789)]).then(n.bind(n,919312));e=t()}return e[t][i](a,o,r)};return{Query:{broadcastLayout:t("Query")("broadcastLayout"),attendeeCaptionsVisibility:t("Query")("attendeeCaptionsVisibility")},Mutation:{setBroadcastActiveSectionSource:t("Mutation")("setBroadcastActiveSectionSource"),updateBroadcastLayout:t("Mutation")("updateBroadcastLayout"),selectBroadcastSection:t("Mutation")("selectBroadcastSection"),clearBroadcastSource:t("Mutation")("clearBroadcastSource"),createDebugBroadcast:t("Mutation")("createDebugBroadcast"),updateAttendeeCaptionsVisibility:t("Mutation")("updateAttendeeCaptionsVisibility")}}}(),function(e){let t;const i=i=>a=>async(o,r,s)=>{if(!t){const{clientResolvers:i}=await Promise.all([n.e(996875),n.e(181360),n.e(682273),n.e(791789)]).then(n.bind(n,919312));t=i(e)}return t[i][a](o,r,s)};return{CallingIntent:{isFake:i("CallingIntent")("isFake")},CallLogParticipant:{hasDisplayName:i("CallLogParticipant")("hasDisplayName"),displayName:i("CallLogParticipant")("displayName")},Query:{whiteboardSharingSession:i("Query")("whiteboardSharingSession"),pptSharingSession:i("Query")("pptSharingSession"),bulkMoveStatus:i("Query")("bulkMoveStatus"),anonymousDisplayName:i("Query")("anonymousDisplayName"),prejoinState:i("Query")("prejoinState"),byodState:i("Query")("byodState"),callingScreenStatus:i("Query")("callingScreenStatus"),callingScreenLayout:i("Query")("callingScreenLayout"),poppedOutWindowState:i("Query")("poppedOutWindowState"),pinnedParticipantIds:i("Query")("pinnedParticipantIds"),videoScanType:i("Query")("videoScanType"),captionFontSize:i("Query")("captionFontSize"),debugVideoEffectState:i("Query")("debugVideoEffectState"),selectedBackgroundsInfo:i("Query")("selectedBackgroundsInfo"),getHardwareOutDevices:i("Query")("getHardwareOutDevices"),avatarInfo:i("Query")("avatarInfo"),selectedAvatarInfo:i("Query")("selectedAvatarInfo"),activeVideoEffects:i("Query")("activeVideoEffects"),videoEffectsCurrentInfo:i("Query")("videoEffectsCurrentInfo"),currentCallingState:i("Query")("currentCallingState"),compositorRegions:i("Query")("compositorRegions"),avatarAppAvailabilityInfo:i("Query")("avatarAppAvailabilityInfo"),myselfSettings:i("Query")("myselfSettings"),immersiveViewModeAppAvailabilityInfo:i("Query")("immersiveViewModeAppAvailabilityInfo"),debugClosedCaptionsEvent:i("Query")("debugClosedCaptionsEvent"),isCallingScreenReady:i("Query")("isCallingScreenReady"),isUbarRenderComplete:i("Query")("isUbarRenderComplete"),audioVideoFrameworkInfo:i("Query")("audioVideoFrameworkInfo")},Mutation:{acceptStreamPermissionsDebug:i("Mutation")("acceptStreamPermissionsDebug"),sendToDebugHardwareOutDevice:i("Mutation")("sendToDebugHardwareOutDevice"),stopDebugHardwareOutDevice:i("Mutation")("stopDebugHardwareOutDevice"),setDebugSpeakerVolume:i("Mutation")("setDebugSpeakerVolume"),setDebugToolVisible:i("Mutation")("setDebugToolVisible"),updateMeetingRoomLayoutToggleState:i("Mutation")("updateMeetingRoomLayoutToggleState"),updateShouldLaunchWhiteboardOnLoad:i("Mutation")("updateShouldLaunchWhiteboardOnLoad"),setDebugToolHiddenParticipantsCount:i("Mutation")("setDebugToolHiddenParticipantsCount"),setBulkMoveStatus:i("Mutation")("setBulkMoveStatus"),createDebugBreakoutRooms:i("Mutation")("createDebugBreakoutRooms"),createDebugCall:i("Mutation")("createDebugCall"),addDebugSuggestedUser:i("Mutation")("addDebugSuggestedUser"),joinDebugCallFromIntent:i("Mutation")("joinDebugCallFromIntent"),createDebugCallingIntent:i("Mutation")("createDebugCallingIntent"),createDebugConversation:i("Mutation")("createDebugConversation"),updateDebugCall:i("Mutation")("updateDebugCall"),stopDebugCall:i("Mutation")("stopDebugCall"),stopSpotlightSelfDebugCall:i("Mutation")("stopSpotlightSelfDebugCall"),updateDebugMeetingRoomRemoteSelectedLayoutChanged:i("Mutation")("updateDebugMeetingRoomRemoteSelectedLayoutChanged"),updateDebugSwapScreensButtonState:i("Mutation")("updateDebugSwapScreensButtonState"),toggleHoldDebugCall:i("Mutation")("toggleHoldDebugCall"),addDebugParticipant:i("Mutation")("addDebugParticipant"),createDebugParticipants:i("Mutation")("createDebugParticipants"),toggleDebugLocalMute:i("Mutation")("toggleDebugLocalMute"),startDebugRecording:i("Mutation")("startDebugRecording"),stopDebugRecording:i("Mutation")("stopDebugRecording"),setCallTranscriptStateDebug:i("Mutation")("setCallTranscriptStateDebug"),sendCallTranscriptEntryEventDebug:i("Mutation")("sendCallTranscriptEntryEventDebug"),sendClosedCaptionsEntryEventDebug:i("Mutation")("sendClosedCaptionsEntryEventDebug"),sendClosedCaptionsStatusEventDebug:i("Mutation")("sendClosedCaptionsStatusEventDebug"),setDebugClosedCaptionsEvent:i("Mutation")("setDebugClosedCaptionsEvent"),removeDebugParticipant:i("Mutation")("removeDebugParticipant"),toggleDebugVideo:i("Mutation")("toggleDebugVideo"),toggleDebugScreenShare:i("Mutation")("toggleDebugScreenShare"),updateDebugParticipant:i("Mutation")("updateDebugParticipant"),updateDebugPinParticipantFromOutside:i("Mutation")("updateDebugPinParticipantFromOutside"),updateDebugCortanaToggleButton:i("Mutation")("updateDebugCortanaToggleButton"),updateDebugContentCameraSharing:i("Mutation")("updateDebugContentCameraSharing"),toggleDebugMuteSpeaker:i("Mutation")("toggleDebugMuteSpeaker"),updateDebugContentCameraState:i("Mutation")("updateDebugContentCameraState"),triggerDebugCallingScreenGalleryTypeChange:i("Mutation")("triggerDebugCallingScreenGalleryTypeChange"),toggleVoiceLevel:i("Mutation")("toggleVoiceLevel"),setDebugDevicesList:i("Mutation")("setDebugDevicesList"),setDebugCallingQualityFeedback:i("Mutation")("setDebugCallingQualityFeedback"),setAnonymousDisplayName:i("Mutation")("setAnonymousDisplayName"),setPrejoinState:i("Mutation")("setPrejoinState"),triggerSubscribedCallChangedDebugEvent:i("Mutation")("triggerSubscribedCallChangedDebugEvent"),updateMeetingBrandingInfoCache:i("Mutation")("updateMeetingBrandingInfoCache"),setAcceptStreamPermissionsDebugResponse:i("Mutation")("setAcceptStreamPermissionsDebugResponse"),setStreamPermissionsDebugAcknowledged:i("Mutation")("setStreamPermissionsDebugAcknowledged"),setStreamPermissionsDebugAcknowledgedRequired:i("Mutation")("setStreamPermissionsDebugAcknowledgedRequired"),setByodState:i("Mutation")("setByodState"),setCallingScreenStatus:i("Mutation")("setCallingScreenStatus"),setCallingScreenLayout:i("Mutation")("setCallingScreenLayout"),setIsCallingScreenReady:i("Mutation")("setIsCallingScreenReady"),setPoppedOutWindowState:i("Mutation")("setPoppedOutWindowState"),setUbarRenderComplete:i("Mutation")("setUbarRenderComplete"),setPinnedParticipantIds:i("Mutation")("setPinnedParticipantIds"),updateMyselfSettings:i("Mutation")("updateMyselfSettings"),setVideoScanType:i("Mutation")("setVideoScanType"),updateCaptionFontSize:i("Mutation")("updateCaptionFontSize"),setDebugDeviceBlurringCapability:i("Mutation")("setDebugDeviceBlurringCapability"),setDebugVideoBackgroundImages:i("Mutation")("setDebugVideoBackgroundImages"),triggerBluetoothStateChangedDebugEvent:i("Mutation")("triggerBluetoothStateChangedDebugEvent"),triggerRaiseHandStateChangedEvent:i("Mutation")("triggerRaiseHandStateChangedEvent"),toggleDebugVideoEffect:i("Mutation")("toggleDebugVideoEffect"),updateMeetingLockDebug:i("Mutation")("updateMeetingLockDebug"),updateSelectedBackgroundsInfo:i("Mutation")("updateSelectedBackgroundsInfo"),setShouldReloadVideoApp:i("Mutation")("setShouldReloadVideoApp"),setShouldShowVideoApp:i("Mutation")("setShouldShowVideoApp"),setShouldShowVideoEffectsPreview:i("Mutation")("setShouldShowVideoEffectsPreview"),setShouldKeepPreviewWindowInSidePanelOpen:i("Mutation")("setShouldKeepPreviewWindowInSidePanelOpen"),setVideoAppPostMessageEvent:i("Mutation")("setVideoAppPostMessageEvent"),setAvatarAppPostMessageEvent:i("Mutation")("setAvatarAppPostMessageEvent"),setVideoNotification:i("Mutation")("setVideoNotification"),setAvatarErrorNotification:i("Mutation")("setAvatarErrorNotification"),setAvatarQuickPickerErrorNotification:i("Mutation")("setAvatarQuickPickerErrorNotification"),setShouldSetAvatarRendererTimeout:i("Mutation")("setShouldSetAvatarRendererTimeout"),setIsTurningOnVideoFromPreview:i("Mutation")("setIsTurningOnVideoFromPreview"),setShouldRefreshVideoFilters:i("Mutation")("setShouldRefreshVideoFilters"),toggleParticipantPin:i("Mutation")("toggleParticipantPin"),setScaling:i("Mutation")("setScaling"),scalingModeUpdated:i("Mutation")("scalingModeUpdated"),updateAvatarInfo:i("Mutation")("updateAvatarInfo"),updateSelectedAvatarInfo:i("Mutation")("updateSelectedAvatarInfo"),setLastSelectedCameraId:i("Mutation")("setLastSelectedCameraId"),setIsAvatarAppLoaded:i("Mutation")("setIsAvatarAppLoaded"),updateActiveVideoEffects:i("Mutation")("updateActiveVideoEffects"),updateVideoEffectsCurrentInfo:i("Mutation")("updateVideoEffectsCurrentInfo"),meetingDebugGoLive:i("Mutation")("meetingDebugGoLive"),setDebugStageRoomOutcome:i("Mutation")("setDebugStageRoomOutcome"),setShouldShowPopupPreview:i("Mutation")("setShouldShowPopupPreview"),setShouldAvatarMenuItemSelected:i("Mutation")("setShouldAvatarMenuItemSelected"),updateCallingState:i("Mutation")("updateCallingState"),setCompositorRegion:i("Mutation")("setCompositorRegion"),removeCompositorRegion:i("Mutation")("removeCompositorRegion"),setAvatarAppAvailabilityInfo:i("Mutation")("setAvatarAppAvailabilityInfo"),setIsAvatarMRULoaded:i("Mutation")("setIsAvatarMRULoaded"),setMeetingCollab:i("Mutation")("setMeetingCollab"),setMeetingCollabData:i("Mutation")("setMeetingCollabData"),toggleMeetingCollab:i("Mutation")("toggleMeetingCollab"),stopSharingTriggeredOnStage:i("Mutation")("stopSharingTriggeredOnStage"),setImmersiveViewModeAppAvailabilityInfo:i("Mutation")("setImmersiveViewModeAppAvailabilityInfo"),updateAudioVideoFrameworkInfo:i("Mutation")("updateAudioVideoFrameworkInfo")}}}(e),Wk.s,vS,$k(e),rk,Ih,Hv.D,Vv.w,Uv,Jy,Gv.s,Hk.s,Gk.s,Jk,Vk.w,Qk.s,Yk,Xk.w)}(e),Zk._clientResolvers}static get clientResolvers(){return Zk._clientResolvers}}Zk._clientResolvers=null;class eC extends uh{constructor(e,t,n,i,a){super(e,t,n({windowId:i.windowId,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:`mtma-window-${i?.authenticationUser?.id||"nouser"}-${i.windowId}`,storeType:a}),i,i.windowId,a)}get relayEnvironment(){return this.parent.relayEnvironment}get parentQueries(){return Fg}get parentSubscriptions(){return xg}get parentMutations(){return Pg}get className(){return"MTMAWindowDataClient"}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}clone(e){throw new Error("Trying to clone child instance")}}class tC extends ch{constructor(e,t,n,i,a){super(e,n,t({windowId:n.windowId||h.ew,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"mtma-core",storeType:Jg.t.mtmaCore}),n.windowId||h.ew,Jg.t.mtmaCore,a),this.createApolloClient=t,this.viewSchemaClient=null,i&&(this.viewSchemaClient=i({windowId:n.windowId||h.ew,entityType:n.entityType,viewportContext:n.windowProvider.viewportContext,name:"mtma-core-viewSchema",storeType:Jg.t.viewSchema}),this.registerClient(this.viewSchemaClient))}clone(e){return e.windowId===h.ew?new ph(this.getServices(),this.client,{...this.ctx,...e},this.storeType,this):new eC(this.getServices(),this,this.createApolloClient,{...this.ctx,...e},Jg.t.mtmaWindow)}cloneForViewSchema(e){return yh()(this.viewSchemaClient,"View schema must be avaliable"),new gh(this.getServices(),this.viewSchemaClient,{...this.ctx,...e},Jg.t.viewSchema)}async disposeClients(e){await Promise.all([super.disposeClients(e),(async()=>{this.viewSchemaClient&&(await this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})()])}}class nC extends uh{constructor(e,t,n,i,a,o){const r=`${i.authenticationUser?.id||"nouser"}-${i.windowId}`;super(e,t,n({windowId:i.windowId||h.ew,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:`mtma-user-${r}`,storeType:Jg.t.mtmaUser}),i,i.windowId||h.ew,Jg.t.mtmaUser,o),this.createApolloClient=n,this.viewSchemaClient=null,a&&(this.viewSchemaClient=a({windowId:i.windowId||h.ew,entityType:i.entityType,viewportContext:i.windowProvider.viewportContext,name:`mtma-user-viewSchema-${r}`,storeType:Jg.t.viewSchema}),this.registerClient(this.viewSchemaClient))}get parentQueries(){return _g}get parentSubscriptions(){return Mg}get parentMutations(){return Dg}get className(){return"MTMAUserDataClient"}__UNSAFE_getApolloClientReferencesForDebugPanel(){return{self:this.client,parent:this.parent.__UNSAFE_getApolloClientReferencesForDebugPanel().self,selfIsMainClient:!1}}clone(e){return new eC(this.getServices(),this,this.createApolloClient,{...this.ctx,...e},Jg.t.mtmaWindow)}cloneForViewSchema(e){return yh()(this.viewSchemaClient,"View schema must be available"),new gh(this.getServices(),this.viewSchemaClient,{...this.ctx,...e},Jg.t.viewSchema)}async disposeClients(e){await Promise.all([super.disposeClients(e),(async()=>{this.viewSchemaClient&&(await this.disposeClient(this.viewSchemaClient,e),e&&(this.viewSchemaClient=null))})()])}}class iC{constructor(){this._cache=new Map,this.getOrCreateServiceInstance=(e,t)=>{let n;return this._cache.has(e)?n=this._cache.get(e):(n=t(),this._cache.set(e,n)),n},this.clear=()=>{this._cache.clear()}}}const aC=new iC,oC=aC.getOrCreateServiceInstance;var rC,sC;!function(e){e.AddressService="AddressService",e.AiInsightsFeedbackService="AiInsightsFeedbackService",e.AiInsightsSdsService="AiInsightsSdsService",e.AppBasedLinkService="AppBasedLinkService",e.AppsPlatformService="AppsPlatformService",e.AppsStoreService="AppsStoreService",e.AppSuggestionsService="AppSuggestionsService",e.AsyncMediaService="AsyncMediaService",e.AtpSafelinksService="AtpSafelinksService",e.AugloopService="AugloopService",e.SubstrateBotPlatformService="SubstrateBotPlatformService",e.ComposeAugloopService="ComposeAugloopService",e.AzureMapsService="AzureMapsService",e.BadgeCountService="BadgeCountService",e.BiometricEnrollmentService="BiometricEnrollmentService",e.BiometricFaceEnrollmentService="BiometricFaceEnrollmentService",e.BotsPlatformService="BotsPlatformService",e.BrbService="BrbService",e.BreakoutRoomMiddleTierService="BreakoutRoomMiddleTierService",e.BroadcastAttendeeService="BroadcastAttendeeService",e.BroadcastCaptionsService="BroadcastCaptionsService",e.BroadcastSignalRService="BroadcastSignalRService",e.BroadcastStreamingAttendeeService="BroadcastStreamingAttendeeService",e.CalendarService="CalendarService",e.CallBlockingService="CallBlockingService",e.CallingAnonymousDisplayNameService="CallingAnonymousDisplayNameService",e.CallingAppEventsService="CallingAppEventsService",e.CallingBannerServiceAdapter="CallingBannerServiceAdapter",e.CallingDialogServiceAdapter="CallingDialogServiceAdapter",e.CallingNotificationServiceAdapter="CallingNotificationServiceAdapter",e.CallingService="CallingService",e.CallingConversationService="CallingConversationService",e.CallRecordingService="CallRecordingService",e.ChatService="ChatService",e.ChatServiceEndpointProvider="ChatServiceEndpointProvider",e.CloudStorageFoldersService="CloudStorageFoldersService",e.CmdMeetingIntelligenceService="CmdMeetingIntelligenceService",e.CollabCloudService="CollabCloudService",e.CollabObjectService="CollabObjectService",e.CommonSubstrateService="CommonSubstrateService",e.CommunitySettingsService="CommunitySettingsService",e.ConnectedAccountsService="ConnectedAccountsService",e.ConnectedCalendarSettingsService="ConnectedCalendarSettingsService",e.ConsumerGroupsService="ConsumerGroupsService",e.CSAService="CSAService",e.DeveloperSwitchersService="DeveloperSwitchersService",e.DiscoverSurfaceFeedbackService="DiscoverSurfaceFeedbackService",e.DiscoverSurfaceService="DiscoverSurfaceService",e.DistributionListService="DistributionListService",e.DriveItemShareService="DriveItemShareService",e.DynamicsMarketingService="DynamicsMarketingService",e.DynamicsVirtualEventsService="DynamicsVirtualEventsService",e.EmoticonService="EmoticonService",e.EspService="EspService",e.ExampleService="ExampleService",e.ExternalAccountsResponseService="ExternalAccountsResponseService",e.ExternalAccountsService="ExternalAccountsService",e.ExternalCalendarEmailAddressService="ExternalCalendarEmailAddressService",e.FileDownloadManagerService="FileDownloadManagerService",e.FilesBackfillThreadPropertiesService="FilesBackfillThreadPropertiesService",e.FilesRedeemService="FilesRedeemService",e.FilesReferenceService="FilesReferenceService",e.FilesSharepointUrlService="FilesSharepointUrlService",e.FilesValidDomainsService="FilesValidDomainsService",e.FilesSiteResourceInfoService="FilesSiteResourceInfoService",e.FileUploadPreviewService="FileUploadPreviewService",e.FileUploadService="FileUploadService",e.FloodgateService="FloodgateService",e.FluidService="FluidService",e.GalleryService="GalleryService",e.GiphyService="GiphyService",e.GoogleCalendarAuthenticationService="GoogleCalendarAuthenticationService",e.GoogleContactsAuthenticationService="GoogleContactsAuthenticationService",e.GuardiansService="GuardiansService",e.HealthScenarioService="HealthScenarioService",e.ImageProxyService="ImageProxyService",e.ImmersiveReaderService="ImmersiveReaderService",e.ImpersonationDetectionService="ImpersonationDetectionService",e.ImplicitContactsService="ImplicitContactsService",e.ImportMsaContactsService="ImportMsaContactsService",e.InstantAnswersService="InstantAnswersService",e.InviteLinksService="InviteLinksService",e.ItemDeleteService="ItemDeleteService",e.ItemDetailsService="ItemDetailsService",e.ItemUploadService="ItemUploadService",e.LiveStateBroadcastService="LiveStateBroadcastService",e.LiveStreamRenderingService="LiveStreamRenderingService",e.LmsIntegrationService="LmsIntegrationService",e.LockedTeamsService="LockedTeamsService",e.LogsFilesService="LogsFilesService",e.LokiMetaPreviewService="LokiMetaPreviewService",e.LokiService="LokiService",e.ManageTenantService="ManageTenantService",e.MeetingArtifactsService="MeetingArtifactsService",e.MeetingBotService="MeetingBotService",e.MeetingIntelligenceService="MeetingIntelligenceService",e.MeetingOptionsClientDataService="MeetingOptionsClientDataService",e.MeetingOptionsService="MeetingOptionsService",e.MeetingQuestionsAndAnswersService="MeetingQuestionsAndAnswersService",e.MeetingRecapService="MeetingRecapService",e.MeetingRecapWorkingSetFilesService="MeetingRecapWorkingSetFilesService",e.MeetingRecapSwaService="MeetingRecapSwaService",e.MeetingRoomAppEventsService="MeetingRoomAppEventsService",e.MeetingTemplateService="MeetingTemplateService",e.MonetizationService="MonetizationService",e.MRUItemService="MRUItemService",e.MsaAuthenticationService="MsaAuthenticationService",e.MyUserPreferencesStore="MyUserPreferencesStore",e.OdcFilePreviewService="OdcFilePreviewService",e.OdsService="OdcService",e.OrganizationInfoService="OrganizationInfoService",e.OSearchService="OSearchService",e.PaymentsService="PaymentsService",e.PeoplePickerService="PeoplePickerService",e.PeopleSearchService="PeopleSearchService",e.PeopleService="PeopleService",e.PeopleTargetingService="PeopleTargetingService",e.PersonalFileDetailsService="PersonalFileDetailsService",e.PetrolService="PetrolService",e.PoliciesService="PoliciesService",e.PresenceService="PresenceService",e.ODSLProcessingEngine="ODSLProcessingEngine",e.PstnService="PstnService",e.RefreshSiteUrlService="RefreshSiteUrlService",e.ReportConcernService="ReportConcernService",e.SCISService="SCISService",e.SearchPrefetchService="SearchPrefetchService",e.SensitivityLabelPolicySettingsService="SensitivityLabelPolicySettingsService",e.SharepointRestClient="SharepointRestClient",e.SharepointShareService="SharepointShareService",e.ShareService="ShareService",e.SignalsService="SignalsService",e.SmbUserIntentService="SmbUserIntentService",e.StatefulLongPoll="StatefulLongPoll",e.StoreDevicesService="StoreDevicesService",e.StoreService="StoreService",e.StyleMyRoomService="StyleMyRoomService",e.SubstrateFilesSearchService="SubstrateFilesSearchService",e.SubstrateMeetingRecommendationsService="SubstrateMeetingRecommendationsService",e.SubstrateMeetingSearchService="SubstrateMeetingSearchService",e.SubstrateMeetingSummarySearchService="SubstrateMeetingSummarySearchService",e.SubstrateRecommendationsService="SubstrateRecommendationsService",e.SubstrateSearchService="SubstrateSearchService",e.SubstrateSuggestionsService="SubstrateSuggestionsService",e.TargetingHierarchyService="TargetingHierarchyService",e.TeamCalendarService="TeamCalendarService",e.TeamsCopilotService="TeamsCopilotService",e.TeamsAndChannelsService="TeamsAndChannelsService",e.TenantAnalyticsService="TenantAnalyticsService",e.TenantMembershipService="TenantMembershipService",e.TenantPrivacyProfileService="TenantPrivacyProfileService",e.TenantService="TenantService",e.TFLUserService="TFLUserService",e.ThirdPartyCalendarService="ThirdPartyCalendarService",e.ToastImageService="ToastImageService",e.TpnNoticeService="TpnNoticeService",e.TranscriptFeedbackService="TranscriptFeedbackService",e.TranscriptService="TranscriptService",e.TranscriptSettingsStoreService="TranscriptSettingsStoreService",e.TranslateService="TranslateService",e.UnifiedConsentService="UnifiedConsentService",e.UrlPreviewService="UrlPreviewService",e.UserLicenseService="UserLicenseService",e.UserProfileService="UserProfileService",e.VideoMessageCameraCommandService="VideoMessageCameraCommandService",e.VideoFileService="VideoFileService",e.VideoMessageUploadService="VideoMessageUploadService",e.VirtualEventsService="VirtualEventsService",e.MeetingSchedulingService="MeetingSchedulingService",e.VoicemailService="VoicemailService",e.WebinarService="WebinarService",e.WaffleService="WaffleService"}(rC||(rC={})),function(e){e.ExampleGlobalService="ExampleGlobalService",e.GlobalCallingService="GlobalCallingService",e.GlobalTaskbarService="GlobalTaskbarService",e.MTMAUserDataService="MTMAUserDataService",e.WebAppSwitcherService="WebAppSwitcherService"}(sC||(sC={}));const lC=(e,t)=>n=>(0,ac.mT)(e,t,n),cC=()=>Promise.all([n.e(309799),n.e(791141),n.e(267641),n.e(652421),n.e(502265),n.e(29311),n.e(8653),n.e(785149),n.e(518733),n.e(552066),n.e(816702)]).then(n.bind(n,572600)),dC=lC((()=>n.e(585108).then(n.bind(n,160337))),"services-app-based-link"),uC=lC((()=>n.e(805203).then(n.bind(n,423655))),"services-apps-platform"),mC=lC((()=>Promise.all([n.e(59490),n.e(364649),n.e(761944)]).then(n.bind(n,825880))),"services-store-apps"),pC=lC((()=>n.e(733885).then(n.bind(n,428730))),"services-app-suggestions"),gC=lC((()=>n.e(591494).then(n.bind(n,223511))),"services-atp-safelinks"),hC=lC((()=>n.e(771401).then(n.bind(n,581422))),"services-async-media"),yC=lC((()=>Promise.all([n.e(829175),n.e(524539),n.e(165441)]).then(n.bind(n,422998))),"services-augloop"),vC=lC((()=>n.e(23787).then(n.bind(n,174308))),"services-substrate-bot-platform"),fC=lC((()=>Promise.all([n.e(974307),n.e(579458),n.e(987927)]).then(n.bind(n,329386))),"services-azure-maps"),SC=lC((()=>Promise.all([n.e(594498),n.e(156255)]).then(n.bind(n,901177))),"services-biometric-enrollment"),kC=lC((()=>n.e(820672).then(n.bind(n,809301))),"services-bots-platform"),CC=lC((()=>n.e(340060).then(n.bind(n,93113))),"services-brb"),bC=lC((()=>n.e(911846).then(n.bind(n,785112))),"services-breakout-rooms"),wC=lC((()=>n.e(851710).then(n.bind(n,795173))),"services-transcript"),TC=lC((()=>n.e(819211).then(n.bind(n,717294))),"services-transcript-setting-store"),IC=lC((()=>n.e(851710).then(n.bind(n,795173))),"services-transcript-feedback"),NC=lC((()=>n.e(116205).then(n.bind(n,314382))),"services-ai-insights-feedback"),EC=lC((()=>n.e(116205).then(n.bind(n,314382))),"services-ai-insights-sds"),AC=lC((()=>n.e(512159).then(n.bind(n,268192))),"services-style-my-room"),_C=lC((()=>n.e(363685).then(n.bind(n,291997))),"services-broadcast-attendee"),FC=lC((()=>n.e(620188).then(n.bind(n,28089))),"services-broadcast-streaming-attendee"),DC=lC((()=>n.e(128560).then(n.bind(n,728987))),"services-broadcast-captions"),PC=lC((()=>Promise.all([n.e(785149),n.e(12549)]).then(n.bind(n,47416))),"services-broadcast-signalr"),MC=lC((()=>Promise.all([n.e(819119),n.e(298753),n.e(993376)]).then(n.bind(n,287227))),"services-io-calendar"),xC=lC((()=>n.e(634692).then(n.bind(n,844552))),"services-chat-endpoint-provider"),RC=lC((()=>n.e(477209).then(n.bind(n,375691))),"services-chat"),jC=lC((()=>n.e(477209).then(n.bind(n,375691))),"services-calling-conversation"),LC=lC((()=>n.e(976808).then(n.bind(n,102446))),"services-report-concern"),OC=(lC((()=>Promise.all([n.e(309799),n.e(791141),n.e(267641),n.e(652421),n.e(502265),n.e(29311),n.e(8653),n.e(785149),n.e(518733),n.e(552066),n.e(175925)]).then(n.bind(n,420337))),"services-calling"),lC((()=>n.e(293740).then(n.bind(n,127120))),"services-cmd-meeting-intelligence")),$C=lC((()=>n.e(656737).then(n.bind(n,884734))),"services-collab-object"),UC=lC((()=>n.e(458771).then(n.bind(n,19066))),"services-community-settings"),BC=lC((()=>n.e(32034).then(n.bind(n,965389))),"services-connected-accounts"),WC=lC((()=>n.e(900675).then(n.bind(n,27609))),"services-io-connected-calendar"),HC=lC((()=>Promise.all([n.e(617672),n.e(59490),n.e(960102),n.e(384977)]).then(n.bind(n,974901))),"services-store-devices"),VC=lC((()=>n.e(500923).then(n.bind(n,36562))),"services-distribution-list"),GC=lC((()=>n.e(805794).then(n.bind(n,925708))),"services-dynamics-marketing"),zC=lC((()=>n.e(106652).then(n.bind(n,497690))),"services-dynamics-virtual-events"),qC=lC((()=>n.e(178832).then(n.bind(n,572191))),"services-emoticon"),JC=lC((()=>n.e(421174).then(n.bind(n,441098))),"services-esp"),QC=lC((()=>n.e(469081).then(n.bind(n,459133))),"services-external-accounts"),KC=lC((()=>n.e(235430).then(n.bind(n,9168))),"services-external-accounts-response"),YC=lC((()=>n.e(579197).then(n.bind(n,40589))),"services-external-calendar-email-address"),XC=lC((()=>n.e(203137).then(n.bind(n,739089))),"services-files"),ZC=lC((()=>n.e(622121).then(n.bind(n,353225))),"services-file-upload"),eb=lC((()=>n.e(302653).then(n.bind(n,225333))),"services-file-download-manager"),tb=lC((()=>n.e(251425).then(n.bind(n,167706))),"services-fluid"),nb=lC((()=>n.e(273806).then(n.bind(n,948065))),"services-giphy"),ib=lC((()=>n.e(194248).then(n.bind(n,85578))),"services-gallery"),ab=lC((()=>n.e(183483).then(n.bind(n,59475))),"services-google-calendar-authentication"),ob=lC((()=>n.e(183483).then(n.bind(n,59475))),"services-google-contacts-authentication"),rb=lC((()=>n.e(787480).then(n.bind(n,201620))),"services-image-proxy"),sb=lC((()=>n.e(142705).then(n.bind(n,262415))),"immersive-reader-service"),lb=lC((()=>n.e(670972).then(n.bind(n,622847))),"services-import-msa-contacts"),cb=lC((()=>n.e(517965).then(n.bind(n,271300))),"services-instant-answers"),db=lC((()=>n.e(723088).then(n.bind(n,992550))),"services-invite-links"),ub=lC((()=>Promise.all([n.e(992276),n.e(735737),n.e(447557),n.e(96978)]).then(n.bind(n,534275))),"services-live-state-broadcast"),mb=lC((()=>Promise.all([n.e(502265),n.e(834117),n.e(696355),n.e(228739),n.e(814408)]).then(n.bind(n,735325))),"services-live-stream-renderer"),pb=lC((()=>n.e(322581).then(n.bind(n,484347))),"services-lms-integration"),gb=lC((()=>n.e(288475).then(n.bind(n,74648))),"services-tenant-analytics"),hb=lC((()=>n.e(989829).then(n.bind(n,444242))),"services-loki"),yb=lC((()=>n.e(926934).then(n.bind(n,980784))),"services-discover-surface"),vb=lC((()=>n.e(254964).then(n.bind(n,729882))),"services-discover-surface-feedback"),fb=lC((()=>n.e(103998).then(n.bind(n,125207))),"services-guardians"),Sb=lC((()=>n.e(443091).then(n.bind(n,112697))),"services-health"),kb=lC((()=>n.e(251074).then(n.bind(n,799381))),"services-locked-teams"),Cb=lC((()=>n.e(188975).then(n.bind(n,672964))),"services-logs-files"),bb=lC((()=>n.e(202066).then(n.bind(n,70472))),"services-manage-tenant"),wb=lC((()=>n.e(345626).then(n.bind(n,422062))),"services-meeting-artifacts"),Tb=lC((()=>n.e(694945).then(n.bind(n,103342))),"services-meeting-intelligence"),Ib=lC((()=>n.e(924251).then(n.bind(n,172638))),"services-meeting-recap"),Nb=lC((()=>Promise.all([n.e(373846),n.e(820516)]).then(n.bind(n,828222))),"services-meeting-options"),Eb=lC((()=>n.e(649880).then(n.bind(n,36298))),"services-meeting-recap-swa"),Ab=lC((()=>Promise.all([n.e(8653),n.e(237341),n.e(259164)]).then(n.bind(n,733008))),"services-meeting-recap-working-set-files"),_b=lC((()=>Promise.all([n.e(373846),n.e(88137)]).then(n.bind(n,177298))),"services-meeting-templates"),Fb=lC((()=>n.e(950104).then(n.bind(n,633536))),"services-msa-authentication"),Db=lC((()=>n.e(716151).then(n.bind(n,783086))),"services-people"),Pb=(lC((()=>n.e(37342).then(n.bind(n,34057))),"services-viva-insights"),lC((()=>n.e(716313).then(n.bind(n,386750))),"services-people-picker")),Mb=lC((()=>n.e(454165).then(n.bind(n,902410))),"services-people-targeting"),xb=lC((()=>n.e(350718).then(n.bind(n,759578))),"services-files-personal"),Rb=lC((()=>n.e(214988).then(n.bind(n,356165))),"services-example"),jb=lC((()=>n.e(342461).then(n.bind(n,253658))),"services-petrol"),Lb=lC((()=>Promise.all([n.e(10531),n.e(675724),n.e(794166)]).then(n.bind(n,387066))),"services-floodgate"),Ob=lC((()=>n.e(343607).then(n.bind(n,323179))),"services-ods"),$b=lC((()=>n.e(304609).then(n.bind(n,450246))),"services-policies"),Ub=lC((()=>n.e(676130).then(n.bind(n,524512))),"services-presence"),Bb=lC((()=>n.e(23363).then(n.bind(n,744991))),"scis-service"),Wb=lC((()=>Promise.all([n.e(341117),n.e(79506)]).then(n.bind(n,37919))),"services-search"),Hb=lC((()=>Promise.all([n.e(757988),n.e(172842)]).then(n.bind(n,987574))),"services-search-meeting-summary"),Vb=lC((()=>n.e(419161).then(n.bind(n,169968))),"search-substrate"),Gb=lC((()=>n.e(902078).then(n.bind(n,325800))),"services-substrate-meeting-recommendations"),zb=lC((()=>n.e(501129).then(n.bind(n,175093))),"services-substrate-recommendations"),qb=lC((()=>n.e(899164).then(n.bind(n,42162))),"services-sharepoint-client"),Jb=lC((()=>n.e(130288).then(n.bind(n,638117))),"services-sharepoint-share"),Qb=lC((()=>n.e(215793).then(n.bind(n,782874))),"services-share"),Kb=lC((()=>n.e(792876).then(n.bind(n,112015))),"services-signals"),Yb=lC((()=>n.e(463473).then(n.bind(n,654949))),"services-smb-user-intent"),Xb=lC((()=>Promise.all([n.e(617672),n.e(59490),n.e(364649),n.e(960102),n.e(659098)]).then(n.bind(n,566739))),"services-store"),Zb=lC((()=>n.e(538431).then(n.bind(n,129078))),"services-suggestions"),ew=lC((()=>n.e(734949).then(n.bind(n,942793))),"services-implicit-contacts"),tw=lC((()=>n.e(74801).then(n.bind(n,895622))),"services-targeting-hierarchy"),nw=lC((()=>n.e(362437).then(n.bind(n,121049))),"services-tenant-membership"),iw=lC((()=>n.e(172557).then(n.bind(n,975012))),"services-tenant-service"),aw=lC((()=>n.e(561673).then(n.bind(n,850265))),"services-teams-copilot"),ow=lC((()=>n.e(277412).then(n.bind(n,981660))),"services-third-party-calendar"),rw=lC((()=>n.e(254692).then(n.bind(n,592500))),"services-toast-image"),sw=(lC((()=>n.e(751309).then(n.bind(n,778031))),"services-teams-and-channels"),lC((()=>n.e(16014).then(n.bind(n,568014))),"services-translate")),lw=lC((()=>n.e(606408).then(n.bind(n,245778))),"services-tpn-notice"),cw=lC((()=>n.e(439613).then(n.bind(n,204719))),"unified-consent-state"),dw=lC((()=>n.e(114826).then(n.bind(n,393305))),"services-url-preview"),uw=lC((()=>n.e(613549).then(n.bind(n,127072))),"services-user-profile"),mw=lC((()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,106845))),"services-voicemail"),pw=lC((()=>n.e(948693).then(n.bind(n,719824))),"services-item-crud"),gw=lC((()=>n.e(551792).then(n.bind(n,930800))),"services-webinar"),hw=lC((()=>n.e(178815).then(n.bind(n,208673))),"services-meeting-bot"),yw=lC((()=>n.e(729961).then(n.bind(n,806137))),"services-virtual-events"),vw=lC((()=>n.e(195270).then(n.bind(n,598850))),"services-meeting-scheduling-service"),fw=lC((()=>n.e(223935).then(n.bind(n,981514))),"services-developer-switchers"),Sw=lC((()=>n.e(478053).then(n.bind(n,457631))),"services-search-prefetch"),kw=lC((()=>n.e(684615).then(n.bind(n,755146))),"services-call-recording"),Cw=lC((()=>n.e(59616).then(n.bind(n,142684))),"services-user-license"),bw=lC((()=>n.e(376049).then(n.bind(n,660946))),"services-payment"),ww=lC((()=>n.e(417341).then(n.bind(n,408584))),"services-monetization"),Tw=lC((()=>n.e(57264).then(n.bind(n,256257))),"services-mru"),Iw=lC((()=>n.e(701035).then(n.bind(n,717709))),"services-collab-cloud"),Nw=lC((()=>n.e(655402).then(n.bind(n,911222))),"tfl-user-service"),Ew=lC((()=>n.e(172042).then(n.bind(n,253257))),"services-sensitivity-label-policy-settings"),Aw=lC((()=>n.e(883548).then(n.bind(n,79068))),"services-meeting-questions-and-answers"),_w=lC((()=>n.e(864438).then(n.bind(n,490383))),"services-io-web-app-switcher"),Fw=lC((()=>n.e(145332).then(n.bind(n,806917))),"services-io-mtma-user-data"),Dw=lC((()=>n.e(112279).then(n.bind(n,473802))),"services-io-waffle"),Pw=lC((()=>n.e(669733).then(n.bind(n,686930))),"services-io-organization-info"),Mw=lC((()=>n.e(949584).then(n.bind(n,950999))),"services-video-message-upload"),xw=lC((()=>n.e(658438).then(n.bind(n,997144))),"services-io-browser-video-message-camera-command"),Rw=e=>()=>e.userServicesCache(rC.AsyncMediaService,(()=>(async e=>{const{send:t,gtmRegistry:n,discover:i,coreSettings:a,loggerFactory:o,scenarioFactory:r,endpointsManager:s}=e,{AsyncMediaService:l}=await hC(r);return new l(t,n,i,a,o,s,r)})(e))),jw=e=>()=>e.userServicesCache(rC.SharepointRestClient,(()=>(async e=>{const{authenticationService:t,platformService:n,scenarioFactory:i,endpointsManager:a,coreSettings:o}=e,{SharepointRestClient:r}=await qb(i);return new r(t,n,a,o)})(e))),Lw=(e,t)=>()=>e.userServicesCache(rC.BotsPlatformService,(()=>(async(e,t)=>{const{authenticationService:n,scenarioFactory:i,gtmRegistry:a,send:o,discover:r,platformService:s,i18n:l,coreSettings:c}=e,d=await t(),{BotsPlatformService:u}=await kC(i);return new u(n,d,a.bind(o,"middleTier"),r,i,s,l,c)})(e,t))),Ow=e=>()=>e.userServicesCache(rC.ConnectedAccountsService,(()=>(async e=>{const{discover:t,gtmRegistry:n,scenarioFactory:i,send:a,coreSettings:o,i18n:r,endpointsManager:s}=e,{ConnectedAccountsService:l}=await BC(i);return new l(t,n,i,o,a,r,s)})(e))),$w=e=>()=>e.userServicesCache(rC.GoogleCalendarAuthenticationService,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,windowProvider:i,scenarioFactory:a,platformService:o,coreSecurityService:r}=e,{GoogleCalendarAuthenticationService:s}=await ab(a);return new s(i,t,n,a,o,r)})(e))),Uw=e=>()=>e.userServicesCache(rC.GoogleContactsAuthenticationService,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,windowProvider:i,scenarioFactory:a,platformService:o,coreSecurityService:r}=e,{GoogleContactsAuthenticationService:s}=await ob(a);return new s(i,t,n,a,o,r)})(e))),Bw=e=>()=>e.userServicesCache(rC.MsaAuthenticationService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,windowProvider:i}=e,{MsaAuthenticationService:a}=await Fb(n);return new a(t,n,i)})(e))),Ww=(e,t,n,i)=>()=>e.userServicesCache(rC.ExternalAccountsService,(()=>(async(e,t,n,i)=>{const{coreSettings:a,localStorage:o,platformService:r,scenarioFactory:s}=e,l=await t(),c=await n(),d=await i(),{ExternalAccountsService:u}=await QC(s);return new u(a,l,c,d,s,r,o)})(e,t,n,i))),Hw=(e,t,n)=>()=>e.userServicesCache(rC.ThirdPartyCalendarService,(()=>(async(e,t,n)=>{const{coreSettings:i,scenarioFactory:a,authenticationService:o,localStorage:r}=e,s=await t(),l=await n(),{ThirdPartyCalendarService:c}=await ow(a);return new c(i,o,s,l,a,r)})(e,t,n))),Vw=e=>()=>e.userServicesCache(rC.CallingAppEventsService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,windowProvider:i,coreSettings:a}=e,{CallingAppEventsService:o,ObservableFactory:r}=await cC();return new o(t,new r,n,i,a)})(e))),Gw=(e,t)=>()=>e.userServicesCache(rC.CallingBannerServiceAdapter,(()=>(async(e,t)=>{const{loggerFactory:n}=e,i=await t(),{CallingBannerServiceAdapter:a}=await cC();return new a(n,i)})(e,t))),zw=(e,t)=>()=>e.userServicesCache(rC.CallingDialogServiceAdapter,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i}=e,a=await t(),{CallingDialogServiceAdapter:o}=await cC();return new o(n,i,a)})(e,t))),qw=(e,t)=>()=>e.userServicesCache(rC.CallingNotificationServiceAdapter,(()=>(async(e,t)=>{const{loggerFactory:n,coreSettings:i,hostCommunicationService:a,platformService:o,scenarioFactory:r,coreShortcutService:s}=e,l=await t(),{CallingLoggingService:c,CallingNotificationServiceAdapter:d}=await cC();return new d(n,i,l,a,new c(n,r,i,e.config,o),s)})(e,t))),Jw=e=>()=>e.userServicesCache(rC.DiscoverSurfaceService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i}=e,{DiscoverSurfaceService:a}=await yb(n);return new a(t,i,n)})(e))),Qw=e=>()=>e.userServicesCache(rC.UserLicenseService,(()=>(async e=>{const{discover:t,endpointsManager:n,loggerFactory:i,scenarioFactory:a}=e,{UserLicenseService:o}=await Cw(a);return new o(t,n,i,a)})(e))),Kw=(e,t)=>()=>e.userServicesCache(rC.SmbUserIntentService,(()=>(async(e,t)=>{const{endpointsManager:n,loggerFactory:i,scenarioFactory:a,localStorage:o,windowProvider:r}=e,s=await t(),{SmbUserIntentService:l}=await Yb(a);return new l(i,n,o,s,r,a)})(e,t))),Yw=e=>()=>e.userServicesCache(rC.TenantPrivacyProfileService,(()=>(async e=>{const{loggerFactory:t,authenticationService:n,coreSettings:i,scenarioFactory:a,endpointsManager:o,localStorage:r,discover:s}=e,{CallingIdentityAdapterService:l,ClientDatabaseService:c,AggregatedSettingsStoreService:d,ACSCallingAuthenticationServiceAdapter:u,CallingAuthenticationServiceAdapter:m,TenantPrivacyProfileService:p}=await cC(),g=new c(t,r),h=new d(t,i),y=await n.getUser();return new p(t,n,new l(i.get(b.J.Calling).enableACSEmbed?new u(s,y,t):new m(n,s,y,t,i),h,t),i,g,a,o)})(e))),Xw=e=>()=>{const{coreSettings:t}=e;if(!t?.get(b.J.CMDMeetingArtifactsService)?.enableCMDMeetingArtifactsService)throw new Error("FF enableCMDMeetingArtifactsService is disabled");return e.userServicesCache(rC.CollabObjectService,(()=>(async e=>{const{send:t,coreSettings:n,loggerFactory:i,endpointsManager:a,scenarioFactory:o,discover:r}=e,{CollabObjectService:s}=await $C(o);return new s(t,n,i,a,r)})(e)))},Zw=e=>()=>e.userServicesCache(rC.StoreDevicesService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i,coreSettings:a}=e,{StoreDevicesService:o}=await HC(n);return new o(i,t,n,a)})(e))),eT=e=>()=>e.userServicesCache(rC.OrganizationInfoService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{OrganizationInfoService:i}=await Pw(n);return new i(t)})(e))),tT=e=>()=>e.userServicesCache(rC.MeetingRoomAppEventsService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,windowProvider:i}=e,{ObservableFactory:a,MeetingRoomAppEventsService:o}=await cC();return new o(t,new a,n,i)})(e))),nT=e=>()=>e.userServicesCache(rC.AppsStoreService,(()=>(async e=>{const{scenarioFactory:t,coreSettings:n,endpointsManager:i}=e,{AppsStoreService:a}=await mC(t);return new a(t,n,i)})(e))),iT=e=>()=>{const{coreSettings:t}=e;if(!t?.get(b.J.TeamsCopilotService)?.enableTeamsCopilotService)throw new Error("FF enableTeamsCopilotService is disabled");return e.userServicesCache(rC.TeamsCopilotService,(()=>(async e=>{const{coreSettings:t,loggerFactory:n,endpointsManager:i,scenarioFactory:a}=e,{TeamsCopilotService:o}=await aw(a);return new o(t,n,i)})(e)))},aT=e=>()=>e.userServicesCache(rC.AiInsightsFeedbackService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,loggerFactory:i}=e,{AiInsightsFeedbackService:a}=await NC(t);return new a(n,i,t)})(e))),oT=e=>()=>e.userServicesCache(rC.AiInsightsSdsService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,loggerFactory:i}=e,{AiInsightsSdsService:a}=await EC(t);return new a(n,i,t)})(e))),rT=(e,t)=>()=>e.userServicesCache(rC.AppBasedLinkService,(()=>(async(e,t)=>{const{coreSettings:n,scenarioFactory:i,loggerFactory:a}=e,{AppBasedLinkService:o}=await dC(i);return new o(n,await t(),i,a,e.userBiService)})(e,t))),sT=e=>()=>e.userServicesCache(rC.AppsPlatformService,(()=>(async e=>{const{scenarioFactory:t,coreSettings:n,endpointsManager:i,localStorage:a,authenticationService:o}=e,{enableMetaOsSdkIntegration:r}=n.get(b.J.Extensibility),{AppsPlatformService:s,AppsPlatformServiceMetaOS:l}=await uC(t);return r?new l(n,i,t,o):new s(n,i,a)})(e))),lT=e=>()=>e.userServicesCache(rC.AppSuggestionsService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,coreSettings:i,loggerFactory:a}=e,{AppSuggestionsService:o}=await pC(t);return new o(t,i,n,a)})(e))),cT=async(e,t)=>{const{authenticationService:n,i18n:i,loggerFactory:a,scenarioFactory:o,windowProvider:r,coreSettings:s,pubsub:l}=e,{enableAugLoopService:c,runtimeFlights:d,resource:u,serviceUrl:m}=s.get(b.J.Augloop),{AugloopService:p}=await yC(o),g=new p(n,r,l,a,o,i,s),h=t?{appName:"Word",appPlatform:"Web"}:void 0;return c&&m&&u&&await g.initialize(m,u,d||[],h),g},dT=(e,t)=>()=>t?e.userServicesCache(rC.ComposeAugloopService,(()=>cT(e,!0))):e.userServicesCache(rC.AugloopService,(()=>cT(e))),uT=e=>()=>e.userServicesCache(rC.SubstrateBotPlatformService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{SubstrateBotPlatformService:i}=await vC(n);return new i(t)})(e))),mT=e=>()=>e.userServicesCache(rC.AzureMapsService,(()=>(async e=>{const{loggerFactory:t,i18NextWrapper:n,scenarioFactory:i,coreSettings:a}=e,{AzureMapsService:o}=await fC(i);return new o(t,a,n)})(e))),pT=e=>()=>e.userServicesCache(rC.BadgeCountService,(()=>(async e=>{const{coreSettings:t,config:n,discover:i,platformService:a,scenarioFactory:o}=e,{BadgeCountService:r}=await RC(o);return new r(a,t,i,n)})(e))),gT=e=>()=>e.userServicesCache(rC.BrbService,(()=>(async e=>{const{activeWindowsService:t,scenarioFactory:n,loggerFactory:i,coreSettings:a,logsCollectorService:o,authenticationService:r,platformService:s,discover:l,windowProvider:c,hostCommunicationService:d,endpointsManager:u,authenticationUser:m,i18n:p}=e,{BrbService:g}=await CC(n);return new g(i,a,o,r,s,l,c,d,u,n,p,t,m)})(e))),hT=e=>()=>e.userServicesCache(rC.BreakoutRoomMiddleTierService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{BreakoutRoomMiddleTierService:i}=await bC(t);return new i(n)})(e))),yT=e=>()=>e.userServicesCache(rC.AtpSafelinksService,(()=>(async e=>{const{coreSettings:t,endpointsManager:n,gtmRegistry:i,localStorage:a,loggerFactory:o,scenarioFactory:r,send:s}=e,{AtpSafelinksService:l}=await gC(r);return new l(i.bind(s,"middleTier"),r,o,a,t,n)})(e))),vT=e=>()=>e.userServicesCache(rC.BroadcastAttendeeService,(()=>(async e=>{const{endpointsManager:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,windowProvider:o}=e,{BroadcastAttendeeService:r}=await _C(a);return new r(t,i,a,o,n)})(e))),fT=e=>()=>e.userServicesCache(rC.BroadcastStreamingAttendeeService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{BroadcastStreamingAttendeeService:i}=await FC(n);return new i(t)})(e))),ST=e=>()=>e.userServicesCache(rC.BroadcastCaptionsService,(()=>(async e=>{const{coreSettings:t,send:n,endpointsManager:i,scenarioFactory:a,windowProvider:o,loggerFactory:r}=e,{BroadcastCaptionsService:s}=await DC(a);return new s(o,r,a,t,n,i)})(e))),kT=e=>()=>e.userServicesCache(rC.BroadcastSignalRService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,endpointsManager:i,windowProvider:a}=e,{BroadcastSignalRService:o}=await PC(t);return new o(n,i,t,a)})(e)));var CT=n(816948);const bT=(e,t)=>n=>{t({payload:n,pubsub:e})},wT=async e=>{const{authenticationService:t,coreSettings:i,gtmRegistry:a,loggerFactory:o,pubsub:r,send:s,windowProvider:l}=e,{CallBlockingService:c}=await n.e(667417).then(n.bind(n,546307));return new c(t,i,a.bind(s,"middleTier"),o.newLogger("CallBlockingService","data-services-common"),l,bT(r,TT))},TT=({payload:e,pubsub:t})=>{t.publish(CT.oo,e.newBlockedMris)};class IT{constructor(){this._displayName=null,this.getDisplayName=()=>this._displayName,this.setDisplayName=e=>{this._displayName=e}}}const NT=e=>()=>e.userServicesCache(rC.CallingAnonymousDisplayNameService,(()=>(async()=>new IT)())),ET=e=>()=>e.userServicesCache(rC.CmdMeetingIntelligenceService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{CmdMeetingIntelligenceService:i}=await OC(t);return new i(n)})(e))),AT=e=>()=>e.userServicesCache(rC.CommunitySettingsService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{CommunitySettingsService:i}=await UC(t);return new i(n)})(e))),_T=e=>()=>e.userServicesCache(rC.ConnectedCalendarSettingsService,(()=>(async e=>{const{coreSettings:t,scenarioFactory:n,endpointsManager:i}=e,{ConnectedCalendarSettingsService:a}=await WC(n);return new a(n,t,i)})(e))),FT=e=>()=>{const{coreSettings:t}=e,{enableCMDServiceForTokenRetriveAndVoiceSignatureStore:n}=t.get(b.J.BiometricEnrollment),{isCMDSvcEnabledForBiometricStorage:i}=t.get(b.J.Host);return n||i?e.userServicesCache(rC.BiometricEnrollmentService,(()=>(async e=>{const{send:t,authenticationService:n,coreSettings:i,loggerFactory:a,platformService:o,scenarioFactory:r,i18n:s,endpointsManager:l,cmdApolloClient:c}=e,{VoiceBiometricEnrollmentService:d}=await SC(r);return new d(t,n,i,a,o,s,l,c)})(e))):e.userServicesCache(rC.BiometricEnrollmentService,(()=>(async e=>{const{discover:t,gtmRegistry:n,loggerFactory:i,platformService:a,scenarioFactory:o,send:r,coreSettings:s,i18n:l,endpointsManager:c}=e,{BiometricEnrollmentService:d}=await SC(o);return new d(t,n,i,a,r,s,l,c)})(e)))},DT=e=>()=>e.userServicesCache(rC.BiometricFaceEnrollmentService,(()=>(async e=>{const{send:t,authenticationService:n,coreSettings:i,loggerFactory:a,platformService:o,scenarioFactory:r,endpointsManager:s}=e,{BiometricFaceEnrollmentService:l}=await SC(r);return new l(t,n,i,a,o,s)})(e))),PT=e=>()=>e.userServicesCache(rC.DeveloperSwitchersService,(()=>(async e=>{const{authenticationService:t,config:n,localStorage:i,loggerFactory:a,rebootService:o,scenarioFactory:r,windowProvider:s}=e,{DeveloperSwitchersService:l}=await fw(r);return new l(o,s,a.newLogger("DeveloperSwitchersService","data-services-common"),t,i,n)})(e))),MT=e=>()=>e.userServicesCache(rC.DistributionListService,(()=>(async e=>{const{gtmRegistry:t,send:n,loggerFactory:i,coreSettings:a,scenarioFactory:o}=e,{DistributionListService:r}=await VC(o);return new r(i,t.bind(n,"middleTier"),a)})(e))),xT=e=>()=>e.userServicesCache(rC.DynamicsMarketingService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,send:i,scenarioFactory:a}=e,{DynamicsMarketingService:o}=await GC(a);return new o(t,n,i)})(e))),RT=e=>()=>e.userServicesCache(rC.DynamicsVirtualEventsService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,send:i,i18NextWrapper:a,scenarioFactory:o,loggerFactory:r,discover:s}=e,{DynamicsVirtualEventsService:l}=await zC(o);return new l(t,n,i,a,r,s)})(e))),jT=e=>()=>e.userServicesCache(rC.EmoticonService,(()=>(async e=>{const{loggerFactory:t,localStorage:n,scenarioFactory:i,coreSettings:a,i18n:o,windowProvider:r,config:s}=e,{EmoticonService:l}=await qC(i),c=new l(o.locale,n,a,t.newLogger("EmoticonService","data-services-common"),i,o,r,s?.experienceName);return await c.isInitialized,c})(e))),LT=e=>()=>e.userServicesCache(rC.EspService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{EspService:i}=await JC(n);return new i(t)})(e))),OT=e=>()=>e.userServicesCache(rC.ExampleService,(()=>(async e=>{const{scenarioFactory:t}=e,{ExampleService:n}=await Rb(t);return new n})(e))),$T=(e,t)=>()=>e.userServicesCache(rC.ExternalAccountsResponseService,(()=>(async(e,t)=>{const{coreSettings:n,scenarioFactory:i}=e,a=await t(),{ExternalAccountsResponseService:o}=await KC(i);return new o(n,a,i)})(e,t))),UT=e=>()=>e.userServicesCache(rC.FluidService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,endpointsManager:i,send:a,scenarioFactory:o}=e,{FluidService:r}=await tb(o);return new r(t,n,i,a)})(e))),BT=e=>()=>e.userServicesCache(rC.GalleryService,(()=>(async e=>{const{coreSettings:t,discover:n,send:i,scenarioFactory:a}=e,{GalleryService:o}=await ib(a);return new o(i,t,n,a)})(e))),WT=e=>()=>e.userServicesCache(rC.GiphyService,(()=>(async e=>{const{coreSettings:t,gtmRegistry:n,endpointsManager:i,send:a,scenarioFactory:o,i18n:r}=e,{GiphyService:s}=await nb(o);return new s(n.bind(a,"middleTier"),t,r.locale,i)})(e))),HT=e=>()=>e.userServicesCache(rC.GuardiansService,(()=>(async e=>{const{gtmRegistry:t,discover:n,send:i,scenarioFactory:a,loggerFactory:o,i18n:r}=e,{GuardiansService:s}=await fb(a);return new s(t,o,n,i,r)})(e))),VT=e=>()=>e.userServicesCache(rC.ImageProxyService,(()=>(async e=>{const{coreSettings:t,gtmRegistry:n,send:i,scenarioFactory:a,endpointsManager:o,loggerFactory:r}=e,{ImageProxyService:s}=await rb(a);return new s(n,i,t,o,r)})(e))),GT=e=>()=>e.userServicesCache(rC.ImmersiveReaderService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{ImmersiveReaderService:i}=await sb(n);return new i(t)})(e))),zT=(e,t)=>()=>t.userServicesCache(rC.ImportMsaContactsService,(()=>(async(e,t)=>{const{coreSettings:n,endpointsManager:i,scenarioFactory:a}=t,{ImportMsaContactsService:o}=await lb(a);return new o(await e(),n,i,a)})(e,t))),qT=e=>()=>e.userServicesCache(rC.ImplicitContactsService,(()=>(async({discover:e,gtmRegistry:t,send:n,scenarioFactory:i})=>{const{ImplicitContactsService:a}=await ew(i);return new a(n,e,t,i)})(e))),JT=e=>()=>e.userServicesCache(rC.InstantAnswersService,(()=>(async e=>{const{coreSettings:t,send:n,scenarioFactory:i,loggerFactory:a,i18n:o}=e,{InstantAnswersService:r}=await cb(i);return new r(a,i,t,n,o)})(e))),QT=e=>()=>e.userServicesCache(rC.InviteLinksService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{InviteLinksService:i}=await db(t);return new i(n)})(e))),KT=e=>()=>e.userServicesCache(rC.LiveStateBroadcastService,(()=>(async e=>{const{pubsub:t,scenarioFactory:n,loggerFactory:i,coreSettings:a,authenticationService:o,platformService:r,discover:s}=e,{LiveStateBroadcastService:l}=await ub(n);return new l(t,i,a,o,r,n,s)})(e))),YT=e=>()=>e.userServicesCache(rC.LiveStreamRenderingService,(()=>(async e=>{const{authenticationService:t,authStateProvider:n,discover:i,send:a,scenarioFactory:o,loggerFactory:r,pubsub:s,platformService:l,clientState:c,coreSettings:d,endpointsManager:u,networkState:m}=e,{LiveStreamRenderingService:p}=await mb(o),{ACSCallingAuthenticationServiceAdapter:g,CallingAuthenticationServiceAdapter:h}=await cC(),y=await t.getUser();return new p(r,d.get(b.J.Calling).enableACSEmbed?new g(i,y,r):new h(t,i,y,r,d,n),l,c,s,a,d,o,u,m)})(e))),XT=e=>()=>e.userServicesCache(rC.LmsIntegrationService,(()=>(async e=>{const{gtmRegistry:t,discover:n,send:i,scenarioFactory:a}=e,{LmsIntegrationService:o}=await pb(a);return new o(t,n,i)})(e))),ZT=e=>()=>e.userServicesCache(rC.LockedTeamsService,(()=>(async e=>{const{gtmRegistry:t,discover:n,send:i,scenarioFactory:a}=e,{LockedTeamsService:o}=await kb(a);return new o(t,n,i)})(e))),eI=async e=>{const{scenarioFactory:t,loggerFactory:n,logsCollectorService:i,coreSettings:a}=e,{LogsFilesService:o}=await Cb(t);return new o(n,i,a,void 0)},tI=e=>()=>e.userServicesCache(rC.LogsFilesService,(()=>eI(e))),nI=e=>()=>e.userServicesCache(rC.LokiService,(()=>(async e=>{const{authenticationService:t,platformService:n,scenarioFactory:i,coreSettings:a,endpointsManager:o}=e,{LokiService:r}=await hb(i);return new r(n,t,a,o)})(e))),iI=e=>()=>e.userServicesCache(rC.ManageTenantService,(()=>(async e=>{const{endpointsManager:t,loggerFactory:n,scenarioFactory:i}=e,{ManageTenantService:a}=await bb(i);return new a(n,i,t)})(e))),aI=e=>()=>e.userServicesCache(rC.MeetingArtifactsService,(()=>(async e=>{const{authenticationService:t,send:n,coreSettings:i,scenarioFactory:a,i18n:o,loggerFactory:r}=e,{MeetingArtifactsService:s}=await wb(a);return new s(n,t,i,o,r,a)})(e))),oI=(e,t,n)=>()=>{const{coreSettings:i}=e;if(!i?.get(b.J.MeetingBot)?.enableMeetingBot)throw new Error("enableMeetingBot flag is disabled");return e.userServicesCache(rC.MeetingBotService,(()=>(async(e,t,n)=>{const{scenarioFactory:i,cmdApolloClient:a,authenticationService:o,coreSettings:r,loggerFactory:s,localStorage:l,platformService:c,windowProvider:d,entityCommanding:u,i18n:m,authenticationUser:p}=e,{MeetingBotService:g}=await hw(i);return new g(o,await t(),r,await n(),s,i,d,l,c,a,u,m,p)})(e,t,n)))},rI=e=>()=>e.userServicesCache(rC.MeetingIntelligenceService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,loggerFactory:i}=e,{MeetingIntelligenceService:a}=await Tb(t);return new a(n,i)})(e))),sI=e=>()=>e.userServicesCache(rC.PeopleService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{PeopleService:i}=await Db(t);return new i(n)})(e))),lI=async e=>{const{windowProvider:t,coreSettings:i,scenarioFactory:a,loggerFactory:o}=e,{MeetingOptionsClientDataService:r}=await Promise.all([n.e(373846),n.e(820516)]).then(n.bind(n,354229)),s=sI(e);return new r(t,await s(),i,a,o)},cI=e=>()=>e.userServicesCache(rC.MeetingOptionsClientDataService,(()=>lI(e))),dI=e=>()=>e.userServicesCache(rC.MeetingOptionsService,(()=>(async e=>{const{authenticationService:t,send:n,scenarioFactory:i,coreSettings:a,gtmRegistry:o,discover:r,endpointsManager:s}=e,{MeetingOptionsService:l}=await Nb(i);return new l(t,n,i,a,o,r,s)})(e))),uI=e=>()=>e.userServicesCache(rC.MeetingQuestionsAndAnswersService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i}=e,{MeetingQuestionsAndAnswersService:a}=await Aw(n);return new a(i,t,n)})(e))),mI=e=>()=>e.userServicesCache(rC.MeetingRecapService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{MeetingRecapService:i}=await Ib(t);return new i(n)})(e))),pI=e=>()=>e.userServicesCache(rC.MeetingRecapSwaService,(()=>(async e=>{const{send:t,scenarioFactory:n,authenticationService:i,loggerFactory:a,endpointsManager:o,coreSettings:r}=e,{MeetingRecapSwaService:s}=await Eb(n);return new s(o,i,t,r,a)})(e))),gI=e=>()=>e.userServicesCache(rC.MeetingRecapWorkingSetFilesService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{MeetingRecapWorkingSetFilesService:i}=await Ab(t);return new i(n)})(e))),hI=e=>()=>e.userServicesCache(rC.MeetingTemplateService,(()=>(async({scenarioFactory:e,send:t,authenticationService:n,coreSettings:i,discover:a,loggerFactory:o,endpointsManager:r})=>{const{MeetingTemplateService:s}=await _b(e);return new s(t,n,i,e,a,r,o)})(e))),yI=e=>()=>e.userServicesCache(rC.PaymentsService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,i18n:o,loggerFactory:r}=e,{PaymentService:s}=await bw(t);return new s(n,i,a,r,t,o)})(e))),vI=e=>()=>e.userServicesCache(rC.PeoplePickerService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{PeoplePickerService:i}=await Pb(t);return new i(n)})(e))),fI=e=>()=>e.userServicesCache(rC.PeopleTargetingService,(()=>(async e=>{const{authenticationService:t,loggerFactory:n,send:i,coreSettings:a,scenarioFactory:o,discover:r}=e,{PeopleTargetingService:s}=await Mb(o);return new s(t,n,i,a,r)})(e))),SI=e=>()=>e.userServicesCache(rC.PoliciesService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,endpointsManager:i,loggerFactory:a,networkState:o,scenarioFactory:r}=e,{PoliciesService:s}=await $b(r);return new s(i,t,n,a,o,r)})(e))),kI=e=>()=>e.userServicesCache(rC.PresenceService,(()=>(async e=>{const{gtmRegistry:t,pubsub:n,send:i,scenarioFactory:a,platformService:o,config:r}=e,{PresenceService:s}=await Ub(a);return new s(t.bind(i,"unifiedPresence"),n,o,r)})(e)));class CI extends Error{constructor(e,t){super(`${t} - ${e}`)}}class bI{async process(e,t){return this.validateInput(t),this.validateConfig(e),this.executeStatements(e,t)}async executeStatements(e,t){const n=[];for(const i of t.odsl?.statements||[]){const t=e[i.name];if(!t)throw new CI(`No matching manifest found for statement '${i.name}'`,"ODSLProcessor-01");const a=t(this.processStatement(i));n.push(a)}return n}processStatement(e){const t={};Object.keys(e.arguments).forEach((n=>{const i=e.arguments[n];switch(i.type){case"number":i.number&&(t[n]=i.number);break;case"boolean":i.boolean&&(t[n]=i.boolean);break;case"string":i.string&&(t[n]=i.string)}}));return t}validateConfig(e){if(!e)throw new CI("No manifest found","ODSLProcessor-04")}validateInput(e){if(!e)throw new CI("No input found","ODSLProcessor-05");if(!e.odsl)throw new CI("No ODSL found in input","ODSLProcessor-06");if(!e.entities)throw new CI("No entities found in input","ODSLProcessor-07")}}const wI=e=>()=>e.userServicesCache(rC.ODSLProcessingEngine,(()=>(async e=>new bI)())),TI=async e=>{const{gtmRegistry:t,send:i,loggerFactory:a}=e,{AddressService:o}=await n.e(821836).then(n.bind(n,39570));return new o(t.bind(i,"middleTier"),a)},II=e=>()=>e.userServicesCache(rC.AddressService,(()=>TI(e))),NI=async e=>{const{gtmRegistry:t,send:i}=e,{PstnService:a}=await n.e(893393).then(n.bind(n,15526));return new a(t.bind(i,"middleTier"))},EI=e=>()=>e.userServicesCache(rC.PstnService,(()=>NI(e))),AI=e=>()=>e.userServicesCache(rC.SCISService,(()=>(async e=>{const{send:t,authenticationService:n,platformService:i,scenarioFactory:a,loggerFactory:o}=e,{SCISService:r}=await Bb(a);return new r(t,n,i,a,o)})(e))),_I=e=>()=>e.userServicesCache(rC.SearchPrefetchService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,authenticationService:i}=e,{SearchPrefetchService:a}=await Sw(t);return new a(i,n)})(e))),FI=e=>()=>e.userServicesCache(rC.ShareService,(()=>(async e=>{const{coreSettings:t,discover:n,gtmRegistry:i,scenarioFactory:a,send:o,i18n:r}=e,{ShareService:s}=await Qb(a);return new s(t,n,i,o,r)})(e))),DI=(e,t,n)=>()=>e.userServicesCache(rC.StoreService,(()=>(async(e,t,n)=>{const{scenarioFactory:i,loggerFactory:a,gtmRegistry:o,localStorage:r,coreSettings:s,authenticationService:l,platformService:c,endpointsManager:d,windowProvider:u,i18n:m}=e,{StoreService:p}=await Xb(i);return new p(i,a,o,r,s,l,c,d,u,m,await t(),await n())})(e,t,n))),PI=e=>()=>e.userServicesCache(rC.StyleMyRoomService,(()=>(async e=>{const{coreSettings:t,i18n:n,scenarioFactory:i,endpointsManager:a}=e,{StyleMyRoomService:o}=await AC(i);return new o(t,a,n)})(e))),MI=e=>()=>e.userServicesCache(rC.TenantMembershipService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{TenantMembershipService:i}=await nw(t);return new i(t,n)})(e))),xI=e=>()=>e.userServicesCache(rC.TenantService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{TenantService:i}=await iw(t);return new i(t,n)})(e))),RI=e=>()=>e.userServicesCache(rC.TenantAnalyticsService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i}=e,{TenantAnalyticsService:a}=await gb(n);return new a(i,t)})(e))),jI=e=>()=>e.userServicesCache(rC.TranscriptService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,coreSettings:i,loggerFactory:a}=e,{TranscriptService:o}=await wC(t);return new o(n,a,t,i)})(e))),LI=e=>()=>e.userServicesCache(rC.TranscriptFeedbackService,(()=>(async e=>{const{scenarioFactory:t}=e,{TranscriptFeedbackService:n}=await IC(t);return new n})(e))),OI=e=>()=>e.userServicesCache(rC.TranscriptSettingsStoreService,(()=>(async e=>{const{loggerFactory:t,scenarioFactory:n,endpointsManager:i,authenticationUser:a}=e,{SettingsStoreService:o}=await TC(n);return new o(t,n,i,a)})(e))),$I=e=>()=>e.userServicesCache(rC.TranslateService,(()=>(async e=>{const{gtmRegistry:t,endpointsManager:n,coreSettings:i,scenarioFactory:a,send:o}=e,{TranslateService:r}=await sw(a);return new r(t.bind(o,"middleTier"),a,i,n)})(e))),UI=e=>()=>e.userServicesCache(rC.TargetingHierarchyService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,discover:i,loggerFactory:a,scenarioFactory:o,send:r}=e,{TargetingHierarchyService:s}=await tw(o);return new s(t,a,r,n,i)})(e))),BI=e=>()=>e.userServicesCache(rC.ToastImageService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{ToastImageService:i}=await rw(t);return new i(n)})(e)));var WI=n(953874);const HI=e=>()=>e.userServicesCache(rC.TeamsAndChannelsService,(()=>(async e=>{const{endpointsManager:t}=e;return new WI.K(t)})(e))),VI=e=>()=>e.userServicesCache(rC.TpnNoticeService,(()=>(async e=>{const{send:t,platformService:n,scenarioFactory:i}=e,{TpnNoticeService:a}=await lw(i);return new a(t,n)})(e))),GI=(e,t)=>()=>e.userServicesCache(rC.UrlPreviewService,(()=>(async(e,t)=>{const{gtmRegistry:n,endpointsManager:i,send:a,coreSettings:o,scenarioFactory:r}=e,{UrlPreviewService:s}=await dw(r);return new s(n,a,o,await t(),i,r)})(e,t))),zI=e=>()=>e.userServicesCache(rC.MyUserPreferencesStore,(()=>(async e=>{const{loggerFactory:t,cmdApolloClient:n}=e,{MyUserPreferencesStore:i}=await cC();return new i(n,t)})(e))),qI=e=>()=>e.userServicesCache(rC.UserProfileService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{UserProfileService:i}=await uw(t);return new i(n)})(e))),JI=e=>()=>e.userServicesCache(rC.VirtualEventsService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,loggerFactory:r,endpointsManager:s}=e,{VirtualEventsService:l,MockVirtualEventsService:c}=await yw(t),{forceUseMockAPIs:d}=a.get(b.J.VirtualEvents);return d?new c:new l(n,i,a,o,r,s)})(e))),QI=e=>()=>e.userServicesCache(rC.MeetingSchedulingService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{MeetingSchedulingService:i}=await vw(t);return new i(n)})(e)));var KI=n(376405);const YI=({payload:e,pubsub:t})=>{t.publish(KI.Gq,e)},XI=e=>()=>e.userServicesCache(rC.VoicemailService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,pubsub:o,send:r,windowProvider:s}=e,{VoicemailService:l}=await mw(a);return new l(t,n,r,i,s,bT(o,YI))})(e))),ZI=e=>()=>e.userServicesCache(rC.WebinarService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,i18n:r,loggerFactory:s}=e,{WebinarService:l}=await gw(t);return new l(n,i,a,s,t,r,o)})(e))),eN=e=>()=>e.userServicesCache(rC.CallRecordingService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,endpointsManager:i}=e,{CallRecordingService:a}=await kw(t);return new a(n,i)})(e))),tN=e=>()=>e.userServicesCache(rC.MonetizationService,(()=>(async e=>{const{authenticationService:t,send:n,scenarioFactory:i,loggerFactory:a,discover:o,coreSettings:r,localStorage:s}=e,{MonetizationService:l}=await ww(i);return new l(t,n,a,o,r,s)})(e))),nN=e=>()=>e.userServicesCache(rC.MRUItemService,(()=>(async e=>{const{authenticationService:t,send:n,scenarioFactory:i,coreSettings:a}=e,{MRUService:o}=await Tw(i);return new o(t,n,a)})(e))),iN=(e,t)=>()=>e.userServicesCache(rC.DiscoverSurfaceFeedbackService,(()=>(async(e,t)=>{const{scenarioFactory:n,windowProvider:i,loggerFactory:a}=e,{DiscoverSurfaceFeedbackService:o}=await vb(n);return new o(await t(),i,a)})(e,t))),aN=e=>()=>{const{coreSettings:t}=e;if(!t?.get(b.J.Extensibility)?.enableCollabCloudApis)throw new Error("enableCollabCloudApis flag is disabled");return e.userServicesCache(rC.CollabCloudService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{CollabCloudService:i}=await Iw(t);return new i(n)})(e)))},oN=e=>()=>e.userServicesCache(rC.TFLUserService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n,localStorage:i,loggerFactory:a}=e,{TFLUserService:o}=await Nw(t);return new o(a,i,n)})(e))),rN=e=>()=>e.userServicesCache(rC.SensitivityLabelPolicySettingsService,(()=>(async e=>{const{coreSettings:t,discover:n,gtmRegistry:i,authenticationUser:a,scenarioFactory:o,send:r}=e,{SensitivityLabelPolicySettingsService:s}=await Ew(o);return new s(o,t,i,r,n,a)})(e))),sN=e=>()=>e.userServicesCache(rC.WaffleService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{WaffleService:i}=await Dw(n);return new i(t)})(e))),lN=e=>()=>e.userServicesCache(rC.VideoMessageCameraCommandService,(()=>(async e=>{const{scenarioFactory:t}=e,{VideoMessageCameraCommandService:n}=await xw(t);return new n})(e))),cN=(e,t,n)=>()=>e.userServicesCache(rC.PetrolService,(()=>(async(e,t,n)=>{const{platformService:i,authenticationService:a,coreSettings:o,send:r,scenarioFactory:s,loggerFactory:l,hostCommunicationService:c,i18n:d}=e,{PetrolService:u}=await jb(s);return new u(a,s,l,i,o,r,await t(),await n(),c,d)})(e,t,n))),dN=(e,t)=>()=>e.userServicesCache(rC.FloodgateService,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i,coreSettings:a,clientState:o,i18NextWrapper:r,windowProvider:s,platformService:l,authenticationUser:c}=e,d=await t(),{FloodGateService:u}=await Lb(i);return new u(n,i,o,a,d,r,l,s,c)})(e,t))),uN=(e,t,n)=>()=>e.userServicesCache(rC.OdsService,(()=>(async(e,t,n)=>{const{authenticationService:i,scenarioFactory:a,loggerFactory:o,endpointsManager:r,logsCollectorService:s,coreSettings:l,platformService:c,hostCommunicationService:d,i18n:u}=e,{OdsService:m}=await Ob(a);return new m(i,o,r,s,l,c,await t(),d,await n(),u)})(e,t,n))),mN=e=>()=>e.userServicesCache(rC.LokiMetaPreviewService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,scenarioFactory:a}=e,{LokiMetaPreviewService:o}=await Wb(a);return new o(n,t,i)})(e))),pN=e=>()=>e.userServicesCache(rC.OdcFilePreviewService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,scenarioFactory:a}=e,{OdcFilePreviewService:o}=await Wb(a);return new o(n,t,i)})(e))),gN=e=>()=>e.userServicesCache(rC.OSearchService,(()=>(async e=>{const{send:t,discover:n,loggerFactory:i,scenarioFactory:a,coreSettings:o,endpointsManager:r}=e,{OSearchService:s}=await Wb(a);return new s(t,r,n,i,o)})(e))),hN=e=>()=>e.userServicesCache(rC.PeopleSearchService,(()=>(async e=>{const{send:t,endpointsManager:n,gtmRegistry:i,loggerFactory:a,scenarioFactory:o,discover:r,coreSettings:s}=e,{PeopleSearchService:l}=await Wb(o);return new l(i.bind(t,"middleTier"),n,a,r,s)})(e))),yN=e=>()=>e.userServicesCache(rC.SubstrateFilesSearchService,(()=>(async e=>{const{authenticationService:t,send:n,platformService:i,loggerFactory:a,scenarioFactory:o,i18n:r}=e,{SubstrateFilesSearchService:s}=await Wb(o);return new s(n,t,i,o,a,r)})(e))),vN=e=>()=>e.userServicesCache(rC.SubstrateRecommendationsService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n}=e,{SubstrateRecommendationsService:i}=await zb(n);return new i(t)})(e))),fN=e=>()=>e.userServicesCache(rC.SubstrateSearchService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,platformService:a,scenarioFactory:o,windowProvider:r,coreSettings:s,endpointsManager:l,i18n:c}=e,{SubstrateSearchService:d}=await Wb(o),{subType:u}=await t.getUser();return new d(n,t,a,o,i,r,s,l,c,u||ys.Yf.Default)})(e))),SN=e=>()=>e.userServicesCache(rC.SubstrateSuggestionsService,(()=>(async({authenticationService:e,endpointsManager:t,coreSettings:n,discover:i,gtmRegistry:a,send:o,scenarioFactory:r,platformService:s})=>{const{SubstrateSuggestionsService:l}=await Zb(r);return new l(o,t,e,n,i,a,s)})(e))),kN=e=>()=>e.userServicesCache(rC.SubstrateMeetingSearchService,(()=>(async e=>{const{authenticationService:t,send:n,loggerFactory:i,platformService:a,scenarioFactory:o}=e,{SubstrateMeetingSearchService:r}=await Wb(o);return new r(n,t,a,o,i)})(e))),CN=e=>()=>e.userServicesCache(rC.SubstrateMeetingSummarySearchService,(()=>(async e=>{const{authenticationService:t,loggerFactory:n,platformService:i,scenarioFactory:a,coreSettings:o,endpointsManager:r,i18n:s}=e,{SubstrateMeetingSummarySearchService:l}=await Hb(a);return new l(t,i,a,n,o,r,s)})(e))),bN=e=>()=>e.userServicesCache(rC.ChatService,(()=>(async e=>{const{endpointsManager:t,coreSettings:n,scenarioFactory:i}=e,{ChatService:a}=await RC(i);return new a(n,t)})(e))),wN=(e,t)=>()=>e.userServicesCache(rC.ChatServiceEndpointProvider,(()=>(async(e,t)=>{const{scenarioFactory:n}=e,i=await t(),{ChatServiceEndpointProvider:a}=await xC(n);return new a(i,n)})(e,t))),TN=e=>()=>e.userServicesCache(rC.ConsumerGroupsService,(()=>(async e=>{const{coreSettings:t,scenarioFactory:n,endpointsManager:i,loggerFactory:a}=e,{ConsumerGroupsService:o}=await RC(n);return new o(i,a,n,t)})(e))),IN=e=>()=>e.userServicesCache(rC.CSAService,(()=>(async e=>{const{authenticationService:t,platformService:n,coreSettings:i,scenarioFactory:a,endpointsManager:o,i18n:r,discover:s}=e,{createCSAService:l}=await RC(a);return l(t,n,i,r,o,s)})(e))),NN=e=>()=>e.userServicesCache(rC.StatefulLongPoll,(()=>(async e=>{const{scenarioFactory:t}=e,{StatefulLongPoll:n}=await RC(t);return new n})(e))),EN=e=>()=>e.userServicesCache(rC.ReportConcernService,(()=>(async e=>{const{scenarioFactory:t,send:n,gtmRegistry:i,platformService:a}=e,{ReportConcernService:o}=await LC(t);return new o(i.bind(n,"middleTier"),a)})(e))),AN=e=>()=>e.userServicesCache(rC.CallingConversationService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i}=e,{CallingConversationService:a}=await jC(n);return new a(t,i)})(e))),_N=(e,t)=>()=>e.userServicesCache(rC.SharepointShareService,(()=>(async(e,t)=>{const{endpointsManager:n,coreSettings:i,loggerFactory:a,send:o,scenarioFactory:r}=e,{SharepointShareService:s}=await Jb(r);return new s(o,n,a,i,await t())})(e,t))),FN=(e,t)=>()=>e.userServicesCache(rC.FilesRedeemService,(()=>(async(e,t)=>{const{endpointsManager:n,coreSettings:i,loggerFactory:a,send:o,scenarioFactory:r}=e,{FilesRedeemService:s}=await Jb(r);return new s(o,n,a,i,await t())})(e,t))),DN=(e,t,n)=>()=>n.userServicesCache(rC.FilesSharepointUrlService,(()=>(async(e,t,n)=>{const{scenarioFactory:i,coreSettings:a}=n,{FilesSharepointUrlService:o}=await Jb(i);return new o(await e(),await t(),a)})(e,t,n))),PN=(e,t)=>()=>t.userServicesCache(rC.FilesReferenceService,(()=>(async(e,t)=>{const{scenarioFactory:n,coreSettings:i}=t,{FilesReferenceService:a}=await XC(n);return new a(await e(),i)})(e,t))),MN=(e,t)=>()=>e.userServicesCache(rC.FileUploadPreviewService,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i}=e,{FileUploadPreviewService:a}=await ZC(i);return new a(await t(),n)})(e,t))),xN=(e,t)=>()=>e.userServicesCache(rC.FileUploadService,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i,coreSettings:a}=e,{FileUploadService:o}=await ZC(i);return new o(await t(),a,n)})(e,t))),RN=e=>()=>e.userServicesCache(rC.FileDownloadManagerService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n}=e,{FileDownloadManagerService:i}=await eb(t);return new i(n.newLogger("fileDownloadManagerService","data-services-common"))})(e))),jN=(e,t)=>()=>e.userServicesCache(rC.PersonalFileDetailsService,(()=>(async(e,t)=>{const{discover:n,gtmRegistry:i,loggerFactory:a,scenarioFactory:o,send:r,endpointsManager:s,coreSettings:l}=e,c=await t(),{PersonalFileDetailsService:d}=await xb(o),u=new yc.q(n);return new d(c,o,a,i.bind(u.authorize(r,"x-skypetoken"),"middleTier"),s,l)})(e,t))),LN=async e=>{const{gtmRegistry:t,send:i,discover:a,endpointsManager:o,coreSettings:r}=e,{RefreshSiteUrlService:s}=await n.e(606545).then(n.bind(n,642794));return new s(t,a,i,o,r)},ON=async e=>{const{gtmRegistry:t,discover:i,loggerFactory:a,send:o,endpointsManager:r,coreSettings:s}=e,{CloudStorageFoldersService:l}=await n.e(134125).then(n.bind(n,462018));return new l(t,i,a,o,r,s)},$N=e=>()=>e.userServicesCache(rC.CloudStorageFoldersService,(()=>ON(e))),UN=e=>()=>e.userServicesCache(rC.FilesBackfillThreadPropertiesService,(()=>(async e=>{const{discover:t,gtmRegistry:n,scenarioFactory:i,loggerFactory:a,send:o,endpointsManager:r,coreSettings:s}=e,{FilesBackfillThreadPropertiesService:l}=await XC(i),c=new yc.q(t);return new l(a,n.bind(c.authorize(o,"x-skypetoken"),"middleTier"),r,s)})(e)));var BN=n(846630);const WN=(e,t=cl.l)=>(n,i=BN.hO.BEARER)=>n?e.authorizeV2?.(t,n,{scheme:i})??e.authorize(t,n):t,HN=async(e,t)=>{const{scenarioFactory:n,authenticationService:i,loggerFactory:a,coreSettings:o}=t,r=VN(o),s=GN(o,r)||"",l=zN(o,r)||"",c=WN(i),{ItemUploadService:d,ItemDeleteService:u,ItemDetailsService:m}=await pw(n),p=a.newLogger(e,"data-services-common");switch(e){case rC.ItemUploadService:return new d(c,r,s,l,p);case rC.ItemDeleteService:return new u(c,r,p);case rC.ItemDetailsService:return new m(c,r,p,o);default:return}},VN=e=>!!e.get(b.J.Files).preferGraphOverVroom,GN=(e,t)=>t?e.get(b.J.Files).graphEndpointBaseUrl:e.get(b.J.Files).vroomEndpointBaseUrl,zN=(e,t)=>t?e.get(b.J.Files).graphAuthScope:e.get(b.J.Files).vroomAuthScope,qN=e=>()=>e.userServicesCache(rC.ItemUploadService,(()=>(async e=>await HN(rC.ItemUploadService,e))(e))),JN=e=>()=>e.userServicesCache(rC.ItemDeleteService,(()=>(async e=>await HN(rC.ItemDeleteService,e))(e))),QN=e=>()=>e.userServicesCache(rC.ItemDetailsService,(()=>(async e=>await HN(rC.ItemDetailsService,e))(e))),KN=e=>()=>e.userServicesCache(rC.DriveItemShareService,(()=>(async e=>{const{scenarioFactory:t}=e,{DriveItemShareService:n}=await Jb(t),{authenticationService:i,coreSettings:a}=e,o=VN(a);return new n(WN(i),o)})(e))),YN=(e,t)=>()=>e.userServicesCache(rC.VideoFileService,(()=>(async(e,t)=>{const{coreSettings:n,loggerFactory:i,send:a,scenarioFactory:o}=e,{VideoFileService:r}=await Jb(o);return new r(a,i,n,await t())})(e,t))),XN=e=>()=>e.userServicesCache(rC.FilesValidDomainsService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i,localStorage:a,coreSettings:o}=e,{FilesValidDomainsService:r}=await XC(n);return new r(t,i,a,o)})(e))),ZN=e=>()=>e.userServicesCache(rC.FilesSiteResourceInfoService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,loggerFactory:i}=e,{FilesSiteResourceInfoService:a}=await XC(n);return new a(t,i)})(e))),eE=(e,t)=>()=>e.userServicesCache(rC.VideoMessageUploadService,(()=>(async(e,t)=>{const{loggerFactory:n,scenarioFactory:i,offlineCacheManager:a,discover:o,coreSettings:r,i18n:s}=e,{VideoMessageUploadService:l}=await Mw(i);return new l(await t(),a,i,n,o,r,(0,L.J)(),s)})(e,t))),tE=e=>()=>e.userServicesCache(rC.CalendarService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,loggerFactory:r,platformService:s,i18n:l}=e,{CalendarService:c}=await MC(t);return new c(n,i,o,a,r,s,l)})(e))),nE=e=>()=>e.userServicesCache(rC.ExternalCalendarEmailAddressService,(()=>(async e=>{const{scenarioFactory:t,endpointsManager:n}=e,{ExternalCalendarEmailAddressService:i}=await YC(t);return new i(n)})(e))),iE=e=>()=>e.userServicesCache(rC.TeamCalendarService,(()=>(async e=>{const{scenarioFactory:t,send:n,authenticationService:i,coreSettings:a,discover:o,loggerFactory:r,platformService:s,i18n:l}=e,{TeamCalendarService:c}=await MC(t);return new c(n,i,o,a,r,s,l)})(e))),aE=e=>()=>e.userServicesCache(rC.SubstrateMeetingRecommendationsService,(()=>(async e=>{const{scenarioFactory:t,authenticationService:n,endpointsManager:i,loggerFactory:a}=e,{SubstrateMeetingRecommendationsService:o}=await Gb(t);return new o(n,i,a)})(e))),oE=e=>()=>e.userServicesCache(rC.CommonSubstrateService,(()=>(async e=>{const{scenarioFactory:t,loggerFactory:n,platformService:i,authenticationService:a,endpointsManager:o,windowProvider:r,coreSettings:s}=e,{CommonSubstrateService:l}=await Vb(t);return new l(r,n,a,i,s,o)})(e))),rE=e=>()=>e.userServicesCache(rC.SignalsService,(()=>(async e=>{const{authenticationService:t,config:n,coreSettings:i,scenarioFactory:a,send:o}=e;if(!n)throw new Error("config not set on IUserServicesFactoryContext");const{SignalsService:r}=await Kb(a);return new r(t,i,o,n)})(e))),sE=e=>()=>e.globalServicesCache(sC.ExampleGlobalService,(()=>(async e=>{const{scenarioFactory:t}=e,{ExampleService:n}=await Rb(t);return new n})(e))),lE=e=>()=>e.globalServicesCache(sC.GlobalCallingService,(()=>(async e=>{const{GlobalCallingService:t}=await Promise.all([n.e(309799),n.e(791141),n.e(267641),n.e(652421),n.e(502265),n.e(29311),n.e(8653),n.e(785149),n.e(518733),n.e(552066),n.e(175925)]).then(n.bind(n,420337));return new t(e)})(e))),cE=e=>()=>e.globalServicesCache(sC.MTMAUserDataService,(()=>(async e=>{const{authenticationService:t,coreSettings:n,hostCommunicationService:i,loggerFactory:a,scenarioFactory:o,workerCacheManager:r}=e,{MTMAUserDataService:s}=await Fw(o),l=new s({authenticationService:t,hostCommunicationService:i,loggerFactory:a,workerCacheManager:r,coreSettings:n});return n.get(b.J.CdlWorker).enableMTMAUserDataInMaglevStorage&&await l.startup(),l})(e))),dE=e=>()=>e.globalServicesCache(sC.WebAppSwitcherService,(()=>(async e=>{const{crossTabsService:t,localStorage:n,loggerFactory:i,scenarioFactory:a}=e,{WebAppSwitcherService:o}=await _w(a);return new o(n,i,t)})(e)));var uE=n(213906);class mE{constructor(e,t,n,i){this.coreSettings=t,this.hostCommunicationService=n,this.i18n=i,this.mainAccountId="",this.badgeCounts=new Map,this.presenceCache=new Map,this.getBadge=e=>({icon:{countBadge:{value:e}}}),this.getGlyphBadge=e=>({icon:{glyphBadge:{glyph:e}}}),this.logger=e.newLogger(uE.d5,"services-io-taskbar")}setPresenceForCurrentAccount(e,t){this.logger.log(`Set presence for with accountId: ${e} and presence: ${t.status}`),this.presenceCache.set(e,t.status),0===this.badgeCounts.get(e)&&this.showPresenceForCurrentAccount(e)}async showBadgeForCurrentAccount(e,t){let n=!1;const i=e?this.presenceCache.get(e):A.t.unknown;if(this.enableCoherenceBadgeForWindows&&(this.logger.log(`Show badge for current account event accountId: ${e} with badgeCount: ${t}`),this.badgeCounts.set(e,t),this.mainAccountId&&this.mainAccountId===e)){this.logger.log("Main account badge update");const e=t>9?"9+":t.toString(),a=this.getBadge(t);a.altText=this.i18n.stringTranslate("toastNotifications","taskbar_presence_status_with_count",{count:e,presenceStatus:i}),await this.showBadgeCommand(a),n=!0}return n}async resetBadge(){this.logger.log("Reset badge event"),await this.showBadgeCommand(this.getBadge(0))}async showBadge(e,t){let n=!1;if(this.enableCoherenceBadgeForMac){this.logger.log(`Show badge event with accountId: ${e} and badgeCount: ${t}`),this.badgeCounts.set(e,t);const i=Array.from(this.badgeCounts.values()).reduce(((e,t)=>e+t),0);await this.showBadgeCommand(this.getBadge(i)),n=!0}return n}updateMainAccountId(e){this.logger.log(`Main account id updated event ${e}`),this.mainAccountId=e}switchAccount(e){return this.mainAccountId=e,this.logger.log(`Main account id updated to ${e}`),this.restoreBadge()}async restoreBadge(){const e=this.mainAccountId;await this.restoreBadgeForAccount(e),this.enablePresenceStatusTaskbar&&await this.restorePresenceForAccount(e),this.logger.log(`Taskbar badges restored for account: ${e}`)}async showPresenceForCurrentAccount(e){if(e!==this.mainAccountId)return!1;let t=!1;this.logger.log(`Show presence for current account ${e}`);const n=this.presenceCache.get(e);if(!this.enablePresenceStatusTaskbar)return t;if(n){this.logger.log(`Show presence update event with presence: ${n}`);const e=this.getGlyphBadge(n);e.altText=this.i18n.stringTranslate("toastNotifications","taskbar_presence_status_no_items",{presenceStatus:n}),await this.showBadgeCommand(e),t=!0}else this.logger.log(`No presence available for account ${e}`),await this.resetBadge();return t}async restorePresenceForAccount(e){let t=!1;if(0===(this.badgeCounts.get(e)||0)){const n=this.presenceCache.get(e)||A.t.unknown;this.logger.log(`Restored presence event for account id ${e} with badge presence ${n}`),t=await this.showPresenceForCurrentAccount(e)}return t}async restoreBadgeForAccount(e){const t=this.badgeCounts.get(e)||0;return this.logger.log(`Restored badge event for account id ${e} with badge count ${t}`),this.showBadgeForCurrentAccount(e,t)}get enableTaskbarBadgeMaglev(){return!!this.coreSettings.get(b.J.Core).enableTaskbarBadgeMaglev}get enableCoherenceBadgeForWindows(){return!!this.coreSettings.get(b.J.Notifications).enableCoherenceBadgeForWindows}get enableCoherenceBadgeForMac(){return!!this.coreSettings.get(b.J.Notifications).enableCoherenceBadgeForMac}get enablePresenceStatusTaskbar(){return!!this.coreSettings.get(b.J.Notifications).enablePresenceStatusTaskbar}async showBadgeCommand(e){if(!this.enableTaskbarBadgeMaglev)return void this.logger.log(uE.vc.NotEnabled);const t=await this.hostCommunicationService.loadModule("taskbar");if(t){if(t.showBadge)return this.logger.log(uE.Bd.UpdatedEvent),t.showBadge(e);this.logger.log(uE.vc.MethodNotAvailable)}else this.logger.log(uE.vc.ModuleUnableToLoad)}}const pE=e=>()=>e.globalServicesCache(sC.GlobalTaskbarService,(()=>(async e=>{const{loggerFactory:t,coreSettings:n,hostCommunicationService:i,i18n:a}=e;return new mE(t,n,i,a)})(e))),gE=e=>()=>e.userServicesCache(rC.HealthScenarioService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,localStorage:i}=e,{HealthScenarioService:a}=await Sb(n);return new a(t,i)})(e))),hE=e=>()=>e.userServicesCache(rC.UnifiedConsentService,(()=>(async e=>{const{endpointsManager:t,scenarioFactory:n,authenticationService:i,cacheStorage:a,loggerFactory:o}=e,{UnifiedConsentService:r}=await cw(n);return new r(t,i,a,o)})(e))),yE=(e,t)=>{const{calendarServices:n,chatServices:i,fileServices:a,getAppsStoreService:o,getAsyncMediaService:r,getBotsPlatformService:s,getCallingAppEventsService:l,getCallingBannerService:c,getCallingDialogService:d,getCallingNotificationService:u,getCollabObjectService:m,getConnectedAccountsService:p,getDiscoverSurfaceService:g,getExternalAccountsService:h,getGoogleCalendarAuthenticationService:y,getMeetingRoomAppEventsService:v,getMsaAuthenticationService:f,getSharepointRestClient:S,getSmbUserIntentService:k,getTenantPrivacyProfileService:C,getThirdPartyCalendarService:b,getUserLicenseService:w,getStoreDevicesService:T,getOrganizationInfoService:I,videoMessageServices:N}=(e=>{const t=Rw(e),n=SE(e),i=jw(e),a=Lw(e,n.getChatService),o=kE(e,t,n.getChatService,i),r=CE(e,t),s=Ow(e),l=$w(e),c=Uw(e),d=Bw(e),u=Ww(e,l,c,s),m=Hw(e,l,s),p=bE(e),g=Vw(e),h=Gw(e,g),y=zw(e,g),v=qw(e,g),f=Jw(e),S=Qw(e),k=Kw(e,S),C=Yw(e),b=Xw(e),w=Zw(e),T=eT(e),I=tT(e);return{calendarServices:p,chatServices:n,fileServices:o,getAppsStoreService:nT(e),getAsyncMediaService:t,getBotsPlatformService:a,getCallingAppEventsService:g,getCallingBannerService:h,getCallingDialogService:y,getCallingNotificationService:v,getCollabObjectService:b,getConnectedAccountsService:s,getDiscoverSurfaceService:f,getExternalAccountsService:u,getGoogleCalendarAuthenticationService:l,getMeetingRoomAppEventsService:I,getMsaAuthenticationService:d,getSharepointRestClient:i,getSmbUserIntentService:k,getTeamsCopilotService:iT(e),getTenantPrivacyProfileService:C,getThirdPartyCalendarService:m,getUserLicenseService:S,getStoreDevicesService:w,getOrganizationInfoService:T,videoMessageServices:r}})(e),E={getCallingAppEventsService:l,getCallingBannerService:c,getCallingDialogService:d,getCallingNotificationService:u,getTenantPrivacyProfileService:C,getCalendarService:n.getCalendarService,getMeetingRoomAppEventsService:v},A=((e,t,n)=>async(i,a)=>{const o=a?.scenario;o?.mark(H.ck.GetGlobalCallingService);const r=await n.getGlobalCallingService();return o?.mark(H.ck.GlobalCallingServiceInitAccount),{...await r.initAccount({entryPoint:i,accountCtx:e,deps:t,telemetryContext:a}),dispose:(t,n)=>r.disposeAccount(t,n,e.authenticationUser)}})(e,E,t),_=((e,t,n)=>()=>n.getGlobalCallingService().then((n=>n.deprecated_onAccountInitialized(e,t).then((t=>({...t,dispose:(t,i)=>n.disposeAccount(t,i,e.authenticationUser)}))))))(e,E,t);return{...i,getAiInsightsFeedbackService:aT(e),getAiInsightsSdsService:oT(e),getAppBasedLinkService:rT(e,s),getAppsPlatformService:sT(e),getAppsStoreService:o,getAppSuggestionsService:lT(e),getAsyncMediaService:r,getAugloopService:dT(e),getSubstrateBotPlatformService:uT(e),getComposeAugloopService:dT(e,!0),getAzureMapsService:mT(e),getBadgeCountService:pT(e),getBotsPlatformService:s,getBrbService:gT(e),getBreakoutRoomMiddleTierService:hT(e),getAtpSafelinksService:yT(e),getBroadcastAttendeeService:vT(e),getBroadcastStreamingAttendeeService:fT(e),getBroadcastCaptionsService:ST(e),getBroadcastSignalRService:kT(e),...n,getCallBlockingService:(F=e,()=>F.userServicesCache(rC.CallBlockingService,(()=>wT(F)))),getCallingAnonymousDisplayNameService:NT(e),getCallingAppEventsService:l,getCallingBannerService:c,getCallingDialogService:d,getCallingNotificationService:u,getCallingService:A,deprecated_getCallingServiceOnInitialized:_,getCmdMeetingIntelligenceService:ET(e),getCollabObjectService:m,getCommunitySettingsService:AT(e),getConnectedAccountsService:p,getConnectedCalendarSettingsService:_T(e),getBiometricEnrollmentService:FT(e),getBiometricFaceEnrollmentService:DT(e),getDeveloperSwitchersService:PT(e),getDistributionListService:MT(e),getDynamicsMarketingService:xT(e),getDynamicsVirtualEventsService:RT(e),getEmoticonService:jT(e),getEspService:LT(e),getExampleService:OT(e),getExternalAccountsService:h,getExternalAccountsResponseService:$T(e,p),...a,...N,getFluidService:UT(e),getGalleryService:BT(e),getGiphyService:WT(e),getGoogleCalendarAuthenticationService:y,getGoogleContactsAuthenticationService:Uw(e),getGuardiansService:HT(e),getHealthScenarioService:gE(e),getImageProxyService:VT(e),getImmersiveReaderService:GT(e),getImportMsaContactsService:zT(f,e),getImplicitContactsService:qT(e),getInstantAnswersService:JT(e),getInviteLinksService:QT(e),getLiveStateBroadcastService:KT(e),getLiveStreamRenderingService:YT(e),getLmsIntegrationService:XT(e),getLockedTeamsService:ZT(e),getLogsFilesService:tI(e),getLokiService:nI(e),getManageTenantService:iI(e),getMeetingArtifactsService:aI(e),getMeetingBotService:oI(e,n.getCalendarService,i.getChatService),getMeetingIntelligenceService:rI(e),getMeetingOptionsClientDataService:cI(e),getMeetingOptionsService:dI(e),getMeetingQuestionsAndAnswersService:uI(e),getMeetingRecapService:mI(e),getMeetingRecapSwaService:pI(e),getMeetingRecapWorkingSetFilesService:gI(e),getMeetingRoomAppEventsService:v,getMeetingTemplateService:hI(e),getMsaAuthenticationService:f,getPaymentService:yI(e),getPeoplePickerService:vI(e),getPeopleService:sI(e),getPeopleTargetingService:fI(e),...vE(e,k,w),getPoliciesService:SI(e),getPresenceService:kI(e),...fE(e),getODSLProcessingEngine:wI(e),getAddressService:II(e),getPstnService:EI(e),getSCISService:AI(e),getSearchPrefetchService:_I(e),...wE(e),getSharepointRestClient:S,getShareService:FI(e),getSmbUserIntentService:k,getStoreService:DI(e,T,o),getStoreDevicesService:T,getStyleMyRoomService:PI(e),getTenantMembershipService:MI(e),getTenantService:xI(e),getTenantAnalyticsService:RI(e),getTenantPrivacyProfileService:C,getTranscriptService:jI(e),getTranscriptFeedbackService:LI(e),getTranscriptSettingsStoreService:OI(e),getTranslateService:$I(e),getTargetingHierarchyService:UI(e),getThirdPartyCalendarService:b,getToastImageService:BI(e),getTeamsAndChannelsService:HI(e),getTeamsCopilotService:iT(e),getTpnNoticeService:VI(e),getUrlPreviewService:GI(e,a.getFilesReferenceService),getUserPreferencesStore:zI(e),getUserProfileService:qI(e),getVirtualEventsService:JI(e),getMeetingSchedulingService:QI(e),getVoicemailService:XI(e),getWebinarService:ZI(e),getCallRecordingService:eN(e),getUserLicenseService:w,getDiscoverSurfaceService:g,getMonetizationService:tN(e),getMRUItemService:nN(e),getDiscoverSurfaceFeedbackService:iN(e,g),getCollabCloudService:aN(e),getTFLUserService:oN(e),getSensitivityLabelPolicySettingsService:rN(e),getWaffleService:sN(e),getOrganizationInfoService:I,getVideoMessageCameraCommandService:lN(e)};var F},vE=(e,t,n)=>{const i=cN(e,t,n);return{getPetrolService:i,getFloodgateService:dN(e,i),getOdsService:uN(e,t,n)}},fE=e=>({getLokiMetaPreviewService:mN(e),getOdcFilePreviewService:pN(e),getOSearchService:gN(e),getPeopleSearchService:hN(e),getSubstrateFilesSearchService:yN(e),getSubstrateRecommendationsService:vN(e),getSubstrateSearchService:fN(e),getSubstrateSuggestionsService:SN(e),getSubstrateMeetingSearchService:kN(e),getSubstrateMeetingSummarySearchService:CN(e)}),SE=e=>{const t=bN(e),n=wN(e,t),i=TN(e),a=IN(e),o=NN(e);return{getChatService:t,getChatServiceEndpointProvider:n,getConsumerGroupsService:i,getCSAService:a,getReportConcernService:EN(e),getStatefulLongPoll:o,getUnifiedConsentService:hE(e),getCallingConversationService:AN(e)}},kE=(e,t,n,i)=>{const a=_N(e,i),o=FN(e,i),r=DN(a,o,e);return{getFilesRedeemService:o,getFilesReferenceService:PN(r,e),getFilesSharepointUrlService:r,getFileUploadPreviewService:MN(e,t),getFileUploadService:xN(e,i),getFileDownloadManagerService:RN(e),getPersonalFileDetailsService:jN(e,n),getRefreshSiteUrlService:(s=e,()=>s.userServicesCache(rC.RefreshSiteUrlService,(()=>LN(s)))),getCloudStorageFoldersService:$N(e),getFilesBackfillThreadPropertiesService:UN(e),getSharepointShareService:a,getItemUploadService:qN(e),getItemDeleteService:JN(e),getItemDetailsService:QN(e),getDriveItemShareService:KN(e),getVideoFileService:YN(e,i),getFilesValidDomainsService:XN(e),getFilesSiteResourceInfoService:ZN(e)};var s},CE=(e,t)=>({getVideoMessageUploadService:eE(e,t)}),bE=e=>({getCalendarService:tE(e),getExternalCalendarEmailAddressService:nE(e),getTeamCalendarService:iE(e),getMeetingRecommendationsService:aE(e)}),wE=e=>({getCommonSubstrateService:oE(e),getSignalsService:rE(e)});function TE(e){const t=(n={globalServicesCache:oC,...e},{getExampleGlobalService:sE(n),getGlobalCallingService:lE(n),getLogsFilesService:(i=n,()=>i.globalServicesCache(rC.LogsFilesService,(()=>eI(i)))),getGlobalMTMAUserDataService:cE(n),getGlobalWebAppSwitcherService:dE(n),getGlobalTaskbarService:pE(n)});var n,i;return{entityType:"unknown",windowId:"",...e,...t}}class IE{static createGlobalDataRequestContext(e){if(IE._globalRequestContext)throw new Error("GlobalDataRequestContext is already created!");return IE._globalRequestContext=TE(e),IE._globalRequestContext}static createUserDataRequestContext(e,t){if(!IE._globalRequestContext)throw new Error("GlobalDataRequestContext has not been created!");return function(e,t,n){const i={...e,userServicesCache:(new iC).getOrCreateServiceInstance},{appsRegistryService:a,appStateService:o,authenticationService:r,authenticationUser:s,authStateProvider:l,cacheStorage:c,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:p,discover:g,experienceChangeReportingService:h,hostCommunicationService:y,localStorage:v,loggerFactory:f,offlineCacheManager:S,platformService:k,pubsub:C,rebootService:b,scenarioFactory:w,userBiService:T,windowProvider:I,i18n:N,brbServiceManager:E,entityCommanding:A,userTrackingService:_,mediaAuthService:F}=e;return{...t,appsRegistryService:a,appStateService:o,authenticationUser:s,authenticationService:r,authStateProvider:l,cacheStorage:c,clientPreferences:d,clientState:u,commandChangeReportingService:m,coreSettings:p,discover:g,entityType:"unknown",experienceChangeReportingService:h,hostCommunicationService:y,localStorage:v,loggerFactory:f,mediaAuthService:F,offlineCacheManager:S,platformService:k,pubsub:C,rebootService:b,scenarioFactory:w,userBiService:T,windowId:"",windowProvider:I,i18n:N,brbServiceManager:E,entityCommanding:A,userTrackingService:_,...yE({...i,cmdApolloClient:n},t)}}(e,IE._globalRequestContext,t)}static get globalRequestContext(){return IE._globalRequestContext}}var NE=n(581329);async function EE(e,t,i){if(e.config.enableEmbedDataClient)return async function(e,t,n,{resolvers:i}={}){const{dataEvictionService:a,platformService:o,coreSettings:r,config:s}=e,{enableApolloDevtools:l}=r.get(b.J.Diagnostics),c=new qg.pS,{defaultContext:d,link:u}=await RE(e,n,c,{UNSAFE_resolvers:i}),m=d.leakDetectorService?.create(),p=_E(e,c,m,u,d.loggerFactory,d.scenarioFactory),g=p({windowId:h.ew,entityType:n,viewportContext:e.windowProvider.viewportContext,name:"embed",storeType:Jg.t.embed});return oh(g,"embed",Boolean(l),o,s.experienceName),new fh({pubsub:c,leakDetector:m,scenarioFactory:d.scenarioFactory,coreSettings:d.coreSettings,dataOpsTracker:t,dataEvictionService:jE(a)?a:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},g,d)}(e,t,i,{resolvers:[NE.s]});const{enableMTMA:a}=e.coreSettings.get(b.J.Core);return a?async function(e,t,i,{resolvers:a}={}){const{coreSettings:o,dataEvictionService:r}=e,s=new qg.pS,{defaultContext:l,link:c}=await RE(e,i,s,{noCDLTerminatingLink:!0,UNSAFE_resolvers:a}),d=l.leakDetectorService?.create(),u=_E(e,s,d,c,l.loggerFactory,l.scenarioFactory),{enableApolloDataEviction:m,enableViewSchema:p,enableRelay:g,enableRelayLiveResolverStore:h,relayGCReleaseBufferSize:y}=o.get(b.J.Core);let v,f;p&&(v=DE(e,s,d,ty.createViewSchemaLink(e),l.loggerFactory,l.scenarioFactory));if(g){const{createRelayEnvironment:t}=n(390009);f=await t({isLiveResolverEnabled:!0===h,link:c,loggerFactory:l.loggerFactory,userBiService:l.userBiService,leakDetectorOptions:{leakDetector:d,entityType:i},configName:"mtma-core",gcReleaseBufferSize:y,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService,host:e.windowProvider})}return new tC({pubsub:s,leakDetector:d,scenarioFactory:l.scenarioFactory,coreSettings:l.coreSettings,dataOpsTracker:m?t:void 0,dataEvictionService:m&&jE(r)?r:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},u,l,v,f)}(e,t,i,{resolvers:[NE.s]}):AE(e,t,i,{resolvers:[NE.s]})}async function AE(e,t,i,{resolvers:a}={}){const{coreSettings:o,dataEvictionService:r}=e,s=new qg.pS,{defaultContext:l,link:c}=await RE(e,i,s,{UNSAFE_resolvers:a}),d=l.leakDetectorService?.create(),u=_E(e,s,d,c,l.loggerFactory,l.scenarioFactory),{enableApolloDataEviction:m,enableViewSchema:p,enableRelay:g,enableRelayLiveResolverStore:h,relayGCReleaseBufferSize:y}=o.get(b.J.Core);let v,f;if(p&&(v=DE(e,s,d,ty.createViewSchemaLink(e),l.loggerFactory,l.scenarioFactory)),g){const{createRelayEnvironment:t}=n(390009);f=await t({isLiveResolverEnabled:!0===h,link:c,loggerFactory:l.loggerFactory,userBiService:l.userBiService,leakDetectorOptions:{leakDetector:d,entityType:i},configName:"core",gcReleaseBufferSize:y,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService,host:e.windowProvider})}return new vh({pubsub:s,leakDetector:d,scenarioFactory:l.scenarioFactory,coreSettings:l.coreSettings,dataOpsTracker:m?t:void 0,dataEvictionService:m&&jE(r)?r:void 0,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},u,l,v,f)}function _E(e,t,n,i,a,o,r,s){const{appsRegistryService:l,coreSettings:c,platformService:d,config:u,graphqlStoreStatsReporterService:m}=e;let p;p=r||Zk.create(t);const{maxApolloResultCacheSize:g,enableApolloDoubleWriteFix:h}=c.get(b.J.Core),{enableApolloDevtools:y}=c.get(b.J.Diagnostics),v=g??void 0;return({windowId:e,entityType:t,viewportContext:r,name:c,overrideLink:g,storeType:f})=>{const S=l.getRegisteredAppsTypePolicies(e),k=FE({leakDetector:n,windowId:e,entityType:t,viewportContext:r,userContextId:s},g||i,p,v,a,o,S,y,f,m,h);return oh(k,c,Boolean(y),d,u.experienceName),k}}const FE=(e,t,n,i,a,o,r,s,l,c,d)=>{const u=(0,Xg.aw)({typePolicies:my(r?.typePolicies),possibleTypes:Kg,dataIdFromObject:Qg.X,resultCacheMaxSize:i,apolloLeakOptions:e,loggerFactory:a,scenarioFactory:o,storeType:l,graphqlStoreStatsReporterService:c,enableApolloDoubleWriteFix:d,enableGlobalObjectIdStoreKeys:!0}),m=(0,Xg.nl)({cache:u,link:t,resolvers:n,defaultOptions:{watchQuery:{nextFetchPolicy:py}},apolloLeakOptions:e,loggerFactory:a,enableApolloDevtools:s,storeType:l,graphqlStoreStatsReporterService:c,notifyOnTeardown:!1,enableApolloDoubleWriteFix:d});return Eh(u,a,r?.defaultTypeName),m};function DE(e,t,n,i,a,o){const{coreSettings:r,platformService:s,config:l,graphqlStoreStatsReporterService:c}=e,{maxApolloResultCacheSize:d,enableApolloDoubleWriteFix:u}=r.get(b.J.Core),{enableApolloDevtools:m}=r.get(b.J.Diagnostics),p=d??void 0;return({windowId:e,entityType:t,viewportContext:r,name:d,overrideLink:g,storeType:h})=>{const y=PE({leakDetector:n,windowId:e,entityType:t,viewportContext:r},g||i,{},p,a,o,h,c,u);return oh(y,d,Boolean(m),s,l.experienceName),y}}const PE=(e,t,n,i,a,o,r,s,l)=>{const c=(0,Xg.aw)({typePolicies:{PresenceAvailability:{merge:!0},PresenceOutOfOfficeStatus:{merge:!0},PresenceStatusNote:{merge:!0},ViewData:{merge:!0}},possibleTypes:Yg.g,dataIdFromObject:Qg.X,resultCacheMaxSize:i,apolloLeakOptions:e,loggerFactory:a,scenarioFactory:o,storeType:r,graphqlStoreStatsReporterService:s,enableGlobalObjectIdStoreKeys:!1});return(0,Xg.nl)({cache:c,link:t,resolvers:n,defaultOptions:{watchQuery:{nextFetchPolicy:py}},apolloLeakOptions:e,loggerFactory:a,storeType:r,graphqlStoreStatsReporterService:s,enableApolloDoubleWriteFix:l})},ME=(e,t,n)=>{const{activeWindowsService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,cdlAppStateService:s,authenticationService:l,authenticationUser:c,cacheStorage:d,clientPreferences:u,clientState:m,commandChangeReportingService:p,coreSettings:g,discover:y,dataEvictionService:v,experienceChangeReportingService:f,hostCommunicationService:S,leakDetectorService:k,localStorage:C,loggerFactory:b,notificationsHandler:w,offlineCacheManager:T,platformService:I,rebootService:N,scenarioFactory:E,userBiService:A,windowProvider:_,i18n:F,brbServiceManager:D,entityCommanding:P,userTrackingService:M}=e;return{activeWindowsService:i,appsRegistryService:a,appStateService:o,appSwitcherPolicyCheckService:r,cdlAppStateService:s,authenticationService:l,authenticationUser:c,cacheStorage:d,clientPreferences:u,clientState:m,commandChangeReportingService:p,coreSettings:g,discover:y,dataEvictionService:v,entityType:n,experienceChangeReportingService:f,hostCommunicationService:S,leakDetectorService:k,localStorage:C,loggerFactory:b,notificationsHandler:w,offlineCacheManager:T,platformService:I,pubsub:t,rebootService:N,scenarioFactory:E,userBiService:A,windowId:h.ew,windowProvider:_,i18n:F,brbServiceManager:D,entityCommanding:P,userTrackingService:M}},xE=(e,t)=>{const n=(0,Zg.v)(((t,n)=>({...e,...n})));return eh.i.from([n,t])};async function RE(e,t,n,{noCDLTerminatingLink:i,UNSAFE_resolvers:a}={}){const{networkState:o}=e,r=(0,Gl.UZ)(cl.l,o.observeIsOnline()),s={...e,pubsub:n,send:r},l=IE.createGlobalDataRequestContext(s),c=await ty.createSingletonLink({contextValue:l,noCDLTerminatingLink:i,UNSAFE_resolvers:a,...s});return{defaultContext:ME(e,n,t),link:c}}function jE(e){if(!e)return!1;const t=e;return"function"==typeof t.register&&"function"==typeof t.unregister}class LE extends _e{constructor(){super(h.Yg.CreateDataClient,["scenarioFactory","loggerFactory","windowProvider","coreSettings","platformService"])}async execute(e){const{scenarioFactory:t,loggerFactory:n,windowProvider:i,coreSettings:a,platformService:o}=e,{enableApolloDataEviction:r,disableApolloMissingChatMessageFix:s,maxApolloCacheOperationCount:l}=e.coreSettings.get(b.J.Core);(0,wg.x)({disableApolloMissingChatMessageFix:s??!1});const c=new Gg({activeOperationLimit:l});e.dataCleanupService=c,r&&(e.dataEvictionService=new zg(c,t,n,i));const d=await EE({...e,pulsar:this.createDataClientPulsarInstance(a,n,o)},c,"default");e.client=d}createDataClientPulsarInstance(e,t,n){const{enablePulsarTelemetry:i,logToOTLCollector:a}=e.get(b.J.Pulsar),o=new ho(co.TEAMS_RESOLVER,{sessionId:n.host.sessionId,spanExporter:new yo,loggerFactory:t,logToOTLCollector:!!a});return i&&o.initialize(),o}}var OE=n(723478),$E=n(634007),UE=n(75716);const BE={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeWindow"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeWindow"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},WE={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isMainWindow"}}]}}]}}]};var HE,VE,GE,zE;function qE(e,t){return(0,gn.Ee)(e.host,t)}function JE(e,t){return!!e&&(0,gn.Ee)(e,t)!==(0,gn.NH)(t)}async function QE({coreSettings:e,logger:t,userContextId:n,waitForRenderingContextReady:i}){const a=!!e?.get(b.J.Auth)?.enableIntegratedAuthApp;return t.log(`getUserContext(${n})`),i(a,n)}async function KE(e){const{coreSettings:t,correlation:n,logger:i,waitForRenderingContextReady:a}=e,o=await QE({coreSettings:t,logger:i,waitForRenderingContextReady:a}),r=await async function(e,t,n){try{return await e.getUser({correlation:{id:t.id,scenarioName:t.scenarioName,source:t.source},accountId:n})}catch{return}}(o.authenticationService,n),s=r?.id;return i.log(`getMainWindowUserId returns ${s}`),s}async function YE(e){const{commandChangeReportingService:t,correlation:n,userContextId:i,userContextAccountType:a}=e,o=e=>t.report({type:e,correlationId:n.id,context:{target:"get-deeplink-user-context",eventData:{commandSource:n.source,deeplinkGetUserContextAccountType:zE[a],deeplinkGetUserContextId:i,scenarioPhase:"Core"}}});try{o(dt.B.WaitForUserContextStarted);const t=await QE(e);return o(dt.B.WaitForUserContextCompleted),{context:{client:t.client},userContextId:i,userContextAccountType:a}}catch(e){return void t.report({type:dt.B.WaitForUserContextFailed,correlationId:n.id,context:{target:"get-deeplink-user-context",errorInfo:ct.y.CreateUserContextError,eventData:{commandSource:n.source,deeplinkGetUserContextAccountType:zE[a],deeplinkGetUserContextId:i,scenarioPhase:"Core",errors:e instanceof Ee.G&&Ee.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():`${e}`}}})}}!function(e){e[e.Other=1]="Other",e[e.Main=2]="Main",e[e.Flyout=3]="Flyout",e[e.Minimode=4]="Minimode"}(HE||(HE={})),function(e){e.MatchingPendingIntentFound="MatchingPendingIntentFound",e.IntentOverriddenByOnBeforeAuth="IntentOverriddenByOnBeforeAuth",e.IntentOverriddenByOnAfterAuth="IntentOverriddenByOnAfterAuth"}(VE||(VE={})),function(e){e[e.NoOverride=0]="NoOverride",e[e.OverrideCloud=1]="OverrideCloud",e[e.OverrideIntent=2]="OverrideIntent",e[e.OverrideUserContext=3]="OverrideUserContext",e[e.TerminateNavigation=4]="TerminateNavigation"}(GE||(GE={})),function(e){e[e.MainWindow=0]="MainWindow",e[e.SourceWindow=1]="SourceWindow",e[e.Other=2]="Other"}(zE||(zE={}));async function XE(e,t,n,i,a,o){const{id:r,source:s}=a;t.report({type:dt.B.IntentExecuted,correlationId:r,context:{target:"launch-cloud",eventData:{commandSource:s,scenarioPhase:"Core"}}});try{const a=await i.loadModule("core");if(!a?.launchCloud)throw Error("launchCloud not implemented in auth module");await a.launchCloud({cloudType:e,deepLink:n,userContextId:o,correlation:{id:r,source:s}}),t.report({type:dt.B.IntentTransferredCrossCloud,correlationId:r,context:{target:"launch-cloud",eventData:{commandSource:s,scenarioPhase:"Core"}}})}catch(e){const n=new Me.G(Me.$.LAUNCH_CLOUD_DEEPLINK_ERROR,e);throw t.report({type:dt.B.Failure,correlationId:r,context:{target:"launch-cloud",errorInfo:ct.y.DeeplinkLaunchCrossCloudError,eventData:{commandSource:s,scenarioPhase:"Core",errorCode:n.toTelemetryEntry()}}}),n}}const ZE={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeAuthenticatedUser"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}}}]}]}}]},eA="intent-service";async function tA(e,t,n,i,a,o,r=!1){const{enableHandlingDeeplinkExtensionCommandsInCoreLayoutApp:s}=a.get(b.J.Core,["enableHandlingDeeplinkExtensionCommandsInCoreLayoutApp"]);i.log(`Executing Intent in windowId: ${o}`);const l=function(e,t){if(t){const n=(0,W.cloneDeep)(e.entityCommand);return n.command.stateTransition=n.command.stateTransition===ke.su.extend?ke.su.extend:ke.su.flush,n.command.__UNSAFE_windowId=t,n}return e.entityCommand}(n,o);if(l.entity.type===Se.py.default){const e=l.entity.action===Se.uk.view||r,i=l.command?.correlation.id?l.command?.correlation:void 0;return void await t.execute({command:Nt.CN.defaultCommand({forceTransition:e,windowId:l.command?.__UNSAFE_windowId,clientLaunchId:n.scenarioCorrelation.clientLaunchId,layoutMode:l.command?.layoutMode,shouldShowWithoutFocus:l.command?.visibilityState===ke.fe.showWithoutFocusing,userContextId:n.metadata.userContextId}),correlation:i})}if(s&&l.command?.stateTransition===ke.su.extend){const e=l.command?.correlation.id?l.command?.correlation:void 0;return void await t.execute({command:Nt.CN.openCoreDialog({correlation:e,entity:{...l.entity,options:JSON.stringify(l.entityOptions)||null,id:l.entity.id||void 0},targetWindow:l.command?.targetWindow?{name:"main",id:l.command?.__UNSAFE_windowId,layoutMode:l.command?.layoutMode}:void 0}),correlation:e})}const c=await e(l,n.scenarioCorrelation.clientLaunchId);return i.log(`Command execution happened in windowId: ${c}`),c}function nA(e,t,n,i,a){return{shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:Bn({entity:n,entityOptions:a,command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush,layoutMode:i,correlation:t.correlation}}),metadata:{allowAnonymous:!1,deepLink:e},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}}}function iA(e){const t=e.entityCommand.entity.type,n=e.entityCommand.command.layoutMode;return n===ke.lO.minimode?HE.Minimode:t===Se.py.flyout||n===ke.lO.minimal?HE.Flyout:n===ke.lO.focus?HE.Other:HE.Main}async function aA({commandChangeReportingService:e,commandHandler:t,coreSettings:n,delegatedCommanding:i,error:a,errorInfo:o,errorMessage:r,fallbackError:s,intent:l,logger:c,newCommandType:d,windowId:u}){if(c.errorToTelemetry?.(r,"webclient_framework_foundation_core_services_intent"),e.report({type:d,correlationId:l.scenarioCorrelation.correlation.id,context:{target:eA,errorInfo:o,eventData:{errors:a instanceof Ee.G&&Ee.G.isFunction(a.toTelemetryEntry)?a.toTelemetryEntry():`${a}`}}}),l.shouldRenderContent)return async function(e,t,n,i,a,o,r,s){let l;try{if(!(i instanceof Ee.G))throw i;l=i.serialize()}catch(e){t.errorToTelemetry?.(`Failed to serialize error: ${e}`,"webclient_framework_foundation_core_services_intent"),l=s?.serialize()}return tA(e,r,{...a,entityCommand:{entity:{type:Se.py.error,action:Se.uk.view},entityOptions:{serializedError:l},command:{...a.entityCommand.command,layoutMode:ke.lO.focus}}},t,n,o)}(t,c,n,a,l,u,i,s)}var oA;function rA(e,t){const n=Se.py.identity;let i=e.entityCommand.command;return t===ke.fe.show?i={visibilityState:ke.fe.show,stateTransition:ke.su.new,layoutMode:ke.lO.focus,correlation:e.scenarioCorrelation.correlation}:t===ke.fe.hide&&(i={visibilityState:ke.fe.hide,stateTransition:ke.su.flush,layoutMode:ke.lO.focus,correlation:e.scenarioCorrelation.correlation}),{shouldRenderContent:!0,scenarioCorrelation:e.scenarioCorrelation,entityCommand:{command:i,entity:{type:n,action:Se.uk.loading},entityOptions:{tenantId:e.metadata.tenantId}},metadata:e.metadata}}!function(e){e[e.pending=0]="pending",e[e.fulfilled=1]="fulfilled",e[e.rejected=2]="rejected"}(oA||(oA={}));const sA=(e,t)=>{const n=t?.get(b.J.Auth)?.enableLoadingScreenInMeetings??!1,i=t?.get(b.J.Auth)?.enableMTO??!1;return!e.shouldRenderContent||!(n&&i)||e.scenarioCorrelation.correlation.source===C.D.ExternalCommand||!(e.entityCommand.entity.type===Se.py.meetings||e.entityCommand.entity.type===Se.py.callingdeeplink||e.entityCommand.entity.type===Se.py.channels)};function lA(e){const t=(0,W.cloneDeep)((0,W.omit)(e,["options"]));return e.shouldRenderContent?{...t,metadata:(0,W.omit)(t.metadata,["shouldTargetSourceWindow"])}:t}async function cA(e,t,n,i,a){let o,r,s;switch(i){case"onBeforeIntentAuthenticated":o=await(n.onBeforeIntentAuthenticated?.execute(a));break;case"onAfterIntentAuthenticated":o=await(n.onAfterIntentAuthenticated?.execute(a));break;default:{const e=`evaluateHook(${i}): Unknown hook and options.`;throw t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}}if(!o){const e=`evaluateHook(${i}): Undefined app hook response.`;throw t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}switch(o.overrideType){case GE.NoOverride:s=!1,r=a.intent;break;case GE.OverrideCloud:s=!0,r={...a.intent,metadata:{...a.intent.metadata,cloud:o.cloud}};break;case GE.OverrideIntent:s=!0,r=o.intent;break;case GE.OverrideUserContext:s=!1,r={...a.intent,metadata:{...a.intent.metadata,userContextId:o.userContextId}};break;case GE.TerminateNavigation:s=!0,r=void 0;break;default:const e=`evaluateHook(${i}): Invalid app hook override type.`;throw t.errorToTelemetry?.(e,"webclient_framework_foundation_core_services_intent",void 0,!0),new Error(e)}if(e.report({correlationId:a.intent.scenarioCorrelation.correlation.id,type:dt.B.IntentHookResolved,context:{target:eA}}),r&&a.intent.shouldRenderContent!==r.shouldRenderContent)throw new Me.G(Me.$.INVALID_INTENT_OVERRIDE);return{intentOverridenByHook:s,intent:r}}var dA=n(485510);const uA=async(e,t,n,i,a,o,r)=>{const s={};s["Foundation.deeplinkWindowTarget"]=(e=>{const t=e.entityCommand.command,{stateTransition:n,layoutMode:i,targetWindow:a}=t;switch(i){case ke.lO.minimal:return"flyout";case ke.lO.minimode:return"minimode";default:return n===ke.su.new?"child":n===ke.su.flush||n===ke.su.forceFlush||a===ke.PH.main?"main":void 0}})(e),s["Foundation.accountType"]=await(async(e,t,n,i,a)=>{const o=await KE({coreSettings:n,logger:i,waitForRenderingContextReady:a,correlation:e.scenarioCorrelation.correlation});return o?t&&e.metadata.userContextId?e.metadata.userContextId===o?"main":"background":"unknown":"preauth"})(e,t,n,i,a);const l=o.getApp({entityType:e.entityCommand.entity.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:n,entity:e.entityCommand.entity})||!1;s["Foundation.isUserPreferenceOverriddenByApp"]=!l,r.recordPanelAction({actionGesture:dA.uS.auto,actionOutcome:dA.$K.open,actionScenario:dA.Tk.deeplink,actionScenarioType:dA.Yu.deeplink,moduleType:dA.PO.intent,moduleName:dA.rA.intentService,dataBag:{id:"",data:{...s},dispose:()=>{}},mainEntityType:e.entityCommand.entity.type,mainEntityAction:e.entityCommand.entity.action},i)},mA="intent-service",pA="none";class gA{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p){this.appsRegistryService=t,this.coreSettings=n,this.commandHandler=i,this.client=a,this.waitForRenderingContextReady=o,this.commandChangeReportingService=r,this.experienceChangeReportingService=s,this.scenarioFactory=l,this.hostComms=c,this.host=d,this.activeWindowsService=u,this.userBiService=m,this.delegatedCommanding=p,this.pendingIntentMap=new Map,this.logger=e.newLogger("IntentService","core-services-deeplink"),u.enableDecoupleCommandingFromApollo?this.observeActiveWindows():this.observeActiveWindowsDeprecated(),this.hasCreatedNonMainWindow=!1}async execute(e,t){this.logInternal("execute: Original intent:",e);let n,i,a=e.shouldRenderContent&&e.metadata.shouldTargetSourceWindow?e.options?.sourceWindowId:void 0;if(e.shouldRenderContent){i=iA(e),await this.cleanupActiveWindowsIfNeeded(i);const t=this.pendingIntentMap.get(i);t&&(a=t.windowId,n=VE.MatchingPendingIntentFound,this.logInternal(`execute: Replacing intent for window id: ${a} with layout type ${i}:`,e)),this.pendingIntentMap.set(i,{intent:(0,W.cloneDeep)(e),windowId:a})}this.logInternal("execute: Intent for evaluation:",e),this.commandChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:dt.B.IntentReceived,context:{target:mA,eventData:{mainEntityType:e.shouldRenderContent?e.entityCommand.entity.type:pA,mainEntityAction:e.shouldRenderContent?e.entityCommand.entity.action:pA,errorCode:n}}}),e=function(e,t){const{coreSettings:n,appsRegistryService:i}=t,{enableMinimodeWindow:a}=n.get(b.J.Core);a&&e.shouldRenderContent&&!e.options?.shouldSkipMinimodeOverride&&e.entityCommand.command.stateTransition!==ke.su.extend&&e.entityCommand.command.stateTransition!==ke.su.none&&"com.microsoft.teams.chat"===i.getApp({entityType:e.entityCommand.entity.type})?.manifest.id&&(e.entityCommand.command.layoutMode=ke.lO.minimode);return e}(e,{coreSettings:this.coreSettings,appsRegistryService:this.appsRegistryService});const{intentExecuted:o,targetWindowId:r,errorEncountered:s}=await this.executeInternal(e,a);if(s||await(t?.()),e.shouldRenderContent&&i)o?(this.logger.log("execute: Intent was not overriden and executed. Removing from state."),this.pendingIntentMap.delete(i)):(this.pendingIntentMap.set(i,{intent:(0,W.cloneDeep)(e),windowId:r}),this.logInternal(`execute: updated window ID: ${r}: For pending intent:`,e)),e.options?.isFromDeeplink&&await this.sendDeeplinkUserBi(e,o);else if(!e.shouldRenderContent){const t=this.scenarioFactory.findScenario(H.RG.ApplicationLaunchTime);t?.stop({mainEntityType:pA,reason:"nrc_background_launch"}),this.commandChangeReportingService.report({type:dt.B.Blanked,correlationId:e.scenarioCorrelation.correlation.id,context:{target:"intent-service",eventData:{systemInitiated:!0,mainEntityType:pA}}})}this.experienceChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:gt.yU.NavigationIntentExecuted,context:{target:"intent-service",shouldRenderContent:e.shouldRenderContent}})}async checkForPendingIntent(e,t){for(const[n,{intent:i,windowId:a}]of Array.from(this.pendingIntentMap)){const o=(0,W.cloneDeep)(i);if(o){this.commandChangeReportingService.report({correlationId:e.id,type:dt.B.IntentReceived,context:{target:mA,eventData:{mainEntityType:o.entityCommand.entity.type,mainEntityAction:o.entityCommand.entity.action}}}),o.entityCommand.command.visibilityState=ke.fe.showWithoutFocusing,o.metadata.userContextId=t,o.entityCommand.command.correlation=e,o.scenarioCorrelation.correlation=e,this.logInternal("checkForPendingIntent: Executing pending intent:",o);const{intentExecuted:i}=await this.executeInternal(o,a,!0);i&&(this.logger.log("checkForPendingIntent: Intent was not overriden and executed. Removing from state."),this.pendingIntentMap.delete(n))}}}async switchAccount(e,t,n,i,a){return this.logger.log("switchAccount"),this.execute({shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:Bn({entity:n,entityOptions:a,command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush,layoutMode:ke.lO.standard,correlation:t.correlation}}),metadata:{allowAnonymous:!1,deepLink:e,userContextId:i},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}})}async launchMainApp(e,t,n,i){this.logger.log("launchMainApp"),await this.execute(nA(e,t,n,ke.lO.standard,i))}async launchMinimode(e,t,n){this.logger.log("launchMinimode"),await this.execute(nA(e,t,n,ke.lO.minimode))}async prewarmFlyout(e,t=!1){this.logger.log("prewarmFlyout"),await this.execute({shouldRenderContent:!0,scenarioCorrelation:e,entityCommand:Bn({entity:{type:Se.py.default,action:Se.uk.default},command:{visibilityState:ke.fe.showWithoutFocusing,stateTransition:ke.su.flush,layoutMode:t?ke.lO.minimode:ke.lO.minimal,correlation:e.correlation}}),metadata:{allowAnonymous:!1,deepLink:Fr.n0.flyout},options:{shouldSkipOverridingWindowing:!0,shouldSkipMinimodeOverride:!0}})}async cleanupActiveWindowsIfNeeded(e){try{switch(e){case HE.Other:const e=this.pendingIntentMap.get(HE.Main);e&&(this.logger.log(`Closing main window with id=${e.windowId}.`),await this.client.mutate({mutation:BE,variables:{windowId:e.windowId}}));case HE.Main:const t=this.pendingIntentMap.get(HE.Other);t&&(this.logger.log(`Closing other window with id=${t.windowId}.`),await this.client.mutate({mutation:BE,variables:{windowId:t.windowId}}))}}catch(t){this.logger.warn(`cleanupActiveWindowsIfNeeded: Failed to remove window of type ${e}: ${t.message}`)}}async observeActiveWindows(){this.activeWindowsService.getActiveWindowsObservable().subscribe(this.handleNewActiveWindows.bind(this))}async observeActiveWindowsDeprecated(){this.client.watchQuery({query:WE}).subscribe((async e=>{if(!e.loading&&!e.errors){const{data:{activeWindows:t}}=e;this.handleNewActiveWindows(t)}}))}async handleNewActiveWindows(e){if(this.coreSettings?.get(b.J.Core)?.enableAnonymousCallerSignout){const n=(e=>e.some((e=>!e.isMainWindow)))(e);if(this.hasCreatedNonMainWindow){const e=await QE({coreSettings:this.coreSettings,logger:this.logger,waitForRenderingContextReady:this.waitForRenderingContextReady});await(async(e,t,n)=>{if(!e&&n){const e={id:(0,vl.pW)(),source:"intent-service",scenarioName:H.RG.AuthWebLogout};await t.mutate({mutation:ZE,variables:{reason:"AnonymousSessionEnd"},context:{correlation:e}})}})(n,this.client,(t=e,t?.authenticationUser?.type===ys.Ch.Anonymous))}else this.hasCreatedNonMainWindow=n}var t;this.checkAndCleanupIfWindowRemoved(e.map((e=>e.id)))}checkAndCleanupIfWindowRemoved(e){for(const[t,{intent:n,windowId:i}]of Array.from(this.pendingIntentMap))i&&!e.find((e=>e===i))&&(this.logInternal(`checkAndCleanupIfWindowRemoved: window id: ${i} no longer exists, removing intent:`,n),this.pendingIntentMap.delete(t))}async handleIntentOverriddenByHook(e,t,n){return this.logger.log("executeInternal: Intent overriden by onBeforeIntentAuthenticated."),t?(this.logger.log("executeInternal: overridden to target cloud. LaunchCloud and return early."),await XE(t,this.commandChangeReportingService,e.metadata.deepLink,this.hostComms,e.scenarioCorrelation.correlation,e.metadata.userContextId),{intentExecuted:!0,targetWindowId:n}):{intentExecuted:!1,targetWindowId:n}}async executeInternal(e,t,n){const i=await this.executeOnCrossCloudMeeting(e,t);if(i)return i;let a=this.commandHandler,o=this.delegatedCommanding;this.logInternal(`executeInternal: windowId: ${t}: Original intent:`,e);const{intentOverridenByHook:r,newTargetWindowId:s,errorCode:l,targetCloud:c,targetUserContextId:d}=await this.evaluateOnBeforeIntentAuthHook(e,a,o,t);let u,m,p=l;if(r)return this.handleIntentOverriddenByHook(e,c,s);if(e.metadata.userContextId!==d&&(this.logger.log("executeInternal: userContextId overriden by onBeforeIntentAuthenticated."),e.metadata.userContextId=d),!e.shouldRenderContent&&!e.metadata.userContextId)return this.logger.log("executeInternal: userContextId is still undefined. Returning early."),{intentExecuted:!1,targetWindowId:s};this.commandChangeReportingService.report({type:dt.B.WaitForUserContextStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:mA}});try{u=await QE({coreSettings:this.coreSettings,logger:this.logger,userContextId:e.metadata.userContextId,waitForRenderingContextReady:this.waitForRenderingContextReady})}catch(n){return{intentExecuted:!0,targetWindowId:await aA({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:new Me.G(Me.$.CREATE_USER_CONTEXT_FAILED_GENERIC,n,e.metadata.userContextId),errorInfo:ct.y.CreateUserContextError,errorMessage:`getUserContext(${e.metadata.userContextId}) failed, executing original intent ${n}.`,fallbackError:new Me.G(Me.$.CREATE_USER_CONTEXT_FAILED_GENERIC,void 0,e.metadata.userContextId),intent:e,logger:this.logger,newCommandType:dt.B.WaitForUserContextFailed,windowId:t,delegatedCommanding:this.delegatedCommanding,coreSettings:this.coreSettings}),errorEncountered:!0}}if(this.commandChangeReportingService.report({type:dt.B.WaitForUserContextCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:mA}}),u?.authenticationUser){const n=u;a=(e,t)=>Vn({...n,entityCommandInput:e,clientLaunchId:t,executionContext:{userContextId:u?.authenticationUser?.id?(0,xe.b4)(u.authenticationUser):void 0}}),o=new Pt(a,n.commandDelegator);const{intentOverridenByHook:i,targetWindowId:r,errorCode:s}=await this.evaluateOnAfterIntentAuthenticatedHook(e,a,o,u,t);if(s&&(p=s),i)return this.logger.log("executeInternal: Intent overriden by onAfterIntentAuthenticated."),{intentExecuted:!1,targetWindowId:r}}else this.logger.log(`executeInternal: user context / authentication user is not defined for userContextId: ${e.metadata.userContextId}  - skip execution of onAfterIntentAuthenticated`);if(this.logInternal(`executeInternal: windowId: ${t}: Executing original intent:`,e),e.shouldRenderContent){const i=await KE({coreSettings:this.coreSettings,logger:this.logger,waitForRenderingContextReady:this.waitForRenderingContextReady,correlation:e.scenarioCorrelation.correlation});if(this.logInternal(`executeInternal: The intent is targeting userContextId ${e.metadata.userContextId}, and the mainWindowUserId is ${i}:`,e),this.shouldGoToAccountListWindow(e,i))return await async function(e,t,n,i,a,o){o.metadata.accountsToUse=void 0,o.entityCommand.command.stateTransition=ke.su.new,o.entityCommand.command.layoutMode=ke.lO.focus;const r=(0,W.cloneDeep)(o);return r.entityCommand.entity={id:`${o.entityCommand.command.layoutMode}`,type:Se.py.identity,action:Se.uk.list,linkedEntity:{type:o.entityCommand.entity.type,action:o.entityCommand.entity.action,id:o.entityCommand.entity.id??o.entityCommand.command.correlation.id}},r.entityCommand.command={...o.entityCommand.command,layoutMode:ke.lO.focus,stateTransition:ke.su.new,visibilityState:ke.fe.show},t.log(`goToAccountListWindow: Executing account list intent: {${r.entityCommand.entity.type}, ${r.entityCommand.entity.action}, ${r.entityCommand.command.layoutMode}, ${r.entityCommand.command.visibilityState}}`),e.report({correlationId:r.scenarioCorrelation.correlation.id,type:dt.B.IntentExecuted,context:{target:eA,eventData:{mainEntityType:r.entityCommand.entity.type,mainEntityAction:r.entityCommand.entity.action}}}),tA(i,a,r,t,n)}(this.commandChangeReportingService,this.logger,this.coreSettings,a,o,e),{intentExecuted:!1,targetWindowId:void 0};const r=function(e,t,n,i,a,o){if(n.options?.shouldSkipOverridingWindowing)return!1;if(!e.get(b.J.Core)?.enableDeeplinkOptionAllowUserWindowingPreference)return!1;if(!o)return a.log("Main window user context id is undefined"),!1;if(JE(n.metadata.homeCloud,e))return!1;const r=iA(n);if(a.log(`PendingIntentType: ${r}`),r===HE.Flyout||r===HE.Minimode)return!1;const s=n.entityCommand.command;switch(a.log(`StateTransition: ${s.stateTransition}`),s.stateTransition){case ke.su.none:case ke.su.extend:case ke.su.flow:return!1}if(a.log(`EntityType: ${n.entityCommand.entity.type}`),n.entityCommand.entity.type===Se.py.default||n.entityCommand.entity.action===Se.uk.default||n.entityCommand.entity.type===Se.py.identity)return!1;const l=i.getApp({entityType:n.entityCommand.entity.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:e,entity:n.entityCommand.entity})||!1;if(a.log(`AllowUserWindowingPreference: ${l}`),!n.metadata.userContextId)return a.errorToTelemetry?.("Unexpected undefined userContextId for intent in override","webclient_framework_foundation_core_services_intent",void 0,!0),!1;if(n.metadata.userContextId!==o)return a.log("User context of intent does not match main window user"),l||s.stateTransition===ke.su.new?(s.layoutMode=ke.lO.focus,s.stateTransition=ke.su.new):(s.layoutMode=ke.lO.standard,s.stateTransition=ke.su.forceFlush,s.targetWindow=ke.PH.main),!0;if(a.log("User context of intent matches main window user"),l){const e=t.getPreferences("windowing").shouldOpenContentInNewWindow;return a.log(`ShouldOpenContentInNewWindow ${e}`),e?(s.layoutMode=ke.lO.focus,s.stateTransition=ke.su.new):(s.layoutMode=ke.lO.standard,s.stateTransition=ke.su.flush),!0}return!1}(this.coreSettings,u.clientPreferences,e,this.appsRegistryService,this.logger,i);m=await tA(a,o,e,this.logger,this.coreSettings,r?void 0:t,n)}return this.logInternal(`executeInternal: windowId: ${t}: Executed intent:`,e),this.commandChangeReportingService.report({correlationId:e.scenarioCorrelation.correlation.id,type:dt.B.IntentExecuted,context:{target:mA,eventData:{mainEntityType:e.shouldRenderContent?e.entityCommand.entity.type:pA,mainEntityAction:e.shouldRenderContent?e.entityCommand.entity.action:pA,errorCode:p}}}),{intentExecuted:!0,targetWindowId:m}}async executeOnCrossCloudMeeting(e,t){const n=(0,gn.NH)(this.coreSettings);if(e.shouldRenderContent&&e.entityCommand.entity.type===Se.py.callingdeeplink&&n&&e.metadata.homeCloud&&(0,gn.Ee)(e.metadata.homeCloud,this.coreSettings)!==n&&!1===this.coreSettings.get(b.J.HostCapabilities,["crossCloudMeetingEnabled"]).crossCloudMeetingEnabled){return{intentExecuted:!0,targetWindowId:await aA({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:new Me.G(Me.$.EXPERIENCE_DISABLED,void 0,e.metadata.userContextId),errorInfo:ct.y.DeeplinkExecutionTerminated,errorMessage:"Deeplink callingdeeplink execution was terminated, because crossCloudMeetingEnabled is disabled.",intent:e,logger:this.logger,newCommandType:dt.B.Failure,windowId:t,delegatedCommanding:this.delegatedCommanding,coreSettings:this.coreSettings})}}}async evaluateOnBeforeIntentAuthHook(e,t,n,i){this.commandChangeReportingService.report({type:dt.B.OnBeforeIntentAuthenticatedStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:mA}});const{intentOverridenByHook:a,targetWindowId:o,errorCode:r,targetCloud:s,targetUserContextId:l}=await async function(e,t,n,i,a,o,r,s,l,c){let d=oA.pending,u={};if(sA(t,r))return u=await e(),u;a.log("Proceed with loading screen display if threshold exceeds.");const m=r?.get(b.J.Auth)?.thresholdToShowLoadingScreenInMs??2e3;let p;const g=o.setTimeout((()=>{d!==oA.pending||p||(s.report({type:dt.B.OnLoadingScreenDisplayStarted,correlationId:t.scenarioCorrelation.correlation.id,context:{target:l}}),tA(n,i,rA(t,ke.fe.show),a,r,c).then((e=>{p=e})).catch((e=>a.warn(`Error while launching loading screen: ${e}`))))}),m);try{u=await e(),d=oA.fulfilled}catch(e){throw d=oA.rejected,e}finally{o.clearTimeout(g),p&&(tA(n,i,rA(t,ke.fe.hide),a,r,p).catch((e=>a.warn(`Error while closing loading screen: ${e}`))),s.report({type:dt.B.OnLoadingScreenDisplayCompleted,correlationId:t.scenarioCorrelation.correlation.id,context:{target:l}}))}return u}((async()=>this.evaluateHook("onBeforeIntentAuthenticated",{intent:lA(e),context:{client:this.client,coreSettings:this.coreSettings,scenarioFactory:this.scenarioFactory}},t,n,i)),e,t,n,this.logger,this.host,this.coreSettings,this.commandChangeReportingService,mA,i);return this.commandChangeReportingService.report({type:dt.B.OnBeforeIntentAuthenticatedCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:mA,eventData:{errorCode:r}}}),{intentOverridenByHook:a,newTargetWindowId:o,errorCode:r,targetCloud:s,targetUserContextId:l}}async evaluateHook(e,t,n,i,a){let o,r;this.logger.log(`evaluateHook(${e}): windowId: ${a}: Begin evaluation`);let s=!1;for(const l of function(e,t,n){const i=[];for(const a of e.registeredApps){const e=a[t];if(e)for(const t of Array.from(e.filter))"*"!==t&&t!==n||i.push(a)}return i}(this.appsRegistryService,e,t.intent.shouldRenderContent?t.intent.entityCommand.entity.type:void 0)){this.logger.log(`evaluateHook(${e}) - Matching app found: ${l.manifest.id}`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:dt.B.IntentHookStarted,context:{target:mA,eventData:{matchingApp:l.manifest.id}}});try{const n=await cA(this.commandChangeReportingService,this.logger,l,e,t);s=n.intentOverridenByHook,o=n.intent,r=s?"onBeforeIntentAuthenticated"===e?VE.IntentOverriddenByOnBeforeAuth:VE.IntentOverriddenByOnAfterAuth:void 0}catch(n){this.logger.warn(`evaluateHook(${e}) windowId: ${a}: - Evaluating hook threw an error: ${n}. Executing error intent.`),r="onBeforeIntentAuthenticated"===e?ct.y.OnBeforeIntentAuthenticatedRejected:ct.y.OnAfterIntentAuthenticatedRejected;return{intentOverridenByHook:!0,targetWindowId:await aA({commandHandler:this.commandHandler,commandChangeReportingService:this.commandChangeReportingService,error:n,errorInfo:r,errorMessage:`evaluateHook(${e}) windowId: ${a}: - Evaluating hook threw an error: ${n}. Falling back to original intent.`,fallbackError:new Me.G(Me.$.UNKNOWN),logger:this.logger,intent:t.intent,newCommandType:dt.B.IntentHookRejected,windowId:a,delegatedCommanding:this.delegatedCommanding,coreSettings:this.coreSettings}),errorCode:r}}if(s){if(!o)return this.logger.warn(`evaluateHook(${e}) windowId: ${a}: - Hook overriden to undefined. Stopping further processing`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:dt.B.Failure,context:{target:mA,errorInfo:"onBeforeIntentAuthenticated"===e?ct.y.OnBeforeIntentAuthenticatedReturnedUndefined:ct.y.OnAfterIntentAuthenticatedReturnedUndefined}}),{intentOverridenByHook:!0,targetWindowId:a};if(o.metadata.cloud)return{intentOverridenByHook:s,targetWindowId:void 0,targetCloud:o.metadata.cloud,errorCode:r};if(t.intent.shouldRenderContent&&o.shouldRenderContent){this.logInternal(`evaluateHook(${e}), windowId: ${a}: - Executing overriden intent:`,o),this.commandChangeReportingService.report({correlationId:o.scenarioCorrelation.correlation.id,type:dt.B.IntentExecuted,context:{target:mA,eventData:{mainEntityType:o.shouldRenderContent?o.entityCommand.entity.type:pA,mainEntityAction:o.shouldRenderContent?o.entityCommand.entity.action:pA,errorCode:r}}});return{intentOverridenByHook:s,targetWindowId:await tA(n,i,o,this.logger,this.coreSettings,a),errorCode:r}}}}return this.logger.log(`evaluateHook(${e}): windowId: ${a}: Completing evaluation. Intent was not overriden.`),this.commandChangeReportingService.report({correlationId:t.intent.scenarioCorrelation.correlation.id,type:dt.B.IntentHookCompleted,context:{target:mA}}),{intentOverridenByHook:!1,targetWindowId:a,errorCode:r,targetUserContextId:o?.metadata.userContextId}}logInternal(e,t){this.logger.log(`${e} {${t.shouldRenderContent?`${t.entityCommand.entity.type}, ${t.entityCommand.entity.action}, ${t.entityCommand.command.layoutMode}, ${t.entityCommand.command.visibilityState}}`:"nrc"}`)}async evaluateOnAfterIntentAuthenticatedHook(e,t,n,i,a){this.commandChangeReportingService.report({type:dt.B.OnAfterIntentAuthenticatedStarted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:mA}});const{intentOverridenByHook:o,targetWindowId:r,errorCode:s}=await this.evaluateHook("onAfterIntentAuthenticated",{intent:lA(e),context:{authenticatedUser:i.authenticationUser,client:i.client,localStorage:i.localStorage,coreSettings:this.coreSettings,experienceChangeReportingService:i.experienceChangeReportingService}},t,n,a);return this.commandChangeReportingService.report({type:dt.B.OnAfterIntentAuthenticatedCompleted,correlationId:e.scenarioCorrelation.correlation.id,context:{target:mA,eventData:{errorCode:s}}}),{intentOverridenByHook:o,targetWindowId:r,errorCode:s}}shouldGoToAccountListWindow(e,t){const n=this.appsRegistryService.getApp({entityType:e.entityCommand.entity.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:this.coreSettings,entity:e.entityCommand.entity})||!1;return!!this.coreSettings.get(b.J.Core)?.enableDeeplinkOptionAccountToUse&&0===e.metadata.accountsToUse?.length&&!!t&&e.metadata.userContextId===t&&(n||e.entityCommand.command.stateTransition===ke.su.new)}async sendDeeplinkUserBi(e,t){uA(e,t,this.coreSettings,this.logger,this.waitForRenderingContextReady,this.appsRegistryService,this.userBiService)}}async function hA(e){const{commandChangeReportingService:t,coreSettings:n,experienceBasePath:i,location:a,scenarioCorrelation:o,loggerFactory:r,userContextId:s}=e,l=r.newLogger("DeeplinkUtilities","core-services-deeplink"),c=ss({coreSettings:n,experienceBasePath:i,location:a,loggerFactory:r});t.report({type:dt.B.ScenarioEventDataAppended,correlationId:o.correlation.id,context:{target:"deeplink-parsing",eventData:{homeCloud:c?.homeCloud,externalId:o.correlation.externalId,deeplinkId:o.correlation.deeplinkId}}});let d,u,m=!1;if(c&&c.isDesktopDeeplink){const t=await async function(e){const{commandChangeReportingService:t,deepLink:n,homeCloud:i,logger:a,scenarioCorrelation:o,userContextId:r,windowType:s}=e,l=Fr.n0[n];if(l){let e;switch(a.log(`Static deeplink: ${l}`),n){case Fr.n0.flyout:const t=ke.lO.minimal;e=vA({scenarioCorrelation:o,userContextId:r,deepLink:n,homeCloud:i,entity:CA(t),layoutMode:t});break;case Fr.n0.default:{let t=ke.lO.standard;s!==Fr.fo.mini&&s!==Fr.fo.main||(t=ke.lO.minimode),e=vA({scenarioCorrelation:o,userContextId:r,deepLink:n,homeCloud:i,entity:CA(t),layoutMode:t});break}case Fr.n0.core:e=vA({scenarioCorrelation:o,userContextId:r,deepLink:n,homeCloud:i})}return wA({commandChangeReportingService:t,correlationId:o.correlation.id,externalId:o.correlation.externalId,deeplinkId:o.correlation.deeplinkId,deeplinkType:l,mainEntityType:e?.shouldRenderContent?e?.entityCommand.entity.type:void 0,mainEntityAction:e?.shouldRenderContent?e?.entityCommand.entity.action:void 0,loadingWindowType:s}),{terminateDeeplink:!1,intent:e}}const c=await bA({...e,deepLink:n});if(c.intent||c.terminateDeeplink||c.errorCode===Wt.InvalidOrigin)return c;const d=yA(n,o,r,i);return{terminateDeeplink:!1,intent:d}}({...e,userContextId:s||c.userContextId,deepLink:c.deepLink,homeCloud:c.homeCloud,logger:l,windowType:c.windowType});m=t.terminateDeeplink,d=t.intent,u=t.errorCode}else if(c){const t=await bA({...e,deepLink:c.deepLink,userContextId:s||c.userContextId,logger:l});m=t.terminateDeeplink,d=t.intent,u=t.errorCode}if(m)return{terminateDeeplink:m,intent:d};if(d||u===Wt.InvalidOrigin||(d=function(e,t,n){const{hash:i,pathname:a}=e;let o;if(i&&!(0,W.isEmpty)(i)){const e=i.indexOf("?");o=e>=0?i.substr(0,e):i}else o=a;return yA(o,t,n)}(a,o,s)),!d&&c){const t=Zr(c.deepLink,e.coreSettings),n=Or(t);l.errorToTelemetry&&l.errorToTelemetry(n,"webclient_framework_foundation_core_services_deeplink",void 0,!0),d=await async function({commandChangeReportingService:e,originalDeeplink:t,coreSettings:n,hostCommunicationService:i,logger:a,scenarioCorrelation:o,userContextId:r}){const{enableUnsupportedDeeplinkDialog:s,enableUnsupportedDeeplinkDialogForTflToTfw:l,clientPreviewOptOutStrategy:c}=n.get(b.J.Core);a.log(`enableUnsupportedDeeplinkDialog: ${s}, enableUnsupportedDeeplinkDialogForTflToTfw: ${l}`);const d=l&&qE((0,$E.P)(t,n),n)===ys.G7.life;if(d||s){let n="Web"===c;if("Desktop"===c){const e=await i.loadModule("appswitcher"),t=await(e?.getPearInstallState?.(ti.OP.Teams1));a.infoToTelemetry?.(`t1InstallState: ${t}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0),n=t===ti.Jv.InstalledNotActive||t===ti.Jv.InstalledActive}if(n){a.infoToTelemetry?.("Returning unsupported deeplink command","webclient_framework_foundation_core_services_deeplink",void 0,!0);const n=vA({scenarioCorrelation:o,userContextId:r,deepLink:t.toString(),entity:{type:Se.py.unsupporteddeeplinkdialog,action:Se.uk.view},layoutMode:ke.lO.standard,stateTransition:ke.su.extend,entityOptions:{originalDeeplink:t}}),{pathname:i}=t,s=Fr.Hl.find((e=>i.startsWith(e)))??"unsupported";return wA({commandChangeReportingService:e,correlationId:o.correlation.id,externalId:o.correlation.externalId,deeplinkId:o.correlation.deeplinkId,deeplinkType:s,mainEntityType:n?.entityCommand.entity.type,mainEntityAction:n?.entityCommand.entity.action}),n}}return}({commandChangeReportingService:e.commandChangeReportingService,originalDeeplink:t,coreSettings:e.coreSettings,hostCommunicationService:e.hostCommunicationService,logger:l,scenarioCorrelation:o,userContextId:s})}return{terminateDeeplink:!1,intent:d}}function yA(e,t,n,i){const a=ds(e);if(a)return vA({scenarioCorrelation:t,userContextId:n,deepLink:TA(e||Fr.n0.default),entity:a,homeCloud:i})}function vA(e){const{scenarioCorrelation:t,userContextId:n,deepLink:i,homeCloud:a,entity:o,layoutMode:r,stateTransition:s=ke.su.flush,entityOptions:l}=e;return o?{shouldRenderContent:!0,scenarioCorrelation:t,entityCommand:Bn({entity:o,command:{visibilityState:ke.fe.show,stateTransition:s,layoutMode:r,correlation:t.correlation},entityOptions:l,metadata:{deepLink:i}}),metadata:{allowAnonymous:!1,deepLink:i,homeCloud:a,userContextId:n}}:{shouldRenderContent:!1,scenarioCorrelation:t,metadata:{allowAnonymous:!1,deepLink:Fr.n0.core,homeCloud:a,userContextId:n}}}async function fA(e){let t,n,i,a,o=!1;const{authenticationService:r,appsRegistryService:s,commandChangeReportingService:l,coreSettings:c,homeCloud:d,normalizedDeeplink:u,rawDeeplink:m,scenarioCorrelation:p,loggerFactory:g,logger:h,client:y,scenarioFactory:v,preferredCommandInput:f,userContextId:S,sourceViewEntity:k,forceInCloudExecution:C,getExperienceAccountMode:w,waitForRenderingContextReady:T}=e,{enableOriginValidationForIncomingIntents:I,disableNormalizedDeeplinkToApps:N}=c.get(b.J.Core),E=c.get(b.J.Auth).enableAccountSelectionOnPreMeetingJoin;if(!C&&(I&&!E)&&!(0,$E.H)(u.toString(),c,!0))return{terminateDeeplink:!1,matchType:"originValidationForIncomingIntents",intent:void 0,reason:"Not a valid deeplink",errorCode:Wt.InvalidOrigin};try{let a;const{pathname:C}=u,I="/"===C[0]?C.substr(1):C,E=function(e){if(e.hash){const t=new URL(e.hash.substring(1),e.origin),n={pathname:t.pathname};return t.search&&(n.search=(0,Pr.parse)(t.search)),n}}(u);for(const e of s.registeredApps){const{match:n,matchType:i,matchingCondition:o}=SA(e,I,u,E);if(n){a=o,t=i;break}}if(a){const t=e=>{l.report({correlationId:p.correlation.id,type:e,context:{target:"delegate-deeplink-to-app"}})};t(dt.B.DeeplinkParseByAppStarted);const s=await a.execute({context:{__doNotUse_globalDataClient:y,coreSettings:c,getExperienceAccountMode:w,getUserContexts:async e=>async function(e){const{getExperienceAccountMode:t,userContextId:n,authenticationService:i,tenantId:a,logger:o,correlation:r}=e;o.log(`getUserContexts call with tenantId ${a}`);const s=await(i.getCachedUsers?.({id:r.id,source:r.source},{isAuthenticated:!0}))||[];o.log(`Auth service returned ${s.length} users`);const l=[],c=await KE(e);if(n&&n!==c&&t()!==OE.b.SingleAccount){o.log(`Adding source window to user context ${n}`);const t=await YE({...e,userContextId:n,userContextAccountType:zE.SourceWindow});t&&l.push(t)}if(c){o.log(`Adding main window to user context ${c}`);const t=await YE({...e,userContextId:c,userContextAccountType:zE.MainWindow});t&&l.push(t)}for(const t of s)if(t.id&&t.id!==n&&t.id!==c&&(!a||a===t.profile.tid)){o.log(`Adding ${t.id} user context`);const n=await YE({...e,userContextId:t.id,userContextAccountType:zE.Other});n&&l.push(n)}return l}({authenticationService:r,commandChangeReportingService:l,coreSettings:c,correlation:p.correlation,getExperienceAccountMode:w,logger:h,tenantId:e,userContextId:S,waitForRenderingContextReady:T}),loggerFactory:g,scenarioFactory:v},deeplinkUrl:N?m:u,homeCloud:d,preferredCommandInput:f,sourceViewEntity:k,parsedDeeplinkHash:E});if(t(dt.B.DeeplinkParseByAppSucceeded),s){const t=await async function(e){const{coreSettings:t,userContextId:n}=e;if(!t.get(b.J.Core)?.enableDeeplinkOptionAccountToUse)return{accountsToUse:n?[n]:void 0,userContextId:n};if(JE(e.homeCloud,t))return{accountsToUse:n?[n]:void 0,userContextId:n};const i=await KE(e);if(!i)return{accountsToUse:void 0,userContextId:n};const{accountsToUse:a,getExperienceAccountMode:o}=e;if(o()===OE.b.SingleAccount)return{accountsToUse:[i],userContextId:i};let r=n;a&&0===a.length&&(r=void 0);a&&a.length>=1&&(r=a[0]);return{accountsToUse:a,userContextId:r}}({...e,correlation:p.correlation,userContextId:S,waitForRenderingContextReady:T,accountsToUse:s.metadata.accountsToUse});n={...s,shouldRenderContent:!0,entityCommand:{...s.entityCommand,command:{...s.entityCommand.command,correlation:p.correlation},...m&&{metadata:{deepLink:m.toString()}}},scenarioCorrelation:p,metadata:{...s.metadata,deepLink:m.toString(),homeCloud:d,...t}}}else o=!0,i=Wt.DeeplinkTerminatedByApp}else i=Wt.DeeplinkNotHandledByRegisteredApps}catch(e){i=Wt.OnBeforeDeeplinkParsedFailed,a=e.message;const t=e.reason,n=`${Bt}/${i}/${(0,ce.A)(a)}/${t}`;h.errorToTelemetry?.(n,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}return{matchType:t,terminateDeeplink:o,intent:n,errorCode:i,reason:a}}function SA(e,t,n,i){if(!e.onBeforeDeeplinkParsed)return{match:!1};for(const a of e.onBeforeDeeplinkParsed){const{filter:o}=a;if(kA(o)){if(o(n,i))return{match:!0,matchType:`${e.manifest.name}#filterFn`,matchingCondition:a}}else{const e="/"===o[0]?o.substr(1):o;if(t.startsWith(e))return{match:!0,matchType:e,matchingCondition:a}}}return{match:!1}}function kA(e){return(0,W.isFunction)(e)}function CA(e){return e===ke.lO.minimode||e===ke.lO.minimal?{type:Se.py.flyout,action:Se.uk.default}:{action:Se.uk.default,type:Se.py.default}}async function bA(e){const{commandChangeReportingService:t,coreSettings:n,deepLink:i,isInternalDeeplink:a,logger:o,scenarioCorrelation:r,userBiService:s}=e,l=Zr(i,n),c=(0,$E.P)(l,n),{matchType:d,terminateDeeplink:u,intent:m,errorCode:p,reason:g}=await fA({...e,normalizedDeeplink:c,rawDeeplink:l,logger:o});return function(e,t,n,i,a){const{pathname:o,search:r}=i,s="/"===o[0]?o.substr(1):o,l=Fr.Hl.find((e=>{const t="/"===e[0]?e.substr(1):e;return s.startsWith(t)}));if(!l)return;const c={};c["DataBag.joinLinkType"]=l.toString();const d=new URLSearchParams(r);c["DataBag.deeplinkId"]=d.get("deeplinkId"),c["DataBag.externalId"]=a?.entityCommand.command?.correlation?.externalId,c["DataBag.joinLinkVariant"]=d.get("v"),e.recordPanelAction({actionGesture:dA.uS.open,actionOutcome:dA.$K.open,actionScenario:dA.Tk.deeplink,actionScenarioType:dA.Yu.deeplink,moduleType:dA.PO.deeplink,moduleName:dA.rA.deeplinkService,panelType:n?dA.wh.Internal:dA.wh.External,dataBag:{id:"",data:{...c},dispose:()=>{}},mainEntityType:a?.entityCommand.entity.type,mainEntityAction:a?.entityCommand.entity.action},t)}(s,o,a,c,m),m?.shouldRenderContent?o.log(`Deeplink parsed to intent: { type: ${m.entityCommand.entity.type}, action: ${m.entityCommand.entity.action} }`):o.log("Returning default entity to be executed as fallback"),wA({commandChangeReportingService:t,correlationId:r.correlation.id,externalId:r.correlation.externalId,deeplinkId:r.correlation.deeplinkId,deeplinkType:d,mainEntityType:m?.entityCommand.entity.type,mainEntityAction:m?.entityCommand.entity.action,errorCode:p,reason:g}),{terminateDeeplink:u,intent:m,errorCode:p}}function wA(e){const{commandChangeReportingService:t,correlationId:n,externalId:i,deeplinkId:a,deeplinkType:o,mainEntityType:r,mainEntityAction:s,errorCode:l,reason:c,loadingWindowType:d}=e,u="deeplink-parsing";t.report({correlationId:n,type:dt.B.DeeplinkParsed,context:{target:u,eventData:{externalId:i,deeplinkId:a,deeplinkType:o,loadingWindowType:d,mainEntityType:r,mainEntityAction:s,errorCode:l,reason:c}}}),t.report({type:dt.B.ScenarioEventDataAppended,correlationId:n,context:{target:u,eventData:{externalId:i,deeplinkId:a,deeplinkType:o,loadingWindowType:d,mainEntityType:r,mainEntityAction:s,errorCode:l,reason:c}}})}const TA=e=>decodeURIComponent(e).replace(/[^A-Za-z0-9/.?&=#\+\-,_:@{}"]/g,"");class IA{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m,p,g,h,y,v,f){this._client=i,this._waitForRenderingContextReady=a,this._host=o,this._appsRegistryService=r,this._config=s,this._correlation=l,this._scenarioFactory=c,this._userBiService=d,this._commandChangeReportingService=u,this._hostComms=m,this._localStorage=p,this._experienceChangeReportingService=g,this._acountModeTrackingService=h,this._activeWindowsService=y,this._authenticationService=v,this._delegatedCommanding=f,this._logger=e.newLogger("DeepLinkService","core-services-deeplink"),this._intentService=new gA(e,this._appsRegistryService,t,n,this._client,this._waitForRenderingContextReady,this._commandChangeReportingService,this._experienceChangeReportingService,this._scenarioFactory,this._hostComms,this._host,this._activeWindowsService,this._userBiService,this._delegatedCommanding),this._loggerFactory=e,this._coreSettings=t}async init(e){return this._hasEncounteredCriticalError=e,this._host.addEventListener("hashchange",(()=>{const e=function(e,t,n){return{clientLaunchId:ns({location:e,clientLaunchId:n}),correlation:is(e,t),deeplinkId:os(e,"deeplinkId")}}(this._host.location,C.D.ExternalCommand);return this._handleUrl(!1,e)})),this._handleUrl(!0,{clientLaunchId:ns({location:this._host.location}),correlation:{scenarioName:H.RG.ClientStart,...this._correlation},deeplinkId:os(this._host.location,"deeplinkId")})}async executeFromUrlAsync(e,t,n,i,a,o,r){let s;this._logger.log(`executeFromUrlAsync::deepLinkUrl::'${e}'`);try{const l=new URL(e);s={correlation:t?.correlation?je(t.correlation):is(l,C.D.InternalDeeplink),clientLaunchId:i},i&&this.sendDeeplinkReceivedSignal(s,n);const c=(0,gn.NH)(this._coreSettings),d=(0,$E.P)(l,this._coreSettings),u=qE(d,this._coreSettings),m=this._coreSettings.get(b.J.Core).enableCrossCloudLaunch;if(!r&&!this._isValidDeepLinkUrlForInCloudOrCrossCloudExecution(d.href,u))return this.stopNavigationScenarios(s,dt.B.Incomplete,ct.y.DeeplinkIntentParseFailure,`Current cloud: ${c}, deeplinkCloud: ${u}, enableCrossCloudLaunch: ${m}`),!1;if(!r&&m&&u&&u!==c)return await XE(u,this._commandChangeReportingService,e,this._hostComms,s.correlation,a?.userContextId),!0;const{terminateDeeplink:p,intent:g}=await this._getNavigationIntentAsync(l,!0,s,t,a?.userContextId,o,r);return p?(this.stopNavigationScenarios(s,dt.B.Incomplete,ct.y.DeeplinkExecutionTerminated),!0):g?(g.options={isFromDeeplink:!0,sourceWindowId:a?.windowId},await this._intentService.execute(g),!0):(this.stopNavigationScenarios(s,dt.B.Incomplete,ct.y.DeeplinkIntentParseFailure),!1)}catch(e){const t=`${Bt}${Wt.ToNavigationIntentFailed} ${(0,$.u4)(e)}`;throw s&&this.stopNavigationScenarios(s,dt.B.Failure,ct.y.DeeplinkIntentParseFailure,t),new Error(t)}}checkForPendingIntent(e,t,n){const i=je({scenarioName:H.RG.NavigationCommand,...e});return t&&this.sendDeeplinkReceivedSignal({clientLaunchId:t,correlation:i},{type:"pendingIntent"}),this._intentService.checkForPendingIntent(i,n)}launchMainApp(e,t,n,i){const a={correlation:je({scenarioName:H.RG.NavigationCommand,...e}),clientLaunchId:ns({clientLaunchId:t})};a.clientLaunchId&&this.sendDeeplinkReceivedSignal(a,{type:"default"});const o=n??{type:Se.py.default,action:Se.uk.default};return this._intentService.launchMainApp(rs(o),a,o,i)}launchMinimode(e,t,n){const i={correlation:je({scenarioName:H.RG.NavigationCommand,...e}),clientLaunchId:ns({clientLaunchId:t})};i.clientLaunchId&&this.sendDeeplinkReceivedSignal(i,{type:"default"});const a=n??{type:Se.py.default,action:Se.uk.default};return this._intentService.launchMinimode(rs(a),i,a)}async switchAccount(e,t,n,i,a,o,r){const s={correlation:je({scenarioName:H.RG.NavigationCommand,...e}),clientLaunchId:ns({clientLaunchId:n})};s.clientLaunchId&&this.sendDeeplinkReceivedSignal(s,{type:"switchAccount"});const l=i??{type:Se.py.default,action:Se.uk.default};return a&&a!==(0,gn.NH)(this._coreSettings)?XE(a,this._commandChangeReportingService,r||rs(l),this._hostComms,s.correlation,t):this._intentService.switchAccount(rs(l),s,l,t,o)}prewarmFlyout(e,t=!1){const n={correlation:je({source:e,scenarioName:H.RG.NavigationCommand}),clientLaunchId:ns({})},i=t?"minimode":"flyout";return this.sendDeeplinkReceivedSignal(n,{type:i}),this._intentService.prewarmFlyout(n,t)}executeIntent(e,t){const n={correlation:je({...e.entityCommand.command.correlation,scenarioName:H.RG.NavigationCommand}),clientLaunchId:ns({})};this.sendDeeplinkReceivedSignal(n,{type:`${e.entityCommand.entity.type}/${e.entityCommand.entity.action}`});const i=e.metadata.deepLink,a=this._coreSettings.get(b.J.Core).enableCrossCloudLaunch;if(!t&&i&&a){this._logger.log(`executeIntent::deepLinkUrl::'${i}'`);try{const t=qE(new URL(i),this._coreSettings);if(t&&t!==(0,gn.NH)(this._coreSettings)&&this._isValidDeepLinkUrlForInCloudOrCrossCloudExecution(i,t))return XE(t,this._commandChangeReportingService,i,this._hostComms,n.correlation,e.metadata.userContextId)}catch(e){const t=`${Bt}${Wt.InvalidDeepLinkUrl}::${e?.name}`;this._logger.warnToTelemetry?.(t,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}}return this._intentService.execute({...e,entityCommand:{...e.entityCommand,command:{...e.entityCommand.command,correlation:n.correlation}},metadata:{...e.metadata,deepLink:i||rs(e.entityCommand.entity)},scenarioCorrelation:n,shouldRenderContent:!0})}async _handleUrl(e,t){if(this._lastDesktopClientId&&this._lastDesktopClientId===t.clientLaunchId)return void this._logger.errorToTelemetry?.("Navigation received with duplicate clientId. Terminating flow.","webclient_framework_foundation_core_services_deeplink",void 0,!0);this._lastDesktopClientId=t.clientLaunchId;const n=this._host.location;this._logger.log(`_handleUrl::location::'${n.href}'`),t.correlation.scenarioName&&t.clientLaunchId&&this.sendDeeplinkReceivedSignal(t);const{terminateDeeplink:i,intent:a}=await this._getNavigationIntentAsync(n,!1,t);let o=a;return i?(await this._notifyIntentHandled(),this.stopNavigationScenarios(t,dt.B.Incomplete,ct.y.DeeplinkExecutionTerminated),void await this._clearHashFromLocation()):(!o&&this._config.shouldExecuteDefaultCommand&&(o=vA({scenarioCorrelation:t,userContextId:void 0,deepLink:Fr.n0.default,entity:CA(),layoutMode:ke.lO.standard})),o?(await this._notifyIntentHandled(),e&&this._experienceChangeReportingService.report({correlationId:t.correlation.id,type:gt.yU.InitialDeeplinkResolved,context:{target:"deeplink-service-handle-url",shouldRenderContent:o.shouldRenderContent}}),o.options={shouldSkipMinimodeOverride:e,isFromDeeplink:!0},this._intentService.execute(o,this._clearHashFromLocation.bind(this))):(this.stopNavigationScenarios(t,dt.B.Failure,ct.y.DeeplinkIntentParseFailure),void await this._clearHashFromLocation()))}_isValidDeepLinkUrlForInCloudOrCrossCloudExecution(e,t){try{const n=this._coreSettings.get(b.J.Core).validCloudsForInternalDeeplinks||[];return(!t||n.includes(t))&&(0,$E.H)(e,this._coreSettings)}catch(e){const t=`${Bt}${Wt.InvalidDeepLinkUrl}::${e?.name}`;return this._logger.errorToTelemetry?.(t,"webclient_framework_foundation_core_services_deeplink",void 0,!0),!1}}async _notifyIntentHandled(){try{const e=await this._hostComms.loadModule("core");await(e?.intentHandled?.())}catch(e){this._logger.warn("Failed to notify host that intent was handled")}}async _clearHashFromLocation(){const{clientPreviewOptOutStrategy:e}=this._coreSettings.get(b.J.Core);if("Web"!==e||this._hasEncounteredCriticalError)return;const t=this._host.location;if(t.search.includes("meetingjoin=true")){if((await this._authenticationService.getUser()).role===ys.w4.Anonymous)return}if(t.hash){this._logger.log("Clearing hash from location");const e=new URL(t.href);e.hash="",this._host.history.pushState("",this._host.document.title,e)}}async _getNavigationIntentAsync(e,t,n,i,a,o,r){try{return await hA({authenticationService:this._authenticationService,appsRegistryService:this._appsRegistryService,experienceBasePath:this._config.basePath,coreSettings:this._coreSettings,hostCommunicationService:this._hostComms,location:e,scenarioCorrelation:n,loggerFactory:this._loggerFactory,userBiService:this._userBiService,isInternalDeeplink:t,commandChangeReportingService:this._commandChangeReportingService,intentPersistenceService:new UE.I(this._localStorage),userContextId:a,client:this._client,preferredCommandInput:i,sourceViewEntity:o,scenarioFactory:this._scenarioFactory,forceInCloudExecution:r,getExperienceAccountMode:()=>this._acountModeTrackingService?this._acountModeTrackingService.getAccountMode():OE.b.SingleAccount,waitForRenderingContextReady:this._waitForRenderingContextReady})}catch(e){this._logger.errorToTelemetry?.(`${Bt}${Wt.ToNavigationIntentFailed}`,"webclient_framework_foundation_core_services_deeplink",void 0,!0)}return{terminateDeeplink:!1}}sendDeeplinkReceivedSignal({clientLaunchId:e,correlation:t,deeplinkId:n},i){this._scenarioFactory.findScenarioByNameAndId(H.RG.NavigationCommand,e)&&(t.scenarioName=H.RG.NavigationCommand),this._commandChangeReportingService.report({type:dt.B.NavigationCommandStart,correlationId:t.id,context:{target:"deeplink-service",clientLaunchId:e,correlation:t,eventData:{deeplinkId:n,scenarioPhase:"Core",...i}}})}stopNavigationScenarios(e,t,n,i){this._logger.warn("Navigation intent not found");const a=this._scenarioFactory.findScenario(H.RG.ApplicationLaunchTime);a?.fail({errorCode:n}),this._commandChangeReportingService.report({type:t,correlationId:e.correlation.id,context:{target:"deeplink-service-handle-url",errorInfo:n,errorMessage:i}})}}class NA extends _e{constructor(){super(h.Yg.CreateDeeplinkService,["activeWindowsService","appsRegistryService","authenticationService","client","commandChangeReportingService","commandHandler","config","coreSettings","correlation","delegatedCommanding","experienceChangeReportingService","hostCommunicationService","localStorage","loggerFactory","scenarioFactory","userBiService","waitForRenderingContextReady","windowProvider"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,authenticationService:i,client:a,commandChangeReportingService:o,commandHandler:r,config:s,coreSettings:l,correlation:c,delegatedCommanding:d,experienceChangeReportingService:u,hostCommunicationService:m,localStorage:p,loggerFactory:g,scenarioFactory:h,userBiService:y,userTrackingService:v,waitForRenderingContextReady:f,windowProvider:S}=e;e.deeplinkService=new IA(g,l,r,a,f,S,n,s,c,h,y,o,m,p,u,v,t,i,d)}}const EA="default";class AA extends _e{constructor(){super(h.Yg.CreateDefaultCacheStorageAndCacheManagers,["config","loggerFactory","windowProvider","coreSettings","scenarioFactory"])}async execute(e){const{windowProvider:t,config:n,loggerFactory:i,coreSettings:a,scenarioFactory:o}=e,r=new Tc(t.caches,EA,EA,n.experienceName);e.cacheStorage=r,e.offlineCacheManager=new Ic(r,i);(0,tu.Q6)(a)&&(e.workerCacheManager=Qd(n.experienceName,i.newLogger("CreateDefaultCacheStorageAndCacheManagersTask","core-services-tasks"),o))}}const _A="total";class FA{constructor(e,t,n,i,a){this.tid=e,this.oid=t,this.experienceName=n,this.windowProvider=i,this.keysUsageMetadata={},this.enableLocalStorageMetadata=false,this.getMetadataKey=e=>function(e){return e.substring(4)}(e.replace(/[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{8}/gi,"guid")),this.getTimestampForMetadata=()=>{const e=new Date;return`${`0${e.getMonth()+1}`.slice(-2)}${e.getDate()}${e.getFullYear()}`},this.logger=a.newLogger("LocalStorageService","services-io-browser-local-storage")}set(e,t,n,i="UserAndExperience"){try{this.rawSet(e,t,n,i)}catch(a){throw this.recordSetFailure(e,i,n,t,a?.name),a}}trySet(e,t,n,i="UserAndExperience"){try{return this.set(e,t,n,i),!0}catch(e){return!1}}get(e,t="UserAndExperience"){const n=this.getFormatKey(e,t),i=this.windowProvider.localStorage.getItem(n);return i&&null!==i?this.updateKeyUsageMetadata(n,i,"get",void 0):this.removeKeyUsageMetadata(n),i}remove(e,t="UserAndExperience"){const n=this.getFormatKey(e,t);this.windowProvider.localStorage.removeItem(n),this.removeKeyUsageMetadata(n)}clear(e){if(e){const t=e.map((e=>this.getFormatKey("",e)));Object.keys(this.windowProvider.localStorage).filter((e=>e.startsWith(rl)&&t.some((t=>e.startsWith(t))))).forEach((e=>{this.windowProvider.localStorage.removeItem(e),this.removeKeyUsageMetadata(e)}))}else this.windowProvider.localStorage.clear(),this.clearMetadata()}calculateUsageStats(){const e={Global:{},User:{},Experience:{},UserAndExperience:{},Unmanaged:{}};return Object.keys(this.windowProvider.localStorage).forEach((t=>{const n=this.getScopeFromKey(t);n&&(e[n][t]=sl(t,this.windowProvider.localStorage[t]))})),e}getUsageMetadataStats(){return{...this.keysUsageMetadata}}subscribeToCoreSettings(e){this.settingsObservable=e.getObservable(b.J.Core,["enableLocalStorageMetadata"]).subscribe((e=>{const{enableLocalStorageMetadata:t}=e;this.enableLocalStorageMetadata&&!t&&(this.keysUsageMetadata={}),this.enableLocalStorageMetadata=t||false}))}dispose(){this.settingsObservable?.unsubscribe(),this.keysUsageMetadata={}}rawSet(e,t,n,i="UserAndExperience"){const a=this.getFormatKey(e,i);this.windowProvider.localStorage.setItem(a,t),this.updateKeyUsageMetadata(a,t,"set",n)}getFormatKey(e,t){switch(t){case"Experience":return`${rl}${this.experienceName}.${e}`;case"User":return`${rl}${this.tid}.${this.oid}.${e}`;case"Global":return`${rl}${e}`;default:return`${rl}${this.tid}.${this.oid}.${this.experienceName}.${e}`}}getScopeFromKey(e){let t=this.getFormatKey("","UserAndExperience");return e.startsWith(t)?"UserAndExperience":(t=this.getFormatKey("","User"),e.startsWith(t)?"User":(t=this.getFormatKey("","Experience"),e.startsWith(t)?"Experience":(t=this.getFormatKey("","Global"),e.startsWith(t)?"Global":"Unmanaged")))}convertToKeyForTelemetry(e){return function(e){const t="draft.",n="draftindex.";let i=e.indexOf(t);return i>=0?i+=6:(i=e.indexOf(n),i>=0&&(i+=11)),i<0?e:`${e.substring(0,i)}threadId`}(e.replace(/[a-f0-9]{8}(?:-[a-f0-9]{4}){3}-[a-f0-9]{12}/gi,"guid"))}recordKeySizeChange(e,t,n,i,a,o){const r=this.keysUsageMetadata[t][_A];r.size+=i,r.accessCount++,r.lastAccessTime=a;const s=this.convertToKeyForTelemetry(e);this.logger.infoToTelemetry?.(`Key '${s}' update. Category: ${t}, new size: ${n}, size change: ${i}`,"localstorage_key_update",{name:this.convertToKeyForTelemetry(e),size:n,sizeChange:i,operationName:o,itemType:t},!0),0!==i&&this.logger.infoToTelemetry?.(`Category update: ${t}. New size: ${r.size}, size change: ${i}`,"localstorage_category_update",{name:t,size:r.size,sizeChange:i,operationName:o},!0)}recordSetFailure(e,t,n,i,a){const o=this.getFormatKey(e,t),r=sl(o,i);let s=0;if(this.enableLocalStorageMetadata){const e=this.getMetadataKey(o),t=this.keysUsageMetadata[n]&&this.keysUsageMetadata[n][e];s=t?.size||0}const l=r-s,c=this.convertToKeyForTelemetry(o);this.logger.errorToTelemetry?.(`Failed to save ${c}, category ${n}. Size: ${r}, size change: ${l}`,"localstorage_key_update",{name:this.convertToKeyForTelemetry(o),size:r,sizeChange:l,operationName:"set",errorCode:a,itemType:n},!0)}updateKeyUsageMetadata(e,t,n,i){if(!this.enableLocalStorageMetadata)return;const a=this.getMetadataKey(e);let o;if(i)o=this.keysUsageMetadata[i]&&this.keysUsageMetadata[i][a];else for(const e in this.keysUsageMetadata)if(this.keysUsageMetadata.hasOwnProperty(e)&&(o=this.keysUsageMetadata[e][a],o)){i=e;break}if(!i)return;const r=o?.size||0;let s=0;const l=this.getTimestampForMetadata();o?(s=sl(e,t),o.size=s,o.accessCount++,o.lastAccessTime=l):i&&(this.ensureCategoryExists(i),s=sl(e,t),this.keysUsageMetadata[i][a]={size:s,accessCount:1,lastAccessTime:l});const c=s-r;this.recordKeySizeChange(e,i,s,c,l,n)}removeKeyUsageMetadata(e){if(!this.enableLocalStorageMetadata)return;const t=this.getMetadataKey(e);let n;for(const i in this.keysUsageMetadata)if(this.keysUsageMetadata.hasOwnProperty(i)&&(n=this.keysUsageMetadata[i][t],n)){this.recordKeySizeChange(e,i,0,-n.size,this.getTimestampForMetadata(),"remove"),delete this.keysUsageMetadata[i][t];break}}ensureCategoryExists(e){this.keysUsageMetadata[e]||(this.keysUsageMetadata[e]={},this.keysUsageMetadata[e][_A]={size:0,accessCount:0,lastAccessTime:""})}clearMetadata(){for(const e in this.keysUsageMetadata){if(!this.keysUsageMetadata.hasOwnProperty(e))continue;const t=this.keysUsageMetadata[e];this.logger.infoToTelemetry?.(`Category update: ${e}. New size: ${t.size}, size change: ${-t.size}`,"localstorage_category_update",{name:e,size:0,sizeChange:-t.size,operationName:"remove"})}this.keysUsageMetadata={}}}const DA="default";class PA extends _e{constructor(){super(h.Yg.CreateDefaultLocalStorage,["config","loggerFactory","windowProvider"])}async execute(e){const{windowProvider:t,loggerFactory:n,config:i}=e,a=new FA(DA,DA,i.experienceName,t,n);return e.localStorage=a,e=>{switch(e){case"quit":case"restart":case"signout":a.dispose()}}}}class MA extends _e{constructor(){super(h.Yg.DisableExperience,["platformService","coreSettings","loggerFactory"])}async execute(e){const{platformService:t,coreSettings:n,loggerFactory:i}=e,a=t.config?.browser,{supportedBrowsers:o}=n.get(b.J.Core);if(a&&o){if(!!!o?.find((e=>e===a)))throw(0,de.Tr)(h.w5.Core,h.jK.Disabled,"DisableUnsupportedBrowsersTask",void 0,`Browser "${a}" is not supported.`)}else a||i.newLogger("DisableUnsupportedBrowsersTask","core-services-tasks").warn("Unable to detect Browser.")}}class xA extends _e{constructor(){super(h.Yg.CreateDiscovery,["authenticationService","loggerFactory","coreSettings","scenarioFactory","appStateService","networkState","hostCommunicationService","platformService"])}async execute(e){const{onDiscoverSuccess:t,onDiscoverFail:n}=this.getDiscoverCallback(e),{authenticationService:i,loggerFactory:a,coreSettings:o,scenarioFactory:r,appStateService:s,networkState:l,authStateProvider:c,i18n:d,hostCommunicationService:u,platformService:m}=e,p=(0,Gl.Gg)(s);e.discover=Vl(i,a,cl.l,o,r,p,l,u,d,c,void 0,t,n,void 0,void 0,void 0,{clientVersion:m.config.clientVersion,clientType:m.config.clientType})}getDiscoverCallback(e){let t,n;return e.platformService?.config.hostingParent===An.GJ.Outlook&&(t=()=>{e.windowProvider.sessionStorage.removeItem(BN.v4),e.windowProvider.sessionStorage.removeItem(BN.F_)},n=t=>{t||"true"!==e.windowProvider.sessionStorage.getItem(BN.F_)||(e.windowProvider.sessionStorage.setItem(BN.v4,"true"),e.windowProvider.location.reload())}),{onDiscoverSuccess:t,onDiscoverFail:n}}}var RA;!function(e){e[e.Success=0]="Success",e[e.InvalidArguments=1]="InvalidArguments",e[e.GroupNameExists=2]="GroupNameExists"}(RA||(RA={}));class jA{constructor(e){this.isCompleted=!1,this.subscriptions=new Set,this.observedValue=e,this.observable$=new(Oc())((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e,t){return this.isCompleted&&t.error("Subject: tried to subscribe to a complete observable"),this.observable$.subscribe(e)}onNext(e){this.observedValue=e,this.subscriptions.forEach((t=>{t.next({...e})}))}onComplete(){this.isCompleted=!0,this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.isCompleted=!0,this.subscriptions.forEach((t=>{t.error(e)}))}get value(){return this.observedValue}}class LA{constructor(){this._endpointsHealthCache={},this._groupsHealthCache={},this.getEndpointHealth=(e,t)=>{if(e&&t){const n=this._endpointsHealthCache[this._getCacheKey(e,t)];return n?{...n.value}:void 0}},this.observeEndpointHealth=(e,t)=>e&&t?this._getHealthRecord(e,t).observable:void 0,this.observeAggregatedHealth=e=>e?this._getHealthRecord(e,void 0).observable:void 0,this.dumpState=()=>JSON.stringify({...this._endpointsHealthCache,...this._groupsHealthCache},((e,t)=>t instanceof jA?t.value:t)),this.updateRemoteEndpointHealth=e=>{if(!e.serviceName)return;const t=this._getHealthRecord(e.serviceName,e.endpointName);t.value.isHealthy!==e.isHealthy&&(t.value.isHealthy=e.isHealthy,t.onNext(t.value))},this._getCacheKey=(e,t)=>`${e}_${t||""}`,this._getHealthRecord=(e,t)=>(t?this._endpointsHealthCache[this._getCacheKey(e,t)]:this._groupsHealthCache[this._getCacheKey(e,t)])||this._startTrackingHealth(e,t),this._startTrackingHealth=(e,t)=>{if(t){const n=new jA({serviceName:e,endpointName:t,isHealthy:void 0});return this._endpointsHealthCache[this._getCacheKey(e,t)]=n,n}{const n=new jA({groupName:e,isHealthy:void 0});return this._groupsHealthCache[this._getCacheKey(e,t)]=n,n}}}getAggregatedHealth(e){if(e){const t=this._groupsHealthCache[this._getCacheKey(e,void 0)];return t?{...t.value}:void 0}}dispose(){this._endpointsHealthCache={},this._groupsHealthCache={}}}class OA{constructor(e,t){this._endpointsManager=e,this._logger=t,this._subscriptions=[],this._aggregatedHealthMap=new Map,this._remoteEndpointsHealthCache=new LA,this.observeEndpointHealth=(e,t)=>this._getLocalEndpointHealth(e,t)?this._getLocalEndpointObservable(e,t):this._getRemoteEndpointHealth(e,t)?this._getRemoteEndpointObservable(e,t):this._getLocalEndpointObservable(e,t),this.getEndpointHealth=(e,t)=>this._getLocalEndpointHealth(e,t)||this._getRemoteEndpointHealth(e,t),this.observeAggregatedHealth=e=>this._aggregatedHealthMap.get(e)?.healthSubject.observable,this.getAggregatedHealth=e=>this._getLocalAggregatedHealth(e)||this._getRemoteAggregatedHealth(e),this.dumpState=()=>(0,$.LQ)(`{ "aggregated endpoints health": [\n      ${this._printAggregatedHealth(this._aggregatedHealthMap)}\n    ],\n    "endpoints health": [\n      ${this._endpointsManager.health.dumpState()}\n    ]},\n    "remote endpoints health": ${this._remoteEndpointsHealthCache.dumpState()}`),this.getWorkerDumpState=()=>this._requestWorkerStateDumpCallback?(this._deferredWorkerStateDump=(0,zc.P)(),this._requestWorkerStateDumpCallback(),this._deferredWorkerStateDump.promise):Promise.reject("Worker endpoints health snapshot can't be requested"),this.getEndpointsHealthUpdateHandler=()=>({handleEndpointHealthUpdate:this._remoteEndpointsHealthCache.updateRemoteEndpointHealth,handleStateDump:this._handleWorkerStateDumpResponse,onStateDumpRequest:this._setWorkerStateDumpRequestCallback}),this._getLocalEndpointHealth=(e,t)=>this._endpointsManager.health.getEndpointHealth(e,t),this._getLocalEndpointObservable=(e,t)=>this._endpointsManager.health.observeEndpointHealth(e,t),this._getRemoteEndpointHealth=(e,t)=>this._remoteEndpointsHealthCache.getEndpointHealth(e,t),this._getRemoteEndpointObservable=(e,t)=>this._remoteEndpointsHealthCache.observeEndpointHealth(e,t),this._updateAggregatedHealth=(e,t,n)=>{const i=e.healthSubject.value,a=[];if(i.endpoints)for(const e of i.endpoints)if(e.endpointName===t.endpointName&&e.serviceName===t.serviceName)a.push(t);else{const t=this._endpointsManager.health.getEndpointHealth(e.serviceName,e.endpointName);t&&a.push(t)}try{const t=n(a);t!==i.isHealthy&&(i.isHealthy=t,e.healthSubject.onNext(i))}catch(e){this._logger.error(`Error happened in aggregated group health policy. Group: ${i.groupName}. Error: ${JSON.stringify(e.reason||e)}`)}},this._printAggregatedHealth=e=>{let t="";return e.forEach((e=>{t=`${t},${JSON.stringify(e.healthSubject.value)}`})),t?(0,$.LQ)(t):""},this._handleWorkerStateDumpResponse=e=>{this._logger.log("Received worker endpoints health state dump."),this._deferredWorkerStateDump&&(this._deferredWorkerStateDump.resolve(e),this._deferredWorkerStateDump=void 0)},this._setWorkerStateDumpRequestCallback=e=>{this._requestWorkerStateDumpCallback=e}}createAggregatedHealthGroup(e,t,n){if(!e||0===e.length||!t||0===t.length)return this._logger.error(`createAggregatedHealthGroup: Group name is empty or no endpoints are provided. groupName: ${e}; endpoints: ${t&&JSON.stringify(t)}`),RA.InvalidArguments;if(this.getAggregatedHealth(e))return this._logger.error(`createAggregatedHealthGroup: Group name already exists. groupName: ${e}`),RA.GroupNameExists;const i={healthSubject:new jA({groupName:e,endpoints:t,isHealthy:void 0})};return this._aggregatedHealthMap.set(e,i),t.forEach((t=>{const i=this.observeEndpointHealth(t.serviceName,t.endpointName)?.subscribe((t=>{const i=this._aggregatedHealthMap.get(e);i||this._logger.error(`Can't update group health. Group '${e}' is not registered`),i&&this._updateAggregatedHealth(i,t,n)}));i&&this._subscriptions.push(i)})),RA.Success}dispose(){this._subscriptions.map((e=>e.unsubscribe())),this._subscriptions=[],this._aggregatedHealthMap.clear(),this._remoteEndpointsHealthCache.dispose(),this._requestWorkerStateDumpCallback=void 0,this._deferredWorkerStateDump?.reject("CombinedEndpointsHealthService is disposed"),this._deferredWorkerStateDump=void 0}_getLocalAggregatedHealth(e){return this._aggregatedHealthMap.get(e)?.healthSubject.value}_getRemoteAggregatedHealth(e){return this._remoteEndpointsHealthCache.getAggregatedHealth(e)}}class $A{constructor(e,t){this._endpointsManager=e,this._logger=t,this._subscriptions=[],this._aggregatedHealthMap=new Map,this.observeEndpointHealth=(e,t)=>this._endpointsManager.health.observeEndpointHealth(e,t),this.getEndpointHealth=(e,t)=>this._endpointsManager.health.getEndpointHealth(e,t),this.observeAggregatedHealth=e=>this._aggregatedHealthMap.get(e)?.healthSubject.observable,this.getAggregatedHealth=e=>this._aggregatedHealthMap.get(e)?.healthSubject.value,this.dumpState=()=>`{ "aggregated endpoints health": [\n      ${this._printAggregatedHealth(this._aggregatedHealthMap)}\n    ],\n    "endpoints health": [\n      ${this._endpointsManager.health.dumpState()}\n    ]}`,this._updateAggregatedHealth=(e,t,n)=>{const i=e.healthSubject.value,a=[];if(i.endpoints)for(const e of i.endpoints)if(e.endpointName===t.endpointName&&e.serviceName===t.serviceName)a.push(t);else{const t=this._endpointsManager.health.getEndpointHealth(e.serviceName,e.endpointName);t&&a.push(t)}try{const t=n(a);t!==i.isHealthy&&(i.isHealthy=t,e.healthSubject.onNext(i))}catch(e){this._logger.error(`Error happened in aggregated group health policy. Group: ${i.groupName}. Error: ${JSON.stringify(e.reason||e)}`)}},this._printAggregatedHealth=e=>{let t="";return e.forEach((e=>{t=`${t},${JSON.stringify(e.healthSubject.value)}`})),t?(0,$.LQ)(t):""}}createAggregatedHealthGroup(e,t,n){if(!e||0===e.length||!t||0===t.length)return this._logger.error(`createAggregatedHealthGroup: Group name is empty or no endpoints are provided. groupName: ${e}; endpoints: ${t&&JSON.stringify(t)}`),RA.InvalidArguments;if(this.getAggregatedHealth(e))return this._logger.error(`createAggregatedHealthGroup: Group name already exists. groupName: ${e}`),RA.GroupNameExists;const i={healthSubject:new jA({groupName:e,endpoints:t,isHealthy:void 0})};return this._aggregatedHealthMap.set(e,i),t.forEach((t=>{const i=this.observeEndpointHealth(t.serviceName,t.endpointName)?.subscribe((t=>{const i=this._aggregatedHealthMap.get(e);i||this._logger.error(`Can't update group health. Group '${e}' is not registered`),i&&this._updateAggregatedHealth(i,t,n)}));i&&this._subscriptions.push(i)})),RA.Success}dispose(){this._subscriptions.map((e=>e.unsubscribe())),this._subscriptions=[],this._aggregatedHealthMap.clear()}}var UA=n(780073),BA=n(133598),WA=n.n(BA);const HA=({url:e,method:t,body:n,headers:i,credentials:a,timeout:o,signal:r},s,l)=>{if(r?.aborted)throw(0,Ks.T)(Qs.A.RequestCancelled);return Ys(WA()(e,{method:t,headers:i&&new Headers(i),body:n,signal:r,credentials:a}),s,o??l.defaultRequestTimeoutInMs).then((e=>{const t={};return e.headers?.forEach(((e,n)=>t[n]=e)),{status:e.status,headers:t,body:e,url:e.url}}))},VA="failed to fetch";const GA=async(e,t)=>{const n=e.operationLogger.logStep(Hs.nz.AuthDecorate);try{const i=await t(e);return n(Hs.qb[Hs.qb.OK]),i}catch(e){throw n(Qs.A.AuthFailed),(0,Ks.T)(Qs.A.AuthFailed,void 0,e)}},zA=async(e,t,n)=>{const i=t.operationLogger.beginStep(Hs.nz.AuthResolve,t);try{const a=n(e,t);return a.then((t=>(t&&i(Hs.qb[e.status],e),t))),await a}catch(t){throw i(Hs.qb[e.status],e),(0,Ks.T)(Qs.A.AuthResolveFailed,e,t)}};function qA(e,t=Hs.qb.NOT_FOUND){return Array.isArray(t)?t.some((t=>JA(e,t))):JA(e,t)}function JA(e,t){return"string"==typeof t?new RegExp(t.replace(/x/gi,"\\d")).test(e.toString()):e===t}const QA=(e,t)=>t.indexOf(e)>-1||t.filter(KA).map((e=>new RegExp(e.replace(/x/gi,"\\d")))).some((t=>t.test(e.toString())));function KA(e){return"string"==typeof e}const YA=(e,t,n,{globalContext:i})=>async a=>{let o=await XA(e)(a);for(let r=0;;r++){const{response:s,error:l}=o,c=s?.status,d=c||l?.reason||Qs.A.FailedToFetch,u=s?.headers,m=n.get(d)||0;if(n.set(d,m+1),!t.shouldRetry(r,d,n,u)){if(l)throw l;return o.response}{const n=t.nextDelay(r,u,d),m=c&&Hs.qb[c]||void 0;a.operationLogger.nextStep(Hs.nz.RetryDelay,l||m,void 0,s),await Xs(n,i),a.operationLogger.nextStep(Hs.nz.Retry,Hs.qb[Hs.qb.OK],a),o=await XA(e)(a)}}},XA=e=>async t=>{try{return{response:await e(t)}}catch(e){return{response:e.serverResponse,error:e}}};const ZA=(e,t)=>{if(e){const n=t.get(e);if(!n)throw(0,Ks.T)(Qs.A.InvalidCancellationToken);return n}},e_=(e,t,n,i)=>{const{cancellationMap:a}=i;let o=e;return o=function(e,t,n){return async i=>{const{cancellationToken:a}=i,o=ZA(a,t)??new AbortController;i.signal=o.signal;try{return await e(i)}catch(e){throw e?.reason!==Qs.A.TimedOut||void 0!==n&&!n||o.abort(),e}}}(o,i.cancellationMap,t.abortOnTimeout),n.authResource&&(o=((e,t)=>async n=>{const i=await GA(n,t),a=i.request,o=await e(a),r=await zA(o,a,i.resolver);return r?(r.operationLogger.nextStep(Hs.nz.Auth,Hs.qb[o.status],r,o),e(r)):o})(o,n.authResource)),o=((e,t,n)=>async i=>{const{baseUrl:a,baseUrlPromise:o}=t,r=i.operationLogger.logStep(Hs.nz.BaseUrlResolve),s=a||o&&await Ys(o().catch((e=>{throw r(e.reason),(0,Ks.T)(Qs.A.BaseUrlFailedToResolve,void 0,e)})),n.globalContext,n.configuration.baseUrlResolutionTimeoutInMs,Qs.A.BaseUrlTimeout);try{if(s){const e=!s.endsWith("/")&&i.url.length>0?`${s}/`:s,t=i.url.startsWith("/")?i.url.substring(1):i.url;i.url=new URL(t,e).href}}catch(e){throw r(Qs.A.InvalidUrl),(0,Ks.T)(Qs.A.InvalidUrl)}return r(Hs.qb[Hs.qb.OK]),e(i)})(o,n,i),o=((e,t,n)=>{if(!t.redirectPolicy)return e;const{maxRedirects:i,useAbsoluteRedirect:a,headers:o,redirectOn:r,onRedirect:s}=t.redirectPolicy;return async t=>{const l={...t,headers:{...t.headers,...o}};let c=await e(l);for(let o=0;;o++){const{status:d,headers:{location:u}}=c;if(!(o<i&&qA(d,r)))return c;try{let e;if(s?e=s(u,d):u&&(e=new URL(u)),!e)return c;a?(n.baseUrl=e.origin,l.url=e.pathname):(l.url=t.url,n.baseUrl=e.href)}catch(e){throw(0,Ks.T)(Qs.A.InvalidUrl,void 0,e)}l.operationLogger.nextStep(Hs.nz.Redirect,Hs.qb[c.status],l,c),c=await e(l)}}})(o,t,n),t.rejectHttpError&&(o=function(e){return async t=>{const n=await e(t);if(n.status>=Hs.qb.BAD_REQUEST)throw(0,Ks.T)(Qs.A.RequireStatusFailed,n,[Hs.qb[n.status]]);return n}}(o)),t.allowedResponses&&(o=function(e,...t){return n=>e(n).then((e=>{if(QA(e.status,t))return e;const n=[Hs.qb[e.status]];throw(0,Ks.T)(Qs.A.RequireStatusFailed,e,n)}))}(o,...t.allowedResponses)),t.retryPolicy&&(o=function(e,t,n){const i=new Map;return a=>YA(e,t,i,n)(a)}(o,t.retryPolicy,i)),o=((e,t)=>async n=>{const{cancellationToken:i}=n;i&&t.set(i,new AbortController);try{return await e(n)}finally{i&&t.delete(i)}})(o,a),o};function t_(e,t,n){if(!t)return;const i=n?new URL(n.url).hostname:"";return{name:t.apiName||"",dateTime:e,method:t.method,hostname:i,requestHeaders:t.headers||{},responseHeaders:n?.headers||{},status:n?.status,performance:n_(n?.url),authPerformanceLogs:t.authPerformanceLogs||{}}}function n_(e){return e?new Promise((t=>{const n=new PerformanceObserver((i=>{const a=i.getEntries().find((t=>e===t.name));a&&(n.disconnect(),t(a))}));n.observe({entryTypes:["resource"]})})):Promise.reject()}class i_{constructor(e){this.subscriptions=new Set,this.observedValue=e,this.observable$=new(Oc())((e=>(this.subscriptions.add(e),()=>{this.subscriptions.has(e)&&this.subscriptions.delete(e)})))}get observable(){return this.observable$}subscribe(e){return this.observable$.subscribe(e)}onNext(e){this.observedValue=e,this.subscriptions.forEach((t=>{t.next(e)}))}onComplete(){this.subscriptions.forEach((e=>{e.closed||e.complete()}))}onError(e){this.subscriptions.forEach((t=>{t.error(e)}))}get value(){return this.observedValue}}const a_=!0,o_=new i_(a_);const r_=()=>{const e=new Map,t=(t,n)=>e.get(c_(t,n))||((t,n)=>{const i={responseHistory:[],healthSubject:new i_({serviceName:t,endpointName:n,isHealthy:void 0})};return e.set(c_(t,n),i),i})(t,n),n=(e,n,i,a)=>{const o=t(n,e);((e,t,n)=>{e.responseHistory.push(t),e.responseHistory.length>n&&e.responseHistory.shift()})(o,i,a.historyLength);const r=a.isHealthy([...o.responseHistory]);if(o.healthSubject.value.isHealthy!==r){const t={serviceName:n,endpointName:e,isHealthy:r};o.healthSubject.onNext(t)}};return{trackHealth:(e,t,i)=>d_(e,n,t,s_(i)),observeEndpointHealth:(e,n)=>{if(!e||!n)return;return t(e,n).healthSubject.observable},getEndpointHealth:(t,n)=>l_(t,n,e),dumpState:()=>m_(e)}},s_=e=>({...u_,...e}),l_=(e,t,n)=>{const i=n.get(c_(e,t))?.healthSubject.value;return i&&{...i}},c_=(e,t)=>`${e}_${t}`,d_=(e,t,n,i)=>async a=>e(a).then((e=>(t(a.apiName||"",n,e.status,i),e))).catch((e=>{throw t(a.apiName||"",n,e.reason,i),e})),u_={isHealthy:e=>{if(e&&e.length>0){const t=e[e.length-1];if("number"!=typeof t&&t!==Qs.A.RequestCancelled)return!1}return!0},historyLength:5};const m_=e=>{let t="";return e.forEach((e=>{t=`${t}${JSON.stringify(e.healthSubject.value)}`})),t?null==(n=t)||0===n.length?n:` ${n}`.substr(1):"";var n},p_=e=>async t=>{try{if(e.transformResponse)return await e.transformResponse(t);if(t.status===Hs.qb.NO_CONTENT)return;const n=e.responseType||function(e){if(e.headers){const t=e.headers["content-type"];if(t){if(-1!==t.indexOf("application/json"))return"json";if(-1!==t.indexOf("text/"))return"text"}if("0"===e.headers["content-length"])return"text"}return}(t)||"json";return await(t.body&&t.body[n]?.())}catch(e){throw"AbortError"===e.name?(0,Ks.T)(Qs.A.RequestCancelled):(0,Ks.T)(Qs.A.TransformFailed,t,e)}};const g_=(e,t,n)=>{let i,a;return t.then((e=>{if(e.throttlePolicy){a=e.throttlePolicy;const t=a?.throttleKey;t?(i=n.get(t)||[],n.has(t)||n.set(t,i)):i=[]}})),t=>a?n=>async function n(o){const r=function(e,t){const{maxPerThrottleInterval:n,throttleInterval:i}=t,a=Date.now()-i;let o=e.length-1;for(;o>=0&&a<e[o];)o--;e.splice(0,o);const r=e.length-n;return r>=0?e[r]-a:0}(i,a);if(!r)return function(e){return i.push(Date.now()),t(e)}(o);const s=o.operationLogger.logStep(Hs.nz.Throttle);return await Xs(r,e),s&&s(Hs.qb[Hs.qb.OK]),n(o)}(n):t};function h_(e,t){const{globalContext:n}=t,i=new Map,a=new Map,{networkMonitor:o,networkState:r}=(()=>{const e=e=>o_.onNext(e);return{networkMonitor:{processResponse:t=>{t.status===Hs.qb.NETWORK_AUTHENTICATION_REQUIRED?e(!1):void 0!==t.status&&t.status!==Hs.qb.NOT_MODIFIED&&t.status!==Hs.qb.GATEWAY_TIMEOUT&&e(a_)},processResponseError:t=>{t&&(t.reason===Qs.A.RejectHttpError?e(!1):t.serverResponse&&e(a_))}},networkState:{observeIsOnline:()=>o_.observable,isOnline:()=>o_.value}}})(),s=((e,t)=>async n=>{const i=t(n).then((t=>(e.processResponse(t),t))).catch((t=>{throw e.processResponseError(t),t}));return i})(o,function(e){return async t=>{try{return await e(t)}catch(e){if(e instanceof TypeError&&e.message?.toLowerCase()===VA){const n=t.headers&&t.headers.cache;if(n&&-1!==n.indexOf("only-if-cached"))return{status:Hs.qb.GATEWAY_TIMEOUT};e=(0,Ks.T)(Qs.A.RejectHttpError,void 0,e)}throw"AbortError"===e.name&&(e=(0,Ks.T)(Qs.A.RequestCancelled)),e}}}(((e,t)=>async n=>HA(n,e,t))(n,t.configuration))),{trackHealth:l,...c}=r_();return{createApi:n=>y_(n,e,{...t,cancellationMap:i,trackHealth:l,throttleMap:a},s),createCancelToken:()=>{const e=(0,Re.v4)();return{token:e,cancel:()=>{const t=i.get(e);return t&&t.abort(),!t}}},networkState:r,health:c}}const y_=(e,t,n,i)=>{const a={},o=e(t),{baseUrlPromise:r,models:s}=o;r&&r();for(const e in s){const t=s[e];a[e]=v_(e,t,o,n,i)}return a},v_=(e,t,n,i,a)=>{const{trackHealth:o,throttleMap:r,globalContext:s}=i,l=g_(s,t,r),{telemetryProvider:c}=i,{serviceName:d}=n;return async(...r)=>{let u,m,p,g;const h=(new Date).toISOString(),y=performance.now();try{const e=await Ys(t.catch((e=>{throw(0,Ks.T)(Qs.A.ModelFailedToInitialize,void 0,e)})),s,i.configuration.modelInitializationTimeoutInMs,Qs.A.ModelTimeOut);let c=e_(a,e,n,i);u=e.constructRequest(...r),u.operationLogger=(e=>{const t=[];let n;const i=(e,n,i)=>{const a=new Date;return(o,r,s)=>{t.push({type:e,duration:o-n,result:r,request:t_(a,i,s)})}},a=(e,t)=>{const a=performance.now();return(o,r)=>{n(a,o,r),n=i(e,a,t)}};return n=i(Hs.nz.Initial,performance.now(),e),{nextStep:(e,t,n,i)=>{a(e,n)(t,i)},beginStep:a,logStep:(e,t,n)=>{const a=i(e,performance.now(),t);return e=>a(performance.now(),e,n)},complete:(e,i)=>(n(performance.now(),e,i),t)}})(u),c=o(c,n.serviceName,e.healthPolicy),c=l(c);try{g=e.customTelemetry?.(...r)}catch(e){throw(0,Ks.T)(Qs.A.CustomTelemetryFailed,void 0,e)}return m=await c(u),p_(e)(m)}catch(e){throw e.serverResponse&&(m=e.serverResponse),p=e,e}finally{const t=performance.now()-y,n=u?.correlationId,i=m?.status,a=i&&Hs.qb[i]||void 0,o=u?.operationLogger.complete(p||a,m)||[];c({apiName:e,serviceName:d,createdTime:h,parameters:g,duration:t,result:p?.reason||a||"",statusCode:i,innerError:p?.innerException,operationLogs:o,correlationId:n})}}};class f_ extends _e{constructor(){super(h.Yg.CreateEndpointsManager,["coreSettings"])}async execute(e){const{loggerFactory:t,windowProvider:n,coreSettings:i}=e,{disableEndpointsHealthService:a,enableCombinedEndpointsHealthService:o}=i.get(b.J.Core);var r;e.endpointsManager=h_(e,{globalContext:n,telemetryProvider:(0,UA.YK)(n,i,t.newLogger("EPM","core-services-tasks"),e.authenticationUser?.id),configuration:(r=i.get(b.J.Core),{modelInitializationTimeoutInMs:r.endpointsManagerModelInitializationTimeoutInMs||3e4,baseUrlResolutionTimeoutInMs:r.endpointsManagerBaseUrlResolutionTimeoutInMs||12e4,defaultRequestTimeoutInMs:r.endpointsManagerDefaultRequestTimeoutInMs||3e4})}),a?t.newLogger("EndpointsHealthService","core-services-tasks").log("Disabled by disableEndpointsHealthService feature flag"):(e.endpointsHealthService=o?new OA(e.endpointsManager,t.newLogger("CombinedEndpointsHealthService","core-services-tasks")):new $A(e.endpointsManager,t.newLogger("EndpointsHealthService","core-services-tasks")),(0,ii.Yf)().setEndpointHealth(e.endpointsHealthService.getEndpointHealth))}}const S_={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"CoreServicesTasksRemoveUserActiveWindowsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeUserActiveWindows"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};class k_ extends _e{constructor(){super(h.Yg.CreateEntityCommanding,[])}async execute(e){const{activeWindowsService:t,client:n,commandHandler:i,commandDelegator:a,eventHandler:o,windowProvider:r,hostCommunicationService:s,scenarioFactory:l,loggerFactory:c,deeplinkService:d,coreSettings:u}=Mm("CreateEntityCommandingTask",e,"activeWindowsService","client","commandHandler","commandDelegator","eventHandler","windowProvider","hostCommunicationService","scenarioFactory","loggerFactory","deeplinkService","coreSettings"),m=e.authenticationUser?(0,xe.b4)(e.authenticationUser):void 0,{entityCommanding:p,eventing:g}=Ia(i,a,o,n,u,r,l,c,d,s,m,void 0,t.getWindowLayoutService());return e.entityCommanding=p,e.eventing=g,async e=>{if("signout"===e)await n.mutate({mutation:S_,variables:{userContextId:m}})}}}class C_ extends _e{constructor(){super(h.Yg.CreateEventHandler,["appsRegistryService","client","clientPreferences","commandChangeReportingService","coreSettings","hostCommunicationService","i18n","loggerFactory","notificationsHandler","scenarioFactory","shortcutExecutionService","userBiService"])}async execute(e){const{appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,coreSettings:o,hostCommunicationService:r,i18n:s,loggerFactory:l,notificationsHandler:c,scenarioFactory:d,shortcutExecutionService:u,userBiService:m}=e;e.eventHandler=(e,p,g)=>Ot({appsRegistryService:t,client:n,clientPreferences:i,commandChangeReportingService:a,commandDelegator:g,commandHandler:p,coreSettings:o,eventInput:e,i18n:s,loggerFactory:l,notificationsHandler:c,scenarioFactory:d,shortcutExecutionService:u,userBiService:m,hostCommunicationService:r})}}const b_={RejectIncomingCall:dA.Yu.toastCallingRejectIncomingCall,IgnoreIncomingCall:dA.Yu.toastCallingIgnoreIncomingCall,AcceptIncomingCallContentOnly:dA.Yu.toastCallingAcceptIncomingCallContentOnly,AcceptIncomingCallThroughPrejoin:dA.Yu.toastCallingAcceptIncomingCallThroughPrejoin,AcceptIncomingCallWithAudio:dA.Yu.toastCallingAcceptIncomingCallWithAudio,AcceptIncomingCallWithVideo:dA.Yu.toastCallingAcceptIncomingCallWithVideo,AcceptIncomingScreenshareOnlyCall:dA.Yu.toastCallingAcceptIncomingScreenshareOnlyCall,Error:dA.Yu.toastCallingError,NavigateToCallTab:dA.Yu.toastCallingNavigateToCallTab,ReplyIncomingCall:dA.Yu.toastCallingReplyIncomingCall,ResumeCallTransfer:dA.Yu.toastCallingResumeCallTransfer,TimeOut:dA.Yu.toastCallingTimeOut,Unknown:dA.Yu.toastCallingUnknown,onAcceptTelemetryCleanup:dA.Yu.toastAcceptTelemetryCleanup,onDismissTelemetryCleanup:dA.Yu.toastDismissTelemetryCleanup,canNotifyForCallingNotification:dA.Yu.toastCallingNotDroppedByDND,JoinMeetingFromToast:dA.Yu.joinMeeting,JoinAudioDropInFromToast:dA.Yu.toastJoinAudioDropIn,OpenChatList:dA.Yu.openChatConversationFromToast},w_={RejectIncomingCall:dA.rA.toastRejectIncomingCall,AcceptIncomingCallContentOnly:dA.rA.toastAcceptIncomingCall,AcceptIncomingCallThroughPrejoin:dA.rA.toastAcceptIncomingCall,AcceptIncomingCallWithAudio:dA.rA.toastAcceptIncomingCall,AcceptIncomingCallWithVideo:dA.rA.toastAcceptIncomingCall,AcceptIncomingScreenshareOnlyCall:dA.rA.toastAcceptIncomingCall,ReplyIncomingCall:dA.rA.toastReplyIncomingCall,ResumeCallTransfer:dA.rA.toastResumeCallTransfer},T_=(e,t,n,i)=>{if(!e)return void t.error("coreServicesEntityCommanding: UserBiService is not available.");const a={[Se.py.chats]:I_,[Se.py.channels]:N_,[Se.py.calls]:F_,[Se.py.communities]:E_,[Se.py.communitiesevents]:__,[Se.py.communitiesjoinrequest]:E_,[Se.py.communitiesmembers]:E_,[Se.py.settingsstore]:A_}[n.entity.type];if(a){let t;e.createDatabag&&(t=e.createDatabag(),t.isCustomNotification=Boolean(i)),a(e,n,t),t?.dispose()}},I_=(e,t,n)=>{const{dataOptions:i,entity:a,entityOptions:o}=t;if(n&&i){const{toastType:e}=i;n.chatToastType=e}if(i?.actionType===ei.quickReply)e.recordPanelAction({actionGesture:dA.uS.click,actionScenario:dA.Tk.toastActivation,actionScenarioType:dA.Yu.quickReplyFromToast,moduleName:dA.rA.chatToastQuickreply,dataBag:n});else if(a.action===Se.uk.view&&(e.recordPanelAction({actionGesture:dA.uS.click,panelRegion:dA.Ai.toast,panelType:dA.wh.chatToast,actionScenario:dA.Tk.toastActivation,actionScenarioType:dA.Yu.openChatConversationFromToast,dataBag:n}),o)){const{campaignType:t}=o;if(t){n&&(n.identifier=t);const i={panelType:dA.wh.SyntheticNotification,panelRegion:dA.Ai.toast,dataBag:n};e.recordPanelView(i)}}},N_=(e,t,n)=>{const{entity:i}=t;i.action===Se.uk.view&&e.recordPanelAction({actionGesture:dA.uS.click,panelRegion:dA.Ai.toast,panelType:dA.wh.channelsToast,actionScenario:dA.Tk.toastActivation,actionScenarioType:dA.Yu.openChannelsConversationFromToast,dataBag:n})},E_=(e,t,n)=>{const{dataOptions:i,entity:a}=t;if(n){const{toastType:e}=i;n.communitiesToastType=e}a.action===Se.uk.view&&e.recordPanelAction({actionGesture:dA.uS.click,panelRegion:dA.Ai.toast,panelType:dA.wh.communitiesToast,actionScenario:dA.Tk.toastActivation,actionScenarioType:dA.Yu.openCommunitiesConversationFromToast,teamId:i?.teamId,dataBag:n})},A_=(e,t,n)=>{const{dataOptions:i}=t;if(n&&i){const{subType:e,type:t}=i;n.subType=e,n.type=t}e.recordPanelAction({actionGesture:dA.uS.click,panelRegion:dA.Ai.toast,panelType:dA.wh.toastMoreMenu,actionScenario:dA.Tk.toastActivation,actionScenarioType:dA.Yu.openSettingsFromToast,dataBag:n})},__=(e,t,n)=>{const{dataOptions:i,entity:a}=t;if(n){const{toastType:e}=i;n.communitiesToastType=e}a.action===Se.uk.view&&e.recordPanelAction({actionGesture:dA.uS.click,panelRegion:dA.Ai.toast,panelType:dA.wh.communitiesEventsToast,actionScenario:dA.Tk.toastActivation,actionScenarioType:dA.Yu.openCommunitiesEventsFromToast,dataBag:n})},F_=(e,t,n)=>{const{dataOptions:i}=t;if(!i)return;const{actionType:a,toastType:o}=i,r=b_[a],s=w_[a];n&&(n.correlationId=t.command?.correlation.id,n.callingToastType=o),r&&e.recordPanelAction({actionGesture:dA.uS.click,panelRegion:dA.Ai.toast,panelType:dA.wh.callingToast,actionScenario:dA.Tk.toastActivation,actionScenarioType:r,moduleName:s,dataBag:n})};async function D_({activeWindowsService:e,coreSettings:t,renderingContext:n,isHostCommandNotification:i,handlerCommand:a,logger:o,notificationUserContextId:r,appsRegistryService:s,logPrefix:l}){const c=l||"";if(i&&a.command){const{enableDecoupleCommandingFromApollo:i,enableMinimodeWindow:l,enableMTMANotificationsMainWindow:d,enableWindowModeLayout:u}=t.get(b.J.Core),m=i?e.getActiveWindows():await(0,us.Ko)(n.client),p=m.find((e=>e.layoutConfig.layoutMode===ke.lO.minimode)),g=m.find((e=>e.layoutConfig.layoutMode===ke.lO.standard));if(o.log(`${c}State transition before override: ${a.command.stateTransition}`),!l||!M_(a.entity)||!p&&g||r&&p&&p.userContextId!==r){const e=P_({appsRegistryService:s,coreSettings:t,entity:a.entity});if(o.log(`${c}allowUserWindowingPreference: ${e}`),g&&g.userContextId!==r)d&&(o.log(`${c}User context of notification does not match main window user`),e||a.command.stateTransition===ke.su.new?a.command.stateTransition=ke.su.new:(o.log(`${c}Entity must be opened in main window`),a.command.stateTransition=ke.su.forceFlush,a.command.targetWindow=ke.PH.main));else if(o.log(`${c}User context of notification matches main window user`),u&&e){const e=n.clientPreferences.getPreferences("windowing")?.shouldOpenContentInNewWindow;a.command.stateTransition=e?ke.su.new:ke.su.flush,o.log(`${c}Respecting user preference for toast shouldOpenContentInNewWindow ${e}`)}}else a.command.layoutMode=ke.lO.minimode,a.command.stateTransition=ke.su.flush,o.log(`${c}Redirecting chat toasts to minimode window if no popout chat is open`);o.log(`${c}Final stateTransition after override ${a.command?.stateTransition}`)}return a}const P_=({appsRegistryService:e,coreSettings:t,entity:n})=>e.getApp({entityType:n.type})?.manifest.getAllowUserWindowingPreference?.({coreSettings:t,entity:n})||!1,M_=e=>e.type===Se.py.chats&&"welcomePage"!==e.id;const x_=(e,t,n,i,a)=>async({payload:o},r=!1)=>{const s=t=>e.errorToTelemetry?.(t,"webclient_framework_foundation_external_command_listener",void 0,!0);try{if(o&&o.entity&&o.command&&o.entity.type in Se.py&&o.entity.action in Se.uk&&o.command.visibilityState in ke.fe&&o.command.stateTransition in ke.su){const{entity:l,entityOptions:c,dataOptions:d,command:u,windowOptions:m}=o,{linkedEntity:p}=l;if(p){if(!p.id||!(p.type in Se.py)){const e=`Missing id ${!p.id} or linked entity type ${p.type}`;return s(e),Promise.reject(new Error(e))}}else l.linkedEntity=null;u.correlation=u.correlation||{},u.correlation.source=u.correlation.source||C.D.ExternalCommand;const g=d?.userContextId;e.log(`Got userContextId: ${g} from dataOptions`);const h=t(!1,g),y=1e4;(0,V.E)(h,y).catch((()=>{s(`waitForRenderingContextReady timed out after ${y}ms`)}));const v=await h;e.log(`got renderingContext for userContextId: ${g}`);const f={dataOptions:d,entity:l,entityOptions:c,command:Wn(u),windowOptions:m};return e.log(`External command isHostComm ${r}, type ${l.type}, action ${l.action}`),await D_({activeWindowsService:i,coreSettings:n,renderingContext:v,isHostCommandNotification:r,handlerCommand:f,logger:e,notificationUserContextId:g,appsRegistryService:a}),T_(v.userBiService,e,f),v.commandHandler(f)}const l=function(e){let t=`payload(${!!e})`;if(e){const{entity:n,command:i}=e;if(t+=` entity(${!!n}) command(${!!i})`,n&&i){const{type:e,action:a}=n,{visibilityState:o,stateTransition:r}=i;t+=` type(${e}) action(${a})`,t+=` visibilityState(${o}) stateTransition(${r})`}}return t}(o),c=`Invalid payload for executeEntityCommand handler: ${l}`;return s(c),Promise.reject(new Error(c))}catch(e){s(`Error thrown from external command listener: ${(0,$.u4)(e)}`)}};class R_ extends _e{constructor(){super(h.Yg.CreateExternalCommandListener,["activeWindowsService","appsRegistryService","windowProvider","loggerFactory","hostCommunicationService","coreSettings","waitForRenderingContextReady"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,windowProvider:i,loggerFactory:a,hostCommunicationService:o,coreSettings:r,waitForRenderingContextReady:s}=e;return function(e,t,n,i,a,o,r){const s=e.newLogger("External Command Listener","core-services-entity-commanding"),l=x_(s,a,i,o,r);if(t.opener.addEventListener("executeEntityCommand",l),i.get(b.J.Core).enableHostCommandListener){const e=e=>{const{entity:t}=e,{type:n}=t;switch(n){case y.dt.calls:case y.dt.chats:case y.dt.toasts:case y.dt.extensions:case y.dt.channels:case y.dt.reminders:case y.dt.activity:case y.dt.campaignnotifications:case y.dt.communities:case y.dt.communitiesevents:case y.dt.callingdeeplink:case y.dt.communitiesjoinrequest:case y.dt.communitiesmembers:return l(lm(e,s),!0);default:return l(om)}};n.loadModule("core").then((t=>{t&&t.registerForOnExecuteCommand?.(e)})).catch((e=>{s.errorToTelemetry?.(`Loading core host comms module failed with: ${(0,$.u4)(e)}`,"webclient_framework_host_comms",void 0,!0)}))}return Promise.resolve()}(a,i,o,r,s,t,n)}}class j_{constructor(){this.countBasedLogs=this.initializeLogs(),this.countBasedTotalLogs=[],this.currentBuffer=0}addOperation(e,t,n){if(t&&e)if(this.countBasedLogs[t][e]){const i=this.countBasedLogs[t][e];"Request"===n?i.requestCount++:i.responseCount++}else this.countBasedLogs[t][e]={requestCount:"Request"===n?1:0,responseCount:"Response"===n?1:0,errorCount:"Error"===n?1:0}}getLatestDataAndClear(){const e=(0,W.clone)(this.countBasedLogs);return this.currentBuffer>=40&&(this.currentBuffer=0),this.countBasedTotalLogs[this.currentBuffer++]=e,this.countBasedLogs=this.initializeLogs(),e}getCompleteDataLogs(){return this.countBasedTotalLogs.length<40?this.countBasedTotalLogs:this.countBasedTotalLogs.slice(this.currentBuffer).concat(this.countBasedTotalLogs.slice(0,this.currentBuffer))}initializeLogs(){return{subscription:{},mutation:{},query:{}}}}class L_ extends _e{constructor(){super(h.Yg.CreateGraphQlOpsService,["coreSettings"])}async execute(e){const{enableGraphQlOpsCount:t,enableGraphQlOpsCountInConsole:n}=e.coreSettings.get(b.J.Core);let i;if(t&&(i=new j_,e.graphqlOpsCountService=i),n){const e=window;e.hooks||(e.hooks={}),e.hooks.graphQlOpsCountServiceHook=i}}}var O_=n(296963);const $_=0;class U_{constructor(){this.stats={},this.counter=$_,this.tracked={}}getTelemetry(){const e=this.stats;return this.stats={},e}trackCall(e,t){this.getOrCreateStore(e).methodCalls[t]++}trackSubscribeEvent(e){this.getOrCreateStore(e).subscribeEvents++}markReadStart(e,t){return this.mark(B_("read",e,t))}markReadEnd(e){this.markEnd(e)}markReadError(e){this.markError(e)}markRead(e,t,n){this.update("success",B_("read",e,t),n)}markDiffStart(e,t){return this.mark(B_("diff",e,t))}markDiffEnd(e){this.markEnd(e)}markDiffError(e){this.markError(e)}markDiff(e,t,n){this.update("success",B_("diff",e,t),n)}markWriteStart(e,t){return this.mark(B_("write",e,t))}markWriteEnd(e){return this.markEnd(e)}markWriteError(e){this.markError(e)}markWrite(e,t,n){this.update("success",B_("write",e,t),n)}markDuplicateWrite(e,t,n){const i=B_("writeDuplicate",e,t);this.update("success",i,n)}mark(e){const t=""+this.counter++;return this.tracked[t]=e,t}markEnd(e){const t=this.tracked[e];if(delete this.tracked[e],t){const e=performance.now()-t.start;return this.update("success",t,e),e}return 0}markError(e){const t=this.tracked[e];if(delete this.tracked[e],t){const e=performance.now()-t.start;this.update("error",t,e)}}update(e,t,n){const i=this.getOrCreateStore(t.storeType)[t.kind];i.count++,"error"===e&&i.errors++,i.min=Math.min(null!==i.min?i.min:Number.MAX_VALUE,n),(null==i.max||i.max<n)&&(i.max=n,i.slowestOperation=t.operationName),i.mean=null!==i.mean?(i.mean+n)/2:n}getOrCreateStore(e){let t=this.stats[e];return t||(t={type:e,read:W_(),write:W_(),diff:W_(),writeDuplicate:W_(),subscribeEvents:$_,methodCalls:{[Jg.z.query]:$_,[Jg.z.watchQuery]:$_,[Jg.z.mutate]:$_,[Jg.z.subscribe]:$_,[Jg.z.readQuery]:$_,[Jg.z.writeQuery]:$_,[Jg.z.readFragment]:$_,[Jg.z.writeFragment]:$_}},this.stats[e]=t),t}}function B_(e,t,n){return{storeType:t,kind:e,operationName:"string"==typeof n?n:(0,O_.Ok)(n)||"unknown",start:performance.now()}}function W_(){return{min:null,max:null,mean:null,count:$_,errors:$_,slowestOperation:null}}class H_ extends _e{constructor(){super(h.Yg.CreateGraphQLStoreStatsReporterService,["coreSettings","loggerFactory"])}async execute(e){const t=e.loggerFactory.newLogger("CreateGraphQLStoreStatsReporterServiceTask","core-services-tasks"),{enableGraphQLStoreStatsReporterService:n}=e.coreSettings.get(b.J.Core);n&&(e.graphqlStoreStatsReporterService=new U_,t.log("GraphQLStoreStatsReporterService initialized"))}}var V_=n(560116);class G_ extends _e{constructor(){super(h.Yg.CreateGtmRegistry,["authenticationService","discover","coreSettings","loggerFactory","platformService","config"])}async execute(e){e.gtmRegistry=new V_.a(e.authenticationService,e.discover,e.coreSettings,e.loggerFactory,e.platformService,e.config)}}class z_{constructor(e,t,n,i,a){this.commandChangeReportingService=e,this.coreSettings=t,this.hostCommunicationService=n,this.scenarioFactory=i,this.logger=a.newLogger("HostCommandingListener","core-services-entity-commanding")}init(){this.initCommandChangeReportingSubscription()}destroy(){this.commandChangeReportingSubscription?.unsubscribe(),this.commandChangeReportingSubscription=void 0}initCommandChangeReportingSubscription(){this.commandChangeReportingSubscription&&this.destroy(),this.commandChangeReportingSubscription=this.commandChangeReportingService.observeChanges().subscribe((e=>{e.type===dt.B.NotHandled&&e.context.entityCommand&&this.sendHostEvent(e.context.entityCommand)}))}async sendHostEvent(e){!!this.coreSettings.get(b.J.Core).enableCommandToHostCommService&&await Im(e,this.hostCommunicationService,this.logger,this.scenarioFactory)}}class q_{constructor(){this.id=h.Yg.CreateHostCommandingListener}async execute(e){const{commandChangeReportingService:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,hostCommunicationService:o}=Mm("CreateHostCommandingListenerTask",e,"commandChangeReportingService","coreSettings","loggerFactory","scenarioFactory","hostCommunicationService");new z_(t,n,o,a,i).init()}}var J_;!function(e){e.airgap08="airgap08",e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap09="airgap09"}(J_||(J_={}));const Q_={web:{loadModule:async(e,t)=>"auth"===e?(e=>({signInOnElectron:function(t){const n={options:t};return Promise.resolve(e.opener.postMessage("login",n))},acquireTokenFromHost:function(t,n,i){const a={resource:t,claim:n,userIdentifier:i};return e.opener.requestMessage("aadGetToken",a)},getUserFromHost:function(){return e.opener.requestMessage("aadCurrentUser",{})}}))(t):"calling"===e?(e=>({signalCallConnectionComplete:function(){return Promise.resolve(e.opener.postMessage("signalCallConnectionComplete",{}))}}))(t):"callingperf"===e?(e=>({callingPerfStatsAvailable:function(t){const n={callingPerfStats:t};return Promise.resolve(e.opener.postMessage("callingPerfStats",n))}}))(t):"core"===e?(e=>({registerForOnSubNavHoverChanged:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("showOrHideSubNav",n),()=>{e.opener.removeEventListener("showOrHideSubNav",n)}},setCoreInitialized:function(){return Promise.resolve(e.opener.postMessage("coreInitialized",{}))},signalPreAuthComplete:function(){return Promise.resolve(e.opener.postMessage("teamsPreAuthComplete",{}))},registerForOnContinueWithTeamsCoreTasks:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("continueWithTeamsCoreTasks",n),()=>{e.opener.removeEventListener("continueWithTeamsCoreTasks",n)}}}))(t):"embedcalendar"===e?(e=>({sendHeightOnResize:function(t){const n={embedCalendarHeight:t};return Promise.resolve(e.opener.postMessage("sendHeightOnResize",n))},sendCalendarScenarioStatus:function(t,n){const i={ScenarioStatus:t,AgendaViewEndState:n};return Promise.resolve(e.opener.postMessage("sendCalendarScenarioStatus",i))}}))(t):"embedclient"===e?(e=>({HideCoreIFrame:function(){return Promise.resolve(e.opener.postMessage("HideCoreIFrame",{}))},ShowCoreIFrame:function(){return Promise.resolve(e.opener.postMessage("ShowCoreIFrame",{}))}}))(t):"search"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}}}))(t):"surveyform"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}}}))(t):void 0,definedModules:["auth","calling","callingperf","core","embedcalendar","embedclient","search","surveyform"]},edge:{loadModule:async e=>"airpods"===e?(async()=>globalThis.nativeModules?.Airpods)():"appdevicepermission"===e?(async()=>globalThis.nativeModules?.Appdevicepermission)():"appswitcher"===e?(async()=>globalThis.nativeModules?.Appswitcher)():"auth"===e?(async()=>globalThis.nativeModules?.Auth)():"bluetoothproximity"===e?(async()=>globalThis.nativeModules?.Bluetoothproximity)():"brb"===e?(async()=>globalThis.nativeModules?.Brb)():"calling"===e?(async()=>globalThis.nativeModules?.Calling)():"callingcrosscloud"===e?(async()=>globalThis.nativeModules?.Callingcrosscloud)():"callingcrosscloudpersistent"===e?(async()=>globalThis.nativeModules?.Callingcrosscloudpersistent)():"callingcrosscloudtransient"===e?(async()=>globalThis.nativeModules?.Callingcrosscloudtransient)():"core"===e?(async()=>globalThis.nativeModules?.Core)():"customvideobackground"===e?(async()=>globalThis.nativeModules?.Customvideobackground)():"ecs"===e?(async()=>globalThis.nativeModules?.Ecs)():"embedcalendar"===e?(async()=>globalThis.nativeModules?.Embedcalendar)():"etw"===e?(async()=>globalThis.nativeModules?.Etw)():"fileopenpreference"===e?(async()=>globalThis.nativeModules?.Fileopenpreference)():"files"===e?(async()=>globalThis.nativeModules?.Files)():"gatt"===e?(async()=>globalThis.nativeModules?.Gatt)():"globalshortcuts"===e?(async()=>globalThis.nativeModules?.Globalshortcuts)():"heartbeat"===e?(async()=>globalThis.nativeModules?.Heartbeat)():"hfp"===e?(async()=>globalThis.nativeModules?.Hfp)():"hid"===e?(async()=>globalThis.nativeModules?.Hid)():"hostcapabilities"===e?(async()=>globalThis.nativeModules?.Hostcapabilities)():"humanpresence"===e?(async()=>globalThis.nativeModules?.Humanpresence)():"loggingtrusted"===e?(async()=>globalThis.nativeModules?.Loggingtrusted)():"logscollection"===e?(async()=>globalThis.nativeModules?.Logscollection)():"m365link"===e?(async()=>globalThis.nativeModules?.M365link)():"moduleloader"===e?(async()=>globalThis.nativeModules?.Moduleloader)():"noisesuppression"===e?(async()=>globalThis.nativeModules?.Noisesuppression)():"officeintegration"===e?(async()=>globalThis.nativeModules?.Officeintegration)():"osutils"===e?(async()=>globalThis.nativeModules?.Osutils)():"profiler"===e?(async()=>globalThis.nativeModules?.Profiler)():"publicpreview"===e?(async()=>globalThis.nativeModules?.Publicpreview)():"roomservice"===e?(async()=>globalThis.nativeModules?.Roomservice)():"scenario"===e?(async()=>globalThis.nativeModules?.Scenario)():"settings"===e?(async()=>globalThis.nativeModules?.Settings)():"sharetarget"===e?(async()=>globalThis.nativeModules?.Sharetarget)():"taskbar"===e?(async()=>globalThis.nativeModules?.Taskbar)():"telemetry"===e?(async()=>globalThis.nativeModules?.Telemetry)():"telemetrytrusted"===e?(async()=>globalThis.nativeModules?.Telemetrytrusted)():"testtrusted"===e?(async()=>globalThis.nativeModules?.Testtrusted)():"thirdpartydevices"===e?(async()=>globalThis.nativeModules?.Thirdpartydevices)():"tmapolicy"===e?(async()=>globalThis.nativeModules?.Tmapolicy)():"toasts"===e?(async()=>globalThis.nativeModules?.Toasts)():"updates"===e?(async()=>globalThis.nativeModules?.Updates)():"userdataxcloud"===e?(async()=>globalThis.nativeModules?.Userdataxcloud)():"userdataxcloudtrusted"===e?(async()=>globalThis.nativeModules?.Userdataxcloudtrusted)():"userpreferences"===e?(async()=>globalThis.nativeModules?.Userpreferences)():"vdi"===e?(async()=>globalThis.nativeModules?.Vdi)():"webclientstates"===e?(async()=>globalThis.nativeModules?.Webclientstates)():"windowcontrols"===e?(async()=>globalThis.nativeModules?.Windowcontrols)():void 0,definedModules:["airpods","appdevicepermission","appswitcher","auth","bluetoothproximity","brb","calling","callingcrosscloud","callingcrosscloudpersistent","callingcrosscloudtransient","core","customvideobackground","ecs","embedcalendar","etw","fileopenpreference","files","gatt","globalshortcuts","heartbeat","hfp","hid","hostcapabilities","humanpresence","loggingtrusted","logscollection","m365link","moduleloader","noisesuppression","officeintegration","osutils","profiler","publicpreview","roomservice","scenario","settings","sharetarget","taskbar","telemetry","telemetrytrusted","testtrusted","thirdpartydevices","tmapolicy","toasts","updates","userdataxcloud","userdataxcloudtrusted","userpreferences","vdi","webclientstates","windowcontrols"]},electron:{loadModule:async(e,t)=>"appdevicepermission"===e?(e=>({registerForHasDevicePermissions:function(t){const n=(e={})=>{t(e.eventId,e.webContentsId,e.permissionType,e.guid)};return e.opener.addEventListener("hasDevicePermissions",n),()=>{e.opener.removeEventListener("hasDevicePermissions",n)}},resolveDevicePermission:function(t,n,i){const a={message:t,permission:n,guid:i};return Promise.resolve(e.opener.postMessage("hasDevicePermissionsCallback",a))}}))(t):"auth"===e?(e=>({signInOnElectron:function(t){const n={options:t};return Promise.resolve(e.opener.postMessage("login",n))}}))(t):"callingperf"===e?(e=>({callingPerfStatsAvailable:function(t){const n={callingPerfStats:t};return Promise.resolve(e.opener.postMessage("callingPerfStats",n))}}))(t):"core"===e?(e=>({registerForOnSubNavHoverChanged:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("showOrHideSubNav",n),()=>{e.opener.removeEventListener("showOrHideSubNav",n)}},setCoreInitialized:function(){return Promise.resolve(e.opener.postMessage("coreInitialized",{}))},relaunch:function(t){const n={relaunchArgs:t};return Promise.resolve(e.opener.postMessage("windowRelaunch",n))},notifyCoreStateChanged:function(t){const n={childSettings:t};return Promise.resolve(e.opener.postMessage("updateWindowState",n))}}))(t):"embedcalendar"===e?(e=>({sendHeightOnResize:function(t){const n={embedCalendarHeight:t};return Promise.resolve(e.opener.postMessage("sendHeightOnResize",n))},sendCalendarScenarioStatus:function(t,n){const i={ScenarioStatus:t,AgendaViewEndState:n};return Promise.resolve(e.opener.postMessage("sendCalendarScenarioStatus",i))}}))(t):"hostedwebcontentlog"===e?(e=>({registerForReportAProblemLogUploadEvent:function(t){const n=(e={})=>{t(e.eventId)};return e.opener.addEventListener("reportAProblemLogUpload",n),()=>{e.opener.removeEventListener("reportAProblemLogUpload",n)}}}))(t):"m365link"===e?(e=>({getM365Link:function(t,n){const i={url:t,context:n};return e.opener.requestMessage("getM365Link",i)}}))(t):"search"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}}}))(t):"surveyform"===e?(e=>({registerForLogActivity:function(t){const n=(e={})=>{t(e.payload)};return e.opener.addEventListener("logActivity",n),()=>{e.opener.removeEventListener("logActivity",n)}},uploadDesktopLogsToOds:function(t,n){const i={logFilePath:t,sasToken:n};return Promise.resolve(e.opener.postMessage("uploadDesktopLogsToOds",i))},collectDesktopLogs:function(){return e.opener.requestMessage("collectDesktopLogs",{})}}))(t):"windowcontrols"===e?(e=>({swapMeetingRoomFrontOfRoomWindows:function(){return Promise.resolve(e.opener.postMessage("swapMeetingRoomFrontOfRoomWindows",{}))},getScreenshots:function(t,n){const i={width:t,height:n};return e.opener.requestMessage("getScreenshots",i)}}))(t):void 0,definedModules:["appdevicepermission","auth","callingperf","core","embedcalendar","hostedwebcontentlog","m365link","search","surveyform","windowcontrols"]}},K_=(e,t,n=!1)=>new Y_(Q_.edge,e,void 0,t,n,!0);class Y_{constructor(e,t,n,i,a=!1,o=!1){this._internalLoadDefinition=e,this._logger=t,this._host=n,this._coreSettings=i,this._enableScenarioCache=a,this._enablePIEMonitors=o,this._hostCommsScenarioFactory=X_(this._enableScenarioCache)}async loadModule(e){const t=this._hostCommsScenarioFactory.newScenario("host_comms_load_module");let n;try{this._logger.log(`Loading module: ${e}`),n=await this._internalLoadDefinition.loadModule(e,this._host??void 0)}catch(n){throw this._logger.errorToTelemetry?.("Error while loading module","webclient_framework_host_comms",void 0,!0),t?.fail({reason:"Error while loading module",message:e}),n}return!n&&this._internalLoadDefinition.definedModules?.includes(e)?(this._logger.error(`Failed to load module. Module, undefined ${e}`),t?.fail({reason:"Failed to load module",message:e})):(this._logger.log(`Module "${e}" loaded`),t?.stop({message:e,reason:e})),n}setScenarioFactory(e){this._hostCommsScenarioFactory.setScenarioFactory(e),this.lazyLoadPieMonitors(e)}getPIEMonitorStates(){return{dataCaptureEnabled:this._enablePIEMonitors&&!!this._dataCapturePIEMonitor?.isEnabled(),trafficCopEnabled:this._enablePIEMonitors&&!!this._trafficCopPIEMonitor?.isEnabled()}}async lazyLoadPieMonitors(e){if(!this._enablePIEMonitors)return;let t=0;for(;t<3;)try{const[{PIEStatsProvider:t},{TrafficCopPIEMonitor:i},{DataCapturePIEMonitor:a}]=await Promise.all([Promise.all([n.e(233036),n.e(226324)]).then(n.bind(n,201142)),n.e(999248).then(n.bind(n,674738)),n.e(439358).then(n.bind(n,519266))]),o=new t(this);this._trafficCopPIEMonitor=new i(o),this._trafficCopPIEMonitor.setScenarioFactory(e),this._dataCapturePIEMonitor=new a(o),this.subscribeForMonitorObservable();break}catch(e){if(t++,3===t)throw e}}subscribeForMonitorObservable(){const e=this._coreSettings?.getObservable?.(b.J.Core,["pieMonitorSettings"]);e?.subscribe((e=>{if(!e.pieMonitorSettings)return;const{enabled:t,mode:n}=e.pieMonitorSettings;if(!t)return this._trafficCopPIEMonitor?.disable(),void this._dataCapturePIEMonitor?.disable();"DataCapture"===n?this._dataCapturePIEMonitor?.enable():"TrafficCop"===n&&this._trafficCopPIEMonitor?.enable()}))}}const X_=e=>{let t;const n=[];return{newScenario:i=>{if(t)return t.newScenario(i);if(e){const e=eF(i);return n.push(e),e}},setScenarioFactory:e=>{t=e,Z_(n,t)}}},Z_=(e,t)=>{let n=e.pop();for(;n;){const i=t.newScenario(n.name,{startTime:n.time});"failed"===n.status&&i.fail({cached:!0,...n.result}),"stopped"===n.status&&i.stop({cached:!0,...n.result}),n=e.pop()}},eF=e=>{let t,n;return{name:e,time:Date.now(),fail:e=>{n="failed",t=e},stop:e=>{n="stopped",t=e},get result(){return t},get status(){return n}}};class tF extends _e{constructor(){super(h.Yg.CreateHostCommunication,["coreSettings","loggerFactory","platformService","windowProvider"])}async execute(e){const{coreSettings:t,loggerFactory:n,platformService:i,windowProvider:a}=e;e.hostCommunicationService=((e,t,n,i)=>{const{clientType:a}=e.config,o=i.newLogger("HostComms","core-services-host-communication");return o.log(`Create HostComms for ${a}`),a===An.Bh.Maglev&&t.get(b.J.Core).enablePieCommunication?K_(o,t,!0):a===An.Bh.Desktop?new Y_(Q_.electron,o,n,t,!0):new Y_(Q_.web,o,n,t,!0)})(i,t,a,n)}}var nF=n(846103);class iF extends _e{constructor(){super(h.Yg.CreateI18n,["i18NextWrapper"])}async execute(e){const t=new nF.o(e.i18NextWrapper);e.i18n=t;const n=e.localMigratedSettings;if(n){const i=aF(e.i18NextWrapper.logger,e.i18NextWrapper.migratedLocaleCode,t.locale);n.registerConsumer("i18n",i)}}}const aF=(e,t,n)=>async({language:i})=>{if(i!==t)throw e.error(`Migrated locale (${i}) was not available for the i18NextWrapper (${t})`),new Error("Language mismatch during locale migration");i!==n&&e.log(`Migrated locale (${i}) was not applied to the i18n instance. Detected language: (${n})`)};var oF=n(585682),rF=n(379102);class sF{constructor(e,t){this.options={},this.setOptions(t),this.logger=e("i18n:selective-icu","services-io-browser-i18n"),this.name="selective-icu",this.type="postProcessor",this.icu=new rF.Z}setOptions(e){this.options={...this.options,...e}}process(e,t,n,i){const a=Array.isArray(t)?t[t.length-1]:t;if(!this.options.filterRegex||!this.options.filterRegex.test(a))return e;try{return this.icu.parse(e,n,i.language,n.ns,a,!1)}catch(a){return this.logger.error(`ICU parse failed for namespace: "${n.ns||""}" key: "${t.toString()}" locale: "${i.language||""}"`),e}}}class lF{constructor(){this.name="simple-pseudo",this.type="postProcessor"}process(e){return`([{${e}}])`}}var cF=n(351340);class dF{constructor(e,t,n){this.i18nextWrapper=e,this.coreSettings=n,this.entries={},this.logger=t("NamespaceLoader","services-io-browser-i18n");const i=n?.getObservable(b.J.Localization);i?.subscribe((e=>{e.enableExpStrings&&this.getOverriddenNamespaces().forEach((e=>this.patchBundleOverrides(e)))}))}getState(e){const t=this.entries[e];return t?t.state:cF.i.Missing}async waitForNamespace(e){const t=this.getState(e);if(t===cF.i.Loaded)return;if(t===cF.i.Failed)throw new Error(`Loading of namespace ${e} has previously failed`);const n=t===cF.i.Missing?this.load(e):this.entries[e];return n&&n.promise?n.promise:void 0}loadStatic(e){this.addResourceBundle(e.namespace,e.translations),this.entries[e.namespace]={state:cF.i.Loaded,error:void 0,promise:void 0}}load(e,t){const n="en-us",i=t?n:this.i18nextWrapper.locale,a=`${i}/${(0,W.kebabCase)(e)}`,o=`./generated/resources/${a}`,r={state:cF.i.Loading,error:void 0,promise:void 0};this.entries[e]=r,this.i18nextWrapper.logger.log("importing",o);const s=this.getNamespaceEntry(i,e).then((t=>{this.addResourceBundle(e,t.default.translations),this.i18nextWrapper.logger.log("imported",o),r.state=cF.i.Loaded,r.promise=void 0})).catch((s=>t||i===n?(this.failI18nLoad({error:s.message,origin:a}),this.i18nextWrapper.logger.error("failed to import",o,s),r.state=cF.i.Failed,r.error=s.message,r.promise=void 0,Promise.reject(s)):(this.i18nextWrapper.logger.log("trying fallback to the default locale as failed to import",o,s),this.failI18nLoad({fallbackLocale:n,error:s.message,origin:a}),this.load(e,!0).promise)));return r.promise=s,r}addResourceBundle(e,t){return this.i18nextWrapper.i18next.addResourceBundle(this.i18nextWrapper.locale,e,{...t,...this.getOverrides(e)})}patchBundleOverrides(e){if(this.entries[e]){const t=this.getOverrides(e);(this.entries[e].promise||Promise.resolve()).then((()=>{this.i18nextWrapper.i18next.addResourceBundle(this.i18nextWrapper.locale,e,t,!0,!0)}))}}getOverriddenNamespaces(){const e=this.coreSettings?.get(b.J.Localization);let t=[];return Object.keys(e).forEach((n=>{e[n]?.expStrOverrides&&(t=[...t,...Object.keys(e[n]?.expStrOverrides||{})])})),[...new Set(t)]}getOverrides(e){const{enableExpStrings:t}=this.coreSettings?.get(b.J.Localization)??{};if(!t)return{};const n=this.i18nextWrapper.locale.toLowerCase(),i=this.coreSettings?.get(b.J.Localization);return Object.keys(i).map((t=>i[t]?.expStrOverrides?.[e])).filter((e=>!!e)).map((e=>e.reduce(((e,t)=>{const i=Object.keys(t.locales).find((e=>e.toLowerCase()===n)),a=t.key,o=i&&t.locales[i];return a&&o&&(e[a]=o),e}),{}))).reduce(((e,t)=>({...e,...t})),{})}getNamespaceEntry(e,t){return(0,ac.mT)((()=>n(122057)(`./${e}/${(0,W.kebabCase)(t)}.js`)),`${(0,W.kebabCase)(t)}-locale-${e}`)}failI18nLoad(e){this.logger.errorToTelemetry?.("Failed to import locale","namespace_loader",e)}}var uF=n(343512),mF=n(923671);const pF={GENERAL_LOCALE_CODE:"localeCode",ACCOUNT_LOCALE_CODE:"accountLocaleCode",APPLICATION_LOCALE_CODE:"applicationLocaleCode",IS_LOCALE_IN_SYNC_WITH_ACCOUNT:"isLocaleInSyncWithAccount"};function gF(e){return e.navigator.language||h.ZW}async function hF(e){const t=await e.loadModule("osutils"),n=await(t?.getAppLocale?.());return n?.localeName}function yF(e,t,n){const i=vF(e,t,n);return(0,mF.vw)(i).locale}function vF(e,t,n,i,a){const o=function({localeCode:e,language:t,setting:n}){if(e)return e;if(t)return t.toLowerCase();if(!n)return;let i;if(Array.isArray(n)){for(const e of n)if(e.startsWith("localeCode:")){i=e;break}}else n.startsWith("localeCode:")&&(i=n);if(i)return i.split(":")[1];return}(t.state.getSearchState()||{});if(o)return o;const r=e?.navigator?.language;if(i&&r)return r;const s=e.localStorage.getItem(pF.GENERAL_LOCALE_CODE)||a;return s&&e.localStorage.setItem(pF.GENERAL_LOCALE_CODE,s),s||r||n||h.ZW}function fF(e){return{accountLocaleCode:e.get(pF.ACCOUNT_LOCALE_CODE),applicationLocaleCode:e.get(pF.APPLICATION_LOCALE_CODE),isLocaleInSyncWithAccount:e.get(pF.IS_LOCALE_IN_SYNC_WITH_ACCOUNT)}}const SF=()=>{};class kF{get locale(){return this._locale}get osLocaleInfo(){return this._osLocaleInfo}constructor(e,t,n,i,a,o,r,s,l,c,d,u,m){this.preloadNamespaces=e,this.originLocale=a,this.staticNamespaces=o,this.userLanguage=s,this.osLocale=l,this.migratedLocaleCode=c,this.coreSettings=m,this.notLoadedNamespacesWithErrors=[];const p=t("i18n","services-io-browser-i18n"),g="pseudo"===a||"pseudo_rtl"===a;let h=(0,uF.Ax)(a,i,r);const y=(b.J.Core&&this.coreSettings?.get(b.J.Core))??{};y&&y.useEnglishOnlyUI&&(h="en-us");const v=this.initPlugins(t,g,h,p);this.namespaceLoader=((e,t,n)=>new dF(e,t,n))(this,t,m),this.i18next=v,this.latestTranslation={},this.originLocale=a,this.logger=p,this.scenarioFactory=i,this.osPlatform=n.config.osPlatform,this.initOsDateTimeLocalization(i,p,m,u,d),this.initI18next(h,i,p),this._locale=h,this.loadLocales()}setOSLocaleInfo(e){this._osLocaleInfo=e}async setLocale(e){const t=(b.J.Core&&this.coreSettings?.get(b.J.Core))??{};t&&t.useEnglishOnlyUI&&(e="en-us");const n=(0,uF.um)(this.scenarioFactory,e);this.i18next.changeLanguage(n),this._locale=n,await this.loadLocales()}setPreloadedNamespaces(e){this.preloadNamespaces&&this.preloadNamespaces.length>0||(this.preloadNamespaces=e,this.logger.log("Setting preloaded namespaces ",this.preloadNamespaces),this.loadLocales())}initPlugins(e,t,n,i){const a=[new sF(e,{filterRegex:/.*\_mf$/})];if(t){const e=new lF;a.push(e),n="en-us"}uF.cL.locale=n;let o=oF.Z.createInstance();for(const e of a)o=o.use(e);const r=this.getInitOptions(n,a);return o.init(r).catch((e=>i.error("The i18next initialization failed",e))),o}removeDefaultI18nNamespaces(e){("string"==typeof this.i18next.options.ns?[this.i18next.options.ns]:this.i18next.options.ns??[]).forEach((t=>this.i18next.removeResourceBundle(e,t))),this.i18next.setDefaultNamespace("")}setMissingHandlers(e,t){this.i18next.options.saveMissing=!0,this.i18next.options.missingKeyHandler=(n,i,a)=>{this.missingKeyHandler(e,t,this.i18next,n,i,a)},this.i18next.options.missingInterpolationHandler=n=>this.missingInterpolationHandler(e,t,this.latestTranslation)}initI18next(e,t,n){this.removeDefaultI18nNamespaces(e),this.setMissingHandlers(t,n)}normalizeOSRegionalFormat(e){return e.split("_").join("-").toLowerCase()}initOsDateTimeLocalization(e,t,n,i,a){if(a)return void this.setOSLocaleInfo(a);const o=(b.J.Host&&n?.get(b.J.Host))??{};o&&o.enableOsDateTimeFormatting&&async function(e){const t=await(e?.loadModule("osutils"));return await(t?.getLocaleInfo?.())}(i).then((e=>{if(!e||!e?.regionalFormat)return void this.setOSLocaleInfo(e);const n=this.normalizeOSRegionalFormat(e.regionalFormat);if((e=>{try{return Intl.DateTimeFormat.supportedLocalesOf([e],{localeMatcher:"lookup"}).length>0}catch(e){return!1}})(n))e.regionalFormat=n,this.setOSLocaleInfo(e);else{const n=`getLocaleInfoFromHostCommunication returned unsupported regional format: ${e.regionalFormat}`;t.errorToTelemetry?.(n,"telemetry_i18next_wrapper")}})).catch((n=>{const i=`getLocaleInfoFromHostCommunication failed: ${n}`;t.errorToTelemetry?.(i,"telemetry_i18next_wrapper");e.newScenario(H.RG.I18nGetLocaleInfo).fail({errors:JSON.stringify(["getLocaleInfoAsync failed"])})}))}loadLocales(){const e=[];this.staticNamespaces&&this.namespaceLoader.loadStatic(this.staticNamespaces);for(const t of this.preloadNamespaces){const n=this.namespaceLoader.load(t);n.promise&&e.push(n.promise.catch(SF))}return Promise.all(e)}missingKeyHandler(e,t,n,i,a,o){const r="string"==typeof n.options.ns?[n.options.ns]:n.options.ns||[""],s=r.indexOf(a)<0;let l="",c="";if(s&&(e=>this.notLoadedNamespacesWithErrors.indexOf(e)>=0)(a))return;s?(l=`The namespace "${a}" has not been loaded. The only loaded namespaces: "${r.join(", ")}"`,c=o,this.notLoadedNamespacesWithErrors.push(a)):l=`The key "${o}" doesn't exist in namespace "${a}" for locale "${i[0]}"`;e.newScenario(H.RG.I18nMissingKeyHandler).stop({message:l,origin:c}),t.error(l)}missingInterpolationHandler(e,t,n){const i=`Undefined interpolation for namespace "${n.namespace}" and key "${n.key}"`;e.newScenario(H.RG.I18nMissingInterpolationHandler).stop({message:i}),t.errorToTelemetry?.(i,"telemetry_i18next_wrapper")}getInitOptions(e,t){return{initImmediate:!1,interpolation:{escapeValue:!1},react:{bindI18n:"languageChanged",bindI18nStore:"",nsMode:"default",transKeepBasicHtmlNodesFor:["br","strong","i","b","u","p"]},lng:e,fallbackLng:e,load:"currentOnly",lowerCaseLng:!0,postProcess:t.filter((e=>"postProcessor"===e.type)).map((e=>e.name))}}}class CF extends _e{constructor(){super(h.Yg.CreateI18NextWrapper,["config","coreSettings","coreSettingsContext","hostCommunicationService","loggerFactory","platformService","routingServices","scenarioFactory","windowProvider"])}async execute(e){const t=function(e,t,n,i,a,o,r,s){const{windowProvider:l,routingServices:c,hostCommunicationService:d}=o,u=Pn(l),{language:m}=i.get(b.J.LocalMigrated)||{},p=m||void 0,g=b.J.Core&&i.get(b.J.Core),h=g&&g.includeBrowserInLocaleDetermination,y=vF(l,c,u.localeCode,!!h,p),v=gF(l),f=d?hF(d):Promise.resolve(void 0);return new kF(e,t,n,a,y,r,s,v,f,p,void 0,d,i)}(e.config.preloadedI18nNamespaces||[],e.loggerFactory.newLogger,e.platformService,e.coreSettings,e.scenarioFactory,{windowProvider:e.windowProvider,routingServices:e.routingServices,hostCommunicationService:e.hostCommunicationService},e.config.staticNamespaces,e.config.locale);e.coreSettingsContext.setLocale(t.locale),e.coreSettingsContext.updatePlatformProviderSettings({localeCode:t.locale}),e.i18NextWrapper=t}}class bF{constructor(e){this.cache=new Map,this.lastId=0,this.maxCacheSize=e.maxCacheSize,this.cachePruningPercent=e.cachePruningPercent}add(e,t){if(this.maxCacheSize<=0)return;let n=this.cache.get(e);if(n)return void(n.time=this.lastId++);const i=new Image;i.src=t,n={image:i,time:this.lastId++},this.cache.set(e,n),this.cache.size>this.maxCacheSize&&this.prune()}setCapacity(e){this.maxCacheSize=e.maxCacheSize,this.cachePruningPercent=e.cachePruningPercent,this.cache.size>this.maxCacheSize&&this.prune()}clear(){this.cache.clear(),this.lastId=0}has(e){return this.cache.has(e)}getUrl(e){if(this.has(e)){const t=this.cache.get(e);return t?.image.src}}get size(){return this.cache.size}prune(){const e=[];this.cache.forEach(((t,n)=>{e.push({time:t.time,url:n})})),e.sort(((e,t)=>e.time-t.time));let t=Math.ceil(this.maxCacheSize*this.cachePruningPercent);t=Math.max(this.cache.size-this.maxCacheSize,t);for(let n=0;n<t;n++){const t=e[n];this.cache.delete(t.url)}}}class wF extends _e{constructor(){super(h.Yg.CreateImageCaches,["coreSettings"])}async execute(e){const{coreSettings:t}=e,n=new bF({maxCacheSize:0,cachePruningPercent:.15});e.avatarImageCache=n;const i=t?.getObservable(b.J.ImageCache),a=i?.subscribe((e=>{let t=0;"number"==typeof e?.avatarImageCacheMaxCapacity&&(t=e.avatarImageCacheMaxCapacity),n.setCapacity({maxCacheSize:t,cachePruningPercent:.15})}));return()=>a.unsubscribe()}}class TF extends _e{constructor(){super(h.Yg.CreateInactiveGC,["clientState","coreSettings","profilerService"])}async execute(e){const{clientState:t,coreSettings:n,profilerService:i}=e;t.observe().subscribe((async e=>{if(e===Fe.pk.Inactive||e===Fe.pk.LongInactive){const{clearConsoleInInactive:e,enableGCInInactive:t}=n.get(b.J.Core);e&&(console.clear(),console.log('Console cleared on going to Inactive/LongInactive. When debugging, you can override this with disabling "clearConsoleInInactive" FF')),t&&i.requestTriggerGC()}}))}}class IF extends _e{constructor(){super(h.Yg.LeakDetector,["loggerFactory","coreSettings","windowProvider"])}async execute(e){const{loggerFactory:t,windowProvider:n,coreSettings:i}=e,a=t.newLogger("CreateLeakDetectorTask","core-services-tasks"),{enableObjectLeakDetection:o}=i.get(b.J.Core);if(a.log(`enableObjectLeakDetection ${o}`),!o)return;if(!n.WeakRef)return void a.log("windowProvider?.WeakRef is undefined");const r=new Fo.E(i,n);e.leakDetectorService=r,a.log("leakDetectorService instantiated"),n.opener.addEventListener(O.rY.GetLeaks,(()=>this.sendLeaksStats(n,r,a)));const{testAutomation:s}=i.get(b.J.Test);this.initTestingMode(n,r,i.get(b.J.Host),!!s)}sendLeaksStats(e,t,n){let i=0;const a=e.parent;a.getAndClearAriTelemetry=void 0,a.getLeakDetectorService=void 0,a.gc?(n.log("executing gc() on experience renderer"),a.gc(),i=1e4):n.warn("gc() not defined on experience renderer");let o=0;o=e.setTimeout((()=>{e.clearTimeout(o);const n={leaks:t.getReachableObjectCountsByKey(),leaksTrackingInfo:t.getReachableObjectsTrackingInfo()};e.opener.postMessage(O.rY.GetLeaks,n)}),i)}initTestingMode(e,t,n,i){const{userType:a}=n;(a&&a.indexOf("test")>-1&&!("getLeakDetectorService"in e.parent)||i)&&(e.parent.getLeakDetectorService=()=>t)}}var NF,EF,AF,_F;!function(e){e.incomplete="incomplete",e.success="success",e.failure="failure"}(NF||(NF={})),function(e){e.LifeCycleReport="life_cycle_report"}(EF||(EF={})),function(e){e.ExperienceLifeCycleManager="experience_life_cycle_manager",e.UserLifeCycleManager="user_life_cycle_manager"}(AF||(AF={})),function(e){e.start="start",e.onPreInit="onPreInit",e.onExperienceWarm="onExperienceWarm",e.onPreWarm="onPreWarm",e.onExperienceLongIdle="onExperienceLongIdle",e.onUserWindowPreWarm="onUserWindowPreWarm",e.onIdle="onIdle"}(_F||(_F={}));const FF=["identity","tflfre","pearnotdefaultapp","error"];function DF(e){if(e.has(gt.c4.ExperienceWarm))return;const t=MF(e,gt.yU.NavigationIntentExecuted);let n=!1;t&&(n=!t.shouldRenderContent||function(e){const t=MF(e,gt.FV.LayoutRenderComplete),n=["pearnotdefaultapp","error"];return(t?.mainEntityType&&!n.includes(t.mainEntityType))??!1}(e));const i=Array.from(e.values()).pop();return n&&i?.context}function PF(e,t){if(e.has(gt.c4.UserWarm))return;let n=!1;if(xF(e))if(t)if(function(e){const t=MF(e,gt.yU.ClientStartFinished);if(t){const{mainEntityType:e}=t;if(!e||-1===FF.indexOf(e))return!0}return!1}(e)&&function(e){const t=MF(e,gt.FV.FirstRenderStarted);return!!t}(e)||RF(e))n=!0;else{const t=MF(e,gt.yU.NavigationIntentExecuted);t&&!t.shouldRenderContent&&(n=!0)}else n=!0;const i=Array.from(e.values()).pop();return n&&i?.context}function MF(e,t){const n=e.get(t);return n&&n.context}function xF(e){return e.has(gt.yU.UserAuthenticated)&&e.has(gt.yU.UserConsentedToConsumeResources)}function RF(e){const t=MF(e,gt.FV.LayoutRenderComplete);if(t){const{mainEntityType:e}=t;if(!e||-1===FF.indexOf(e))return!0}return!1}function jF(e,t){let n=[];const i=e[t.state];return i&&(n=n.concat(i({context:t.context}))),n}function LF(e,t,n){let i;if(e){const{app:a,state:o,callback:r}=e;let s=r();if(s){const e=s.length;if(e>0){t.log(`App:${a.manifest.id} supports the state: ${o}, job count returned from the app: ${e}.`),s=s.filter((e=>function(e,t,n){if(n===_F.start)return!1;const i=t&&t[n];if(Array.isArray(i))return i.indexOf(e)>-1;if([_F.onPreWarm,_F.onExperienceWarm,_F.onUserWindowPreWarm].includes(n))return!1;return!0}(e.id,n,o)));const i=s.length;i!==e&&t.log(`Jobs filtering by permissions took place. Job count is now: ${i}`)}i={state:o,jobs:s}}}return i}function OF({app:e,currentChanges:t,change:n,getCachedSupportSet:i,sessionContext:a}){const o=function(e,t){if(t.has(gt.c4.Initialized)||e.type===gt.yU.ExperienceIdleStateChanged)return;const n=MF(t,gt.yU.ActiveEntitiesResolved);return xF(t)&&n?n:void 0}(n,t);if(o)return{app:e,state:_F.onPreInit,callback:()=>function(e,t,n){let i;const a=n(),{entities:o,target:r,...s}=t;for(const t of o)if(t&&a&&a.has(t.type)){i=i||[];const n=jF(e,{context:{...s,entity:t},state:_F.onPreInit});i=i.concat(n)}return i}(e,{...a,...o},i)}}function $F({app:e,currentChanges:t,sessionContext:n}){const i=DF(t);if(i){const t=_F.onExperienceWarm;return{app:e,state:t,callback:()=>jF(e,{context:{...n,...i},state:t})}}}function UF({app:e,currentChanges:t,sessionContext:n,change:i}){if(i.context.isIdle&&xF(t)){const t=_F.onExperienceLongIdle;return{app:e,state:t,callback:()=>jF(e,{context:{...n},state:t})}}}function BF({app:e,currentChanges:t,sessionContext:n}){const i=function(e){if(e.has(gt.c4.WindowWarm))return;let t=!1;RF(e)&&(t=!0);const n=Array.from(e.values()).pop();return t&&n?.context}(t);if(i){const t=_F.onUserWindowPreWarm;return{app:e,state:t,callback:()=>jF(e,{context:{...n,...i},state:t})}}}function WF({appId:e,jobState:t,change:n,currentChanges:i,logger:a}){let o;if(t){const{jobs:r,state:s}=t,l=function(e,t){let n;switch(e){case _F.start:n=gt.c4.Started;break;case _F.onPreInit:n=gt.c4.Initialized;break;case _F.onExperienceWarm:n=gt.c4.ExperienceWarm;break;case _F.onPreWarm:n=gt.c4.UserWarm;break;case _F.onExperienceLongIdle:n=gt.c4.ExperienceLongIdle;break;case _F.onUserWindowPreWarm:n=gt.c4.WindowWarm;break;case _F.onIdle:n=gt.c4.Idle}return function(e,{correlationId:t,windowId:n,context:{target:i}}){return{type:e,context:{target:i},correlationId:t,windowId:n}}(n,t)}(s,n);i.set(l.type,l),a.debug(`Life Cycle - Change type: ${n.type}, initiated by: ${n.context.target}. Resulted in app:${e} transition to state: ${s} and job count: ${r.length}`),o={change:l,jobs:r}}return o}function HF({application:e,appLifeCyclePermissions:t,change:n,currentChanges:i,getNextState:a,getCachedSupportSet:o,logger:r,sessionContext:s}){const l=LF(a({currentChanges:i,app:e,change:n,getCachedSupportSet:o,sessionContext:s}),r,t);return WF({appId:e.manifest.id,jobState:l,change:n,currentChanges:i,logger:r})}var VF,GF,zF,qF,JF,QF;!function(e){e.Experience="Experience"}(VF||(VF={})),function(e){e.Window="Window"}(GF||(GF={})),function(e){e.FirstUserAtBoot="FirstUserAtBoot",e.Other="Other"}(zF||(zF={}));class KF{constructor(e,t,n){this._scope=e,this._appLifeCyclePermissions=t,this._sessionContext=n,this._currentChanges=new Map,this._logger=n.loggerFactory.newLogger("ApplicationLifeCycleManager","core-services-life-cycle")}get managedId(){return this._application?.manifest.id}manageApplication(e){this._application=e}onChange(e){const t=[];if(!this._application)return t;this._currentChanges.set(e.type,e);const n=function(e){switch(e){case VF.Experience:return[$F];case GF.Window:return[BF];default:return[OF,(t=e===zF.FirstUserAtBoot,({app:e,currentChanges:n,sessionContext:i})=>{const a=PF(n,t);if(a){const t=_F.onPreWarm;return{app:e,state:t,callback:()=>jF(e,{context:{...i,...a},state:t})}}}),UF]}var t}(this._scope);for(const i of n){const n=HF({application:this._application,appLifeCyclePermissions:this._appLifeCyclePermissions,change:e,currentChanges:this._currentChanges,getNextState:i,getCachedSupportSet:()=>this.supportedSets,logger:this._logger,sessionContext:this._sessionContext});n&&t.push(n)}return t}get supportedSets(){return this._supportedEntitySet=this._supportedEntitySet||this._application&&function(e){const t=e.manifest.supportedEntities,n=new Set;return t&&t.reduce(((e,t)=>e.add(t)),n),n}(this._application),this._supportedEntitySet}}!function(e){e.Experience="Experience"}(qF||(qF={})),function(e){e.Window="Window"}(JF||(JF={})),function(e){e.FirstUserAtBoot="FirstUserAtBoot",e.Other="Other"}(QF||(QF={}));const YF=["identity","tflfre","pearnotdefaultapp","error"];function XF(e,t){const n=e.get(t);return n&&n.context}function ZF({changeset:e}){return e.has(gt.yU.UserAuthenticated)&&e.has(gt.yU.UserConsentedToConsumeResources)}function eD({changeset:e}){const t=XF(e,gt.FV.LayoutRenderComplete);if(t){const{mainEntityType:e}=t;if(!e||-1===YF.indexOf(e))return!0}return!1}const tD=[{name:_F.onExperienceWarm,fn:({application:e,ctx:t})=>{const n=function({changeset:e}){if(e.has(gt.c4.ExperienceWarm))return;const t=XF(e,gt.yU.NavigationIntentExecuted);let n=!1;t&&(n=!t.shouldRenderContent||function({changeset:e}){const t=XF(e,gt.FV.LayoutRenderComplete);return(t?.mainEntityType&&!["pearnotdefaultapp","error"].includes(t.mainEntityType))??!1}({changeset:e}));const i=Array.from(e.values()).pop();return n&&i?.context}({changeset:t.changeset});if(n){const i=_F.onExperienceWarm;return{app:e,change:t.change,scope:t.scope,state:i,jobs:jF(e,{state:i,context:{...t.context,...n}})}}},scope:"experience"},{name:_F.onPreInit,fn:({application:e,ctx:t,supportedEntitySet:n})=>{const i=function({change:e,changeset:t}){if(t.has(gt.c4.Initialized)||e.type===gt.yU.ExperienceIdleStateChanged)return;const n=XF(t,gt.yU.ActiveEntitiesResolved);if(ZF({changeset:t})&&n)return n;return}({change:t.change,changeset:t.changeset});if(i){let a;const{entities:o,target:r,...s}=i;for(const i of o)if(i&&n&&n.has(i.type)){a=a||[];const n=jF(e,{context:{...t.context,...s,entity:i},state:_F.onPreInit});a=a.concat(n)}if(Array.isArray(a))return{app:e,change:t.change,scope:t.scope,state:_F.onPreInit,jobs:a}}},scope:"user"},{name:_F.onPreWarm,fn:({application:e,ctx:t})=>{const n=function({changeset:e,isFirstInitializedUser:t}){if(e.has(gt.c4.UserWarm))return;let n=!1;if(ZF({changeset:e}))if(t)if(function({changeset:e}){return!!XF(e,gt.FV.FirstRenderStarted)}({changeset:e})&&function({changeset:e}){const t=XF(e,gt.yU.ClientStartFinished);if(t){const{mainEntityType:e}=t;if(!e||-1===YF.indexOf(e))return!0}return!1}({changeset:e})||eD({changeset:e}))n=!0;else{const t=XF(e,gt.yU.NavigationIntentExecuted);t&&!t.shouldRenderContent&&(n=!0)}else n=!0;const i=Array.from(e.values()).pop();return n&&i?.context}({changeset:t.changeset,isFirstInitializedUser:t.scope===QF.FirstUserAtBoot});if(n){const i=_F.onPreWarm;return{app:e,change:t.change,scope:t.scope,state:i,jobs:jF(e,{state:i,context:{...t.context,...n}})}}},scope:"user"},{name:_F.onUserWindowPreWarm,fn:({application:e,ctx:t})=>{const n=function({changeset:e}){if(e.has(gt.c4.WindowWarm))return;let t=!1;eD({changeset:e})&&(t=!0);const n=Array.from(e.values()).pop();return t&&n?.context}({changeset:t.changeset});if(n){const i=_F.onUserWindowPreWarm;return{app:e,change:t.change,scope:t.scope,state:i,jobs:jF(e,{state:i,context:{...t.context,...n}})}}},scope:"window"},{name:_F.onExperienceLongIdle,fn:({application:e,ctx:t})=>{if(t.change.context.isIdle&&ZF({changeset:t.changeset})){const n=_F.onExperienceLongIdle;return{app:e,change:t.change,scope:t.scope,state:n,jobs:jF(e,{state:n,context:{...t.context}})}}},scope:"user"},{name:_F.onIdle,fn:({application:e,ctx:t})=>{const n=function({changeset:e}){if(e.has(gt.c4.Idle))return;let t=!1;(function({changeset:e}){return e.has(gt.FV.IdleCallback)})({changeset:e})&&function({changeset:e}){return e.has(gt.yU.PreWarmJobsCompleted)&&e.has(gt.yU.WindowWarmJobsCompleted)&&e.has(gt.yU.ExperienceWarmJobsCompleted)}({changeset:e})&&(t=!0);const n=Array.from(e.values()).pop();return t&&n?.context}({changeset:t.changeset});if(n){const i=_F.onIdle;return{app:e,change:t.change,scope:t.scope,state:i,jobs:jF(e,{state:i,context:{...t.context,...n}})}}},scope:"user"}];function nD(e){return tD.map((({name:t,fn:n,scope:i})=>{const a=function({name:e,fn:t,scope:n}){return i=>{if(!iD[n].includes(i.ctx.scope))return;const a=t(i);return a&&a.jobs.length&&i.logger.log(`${e} resulted in a transition with ${a.jobs.length} jobs${a.jobs.length?`, ${a.jobs.map((e=>e.id)).join(", ")}`:""}`),a}}({name:t,fn:n,scope:i});return a(e)})).filter(Boolean)}const iD={experience:[qF.Experience],user:[QF.FirstUserAtBoot,QF.Other],window:[JF.Window]};class aD{constructor(e,t){this.application=e,this.permissions=t,this.changesets={experience:new Map,users:{},windows:{}},this.supportedEntitySet=this.getSupportedEntitySet()}performTransition(e){const t=oD[e.state],n=this.getChangeset(e);if(!n)return;const i={type:t,context:{target:e.change.context.target},correlationId:e.change.correlationId,windowId:e.change.windowId};return n.set(i.type,i),{change:i,jobs:e.jobs}}getTransitions(e){return nD({...e,application:this.application,supportedEntitySet:this.supportedEntitySet}).map((t=>{const{jobs:n}=t;return n&&(t.jobs=n.filter((n=>{const i=this.computeJobEligibility(n,t,this.permissions);return i||e.logger.log(`${t.state} denied job ${n.id} due to missing permissions`),i}))),t}))}getChangeset(e){return e.scope===qF.Experience?this.changesets.experience:e.scope===JF.Window?this.extractChangesetFromGroup({changesetGroup:this.changesets.windows,contextId:e.change.windowId}):this.extractChangesetFromGroup({changesetGroup:this.changesets.users,contextId:e.change.userContextId})}extractChangesetFromGroup({changesetGroup:e,contextId:t}){if(t)return e[t]||(e[t]=new Map),e[t]}computeJobEligibility(e,t,n){if(t.state===_F.start)return!1;const i=n&&n[t.state];return Array.isArray(i)?i.indexOf(e.id)>-1:![_F.onPreWarm,_F.onExperienceWarm,_F.onUserWindowPreWarm].includes(t.state)}getSupportedEntitySet(){const e=this.application.manifest.supportedEntities,t=new Set;return e&&e.reduce(((e,t)=>e.add(t)),t),t}}const oD={[_F.start]:gt.c4.Started,[_F.onPreInit]:gt.c4.Initialized,[_F.onExperienceWarm]:gt.c4.ExperienceWarm,[_F.onPreWarm]:gt.c4.UserWarm,[_F.onExperienceLongIdle]:gt.c4.ExperienceLongIdle,[_F.onUserWindowPreWarm]:gt.c4.WindowWarm,[_F.onIdle]:gt.c4.Idle};class rD extends aD{constructor(e,t){super(e,t),this._loggerCache=new WeakMap}get managedId(){return this.application.manifest.id}onChange(e,t,n){const i=this.getLogger(e,t,n),a=[],o=this.getChangeset({scope:t,change:e});if(!o)return i.warn(`missing ${t===JF.Window?"window":"user context"} id.`),a;o.set(e.type,e);const r=this.getTransitions({logger:i,ctx:{change:e,changeset:o,context:n,scope:t}});for(const e of r){const t=this.performTransition(e);t&&a.push(t)}return a.length>0&&i.log(`${a.length} app changes generated${a.length?`, ${a.map((e=>e.change.type)).join(", ")}`:""}`),a}removeUser(e,t){this.changesets.users[e]&&(t.debug(`removing user ${e} from change set`),delete this.changesets.users[e])}removeWindow(e,t){this.changesets.windows[e]&&(t.debug(`removing window ${e} from change set`),delete this.changesets.windows[e])}getLogger(e,t,n){let i=this._loggerCache.get(n.loggerFactory);i||(i=n.loggerFactory.newLogger("ApplicationLifeCycleManagerV2","core-services-life-cycle"),this._loggerCache.set(n.loggerFactory,i));const a=`[${this.managedId}::${t}::${e.type}]`;return new Proxy(i,{get(e,t,n){const i=Reflect.get(e,t,n).bind(e);return"function"==typeof i?(...e)=>{i(`${a} ${e[0]}`,...e.slice(1))}:i}})}}class sD{constructor(e,t){this._scheduler=e,this._logger=t.newLogger("SchedulerWithValidator","core-services-scheduling"),this._uniqueJobIds=new Set}validateAndSchedule(e,t,n){const{id:i,runOncePerId:a}=t;if(this._uniqueJobIds.has(i)){if(a)return this._logger.debug(`Job by ID ${i} has already run once.`),ie.o_}else this._uniqueJobIds.add(i);return this._scheduler.schedule(e,t,n)}}const lD=12e4;class cD{constructor({context:e,scheduler:t,experienceChangeReportingService:n,loggerFactory:i,lifeCycleChangeReportingService:a,lifeCycleJobPermissions:o}){this.timeoutIds=new Map,this.managers=new Map,this.applications=[],this.contexts={experience:{cleanupJobs:[],schedulerWithValidator:new sD(t,i),scope:VF.Experience,session:e},users:new Map,windows:new Map},this.coreSettings=e.coreSettings,this.experienceChangeReportingService=n,this.lifeCycleChangeReportingService=a,this.lifeCycleJobPermissions=o||{},this.logger=i.newLogger("ExperienceLifeCycleManagerV2","core-services-life-cycle-manager"),this.scheduler=t}init(){const e=this.experienceChangeReportingService.observeChanges();this.subscription=e.pipe((0,g.b)((e=>this.publish(e)))).subscribe(),this.logger.log("initialized")}async destroy(e){const t=this.contexts.users.size+this.contexts.windows.size;t>0&&this.logger.warn(`destroying with ${t} other contexts`),await this.processCleanupJobs(this.contexts.experience,e),this.subscription?.unsubscribe(),this.scheduler.destroy(),this.logger.log("destroyed")}registerApplication(e){if(!this.isInitialized)throw new Error("Unable to register application before ExperienceLifeCycleManager initialization");const t=e.manifest.id;if(this.managers.has(t))return void this.logger.warn(`skipping application, already registered ${e.manifest.id}`);const n=new rD(e,this.lifeCycleJobPermissions?.Application);this.managers.set(t,n),this.applications.push(e),this.logger.log(`registered application ${e.manifest.id}`)}registerUser(e,t){if(this.contexts.users.has(e))return void this.logger.errorToTelemetry?.(`user already exists for contextId ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0);const n={cleanupJobs:[],userContextId:e,schedulerWithValidator:new sD(this.scheduler,t.loggerFactory),session:t,scope:this.contexts.users.size>0?zF.Other:zF.FirstUserAtBoot};this.contexts.users.set(e,n),this.logger.log(`registered user ${e}`)}async removeUser(e,t){const n=this.contexts.users.get(e);if(n){const i=[];this.contexts.windows.forEach((n=>{n.userContextId===e&&i.push(this.removeWindow(n.windowId,e,t))})),await Promise.all(i),await this.processCleanupJobs(n,t),this.managers.forEach((t=>t.removeUser(e,this.logger))),this.contexts.users.delete(e),this.logger.log(`removed user ${e}, reason ${t}`)}else this.logger.errorToTelemetry?.(`user not found ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}registerWindow(e,t,n){let i=this.contexts.windows.get(e);i&&i.userContextId===t?this.logger.errorToTelemetry?.(`window ${e} already exists for user ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0):(i&&this.removeWindow(e,void 0,"switch_user"),this.contexts.users.has(t)?(i={cleanupJobs:[],schedulerWithValidator:new sD(this.scheduler,n.loggerFactory),windowId:e,userContextId:t,session:{...this.contexts.experience.session,...n},scope:GF.Window},this.contexts.windows.set(e,i),this.logger.log(`registered window ${e}`)):this.logger.errorToTelemetry?.(`failed to register window, could not find user ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}async removeWindow(e,t,n){this.logger.log(`removing window ${e}${t?` for ${t}`:""}, reason ${n}`);const i=this.contexts.windows.get(e);i?(await this.processCleanupJobs(i,n),this.managers.forEach((t=>t.removeWindow(e,this.logger))),this.contexts.windows.delete(e),this.logger.log(`removed window ${e}`)):this.logger.errorToTelemetry?.(`window not found for ${e}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}publish(e){if(this.logger.log(`publishing ${e.type}`),e.userContextId)this.logger.log(`change is specific to user ${e.userContextId}`),this.publishChangeWithUserContext(e,e.userContextId);else{const t=Array.from(this.contexts.users.values());for(const{userContextId:n}of t)this.publishChangeWithUserContext(e,n)}if(e.windowId){this.logger.log(`change is specific to window ${e.windowId}`);const t=this.contexts.windows.get(e.windowId);t?this.processChange({change:e,context:t}):this.logger.errorToTelemetry?.(`window not found for windowId ${e.windowId}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}this.processChange({change:e,context:this.contexts.experience})}publishChangeWithUserContext(e,t){const n=this.contexts.users.get(t);if(!n)return void this.logger.errorToTelemetry?.(`user not found for userContextId ${t}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0);const i=!e.userContextId&&t?{...e,userContextId:t}:e;this.processChange({change:i,context:n})}async processChange({change:e,context:t}){const n=`${t.scope}::${e.type}`,i=[];this.logger.log(`${n} forwarded to ${this.managers.size} apps`);performance.now();let a;this.managers.forEach((n=>{const o=n.managedId,r=n.onChange(e,t.scope,t.session);o&&r.length>0&&r.forEach((e=>i.push(this.scheduleJobs({changeWithJobs:e,managedApplicationId:o,context:t}))));const[s]=r||[];s&&(a=s.change.type)})),this.logger.log(`${n} scheduled ${i.length} jobs`);const o=cD.getJobsCompleteChangeType(a);let r,s;const l="WarmJobsCompleteTimer";i.length>0&&o&&(r=new Promise((e=>{s=this.contexts.experience.session.windowProvider.setTimeout((()=>{this.logger.warn(`${l}: Jobs did not complete within 120000ms for ${a}, firing ${o} change anyway`),e()}),lD)}))),await Promise.race([Promise.all(i),...r?[r]:[]]),this.contexts.experience.session.windowProvider.clearTimeout(s),o&&this.fireJobsCompletedChange(e,o);const c=await Promise.all(i);t.scope!==GF.Window&&this.markPostALTScenarioIfNeeded(c,t);for(const{cleanupJobs:e}of c)t.cleanupJobs.push(...e);this.logger.log(`${n} saved ${c.length} cleanup jobs`);const d=this.generateChangeReport({change:e,results:c,scope:t.scope});return this.lifeCycleChangeReportingService.report(d),{change:e}}fireJobsCompletedChange(e,t){this.timeoutIds.delete(t),this.experienceChangeReportingService.report({type:t,correlationId:e.correlationId,context:{target:"experience-life-cycle-manager"},userContextId:e.userContextId,windowId:e.windowId})}async scheduleJobs({changeWithJobs:e,managedApplicationId:t,context:n}){const{change:i,jobs:a}=e,o=[],r=this.coreSettings.get(b.J.Core).enableSerializeScheduledJob&&[gt.c4.UserWarm,gt.c4.ExperienceWarm].includes(i.type),s=[gt.c4.ExperienceLongIdle,gt.c4.Idle].includes(i.type),l=r?ie.vW.MacroSequential:s?ie.vW.Background:ie.vW.Macro;a.forEach((({job:e,maxRetries:t,id:a,...r})=>{const s=this.logger;o.push(new Promise(((o,c)=>{const d={...r,id:a,priority:l,scheduledById:"services-life-cycle-manager"};n.schedulerWithValidator.validateAndSchedule((async()=>{let i=0,r=t?Math.min(t,3)+1:1;for(;r;){i++,r--;try{const t=await e();if(l===ie.vW.MacroSequential){const e=n.session.scenarioFactory.findScenario(H.RG.PostALT);e?.mark(a)}return o(t),t}catch(e){if(!r)throw c(e),e;s.errorToTelemetry?.(`retrying failed job ${a}, after attempts ${i}, retries remaining ${r}, error: ${e.message?e.message:e}`,"webclient_framework_foundation_core_services_life_cycle_manager")}}}),d,i.correlationId)===ie.o_&&o(void 0)})))}));const c=[];let d=NF.success;for(const e of o)try{const t=await e;t&&c.push(t)}catch(e){const n=`Not all jobs scheduled by ${t} completely successfully. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`;this.logger.errorToTelemetry?.(n,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0),d=NF.failure}return Promise.resolve({id:t,type:i.type,stateJobStatus:d,jobCount:a.length,cleanupJobs:c})}markPostALTScenarioIfNeeded(e,t){const n=t.scope===VF.Experience?gt.c4.ExperienceWarm:gt.c4.UserWarm,i=t.scope===VF.Experience?H.ck.ExperienceWarmJobCompleted:H.ck.PreWarmJobCompleted;if(e?.length>0&&e[0]?.type===n){const e=t.session.scenarioFactory?.findScenario(H.RG.PostALT);e&&(e.mark(i),this.logger.log("marked postALT scenario as completed"))}}generateChangeReport({change:e,results:t,scope:n}){const{type:i}=e;0===t.length&&this.logger.warn(`change ${i} produced no application life cycle changes`);const a=n===VF.Experience?AF.ExperienceLifeCycleManager:AF.UserLifeCycleManager;return{...e,type:EF.LifeCycleReport,context:{apps:t,target:a,reportedChange:e}}}async processCleanupJobs(e,t){let n="experience";"windowId"in e?n=e.windowId:"userContextId"in e&&(n=e.userContextId);const i=`${e.scope}::${n}`,a=e.cleanupJobs;let o;for(let e=a.length-1;e>=0;e--){const n=a[e];try{await n(t)}catch(e){o=o?o.concat(`${n.toString()}::${(0,$.u4)(e)}`):`${n.toString()}::${(0,$.u4)(e)}::`}}if(this.logger.log(`${i} ran ${a.length} cleanup jobs`),o){const e=new Me.G(Me.$.CLEANUP,new Error(o));this.logger.errorToTelemetry?.(`${i} ${e.toTelemetryEntry()}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}}get isInitialized(){return Boolean(this.subscription)}static getJobsCompleteChangeType(e){switch(e){case gt.c4.ExperienceWarm:return gt.yU.ExperienceWarmJobsCompleted;case gt.c4.UserWarm:return gt.yU.PreWarmJobsCompleted;case gt.c4.WindowWarm:return gt.yU.WindowWarmJobsCompleted;default:return}}}class dD{constructor(e,t,n,i,a,o){this._elcm=new cD({scheduler:e,experienceChangeReportingService:t,context:n,lifeCycleChangeReportingService:i,loggerFactory:a,lifeCycleJobPermissions:o})}init(){this._elcm.init()}async destroy(e){this._elcm.destroy(e)}manageApplication(e){this._elcm.registerApplication(e)}manageUser(e,t){this._elcm.registerUser(e,t)}async removeUser(e,t){return this._elcm.removeUser(t,e)}manageWindow(e,t,n){this._elcm.registerWindow(e,t,n)}async removeWindow(e,t,n){return this._elcm.removeWindow(t,e,n)}}function uD({applicationManagers:e,change:t,logger:n,schedulerWithValidator:i,scenarioFactory:a,allowSequentialExecution:o}){const r=[];return n.debug(`Change received: ${t.type}`),e.forEach((e=>{const s=e.managedId,l=e.onChange(t);s&&l.length>0&&l.forEach((e=>r.push(async function(e,t,n,i,a,o){const{jobs:r,change:s}=e,l=[],c=o&&[gt.c4.UserWarm,gt.c4.ExperienceWarm].includes(s.type),d=[gt.c4.ExperienceLongIdle,gt.c4.Idle].includes(s.type),u=c?ie.vW.MacroSequential:d?ie.vW.Background:ie.vW.Macro;r.forEach((e=>{l.push(function({job:e,...t},n,i,a,o){return new Promise(((r,s)=>{n.validateAndSchedule((async()=>{try{const n=await e();if(o===ie.vW.MacroSequential){const e=a.findScenario(H.RG.PostALT);e?.mark(t.id)}return r(n),n}catch(e){throw s(e),e}}),{priority:o,...t,scheduledById:"services-life-cycle-manager"},i)===ie.o_&&r(void 0)}))}(e,i,s.correlationId,a,u))}));const m=[];let p=NF.success;for(const e of l)try{const t=await e;t&&m.push(t)}catch(e){const i=`Not all jobs scheduled by ${n} completely successfully. Continuing execution of remaining jobs. Error: ${e.message?e.message:e}`;t.errorToTelemetry&&t.errorToTelemetry(i,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0),p=NF.failure}return Promise.resolve({id:n,type:s.type,stateJobStatus:p,jobCount:r.length,cleanupJobs:m})}(e,n,s,i,a,o))))})),{change:t,lcChanges:r}}async function mD({change:e,lcChanges:t}){return{change:e,lcChanges:await Promise.all(t)}}function pD({change:e,lcChanges:t},n,i){const{type:a}=e;0===t.length&&n.debug(`Experience change type: ${a} produced no application life cycle changes`);const o=i===VF.Experience?AF.ExperienceLifeCycleManager:AF.UserLifeCycleManager;return{...e,type:EF.LifeCycleReport,context:{apps:t,target:o,reportedChange:e}}}class gD{constructor(e,t,n,i,a,o,r){this._scope=t,this._sessionContext=i,this._lifeCycleChangeReportingService=a,this._loggerFactory=o,this._lifeCycleJobPermissions=r,this._cleanupJobs=[],this._applicationManagers=[],this._activelyManagedApplications=new Set,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger(`WindowLifeCycleManager[${e}]`,"core-services-life-cycle-manager"),this._schedulerWithValidator=new sD(n,o)}async notify(e){const t=uD({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory,allowSequentialExecution:!1}),n=await mD(t);for(const{cleanupJobs:e}of n.lcChanges)this._cleanupJobs.push(...e);const i=pD(n,this._logger,this._scope);this._lifeCycleChangeReportingService.report(i)}manageApplication(e){if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const t=new KF(this._scope,this._lifeCycleJobPermissions?.Application,this._sessionContext);t.manageApplication(e),this._applicationManagers.push(t)}async destroy(e){let t,n,i;for(;t=this._cleanupJobs.pop();)try{await t(e)}catch(e){i=i?i.concat(`${t.toString()}::${(0,$.u4)(e)}`):`${t.toString()}::${(0,$.u4)(e)}::`}i&&(n=new Me.G(Me.$.CLEANUP,new Error(i)),this._logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}}class hD{constructor(e,t,n,i,a,o,r){this._scope=t,this._scheduler=n,this._sessionContext=i,this._lifeCycleChangeReportingService=a,this._loggerFactory=o,this._lifeCycleJobPermissions=r,this._cleanupJobs=[],this._windowLifecycleManagers=new Map,this._applicationManagers=[],this._activelyManagedApplications=new Set,this._coreSettings=this._sessionContext.coreSettings,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger(`UserLifeCycleManager[${e}]`,"core-services-life-cycle-manager"),this._schedulerWithValidator=new sD(n,o)}manageApplication(e){if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const t=new KF(this._scope,this._lifeCycleJobPermissions?.Application,this._sessionContext);t.manageApplication(e),this._applicationManagers.push(t)}async notify(e){this.handleWindowChange(e);const{enableSerializeScheduledJob:t}=this._coreSettings.get(b.J.Core),n=uD({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory,allowSequentialExecution:t||!1}),i=await mD(n);if(i.lcChanges?.length>0&&i.lcChanges[0]?.type===gt.c4.UserWarm){const e=this._sessionContext.scenarioFactory?.findScenario(H.RG.PostALT);e?.mark(H.ck.PreWarmJobCompleted)}for(const{cleanupJobs:e}of i.lcChanges)this._cleanupJobs.push(...e);const a=pD(i,this._logger,this._scope);this._lifeCycleChangeReportingService.report(a)}manageWindow(e,t){if(this._windowLifecycleManagers.has(e))return void this._logger.errorToTelemetry?.(`WINDOW_LIFECYCLE_MANAGER_ALREADY_EXISTS[${e}]`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0);const n=new gD(e,GF.Window,this._scheduler,t,this._lifeCycleChangeReportingService,this._loggerFactory,this._lifeCycleJobPermissions);this._activelyManagedApplications.forEach((e=>n.manageApplication(e))),this._windowLifecycleManagers.set(e,n)}async removeWindow(e,t){const n=this._windowLifecycleManagers.get(e);n&&(await n.destroy(t),this._windowLifecycleManagers.delete(e))}async destroy(e){let t,n,i;for(this._windowLifecycleManagers.forEach((t=>{t.destroy(e)}));t=this._cleanupJobs.pop();)try{await t(e)}catch(e){i=i?i.concat(`${t.toString()}::${(0,$.u4)(e)}`):`${t.toString()}::${(0,$.u4)(e)}::`}i&&(n=new Me.G(Me.$.CLEANUP,new Error(i)),this._logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}handleWindowChange(e){e.windowId&&this._windowLifecycleManagers.get(e.windowId)?.notify(e)}}class yD{constructor(e,t,n,i,a,o){this._scheduler=e,this._experienceChangeReportingService=t,this._sessionContext=n,this._lifeCycleChangeReportingService=i,this._loggerFactory=a,this._lifeCycleJobPermissions=o,this._cleanupJobs=[],this._userLifecycleManagers=new Map,this.handleUserScopeChange=e=>{if(e.userContextId){const t=this._userLifecycleManagers.get(e.userContextId);t?t.notify(e):this._logger.error(`EXPECTED_USER_LIFECYCLE_MANAGER_NOT_FOUND[${e.userContextId}]`)}else this._userLifecycleManagers.forEach((t=>t.notify(e)))},this._applicationManagers=[],this._activelyManagedApplications=new Set,this._coreSettings=this._sessionContext.coreSettings,this._lifeCycleJobPermissions=this._lifeCycleJobPermissions||{},this._logger=this._loggerFactory.newLogger("ExperienceLifeCycleManager","core-services-life-cycle-manager"),this._schedulerWithValidator=new sD(this._scheduler,a)}init(){const e=this._experienceChangeReportingService.observeChanges(),{enableSerializeScheduledJob:t}=this._coreSettings.get(b.J.Core);this._subscription=e.pipe((0,g.b)(this.handleUserScopeChange),(0,d.U)((e=>uD({applicationManagers:this._applicationManagers,change:e,logger:this._logger,schedulerWithValidator:this._schedulerWithValidator,scenarioFactory:this._sessionContext.scenarioFactory,allowSequentialExecution:t||!1}))),(0,pe.b)(mD),(0,g.b)((e=>{if(e.lcChanges?.length>0&&e.lcChanges[0]?.type===gt.c4.ExperienceWarm){const e=this._sessionContext.scenarioFactory?.findScenario(H.RG.PostALT);e?.mark(H.ck.ExperienceWarmJobCompleted)}for(const{cleanupJobs:t}of e.lcChanges)this._cleanupJobs.push(...t)})),(0,d.U)((e=>pD(e,this._logger,VF.Experience))),(0,d.U)((e=>this._lifeCycleChangeReportingService.report(e)))).subscribe()}async destroy(e){let t,n,i;for(;t=this._cleanupJobs.pop();)try{await t(e)}catch(e){i=i?i.concat(`${t.toString()}::${(0,$.u4)(e)}`):`${t.toString()}::${(0,$.u4)(e)}::`}this._subscription&&this._subscription.unsubscribe(),this._scheduler.destroy(),i&&(n=new Me.G(Me.$.CLEANUP,new Error(i)),this._logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0))}manageApplication(e){if(!this._subscription)throw new Error("Unable to manage provided application prior to LifeCycleManager init.");if(this._activelyManagedApplications.has(e))return;this._activelyManagedApplications.add(e);const t=new KF(VF.Experience,this._lifeCycleJobPermissions?.Application,this._sessionContext);t.manageApplication(e),this._applicationManagers.push(t)}manageUser(e,t){if(this._userLifecycleManagers.has(e))return void this._logger.error(`USER_LIFECYCLE_MANAGER_ALREADY_EXISTS[${e}]`);const n=new hD(e,this._userLifecycleManagers.size>0?zF.Other:zF.FirstUserAtBoot,this._scheduler,t,this._lifeCycleChangeReportingService,this._loggerFactory,this._lifeCycleJobPermissions);this._activelyManagedApplications.forEach((e=>n.manageApplication(e))),this._userLifecycleManagers.set(e,n)}manageWindow(e,t,n){this.removeWindow(void 0,e,"switch_user");const i=this._userLifecycleManagers.get(t);i?i.manageWindow(e,{...this._sessionContext,...n}):this._logger.errorToTelemetry?.(`EXPECTED_USER_LIFECYCLE_MANAGER_NOT_FOUND[${t}]`,"webclient_framework_foundation_core_services_life_cycle_manager",void 0,!0)}async removeUser(e,t){const n=this._userLifecycleManagers.get(t);n?(await n.destroy(e),this._userLifecycleManagers.delete(t)):this._logger.warn(`USER_LIFECYCLE_MANAGER_NOT_FOUND_TO_DESTROY[${t}]`)}async removeWindow(e,t,n){e?this._userLifecycleManagers.get(e)?.removeWindow(t,n):this._userLifecycleManagers.forEach((e=>e.removeWindow(t,n)))}}const vD=(e,t,n,i)=>{const a=function(e,t,n){if(!n){const{context:{execution:n}}=e;t.error(`Received a scheduler change in state: ${ie.Tf[n]} with no active scenario: ${JSON.stringify(e)}`)}return n}(e,t,i);if(a){const{context:{execution:t,handle:i,error:o}}=e;a.appendEventData({errorCode:o?.code,message:o?.message,context:o?.context}),a.mark(`${H.ck.ScheduledJobStateChange}_${ie.Tf[t].toLocaleLowerCase()}_${i}`),n(a)}};class fD{constructor(e,t,n){this._schedulerChangeReporting=e,this._scenarioFactory=t,this._activeExpScenariosMap=new Map,this._activeAppScenariosMap=new Map,this._activeSchedulerScenariosMap=new Map,this._logger=n.newLogger("LifeCycleTelemetry","core-services-life-cycle-telemetry")}init(){const e=e=>({change:e,scenarioFactory:this._scenarioFactory,activeAppScenariosMap:this._activeAppScenariosMap,activeExpScenariosMap:this._activeExpScenariosMap,activeSchedulerScenariosMap:this._activeSchedulerScenariosMap,logger:this._logger});this._schedulingChangeSubscription=this._schedulerChangeReporting.observeChanges().pipe((0,d.U)((t=>function({change:e,activeSchedulerScenariosMap:t,scenarioFactory:n,logger:i}){const{context:{execution:a}}=e,o=(({windowId:e,context:{handle:t}})=>`${t}:${e}`)(e);let r=t.get(o);switch(a){case ie.Tf.Started:if(r)i.error(`Received a scheduler change in state: ${ie.Tf[a]} with an active scenario already running. Change: ${JSON.stringify(e)}`);else{r=n.newScenario(H.RG.ScheduledJobComplete),t.set(o,r);const{correlationId:i,context:{meta:{id:a,priority:s,scheduledById:l,runOncePerId:c},target:d},type:u}=e;r.appendEventData({"Job.Id":a,"Job.Priority":ie.vW[s],"Job.ScheduledBy":l,"Job.RunOncePerId":c,target:d,correlationId:i,type:u})}break;case ie.Tf.Canceled:vD(e,i,(e=>e?.cancel()),r);break;case ie.Tf.Complete:vD(e,i,(e=>e?.stop()),r),t.delete(o);break;case ie.Tf.Received:i.log(`Received a scheduler change in state: ${ie.Tf[a]}: Change:${JSON.stringify(e)}`)}}(e(t))))).subscribe()}destroy(){this._schedulingChangeSubscription&&this._schedulingChangeSubscription.unsubscribe(),this._schedulingChangeSubscription=void 0}}var SD=n(217515);const kD=1024;async function CD(e,t,n,i,a){const o=await(SD.K.getInstance()?.getMemoryData(a));if(!o)return{baseRendererWS:0,baseJSUsedHeapSize:0};const r=await async function(e,t,n){let i=0;i=n.enableDecoupleCommandingFromApollo?n.getActiveWindows().length:(await(0,us.XD)(e))?.length||0;const a=t.get(b.J.Diagnostics).memorySharedSettings.popoutSizeInMB;if(i<=1||!a)return{jsUsedHeapSize:0,rendererWorkingSet:0};return{jsUsedHeapSize:(i-1)*(a.jsUsedHeapSize||0)*kD,rendererWorkingSet:(i-1)*(a.rendererWorkingSet||0)*kD}}(e,t,n),s=await async function(e,t){const n={id:"dummy",source:"memoryUtilities"},i=(await(t?.getCachedUsers?.(n,{isAllCachedUsers:!0,isAuthenticated:!0})))?.length??1,a=e.get(b.J.Diagnostics).memorySharedSettings.accountSizeInMB;if(i<=1||!a)return{jsUsedHeapSize:0,rendererWorkingSet:0};return{jsUsedHeapSize:(i-1)*(a.jsUsedHeapSize||0)*kD,rendererWorkingSet:(i-1)*(a.rendererWorkingSet||0)*kD}}(t,i);let l=0;const c=o.Perf_MainRenderer_WorkingSet;c&&(l=c-r.rendererWorkingSet-s.rendererWorkingSet);let d=0;const u=o.Perf_JSHeap_UsedSize;return u&&(d=u-r.jsUsedHeapSize-s.jsUsedHeapSize),{baseRendererWS:l,baseJSUsedHeapSize:d,heartbeatData:o}}class bD{constructor(e,t,n,i,a,o,r,s,l){this.client=t,this.clientStateProvider=n,this.coreSettings=i,this.rebootService=a,this.scenarioFactory=o,this.activeWindowsService=r,this.loggerFactory=s,this.authService=l,this.clientStateSubscription=null,this.configSubscription=null,this.highMemoryRestartSettings=this.coreSettings.get(b.J.Diagnostics).highMemoryRestartSettings,this.currentClientState=this.clientStateProvider.getState(),this.startTimeMS=e.startTimeMS,this.startDate=new Date(this.startTimeMS).toUTCString(),this.logger=this.loggerFactory.newLogger("highMemoryRestartService","high-memory-restart"),this.start()}start(){this.newScenario(H.RG.HighMemoryRestartServiceStart),this.subscribeToClientStateChange(),this.subscribeToConfigSettingsChange()}stop(){this.clientStateSubscription?.unsubscribe(),this.configSubscription?.unsubscribe()}static createInstance(e,t,n,i,a,o,r,s,l){return bD.instance||(bD.instance=new bD(e,t,n,i,a,o,r,s,l)),bD.instance}destroyInstance(){bD.instance=void 0}subscribeToClientStateChange(){this.clientStateSubscription=this.clientStateProvider.observe().subscribe((e=>this.handleClientStateChange(e)))}subscribeToConfigSettingsChange(){this.configSubscription=this.coreSettings.getObservable(b.J.Diagnostics).subscribe((e=>{e.enableHighMemoryRestartService||this.stop()}))}handleClientStateChange(e){this.currentClientState=e,this.handleStateChange()}async handleStateChange(){await this.shouldRebootApp()&&(this.newScenario(H.RG.HighMemoryRestartApp),this.rebootService.rebootApp(Dr.Z.HighMemory,Dr.d.ReloadAppTask))}async shouldRebootApp(){return this.currentClientState===Fe.pk.LongInactive&&(this.isLongRunningSession()?!!await this.hasHighMemory()||(this.infoToTelemetry("App didn't reboot because memory wasn't high"),!1):(this.infoToTelemetry(`App didn't reboot because it is not a long running session yet. Start time: ${this.startDate}`),!1))}isLongRunningSession(){return(new Date).getTime()-this.startTimeMS>36e5*(this.highMemoryRestartSettings?.longRunningThresholdInHours||0)}async hasHighMemory(){return(await CD(this.client,this.coreSettings,this.activeWindowsService,this.authService,!0)).baseRendererWS>1024*(this.highMemoryRestartSettings?.thresholdsInMB.rendererWorkingSet||0)}newScenario(e){this.scenarioFactory.newScenario(e).stop()}infoToTelemetry(e){this.coreSettings.get(b.J.Diagnostics).enableHighMemoryRestartLogger&&this.logger?.infoToTelemetry?.(e,"high_memory_restart_request")}}var wD,TD;!function(e){e.ok="ok",e.error="error"}(wD||(wD={})),function(e){e.debugPii="debugPii",e.debug="debug",e.info="info",e.warning="warning",e.error="error"}(TD||(TD={}));var ID=n(750622);const ND=1024,ED=1e3,AD=6e4,_D=36e5,FD=864e5,DD="memoryFeedbackService.lastDialogDate",PD="memoryFeedbackService.countOfDialogWithinDay",MD="memoryFeedbackService.countOfDialogWithinWeek";function xD(e){return e?"#":""}function RD(e){return(e/ND).toFixed(2)}class jD{constructor(e,t,n,i,a,o,r,s,l,c,d){this.localStorage=e,this.entityCommanding=t,this.clientState=n,this.client=i,this.coreSettings=a,this.scenarioFactory=o,this.activeWindowsService=r,this.hostCommunicationService=s,this.profilerService=l,this.userTrackingService=c,this.authService=d,this.timeWhenLastCallEnded=-1,this.memoryFeedbackSettings={},this.enableMemoryAutoBRBDialog=!1,this.enableWatsonMemoryDumps=!1,this.triedToWriteHighMemoryEvent=!1,this.running=!1,this.shouldKeepStopped=!1,this.lastDialogDate=new Date(this.localStorage.get(DD)||0),this.countOfDialogWithinDay=parseInt(this.localStorage.get(PD)||"0",10),this.countOfDialogWithinWeek=parseInt(this.localStorage.get(MD)||"0",10);this.coreSettings.getObservable(b.J.Diagnostics).subscribe((e=>{const{memoryFeedbackSettings:t,enableMemoryAutoBRBDialog:n,enableWatsonMemoryDumps:i}=e;this.enableMemoryAutoBRBDialog=n||!1,this.enableWatsonMemoryDumps=i||!1;let a=this.enableMemoryAutoBRBDialog||this.enableWatsonMemoryDumps;t&&Object.keys(t).length>0?this.memoryFeedbackSettings=t:(this.memoryFeedbackSettings={},a=!1),a?this.start():this.stop(!1)}))}start(){this.running||this.shouldKeepStopped||(this.running=!0,this.dateOfBeginingHighMemory=void 0,this.timeWhenLastCallEnded=-1,this.clientStateSubscription||this.startClientStateSubscription(),this.intervalId||(this.intervalId=(0,L.J)().setInterval((()=>this.beat(!0)),this.memoryFeedbackSettings.verySlowSampleTime??2147483647)))}stop(e){this.shouldKeepStopped||(this.shouldKeepStopped=e),this.running&&(this.running=!1,this.intervalId&&(0,L.J)().clearInterval(this.intervalId),this.clientStateSubscription&&this.clientStateSubscription.unsubscribe(),this.intervalId=void 0,this.clientStateSubscription=void 0)}startClientStateSubscription(){let e=this.clientState.getState();this.clientStateSubscription=this.clientState.observe().subscribe({next:t=>{e===Fe.pk.VeryActive&&t!==Fe.pk.VeryActive&&(this.timeWhenLastCallEnded=Date.now()),e=t}})}shouldKeepRunningForMTMA(){return!!this.coreSettings.get(b.J.Diagnostics).memorySharedSettings?.accountSizeInMB||this.userTrackingService?.getAccountMode()!==OE.b.MultipleAccounts}async beat(e){if(!this.shouldKeepRunningForMTMA())return void this.stop(!0);const t=new Date,n=await this.isMemoryHigh(t,e);if(n.hasExtraRenderer)return this.stop(!0),void this.newScenario(H.RG.MemoryFeedbackStopBecauseOfDevtools);if(!n.isMemoryHeavy)return;if(e)return await this.triggerGCAndWait(),this.beat(!1);const i=this.clientState.getState();if(!this.enableWatsonMemoryDumps||i!==Fe.pk.Inactive&&i!==Fe.pk.LongInactive){if(this.enableWatsonMemoryDumps&&!this.triedToWriteHighMemoryEvent||!this.enableMemoryAutoBRBDialog||this.hasReachedDialogLimit(t)||i!==Fe.pk.Active)return;this.openBrbDialog(n.memoryDetailMessage),this.newScenario(H.RG.MemoryFeedbackDialogOpen)}else{this.triedToWriteHighMemoryEvent=!0;const e=await this.hostCommunicationService.loadModule("etw"),t=await(e?.writeHighMemoryEvent?.());if(this.newScenario(H.RG.MemoryFeedbackHighMemoryMark,t),t?.result!==wD.ok)return}this.stop(!0),this.dateOfBeginingHighMemory=void 0,this.localStorage.set(PD,(this.countOfDialogWithinDay+1).toString(),"Fundamentals"),this.localStorage.set(MD,(this.countOfDialogWithinWeek+1).toString(),"Fundamentals"),this.localStorage.set(DD,t.toISOString(),"Fundamentals")}openBrbDialog(e){this.entityCommanding.brbFeedback.autoBrbConfirmationDialog({visibilityState:ke.fe.show,stateTransition:ke.su.new,correlation:{source:C.D.AutoBrb}},{feedbackText:`Detected high memory usage. ${e}`,feedbackSelectedCategory:"79",includeHeapSnapshot:!0,brbContext:ID.t.HighMemoryUsage})}async isMemoryHigh(e,t){const{isMemoryHeavy:n,memoryDetailMessage:i,hasExtraRenderer:a}=await this.getMemoryUsageData(t),o=this.activeWindowsService.enableDecoupleCommandingFromApollo?this.activeWindowsService.getStandardMainWindow():await(0,us.jW)(this.client);if(!o?.isMainWindow)return{hasExtraRenderer:a,isMemoryHeavy:!1};const r=this.clientState.getState();if(!n||r===Fe.pk.VeryActive||this.wasInCallRecently(e))return this.dateOfBeginingHighMemory=void 0,{hasExtraRenderer:a,isMemoryHeavy:!1};this.dateOfBeginingHighMemory=this.dateOfBeginingHighMemory||e;return e.getTime()-this.dateOfBeginingHighMemory.getTime()<(this.memoryFeedbackSettings.durationInMinuteOfConsecutiveHighMemoryState??Number.MAX_SAFE_INTEGER)*AD?{hasExtraRenderer:a,isMemoryHeavy:!1}:{hasExtraRenderer:a,isMemoryHeavy:n,memoryDetailMessage:i}}async getMemoryUsageData(e){const t=this.getThresholds(),n=[];let i=!1;const a=await CD(this.client,this.coreSettings,this.activeWindowsService,this.authService,e),o=a.heartbeatData?.Perf_MainRenderer_WorkingSet||0,r=a.baseRendererWS>(t.rendererWorkingSet??Number.MAX_SAFE_INTEGER)*ND;i=i||r,n.push(`${xD(r)}RWS: ${RD(o)} MB`);const s=a.heartbeatData?.Perf_JSHeap_UsedSize||0,l=a.baseJSUsedHeapSize>(t.jsUsedHeapSize??Number.MAX_SAFE_INTEGER)*ND;i=i||l,n.push(`${xD(l)}JSH: ${RD(s)} MB`),n.push(`base RWS: ${RD(a.baseRendererWS)} MB`);return{isMemoryHeavy:i,memoryDetailMessage:n.join(", "),hasExtraRenderer:!0===a.heartbeatData?.hasExtraRenderer}}hasReachedDialogLimit(e){const t=e.getTime()-this.lastDialogDate.getTime();return t<(this.memoryFeedbackSettings.gapInHourBetweenFeedbackDialogs??Number.MAX_SAFE_INTEGER)*_D||(t>FD&&this.resetDialogDayCount(),this.countOfDialogWithinDay>=(this.memoryFeedbackSettings.limitOfFeedbackDialogsWithinDay??0)||(t>7*FD&&this.resetDialogWeekCount(),this.countOfDialogWithinWeek>=(this.memoryFeedbackSettings.limitOfFeedbackDialogsWithinWeek??0)))}wasInCallRecently(e){const t=(this.memoryFeedbackSettings.minimumSecondsPassedSinceLastCall??Number.MAX_SAFE_INTEGER)*ED;return e.getTime()-this.timeWhenLastCallEnded<t}async triggerGCAndWait(){await(this.profilerService?.requestTriggerGC()),await(0,Il._)(this.memoryFeedbackSettings.delayInMsAfterGC??0)}newScenario(e,t){this.scenarioFactory.newScenario(e).stop(t)}getThresholds(){return this.memoryFeedbackSettings.thresholdsInMB??{}}resetDialogDayCount(){this.localStorage.set(PD,"0","Fundamentals")}resetDialogWeekCount(){this.localStorage.set(MD,"0","Fundamentals")}}var LD,OD=n(474934);!function(e){e.Supported="Supported",e.Unsupported="Unsupported",e.Unknown="Unknown"}(LD||(LD={}));function $D(e){return e.split(".").slice(-2).join(".")}class UD{constructor(e,t,n,i){this.scenarioFactory=n,this.windowProvider=i,this.detectionAttempts=0,this.scenario=n.newScenario(H.RG.DetectThirdPartyCookieSupport);const{enableThirdPartyCookiesDetection:a,thirdPartyCookiesDetectionOriginOverride:o}=t.get(b.J.Core,["enableThirdPartyCookiesDetection","thirdPartyCookiesDetectionOriginOverride"]);this.enabled=Boolean(a);const{staticsPath:r,buildType:s,buildVersion:l}=t.get(b.J.Platform,["staticsPath","buildType","buildVersion"]);this.cdnConfig={experienceName:e,staticsOrigin:r||void 0,overrideOrigin:o||void 0,buildType:s||void 0,version:l||void 0}}async detect(e){if(!this.enabled)return this.returnError("enableThirdPartyCookiesDetection is disabled");this.scenario.mark("attempting_detection");const t=await this.attemptDetection();if(this.cleanup(),"result"in t)return this.returnSuccess(t.result);const{error:n,retriable:i,url:a}=t;return!e&&i&&this.detectionAttempts<3?this.detect(e):this.returnError(n,a)}async attemptDetection(){this.detectionAttempts+=1;const e=5e3*this.detectionAttempts;try{const t=function(e,t){const{experienceName:n,staticsOrigin:i,buildType:a,version:o,overrideOrigin:r}=t;let s;const l=r||i;switch(a){case"production":if(!l||!o)break;s=`${l}/teams-modular-packages/${n}/${o}/`;break;case"container":s=e.__webpack_public_path__;break;case"local":s="https://local.third-party-cookie-service.office.net/v2/";break;default:throw new Error("Unsupported build type")}if(!s)throw new Error("CDN path not found");if($D(new URL(s).host)===$D(e.location.host))throw new Error("CDN domain and client domain are the same");return`${s}report-third-party-cookies.html`}(this.windowProvider,this.cdnConfig),n=this.windowProvider.document.createElement("iframe");n.setAttribute("style","display: none;"),n.setAttribute("src",t),this.iframe=n,this.scenario.mark("iframe_created");const i=new Promise((n=>{this.detectionTimeoutRef=this.windowProvider.setTimeout((()=>{n({error:`Timeout of ${e} exceeded`,url:t,retriable:!0})}),e)})),a=new Promise((e=>{this.messageHandler=t=>{const n=this.handlePostMessage(t);n&&e({result:n})},this.windowProvider.addEventListener("message",this.messageHandler)})),o=new Promise((e=>{n.addEventListener("error",(n=>{e({error:n.message,url:t})}))}));return this.windowProvider.document.body.appendChild(this.iframe),Promise.race([i,a,o])}catch(e){return Promise.resolve({error:e.message})}}handlePostMessage({data:e}){const{third_party_cookies_allowed:t}=e;if(void 0===t)return;this.scenario.mark("iframe_message_received");return Boolean(t)?LD.Supported:LD.Unsupported}async returnSuccess(e){return this.scenarioFactory.setContext?.({"Browser.ThirdPartyCookieSupport":e}),this.scenario.stop({third_party_cookie_support:e}),Promise.resolve(e)}async returnError(e,t){return this.scenario.fail({error:`${e}. Attempts made: ${this.detectionAttempts}`,url:t,third_party_cookies_support:LD.Unknown}),Promise.resolve(LD.Unknown)}cleanup(){this.iframe&&(this.windowProvider.document.body.removeChild(this.iframe),this.iframe=void 0),this.messageHandler&&(this.windowProvider.removeEventListener("message",this.messageHandler),this.messageHandler=void 0),this.detectionTimeoutRef&&(this.windowProvider.clearTimeout(this.detectionTimeoutRef),this.detectionTimeoutRef=void 0)}}var BD=n(393878);const WD=async e=>{const t=await e.loadModule("core");t?.reportExperienceWarm&&t.reportExperienceWarm()};var HD;!function(e){e.LifeCycleScopeChange="LifeCycleScopeChange"}(HD||(HD={}));class VD extends _e{constructor(){super(h.Yg.CreateLifeCycleTask,["activeWindowsService","appsRegistryService","authenticationService","client","clientState","config","coreSecurityService","coreSettings","coreSettingsContext","coreUtilities","entityCommanding","experienceChangeReportingService","hostCommunicationService","i18n","i18NextWrapper","lifeCycleScopeChangeReportingService","localStorage","loggerFactory","networkState","platformService","rebootService","scenarioFactory","schedulerChangeReporting","userBiService","windowProvider","scheduler","notificationsHandler","logsCollectorService","eventing"]),this.createCoreApplication=(e,t,n,i,a)=>({manifest:{name:"CoreTasks",id:"com.microsoft.teams.corescheduling"},onExperienceWarm:i=>[{id:"memory-feedback-service-start",job:()=>{const{context:{authenticationService:e,client:t,clientState:n,coreSettings:o,entityCommanding:r,localStorage:s,profilerService:l,scenarioFactory:c,userTrackingService:d,hostCommunicationService:u}}=i;s&&new jD(s,r,n,t,o,c,a,u,l,d,e)}},{id:"init-diagnostics-idb-job",job:()=>{const{context:{loggerFactory:e}}=i;"notifyDiagnosticsALTDone"in e&&e.notifyDiagnosticsALTDone()}},{id:"clear-t2-web-boot-attempts-counter",job:()=>{const{context:{coreSettings:e,loggerFactory:t,localStorage:n}}=i;if(!e.get(b.J.Core).enableClearT2WebBootAttempts)return;const a="clear_t2_web_boot_attempts_failure",o=t.newLogger("ClearWebBootAttemptsLogger","clear-t2-web-boot-attempts-counter");if(!n)return void o.errorToTelemetry?.("Local storage unavailable",a,void 0,!0);const r="numT2WebBootAttempts",s="t2WebOptInSessionId";n.remove(r,"Global"),n.remove(s,"Global"),n.remove("lastT2WebBootAttemptRecordTime","Global"),n.get(r,"Global")||n.get(s,"Global")?o.errorToTelemetry?.("Failed to remove web boot/opt-in keys from local storage",a,void 0,!0):o.warnToTelemetry?.("Successfully removed web boot/opt-in keys from local storage","clear_t2_web_boot_attempts_success",void 0,!0)}},{id:"detect-third-party-cookie-support-job",runOncePerId:!0,job:async()=>{const{scenarioFactory:e,windowProvider:n,coreSettings:a,config:o,platformService:r}=i.context,s=await function(e,t,n,i,a,o=!1){return t!==An.us.Web?Promise.resolve(LD.Unknown):new UD(e,n,i,a).detect(o)}(o.experienceName,r.config.platformId,a,e,n);t.updatePlatformProviderSettings({thirdPartyCookieSupport:s})}},{id:"notify-desktop-experience-warm-job",job:()=>(async(e,t)=>{const{context:{coreSettings:n,hostCommunicationService:i,scenarioFactory:a,loggerFactory:o}}=e,r=o.newLogger("NotifyDesktopExperienceWarmJob","notify-desktop-experience-warm-job");r.log("Start");const s=a.newScenario(H.RG.NotifyDesktopOnExperienceWarm),{enableUserDataFetchForSilentLaunch:l}=n.get(b.J.Core),{launchIntent:c}=n.get(b.J.HostCapabilities);if(!l||"LaunchCoreNoSystemTray"!==c){const e=`ReportingDesktopExperienceWarm: enableUserDataFetchForSilentLaunch: ${l}, launchIntent: ${c}`;return r.log(e),s.stop({reason:e}),void await WD(i)}if(await Mu(t)){const e="SkippingReportingDesktopExperienceWarm: PrimaryUserFound";r.log(e),s.stop({reason:e},"abandoned")}else{const e="ReportingDesktopExperienceWarm: PrimaryUserUndefined";r.log(e),s.stop({reason:e}),await WD(i)}})(i,e)},GD(i,n)],onPreWarm:a=>[{id:"settings-ecs-fetch",job:()=>t.fetchEcsSettingsIfApplicable()},{id:"maglev-provider-host-settings",job:()=>{const{context:{coreSettings:e}}=a;e.get(b.J.Core).enableMaglevHostPostAltSettings&&t.initializeMaglevHostProviderPostAltSettings(i)}},{id:"user-bi-initialize-smb-user-intent",job:()=>n.initializeAndSubscribeToSmbUserIntent&&n.initializeAndSubscribeToSmbUserIntent()},{id:"active-windows-history-job",job:()=>{const{context:{activeWindowsHistoryService:e}}=a;if(e)return e.initialize(),t=>{e.cleanup(t)}}},qD(a),{id:"start-local-migrated-settings-timer-job",job:()=>{const{context:{localMigratedSettings:e}}=a;e&&e.startTimer()}},{id:"notify-desktop-experience-warm-for-user-job",job:()=>(async(e,t)=>{const{context:{authenticationUser:n,coreSettings:i,client:a,hostCommunicationService:o,scenarioFactory:r,loggerFactory:s}}=e,l=s.newLogger("NotifyDesktopExperienceWarmForUserJob","notify-desktop-experience-warm-for-user-job"),c=r.newScenario(H.RG.NotifyDesktopOnPrimaryUserWarm);l.log("Start");const{enableUserDataFetchForSilentLaunch:d}=i.get(b.J.Core),{launchIntent:u}=i.get(b.J.HostCapabilities);if(!d||"LaunchCoreNoSystemTray"!==u){const e=`SkippingReportingDesktopExperienceWarm: enableUserDataFetchForSilentLaunch: ${d}, launchIntent: ${u}`;return l.log(e),void c.stop({reason:e},"abandoned")}if(!await Pu(t,n)){const e="SkippingReportingDesktopExperienceWarm: CurrentUserNotPrimary";return l.log(e),void c.stop({reason:e},"abandoned")}try{l.log("ChatListQueryStart"),c.mark(H.ck.ChatListQueryStart);const{data:e}=await a.query({query:BD.h,variables:{includePinnedChats:!0,includeSuggestedContacts:!1}}),t=`ChatListQueryEnd[${e?.recentsChats?.edges?.length}]`;l.log(t),c.mark(H.ck.ChatListQueryEnd,{reason:t})}catch(e){l.error("ChatListQueryFail",e),c.mark(H.ck.ChatListQueryEnd,{error:e})}l.log("Stop"),c.stop(),await WD(o)})(a,e)}],onExperienceLongIdle:e=>[zD(e,a)]})}async execute(e){const t=e.config,n=e.coreSettings,i=e.coreSettingsContext,a=e.clientAccessAdminPolicyCheckService,o=e.entityCommanding,r=e.experienceChangeReportingService,s=e.hostCommunicationService,l=e.i18n,c=e.lifeCycleScopeChangeReportingService,d=e.loggerFactory,u=e.networkState,m=e.platformService,p=e.scenarioFactory,g=e.schedulerChangeReporting,h=e.userBiService,y=e.clientState,v=e.localStorage,f=e.i18NextWrapper,S=e.windowProvider,k=e.rebootService,C=e.coreSecurityService,w=e.scheduler,T=e.notificationsHandler,I=e.authenticationService,N=e.activeWindowsService,E=e.logsCollectorService,A=e.eventing;new fD(g,p,d).init();const{isEntityInView:_}=e.coreUtilities,{enableExperienceLifeCycleManagerV2:F}=n.get(b.J.Core),D=new(F?dD:yD)(w,r,{authenticationService:I,client:e.client,clientAccessAdminPolicyCheckService:a,clientState:y,config:t,coreSecurityService:C,coreSettings:n,entityCommanding:o,eventing:A,hostCommunicationService:s,i18n:l,i18NextWrapper:f,isEntityInView:_,localStorage:v,loggerFactory:d,logsCollectorService:E,networkState:u,notificationsHandler:T,platformService:m,rebootService:k,scenarioFactory:p,windowProvider:S},c,d,t.lifeCycleJobPermissions);return D.init(),e.appsRegistryService.registeredApps.forEach((e=>D.manageApplication(e))),D.manageApplication(this.createCoreApplication(I,i,h,s,N)),e.scheduler=w,e.experienceLifecycleManager=D,async e=>{switch(e){case"quit":case"signout":await D.destroy(e);break;default:return}}}}const GD=(e,t)=>({id:"cleanup-t1-desktop-job",runOncePerId:!0,job:()=>{const{context:{clientAccessAdminPolicyCheckService:n,hostCommunicationService:i,loggerFactory:a}}=e,o=a.newLogger("CleanupT1DesktopJob","cleanup-t1-desktop-job");if(n){const e=n.shouldUserAttemptT1Cleanup().subscribe((async e=>{if(e){const e=await i.loadModule("appswitcher");if(e?.uninstallT1App){o.log("PIE: uninstallT1App");try{await e.uninstallT1App(),t.recordPanelAction({panelType:"OpenApplication",actionScenario:"UninstallT1App",actionOutcomeNew:"T1AppUninstalled",actionGesture:"auto"})}catch(e){t.recordPanelAction({panelType:"OpenApplication",actionScenario:"UninstallT1App",actionOutcomeNew:"T1AppUninstallFailed",actionGesture:"auto"})}}}}));return()=>{e.unsubscribe()}}return()=>{}}}),zD=(e,t)=>({id:"high-memory-restart-service",runOncePerId:!0,job:()=>{const{context:{authenticationService:n,client:i,clientState:a,config:o,coreSettings:r,loggerFactory:s,rebootService:l,scenarioFactory:c}}=e;r.get(b.J.Diagnostics).enableHighMemoryRestartService&&r.get(b.J.Diagnostics).highMemoryRestartSettings&&bD.createInstance(o,i,a,r,l,c,t,s,n)}}),qD=e=>({id:"initialize-office-integration-service",job:()=>{const{coreSettings:t,client:n,hostCommunicationService:i,loggerFactory:a,entityCommanding:o,authenticationUser:r,localStorage:s,windowProvider:l}=e.context,{launchIntent:c}=t.get(b.J.HostCapabilities);t.get(b.J.People).enableOfficeIntegration&&r?.role!==ys.w4.Anonymous&&"LaunchCoreNoSystemTray"!==c&&OD.x.Instance(i,t,n,a,o,l,s,r).initialize()}});class JD{constructor(e){this.localStorage=e,this.logsProviderName="LocalStorageLogsProvider"}getLogsFiles(){const e=this.localStorage,t=e.calculateUsageStats?.(),n=e.getUsageMetadataStats?.(),i=t?JSON.stringify({userData:{...t.User,...t.UserAndExperience,otherTMP:Object.values({...t.Global,...t.Experience}).reduce(((e,t)=>e+t),0),nonTMP:Object.values(t.Unmanaged??{}).reduce(((e,t)=>e+t),0)},usageMetadata:n}):n?JSON.stringify({usageMetadata:n}):"";return Promise.resolve([{fileName:"local-storage-usage.json",content:i,isPiiFree:!1}])}}const QD=["TflFreProfileCardDisplayed","newTeamsOnlyEffectivePolicyStartTime",n(269678).H],KD=["isOptedIntoT2Web","policy-cache","previousSessionErrorLogs-Core","previousSessionLogs-Core"],YD=["loaderDiagnostics","local-user-preferences","previousLoaderDiagnostics"];class XD extends _e{constructor(){super(h.Yg.CreateLocalStorage,["authenticationUser","config","coreSettings","loggerFactory","logsCollectorService","windowProvider"])}async execute(e){const{authenticationUser:t,config:n,coreSettings:i,windowProvider:a,loggerFactory:o}=e,r=new FA(t.profile.tenantId,t.profile.objectId,n.experienceName,a,o);r.subscribeToCoreSettings(i);let s;!!i.get(b.J.Core).disableLocalStorageLogsProvider||(s=new JD(r),e.logsCollectorService.registerUserLogsProvider(t.profile.objectId,s));const l=o.newLogger("CreateLocalStorage","core-services-tasks"),c=(0,xe.b4)(t);e.localStorage=r;const d=!i.get(b.J.Auth).isLegacyCleanupCodeFlag;return async n=>{if("signout"===n&&d){const e=await function(e,t,n){const i={},a=[...YD,...(0,Bf.nC)(n)];try{QD.forEach((t=>{const n=e.get(t,"UserAndExperience");n&&(i[t]=n)})),e.clear(["UserAndExperience","User"]),a.map((t=>e.remove(t,"Experience"))),KD.map((t=>e.remove(t,"Global")))}catch(e){t.warn(`Failed to clear local storage! ${e}`)}return i}(r,l,c);e&&function(e,t,n){const i=Object.keys(t);try{i.forEach((n=>{e.set(n,t[n],"Framework","UserAndExperience")}))}catch(e){n.warn(`Failed to restore local storage values for ${i}: ${e}!`)}}(r,e,l)}switch(n){case"quit":case"signout":s&&e.logsCollectorService.unregisterUserLogsProvider(t.profile.objectId,s.logsProviderName);new UE.I(r).clear(),r.dispose();break;default:return}}}}const ZD={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataCustomNotificationsRemoveWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},eP={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataCustomNotificationsCreateWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};function tP(e,t){return new Notification(e,t)}const nP="CN:",iP="BrowserNotifications:",aP=[H.ck.CallingNotificationRenderComplete,H.ck.MsnMeetingNotificationRenderComplete,H.ck.MeetingNudgeNotificationRenderComplete,H.ck.NormalNotificationRenderComplete,H.ck.ToastRenderCancelled,H.ck.NotificationRenderUpdate];class oP{constructor(e,t,n,i,a,o,r,s,l,c,d){this.activeWindowsService=e,this.waitForRenderingContextReady=t,this.hostCommunicationService=n,this.coreSettings=i,this.commandChangeReportingService=a,this.mainWindow=o,this.scenarioFactory=r,this.appsRegistryService=s,this.userBiService=l,this.activateBrowserToast=async e=>{this.mainWindow.focus();const t=e,n={entity:{type:Se.py.toasts,action:Se.uk.confirm},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new,correlation:{source:C.D.NotificationsActivation,startTimestamp:Date.now(),scenarioName:H.RG.ToastActivation,id:(0,Re.v4)()}},entityOptions:t},i=e.targetEntity.dataOptions?.userContextId;if(!i)return void this.logger.errorToTelemetry?.(`${iP} Error activating browser toast. UserContextId is missing from notifications entity command dataOptions.\n      Therefore, the user rendering context to use to activate this notification cannot be determined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0);this.startToastActivationScenario(n,{isBrowserNotification:!0});const a=await this.waitForRenderingContextReady(!1,i);await a.commandHandler(n)},this.logger=c.newLogger("NotificationsHandler","core-services-notifications"),this.i18n=d,this.notificationsWindowId=void 0,this.notificationsWindow=void 0,this.isWindowInInitState=!1,this.isResettingWindow=!1}async activateNotification(e){try{this.sendUserBiActivation(e);const{command:t,dataOptions:n}=e;if(this.startToastActivationScenario(e),!n||!n.userContextId)return void this.logger.errorToTelemetry?.(`${nP}Error activating notification. UserContextId is missing from notifications entity command dataOptions.\n      Therefore, the user rendering context to use to activate this notification cannot be determined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0);const{userContextId:i,actionType:a,callId:o,callingScenarioName:r}=n;this.sendTelemetry({callId:o,callingScenarioName:r,toastScenarioClientId:t.correlation.id,stepName:rP(a)});const s=this.waitForRenderingContextReady(!1,i),l=await s;return await D_({activeWindowsService:this.activeWindowsService,coreSettings:this.coreSettings,renderingContext:l,isHostCommandNotification:!0,handlerCommand:e,logger:this.logger,notificationUserContextId:i,appsRegistryService:this.appsRegistryService,logPrefix:nP}),this.addStepToToastActivationScenario(e),l.commandHandler(e)}catch(e){return void this.logger.errorToTelemetry?.(`${nP}Errored while activating notification:${e.message}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}}async resizeNotificationsWindow({windowFeatures:e}){if(this.notificationsWindowId&&this.notificationsWindow&&e){const{width:t,height:n}=e;this.logger.log(`${nP}Attempting to resize the notifications window to width= ${t} height= ${n}. windowId= ${this.notificationsWindowId}`);const{enableCustomNotificationsWindowReset:i}=this.coreSettings.get(b.J.Core);0!==t&&0!==n?this.isWindowInInitState=!1:0!==t||0!==n||this.isWindowInInitState||this.isResettingWindow||!i||(this.isResettingWindow=!0,await this.removeNotificationsWindow(),await this.createNotificationsWindow(),this.isResettingWindow=!1);const a=await(this.hostCommunicationService?.loadModule("toasts"));a?.resizeNotificationsPanel?.(t,n)}else this.logger.errorToTelemetry?.(`${nP}Error resizing the notifications window. notificationsWindowId = ${this.notificationsWindowId} windowFeatures width=${e?.width}; height=${e?.height}. window=${void 0!==this.notificationsWindow?"defined":"undefined"}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}async focusNotificationsWindow(){try{const e=await(this.hostCommunicationService?.loadModule("windowcontrols"));this.notificationsWindowId?e?.focus?.(this.notificationsWindowId):this.logger.errorToTelemetry?.(`${nP}Error focusing the notifications window. notificationsWindowId is undefined.`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}catch(e){this.logger.errorToTelemetry?.(`${nP}Error focusing the notifications window. Loading windowcontrols module failed with: ${e.message}`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}}isInAppNotificationsEnabled(e){const{enableInAppNotifications:t,enableInAppNotificationsForCalls:n,enableInAppNotificationsForChatsAndChannels:i}=this.coreSettings.get(b.J.Notifications);return!!t&&this.isToastEntitySupported(!!n,!!i,e)}isCustomNotificationsEnabled(e){const{enableCustomNotificationsOnDesktop:t,enableCustomNotificationsForCalls:n,enableCustomNotificationsForChats:i}=this.coreSettings.get(b.J.Core);return!!t&&this.isToastEntitySupported(!!n,!!i,e)}initializeWithWindow(e,t,n){this.logger.log(`${nP}Initializing notifications handler with notifications windowId=${e}`),this.notificationsWindowId=e,this.notificationsWindow=t,this.client=n,this.isWindowInInitState=!0}sendCommandToHost(e,t,n,i){let a="";a=(0,$.u4)(i?.targetEntity?.dataOptions),this.logger.log(`${nP}Sending toast command to host for display. TargetEntity type: [${i?.targetEntity?.type}] action [${i?.targetEntity?.action}] dataOptions [${a}]`),this.commandChangeReportingService.report({correlationId:t,type:dt.B.NotHandled,context:{target:"notificationsHandler",entityCommand:{entity:n,command:{...e,correlation:e.correlation,layoutMode:e.layoutMode||void 0},entityOptions:i}}})}showPermissionConfirmationBrowserNotification(){tP(this.i18n.stringTranslate("toastNotifications","browser_toast_permission_confirmation_title"),{body:this.i18n.stringTranslate("toastNotifications","browser_toast_permission_confirmation_body")})}async tryShowBrowserNotification(e){if("granted"!==Notification.permission)return"skippedNoPermissions";const{suppressBrowserToastWhenAppIsFocused:t}=this.coreSettings.get(b.J.Notifications,["suppressBrowserToastWhenAppIsFocused"]);if(t&&sP(this.mainWindow))return"skippedAppInFocus";const n=e.getWebToastOptions(),{notificationTitle:i,notificationOptions:a}=e.getNotificationOptionsPayload();try{const t=tP(i,a),o=()=>t;return e.registerGetNotificationCallback(o),t?.addEventListener("click",(async()=>{this.addBrowserNotificationScenarioStep(n,H.ck.BrowserToastActivated),await this.activateBrowserToast(n)})),this.addBrowserNotificationScenarioStep(n,H.ck.BrowserToastRequested),Promise.resolve("queued")}catch(e){return this.logger.errorToTelemetry?.(`${iP} Show browser notification toast failed.`,"webclient_framework_foundation_core_services_notifications",void 0,!0),Promise.resolve("skippedReasonUnknown")}}sendTelemetry(e){const{callId:t,callingScenarioName:n,reason:i,stepName:a,toastScenarioClientId:o}=e,r=t||"",s=this.scenarioFactory.findScenarioByNameAndId(n,r),l=this.scenarioFactory.findScenarioByNameAndId(H.RG.WebToastShow,o),c=this.scenarioFactory.findScenarioByNameAndId(H.RG.CrossClientToastView,o);s?.mark(a),l?.mark(a),c?.mark(a),aP.includes(a)&&(l?.stop({reason:i}),c?.stop({reason:i}),s&&s.name===H.RG.MeetingStartedNotification&&s.stop())}sendDismissToastTelemetry({correlationId:e,toastType:t,reason:n}){const i=this.scenarioFactory.newScenario(H.RG.ToastActivation,{clientId:e});i.appendEventData({isCustomNotification:!0,mainEntityType:t}),i.stop({reason:n})}offsetNotificationsWindow(e){this.hostCommunicationService?.loadModule("toasts").then((t=>{if(t){if(t.offsetNotificationsPanel)return t.offsetNotificationsPanel(e);this.logger.errorToTelemetry?.(`${nP}toasts.offsetNotificationsPanel method not available`,"webclient_framework_foundation_core_services_notifications",void 0,!0)}else this.logger.errorToTelemetry?.(`${nP}Cannot load toasts module to offset the notifications window. updating windows cache with newly created notifications window`,"webclient_framework_foundation_resolvers_notifications",void 0,!0)}))}sendUserBiActivation(e){T_(this.userBiService,this.logger,e,!0)}addStepToToastActivationScenario(e){const t=this.scenarioFactory.findScenarioByNameAndId(H.RG.ToastActivation,e.command.correlation.id);if(t){const n=e.command.stateTransition===ke.su.new?H.ck.StateTransitionNotOverriden:H.ck.StateTransitionOverriden;t.mark(n)}}startToastActivationScenario(e,t={}){const{command:n}=e,{isBrowserNotification:i}=t,a=n.correlation.startTimestamp?+n.correlation.startTimestamp:void 0;(this.scenarioFactory.findScenarioByNameAndId(H.RG.ToastActivation,n.correlation?.id)||this.scenarioFactory.newScenario(H.RG.ToastActivation,{startTime:a,clientId:n.correlation.id})).appendEventData({isCustomNotification:!0,mainEntityType:e.entity.type,isBrowserNotification:i})}addBrowserNotificationScenarioStep(e,t){const{crossClientScenarioName:n}=e,i=e.callId||"",a=this.scenarioFactory.findScenarioByNameAndId(n,i);a?.mark(t)}async removeNotificationsWindow(){this.notificationsWindow&&this.client&&(this.notificationsWindow?.close(),await this.client.mutate({mutation:ZD,fetchPolicy:"no-cache"}),this.notificationsWindowId=void 0,this.notificationsWindow=void 0,this.isWindowInInitState=!1)}async createNotificationsWindow(){!this.notificationsWindow&&this.client&&await this.client.mutate({mutation:eP,fetchPolicy:"no-cache"})}isToastEntitySupported(e,t,n){return n?.targetEntity?.type===y.dt.calls?e:t}}const rP=e=>{switch(e){case"AcceptIncomingCallContentOnly":return H.ck.AcceptIncomingCallContentOnly;case"AcceptIncomingCallWithAudio":return H.ck.AcceptIncomingCallWithAudio;case"AcceptIncomingCallWithVideo":return H.ck.AcceptIncomingCallWithVideo;case"AcceptIncomingCallThroughPrejoin":return H.ck.AcceptIncomingCallThroughPrejoin;case"AcceptIncomingScreenshareOnlyCall":return H.ck.AcceptIncomingScreenshareOnlyCall;case"IgnoreIncomingCall":return H.ck.IgnoreIncomingCall;case"RejectIncomingCall":return H.ck.RejectIncomingCall;case"ReplyIncomingCall":return H.ck.ReplyIncomingCall;case"NavigateToCallTab":return H.ck.NavigateToCallTab;case"ResumeCallTransfer":return H.ck.ResumeCallTransfer;default:return`${e}Clicked`}},sP=e=>e.document.hasFocus();class lP extends _e{constructor(){super(h.Yg.CreateNotificationsHandlerTask,["activeWindowsService","appsRegistryService","commandChangeReportingService","coreSettings","hostCommunicationService","loggerFactory","scenarioFactory","waitForRenderingContextReady","windowProvider","userBiService","i18n"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,commandChangeReportingService:i,coreSettings:a,hostCommunicationService:o,loggerFactory:r,scenarioFactory:s,waitForRenderingContextReady:l,windowProvider:c,userBiService:d,i18n:u}=e;e.notificationsHandler=new oP(t,l,o,a,i,c,s,n,d,r,u)}}var cP=n(65733);class dP{constructor(e){this.userAgent=e,this.UAParser=cP.getParser(e)}getBrowser(){switch(this.UAParser.getBrowserName()){case"Microsoft Edge":return An.AR.Edge;case"Safari":return An.AR.Safari;case"Chrome":return An.AR.Chrome;case"Firefox":return An.AR.Firefox;case"Electron":return An.AR.Electron;default:return An.AR.Unknown}}getVendor(){const e=this.UAParser.getPlatform()?.vendor?.toString();return e||""}getOSDetails(){const e=this.UAParser.getOS();return{name:e?.name,version:e?.version,versionName:e?.versionName}}getBrowserVersion(){return this.UAParser.getBrowserVersion()}getRingConfig(e=pt.s.prod,t){switch(t){case"ring0_gcc":t="ring0",e=pt.s.gcc;break;case"general_gcc":t="general",e=pt.s.gcc}return{ring:t,environment:e}}getOsPlatform(){const e=this.getOsOverride();if(null!=e)return e;switch(this.UAParser.getOSName()){case"Windows":return An.NR.Windows;case"macOS":return An.NR.Mac;case"Linux":return An.NR.Linux;case"Chrome OS":return An.NR.ChromeOS;case"Android":return An.NR.Android;case"iOS":return An.NR.IOS;case"Windows Phone":return An.NR.WindowsPhone;default:return An.NR.Unknown}}getOSPlatformVersion(){const e=this.host?.deviceInfo?.osVersion;return e||this.UAParser.getOSVersion()}getOsOverride(){return null}getPlatformId(e,t){let n=this.getClientType(e,t);const i=this.getMetaOsPlatformId(e);return i||(n===An.Bh.Desktop&&this.getOsPlatform()===An.NR.Mac&&(n="Mac"),n=`${n[0].toUpperCase()}${n.substr(1)}`,An.us[n])}getMetaOsPlatformId(e){switch(e?.metaoshost?.toLowerCase()){case"office":return An.us.MetaOsOffice;case"outlook":return An.us.MetaOsOutlook}return null}getClientType(e,t){let n=e&&e.host;if(!n&&t){const e="host";n=t.localStorage.getItem(e)||""}return"outlookDesktop"===n?An.Bh.Desktop:"outlookWeb"===n?An.Bh.Web:this.getBrowser()===An.AR.Electron?An.Bh.Desktop:An.Bh.Web}getCpuArchitecture(){let e;const t=/x\d{2}_\d{2}|(i[3-6]86|x\d{2}|amd\d{2}|wow\d{2}|arm\d{2}|arm|ARM|aarch\d{2}|ppc\d{2}|ppc\d{2}le)|Intel|Android\s+\d+\.\d+\.\d+;\s*(\S+)/;try{e=this.userAgent.match(t)}catch{return""}return e?.[0]||""}}class uP extends dP{constructor(e,t,n,i,a){super(n.navigator.userAgent),this.loggerFactory=e,this.routingServices=t,this.windowHost=n,this.hostSettings=i,this.getPlatformConfigurationOverrides=a,this.fullBrowserVersionUpdated=!1,this.logger=this.loggerFactory.newLogger("PlatformService","core-services-platform"),this.queryStringParameters=this.routingServices.state.getSearchState()||{},this.headConfig=Pn(this.windowHost,this.logger),this.cachedConfig=this.computeConfig(),this.cachedEcsOverrides=this.computeEcsOverrides()}get config(){return this.cachedConfig}get ecsOverrides(){return this.cachedEcsOverrides}get host(){const e=this.windowHost.loader?.getProperties?.();return{bootType:e?.bootType||v.Unknown,deviceId:e?.deviceId||Ze.get("deviceId"),deviceInfo:e?.deviceInfo,hostAppVersion:jn(this.windowHost),sessionId:e?.sessionId||Ze.get("sessionId"),preAuthUserId:e?.preAuthUserId,...this.windowHost.getHostedWindowContext()}}async updateAsyncPlatformInfo(){if(!(this.fullBrowserVersionUpdated||void 0===this.cachedConfig.browserVersion||this.cachedConfig.browserVersion.indexOf(".0.0.0")<0)){this.fullBrowserVersionUpdated=!0;try{let e;if(!this.windowHost.navigator||!("userAgentData"in this.windowHost.navigator))return;e=this.windowHost.navigator.userAgentData;const t=await e.getHighEntropyValues(["fullVersionList"]);if(t&&t.fullVersionList&&t.fullVersionList.length>0)for(const e of t.fullVersionList)if(e.brand.toUpperCase().indexOf(this.cachedConfig.browser.toUpperCase())>=0){this.cachedConfig.browserVersion=e.version||this.cachedConfig.browserVersion;break}}catch(e){this.logger.errorNoPii?.(`Fetching full browser version failed: ${this.cachedConfig.browser} - ${this.cachedConfig.browserVersion||""}`)}}}getOsOverride(){return this.windowHost.localStorage.getItem("platformOverride")}computeConfig(){let e={};this.getPlatformConfigurationOverrides&&(e=this.getPlatformConfigurationOverrides(this.windowHost,this.queryStringParameters)),this.logger.log(`IPlatformConfiguration overrides: ${JSON.stringify(e)}`);const t=this.getBrowser(),n=e.clientType??this.getClientType(this.queryStringParameters,this.windowHost),i=this.determinePlatformId(e);this.logger.log(`Determined PlatformID to be '${i}'`);const a=this.getHostingParent(),o=this.windowHost.__VERSION__,r=`${i}/${o}`,s=this.windowHost.__webpack_public_path__,l=this.getVendor(),c=this.getOSDetails(),d=this.getCpuArchitecture();let u="https://statics.teams.cdn.office.net";try{s&&(u=new URL(s).origin)}catch{this.logger.warn(`Failed to parse dynamic staticsPath origin from '${s}'`)}const m=this.windowHost.navigator.language||"en-us",p=this.windowHost.loaderConfig?.pullRequestId,g=this.windowHost.loaderConfig?.buildId;this.logger.log(`PlatformService: configuring with clientVersion: ${r}`);const h=this.windowHost.loader?.getProperties?.()?.deviceInfo?.browserVersion;return h&&(this.fullBrowserVersionUpdated=!0),{browser:t,browserVersion:h||this.getBrowserVersion(),buildType:Dn(r),buildVersion:o,clientContext:this.getClientContext(a),clientType:n,clientVersion:r,cpuArchitecture:d,currentUrl:this.windowHost?.location?.href,hostingParent:a,isInCypressFrame:this.getIsInCypressFrame(),isInIframe:this.getIsInIframe(),isInternalUser:this.headConfig.isInternalUser,isOcdi:this.headConfig.isOcdi,isPwa:this.getIsPwa(),osDetails:c,osPlatform:this.getOsPlatform(),osVersion:this.getOSPlatformVersion(),platformId:i,publicPath:s,staticsPath:u,userAgent:this.userAgent,userLanguage:m,vdi:e.vdi,vendor:l,getLocaleInfoAsync:this.windowHost.getLocaleInfoAsync,pullRequestId:p,buildId:g}}determinePlatformId(e){const t=e.platformId,n=this.hostSettings?.hostSettings?.platformId;if(this.logger.logNoPii?.(`Potential PlatformID sources: experienceOverrides='${t}', hostSettings='${n}', qsp='${JSON.stringify(this.queryStringParameters)}', windowHostHost='${this.windowHost?.localStorage.getItem("host")}'`),t)return this.logger.logNoPii?.("Using PlatformID value from experience overrides"),t;if(n){const e=parseInt(n,10);if(e)return this.logger.logNoPii?.("Using PlatformID value from host settings"),e}return this.logger.logNoPii?.("Using PlatformID value from QSP/WindowHost/Browser"),this.getPlatformId(this.queryStringParameters,this.windowHost)}getHostUrl(){const e=this.windowHost.localStorage.getItem("ecsHostUrl")||this.headConfig.ecsHostUrl;if(e)return new URL(e,this.windowHost.location.origin).href}computeEcsOverrides(){const e=this.getHostUrl(),t=this.getEnvironmentOverride()||function(e,t){let n=t?.environment||"prod";return"infer"===n&&(n=function(e){return e.location.origin.includes("gov")?"gcchigh":e.location.origin.includes("dod")?"dod":e.location.origin.includes("live")?"life":"prod"}(e)),n}(this.windowHost,this.headConfig),n=(0,W.get)(pt.s,t),i=this.getRingOverride(),{originalRing:a,unauthenticated:o}=this.headConfig,r=void 0===a||a===i;return{hostUrl:e,...this.getRingConfig(n,i),originalRing:a,unauthenticated:o,isAssignedRing:r}}getEnvironmentOverride(){if(this.queryStringParameters.webinarRing)return this.queryStringParameters.webinarRing}getRingOverride(){if(this.headConfig.isInternalUser&&this.queryStringParameters.ring)return this.queryStringParameters.ring;const e=this.windowHost.getHostedWindowContext();if(e?.ring)return e.ring;const{ring:t}=this.headConfig;return t?"string"==typeof t?t:t.id:void 0}getHostingParent(){const e=Mn(this.windowHost);return e&&e.dataset&&"outlook"===e.dataset.host?An.GJ.Outlook:An.GJ.Unknown}getClientContext(e){return e===An.GJ.Outlook?An.RY.Embed:void 0}getIsInIframe(){return!!this.windowHost.getHostedWindowContext().isInIframe}getIsInCypressFrame(){return!!this.windowHost.getHostedWindowContext().isInCypressFrame}getIsPwa(){if(void 0!==this.cachedIsPwa)return this.cachedIsPwa;const e=this.queryStringParameters?.clientType===An.Bh.PWA,t=this.windowHost?.matchMedia("(display-mode: standalone)"),n=t?.matches;return t?.addEventListener("change",(t=>{t.matches?this.logger?.infoToTelemetry?.(`Client Type changed to PWA, qspClientType: ${e}`,"client_type_pwa"):this.logger?.infoToTelemetry?.(`Client Type changed to Web, qspClientType: ${e}`,"client_type_pwa")})),e!==n&&this.logger?.warnToTelemetry?.(`PWA client type detection methods disagree: QueryArg: ${e}, DisplayModeStandalone: ${n}`,"client_type_pwa"),this.cachedIsPwa=n,this.cachedIsPwa}}class mP extends _e{constructor(){super(h.Yg.CreatePlatform,["windowProvider","loggerFactory","routingServices"])}async execute(e){const{windowProvider:t,loggerFactory:n,routingServices:i,hostSettings:a,getPlatformConfigurationOverrides:o}=e,r=new uP(n,i,t,a,o);await r.updateAsyncPlatformInfo(),e.platformService=r}}var pP=n(471323),gP=n(840633);const hP="Profiler:: ";var yP,vP;!function(e){e.LoadModuleProfilerFailed="LoadModuleProflierFailed",e.ExecuteCommandFailed="ExecuteCommandFailed"}(yP||(yP={})),function(e){e.LoadModuleProfilerSuccess="LoadModuleProfilerSuccess",e.ExecuteCommandSuccess="ExecuteCommandSuccess"}(vP||(vP={}));class fP{constructor(e,t,n){this.hostCommunicationService=t,this.coreSettings=n,this.logger=e.newLogger("ProfilerService","services-io-profiler"),this.exposeToCoreWindow()}async getMemoryData(){const e=this.coreSettings.get(b.J.Telemetry).heartbeatConfiguration?.workerMetricsCollection?.enabled||!1,t=await(0,pP.K)(this.hostCommunicationService,this.logger,e);return(0,gP.Mv)(t.processes)}async getHeapSnapshot(e=!0){const t=await this.getProfilerModuleAsync();if(!t)return;e&&await this.requestTriggerGC();const n=await(t.getHeapSnapshot?.());return n?.snapshot?n.snapshot:void 0}async requestTriggerGC(){const e=await this.getProfilerModuleAsync();if(!e)return!1;const t=await(e.triggerGC?.());return!!t?.status}async getProfilerModuleAsync(){let e;try{e=await this.hostCommunicationService.loadModule("profiler"),this.logger.log(`${hP}${vP.LoadModuleProfilerSuccess}`)}catch(e){this.logger.error(`${hP}${yP.LoadModuleProfilerFailed} ${(0,$.u4)(e)}`)}return e}async exposeToCoreWindow(){const e=await this.hostCommunicationService.loadModule("profiler"),t=await this.hostCommunicationService.loadModule("heartbeat");e&&t?globalThis.window.profiler={...e,getMemoryData:()=>this.getMemoryData(),getHeapSnapshot:(e=!1)=>this.getHeapSnapshot(e),getTotalWorkingSetSizeBytes:()=>this.getWorkingSetSizeFromProcesses(t?.getPerfMetrics),getTotalCommitSizeBytes:()=>this.getCommitSizeFromProcesses(t?.getPerfMetrics)}:this.logger.log("HostComms is unable to load profiler and/or heartbeat module. We are running on Web or Teams 1.0. Bailing out.")}async getWorkingSetSizeFromProcesses(e){if(e){const t=await e();return t?.reduce(((e,t)=>(e.workingSetSizeBytes+=t.workingSetSizeBytes,e)),{workingSetSizeBytes:0}).workingSetSizeBytes}return this.logger.warn("Unable to get perf metrics."),-1}async getCommitSizeFromProcesses(e){if(e){const t=await e();return t?.reduce(((e,t)=>(e.pageFileUsageBytes+=t.pageFileUsageBytes,e)),{pageFileUsageBytes:0}).pageFileUsageBytes}return this.logger.warn("Unable to get perf metrics."),-1}}class SP extends _e{constructor(){super(h.Yg.CreateProfiler,["loggerFactory","hostCommunicationService","coreSettings"])}async execute(e){e.profilerService=new fP(e.loggerFactory,e.hostCommunicationService,e.coreSettings)}}class kP{constructor(e,t,n,i,a,o,r,s,l,c){this.loggerFactory=e,this.host=t,this.clientStateProvider=n,this.networkStateProvider=i,this.platformService=a,this.hostCommunicationService=s,this.localStorage=l,this.scenarioFactory=c,this.cleanupOnRebootArray=[],this.expChangeSubscription=null,this.lcChangeSubscription=null,this.clientStateSubscription=null,this.isRunningJobsInLongInactive=!1,this.rebootPending=void 0,this.registerCleanupCallback=e=>{this.cleanupOnRebootArray.push(e)},this.didUrlChange=e=>(0,Qo.IC)(e)!==(0,Qo.IC)(this.host.location.href),this.areMaxRetriesExhausted=(e,t)=>{if(t?.maxRetries){const n=this.getRetryStorageKey(e),i=this.localStorage.get(n,"Experience"),a=i&&parseInt(i,10)||0;this.logger.debug(`Reboot retry count for '${e}': ${a}`);const o=a>=t.maxRetries;return this.localStorage.set(n,`${a+1}`,"Framework","Experience"),o&&this.logger.warn(`Max retries exhausted for '${e}', retryCount: ${a}, maxRetries: ${t.maxRetries}`),o}return!1},this.getRetryStorageKey=e=>`rebootRetries.${e}`,this.logger=this.loggerFactory.newLogger("rebootService","core-services-reboot"),this.expChangeSubscription=o.observeChanges().pipe((0,d.U)((e=>{this.isExperienceIdleStateChangedEvent(e)&&(this.isRunningJobsInLongInactive=!0)}))).subscribe(),this.lcChangeSubscription=r.observeChanges().pipe((0,d.U)((({context:e})=>{const{target:t,reportedChange:n}=e;if(this.isRunningJobsInLongInactive&&t===AF.UserLifeCycleManager&&this.isExperienceIdleStateChangedEvent(n)&&(this.isRunningJobsInLongInactive=!1,this.rebootPending)){this.host.clearTimeout(this.timeoutId),this.logger.log("Core finished running App jobs in LongInactive client state. Issuing pending reboot now...");const{reason:e,commandSource:t,options:n}=this.rebootPending;this.rebootApp(e,t,n)}}))).subscribe()}async rebootApp(e,t,n){if(await this.cleanupBeforeReboot(),this.logger.log(`Reboot app triggered for ${e} from ${t} with options: ${(0,$.u4)(n)}`),this.areMaxRetriesExhausted(t,n))return!1;try{this.dispose();const i=this.scenarioFactory.findScenario(H.RG.ClientStart);i?.incomplete({commandSource:t,reason:e});const a=this.getReloadUrl(n,t,e);this.platformService.config.clientType===An.Bh.Maglev?await this.rebootThroughDesktopApi(a,t,e,"reboot_maglev_request"):this.platformService.config.clientType===An.Bh.Desktop&&e===Dr.Z.AuthTokenForceRefresh?await this.rebootThroughDesktopApi(a,t,e,"reboot_t1_request"):this.didUrlChange(a)?this.host.location.replace(a):this.host.location.reload()}catch{return this.logger.error("Reboot app failed"),!1}return!0}rebootWhenLongInactive(e,t,n){return this.clientStateSubscription?(this.logger.log(`Reboot subscription already exist, skip the subscription from ${t} with reason ${e}`),!1):(this.logger.log(`Reboot when longInactive is subscribed from ${t} with reason ${e}`),this.clientStateSubscription=this.clientStateProvider.observe().subscribe((i=>this.handleClientStateChange(i,e,t,n))),!0)}clearRetryCount(e){this.localStorage.remove(this.getRetryStorageKey(e),"Experience")}dispose(){this.isRunningJobsInLongInactive=!1,this.rebootPending=void 0,this.timeoutId&&(this.host.clearTimeout(this.timeoutId),this.timeoutId=void 0),this.clientStateSubscription?.unsubscribe(),this.clientStateSubscription=null,this.expChangeSubscription?.unsubscribe(),this.expChangeSubscription=null,this.lcChangeSubscription?.unsubscribe(),this.lcChangeSubscription=null}async cleanupBeforeReboot(){let e,t,n;for(;e=this.cleanupOnRebootArray.pop();)try{await e("restart")}catch(n){t=t?t.concat(`${e.toString()}::${(0,$.u4)(n)}`):`${e.toString()}::${(0,$.u4)(n)}::`}t&&(n=new Me.G(Me.$.CLEANUP,new Error(t)),this.logger.errorToTelemetry?.(`${n.code}${n.prevError?.message}`,"webclient_framework_foundation_core_services",void 0,!0))}async rebootThroughDesktopApi(e,t,n,i){const a=await this.hostCommunicationService.loadModule("core");if(!a)return void this.logger.errorToTelemetry?.("HostComms is unable to load core module.",i,void 0,!0);const o=`${n}; source: ${Dr.d[t]}`;this.logger.infoToTelemetry?.(o,i,void 0,!0);try{await(a.relaunch?.({url:e,reason:o}))}catch{this.logger.errorToTelemetry?.(`${o} PIE API call failed`,i,void 0,!0)}}handleClientStateChange(e,t,n,i){this.networkStateProvider.getState()===Os.G.Online?(this.logger.log(`Handling clientState change to ${e}.`),e===Fe.pk.LongInactive&&(this.rebootPending={reason:t,commandSource:n,options:i},this.isRunningJobsInLongInactive?this.waitForRunningJobsAndReboot():this.rebootApp(t,n,i))):this.logger.log(`Reboot skipped, network state is offline when client state change to ${e}.`)}getReloadUrl(e,t,n){const i=new URL(e?.customUrl||this.host.location.href),a=i.searchParams;e?.qsps?.hasOwnProperty("clearcontainer")&&a.delete("container"),a.delete("tenantId"),i.hash=this.getReloadHash(t,n,i.hash);const o=e?.qsps||{};return Object.keys(o).forEach((e=>{a.set(e,o[e])})),i.toString()}getReloadHash(e,t,n){if(this.platformService.config.clientType===An.Bh.Maglev){const i=cs(n);let a;if(i.deepLink===Fr.n0.core)a=Fr.n0.core;else switch(e){case Dr.d.WebClientUpdateService:a=Fr.n0.core;break;case Dr.d.ReloadAppTask:a=!i.deepLink||i.deepLink===Fr.n0.flyout||t!==Dr.Z.RingSwitch&&t!==Dr.Z.HighMemory?Fr.n0.default:encodeURIComponent(i.deepLink);break;default:a=Fr.n0.default}return`deepLink=${a}&source=${Dr.d[e]}`}return n}waitForRunningJobsAndReboot(){this.logger.log("Pending a reboot while waiting for Core to finish running App jobs in LongInactive client state. timeout=2000 ms"),this.timeoutId=this.host.setTimeout((()=>{if(this.host.clearTimeout(this.timeoutId),this.rebootPending){this.logger.log("Timeout waiting for Core to finish running App jobs in LongInactive client state. Rebooting now...");const{reason:e,commandSource:t,options:n}=this.rebootPending;this.rebootApp(e,t,n)}}),2e3)}isExperienceIdleStateChangedEvent(e){return e.type===gt.yU.ExperienceIdleStateChanged&&e.context.isIdle}}class CP extends _e{constructor(){super(h.Yg.CreateReboot,["clientState","experienceChangeReportingService","hostCommunicationService","lifeCycleScopeChangeReportingService","localStorage","loggerFactory","networkState","platformService","scenarioFactory","windowProvider"])}async execute(e){const{clientState:t,experienceChangeReportingService:n,hostCommunicationService:i,lifeCycleScopeChangeReportingService:a,localStorage:o,loggerFactory:r,networkState:s,platformService:l,scenarioFactory:c,windowProvider:d}=e;e.rebootService=new kP(r,d,t,s,l,n,a,i,o,c)}}var bP=n(268644),wP=n(577911);class TP extends _e{constructor(){super(h.Yg.CreateRouting,[])}async execute(e){const t=e.config.forceUseBrowserHistory||!e.windowProvider||""===e.windowProvider.location.hash?(0,bP.lX)({basename:e.config.basePath}):(0,bP.q_)({basename:e.config.basePath});e.history=t,e.routingServices=(0,wP.I)(e.loggerFactory,e.history,e.windowProvider&&e.windowProvider.location)}}class IP{constructor(e,t){this.statsPerIdMap=new Map,this.startTimeMap=new Map,this.telemetryReportInterval=0,this.globalStats={maxInQueueTaskCount:0,totalLatencyTime:0,executedTaskCount:0,maxLatency:0,reportSequence:0,queueSize:0},this.logger=e.newLogger("PostTaskSchedulerDiagnosticsService","core-services-scheduling"),this.host=t}subscribeToCoreSettings(e){e.getObservable(b.J.Core,["schedulerTelemetryIntervalMS"]).subscribe((e=>{if(e.schedulerTelemetryIntervalMS){const t=e.schedulerTelemetryIntervalMS;this.telemetryReportInterval!==t&&(this.telemetryReportInterval=t,this.initializeTelemetryReporter(t))}}))}markTaskEnqueued(e,t){this.startTimeMap.set(e,performance.now());let n=this.statsPerIdMap.get(t);n||(n={executedTaskCount:0,maxLatency:-1,totalLatencyTime:0,totalLatencyTimeThisReport:0}),this.statsPerIdMap.set(t,n),this.globalStats.queueSize++,this.globalStats.queueSize>this.globalStats.maxInQueueTaskCount&&(this.globalStats.maxInQueueTaskCount=this.globalStats.queueSize)}markTaskDequeued(e,t){const n=this.statsPerIdMap.get(t),i=this.startTimeMap.get(e);if(!i)return;this.startTimeMap.delete(e),this.globalStats.executedTaskCount++,this.globalStats.queueSize--;const a=Math.round(performance.now()-i);this.globalStats.totalLatencyTime+=a,a>this.globalStats.maxLatency&&(this.globalStats.maxLatency=a),n&&(n.totalLatencyTime+=a,n.totalLatencyTimeThisReport+=a,n.executedTaskCount++,a>n.maxLatency&&(n.maxLatency=a))}initializeTelemetryReporter(e){this.clearTelemetryInterval(),e>=6e4&&(this.telemetryIntervalId=this.host.setInterval((()=>this.reportTelemetry()),e))}clearTelemetryInterval(){this.telemetryIntervalId&&(this.host.clearInterval(this.telemetryIntervalId),this.telemetryIntervalId=0)}reportTelemetry(){0!==this.globalStats.maxInQueueTaskCount&&(this.logger.infoToTelemetry?.("send-log-to-console-and-diagnostics","webclient_framework_foundation_post_task_scheduler_diagnostics",{maxSchedulerWaitLatency:this.globalStats.maxLatency,maxSchedulerQueueSize:this.globalStats.maxInQueueTaskCount,totalTaskWaitLatency:this.globalStats.totalLatencyTime,totalExecutedTaskCount:this.globalStats.executedTaskCount,sequence:this.globalStats.reportSequence}),this.statsPerIdMap.forEach(((e,t)=>{this.logger.infoToTelemetry?.(`send-log-to-console-and-diagnostics-${t}`,"webclient_framework_foundation_post_task_scheduler_diagnostics",{maxSchedulerWaitLatency:e.maxLatency,totalTaskWaitLatency:e.totalLatencyTime,totalExecutedTaskCount:e.executedTaskCount,sequence:this.globalStats.reportSequence}),e.totalLatencyTimeThisReport=0})),this.globalStats.reportSequence++)}}class NP extends _e{constructor(){super(h.Yg.CreateSchedulerTask,["schedulerChangeReporting","loggerFactory","diagnosticsService","windowProvider"])}async execute(e){const{diagnosticsService:t,loggerFactory:n,schedulerChangeReporting:i,windowProvider:a}=e,o=new IP(n,a),r=new Ja(i,window,n,h.QU,o);e.postTaskSchedulerDiagnosticsService=o,e.scheduler=r,t.setScheduler(r)}}class EP{constructor(e,t,n,i,a,o,r,s){this.experienceChangeReportingService=e,this.commandChangeReportingService=t,this.appsRegistryService=n,this.scheduler=i,this.hostComms=a,this.userKey=o,this.context=r,this.activeWindowsService=s,this.mainWindowDisplayedChange={windowId:null,eventFired:!1},this.processExperienceChangeChange=async e=>{e.type===gt.yU.UserConsentedToConsumeResources&&(this.layoutRenderedChange&&(this.layoutRenderedChange=void 0),this.userConsentedChange=e),e.type===gt.FV.LayoutRenderComplete&&!0===e.isMainWindow&&(this.layoutRenderedChange=e),this.tryToSendSignal()},this.onWindowVisibilityChanged=async e=>{const t=await this.isMainWindowForActiveUserContext(e.windowId);if(!e.visible||this.mainWindowDisplayedChange&&this.mainWindowDisplayedChange?.eventFired)e.visible||(t&&(this.mainWindowDisplayedChange.windowState=await this.getWindowState(e.windowId)),this.mainWindowDisplayedChange.eventFired=!1,this.mainWindowDisplayedChange.windowId=null);else{if(!t)return;this.mainWindowDisplayedChange.windowId=e.windowId,this.tryToSendSignal()}}}async init(){this.experienceChangeReportingServiceSubscription=this.experienceChangeReportingService.observeChanges().pipe((0,m.h)((e=>e.userContextId===this.userKey))).subscribe(this.processExperienceChangeChange),this.commandChangeReportingServiceSubscription=this.commandChangeReportingService.observeChanges().pipe((0,m.h)((e=>e.userContextId===this.userKey&&!!e.isMainWindow&&e.type===dt.B.WindowCreated&&e.context.layoutMode===ke.lO.standard))).subscribe((e=>{this.mainWindowRenderedChange=e,this.tryToSendSignal()}));const e=await this.hostComms.loadModule("windowcontrols");this.windowVisibilityChangeSubscription=e?.registerForWindowVisibilityChanged?.(this.onWindowVisibilityChanged)}dispose(){this.experienceChangeReportingServiceSubscription&&this.experienceChangeReportingServiceSubscription.unsubscribe(),this.commandChangeReportingServiceSubscription&&this.commandChangeReportingServiceSubscription.unsubscribe(),this.windowVisibilityChangeSubscription&&this.windowVisibilityChangeSubscription()}tryToSendSignal(){if(!this.shouldSendSignal())return;const e=this.appsRegistryService.registeredApps;this.scheduler.schedule((()=>{e.forEach((e=>{e.UNSAFE_onSignal&&e.UNSAFE_onSignal({type:"main_window_rendered",userContextId:this.userKey},this.context)}))}),{id:"on-signal-job",priority:ie.vW.Macro,scheduledById:"signal-processor"},(0,Re.v4)()),this.reset()}async isMainWindowForActiveUserContext(e){const t=this.activeWindowsService.enableDecoupleCommandingFromApollo?this.activeWindowsService.getStandardMainWindow():await(0,us.jW)(this.context.client);return e===t?.id&&t.userContextId===this.userKey}async getWindowState(e){const t=await this.hostComms.loadModule("windowcontrols");return t?.getWindowState?.(e)}shouldSendSignal(){return this.windowHasBeenCreatedAndSignalsHaveFired()||this.windowHasToggledVisibilityAndWasNotMinimizedOrRestored()}windowHasBeenCreatedAndSignalsHaveFired(){return!!this.userConsentedChange&&!!this.mainWindowRenderedChange&&!!this.layoutRenderedChange}windowHasToggledVisibilityAndWasNotMinimizedOrRestored(){return!(!this.userConsentedChange||!this.mainWindowDisplayedChange.windowId||this.mainWindowDisplayedChange.eventFired||this.windowWasMinimized())}windowWasMinimized(){return!0===this.mainWindowDisplayedChange.windowState?.minimized}reset(){this.mainWindowRenderedChange=void 0,this.layoutRenderedChange=void 0,this.mainWindowDisplayedChange.eventFired=!0}}class AP extends _e{constructor(){super(h.Yg.CreateSignalProcessor,["activeWindowsService","appsRegistryService","experienceChangeReportingService","client","coreSettings","entityCommanding","loggerFactory","platformService","scenarioFactory","scheduler","hostCommunicationService","commandChangeReportingService","authenticationUser","userBiService"])}async execute(e){const{activeWindowsService:t,appsRegistryService:n,experienceChangeReportingService:i,client:a,coreSettings:o,entityCommanding:r,loggerFactory:s,platformService:l,scenarioFactory:c,scheduler:d,hostCommunicationService:u,commandChangeReportingService:m,authenticationUser:p,userBiService:g}=e,h=new EP(i,m,n,d,u,(0,xe.b4)(p),{client:a,coreSettings:o,entityCommanding:r,loggerFactory:s,platformService:l,scenarioFactory:c,userBiService:g},t);return h.init(),()=>{h.dispose()}}}var _P=n(87970);class FP extends _e{constructor(){super(h.Yg.CreateShortcutExecutionServiceTask,[])}async execute(e){e.shortcutExecutionService=new _P.T}}class DP{constructor(e){this._loggerFactory=e,this._logger=this._loggerFactory.newLogger("app-wide-shortcut-registry","core-shortcut-service"),this._registeredShortcuts=[]}addAppWideShortcut(e,t,n,i){this._logger.log(`Adding application wide shortcut for command ${t} and shortuct ${e}. ${this._registeredShortcuts.length} shortcuts active`),this._registeredShortcuts=this._registeredShortcuts.filter((t=>t.hotkey!==e)),this._registeredShortcuts.push({commandId:t,commandHandler:n,hotkey:e,windowId:i}),this._logger.log(`Added app wide shortcutfor command ${t} and hotkey ${e}. ${this._registeredShortcuts.length} shortcuts active`)}removeAppWideShortcut(e){this._logger.log(`Removing app wide shortcutfor commandId ${e}. ${this._registeredShortcuts.length} shortcuts active`),this._registeredShortcuts=this._registeredShortcuts.filter((t=>t.commandId!==e)),this._logger.log(`Removed app wide shortcut for command ${e}. ${this._registeredShortcuts.length} shortcuts active`)}getAppWideShortcutHandler(e){return this._registeredShortcuts.find((t=>t.hotkey===e))?.commandHandler}destroy(e){this._registeredShortcuts=this._registeredShortcuts.filter((t=>t.windowId!==e))}}class PP{constructor(e,t){this._loggerFactory=e,this._hostCommunicationService=t,this._logger=this._loggerFactory.newLogger("global-shortcut-registry","core-shortcut-service"),this._registeredGlobalShortcuts=[]}async addGlobalShortcut(e,t,n){const i=(e=>e.windows)(e),a=0===this._registeredGlobalShortcuts.length;this._logger.log(`Adding global shortcut for command ${t} and shortuct ${i}. ${this._registeredGlobalShortcuts.length} shortcuts active`);const o=await this._hostCommunicationService.loadModule("globalshortcuts");if(!o)return;const r=this._registeredGlobalShortcuts.filter((e=>e.keys===i));if(r.length>0){this._logger.log("Global shortcut already registered, removing");for(const e of r)await(o?.removeGlobalShortcut?.(e.shortcutId)),this._logger.log(`Removed global shortcut for command ${t} and shortuct ${i}`),this._registeredGlobalShortcuts=this._registeredGlobalShortcuts.filter((t=>t.shortcutId!==e.shortcutId))}const s=await(o?.addGlobalShortcut?.(e));return s&&(this._registeredGlobalShortcuts.push({commandId:t,shortcutId:s,commandHandler:n,keys:i}),this._logger.log(`Added global shortcut for command ${t} and shortuctId ${s}. ${this._registeredGlobalShortcuts.length} shortcuts active`),a&&(this._logger.log("First global shortcut added, registering callback"),await this.registerForGlobalShortcutActivated())),s}async removeGlobalShortcut(e){this._logger.log(`Removing global shortcut for commandId ${e}. ${this._registeredGlobalShortcuts.length} shortcuts active`);const t=this._registeredGlobalShortcuts.filter((t=>t.commandId===e));t.length>0&&(this._removeGlobalShortcuts(t),this._logger.log(`Removed ${t.length} global shortcut for command ${e}. ${this._registeredGlobalShortcuts.length} shortcuts active`)),0===this._registeredGlobalShortcuts.length&&(this._logger.log("Last global shortcut removed, disposing registration"),this._disposeGlobalShortcutActivatedEventRegistration?.(),this._disposeGlobalShortcutActivatedEventRegistration=void 0)}async registerForGlobalShortcutActivated(){if(this._disposeGlobalShortcutActivatedEventRegistration)return;const e=await this._hostCommunicationService.loadModule("globalshortcuts");e&&(this._disposeGlobalShortcutActivatedEventRegistration=e?.registerForGlobalShortcutActivated?.((e=>this._handleGlobalShortcut(e))))}async cleanup(){this._disposeGlobalShortcutActivatedEventRegistration&&(this._disposeGlobalShortcutActivatedEventRegistration(),this._disposeGlobalShortcutActivatedEventRegistration=void 0),await this._removeGlobalShortcuts(this._registeredGlobalShortcuts),this._registeredGlobalShortcuts=[]}async _removeGlobalShortcuts(e){const t=await this._hostCommunicationService.loadModule("globalshortcuts");if(t)for(const n of e)this._logger.log(`Removing global shortcut for commandId ${n.commandId} with keys ${n.keys}`),await(t?.removeGlobalShortcut?.(n.shortcutId)),this._logger.log(`Removed global shortcut for command ${n.commandId}`),this._registeredGlobalShortcuts=this._registeredGlobalShortcuts.filter((e=>e.shortcutId!==n.shortcutId))}_handleGlobalShortcut(e){const t=this._registeredGlobalShortcuts.find((t=>t.shortcutId===e));t?(this._logger.debug(`Executing command handler for global shortcut: ${t.commandId} / ${t.shortcutId}`),t.commandHandler()):this._logger.warn(`Can't execute global shortcut with id ${e}. No record found.`)}}class MP{constructor(e,t,n,i){this._hostCommunicationService=e,this._loggerFactory=t,n&&(this._appWideShortcutRegistry=new DP(t)),i&&(this._globalShortcutRegistry=new PP(this._loggerFactory,this._hostCommunicationService))}addAppWideShortcut(e,t,n,i){this._appWideShortcutRegistry?.addAppWideShortcut(e,t,n,i)}removeAppWideShortcut(e){this._appWideShortcutRegistry?.removeAppWideShortcut(e)}getAppWideShortcutHandler(e){return this._appWideShortcutRegistry?.getAppWideShortcutHandler(e)}async addGlobalShortcut(e,t,n){return this._globalShortcutRegistry?.addGlobalShortcut(e,t,n)}async removeGlobalShortcut(e){return this._globalShortcutRegistry?.removeGlobalShortcut(e)}async registerForGlobalShortcutActivated(){return this._globalShortcutRegistry?.registerForGlobalShortcutActivated()}async destroy(e){this._appWideShortcutRegistry?.destroy(e),"global"===e&&await(this._globalShortcutRegistry?.cleanup())}}class xP extends _e{constructor(){super(h.Yg.CreateShortcutRegistryServiceTask,["coreSettings","hostCommunicationService","loggerFactory"])}async execute(e){const{coreSettings:t,hostCommunicationService:n,loggerFactory:i}=e,a=t?.get(b.J.Shortcuts),{enableAppWideShortcuts:o,enableGlobalShortcuts:r}=a||{enableAppWideShortcuts:!1,enableGlobalShortcuts:!1},s=new MP(n,i,!!o,!!r);return e.shortcutRegistryService=s,e=>{switch(e){case"quit":case"signout":return s.destroy("global");default:return}}}}class RP{constructor(e,t=""){e.debug("Initialized telemetry context service for "+(t?"user":"default context")),this.userId=t,this._telemetryProvider=(0,ii.Yf)()}initialize(e){e.debug("Initialized telemetry context service"),this._telemetryProvider=(0,ii.Yf)()}setContext(e,t,n,i=""){this._telemetryProvider.setContext(e,t,n,i||this.userId)}setCoreContext(e,t,n){this._telemetryProvider.setContext(e,t,n)}setDeviceAuthToken(e){this._telemetryProvider.setDeviceAuthToken(e)}setUserId(e){this.userId=e}setPrimaryUser(e,t){this._telemetryProvider.setPrimaryUser(e,t)}}class jP extends _e{constructor(){super(h.Yg.TelemetryContext,["loggerFactory"])}async execute(e){const t=e.loggerFactory.newLogger("CreateTelemetryContextTask","core-services-tasks");e.telemetryContextService=new RP(t)}}var LP=n(838119);class OP{constructor(e,t){this.authenticationService=e,this._users=new Map,this._accountModeObservable=new r.X(OE.b.SingleAccount),this._accountCountCurrentCloudObservable=new r.X(0),this._cloudModeObservable=new r.X(OE.i.SingleCloud),this.currentCloud=(0,gn.NH)(t)}init(){this._syncWithAuthServicePromise||(this._syncWithAuthServicePromise=this.syncWithAuthenticationService())}getAuthenticatedUsers(){return new Set(this._users.keys())}has(e){return this._users.has(e)}getAccountMode(){return this._accountModeObservable.value}getAccountModeObservable(){return this._accountModeObservable.pipe((0,Es.x)())}getAccountCountCurrentCloud(){return this._accountCountCurrentCloudObservable.value}getAccountCountCurrentCloudObservable(){return this._accountCountCurrentCloudObservable.pipe((0,Es.x)())}getCloudMode(){return this._cloudModeObservable.value}getCloudModeObservable(){return this._cloudModeObservable.pipe((0,Es.x)())}async syncWithAuthenticationService(){if((await(this.authenticationService.getCachedUsers?.({id:(0,Re.v4)(),scenarioName:H.RG.AuthWebCachedUser,source:"UserTrackingService::syncWithAuthenticationService"},{isAllCachedUsers:!0}))||[]).forEach((e=>{this._users.set((0,xe.b4)((0,xe.KQ)(e)),e.cloud??this.currentCloud)})),this.updateAccountMode(),this.updateAccountCountCurrentCloud(),this.updateCloudMode(),this.authenticationService.getUsersIterator)for await(const e of this.authenticationService.getUsersIterator({isAllCachedUsers:!0}))this._users.clear(),e.forEach((e=>{this._users.set((0,xe.b4)((0,xe.KQ)(e)),e.cloud??this.currentCloud)})),this.updateAccountMode(),this.updateAccountCountCurrentCloud(),this.updateCloudMode()}updateAccountMode(){const e=this._users.size>1?OE.b.MultipleAccounts:OE.b.SingleAccount;LP.q.log(`[updateAccountMode] to: ${OE.b[e]}`),this._accountModeObservable.next(e)}updateAccountCountCurrentCloud(){let e=0;this._users.forEach((t=>t===this.currentCloud&&e++)),LP.q.log(`[updateAccountCountCurrentCloud] to: ${e}}`),this._accountCountCurrentCloudObservable.next(e)}updateCloudMode(){const e=new Set(this._users.values()).size>1?OE.i.MultiCloud:OE.i.SingleCloud;LP.q.log(`[updateCloudMode] to: ${OE.i[e]}`),this._cloudModeObservable.next(e)}}class $P extends _e{constructor(){super(h.Yg.CreateTrackUserServiceTask,["authenticationService","coreSettings"])}async execute(e){const{authenticationService:t,coreSettings:n}=e,i=new OP(t,n);n.get(b.J.Core)?.initializeMTMAModeOnStartup&&i.init(),e.userTrackingService=i}}class UP extends _e{constructor(){super(h.Yg.CreateUserDataClient,["scenarioFactory","loggerFactory","windowProvider","coreSettings","client"])}async execute(e){if(!e.client)throw new Error("CreateUserDataClientTask: core data client doesn't exist, cannot initialize user client");const t=await async function(e,t,i){const{networkState:a,coreSettings:o,leakDetectorService:r,platformService:s,config:l,graphqlStoreStatsReporterService:c}=e,d=new qg.pS,u=(0,Gl.UZ)(cl.l,a.observeIsOnline()),m={...e,pubsub:d,send:u},p=Zk.clientResolvers;if(!p)throw new Error("Client resolvers should be created at this point");const{maxApolloResultCacheSize:g,enableViewSchema:y,enableApolloDoubleWriteFix:v,enableRelay:f,enableRelayLiveResolverStore:S,relayGCReleaseBufferSize:k}=o.get(b.J.Core),{enableApolloDevtools:C}=o.get(b.J.Diagnostics),w=g??void 0,T=r?.create(),I=e?.authenticationUser&&(0,xe.b4)(e.authenticationUser),N=FE({leakDetector:T,userContextId:I,windowId:h.ew,entityType:i,viewportContext:"cmd"},void 0,p,w,e.loggerFactory,e.scenarioFactory,void 0,C,Jg.t.cmd,c,v),E=e?.authenticationUser?.loginUserName||"nouser";oh(N,`mtma-cmd-${E}`,Boolean(C),s,l.experienceName);const A=IE.createUserDataRequestContext(m,N),_=await ty.createLink({contextValue:A,UNSAFE_resolvers:[NE.s],...m});N.setLink(_);const F=_E(e,d,T,_,e.loggerFactory,e.scenarioFactory,p,I);let D,P;if(y&&(D=DE(e,0,T,ty.createViewSchemaLink(e),e.loggerFactory,e.scenarioFactory)),f){const{createRelayEnvironment:t}=n(390009);P=await t({isLiveResolverEnabled:!0===S,link:_,loggerFactory:e.loggerFactory,userBiService:e.userBiService,leakDetectorOptions:{leakDetector:T,entityType:i},configName:`mtma-user-${E}`,gcReleaseBufferSize:k,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService,host:e.windowProvider})}const{dataOpsTracker:M,dataEvictionService:x}=t.getServices();return new nC({pubsub:d,leakDetector:T,scenarioFactory:A.scenarioFactory,coreSettings:A.coreSettings,dataOpsTracker:M,dataEvictionService:x,graphqlStoreStatsReporterService:e.graphqlStoreStatsReporterService},t,F,A,D,P)}(e,e.client,"default");return e.client=t,e=>{switch(e){case"signout":case"quit":t.destroy()}}}}var BP=n(593018);const WP=12e4,HP={"cdl-request":!0};var VP=n(872746);class GP{constructor(){this._isPaused=!1,this._startTime=0,this._reason=h.jK.Unknown,this._totalPauseTime=0,this._lastPauseLength=0}get paused(){return this._isPaused}get totalPauseDuration(){return this._totalPauseTime}pause(e,t={},n=void 0){this._isPaused||(this._reason=e,this._startTime=this.getTime(t),this._data=n,this._isPaused=!0)}resume(e={}){if(this._isPaused){const t=this.getTime(e)-this._startTime;this._lastPauseLength=t,this._totalPauseTime+=this._lastPauseLength}return this._isPaused=!1,{startTime:this._startTime,totalTime:this._lastPauseLength,eventData:this._data,reason:this._reason,monitoringData:void 0}}getTime(e={}){const{overrideTimestamp:t,offsetCurrentTimeInMs:n}=e;return(t??Date.now())+(n??0)}}class zP{constructor(e,t,n={}){this.name=e,this.id=t,this.excludedTimings=n,this.previousMark=""}markPerformanceApi(e,t=""){if(performance&&performance.mark&&performance.measure&&this.shouldMark(this.name)){const n=`${e} ${this.name}-${this.id}`;if(performance.mark(n),e===H.ck.Stop){let e=`start ${this.name}-${this.id}`;0===(performance.getEntriesByName(e,"mark")||[]).length&&(e="navigationStart");const i=[this.name,t&&`(${t})`].join(" ");performance.measure(i,e,n)}this.previousMark&&performance.measure(`${this.name} [${this.previousMark} <=> ${e}]`,`${this.previousMark} ${this.name}-${this.id}`,n),this.previousMark=e}}shouldMark(e){return!(e in this.excludedTimings)||this.excludedTimings[e]}}class qP{constructor(e,t,n,i,a,o,r=(0,Re.v4)(),s=H.t7.Expanded,l="",c={}){this.name=e,this.clientId=t,this._eventData=n,this._timingData=i,this.startTime=a,this.timeoutMs=o,this.id=r,this.scenarioMode=s,this.userContextId=l,this.crossAccountScenarioOptions=c,this.previousStep=H.ck.Unknown,this.sequence=1,this.active=!0,this.onStopCallbacks=[],this.__stepsPerfInfo__=[],this._testingMode=!1,this._steps=[],this._stepsEx=[],this.userIds=new Set,this.pauseTracker=new GP,this.currentStep=H.ck.Unknown,this.timestamps=[],this.intervalTimestamp=a,this.performanceMarker=new zP(this.name,this.id,HP)}addPackedData(e,t){this._steps=this._steps.concat(e.map((e=>JSON.parse(e)))),this._stepsEx=this._stepsEx.concat(t.map((e=>JSON.parse(e))))}updateTimestamp(e,t){this.timingData[e]=t}addOnStopCallback(e){this.onStopCallbacks.push(e)}get timingData(){return this._timingData}get testingMode(){return this._testingMode}set testingMode(e){this._testingMode=e}get isPaused(){return this.pauseTracker.paused}get eventData(){return this._eventData}get steps(){return this._steps}get stepsEx(){return this._stepsEx}get elapsed(){return this.calculateElapsed(Date.now())}get stepDelta(){return this.calculateStepDelta(Date.now())}get delta(){return this.calculateDelta(Date.now())}get isHoisted(){return!1}syncToState(e){this.previousStep=e.previousStep,this.intervalTimestamp=e.lastTimestamp,this.sequence=e.lastSequence}setCrossClientObservables(e){const t=e.mark.subscribe((e=>{this.mark(e.step,e.eventData,e.status)})),n=e.stop.subscribe((e=>{this.stop(e.eventData,e.status)})),i=e.appendEventData.subscribe((e=>{this.appendEventData(e.eventData)}));this.subscriptions={mark:t,stop:n,appendEventData:i}}appendEventData(e){this._eventData={...this._eventData,...e}}pause(e){this.timer?.pause();const{reason:t,overrideTimestamp:n,offsetCurrentTimeInMs:i,...a}=e;this.pauseTracker.pause(t,{overrideTimestamp:n,offsetCurrentTimeInMs:i},a),this.currentStep!==H.ck.Unknown&&this.mark(this.currentStep)}resume(e={}){this.timer?.resume();const t=this.pauseTracker.resume({overrideTimestamp:e.overrideTimestamp,offsetCurrentTimeInMs:e.offsetCurrentTimeInMs});this.mark(H.ck.Pause,{pauseReason:t.reason,...t.eventData,...e})}cancel(e={}){this.stop(e,"abandoned")}mark(e,t={},n="success"){if(!this.canMark())return;this.currentStep=H.ck.Unknown;const{overrideTimestamp:i,offsetCurrentTimeInMs:a,...o}=t,r=this.getBaseTimestamp(i,a),{delta:s,stepDelta:l,elapsed:c}=this.getBaseScenarioTimingData(r,t),d=e,u={"Scenario.Mode":this.scenarioMode,"Scenario.Name":this.name,"Scenario.Status":n,"Scenario.Step":d,InstanceId:this.id,sequence:this.sequence,delta:s,elapsed:c,stepDelta:l};let m;if(t={...this.eventData,...o},this.scenarioMode===H.t7.Packed&&(this.prepareAndStorePackedSteps(u),this.createStepsExEntry(o),d===H.ck.Stop&&(u["Scenario.Steps"]=JSON.stringify(this._steps),m={columnName:"Scenario.StepsEx",packedData:this._stepsEx})),this.scenarioMode===H.t7.Expanded||d===H.ck.Stop)if(this.isCrossAccountScenario)for(const e of this.userIds)(0,ee.Yx)(this.name,t,this.finalizeScenarioData(r,u),void 0,m,e);else(0,ee.Yx)(this.name,t,this.finalizeScenarioData(r,u),void 0,m,this.userContextId);this.performanceMarker.markPerformanceApi(d,this.clientName),this._testingMode&&this.__stepsPerfInfo__.push({name:d,delta:s,stepDelta:l,status:n}),this.updateScenarioStatePostMark(d,r)}stop(e={},t="success"){this.timer?.stop(),this.currentStep!==H.ck.Unknown&&this.mark(this.currentStep,void 0,t),this.mark("stop",{previousStep:this.previousStep,...e},t),this.active=!1,this.subscriptions&&(this.subscriptions.appendEventData.unsubscribe(),this.subscriptions.mark.unsubscribe(),this.subscriptions.stop.unsubscribe()),this.onStopCallbacks.forEach((e=>e()))}fail(e={}){this.stop(e,"failure")}incomplete(e={}){this.stop(e,"incomplete")}startStep(e){const t=e;this.currentStep!==H.ck.Unknown&&t!==this.currentStep&&this.mark(this.currentStep),this.currentStep=t}markAggregateStart(e){}markAggregateStop(e){}getTotalPauseDuration(){return 0}getPackedSteps(){return this._steps}addUser(e){this.userIds.add(e)}removeUser(e){this.userIds.delete(e)}canMark(){return this.active&&!this.pauseTracker.paused}get isCrossAccountScenario(){return!!this.crossAccountScenarioOptions.enabled&&!!this.userIds.size}finalizeScenarioData(e,t){const n=t;return n.elapsedSinceCoreInit=this.calculateElapsedSinceCoreInit(e),n}getBaseScenarioTimingData(e,t){return{delta:"number"==typeof t.delta?t.delta:this.calculateDelta(e),elapsed:"number"==typeof t.elapsed?t.elapsed:this.calculateElapsed(e),stepDelta:"number"==typeof t.stepDelta?t.stepDelta:this.calculateStepDelta(e)}}getBaseTimestamp(e,t){return(e??Date.now())+(t??0)}calculateElapsedSinceCoreInit(e){return this.timingData.coreInitTime?e-this.timingData.coreInitTime:void 0}calculateDelta(e){return e-this.startTime-this.pauseTracker.totalPauseDuration}calculateElapsed(e){return e-this.timingData.scenarioFactoryStartTime}calculateStepDelta(e){return e-this.intervalTimestamp}prepareAndStorePackedSteps(e){const t={"Scenario.Status":e["Scenario.Status"],"Scenario.Step":e["Scenario.Step"],delta:e.delta,elapsed:e.elapsed,sequence:e.sequence,stepDelta:e.stepDelta,previousStep:e.previousStep};this._steps.push(t)}updateScenarioStatePostMark(e,t){this.intervalTimestamp=t,this.previousStep=e,this.sequence++}createStepsExEntry(e){this.stepsEx.push((0,W.cloneDeep)({...this.eventData,...e})||{})}}const JP=e=>e.reduce(((e,t)=>({...e,[t.name]:t.value})),{});class QP{constructor(e,t,n,i,a={},o="",r=[],s=!1){this.timingData=e,this.logger=t,this.factoryFunctions=n,this.finalizeLegacyCrossClient=i,this.telemetryModeLookUp=a,this.userContextId=o,this.noPureScenarioCreationList=r,this.restrictByClientId=s,this.scenarioCreated$=new kn.xQ,this.scenarioStopped$=new Cn.y,this.scenarioMarked$=new Cn.y,this.appendEventData$=new Cn.y}loadCallbacks(e){if(e.marks){const{registerForScenarioStop:t,registerForScenarioMark:n,registerForScenarioStart:i}=e.marks;this.scenarioMarked$=new Cn.y((e=>{n(((t,n,i)=>{const a={step:n,status:i,scenarioName:t.scenarioName,eventData:JP(t.eventData),clientId:t.clientId};e.next(a)}))})),this.scenarioStopped$=new Cn.y((e=>{t(((t,n)=>{const i={step:"stop",status:n,scenarioName:t.scenarioName,eventData:JP(t.eventData),clientId:t.clientId};e.next(i)}))})),i(((e,t)=>this.onReceivedScenarioStart(e,t)))}if(e.appendEventData){const{appendEventData:t}=e;this.appendEventData$=new Cn.y((e=>{t((t=>e.next({scenarioName:t.scenarioName,clientId:t.clientId,eventData:JP(t.eventData)})))}))}}loadExistingScenarios(e){e.forEach((e=>this.OnExistingScenario(e)))}onReceivedScenarioStart(e,t){let n=null;this.restrictByClientId?n=e.clientId?this.factoryFunctions.findScenarioByNameAndId(e.scenarioName,e.clientId):this.factoryFunctions.findScenario(e.scenarioName,(e=>!e.clientId&&!e.isCrossClientConnected)):(n=this.factoryFunctions.findScenarioByNameAndId(e.scenarioName,e.clientId),n||(n=this.factoryFunctions.findScenario(e.scenarioName))),n?(this.logger.debug(`Creating mark observable for existing scenario: name=${e.scenarioName}, clientid=${e.clientId}`),n.appendEventData({"Scenario.CrossClientMode":"existing"}),n.setCrossClientObservables?.(this.createObservablesForScenario(e.scenarioName,e.clientId))):this.onStartScenario(e,t)}onStartScenario(e,t){const n=e.scenarioName,i=t.time.getTime(),a=JP(e.eventData);if(this.noPureScenarioCreationList.includes(n))return void this.logger.warnToTelemetry?.(`Existing scenario not found for scenario which is found in the noPureScenarioCreationList: name=${n}`,"telemetry_instrumentation_pure_cross_client_scenario_blocked",{reason:n});const o=this.createNewCrossClient(n,e.clientId,a,i,e.timeout,(0,Re.v4)(),this.telemetryModeLookUp[n]??H.t7.Expanded);o.appendEventData({"Scenario.CrossClientMode":"pure"}),o.addOnStopCallback((()=>{this.factoryFunctions.clearScenario(o)})),o.setCrossClientObservables(this.createObservablesForScenario(o.name,o.clientId)),this.scenarioCreated$.next(o)}OnExistingScenario(e){const t=e.clientId??"",n=JP(e.eventData??[]),i=this.createNewCrossClient(e.name,t,n,e.creationTime.time.getTime(),e.timeout??WP,e.id,e.scenarioMode??H.t7.Expanded);i.addPackedData(e.steps??[],e.stepsEx??[]),i.appendEventData({"Scenario.CrossClientMode":"transferred"}),i.addOnStopCallback((()=>{this.factoryFunctions.clearScenario(i)}));const a=this.finalizeLegacyCrossClient;if(a&&i.addOnStopCallback((()=>{a({scenarioName:i.name})})),i.setCrossClientObservables(this.createObservablesForScenario(i.name,i.clientId)),e.lastMarkStep){const t={previousStep:e.lastMarkStep,lastTimestamp:e.lastMarkTime.time.getTime(),lastSequence:e.sequence};i.syncToState(t)}this.scenarioCreated$.next(i),this.logger.debug(`Created scenario from previous client: name=${e.name}, clientid=${t}`)}createObservablesForScenario(e,t){const n=this.scenarioStopped$.pipe((0,m.h)((n=>n.scenarioName===e&&n.clientId===t)),(0,VP.q)(1));return{mark:this.scenarioMarked$.pipe((0,m.h)((n=>n.scenarioName===e&&n.clientId===t)),(0,m.h)((e=>-1===["stop","start"].indexOf(e.step))),(0,yn.R)(n)),stop:n,appendEventData:this.appendEventData$.pipe((0,m.h)((n=>n.scenarioName===e&&n.clientId===t)),(0,yn.R)(n))}}createNewCrossClient(e,t,n,i,a,o,r){return new qP(e,t,n,this.timingData,i,a,o,r,this.userContextId)}}class KP{constructor(e){this._name=e}get id(){return"noop"}get name(){return this._name}get delta(){return 0}get timeoutMs(){return 0}get eventData(){return{}}set eventData(e){}get timestamps(){return[]}get isPaused(){return!1}set isHoisted(e){}get isHoisted(){return!1}appendEventData(e){}pause(e){}resume(e){}cancel(e){}mark(e,t,n){}startStep(e){}stop(e,t){}fail(e){}incomplete(e){}markAggregateStart(e){}markAggregateStop(e){}getTotalPauseDuration(){return 0}setCrossClientMarkObservables(e){}setCoreInitTime(e){}addUser(e){}removeUser(e){}}const YP="Scenario.Step";class XP{constructor(e,t,n,i,a,o,r,s,l,c=!1,d=!1,u=H.t7.Expanded,m=0,p,g,h,y,v="",f={},S=-1,k){this._id=e,this._name=t,this.scenarioFactory=a,this.logger=o,this.timeout=r,this.callback=s,this.memoryAnalyzer=l,this.markStepsInTrace=c,this.showAllConsoleLogs=d,this.scenarioMode=u,this._sequence=m,this.reportActivity=p,this.hostCommunicationService=g,this.crossClientOptions=h,this.clientId=y,this.userContextId=v,this.crossAccountScenarioOptions=f,this.scenarioPackedDataLimit=S,this.sender=k,this.steps=[],this.stepsEx=[],this.__stepsPerfInfo__=[],this.performanceMarksToCleanup=[],this.userIds=new Set,this.getTotalPauseDuration=()=>this.pauseInfo.totalTime,this._currentStep=H.ck.Unknown,this._previousStep=H.ck.Unknown,this._timestamps=[],this._isHoisted=!1,this.active=!0,this.pauseInfo={reason:"",startTime:0,totalTime:0,eventData:void 0,monitoringData:void 0};let C=0;const{overrideTimestamp:b,offsetCurrentTimeInMs:w}=i;b?C=b-Date.now():w&&(C=-w),this._eventData=n,this._absoluteStartTime=Date.now()+C,this.intervalTimestamp=this.relativeTimestamp=this.scenarioFactory.timestamp({isCrossClient:this.crossClientOptions?.enabled})+C,this.memoryDataInitial=this.memoryAnalyzer?.snapshotMemoryUsage(),this.crossClientOptions?.enabled&&this.syncStateToCrossClientStart(this.crossClientOptions)}get id(){return this._id}get name(){return this._name}get absoluteStartTime(){return this._absoluteStartTime}get delta(){return this.scenarioFactory.timestamp()-this.relativeTimestamp}get timeoutMs(){return this.timeout}set timeoutMs(e){this.timeout=e}get eventData(){return this._eventData}set eventData(e){this._eventData=e}get timestamps(){return this._timestamps}get currentStep(){return this._currentStep}get isPaused(){return!!this.pauseInfo.startTime}set isHoisted(e){this._isHoisted=e}get isHoisted(){return this._isHoisted}get isCrossClientConnected(){return Boolean(this.stopSubscription)&&Boolean(this.markSubscription)}appendEventData(e){this.eventData={...this.eventData,...e}}markAggregateStart(e){this.active?this.isPaused?this.logger.debug(`[Scenario]${this.name} - ignoring aggregated start step [${e}] due to paused state`):(this.aggregateStepStartTime||(this.aggregateStepStartTime={}),this.aggregateStepStartTime[e]||(this.aggregateStepStartTime[e]=performance.now())):this.logger.debug(`[Scenario]${this.name} - ignoring aggregated start step [${e}] due to inactive`)}markAggregateStop(e){this.active&&this.aggregateStepStartTime[e]&&(this.aggregateStepTotalTime||(this.aggregateStepTotalTime={}),this.aggregateStepTotalTime[e]||(this.aggregateStepTotalTime[e]=0),this.aggregateStepTotalTime[e]+=performance.now()-this.aggregateStepStartTime[e],this.aggregateStepStartTime[e]=void 0)}pause(e,t){if(!this.active||this.isPaused)return;this.timer?.pause(),this._currentStep!==H.ck.Unknown&&this.mark(this._currentStep);const{reason:n,overrideTimestamp:i,...a}=e,o=i??Date.now();this.startStep(H.ck.Pause),this.pauseInfo={...this.pauseInfo,reason:n,startTime:o,eventData:a,monitoringData:t}}resume(e,t){if(!this.active||!this.isPaused)return;this.timer?.resume();const{overrideTimestamp:n}=e??{},i=(0,W.isNumber)(n)?n:Date.now(),a=this.pauseInfo.startTime?i-this.pauseInfo.startTime:0;this.pauseInfo.totalTime=(this.pauseInfo.totalTime||0)+a,this.mark(H.ck.Pause,{pauseReason:this.pauseInfo.reason,...this.pauseInfo.eventData,...e},void 0,t||this.pauseInfo.monitoringData),this._currentStep=H.ck.Unknown,this.pauseInfo.reason="",this.pauseInfo.startTime=0}stop(e,t="success",n){this._currentStep!==H.ck.Unknown&&this.mark(this._currentStep,void 0,t,n),this.aggregateStepTotalTime&&((0,W.each)(Object.keys(this.aggregateStepTotalTime),(e=>{const t=parseInt(this.aggregateStepTotalTime[e].toString(),10);this.mark(e,{stepDelta:t},void 0,n)})),this.aggregateStepTotalTime=null,this.aggregateStepStartTime=null),this.timer?.stop(),this.createMark(H.ck.Stop,t,!0,e,n).then((()=>{if(this.active&&(this.active=!1),this.markSubscription&&!this.markSubscription.closed&&this.markSubscription.unsubscribe(),this.stopSubscription&&!this.stopSubscription.closed&&this.stopSubscription.unsubscribe(),this.callback&&(this.callback(t),this.callback=void 0),this.hostCommunicationService&&this.crossClientOptions?.enabled){const e={scenarioName:this.name};this.hostCommunicationService.loadModule("scenario").then((t=>{t&&t.setScenarioCompletion&&t.setScenarioCompletion(e)}))}this.scenarioFactory.clearScenario(this)}))}updateTimestamp(e,t){"coreInitTime"===e&&(this.coreInitTimestamp=t)}fail(e,t){this.stop(e,"failure",t)}cancel(e,t){this.stop(e,"abandoned",t)}incomplete(e,t){this.stop(e,"incomplete",t)}mark(e,t,n="success",i){this.isPaused&&e!==H.ck.Pause?this.logger.debug(`[Scenario]${this.name} - ignoring mark step [${e}] due to paused state`):(this.createMark(e,n,!1,t,i),this._currentStep=H.ck.Unknown,this.crossClientOptions?.enabled&&this.crossClientOptions.previousStep&&e===H.ck.Start&&(this._previousStep=this.crossClientOptions.previousStep))}startStep(e){this.isPaused?this.logger.debug(`[Scenario]${this.name} - ignoring start step [${e}] due to paused state`):(this._currentStep!==H.ck.Unknown&&e!==this._currentStep&&this.mark(this._currentStep),this._currentStep=e)}setCrossClientObservables(e){this.markSubscription=e.mark.subscribe((e=>this.mark(e.step,e.eventData,e.status))),this.stopSubscription=e.stop.subscribe((e=>{this.stop(e.eventData,e.status)}))}addUser(e){this.userIds.add(e)}removeUser(e){this.userIds.delete(e)}prepareAndSendTelemetry(e,t,n,i){const{overrideTimestamp:a}=e;let o;o=this.eventData&&this.eventData!==e?{...this.eventData,...e}:{...e},o.InstanceId=this.id,o.overrideTimestamp=a;const r=this.createScenarioData(o,t,n),s=!!this.scenarioFactory.findScenario(H.RG.WindowLaunchTime);o.isInEst=s;const l=r[YP];if(l!==H.ck.Start){let t;this.scenarioMode!==H.t7.Expanded&&(this.prepareAndStorePackedSteps(r,e),l===H.ck.Stop&&(r["Scenario.Steps"]=JSON.stringify(this.steps),t={columnName:"Scenario.StepsEx",packedData:this.stepsEx})),this.sendScenario(o,r,l,t,i)}return this.logScenarioPerf(r),r}syncStateToCrossClientStart(e){if(e.existingEventData){const t=e.existingEventData.reduce(((e,t)=>({[t.name]:t.value,...e})),{});this.appendEventData(t)}e.previousStep&&(this._previousStep=e.previousStep),this.intervalTimestamp=this.relativeTimestamp+e.previousStepTimestamp-this._absoluteStartTime,this.active=!0}sendScenario(e,t,n,i,a){if(this.scenarioMode!==H.t7.Packed||n===H.ck.Stop){const o=()=>{if(this.isCrossAccountScenario)for(const n of this.userIds)this.sender?this.sender.sendScenarioEvent(this.name,e,t,a,i,n):(0,ee.Yx)(this.name,e,t,a,i,n);else this.sender?this.sender.sendScenarioEvent(this.name,e,t,a,i,this.userContextId):(0,ee.Yx)(this.name,e,t,a,i,this.userContextId)};n!==H.ck.Stop?o():Promise.all([this.updateEventDataMemory(e)]).then((()=>{o()})).catch((()=>{o()}))}}get isCrossAccountScenario(){return!!this.crossAccountScenarioOptions.enabled&&!!this.userIds.size}prepareAndStorePackedSteps(e,t){if(this.scenarioPackedDataLimit<0||this._sequence<=this.scenarioPackedDataLimit||e["Scenario.Step"]===H.ck.Stop){const n={"Scenario.Status":e["Scenario.Status"],"Scenario.Step":e["Scenario.Step"],delta:e.delta,elapsed:e.elapsed,sequence:e.sequence,stepDelta:e.stepDelta,previousStep:e.previousStep};this.scenarioPackedDataLimit>-1&&this._sequence>this.scenarioPackedDataLimit&&e["Scenario.Step"]===H.ck.Stop&&(n.exceededStepsLimit=!0),this.steps.push(n),this.stepsEx.push((0,W.cloneDeep)({...this.eventData,...t})||{})}}logScenarioPerf(e){if(this.showAllConsoleLogs){const t=e[YP],n=e["Scenario.Status"],i=t===H.ck.Start?`[step](${this._sequence})${t}`:t===H.ck.Stop?`[step](${this._sequence})${t} (${e.stepDelta}ms/${e.delta}ms) [status]${n}`:`[step](${this._sequence})${t} (${e.stepDelta}ms)`;this.logger&&this.logger.log(`[Scenario]${this.name} ${i}`),this.__stepsPerfInfo__.push({name:t,stepDelta:e.stepDelta,delta:e.delta,status:n})}}updateEventDataMemory(e){return this.memoryAnalyzer?this.memoryAnalyzer.snapshotMemoryUsageAsync().then((t=>{t&&(t.jsHeapStatistics&&(e.jsUsedHeapSize=t.jsHeapStatistics.used_heap_size,e.jsUsedHeapSizeDelta=this.memoryDataInitial?.jsHeapStatistics?this.memoryDataInitial.jsHeapStatistics.used_heap_size-t.jsHeapStatistics.used_heap_size:void 0),t.processMemoryInfo&&(e.workingSet=t.processMemoryInfo.workingSetSize,e.workingSetDelta=this.memoryDataInitial?.processMemoryInfo?t.processMemoryInfo.workingSetSize-this.memoryDataInitial.processMemoryInfo.workingSetSize:void 0,e.privateBytes=t.processMemoryInfo.privateBytes,e.privateBytesDelta=this.memoryDataInitial?.processMemoryInfo?t.processMemoryInfo.privateBytes-this.memoryDataInitial.processMemoryInfo.privateBytes:void 0))})):Promise.resolve()}createScenarioData(e,t,n){const{overrideTimestamp:i,offsetCurrentTimeInMs:a}=e,o=this.intervalTimestamp;let r;(0,W.isNumber)(i)?(r=this.relativeTimestamp+i-this._absoluteStartTime,e.overrideTimestamp=void 0):a?(r=this.scenarioFactory.timestamp({isCrossClient:this.crossClientOptions?.enabled})-a,e.offsetCurrentTimeInMs=void 0):r=n===H.ck.Start?this.relativeTimestamp:this.scenarioFactory.timestamp({isCrossClient:this.crossClientOptions?.enabled}),this._timestamps.push(r),this.intervalTimestamp=r;const s=(0,W.isNumber)(e.stepDelta)?e.stepDelta:r-o,l=(0,W.isNumber)(e.delta)?e.delta:r-this.relativeTimestamp-this.getTotalPauseDuration(),c=(0,W.isNumber)(e.elapsed)?e.elapsed:r,d=this._sequence,u="number"==typeof this.coreInitTimestamp?Date.now()-this.coreInitTimestamp:void 0,m=n===H.ck.Stop?this._previousStep:void 0;return{"Scenario.Status":t,"Scenario.Mode":this.scenarioMode,"Scenario.Name":this.name,[YP]:n,InstanceId:this.id,elapsedSinceCoreInit:u,delta:l,elapsed:c,sequence:d,stepDelta:s,previousStep:m}}getMonitoringDataOverride(e){let t=e;return this.name!==H.RG.WindowLaunchTime&&this.name!==H.RG.ExperienceReady||(t=e?(0,W.cloneDeep)(e):{scenarioPriority:"P0",data:[]},t.data.push({key:"App",value:this.eventData.contentSlotApp})),t}async createMark(e,t,n,i={},a){if(!e||!this.active)return;let o;"reason"in i&&(o=i.reason);const r=this.getMonitoringDataOverride(a);this.markPerformanceApi(this.name,e,o);const s=this.prepareAndSendTelemetry(i??{},t,e,r);this.active=this.active&&!n,this.reportActivity&&this.reportActivity(s),this._previousStep=e,this._sequence+=1}markPerformanceApi(e,t,n){if(performance&&performance.mark&&performance.measure&&!HP.hasOwnProperty(this.name)){const i=`${t} ${e}-${this.id}`;if(performance.mark(i),this.performanceMarksToCleanup.push(i),this.markStepsInTrace){if(this.previousMark){const n=`${e} [${this.previousMark} <=> ${t}]`,i=`${this.previousMark} ${e}-${this.id}`,a=`${t} ${e}-${this.id}`;performance.measure(n,i,a),performance.clearMeasures(n)}this.previousMark=t}if(t===H.ck.Stop){let t=`start ${e}-${this.id}`;0===(performance.getEntriesByName(t,"mark")||[]).length&&(t="navigationStart");const a=this.clientName?` (${this.clientName})`:"",o=n??this.eventData.reason,r=`${e}${a}${o?`-(${o})`:""}`;performance.measure(r,t,i),performance.clearMeasures(r);for(const e of this.performanceMarksToCleanup)performance.clearMarks(e);this.performanceMarksToCleanup=[]}}}}class ZP{constructor(e,t){this.scenario=e,this.windowProvider=t,this.timeRemaining=this.scenario.timeoutMs,this.lastUnpausedTimestamp=0}start(){this.timerIsRunning()||(this.timeRemaining=this.scenario.timeoutMs),this.resume()}pause(){this.timerIsRunning()&&(this.windowProvider.clearTimeout(this.timeoutId),this.timeoutId=void 0,this.timeRemaining-=Date.now()-this.lastUnpausedTimestamp)}resume(){this.timerIsRunning()||(this.lastUnpausedTimestamp=Date.now(),this.timeoutId=this.windowProvider.setTimeout(this.timeoutFunction.bind(this),this.timeRemaining))}stop(){this.windowProvider.clearTimeout(this.timeoutId),this.timeoutId=void 0}reset(){this.stop(),this.start()}timerIsRunning(){return!!this.timeoutId}timeoutFunction(){this.scenario.stop(void 0,"timeout")}}class eM{constructor(e){this.windowProvider=e}addTimerToScenario(e){if(!e.timer){const t=new ZP(e,this.windowProvider);e.timer=t,t.start()}}}const tM=36e5,nM=e=>{const{enableClickStreamEvents:t,enableClickStreamUnloadCache:n,clickStreamBatchInSeconds:i,clickStreamMaxBatchSize:a,clickStreamMaxBatchSizeWeb:o,clickStreamBatchInSecondsWeb:r,disable1DSBatching:s}=e.get(b.J.Telemetry);return{enableClickStreamEvents:t??!1,enableClickStreamUnloadCache:n??!1,clickStreamBatchInSeconds:i||75,clickStreamMaxBatchSize:a||15,clickStreamMaxBatchSizeWeb:o||5,clickStreamBatchInSecondsWeb:r||30,disable1DSBatching:s??!1}},iM=e=>{const{disableRingNamePrefixing:t,enableTestOnlyTelemetry:n,testOnlyUserbiTelemetry:i}=e.get(b.J.Telemetry),{environment:a}=e.get(b.J.Metadata),{enableSmbUserIntentUserBiTelemetry:o,smbUserIntentUserBiTelemetryPollInterval:r}=e.get(b.J.Growth),{enableCallingPerfCollectorService:s,enableCallingLongTasksTracking:l,enableCallingLongTasksTriggerFinder:c}=e.get(b.J.Calling);return{telemetry:{observable:e.getObservable(b.J.Telemetry),disableRingNamePrefixing:Boolean(t),enableTestOnlyTelemetry:Boolean(n),testOnlyUserbiTelemetry:i??""},metadata:{observable:e.getObservable(b.J.Metadata),environment:a??""},growth:{enableSmbUserIntentUserBiTelemetry:Boolean(o),smbUserIntentUserBiTelemetryPollInterval:r??tM},calling:{enableCallingPerfCollectorService:Boolean(l),enableCallingLongTasksTracking:Boolean(c),enableCallingLongTasksTriggerFinder:Boolean(s)}}},aM=e=>{const t=e.get(b.J.Telemetry),n=e.get(b.J.Host);return{telemetry:{observable:e.getObservable(b.J.Telemetry),coreAllowListEnabled:t.coreAllowListEnabled??!1,coreAllowList:new Set(t.coreAllowList??[]),scenarioIncompleteOnShutdown:t.scenarioIncompleteOnShutdown??!1,scenarioIncompleteOnShutdownBlockList:t.scenarioIncompleteOnShutdownBlockList??[],enableNewScenarioTimeout:t.enableNewScenarioTimeout??!1,scenarioPackedDataLimit:rM(t.scenarioPackedDataLimit),showAllConsoleLogs:t.showAllConsoleLogs??!1,noPureScenarioCreationList:t.noPureScenarioCreationList??[],enableCrossAccountScenario:t.enableCrossAccountScenario??!1,scenariosNotToTimeoutIfPaused:t.scenariosNotToTimeoutIfPaused??[],restrictByClientId:t.restrictByClientId??!1},host:{environment:e.get(b.J.Metadata).environment,userType:n.userType??"",enableSyncEngine:(0,tu.Q6)(e),showScenarioStepsInPerfTrace:oM(e)},test:{scenarioBufferList:e.get(b.J.Test).scenarioBufferList??[]}}},oM=e=>(e.get(b.J.Host).showScenarioStepsInPerfTrace||e.get(b.J.Core).showScenarioStepsInPerfTrace)??!1,rM=e=>null!=e?e:-1,sM="scenarioBuffer";class lM{constructor(e,t,n,i,a,o,r=!1,s,l,c,d={},u=""){this.context=e,this.memoryAnalyzer=n,this.windowId=i,this.clientId=a,this.payload=s,this.finalizeLegacyCrossClient=c,this.eventContextData=d,this.userContextId=u,this.coreAllowListEnabled=!1,this.allowedScenarios=new Set,this.scenarioPackedDataLimit=-1,this.crossClientScenarioList=new Set,this.scenarioTimeoutMs=WP,this.telemetryModeLookUp={},this.__isTestingMode__=!1,this.__testingBuffer__=[],this.newScenario=(e,t)=>{if(this.isCrossClientScenarioEnabled(e)){let n;if(n=t?.clientId?this.findScenarioByNameAndId(e,t.clientId):this.findScenario(e),n)return n.appendEventData({"Scenario.CrossClientMode":"transferred"}),n}const n=this.createScenarioWithoutStarting(e,t);return n.mark(H.ck.Start,t&&{overrideTimestamp:t.overrideTimestamp},void 0,t&&t.monitoringData),n},this.createScenarioWithoutStarting=(e,t={})=>{if(0===this.factoryTimestamps.scenarioFactoryStartTime||!this.isAllowedScenario(e))return new KP(e);const n=void 0===t.captureMemoryUsage||t.captureMemoryUsage,{userObjectId:i,correlationId:a,commandSource:o,tenantId:r}=this.getContextData(),s=(0,W.cloneDeep)(this.eventContextData);s["Panel.WindowID"]=this.windowId,s["UserInfo.Id"]=i,s["UserInfo.TenantId"]=r,s["EventInfo.CorrelationId"]=a,s.commandSource=o;const l=t.scenarioId||(0,Re.v4)(),{telemetry:{showAllConsoleLogs:c},host:{showScenarioStepsInPerfTrace:d}}=this.context.settings,u=this.telemetryModeLookUp?this.telemetryModeLookUp[e]||(this.telemetryModeLookUp["*"]?this.telemetryModeLookUp["*"]:H.t7.Expanded):H.t7.Expanded,m=new XP(l,e,s,{overrideTimestamp:t.startTime},this,this.logger,t.timeoutMs||this.scenarioTimeoutMs,t.callback,n?this.memoryAnalyzer:void 0,!!d,!!c,u,t.sequence||0,this.reportActivity,this.context.hostCommunicationService,t.crossClientOptions,void 0,this.userContextId,this.crossAccountScenarioOptions,this.scenarioPackedDataLimit,this.context.telemetrySender);e===H.RG.NavigationCommand?m.clientId=t.clientId??this.clientId:m.clientId=t.clientId,this.factoryTimestamps.coreInitTime&&m.updateTimestamp("coreInitTime",this.factoryTimestamps.coreInitTime);const p=this.setupScenarioTimeout(m);return this.getActiveScenarios(m.name).push({scenario:m,timeoutId:p}),m},this.cancelExistingAndCreateScenario=(e,t,n,i,a,o)=>{let r=this.findScenario(e);if(r){const e=[{reason:t}];r.cancel({errors:JSON.stringify(e)})}return r=this.newScenario(e,{...o,timeoutMs:n,callback:i,monitoringData:a}),r},this.stopScenarioIfActive=(e,t,n,i)=>{const a=this.findScenario(e);a&&a.stop(t,n,i)},this.markStep=(e,t,n)=>{const i=this.findScenario(e);i&&i.mark(t,n&&n.eventData,n&&n.status,n&&n.monitoringData)},this.startStep=(e,t)=>{const n=this.findScenario(e);n&&n.startStep(t)},this.findScenario=(e,t)=>{if(!e)return null;const n=this.activeScenariosMap.get(e);let i=null;n&&(i=(0,W.find)(n,(n=>n&&n.scenario.name===e&&(!t||t(n.scenario))))?.scenario||null);const{parentScenarioFactory:a}=this.context;return null==i&&a&&a!==this&&(i=a.findScenario(e,t)),i},this.findScenarioByNameAndId=(e,t)=>{const n=this.activeScenariosMap.get(e);let i=null,a=null;n&&(i=(0,W.find)(n,(n=>n.scenario.name===e&&n.scenario.clientId===t))||null);const{parentScenarioFactory:o}=this.context;return null==i&&o&&o!==this&&(a=o.findScenarioByNameAndId(e,t)),i&&i.scenario||a},this.clearScenario=e=>{const t=this.activeScenariosMap.get(e.name);if(t){const n=(0,W.findIndex)(t,(t=>t.scenario===e));if(n>-1){this.__saveForTestingMode__(e);const i=t.splice(n,1)[0];0===t.length&&this.activeScenariosMap.delete(i.scenario.name),this.context.settings.telemetry.enableNewScenarioTimeout||this.context.windowProvider.clearTimeout(i.timeoutId)}}const{parentScenarioFactory:n}=this.context;e.isHoisted&&n&&this!==n&&(n.clearScenario(e),e.isHoisted=!1)},this.setContext=e=>{this.eventContextData={...this.eventContextData,...e},this.activeScenariosMap.forEach((t=>{t.forEach((t=>t.scenario.appendEventData(e)))}))},this.hoistScenarioToCore=e=>{const{parentScenarioFactory:t}=this.context;if(t&&t!==this)t.hoistScenarioToCore&&t.hoistScenarioToCore(e);else if(!e.isHoisted){this.getActiveScenarios(e.name).push({scenario:e,timeoutId:0}),e.isHoisted=!0}},this.findAllScenariosByName=e=>this.getActiveScenarios(e).map((e=>e.scenario)),this.changeTimeout=(e,t)=>{const n=this.activeScenariosMap.get(e.name)?.find((t=>t.scenario.name===e.name&&t.scenario.id===e.id));n&&(n.scenario.timeoutMs=t,this.context.settings.telemetry.enableNewScenarioTimeout?n.scenario.timer?.reset():(this.context.windowProvider.clearTimeout(n.timeoutId),n.timeoutId=this.setupScenarioTimeout(n.scenario)))},this.processOnRunningScenarios=e=>{this.activeScenariosMap.forEach((t=>t.forEach((t=>e(t.scenario,t.timeoutId)))))},this.setupScenarioTimeout=(e,t)=>{if(this.context.settings.telemetry.enableNewScenarioTimeout)return this.timerFactory.addTimerToScenario(e),0;{const n=e.timeoutMs;return this.context.windowProvider.setTimeout((()=>{const{scenariosNotToTimeoutIfPaused:n}=this.context.settings.telemetry;e.isPaused&&n?.includes(e.name)||e.stop(void 0,"timeout",t)}),n)}},this.getContextData=()=>({userObjectId:this.context.settings.host.environment===pt.s.life?this.context.authenticationUser?.profile.paddedMsaId:this.context.authenticationUser?.profile.objectId,tenantId:this.context.authenticationUser?.profile?.tenantId,correlationId:this.context.correlation.id,commandSource:this.context.correlation.source}),this.getActiveScenarios=e=>{let t=this.activeScenariosMap.get(e);return t||(t=[],this.activeScenariosMap.set(e,t)),t},this.reportActivity=e=>{const t=e["Scenario.Name"];t&&this.isWhitelistedActivity(t)&&this.context.windowProvider.opener?.postMessage(O.rY.ActivityEvent,{action:"er:rendererActivityEvents",data:{activityEvents:[{sourceId:this.windowId,events:[`${t}:${e["Scenario.Step"]}`]}]}})},this.isWhitelistedActivity=e=>{switch(e){case H.RG.WindowLaunchTime:case H.RG.ChatSendMessage:case H.RG.CentralDataLayerRequest:case H.RG.UnhandledRejection:case H.RG.FatalError:case H.RG.GlobalWindowError:return!0;default:return!1}},this.isAllowedScenario=e=>!this.coreAllowListEnabled||this.allowedScenarios.has(e),this.isCrossClientScenarioEnabled=e=>this.clientType===An.Bh.Maglev&&this.crossClientScenarioList.has(e)&&void 0!==this.context.hostCommunicationService,this.initializeCrossClientScenarios=(e,t=[],n=!1,i)=>{const a=e.scenarios??[],o=e.crossClientScenarioList??[],r=this.context.loggerFactory.newLogger("CrossClientCoordinator","core-services-telemetry");o.forEach((e=>{this.crossClientScenarioList.add(e)}));const s={scenarioFactoryStartTime:e.scenarioFactoryStartTime.time.getTime(),coreInitTime:this.factoryTimestamps.coreInitTime};this.crossClientCoordinator=new QP(s,r,this,this.finalizeLegacyCrossClient,this.telemetryModeLookUp,this.userContextId,t,n),this.crossClientCoordinator.scenarioCreated$.subscribe((e=>{this.onScenarioFromCoordinator(e)})),i&&(this.crossClientCoordinator.loadCallbacks(i),this.logger.debug("Cross client initializing with callbacks")),this.crossClientCoordinator.loadExistingScenarios(a),this.logger.debug("Cross client coordinator initialized")},this.getTimestamp=e=>{const t=Date.now();return e?.isCrossClient&&this.factoryTimestamps.desktopFactoryStartTime?t-this.factoryTimestamps.desktopFactoryStartTime:e?.isFromCoreInit&&this.factoryTimestamps.coreInitTime?t-this.factoryTimestamps.coreInitTime:t-this.factoryTimestamps.scenarioFactoryStartTime};const{telemetry:{coreAllowListEnabled:m,coreAllowList:p,scenarioPackedDataLimit:g}}=this.context.settings;this.coreAllowListEnabled=m,this.allowedScenarios=p,this.scenarioPackedDataLimit=g,this.factoryTimestamps={scenarioFactoryStartTime:t,desktopFactoryStartTime:this.payload?.scenarioFactoryStartTime.time.getTime(),coreInitTime:o},this.activeScenariosMap=new Map,this.clientType=e.platformService?.config?.clientType,this.telemetryModeSubscription=this.context.settings.telemetry.observable.subscribe((e=>this.onReceiveTelemetrySettings(e))),this.crossAccountScenarioOptions={enabled:this.context.settings.telemetry.enableCrossAccountScenario},this.__initTestingMode__(this.context.settings.host.userType),this.timestamp=this.getTimestamp;const h=i?`ScenarioFactory-${i}`:"ScenarioFactory";this.logger=this.context.loggerFactory.newLogger(h,"core-services-telemetry"),this.timerFactory=new eM(this.context.windowProvider),this.payload&&this.initializeCrossClientScenarios(this.payload,this.context.settings.telemetry.noPureScenarioCreationList,this.context.settings.telemetry.restrictByClientId,l),this.startWindowLaunchTimeScenario(r,t),this.logger.debug("Initialized ScenarioFactory")}destroy(){this.telemetryModeSubscription.unsubscribe(),this.incompleteRunningScenarios()}setCoreInitTime(e){this.factoryTimestamps.coreInitTime=e,this.activeScenariosMap.forEach((t=>{t.forEach((t=>t.scenario.updateTimestamp?.("coreInitTime",e)))}))}doesScenariosExist(e){const t=[];for(const n of e){const e=this.activeScenariosMap.get(n);e?.length&&t.push(n)}return t}incompleteRunningScenarios(){this.context.settings.telemetry.scenarioIncompleteOnShutdown&&this.processOnRunningScenarios(((e,t)=>{this.context.settings.telemetry.scenarioIncompleteOnShutdownBlockList.includes(e.name)||(e.incomplete({reason:"shutdown"}),this.context.settings.telemetry.enableNewScenarioTimeout||clearTimeout(t))}))}startWindowLaunchTimeScenario(e,t){if(e){const e=this.newScenario(H.RG.WindowLaunchTime,{startTime:t,timeoutMs:6e4});e.appendEventData({workerEnabled:this.context.settings.host.enableSyncEngine}),this.hoistScenarioToCore?.(e)}}__initTestingMode__(e){e&&e.indexOf("test")>-1&&(this.__isTestingMode__=!0,sM in window?this.__testingBuffer__=window[sM]:this.__testingBuffer__=window[sM]=[])}__saveForTestingMode__(e){if(this.__isTestingMode__&&this.__testingBuffer__){const{scenarioBufferList:t}=this.context.settings.test;t.length>0?t.indexOf(e.name)>-1&&this.__pushScenarioBuffer__(e):this.__pushScenarioBuffer__(e)}}__pushScenarioBuffer__(e){e.isHoisted&&this.__testingBuffer__.length>0&&this.__testingBuffer__[this.__testingBuffer__.length-1].id===e.id||(this.__testingBuffer__.push(e),this.__testingBuffer__.length>100&&this.__testingBuffer__.shift())}onReceiveTelemetrySettings(e){this.telemetryModeLookUp=e.scenarioModes,this.coreAllowListEnabled=Boolean(e.coreAllowListEnabled),this.allowedScenarios=new Set(e.coreAllowList??[]),this.scenarioPackedDataLimit=rM(e.scenarioPackedDataLimit)}onScenarioFromCoordinator(e){this.crossClientScenarioList.add(e.name);const{showAllConsoleLogs:t}=this.context.settings.telemetry;e.testingMode=Boolean(t);const{userObjectId:n,correlationId:i,commandSource:a,tenantId:o}=this.getContextData(),r=(0,W.cloneDeep)(this.eventContextData);r["Panel.WindowID"]=this.windowId,r["UserInfo.Id"]=n,r["UserInfo.TenantId"]=o,r["EventInfo.CorrelationId"]=i,r.commandSource=a,e.appendEventData(r),this.factoryTimestamps.coreInitTime&&e.updateTimestamp("coreInitTime",this.factoryTimestamps.coreInitTime);const s=this.setupScenarioTimeout(e);this.getActiveScenarios(e.name).push({scenario:e,timeoutId:s})}}var cM=n(605882),dM=n(288718),uM=n(437385);const mM="reactWebClient",pM="maglev",gM="prod",hM="general";function yM(e,t,n){let i,a,o,r;if(n){const e=n.expConfigMetadata.find((e=>e.client===mM)),t=n.expConfigMetadata.find((e=>e.client===pM));i=e?.config.eTag,a=t?.config.eTag,o=n.expConfigMetadata.map((e=>e.config.expIds)).filter((e=>e.length>0)).join(","),r=vM(n.expConfigMetadata).join(",")}else i=e.eTag||void 0,a=e.hostETag||void 0,e.configIds&&e.configIds.experiments&&(o=e.configIds.experiments.join(",")),e.expRolloutIdAllowList?.length&&(r=fM(e).join(","));const s=function(e,t){const n=e.ring&&e.ring.id||hM;if(t)return n;const i=e.region?.toLowerCase(),a="gcc"===i?i:e.environment||gM;switch(a){case gM:return n;case"gcc":return`${n}_gcc`;default:return`${a}-${n}`}}(e,t);return{ring:s,eTag:i,hostETag:a,expIds:o,rolloutIds:r,environment:e.environment||void 0}}const vM=e=>{const t=new RegExp(/P-R-[a-zA-Z0-9]+/),n=[];return e.forEach((e=>{e.config.expRolloutIdAllowList?.split(",")?.forEach((i=>{if(t.test(i)){const t=e.config.rolloutIds?.split(",")?.filter((e=>e.startsWith(i)));n.push(...t??[])}}))})),n},fM=e=>{const t=new RegExp(/P-R-[a-zA-Z0-9]+/),n=[];return e.expRolloutIdAllowList?.forEach((i=>{if(t.test(i)){const t=e.configIds?.rollouts?.filter((e=>e.startsWith(i)))??[];n.push(...t)}})),n};class SM{constructor(e){this._top=-1,this._isFilled=!1,this._buffer=new Array(e),this.capacity=e}add(e){this._top=(this._top+1)%this.capacity,this._buffer[this._top]=e,this._top===this.capacity-1&&(this._isFilled=!0)}getItemFromLast(e){if(-1===this._top||e>=this.capacity||!this._isFilled&&this._top-e<0)return;const t=this._top-e>=0?this._top-e:this.capacity- -1*(this._top-e);return this._buffer[t]}}class kM{constructor(e){this.eventMarks=new SM(e&&e>0?e:100)}markEvent(e){this.markEventOverrideTimestamp(e,Date.now())}markEventOverrideTimestamp(e,t){this.eventMarks?.add({ts:t,name:e})}getEventsBetweenStartAndLast(e){if(!this.eventMarks)return[];const t=[];let n;for(let i=1;n=this.eventMarks.getItemFromLast(i),n&&!(n.ts<e);i++)t.push(n.name);return t}getEventsBetween(e,t){if(!this.eventMarks)return[];const n=[];let i;for(let a=0;i=this.eventMarks.getItemFromLast(a),i&&!(i.ts<e);a++)i.ts<t&&n.push(i.name);return n}}function CM(e){return new kM(e)}var bM;!function(e){e.Action="panelaction",e.View="panelview"}(bM||(bM={}));class wM{constructor(e,t=""){this.contextData=e,this.userContextId=t,this.clickStreamBatchInSeconds=75,this.clickStreamMaxBatchSize=15,this.getBatchNumber=()=>this.userBiCache.batchNumber,this.emptyCacheWithoutRestarting=()=>{this.recordClickStreamEvent({isTimeOut:!1,isBatchSize:!1,disableSetTimeout:!0})},this.addEventToUserBiCache=(e,t)=>{"panelaction"===t?(this.userBiCache.actionCount=this.userBiCache.actionCount+1,e["EventInfo.BaseType"]=bM.Action):(this.userBiCache.viewCount=this.userBiCache.viewCount+1,e["EventInfo.BaseType"]=bM.View),this.userBiCache.events.push(e),this.userBiCache.events.length>=this.clickStreamMaxBatchSize&&this.recordClickStreamEvent({isTimeOut:!1,isBatchSize:!0})},this.cacheClickStreamToLocalStorage=()=>{this.userBiCache.events.length>0&&this.telemetrySettings.enableClickStreamUnloadCache&&this.contextData.localStorage?.set("clickstream_cache",JSON.stringify(this.userBiCache),"Telemetry")},this.setUpHostListeners=()=>{this.host.addEventListener("beforeunload",(async()=>{this.cacheClickStreamToLocalStorage(),this.emptyCacheWithoutRestarting(),await this.telemetryProvider.flush()}))},this.localStorageFlush=()=>{if(this.telemetrySettings.enableClickStreamUnloadCache){const e=this.contextData.localStorage?.get("clickstream_cache"),t=JSON.parse(e);e&&this.sendTelemetry("clickstream_cached",t),this.contextData.localStorage?.remove("clickstream_cache")}},this.setBatchTimeandSize=e=>{e===(An.Bh.Desktop||An.Bh.Maglev)?(this.clickStreamBatchInSeconds=this.telemetrySettings.clickStreamBatchInSeconds||75,this.clickStreamMaxBatchSize=this.telemetrySettings.clickStreamMaxBatchSize||15):(this.clickStreamBatchInSeconds=this.telemetrySettings.clickStreamBatchInSecondsWeb||30,this.clickStreamMaxBatchSize=this.telemetrySettings.clickStreamMaxBatchSizeWeb||5)},this.setupClickStreamTimeout=()=>this.contextData.windowProvider.setTimeout((()=>{this.recordClickStreamEvent({isTimeOut:!0,isBatchSize:!1})}),1e3*this.clickStreamBatchInSeconds),this.recordClickStreamEvent=e=>{if(this.userBiCache.actionCount>0||this.userBiCache.viewCount>0){this.userBiCache.batchFlushed=e.isBatchSize,this.userBiCache.timeoutFlushed=e.isTimeOut;const t=this.userBiCache;this.telemetrySettings.disable1DSBatching&&(t.latency=4),this.sendTelemetry("clickstream",t),this.userBiCache={events:[],batchStartTime:(new Date).toISOString(),viewCount:0,actionCount:0,batchNumber:t.batchNumber+1,batchFlushed:!1,timeoutFlushed:!1}}this.contextData.windowProvider.clearTimeout(this.currentTimeoutId),e.disableSetTimeout||(this.currentTimeoutId=this.setupClickStreamTimeout())},this.userBiCache={events:[],batchStartTime:(new Date).toISOString(),viewCount:0,actionCount:0,batchNumber:1,batchFlushed:!1,timeoutFlushed:!1},this.telemetrySettings=this.contextData.settings.telemetry;const n=this.contextData.platformService?.config.clientType;this.setBatchTimeandSize(n),this.currentTimeoutId=this.setupClickStreamTimeout(),this.host=this.contextData.windowProvider,this.localStorageFlush(),this.host&&this.setUpHostListeners(),this.telemetryProvider=(0,ii.Yf)()}sendTelemetry(e,t){this.contextData.telemetrySender?this.contextData.telemetrySender.sendTelemetry(cM.x.ClickStream,e,t,void 0,{columnName:"events",packedData:t.events},void 0,this.userContextId):(0,ee.P3)(cM.x.ClickStream,e,t,void 0,{columnName:"events",packedData:t.events},void 0,this.userContextId)}}var TM=n(854887);class IM{constructor(e,t){if(this.context=e,this.windowId=t,this.biEventObserver=new kn.xQ,this.experimentationEventData={},this.telemetrySettings={},this.panelContextData={},this.dataBagContextData={},this.windowSlotContext={},this.userContextId="",this._dataBags=[],this.recordPanelView=(e,t,n)=>{const i=this.getCombinedContextData(n),a=this.getCombinedDataBagData(n),o={"Panel.Type":e.panelType,"Panel.Region":e.panelRegion};this.recordBiEvent({eventName:"panelview",data:{...this.windowSlotContext,...a,...AM({...i,...e}),...o}},t)},this.recordPanelAction=(e,t,n)=>{const i=this.getCombinedContextData(n),a=this.getCombinedDataBagData(n);this.recordBiEvent({eventName:"panelaction",data:{...this.windowSlotContext,...a,...NM({...i,...e})}},t),this.eventTimeTracker?.markEvent(`${e.actionOutcome}-${e.actionScenario}-${e.panelType}-${e.threadType}`)},this.setBISlotContext=e=>{this.windowSlotContext={...this.windowSlotContext,...e}},this.createDatabag=()=>{const e=new TM.S;return this._dataBags.push(e),e.setDispose((async()=>{await(0,Il._)(0);const t=this._dataBags.findIndex((t=>t.id===e.id));this._dataBags.splice(t,1)})),e},this.appendBiData=(e,t)=>{const{dataBag:n,...i}=t,a=_M(dA.sz,e);this.dataBagContextData[a]={...this.dataBagContextData[a],...n?.data},this.panelContextData[a]={...this.panelContextData[a],...i}},this.removeBiData=(e,t)=>{const n=_M(dA.sz,e);if(t)for(const e of t)this.dataBagContextData&&delete this.dataBagContextData[n]?.[e],this.panelContextData&&delete this.panelContextData[n]?.[e];else delete this.dataBagContextData[n],delete this.panelContextData[n]},this.recordTestOnlyTelemetry=()=>{const e=this.context?.settings.telemetry.testOnlyUserbiTelemetry;if(e)try{this.recordPanelAction(JSON.parse(e))}catch(e){}},this.context?.authenticationUser&&(this.userContextId=this.context.authenticationUser.id),this.context?.settings){const{telemetry:{disableRingNamePrefixing:e,observable:t,enableTestOnlyTelemetry:n},calling:{enableCallingPerfCollectorService:i,enableCallingLongTasksTracking:a,enableCallingLongTasksTriggerFinder:o}}=this.context.settings;this.metadataSubscription=this.context.settings.metadata.observable.subscribe((t=>{this.experimentationEventData=function(e,t,n){const i={},a=yM(e,t,n);return i["UserInfo.Ring"]=a.ring,i["UserInfo.ETag"]=a.eTag,i["UserInfo.HostETag"]=a.hostETag,i["AppInfo.ExpIds"]=a.expIds,i["AppInfo.ExpRolloutIds"]=a.rolloutIds,i["AppInfo.Environment"]=a.environment,i}(t,!!e,this.context?.experimentationService)})),this.telemetrySettingsSubscription=t.subscribe((e=>this.onReceiveTelemetrySettings(e))),this.clientType=this.context.platformService?.config.clientType,this.clientType===An.Bh.Maglev&&this.windowId!==h.ew&&this.subscribeToMaglevWindowState(),i&&a&&o&&(this.eventTimeTracker=CM()),n&&this.recordTestOnlyTelemetry()}}getEventsWithinTimeframe(e,t){return this.eventTimeTracker?.getEventsBetween(e,t)||[]}getWindowId(){return this.windowId}destroy(){this.metadataSubscription&&this.metadataSubscription.unsubscribe(),this.telemetrySettingsSubscription&&this.telemetrySettingsSubscription.unsubscribe(),this.clickStreamService&&this.clickStreamService.emptyCacheWithoutRestarting(),this.windowStateSubcription$&&this.windowStateSubcription$.unsubscribe(),this.unregisterForWindowStateChanged&&this.unregisterForWindowStateChanged(),this.smbUserIntentSubcription?.unsubscribe&&this.smbUserIntentSubcription.unsubscribe(),this._dataBags.length&&(this._dataBags=[])}initializeAndSubscribeToSmbUserIntent(){if(this.environment===pt.s.life&&this.includeSmbUserIntentData&&this.context?.client){const{smbUserIntentUserBiTelemetryPollInterval:e}=this.context?.settings.growth,t=async()=>{const t=await(0,ac.mT)((()=>n.e(309342).then(n.bind(n,325238))),"services-io-data-smb-user-intent").then((e=>e.smbUserIntentDocument));this.smbUserIntentSubcription=this.context?.client?.watchQuery({query:t,pollInterval:e,fetchPolicy:"no-cache"}).subscribe((e=>{e?.data?.smbUserIntent&&(this.smbUserIntent=e.data.smbUserIntent)}))};return t(),()=>{"function"==typeof this.smbUserIntentSubcription?.unsubscribe&&this.smbUserIntentSubcription.unsubscribe()}}}getDataFromBaseInstance(){return{"UserInfo.SmbUserIntent.Intent":this.smbUserIntent?.smbUserIntent,"UserInfo.SmbUserIntent.IntentScore":this.smbUserIntent?.smbUserIntentScore,"UserInfo.SmbUserIntent.ConfidenceScore":this.smbUserIntent?.smbConfidenceScore}}bubbleUpObservable(e){this.biEventObserver.next(e),this.context?.parentUserBiService?.bubbleUpObservable?.(e)}observe(){return this.biEventObserver.asObservable()}onReceiveTelemetrySettings(e){this.telemetrySettings=e,this.context&&this.telemetrySettings.enableClickStreamEvents&&!this.clickStreamService&&(this.clickStreamService=new wM({settings:this.context.clickstreamSettings,windowProvider:this.context.windowProvider,platformService:this.context.platformService,localStorage:this.context.localStorage},this.userContextId))}get includeSmbUserIntentData(){return Boolean(this.context?.settings.growth.enableSmbUserIntentUserBiTelemetry)}get environment(){return this.context?.settings.metadata.environment}recordBiEvent(e,t){this._applyContextData(e),this.includeSmbUserIntentData&&this.applySmbUserIntentData(e);const n=function(e){const t={};return Object.keys(e).forEach((n=>{(0,W.isNil)(e[n])||(t[n]=e[n])})),t}(e.data),i="EventInfo.Identifier"in e.data?e.data["EventInfo.Identifier"]:void 0;if(this.telemetrySettings.enableClickStreamEvents&&this.clickStreamService){const t=(e.eventName,n);this.telemetrySettings.enableDualClickStreamEvents&&(n.batchNumber=this.clickStreamService.getBatchNumber(),this.sendTelemetry(e.eventName,n,this.telemetrySettings.enableUserBiEventIdentifiers?i:void 0)),this.clickStreamService.addEventToUserBiCache(t,e.eventName)}else this.sendTelemetry(e.eventName,n,this.telemetrySettings.enableUserBiEventIdentifiers?i:void 0);t&&(t.debug(`Analytics: EventType: ${e.eventName}`),t.debug(`Analytics: Type: ${n["Panel.Type"]}`),t.debug("Analytics: Payload:",n)),this.bubbleUpObservable({eventName:e.eventName,data:n})}sendTelemetry(e,t,n){this.context?.telemetrySender?this.context.telemetrySender.sendTelemetry(cM.x.UserBI,e,t,void 0,void 0,n,this.userContextId):(0,ee.P3)(cM.x.UserBI,e,t,void 0,void 0,n,this.userContextId)}_applyContextData(e){e.data["Panel.WindowID"]=this.windowId,e.data["EventInfo.CorrelationId"]=this.context?.correlation?.id;const t=this.windowIsVisible??this.context?.windowProvider.isFocused();e.data["Window.Focus"]=t?BP.cb.foreground:BP.cb.background;const n=t?BP.Lv.maximized:BP.Lv.minimized;if(e.data["Window.Status"]=n,e.data["Window.Height"]=this.context?.windowProvider.innerHeight,e.data["Window.Width"]=this.context?.windowProvider.innerWidth,e.data["Window.ViewportContext"]=this.context?.windowProvider.viewportContext,this.context?.authenticationUser){const t=this.environment===pt.s.life?this.context?.authenticationUser.profile.paddedMsaId:this.context?.authenticationUser.profile.objectId;e.data["UserInfo.Id"]=t,e.data["UserInfo.TenantId"]=this.context?.authenticationUser.profile.tenantId}e.data={...e.data,...this.experimentationEventData}}getCombinedContextData(e){let t={};if(e)for(const n of e){const e=_M(dA.sz,n);t={...t,...this.panelContextData[e]}}return t}getCombinedDataBagData(e){let t={};if(e)for(const n of e){const e=_M(dA.sz,n);t={...t,...this.dataBagContextData[e]}}return t}async subscribeToMaglevWindowState(){if(!this.windowControlsModule&&this.context){this.windowControlsModule=await this.context.hostCommunicationService.loadModule("windowcontrols"),this.windowState$=new Cn.y((e=>{this.windowControlsModule&&this.windowControlsModule.registerForWindowStateChanged&&(this.unregisterForWindowStateChanged=this.windowControlsModule?.registerForWindowStateChanged((t=>{if(!t.windowId||this.windowId&&t.windowId===this.windowId){const n=!t.placement.minimized;e.next(n)}})))}));const e=e=>{this.windowIsVisible=e};this.windowStateSubcription$=this.windowState$.subscribe(e)}}applySmbUserIntentData(e){const t="function"==typeof this.context?.parentUserBiService?.getDataFromBaseInstance?this.context?.parentUserBiService?.getDataFromBaseInstance():void 0;t&&(e.data["UserInfo.SmbUserIntent.Intent"]=t["UserInfo.SmbUserIntent.Intent"],e.data["UserInfo.SmbUserIntent.IntentScore"]=t["UserInfo.SmbUserIntent.IntentScore"],e.data["UserInfo.SmbUserIntent.ConfidenceScore"]=t["UserInfo.SmbUserIntent.ConfidenceScore"])}}function NM(e){const{appName:t,actionGesture:n,actionOutcome:i,actionOutcomeNew:a,actionScenario:o,actionScenarioType:r,actionWorkload:s,actionSubworkload:l,actionInputDelay:c,moduleName:d,moduleNameNew:u,moduleType:m,moduleTypeNew:p,extensibilityData:g,tabId:h,tabIdNew:y,tabOrdinal:v,tabType:f,tabTypeNew:S,eventIdentifier:k,appId:C,appIsTenantApp:b,appCapabilityId:w,appScenarioCapability:T,appScope:I}=e,N=_M(dA.rA,d),E=_M(dA.PO,m),A=_M(dA.uS,n),_=_M(dA.Tk,o),F=(0,W.isNil)(k)?[N,E,A,_].filter(Boolean).join("_"):_M(dA.b6,k),D={"Action.Gesture":n,"Action.Outcome":i,"Action.OutcomeNew":a,"Action.Scenario":o,"Action.ScenarioType":r,"Action.WorkLoad":s,"Action.SubWorkLoad":l,"Module.Name":d,"Module.Type":m,"Module.NameNew":u,"Module.TypeNew":p,"Tab.Id":h,"Tab.Type":f,"Tab.IdNew":y,"Tab.TypeNew":S,"Tab.Ordinal":v,"App.Name":t,"App.Id":C,"App.IsTenantApp":b,"App.CapabilityId":w,"App.ScenarioCapability":T,"App.Scope":I,...AM(e),...EM(g)};return(0,W.isNil)(F)||(D["EventInfo.Identifier"]=F),(0,W.isNil)(c)||(D["Action.InputDelay"]=c),D}function EM(e){if(e&&!(0,W.isEmpty)(e))return{"App.Id":e.id,"App.Name":e.name,"App.Scope":_M(dM.Mv,e.scope),"App.ScenarioCapability":_M(dM.Ky,e.scenarioCapability),"App.EntryPoint":_M(dM.sG,e.entryPoint),"App.ExternalId":e.externalId,"App.IsTenantApp":e.isTenantApp,"App.CapabilityId":e.capabilityId,"App.SceneId":e.sceneId,"Bot.Id":e.botId,"App.MsftPartnerAppID":e.mpnId,"App.Source":_M(uM.RE,e.appDetailsEntryPoint),"App.FromSectionName":e.fromSectionName,"App.Capabilities":e.capabilities,"App.BotScopes":e.botScopes,"App.GalleryTabScopes":e.galleryTabScopes,"App.StaticTabScopes":e.staticTabScopes,"App.StaticTabName":e.staticTabName,"App.ConnectorScopes":e.connectorScopes,"App.ConnectorId":e.connectorId,"App.Version":e.version,"App.ManifestVersion":e.manifestVersion,"App.Categories":e.categories,"App.IsHostedApp":e.isHostedApp,"App.AppSource":e.appSource,"App.EventType":e.eventType,"App.DraftId":e.draftId,"App.LinkUnfurlingType":e.linkUnfurlingType,"App.AppSharingProtocol":e.sharingProtocol,"Platform.timeInApp":e.timeInApp,"App.IsNewAdminPreInstalledApp":e.isNewAdminPreInstalledApp}}function AM(e){const{panelRegion:t,panelRegionNew:n,panelType:i,panelTypeNew:a,threadId:o,teamId:r,threadMembers:s,threadType:l,panelLaunchMethod:c,panelUri:d,dataBag:u,extensibilityData:m,eventIdentifier:p,entityType:g,mainSlotApp:h,mainEntityType:y,mainEntityAction:v,officeGroupId:f,moduleName:S,moduleType:k,callId:C,participantId:b}=e,w=_M(dA.Ai,t),T=_M(dA.wh,i);return{"Panel.LaunchMethod":c,"Panel.Region":t,"Panel.Type":i,"Panel.RegionNew":n,"Panel.TypeNew":a,"Panel.Uri":d,"Module.Name":S,"Module.Type":k,"Thread.Id":o,"Team.Id":r,"Team.OfficeGroupId":f,"Call.Id":C,"Participant.Id":b,"Thread.Type":l,"Thread.Members":s,"TargetThread.Id":o,"TargetThread.Type":l,"EventInfo.Identifier":(0,W.isNil)(p)?[w,T].filter(Boolean).join("_"):_M(dA.b6,p),"Entity.Type":g,...u&&u.data,...EM(m),"UserInfo.ChannelResourceTenant.Id":e["UserInfo.ChannelResourceTenant.Id"],"SlotConfig.MainSlotApp":h,"SlotConfig.MainEntityType":y,"SlotConfig.MainEntityAction":v}}function _M(e,t){return(0,W.isNil)(t)?void 0:e[t]}class FM{create(e,t,n,i,a,o,r){const s=new le(i),l=new lM({...e,loggerFactory:s},n,a,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,o),c=new IM(t),d=new RP(s.newLogger("SetUserOnTelemetryContextTask","core-services-telemetry"),o),u={coreScenarioFactory:l,userBiService:c,loggerFactory:s,telemetryContext:d,telemetryService:new DM(l,d,a,{isolateUserContext:r.get(b.J.Telemetry).isolateUserContext??!1})};return FM._cache.set(o,u),u}destroy(e){if(e){const t=FM._cache.get(e);t&&(t.coreScenarioFactory.destroy?.(),t.userBiService.destroy?.(),FM._cache.delete(e))}}get(e){let t;return e&&(t=FM._cache.get(e)),t}clear(){FM._cache.clear()}forEach(e){FM._cache.forEach(e)}}FM._cache=new Map;class DM{constructor(e,t,n,i){this.coreScenarioFactory=e,this.coreTelemetryContext=t,this.memoryAnalyzer=n,this.isolateUserContext=!1,this.scenarioCancelOnNetworkStateChangeBlockList=new Set,this.scenarioCancelOnSuspendStateChangeBlockList=new Set,this.newCoreScenario=(e,t)=>this.coreScenarioFactory.newScenario(e,t),this.stopCoreScenarioIfActive=(e,t,n)=>this.coreScenarioFactory.stopScenarioIfActive(e,t,n),this.createScenarioFactory=(e,t,n,i,a,o="")=>{const{coreSettings:r}=e,{enableCreateWindowLaunchScenarioOnMainWindow:s}=r.get(b.J.Core);return new lM({settings:aM(r),parentScenarioFactory:e.scenarioFactory,platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:n},parseInt(n.startTimestamp,10)||Date.now(),this.memoryAnalyzer,t,i,this.coreInitTimestamp,!!s||t!==h.ew,void 0,void 0,void 0,{"Window.ViewportContext":a},o||this.coreTelemetryContext.userId)},this.createUserBiService=(e,t,n)=>new IM({authenticationUser:e.authenticationUser,settings:iM(e.coreSettings),clickstreamSettings:{telemetry:nM(e.coreSettings)},windowProvider:e.windowProvider,platformService:e.platformService,experimentationService:e.experimentationService,hostCommunicationService:e.hostCommunicationService,client:e.client,localStorage:e.localStorage,parentUserBiService:e.userBiService,correlation:n},t),this.setCoreContext=(e,t,n)=>{this.coreTelemetryContext.setContext(e,t,n)},this.setContext=(e,t,n,i="")=>{this.coreTelemetryContext.setContext(e,t,n,i)},this.setDeviceAuthToken=e=>{this.coreTelemetryContext.setDeviceAuthToken(e)},this.setUserId=e=>{this.coreTelemetryContext.setUserId(e)},this.getTelemetryContextService=()=>this.coreTelemetryContext,this.setTelemetryContextService=e=>{this.coreTelemetryContext=e},this.logOutUser=e=>{(0,ii.Yf)().logOutUser(e)},this.onHostStateChange=e=>{if(e.suspendedState===Fe.V9.Suspending&&e.suspendedState!==this.previousHostSuspendState){const e=e=>{this.scenarioCancelOnSuspendStateChangeBlockList.has(e.name)||e.cancel({reason:"suspending"})};this.getTelemetryServicesCache().forEach((t=>{t.coreScenarioFactory.processOnRunningScenarios(e)})),this.coreScenarioFactory.processOnRunningScenarios(e)}this.previousHostSuspendState=e.suspendedState},this.onNetworkStateChange=e=>{if(e===Os.G.Offline){const e=e=>{this.scenarioCancelOnNetworkStateChangeBlockList.has(e.name)||e.cancel({reason:"network offline"})};this.getTelemetryServicesCache().forEach((t=>{t.coreScenarioFactory.processOnRunningScenarios(e)})),this.coreScenarioFactory.processOnRunningScenarios(e)}},DM._telemetryServicesCache||(DM._telemetryServicesCache=new FM);const{isolateUserContext:a}=i;this.isolateUserContext=a}destroy(){this.telemetrySuspendStateSubscription?.unsubscribe(),this.telemetryNetworkStateSubscription?.unsubscribe()}getMemoryAnaylzer(){return this.memoryAnalyzer}setCoreInitTime(e){this.coreInitTimestamp=e,this.coreScenarioFactory.setCoreInitTime?.(e)}setAuthContext(e){const{id:t,oid:n,tid:i,type:a,role:o,subType:r,isCrossCloudUser:s,isExternal:l,homeAccountId:c,homeTenantId:d,userCloud:u}=e,m=(e,n)=>{this.isolateUserContext?this.setContext(e,n,void 0,t):this.setCoreContext(e,n)};void 0!==t&&m("userId",t===n?"":t),void 0!==n&&m("UserInfo.Id",n),void 0!==i&&m("UserInfo.TenantId",i),void 0!==a&&m("UserInfo.Type",a),void 0!==o&&m("UserInfo.Role",o),void 0!==c&&this.setContext("UserInfo.HomeAccountId",c,void 0,t),void 0!==d&&this.setContext("UserInfo.HomeTenantId",d,void 0,t),void 0!==r&&m("UserInfo.SubType",r),void 0!==u&&this.setContext("UserInfo.HomeCloud",u,void 0,t),void 0!==s&&this.setContext("UserInfo.IsCrossCloudUser",s,void 0,t),void 0!==l&&m("UserInfo.IsExternal",l)}getTelemetryServicesCache(){return DM._telemetryServicesCache}initTelemetrySuspendStateSubscription(e,t){this.telemetrySuspendStateSubscription||(this.scenarioCancelOnSuspendStateChangeBlockList=new Set(t),this.telemetrySuspendStateSubscription=e.observe().subscribe(this.onHostStateChange))}initTelemetryNetworkStateSubscription(e,t){this.telemetryNetworkStateSubscription||(this.scenarioCancelOnNetworkStateChangeBlockList=new Set(t),this.telemetryNetworkStateSubscription=e.observe().subscribe(this.onNetworkStateChange))}}class PM extends _e{constructor(){super(h.Yg.SetUserOnTelemetryContext,["authenticationService","authenticationUser","config","coreSettings","correlation","diagnosticsService","discover","hostCommunicationService","loggerFactory","platformService","scenarioFactory","telemetryContextService","telemetryService","windowProvider"])}async execute(e){const{authenticationUser:t,coreSettings:n,loggerFactory:i,authenticationService:a,correlation:o,telemetryContextService:r,telemetryService:s,discover:l}=e;let c=!1;const d=i.newLogger("SetUserOnTelemetryContextTask","core-services-tasks");let u;if(n.get(b.J.Telemetry).useTelemetryServicesCache&&(u=s.getTelemetryServicesCache().get(t.id)),u)e.loggerFactory=u.loggerFactory,e.scenarioFactory=u.coreScenarioFactory,e.telemetryService=u.telemetryService,e.userBiService=u.userBiService,e.telemetryContextService=u.telemetryContext;else{const i=t.type===ys.Ch.MsaLife||n.get(b.J.Metadata).environment===pt.s.life,a=new RP(d,t.id);e.loggerFactory=new le(e.diagnosticsService,e.correlation.id,t.id);const o=new lM({parentScenarioFactory:e.scenarioFactory,settings:aM(e.coreSettings),platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:e.correlation},e.config.startTimeMS,e.telemetryService?.getMemoryAnaylzer(),void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t.id);if(e.scenarioFactory=o,e.telemetryService=new DM(o,a,e.telemetryService?.getMemoryAnaylzer(),{isolateUserContext:n.get(b.J.Telemetry).isolateUserContext??!1}),i){t.profile.paddedMsaId=this.getPaddedMsaId(t.profile.objectId,d);const e=await l.getConsumerLicenseDetails(),{copilotSkuIdForTFL:i}=n.get(b.J.Messaging),a=i||"CFQ7TTC0MNTQ";c=!!e?.consumerLicenseDetails?.licensedProducts?.find((e=>e?.skuId===a))}this.setAuthUserOnTelemetryContext(e.telemetryService,t,i),this.markServiceWorkerState(e.telemetryService,e.windowProvider,e.config.basePath)}const{registerForUserContext:m,notifyPrivacyDataControlsEnabled:p}=await this.initializeUserHostComms(e.authenticationUser.id,e.hostCommunicationService,d);p&&l.getUser().then((e=>{p(e.isPrivacyDataControlEnabled??!1)}));const g=m?.(((t,n,i)=>{e.telemetryService.setContext(t,i,void 0,n)})),h=this.subscribeAndSetUserInfoTelemetryContext(e.telemetryService,t,n,c),y=this.subscribeAndSetSmbTenantSegmentTelemetryContext(e.telemetryService,n),v=n.get(b.J.Telemetry).disableMTMAPrimaryId??!1;Ya(v,r,a,o,d),e.authenticationService.registerEndTelemetryTask?.((async e=>{g&&g(),s.setContext("UserInfo.IsMRU",void 0,void 0,e),h.unsubscribe(),y.unsubscribe();try{await Ya(v,r,a,o,d)}catch(e){d.errorToTelemetry?.("Failed to update MRU or sync mtma context","telemetry_instrumentation_update_user_context")}await(0,ii.Yf)().flush(),(0,ii.Yf)().logOutUser(e),n.get(b.J.Telemetry).useTelemetryServicesCache&&s.getTelemetryServicesCache().destroy(e)}))}async initializeUserHostComms(e,t,n){const i={};try{const n=await t.loadModule("telemetry"),{registerForOnNewContext:a,setPdcEeaStatus:o}=n??{};a&&(i.registerForUserContext=t=>a((n=>{n.filter((t=>t.userContextId===e)).forEach((n=>t(n.column,e,n.value)))}))),o&&(i.notifyPrivacyDataControlsEnabled=o)}catch(e){n.errorToTelemetry&&n.errorToTelemetry(Ms.LoadModuleTelemetryFailed,"webclient_framework_host_comms",void 0,!0)}return i}subscribeAndSetUserInfoTelemetryContext(e,t,n,i){return n.getObservable(b.J.UserResources).subscribe((n=>{const a=n.licenseType||void 0;switch(a?e.setContext("UserInfo.LicenseType",a):i&&e.setContext("UserInfo.LicenseType","Copilot"),t.role){case ys.w4.Member:n.isTenantAdmin||void 0?e.setContext("UserInfo.TenantRole",BP.z7.Admin):e.setContext("UserInfo.TenantRole",BP.z7.Regular);break;case ys.w4.Guest:e.setContext("UserInfo.TenantRole",BP.z7.Guest);break;case ys.w4.Anonymous:e.setContext("UserInfo.TenantRole",BP.z7.Anonymous)}}))}subscribeAndSetSmbTenantSegmentTelemetryContext(e,t){return t.getObservable(b.J.Smb).subscribe((t=>{const n=t.tenantSizeSegment||void 0;n&&e.setContext("Tenant.SmbTenantSizeSegment",n)}))}markServiceWorkerState(e,t,n){let i;"serviceWorker"in t.navigator&&t.navigator.serviceWorker.getRegistration(`/${n}/serviceworker.js`).then((t=>{t&&(t.active?i=t.active:t.waiting?i=t.waiting:t.installing&&(i=t.installing)),e?.setCoreContext("AppInfo.ServiceWorkerState",t?i?.state:"NotFound")}))}setAuthUserOnTelemetryContext(e,t,n){n&&t.profile.paddedMsaId&&this.setUserContext(e,t.profile.paddedMsaId);const i=n&&t.profile.paddedMsaId?t.profile.paddedMsaId:t.profile.objectId;e.setContext("UserInfo.Id",i),e.setContext("UserInfo.TenantId",t.profile.tenantId),e.setContext("UserInfo.Type",t.type),e.setContext("UserInfo.Role",t.role)}setUserContext(e,t){const n=t.slice(19).replace("-","");e.setUserId(t),e.setContext("UserInfo.Id",t),e.setContext("userId",n)}getPaddedMsaId(e,t){try{if(/(\w{8})-(\w{4})-(\w{4})-(\w{4})-(\w{12})/.exec(e)&&e.startsWith("00000000-0000-0000-"))return e;{const t=(0,W.padStart)(e,32,"0"),n=/(\w{8})(\w{4})(\w{4})(\w{4})(\w{12})/;return t.replace(n,"$1-$2-$3-$4-$5")}}catch(e){return void t.error("failed_user_padding")}}}class MM extends _e{constructor(){super(h.Yg.CreateUserTelemetryServicesTask,["telemetryService","authenticationUser","diagnosticsService","coreSettings","loggerFactory","windowProvider","correlation","platformService","experimentationService","hostCommunicationService","client","scenarioFactory"])}async execute(e){const{authenticationUser:t,diagnosticsService:n,telemetryService:i,coreSettings:a,loggerFactory:o,windowProvider:r,correlation:s,platformService:l,experimentationService:c,hostCommunicationService:d,client:u,scenarioFactory:m}=e;a.get(b.J.Telemetry).useTelemetryServicesCache&&!i.getTelemetryServicesCache().get(t.id)&&i.getTelemetryServicesCache().create({settings:aM(a),loggerFactory:o,windowProvider:r,correlation:s,parentScenarioFactory:m},{authenticationUser:t,settings:iM(a),clickstreamSettings:{telemetry:nM(a)},windowProvider:r,platformService:l,experimentationService:c,hostCommunicationService:d,client:u},Date.now(),n,i.getMemoryAnaylzer(),t.id,a)}}const xM="serviceWorkerDeferInstallDurationInMs",RM="enableServiceWorkerIntegrityCheck",jM="enableServiceWorkerDynamicManifest",LM="localeSettingValue",OM="environment",$M="clientType",UM="swHandleCdlHashRoute",BM="platformId",WM="enableServiceWorkerIndexMismatchCheck",HM="enableServiceWorkerBatchInstall",VM="teams-service-worker-telemetry-v2",GM="1",zM="LogEvents",qM="timestamp",JM="teams-service-worker-v2",QM="2",KM="SwState",YM="key";var XM,ZM,ex,tx;!function(e){e.Install="install",e.Activate="activate",e.Fetch="fetch"}(XM||(XM={})),function(e){e.Intermediate="intermediate",e.Old="old"}(ZM||(ZM={})),function(e){e.Info="sw_info",e.InstallSuccess="sw_install_success",e.InstallFailure="sw_install_failure",e.ActivateSuccess="sw_activate_success",e.ActivateFailure="sw_activate_failure",e.FetchCacheMiss="sw_fetch_cache_miss",e.CleanupCacheSuccess="sw_cleanup_cache_success",e.CleanupCacheFailure="sw_cleanup_cache_failure",e.CleanupCacheRetry="sw_cleanup_cache_retry",e.CleanupNotRun="sw_cleanup_cache_not_run",e.CleanupNotRequired="sw_cleanup_cache_not_required",e.CorruptCache="sw_corrupt_cache",e.CorruptCacheDeleteSuccess="sw_corrupt_cache_delete_success",e.CorruptCacheDeleteFailure="sw_corrupt_cache_delete_failure",e.DeferInstallStarted="sw_install_defer_started",e.DeferInstallCancelled="sw_install_defer_cancelled",e.DeferInstallCancelledOnMaxIncomplete="sw_install_defer_cancelled_max_incomplete",e.DeferInstallOldCacheCleanupInProgress="sw_install_defer_old_cache_cleanup_inprogress",e.DeferInstallTimerCompleted="sw_install_defer_timer_completed",e.DeferInstallRetryAttempted="sw_install_defer_retry",e.ResetInstallIncompleteCounterFailure="sw_install_reset_counter_failure",e.ResetCacheCleanupStateFailure="sw_reset_cache_cleanup_state_failure",e.InstallIntegrityCheckPerformed="sw_install_integrity_check_performed",e.ReadIndexedDbFailure="sw_read_indexeddb_failure",e.AssetSetGenerationFailure="sw_asset_set_generation_failure",e.WriteIndexedDbFailure="sw_write_indexeddb_failure",e.FetchSWAssetsUsingSendMessage="sw_fetch_assets_using_send_message",e.VersionMismatch="sw_build_version_mismatch"}(ex||(ex={})),function(e){e.Start="start",e.Success="success",e.Failure="failure",e.CacheMiss="cache_miss",e.HighLatency="high_latency",e.CDNAssetNotInManifest="cdn_asset_not_in_manifest",e.OfflineAssetStart="offline_asset_start",e.OfflineAssetSuccess="offline_asset_success",e.OfflineAssetFailure="offline_asset_failure",e.OfflineAssetCacheMiss="offline_asset_cache_miss"}(tx||(tx={}));const nx=3e5,ix=18e4,ax=72e5,ox=18e5,rx="serviceWorkerCheckingForUpdates",sx="serviceWorkerMaxUpdateFailureCountReached",lx="previousSuccessfulInstalledBuild",cx="serviceWorkerRegistrationNotFound",dx="lastUpdateCheckTimestamp",ux=5,mx=1e4,px=3,gx=5,hx=72e5,yx="fundamentals_performance_sw_fetch",vx="fundamentals_performance_sw_offline_fetch";var fx=n(768896);class Sx{constructor(e){this.context=e,this.fetchTelemetryStore=new Map,this.swEnableIntegrityCheck=!1,this.enableServiceWorkerBatchInstall=!1,this.isSwInstalling=!1,this.isSwWaiting=!1,this.sWRegistrationAttempt=0,this.sWRegistrationTrialCounter=0,this.serviceWorkerUpdateFailureCount=0,this.basePath=this.context.config.basePath,this.loggerFactory=this.context.loggerFactory,this.logger=this.loggerFactory.newLogger("WebClientUpdateService","services-io-browser-web-client-update"),this.rebootService=this.context.rebootService,this.host=this.context.windowProvider,this.scenarioFactory=this.context.scenarioFactory,this.coreSecurityService=this.context.coreSecurityService,this.localStorage=this.context.localStorage;try{this.swRegisterUrlPolicy=this.coreSecurityService.getTrustedTypePolicy("@msteams/services-io-browser-web-client-update#register-service-worker"),this.trustedScriptUrl=this.swRegisterUrlPolicy?.createScriptURL(`/${this.basePath}/serviceworker.js`,this.host.location.origin)}catch(e){e instanceof jm.Y&&Ee.G.isFunction(e.toTelemetryEntry)?this.logger.errorToTelemetry?.(e.toTelemetryEntry(),"fundamental_performance_trusted_sw_scripturl"):this.logger.errorToTelemetry?.("create register service worker url trustedtype policy failed",e)}this.enableSWSubscription=this.context.coreSettings.getObservable(b.J.Core).subscribe((e=>{this.registerOrUnregisterServiceWorker(!!e.enableServiceWorker)}))}cleanup(){this.enableSWSubscription.unsubscribe(),this.clearTimer()}checkForUpdateAndRestartWebClient(){this.configureServiceWorkerEvents(),this.addUpdateServiceWorkerSettings(!0),this.registerAndCheckForServiceWorkerUpdates()}sendMessageToServiceWorker(e,t){return new Promise(((n,i)=>{const a=new MessageChannel;a.port1.onmessage=e=>{e.data.error?i(e.data.error):n(e.data)},e.postMessage(t,[a.port2])}))}handleOnStateChange(e,t,n,i){switch(this.sendServiceWorkerLifeCycleEventTelemetry(),t){case"installed":const{buildUpdateVersion:t}=this.context.coreSettings.get(b.J.TeamsBuilds);t&&this.localStorage.trySet(lx,t,"Fundamental_Performance"),this.logger.log("Service worker got installed"),this.handleInstalledSWState(i);break;case"activated":this.logger.log("Service worker got activated"),this.isSwWaiting=!1;const a=this.scenarioFactory.findScenario(H.RG.SwStateChange);a&&(this.scenarioFactory.markStep(H.RG.SwStateChange,H.ck.SwActivated),a.stop()),this.setServiceWorkerContextForScenarios(!0);case"redundant":this.handleRedundantSWState(e,n)}e={state:t}}SendIncompleteEvent(e,t){this.fetchTelemetryStore.set(e.url,e),this.sendServiceWorkerFetchEventTelemetryInCompleteEvent(t)}setServiceWorkerContextForScenarios(e=!1){e?this.setScenarioContext(e):this.getServiceWorkerRegistration().then((e=>{this.setScenarioContext(!!e)})).catch((e=>{this.logger.error(`Error getting Service Worker registration object: ${e}`)}))}unregisterServiceWorker(e,t=!0){const n=t?"fundamentals_performance_sw_unregister":"fundamentals_performance_t1_sw_unregister_from_t2";"serviceWorker"in this.host.navigator&&(this.getServiceWorkerRegistration(t).then((t=>{t&&t.unregister().then((t=>{this.logger.infoToTelemetry?.(e,n)}))})).catch((e=>{this.logger.errorToTelemetry?.(e.toString(),n)})),this.deleteCacheStorage(e,t?h.eL:h.In),this.clearTimer())}handleRedundantSWState(e,t){"installing"===e.state?(this.isSwInstalling=!1,this.scenarioFactory.markStep(H.RG.SwStateChange,H.ck.SwInstallFailure),t.fail(),this.serviceWorkerUpdateFailureCount++,this.triggerForceUpdate()):"installed"===e.state&&(this.isSwWaiting=!1),this.setServiceWorkerContextForScenarios(!0)}triggerForceUpdate(){this.serviceWorkerUpdateFailureCount>=ux&&(this.logger.error("Will force an update when the app is idle as SW update failed repeatedly with",sx),this.handleUpdateReady())}handleInstalledSWState(e){this.isSwInstalling=!1,this.isSwWaiting=!0,this.setServiceWorkerContextForScenarios(!0),this.scenarioFactory.markStep(H.RG.SwStateChange,H.ck.SwInstalled),"storage"in this.host.navigator&&"estimate"in this.host.navigator.storage&&this.host.navigator.storage.estimate().then((e=>{const t=e.usageDetails,n={storageUsage:e.usage,storageQuota:e.quota,cacheStorageSize:t?.caches,indexedDBSize:t?.indexedDB,swRegSize:t?.serviceWorkerRegistrations};this.logger.infoToTelemetry?.("Teams disk footprint","fundamentals_performance_user_storage_info",n)})),On(this.host)&&this.scenarioFactory.stopScenarioIfActive(H.RG.SwStateChange),e||this.handleUpdateReady(),this.serviceWorkerUpdateFailureCount=0}logServiceWorkerTelemetry(){this.sendServiceWorkerFetchEventTelemetry(),this.recurringSendSWFetchEventTelemetryInterval=this.host.setInterval(this.sendServiceWorkerFetchEventTelemetry.bind(this),nx),this.sendServiceWorkerLifeCycleEventTelemetry()}sendServiceWorkerLifeCycleEventTelemetry(){const e=parseInt(GM,10);(0,fx.q8)(VM,e,zM,qM,this.scenarioFactory,!0).then((e=>{if(void 0!==e){let t=0;const n=this.recentProcessedLifeCycleEventTimestamp??-1;e.map((e=>{const i=e.timestamp??0;i>n&&(this.sendServiceWorkerLifeInfoAndInstallTelemetry(e),t=Math.max(t,i))})),this.recentProcessedLifeCycleEventTimestamp=t}})).catch((e=>{this.logger.error("Error fetching service worker state telemetry. Error:",e)})).then((()=>(0,fx.dR)(VM,e,zM,qM,this.scenarioFactory).catch((e=>{this.logger.error("Error deleting service worker state telemetry. Error:",e)}))))}sendServiceWorkerLifeInfoAndInstallTelemetry(e){const t={version:e.version,type:e.type,context:e.buildVersion},n=e.message||"";switch(e.type){case ex.InstallSuccess:this.logger.infoToTelemetry?.(n,"fundamentals_performance_sw_install",t);break;case ex.InstallFailure:this.logger.errorToTelemetry?.(n,"fundamentals_performance_sw_install",t);break;case ex.VersionMismatch:this.logger.warnToTelemetry?.(n,"fundamentals_performance_sw_install",t);break;case ex.ActivateSuccess:this.logger.infoToTelemetry?.(n,"fundamentals_performance_sw_activate",t);break;case ex.ActivateFailure:this.logger.errorToTelemetry?.(n,"fundamentals_performance_sw_activate",t);break;case ex.ReadIndexedDbFailure:this.logger.errorToTelemetry?.(n,"fundamentals_performance_sw_read_indexed_db",t);break;default:this.logger.infoToTelemetry?.(n,"fundamentals_performance_sw_state_info",t)}}registerServiceWorker(){const{serviceWorkerRegistrationScenarioTimeoutInMs:e,maxSWRegistrationTrialAllowed:t}=this.context.coreSettings.get(b.J.Core),n=this.scenarioFactory.findScenario(H.RG.SwRegistration)??this.scenarioFactory.newScenario(H.RG.SwRegistration,{timeoutMs:e??hx});n.isPaused&&n.resume(),this.attemptSWRegistration().then((e=>{this.sWRegistrationTrialCounter=0,n.stop(),this.attachEventsToInstallingServiceWorker(e,!0)})).catch((e=>{n.appendEventData({retryCount:this.sWRegistrationTrialCounter,message:`SW registration attempt ${this.sWRegistrationAttempt} failed with ${e}`}),this.sWRegistrationAttempt<px?this.sWRegistrationRetryTimer=this.host.setTimeout((()=>this.registerServiceWorker()),mx):this.sWRegistrationTrialCounter<(t??gx)?(n.pause({reason:h.jK.Paused,pauseReason:`SW Registration trial ${this.sWRegistrationTrialCounter} attempt ${this.sWRegistrationAttempt} Failed. Retry  after 2 hours`,message:e}),this.sWRegistrationAttempt=0):(this.sWRegistrationTrialCounter=0,this.sWRegistrationAttempt=0,this.context.networkState?.isOnline()?(n.mark(H.ck.checkNetworkConnection),this.checkNetworkConnection().then((t=>{t.ok?n.fail({message:`SW reg is failing due to ${e} & response status: ${t.status}, content-length: ${t.headers.get("Content-Length")}, Content-Encoding:${t.headers.get("Content-Encoding")}`}):n.cancel({message:`SW reg is failing due to ${e} & response status: ${t.status}, content-length: ${t.headers.get("Content-Length")}, Content-Encoding:${t.headers.get("Content-Encoding")}`})})).catch((t=>{n.cancel({message:`SW reg is failing on check network connection error: ${t} in explict request with top Error: ${e}`})}))):n.cancel({message:`user is not online and SW reg is failing due to error: ${e}`}))}))}attemptSWRegistration(){const{enableTrustedSWScriptUrl:e}=this.context.coreSettings.get(b.J.Core);this.sWRegistrationAttempt++;const t=e&&this.trustedScriptUrl?this.trustedScriptUrl:`/${this.basePath}/serviceworker.js`;return this.host.navigator.serviceWorker.register(t,{updateViaCache:"all"})}checkNetworkConnection(){const e=this.trustedScriptUrl?this.trustedScriptUrl.toString():`/${this.basePath}/serviceworker.js`;return fetch(e)}handleUpdateReady(){const{disableSkipWaiting:e}=this.context.coreSettings.get(b.J.Core);e||this.skipWaitingServiceWorkerIfNeeded(),this.rebootService.rebootWhenLongInactive(Dr.Z.AppUpdatedUsingServiceWorker,Dr.d.WebClientUpdateService)}deleteCacheStorage(e,t=h.eL){if(void 0!==this.host.caches){const n=this.scenarioFactory.newScenario(H.RG.SwCleanupSwCache);this.host.caches.delete(t).then((i=>{i?n.stop({reason:e,message:`cache ${t}$ got deleted`}):n.fail({reason:`cache ${t}$ not found`})}))}}registerAndCheckForServiceWorkerUpdates(){this.sWRegistrationTrialCounter++;const{enableT1ServiceWorkerUnregistrationOnWeb:e,enableUpdateCheckUsingTeamsBuildUpdateVersion:t}=this.context.coreSettings.get(b.J.Core);this.getServiceWorkerRegistration().then((n=>{n?e&&this.context.platformService.config.clientType===An.Bh.Web&&n.scope.startsWith(this.host.location.origin)&&!1===n.scope.includes(`/${this.basePath}/`)?(this.unregisterServiceWorker("Found T1 service worker so unregistering it",!1),this.registerServiceWorker()):t?this.checkForUpdate(n):(this.logger.infoToTelemetry?.(rx,"fundamentals_performance_sw_update_check"),n.update()):(this.logger.log(cx),this.registerServiceWorker())})).catch((e=>{this.logger.error(`Error getting Service Worker registration object: ${e}`)}))}configureServiceWorkerEvents(){"serviceWorker"in this.host.navigator&&this.getServiceWorkerRegistration().then((e=>{e?(this.attachEventsToInstallingServiceWorker(e),e.onupdatefound=()=>{this.attachEventsToInstallingServiceWorker(e)}):this.logger.log(cx)}))}registerServiceWorkerAndLogTelemetry(){const{enableUpdateServiceWorkerRegistrationPerSession:e}=this.context.coreSettings.get(b.J.Core);this.addUpdateServiceWorkerSettings(),e?this.registerAndCheckForServiceWorkerUpdates():this.registerServiceWorker(),this.logServiceWorkerTelemetry()}addUpdateServiceWorkerSettings(e=!1){const t=[],{serviceWorkerDeferInstallDurationInMs:n,enableServiceWorkerDynamicManifest:i,handleCdlHashRouteInServiceWorkerInstall:a,enableServiceWorkerIntegrityCheck:o,enableServiceWorkerIndexMismatchCheck:r,enableServiceWorkerBatchInstall:s}=this.context.coreSettings.get(b.J.Core);n&&Number.isInteger(n)&&this.swDeferInstallDurationInMs!==n&&(this.swDeferInstallDurationInMs=n,t.push({key:xM,value:this.swDeferInstallDurationInMs})),this.swEnableDynamicManifest!==i&&(this.swEnableDynamicManifest=i??!1,t.push({key:jM,value:this.swEnableDynamicManifest})),this.swEnableIndexMismatchCheck!==r&&(this.swEnableIndexMismatchCheck=r??!1,t.push({key:WM,value:this.swEnableIndexMismatchCheck})),this.swEnableIntegrityCheck!==o&&(this.swEnableIntegrityCheck=o??!1,t.push({key:RM,value:this.swEnableIntegrityCheck})),this.enableServiceWorkerBatchInstall!==s&&(this.enableServiceWorkerBatchInstall=s??!1,t.push({key:HM,value:this.enableServiceWorkerBatchInstall})),this.swhandleCdlHashRoute!==a&&(this.swhandleCdlHashRoute=a??!1,t.push({key:UM,value:this.swhandleCdlHashRoute}));const l=this.context.i18NextWrapper?.locale??"en-us";if(this.localeSetting!==l&&(this.localeSetting=l,t.push({key:LM,value:this.localeSetting})),!e){t.push({key:OM,value:this.context.platformService.ecsOverrides.environment.toString()});const e=this.context.platformService.config.clientType===An.Bh.Maglev?"desktop":this.context.platformService.config.clientType.toString();t.push({key:$M,value:e})}t.push({key:BM,value:this.context.platformService.config.platformId.toString()}),t.length&&this.writeSettingsInServiceWorkerDb(t)}async writeSettingsInServiceWorkerDb(e){const t=parseInt(QM,10);await(0,fx.Zl)(JM,t,KM,YM,e,this.scenarioFactory).then((()=>{this.logger.log("Successfully updated service worker settings in Indexed DB")})).catch((e=>{this.logger.error("Error updating service worker settings in Indexed DB. Error:",e)}))}sendServiceWorkerFetchEventTelemetry(){this.host.navigator.serviceWorker.controller&&this.sendMessageToServiceWorker(this.host.navigator.serviceWorker.controller,"getFetchTelemetryEvents").then((e=>{e.forEach((e=>{this.sendServiceWorkerFetchEventTelemetryCompletedEvent(e)}))})).catch((e=>{this.logger.error("Error getting service worker fetch telemetry. Error:",e)})),this.sendServiceWorkerFetchEventTelemetryInCompleteEvent(nx)}sendServiceWorkerFetchEventTelemetryInCompleteEvent(e){const t=Date.now();this.fetchTelemetryStore.forEach(((n,i)=>{if(void 0===e||t-n.timestamp>e){const e={endpointUrl:n.url,fetchTelemetryEventDelta:t-n.timestamp,operationType:n.type,version:n.version,message:n.message},a=n.type===tx.OfflineAssetStart?H.RG.SwOfflineAssetFetchEvent:H.RG.SwFetchEvent;this.scenarioFactory.newScenario(a).cancel(e),this.fetchTelemetryStore.delete(i)}}))}sendServiceWorkerFetchEventTelemetryCompletedEvent(e){const t={endpointUrl:e.url,operationType:e.type,message:e.message,version:e.version,context:e.buildVersion};if(this.captureFetchEvent(e,t)){const n=this.isOfflineFetchOperation(e.type)?vx:yx;this.sendFetchEvent(n,e.type,t)}}isOfflineFetchOperation(e){let t;switch(e){case tx.OfflineAssetSuccess:case tx.OfflineAssetFailure:case tx.OfflineAssetCacheMiss:t=!0;break;default:t=!1}return t}sendFetchEvent(e,t,n){const i=n.message||"";switch(t){case tx.Success:case tx.OfflineAssetSuccess:this.logger.infoToTelemetry?.(i,e,n);break;case tx.CacheMiss:case tx.OfflineAssetCacheMiss:this.logger.warnToTelemetry?.(i,e,n);break;case tx.Failure:case tx.OfflineAssetFailure:this.logger.errorToTelemetry?.(i,e,n);break;default:this.logger.debugToTelemetry?.(i,e,n)}}captureFetchEvent(e,t){switch(e.type){case tx.Start:case tx.OfflineAssetStart:return this.fetchTelemetryStore.set(e.url,e),!1;case tx.Failure:case tx.Success:case tx.OfflineAssetFailure:case tx.OfflineAssetSuccess:case tx.CDNAssetNotInManifest:case tx.CacheMiss:case tx.OfflineAssetCacheMiss:const n=this.fetchTelemetryStore.get(e.url);return n?(t.fetchTelemetryEventDelta=e.timestamp-n.timestamp,this.fetchTelemetryStore.delete(e.url)):t.reason="orphan",!0;case void 0:return this.logger.error("unexpected fetch event type:",e.type),!1}return!1}clearTimer(){this.host.clearInterval(this.recurringCheckForUpdateInterval),this.host.clearTimeout(this.registerSWAndLogTelemetryTimer),this.host.clearInterval(this.recurringSendSWFetchEventTelemetryInterval),this.host.clearTimeout(this.sWRegistrationRetryTimer)}registerOrUnregisterServiceWorker(e){if(e){if(!this.recurringCheckForUpdateInterval){this.recurringCheckForUpdateInterval=this.host.setInterval((()=>this.checkForUpdateAndRestartWebClient()),ax+Math.ceil(Math.random()*ox));const{serviceWorkerRegistrationDelayInMs:e}=this.context.coreSettings.get(b.J.Core),t=e&&Number.isInteger(e)?e:ix;this.registerSWAndLogTelemetryTimer=this.host.setTimeout((()=>this.registerServiceWorkerAndLogTelemetry()),t)}}else this.unregisterServiceWorker("Service Worker is not enabled");this.setServiceWorkerContextForScenarios()}setScenarioContext(e){this.scenarioFactory.setContext?.({isServiceWorkerRegistered:e,isServiceWorkerActive:On(this.host),isServiceWorkerInstalling:this.isSwInstalling,isServiceWorkerWaiting:this.isSwWaiting})}attachEventsToInstallingServiceWorker(e,t=!1){if(!e||!e.installing)return;const n=this.scenarioFactory.newScenario(H.RG.SwStateChange);this.scenarioFactory.markStep(H.RG.SwStateChange,H.ck.SwInstalling);const i=e.installing,a={state:i.state};this.isSwInstalling=!0,this.setServiceWorkerContextForScenarios(!0),i.onstatechange=()=>this.handleOnStateChange(a,i.state,n,t)}skipWaitingServiceWorkerIfNeeded(){"serviceWorker"in this.host.navigator&&this.getServiceWorkerRegistration().then((e=>{e&&e.waiting&&e.waiting.postMessage("skipWaiting")}))}getServiceWorkerRegistration(e=!0){return e?this.host.navigator.serviceWorker.getRegistration(`/${this.basePath}/serviceworker.js`):this.host.navigator.serviceWorker.getRegistration("/serviceworker.js")}checkForUpdate(e){const{buildUpdateVersion:t}=this.context.coreSettings.get(b.J.TeamsBuilds),n=this.context.platformService.config.buildVersion,{forcedupdatecheckTimeIntervalinMs:i}=this.context.coreSettings.get(b.J.Core),a=Date.now();let o=!1,r=!1;const s=this.localStorage.get(dx),l=this.localStorage.get(lx);o=null===l&&t!==n||l!==t,null==s&&t===n?r=!0:s&&i&&(r=a-parseInt(s,10)>i),(o||r)&&(this.logger.infoToTelemetry?.(`update check from ${n}`,"fundamentals_performance_sw_update_check",{currentBuildVersion:n,buildUpdateVersion:t,forcedUpdateCheck:r}),this.updateApp(e))}updateApp(e){const t=Date.now();e.update(),this.localStorage.trySet(dx,t.toString(),"Fundamental_Performance")}}class kx extends _e{constructor(){super(h.Yg.CreateWebClientUpdate,["coreSettings"])}async execute(e,t){t.webClientUpdateService=new Sx(e);const{isUnRegisterSWOnLogoutEnabled:n}=e.coreSettings.get(b.J.Core);if(n)return async e=>{"signout"===e&&await t.webClientUpdateService.unregisterServiceWorker(e)}}}var Cx=n(735977);class bx extends _e{constructor(){super(h.Yg.CreateWindow,["config","diagnosticsService","logsCollectorService"]),this.registerShellHandlers=(e,t,n)=>{e.opener.addEventListener(O.rY.GetLogs,(async()=>{const i=await t.getDiagnosticsEvents(),a=await n.getSystemInfo();let o="System Info: ";a&&a.size>0?a.forEach(((e,t)=>{o+=`${t}: ${e}\n`})):o+="No system info collected",i.unshift({message:`${o}`,level:_.i.Debug,levelName:_.i[_.i.Debug],timeStamp:new Date,isPiiFree:!0}),e.opener.postMessage(O.rY.GetLogs,{logs:i})}))}}async execute(e){const t=Cx.n.getInstance(),n=t.config.hostedWindowContext,i=t.window;t.opt={postMessageConfig:e.config.postMessageConfig},i.onAppStart();const{diagnosticsService:a,logsCollectorService:o}=e;this.registerShellHandlers(i,a,o),e.hostedWindowContext=n,e.windowProvider=i}}class wx extends _e{constructor(){super(h.Yg.DiscoverUser,["config","discover"])}async execute(e){e.config.skipDiscoverUser||(e.user=await e.discover.getUser())}}class Tx extends _e{constructor(){super(h.Yg.FetchCriticalDynamicImportsTask,["criticalDynamicImports","loggerFactory","scenarioFactory","coreSettings"])}async execute(e){const{criticalDynamicImports:t,loggerFactory:n,scenarioFactory:i,coreSettings:a}=e;if(!t||0===t.length)return;const o=a?.get(b.J.Core).enableSerializeChunkImport;o?await Promise.all(t.map((e=>(0,ac.mT)(e.importFunc,e.chunkName,i)))).catch((e=>{n.newLogger("FetchCriticalDynamicImportsTask","core-services-tasks").errorToTelemetry?.(`Failed to preload chunk this will regress performance of first load: ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)})):t.forEach((({importFunc:e,chunkName:t})=>{(0,ac.mT)(e,t,i).catch((e=>n.newLogger("FetchCriticalDynamicImportsTask","core-services-tasks").errorToTelemetry?.(`Failed to preload chunk ${t} this will regress performance of first load: ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)))}))}}class Ix extends _e{constructor(){super(h.Yg.InitApiServiceProvider,["coreSettingsContext"])}async execute(e){await e.coreSettingsContext.initializeApiServiceProvider()}}class Nx extends _e{constructor(){super(h.Yg.InitAsyncMediaAuthService,["mediaAuthService"])}async execute(e){const{mediaAuthService:t}=e;return t?.initAsyncMediaAuthService(),async e=>{"signout"===e&&await(t?.logout())}}}var Ex=n(342079);class Ax extends _e{constructor(){super(h.Yg.InitATPPolicyTask,["coreSettings","endpointsManager","gtmRegistry","localStorage","loggerFactory","scenarioFactory"])}async execute(e){const{coreSettings:t,endpointsManager:n,gtmRegistry:i,localStorage:a,loggerFactory:o,scenarioFactory:r}=e,{enableFastSharepointSafelinks:s}=t.get(b.J.Messaging),l=o.newLogger("InitATPPolicyTask","core-services-tasks");if(!s?.enabled)return void l.log("InitATPPolicyTask - Do nothing, FF is disabled");const c=new Ex.c(i.bind(cl.l,"middleTier"),r,o,a,t,n);l.log("Getting ATP Safelinks policy"),c.initPolicy()}}const _x={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"removeAuthenticatedUser"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}}}]}]}}]};let Fx;class Dx{constructor(e,t,n,i,a,o,r,s){this._auth=e,this._client=t,this._discover=n,this._networkStateProvider=i,this._windowProvider=o,this._keepTokenActive=!1,this._keepCheckingSignInRestrictions=!1,this._isLoginRequired=void 0,this._tokenIntervalId=void 0,this._logger=r.newLogger("AuthTokenStoreService","core-services-auth-token-store"),this._mtResourceKey=s?.get(b.J.Auth)?.mtResource||gi.ej.MT_AAD_KEY,this._tokenWarmingIntervalInMs=s?.get(b.J.Auth)?.tokenWarmingIntervalInMs||bl.lP.MT_TOKEN_INTERVAL,this._disableTokenWarmingForSigninRestriction=s?.get(b.J.Auth)?.disableTokenWarmingForSigninRestriction||!1,this._subscriptions=new Map,this.observeIsLoginRequired(),this.observeAppOnlineState()}observe(e){let t=this._subscriptions.get(e);return t||(t=this.createSubscription(e),this._subscriptions.set(e,t)),t}createSubscription(e){let t;switch(e){case gi.ej.MT_KEY:this._keepTokenActive=!0,t=this._auth.observeMiddleTierToken(),this.keepTokenActive();break;case gi.ej.SIGNIN_RESTRICTIONS_KEY:this._keepCheckingSignInRestrictions=!0,this.keepTokenActive();break;default:this._logger.error("Unable to create subscription, token key %s is not supported",e)}return t}keepTokenActive(){this._tokenIntervalId||(this._keepTokenActive||this._keepCheckingSignInRestrictions)&&(this._tokenIntervalId=this._windowProvider.setInterval((()=>{if(this._keepCheckingSignInRestrictions&&this._disableTokenWarmingForSigninRestriction){let e=(0,vl.pW)();e=`sign${e.substr(gi.uI.FOUR)}`,this._auth.acquireToken(gi.ej.SIGNIN_RESTRICTIONS_KEY,{correlationId:e}).catch((e=>{this.handleSignInRestrictionsError(e)}))}this._keepTokenActive&&this._auth.acquireToken(this._mtResourceKey).then((()=>this._discover.validateSkypeToken())).catch((e=>{this._logger.error("Error occurred in keeping MT token active.",e)}))}),this._tokenWarmingIntervalInMs))}handleSignInRestrictionsError(e){if(this._logger.error(`Error occurred in keeping SignInRestrictions token active. ErrorCode: ${e?.errorCode}`,e),e?.errorCode===gi.SM.SignInRestrictions){this._logger.error("Sign in restrictions was enabled and caught by the periodic check. Forcibly signing out the user");const e={id:(0,vl.pW)(),source:"auth-token-store",scenarioName:H.RG.AuthWebLogout},[t,n]=(0,yl.OU)({options:{correlation:e},scenarioName:e.scenarioName,source:e.source,subContext:"auth-token-store::handleSignInRestrictionsError"});t.appendScenarioEventData({operationType:gi.SM.SignInRestrictions}),this._client.mutate({mutation:_x,variables:{reason:gi.SM.SignInRestrictions},context:{correlation:e}}),n()}else this._logger.error("Sign in restrictions token acquisition threw an unexpected error",e)}observeIsLoginRequired(){this._auth.isLoginRequired.subscribe((e=>{if(this._isLoginRequired===e)return;const t=void 0===this._isLoginRequired;this._isLoginRequired=e,t||(this._isLoginRequired?this._tokenIntervalId&&(this._windowProvider.clearInterval(this._tokenIntervalId),this._tokenIntervalId=void 0):this.replayKeepTokenActiveState())}))}observeAppOnlineState(){this._networkStateProvider.observeIsOnline().subscribe((e=>{e?this.replayKeepTokenActiveState():this._tokenIntervalId&&(this._windowProvider.clearInterval(this._tokenIntervalId),this._tokenIntervalId=void 0)}))}replayKeepTokenActiveState(){if(0===this._subscriptions.size)return;const e=this._subscriptions.keys();let t=e.next();for(;!t.done;)this.keepTokenActive(),t=e.next()}}class Px extends _e{constructor(){super(h.Yg.InitAuthenticationService,[])}async execute(e){const{client:t,discover:n,authenticationUser:i,authenticationService:a,networkState:o,loggerFactory:r,coreSettings:s,scenarioFactory:l}=e,{enableSignInRestrictions:c,prefetchTokens:d,disableTokenWarming:u,enableTokenWarming:m,tokenWarmingResources:p}=s.get(b.J.Auth);if(!i)return;const g=((e,t,n,i,a,o,r)=>(Fx||(Fx=new Dx(n,e,t,i,a,(0,L.J)(),o,r)),Fx))(t,n,a,o,l,r,s);c&&g.observe(gi.ej.SIGNIN_RESTRICTIONS_KEY),!u&&g.observe(gi.ej.MT_KEY);const h=[];d?.forEach((e=>e&&h.push(e))),m&&p&&p.forEach((e=>{e&&h.indexOf(e)<0&&h.push(e)})),h.forEach((e=>a.acquireToken(e).catch((()=>{}))))}}class Mx{constructor(e,t,n){this.coreSettings=e,this.host=n,this.defaultScreenshotsTimeoutMs=5e3,this.brbServiceMap=new Map,this.brbExtendedServiceMap=new Map,this.rootToolsManagerMap=new Map,this.logger=t.newLogger("BrbServiceManager","core-services-brb")}registerRootToolsManager(e,t){t.setBRBCallback(this.onBrbRequested(e)),this.rootToolsManagerMap.set(e,t)}registerUserBrbExtendedFeedbackProvider(e,t){this.logger.logNoPii?.("Registering a new BRB extended feedback provider for account");const n=this.getOrCreateUserBrbExtendedFeedbackProviderSet(e);n.add(t),this.brbExtendedServiceMap.set(e,n)}unregisterUserBrbExtendedFeedbackProvider(e){return this.logger.logNoPii?.("Unregistering an existing BRB service for account"),this.brbExtendedServiceMap.delete(e)}registerUserBrbService(e,t){this.logger.logNoPii?.("Registering a new BRB service for account"),this.brbServiceMap.set(e,t)}unregisterUserBrbService(e){return this.logger.logNoPii?.("Unregistering an existing BRB service for account"),this.rootToolsManagerMap.delete(e),this.brbServiceMap.delete(e)}async getBrbFormData(e){const{categories:t,categoriesInCallingScreen:n,disclaimer:i}=this.coreSettings.get(b.J.Brb),a="callingScreen"===e?n:t,o=[];return a?.forEach((e=>{e&&o.push({id:e.id,name:e.name})})),this.logger.logNoPii?.("Returning data for BRB form",o),{disclaimer:i||h.bA,categories:o}}async getBrbScreenshots(e,t){const n=this.getOrCreateUserBrbService(e);if(n){const{screenshotsTimeoutMs:e}=this.coreSettings.get(b.J.Brb,["screenshotsTimeoutMs"]);let i=0;const a=new Promise((t=>{i=this.host.setTimeout((()=>{this.logger.logNoPii?.("Screenshots timeout. Returning undefined for BRB screenshots."),i=0,t(void 0)}),e??this.defaultScreenshotsTimeoutMs)})),o=n.getBrbScreenshots(t).then((e=>(this.logger.logNoPii?.(`Screenshots received: ${e?.length}`),e)));return Promise.race([o,a]).then((e=>(i&&this.host.clearTimeout(i),e)))}return Promise.resolve(void 0)}async createBrbItem(e,t,n){const i=this.getOrCreateUserBrbService(e),a=await(i?.createBrbItem(t,n)||void 0);if(!a)return a;const{enableMTMA:o}=this.coreSettings.get(b.J.Core);if(o){Array.from(this.brbServiceMap.keys()).filter((t=>t!==e)).forEach((e=>{const i=this.getOrCreateUserBrbService(e);i?.extendBrbReports(t,a,n)}))}const r=this.getOrCreateUserBrbExtendedFeedbackProviderSet(e);if(i&&r){const e=await i.getSystemInfo();r.forEach((n=>n.extendedBrbFeedback(t,a,e)))}return a}async createAutoBrbItem(e,t){return await this.createBrbItem(e,t,!0)}onBrbRequested(e){return t=>{this.logger.log(`onBrbRequested called >>> event ${t.uploadId}`);const n={categoryId:"11",text:"Extend report",includeHeapSnapshot:!1};if(e){const i=this.getOrCreateUserBrbService(e);i?(i?.extendBrbReports(n,{containerId:t.uploadId}),this.logger.log("setBRBCallback >>> called extendBrbReports")):this.logger.warn("setBRBCallback >>> could not call extendBrbReports brbService undefined")}else this.logger.warn(`setBRBCallback >>> userKey is null uploadId: ${t.uploadId}`)}}getOrCreateUserBrbExtendedFeedbackProviderSet(e){return this.brbExtendedServiceMap.get(e)??new Set}getOrCreateUserBrbService(e){const t=this.brbServiceMap.get(e);if(!(t&&t instanceof Function))return this.logger.logNoPii?.(`Found existing BRB service for account ${e}`),t;this.logger.logNoPii?.(`Creating BRB service for account ${e}`);try{const n=t(),i=this.rootToolsManagerMap.get(e);return i&&n.registerRootToolsManager(i),this.brbServiceMap.set(e,n),n}catch(t){return void this.logger.logNoPii?.(`Failed to create BRB service for account ${e}`)}}}class xx extends _e{constructor(){super(h.Yg.InitBrbServiceManagerTask,["coreSettings","loggerFactory","windowProvider"])}async execute(e){const{coreSettings:t,loggerFactory:n,windowProvider:i}=e;e.brbServiceManager=new Mx(t,n,i)}}var Rx=n(460053),jx=n(571848),Lx=n(861914);class Ox{constructor(e,t,n,i,a,o,r,s){this.coreSettings=e,this.useAccessCheckV2=n,this.hostComm=i,this.scenarioFactory=a,this.appSwitcherPolicyCheckService=o,this.authenticationService=r,this.rebootService=s,this.logger=t.newLogger("ClientAccessAdminPolicyCheckService","services-utilities-core"),this.useAccessCheckV2=n}async isUserAllowed(){this.logger.log("isUserAllowed::start");let e=!1;const{useNewTeamsClient:t}=this.coreSettings.get(b.J.Core,["useNewTeamsClient"]),{appswitcherStartTACPolicyExpiration:n}=this.coreSettings.get(b.J.Core,["appswitcherStartTACPolicyExpiration"]);if(n){const e=await this.appSwitcherPolicyCheckService.getAppSwitcherEffectivePolicy().pipe((0,VP.q)(1)).toPromise();if(e!==Rx.m7.ADMIN_DISABLED)return this.logger.log(`isUserAllowed: returned true due to appSwitcherEffectivePolicy=${e}\n          policyExpiration=${this.appSwitcherPolicyCheckService.policyExpirationType}`),!0}switch(this.logger.log(`isUserAllowed: useNewTeamsClient: ${t}`),t){case"AdminDisabled":e=!1;break;case"MicrosoftChoice":this.useAccessCheckV2&&(e=await this.isUserAllowedV2()),e||(e=this.isUserAllowedViaAppSwitcher());break;default:e=!0}return this.logger.log(`isUserAllowed: returned ${e}`),e}async makeT1Default(){const{disableT1Trampoline:e}=this.coreSettings.get(b.J.Core,["disableT1Trampoline"]);if(e)return void this.logger.log("makeT1Default: skipped, disableT1Trampoline is true");if(!this.hostComm)return void this.logger.log("makeT1Default: skipped, invalid hostcomm");const t=await this.hostComm.loadModule("appswitcher");if(!t||!t.getPearInstallState||!t.switchDefaultAppTo)return void this.logger.log("makeT1Default: skipped, invalid appSwitcherModule");const n=await t.getPearInstallState();n===ti.Jv.InstalledNotActive?(await t.switchDefaultAppTo(ti.OP.Teams1),this.logger.log("makeT1Default: successfully switched default app to T1")):this.logger.log(`makeT1Default: skipped, pearInstallState = ${n}`)}rebootOnPolicyChangeToAdminDisabled(){this.logger.log("Will observe changes to useNewTeamsClient policy");const e=this.scenarioFactory.newScenario(H.RG.AppSwitcherObserveUseNewTeamsPolicy),t=this.coreSettings.getObservable(b.J.Core,["useNewTeamsClient"]).pipe((0,m.h)((({useNewTeamsClient:e})=>void 0!==e))).subscribe((async({useNewTeamsClient:n})=>{e.stop({reason:`initial_value_${n}`}),t.unsubscribe(),this.logger.log("Stopped observing changes to useNewTeamsClient policy"),"AdminDisabled"!==n||await this.isUserAllowed()||(this.logger.log("useNewTeamsClient policy changed to AdminDisabled, user is no longer allowed, rebooting"),this.rebootService.rebootApp(Dr.Z.ClientAccessPolicyAdminDisabled,Dr.d.ClientAccessAdminPolicyCheckService))}))}async rebootIfUserBecomesAllowedLater(){if(await this.isUserAllowed())return void this.logger.error("rebootIfUserBecomesAllowedLater: user is already allowed. Skipped.");const{useNewTeamsClient:e}=this.coreSettings.get(b.J.Core,["useNewTeamsClient"]);if("AdminDisabled"!==e)return;const t=this.coreSettings.getObservable(b.J.Core,["useNewTeamsClient","appswitcherStartTACPolicyExpiration","cohortBasedPolicyExpirySetting"]).subscribe((async({useNewTeamsClient:e,appswitcherStartTACPolicyExpiration:n,cohortBasedPolicyExpirySetting:i})=>{this.logger.log(`Checking if user is now allowed. Observed\n              useNewTeamsClient:${e};\n              appswitcherStartTACPolicyExpiration=${n};\n              cohortBasedPolicyExpirySetting=${i}`);await this.isUserAllowed()&&(this.logger.log("User is now allowed to use T2.1, rebooting to enable T2.1"),t.unsubscribe(),this.rebootService.rebootApp(Dr.Z.ClientAccessPolicyUserAllowed,Dr.d.ClientAccessAdminPolicyCheckService))}))}shouldUserAttemptT1Cleanup(){return(0,jx.aj)([this.appSwitcherPolicyCheckService?.getAppSwitcherEffectivePolicy(),this.coreSettings.getObservable(b.J.Core,["forceEnableT1Cleanup","disableAppSwitcherWin10TFLCheck","forceAppSwitcherWin10MSACheck","t1UninstallDelayTimeInDays","enableT1UninstallDelay"]),this.coreSettings.getObservable(b.J.Platform,["deviceInfo"]),this.coreSettings.getObservable(b.J.HostCapabilities,["t1InstallPresent"])]).pipe((0,mt.w)((async([e,t,n,i])=>{const{forceEnableT1Cleanup:a,disableAppSwitcherWin10TFLCheck:o,forceAppSwitcherWin10MSACheck:r,t1UninstallDelayTimeInDays:s,enableT1UninstallDelay:l}=t,{deviceInfo:c}=n,{t1InstallPresent:d}=i;return!(!e&&void 0===a)&&this.shouldUserAttemptT1CleanupInternal(e,!!d,!!a,!!r,!!o,s??void 0,!!l,c??void 0,this.appSwitcherPolicyCheckService)})))}async shouldUserAttemptT1CleanupInternal(e,t,n,i,a,o,r,s,l){this.logger.log("shouldUserAttemptT1Cleanup::start");const c=this.scenarioFactory.newScenario(H.RG.AppSwitcherCheckT1CleanupPolicy);if(n)return c.stop({reason:"force_enable"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: T1 was force uninstalled."),!0;if(this.logger.log(`shouldUserAttemptT1Cleanup: got appSwitcherEffectivePolicy=${e}`),e?.toLocaleUpperCase()===Rx.m7.T21_ONLY){if(!t)return this.logger.log("shouldUserAttemptT1Cleanup: T1 install not present, skipping uninstall"),c.cancel({reason:"t1_not_present"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: T1 is not present."),!1;if(!this.isT1UninstallDelayTimeReached(o,r,l,c))return c.cancel({reason:"t1_uninstall_delay_time_not_reached"}),this.logger.log("shouldUserAttemptT1Cleanup: T1 uninstall delay time not reached, skipping"),!1;const e=!s||!(0,Lx.E)(s)||i;return a?e?(this.logger.log("shouldUserAttemptT1Cleanup: OS version < Win11, skipping uninstall"),c.cancel({reason:"win10_cleanup_disabled"}),!1):(c.stop(),l.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: Delay time met and shouldUserAttemptT1CleanupInternal returning true."),!0):await this.isMSAHostedOnMachine()&&e?(this.logger.log("shouldUserAttemptT1Cleanup: T1 hosting MSA, skipping uninstall"),c.cancel({reason:"win10_msa_acct_detected"}),!1):(this.logger.log("shouldUserAttemptT1Cleanup: Starting T1 uninstall"),c.stop(),l.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: Delay time met and shouldUserAttemptT1CleanupInternal returning true."),!0)}return c.cancel({reason:"invalid_policy"}),this.appSwitcherPolicyCheckService.removeNewTeamsOnlyEffectivePolicyStartTime(),this.logger.log("Removed newTeamsOnlyEffectivePolicyStartTime from local storage. Reason: Effective policy is not T21_ONLY."),!1}isUserAllowedViaAppSwitcher(){const{installedThroughAppSwitcher:e}=this.coreSettings.get(b.J.Host,["installedThroughAppSwitcher"]);return this.logger.log(`isUserAllowedViaAppSwitcher: installedThroughAppSwitcher: ${e}`),!!e}async isUserAllowedV2(){const{allowUserOnMicrosoftChoice:e}=this.coreSettings.get(b.J.Core,["allowUserOnMicrosoftChoice"]);if(!e)return this.logger.log("isUserAllowedV2: returned false due to allowUserOnMicrosoftChoice=false"),!1;const{disableEduCheckOnMicrosoftChoice:t}=this.coreSettings.get(b.J.Core,["disableEduCheckOnMicrosoftChoice"]);if(!t&&this.isEdu())return this.logger.log(`isUserAllowedV2: returned false due to EDU, disableEduCheckOnMicrosoftChoice=${t}`),!1;const{disableVdiCheckOnMicrosoftChoice:n}=this.coreSettings.get(b.J.Core,["disableVdiCheckOnMicrosoftChoice"]);return!n&&await this.isVdi()?(this.logger.log(`isUserAllowedV2: returned false due to VDI, disableVdiCheckOnMicrosoftChoice=${n}`),!1):(this.logger.log("isUserAllowedV2: returned true due to allowUserOnMicrosoftChoice=true"),!0)}async isVdi(){if(!this.hostComm)return this.logger.warn("isVdi: returned false - invalid hostComm"),!1;const e=await this.hostComm.loadModule("vdi");if(!e||!e.isVDI)return this.logger.warn(`isVdi: returned false - invalid VDI function, vdiModule=${!!e}`),!1;const t=await e.isVDI();return this.logger.log(`isVdi: returned ${t}`),t}isEdu(){const{licenseType:e}=this.coreSettings.get(b.J.UserResources);return this.logger.log(`isEdu: licenseType=${e}`),!(!e||"Student"!==e&&"Teacher"!==e)}async isMSAHostedOnMachine(){return(await(this.authenticationService.getHostMachineUsers?.(""))??[]).filter((e=>"MsaLife"===e.accountType)).length>0}isT1UninstallDelayTimeReached(e,t,n,i){if(t){const t=new Date,a=n.getNewTeamsOnlyEffectivePolicyStartTime();if(!a){const e=n.setNewTeamsOnlyEffectivePolicyStartTime(t.toISOString());this.logger.log(`shouldUserAttemptT1Cleanup: starting T1 uninstall delay timer was successful: ${e}`);const a={startTime:t.toISOString()};return i.mark(H.ck.NewTeamsOnlyEffectivePolicyStartTimeSet,a),!1}const o=new Date(a),r=(t.getTime()-o.getTime())/864e5;this.logger.log(`shouldUserAttemptT1Cleanup: timer start: ${a}, T1 uninstall delay time in days: ${r}`);const s={startTime:a,currentTime:t.toISOString()};return e&&r>=e?(this.logger.log("shouldUserAttemptT1Cleanup: T1 uninstall delay time reached, uninstalling T1"),i.mark(H.ck.T1UninstallDelayTimeReached,s),!0):(i.mark(H.ck.T1UninstallDelayTimeNotReached,s),!1)}return!0}}class $x extends _e{constructor(){super(h.Yg.InitClientAccessAdminPolicyCheck,["appSwitcherPolicyCheckService","coreSettings","coreSettingsContext","hostCommunicationService","loggerFactory","rebootService","scenarioFactory","authenticationService","windowProvider"])}async execute(e){const{appSwitcherPolicyCheckService:t,coreSettings:n,coreSettingsContext:i,hostCommunicationService:a,loggerFactory:o,rebootService:r,scenarioFactory:s,authenticationService:l,windowProvider:c}=e,d=o.newLogger("InitClientAccessAdminPolicyCheckTask","core-services-tasks"),{disableAppSwitcherTACSettingsSyncForNonHomeAccount:u,enableAppSwitcherTACSettingsSync:m,enableAppSwitcherTACSettingsSyncV2:p}=n.get(b.J.Core,["disableAppSwitcherTACSettingsSyncForNonHomeAccount","enableAppSwitcherTACSettingsSync","enableAppSwitcherTACSettingsSyncV2"]);if(!m&&!p)return void d.log("Both enableAppSwitcherTACSettingsSync and enableAppSwitcherTACSettingsSyncV2 are false, skipping ClientAccessAdminPolicyCheckService initialization.");if(u){const e=await l.getUser();if(e?.id&&e.id!==e.homeAccountId)return void d.log("The primary account is not home account, skipping ClientAccessAdminPolicyCheckService initialization.")}const g=new Ox(n,o,!!p,a,s,t,l,r);e.clientAccessAdminPolicyCheckService=g;try{await async function(e,t,n,i){const{enableLeakedPolicyCleanup:a}=e.get(b.J.Core,["enableLeakedPolicyCleanup"]);if(!a)return;const o=await t.getUser();if(o?.id&&o.id.length>0)return;const r=n.localStorage.getItem("tmp.policy-cache");if(!r||""===r)return;n.localStorage.removeItem(Ux),i.rebootApp(Dr.Z.ClientAccessLeakedPolicyCleanup,Dr.d.ClientAccessAdminPolicyCheckService)}(n,l,c,r)}catch{d.error("Failed to clean leaked teams update policy from local storage in a signed-out session.")}const{shouldRebootOnPolicyChangeToAdminDisabled:h}=n.get(b.J.Core,["shouldRebootOnPolicyChangeToAdminDisabled"]);if(h&&!i.getInitialStateHints().primaryUserHadPolicyCache&&g.rebootOnPolicyChangeToAdminDisabled(),!await g.isUserAllowed())throw await g.makeT1Default(),g.rebootIfUserBecomesAllowedLater(),await i.fetchEcsSettingsIfApplicable(),new Me.G(Me.$.DISABLED_BY_ADMIN)}}const Ux="tmp.policy-cache";class Bx{constructor(e,t,n,i,a){this.coreSettings=e,this.scenarioFactory=n,this.localStorage=i,this.userBiService=a,this.policyExpirationType=Rx.NU.NONE,this.policyExpirationStage=void 0,this.logger=t.newLogger("AppSwitcherPolicyCheckService","services-utilities-core")}getAppSwitcherEffectivePolicy(){return(0,jx.aj)([this.coreSettings.getObservable(b.J.Core,["useNewTeamsClient","enableT1AppSwitcherEffectivePolicyFetch","appSwitcherCohortSettings","appSwitcherDebugEffectivePolicy","appswitcherExpireTACPolicy","appswitcherExpiredPolicyNoCohortStage","cohortBasedPolicyExpirySetting","appswitcherStartTACPolicyExpiration"]),this.coreSettings.getObservable(b.J.HostCapabilities,["t1AppSwitcherEffectivePolicy"]),this.getAppSwitcherCohort()]).pipe((0,d.U)((([e,t,n])=>{const i=this.scenarioFactory.newScenario(H.RG.AppSwitcherIdentifyPolicy),{useNewTeamsClient:a,enableT1AppSwitcherEffectivePolicyFetch:o,appSwitcherCohortSettings:r,appSwitcherDebugEffectivePolicy:s,appswitcherExpireTACPolicy:l,appswitcherExpiredPolicyNoCohortStage:c,cohortBasedPolicyExpirySetting:d,appswitcherStartTACPolicyExpiration:u}=e,{t1AppSwitcherEffectivePolicy:m}=t;if(s)return i.stop({policy:s,reason:"DebugForced"}),s;if(u){i.mark("appswitcher_tac_policy_expiration_started");const e=this.scenarioFactory.newScenario(H.RG.AppSwitcherPolicyExpiration),t=this.getStageForExpiredPolicy(l??void 0,d??void 0,n,a??"microsoftchoice",c??void 0,e);if(e.mark(H.ck.AppSwitcherPolicyExpirationType,{cohort:n,policyExpirationType:this.policyExpirationType,rolloutStage:t}),this.logger.log(`appswitcher_policy_expiration: cohort=${n}\n            policyExpirationType=${this.policyExpirationType} \n            rolloutStage=${t}`),t){e.stop({cohort:n,policyExpirationType:this.policyExpirationType,rolloutStage:t});const i=this.userBiService.createDatabag?.();return i&&(i.policyExpiredStageSetByMSFT=this.policyExpirationStage,i.policyExpirationStategy=this.policyExpirationType),this.userBiService.recordPanelAction({actionScenario:dA.Tk.AppSwitcherPolicyExpiration,moduleName:dA.rA.AppSwitcherPolicyExpiration,dataBag:i}),i?.dispose(),t}}let p;if(a)switch(a){case"UserChoice":p=Rx.m7.USER_CHOICE;break;case"AdminDisabled":p=Rx.m7.ADMIN_DISABLED;break;case"NewTeamsAsDefault":p=Rx.m7.T21_DEFAULT;break;case"NewTeamsOnly":p=Rx.m7.T21_ONLY;break;case"MicrosoftChoice":p=this.getMicrosoftChoicePolicyForUser(n,r??void 0,!!o,m??"",i);break;default:p=Rx.m7.T1_DEFAULT}return i.stop({policy:p,cohort:n,t1Cohort:m??"",adminPolicy:a??void 0}),this.logger.log(`getAppSwitcherEffectivePolicy: useNewTeamsClient=${a} cohort=${n} policy=${p}`),p})))}getAppSwitcherCohort(){return(0,jx.aj)([this.coreSettings.getObservable(b.J.HostCapabilities,["officeUpdateRegKey"]),this.coreSettings.getObservable(b.J.Metadata,["ring"]),this.coreSettings.getObservable(b.J.UserResources,["licenseType"]),this.coreSettings.getObservable(b.J.Platform,["deviceInfo"]),this.coreSettings.getObservable(b.J.Host,["authBootstrapData"])]).pipe((0,d.U)((([e,t,n,i,a])=>{const o=this.scenarioFactory.newScenario(H.RG.AppSwitcherIdentifyCohort),r=this.getAppSwitcherCohortFromSettings(o,n.licenseType,a.authBootstrapData?.licenseDetails,e,i,t.ring);return o.stop({reason:"FromSettings",cohort:r}),r})))}setNewTeamsOnlyEffectivePolicyStartTime(e){return this.userBiService.recordPanelAction({panelType:dA.wh.OpenApplication,actionScenario:dA.Tk.UninstallT1AppTimerStarted,actionGesture:"auto"}),this.localStorage.trySet("newTeamsOnlyEffectivePolicyStartTime",e,"Framework","UserAndExperience")}getNewTeamsOnlyEffectivePolicyStartTime(){const e=this.localStorage.get("newTeamsOnlyEffectivePolicyStartTime","UserAndExperience");return e||void 0}removeNewTeamsOnlyEffectivePolicyStartTime(){this.userBiService.recordPanelAction({panelType:dA.wh.OpenApplication,actionScenario:dA.Tk.UninstallT1AppTimerRemoved,actionGesture:"auto"}),this.localStorage.remove("newTeamsOnlyEffectivePolicyStartTime","UserAndExperience")}getMicrosoftChoicePolicyForUser(e,t,n,i,a){let o;return this.logger.log(`getMicrosoftChoicePolicyForUser: cohort=${e} enableT1AppswitcherEffectivePolicyFetch=${n} t1AppSwitcherEffectivePolicyHint=${i}`),t&&(o=this.getCohortPolicyFromECS(e,t),o)?(a.appendEventData({reason:"FromSettings"}),o.toLocaleUpperCase()):!o&&i&&n?(a.appendEventData({reason:"T1Hint"}),i.toLocaleUpperCase()):void 0}getCohortPolicyFromECS(e,t){let n;switch(e){case Rx.bi.M365BusinessLicenseCohort:n=t?.M365BusinessLicenseCohort;break;case Rx.bi.EarlyEnterpriseCohort:n=t?.EarlyEnterpriseCohort;break;case Rx.bi.MidEnterpriseCohort:n=t?.MidEnterpriseCohort;break;case Rx.bi.AdminsOfLateEnterpriseCohort:n=t?.AdminsOfLateEnterpriseCohort;break;case Rx.bi.GovCloudCohort:n=t?.GovCloudCohort;break;case Rx.bi.LateEnterpriseCohort:n=t?.LateEnterpriseCohort;break;case Rx.bi.MacR36Cohort:n=t?.MacR36Cohort;break;case Rx.bi.MacR4Cohort:n=t?.MacR4Cohort;break;case Rx.bi.EduCohort:n=t?.EduCohort;break;case Rx.bi.InternalRingCohort:n=t?.InternalRingCohort;break;case Rx.bi.ExternalTapCohort:n=t?.ExternalTapCohort;break;case Rx.bi.NoPPChannelCohort:n=t?.NoPPChannelCohort}return n??void 0}getStageForExpiredPolicy(e,t,n,i,a,o){let r;if(e)return this.policyExpirationType=Rx.NU.ALL_UP_POLICY_EXPIRATION,this.policyExpirationStage=e,o.mark(H.ck.AppSwitcherPolicyExpirationType,{policyExpirationType:Rx.NU.ALL_UP_POLICY_EXPIRATION,rolloutStage:r}),r=e,r;if(n){if(t){const e=t[n.toLocaleLowerCase()];if(e){if(r=e.setentirecohortto,r)return this.policyExpirationType=Rx.NU.COHORT_BASED_EXPIRATION,this.policyExpirationStage=r,o.mark(H.ck.AppSwitcherPolicyExpirationType,{policyExpirationType:Rx.NU.COHORT_BASED_EXPIRATION,rolloutStage:r}),r;if(r=e[i.toLocaleLowerCase()],r)return this.policyExpirationType=Rx.NU.COHORT_AND_TAC_BASED_EXPIRATION,this.policyExpirationStage=r,o.mark(H.ck.AppSwitcherPolicyExpirationType,{policyExpirationType:Rx.NU.COHORT_AND_TAC_BASED_EXPIRATION,rolloutStage:r}),r}}}else if(a)return this.policyExpirationType=Rx.NU.NO_COHORT_BASED_EXPIRATION,r=a,this.policyExpirationStage=r,o.mark(H.ck.AppSwitcherPolicyExpirationType,{policyExpirationType:Rx.NU.NO_COHORT_BASED_EXPIRATION,rolloutStage:r}),r;return r}getAppSwitcherCohortFromSettings(e,t,n,i,a,o){const r=o?.id?.toLocaleLowerCase()||"",s=i?.officeUpdateRegKey||"";if("Student"===t||"Teacher"===t)return e.appendEventData({licenseType:t}),Rx.bi.EduCohort;const{clientPreviewOptOutStrategy:l}=this.coreSettings.get(b.J.Core,["clientPreviewOptOutStrategy"]);if("Web"===l)return Rx.bi.WebCohort;if(["gcc","gcch","dod","ag08","ag09","gallatin"].includes(r))return Rx.bi.GovCloudCohort;if("macOS"===a?.deviceInfo?.osName){if("ring3_6"===r)return Rx.bi.MacR36Cohort;if("general"===r)return Rx.bi.MacR4Cohort}return Bx.internalRings.includes(r)?Rx.bi.InternalRingCohort:"ring3_6"===r?Rx.bi.ExternalTapCohort:(e.appendEventData({officeUpdateRegkey:s}),"production::mec"===s?Rx.bi.MidEnterpriseCohort:"insiders::frdc"===s?Rx.bi.AdminsOfLateEnterpriseCohort:"production::cc"!==s||n?.appSwitcherBusinessLicenseCategory?Object.values(Rx.GO).includes(n?.appSwitcherBusinessLicenseCategory)?(e.appendEventData({businessLicenseCategory:n?.appSwitcherBusinessLicenseCategory||""}),Rx.bi.M365BusinessLicenseCohort):s?Rx.bi.LateEnterpriseCohort:Rx.bi.NoPPChannelCohort:Rx.bi.EarlyEnterpriseCohort)}}Bx.internalRings=["ring0","ring1","ring1_5","ring1_6","ring2","ring3","ring3_9"];class Wx extends _e{constructor(){super(h.Yg.InitAppSwitcherPolicyCheck,["coreSettings","loggerFactory","telemetryService","scenarioFactory","localStorage","userBiService"]),this._updateTelemetryOnPolicyStateChange=(e,t)=>{e.getAppSwitcherEffectivePolicy().subscribe((e=>{t.setCoreContext("appswitcherEffectivePolicy",e)}))}}async execute(e){const{coreSettings:t,loggerFactory:n,telemetryService:i,scenarioFactory:a,localStorage:o,userBiService:r}=e,s=n.newLogger("InitAppSwitcherPolicyCheckTask","core-services-tasks"),l=new Bx(t,n,a,o,r);s.log("AppSwitcherPolicyCheckService initialization done."),e.appSwitcherPolicyCheckService=l,this._updateTelemetryOnPolicyStateChange(l,i)}}class Hx extends _e{constructor(){super(h.Yg.InitDesktopEcsContext,["coreSettings","discover","hostCommunicationService","i18NextWrapper","loggerFactory","platformService","primaryUser"])}async execute(e){const{coreSettings:t,discover:n,hostCommunicationService:i,i18NextWrapper:a,loggerFactory:o,platformService:r,primaryUser:s}=e,l=await i.loadModule("ecs");if(l?.setEcsContext){const e=await this.getDesktopEcsFilters(t,n,a,o,r,s);l.setEcsContext(e)}}async getDesktopEcsFilters(e,t,n,i,a,o){const{ring:r,environment:s,countryCode:l}=e.get(b.J.Metadata),{enableLocaleFilterForFeatureFlags:c,disableRegionParamForMaglev:d,enableCountryFilterForFeatureFlags:u}=e.get(b.J.Core,["enableLocaleFilterForFeatureFlags","disableRegionParamForMaglev","enableCountryFilterForFeatureFlags"]);let m;if(!d)try{m=await t.getRegion({id:o.id,tenantId:o.profile.tenantId,oid:o.profile.objectId,accountType:o.type,userName:o.loginUserName||""})}catch(e){i.newLogger("InitDesktopEcsContextTask","core-services-tasks").errorToTelemetry?.("Failed to fetch region info from discover service.","webclient_framework_foundation_core_services_tasks",void 0,!0)}const{isInternalUser:p}=a.config,{originalRing:g}=a.ecsOverrides,h=c?n.locale:void 0,y=u?l:void 0;return s||i.newLogger("InitDesktopEcsContextTask","core-services-tasks").errorToTelemetry?.("Environment is undefined","webclient_framework_foundation_core_services_tasks",void 0,!0),{cloud:s||"",isInternalUser:p,locale:h,originalRing:g,region:m,countryCode:y||void 0,ring:r?.id||"general",tenantId:o.profile.tenantId,userId:o.profile.objectId}}}var Vx=n(583545);function Gx(e,t){return(n,i,a)=>{if(i>=Hs.qb.OK&&i<=Hs.qb.NOT_MODIFIED)return!1;const o=n<e&&i!==Hs.qb.BAD_REQUEST&&i!==Hs.qb.NOT_AUTHORIZED;return t.warn(`imageCookieRetryPolicy retry count ${n} responseCode ${i} canRetry ${o}`),o}}var zx=n(599134);function qx(e,t){return()=>({url:"v1/imageauth/cookie",method:"POST",headers:{"x-ms-client-caller":"imageAuthCookieSetupEM","x-ms-client-type":(0,zx.I)(e,t)},credentials:"include",apiName:"consumerGroupsImageAuthCookie"})}function Jx(e,t){const n=(0,Re.v4)();return()=>({url:"v1/imageauth/deletecookie",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded",RequestId:n,CorrelationId:n,TransactionId:n,"x-ms-client-type":(0,zx.I)(e,t)},credentials:"include",apiName:"consumerGroupsImageAuthCookie"})}const Qx="tfl_media_auth_cookie_service";class Kx{constructor(e,t,n,i,a,o,r,s,l){this._endpointsManager=t,this._platformService=n,this._authenticationService=i,this._networkState=a,this._coreSettings=o,this._authStateProvider=r,this._config=s,this._localStorage=l,this._imageAuthCookieExpiryTsKey="ConsumerGroupsImageAuthCookieExpiryTs",this._imageCookieRetryInterval=2e4,this._imageCookieRetryMaxCount=5,this._authStateSubscription=void 0,this._networkStateSubscription=void 0,this._isInitialized=!1,this._consumerGroupsImageAuthCookieExpiryTs=void 0,this.setupConsumerGroupsImageAuthCookieEndpoints=({discover:e,authenticationResources:t,authenticationService:n})=>({baseUrlPromise:()=>e.regionGtm("groupsServiceV2"),serviceName:zs.E.GroupsServiceV2,authResource:(0,Vx.Nc)(n,t,Vx.jP),models:{setupConsumerGroupsImageAuthCookie:this.setupConsumerGroupsImageAuthCookie(),deleteConsumerGroupsImageAuthCookie:this.deleteConsumerGroupsImageAuthCookie()}}),this._logger=e.newLogger("Consumer Groups media auth service","services-io-browser-consumer-groups-media-auth-service"),this._imageCookieRetryInterval=this._coreSettings.get(b.J.ConsumerGroups)?.imageCookieRetryInterval||2e4,this._imageCookieRetryMaxCount=this._coreSettings.get(b.J.ConsumerGroups)?.imageCookieRetryMaxCount||5,this._window=(0,L.J)(),this._consumerGroupsImageAuthCookieApi=this._endpointsManager.createApi(this.setupConsumerGroupsImageAuthCookieEndpoints)}async initConsumerGroupsMediaAuthService(){if(this._isInitialized)this.logToTelemetry("ConsumerGroupsMediaAuthService already initiated, skipping initialization");else{this.logToTelemetry("initiating ConsumerGroupsMediaAuthService");try{await this.fetchCookie("serviceInit"),this.subscribeToAuthStateChange(),this.subscribeToNetworkStateChange(),this.logToTelemetry("ConsumerGroupsMediaAuthService initiated"),this._isInitialized=!0}catch(e){this.logToTelemetry("failed to initiate ConsumerGroupsMediaAuthService",!0)}}}async logout(){this.cleanupCookieExpireInfo();try{await this._consumerGroupsImageAuthCookieApi.deleteConsumerGroupsImageAuthCookie(),this._authStateSubscription&&this._authStateSubscription.unsubscribe(),this._networkStateSubscription&&this._networkStateSubscription.unsubscribe(),this._cookieRefetchInterval&&this._window.clearTimeout(this._cookieRefetchInterval),this.logToTelemetry("deleted cookie on logout")}catch(e){this.logToTelemetry("failed to delete cookie on logout",!0)}}checkIsCookieExpired(){const{enableStoringExpireInfoOnConsumerGroupsMediaAuthServiceClass:e}=this._coreSettings.get(b.J.ConsumerGroups),t=e?this._consumerGroupsImageAuthCookieExpiryTs:this._localStorage?.get(this._imageAuthCookieExpiryTsKey,"Global");if(!t)return this.logToTelemetry("cookie not found"),!0;if(t){const e=1e3*Number(t);if(Date.now()>e)return this.logToTelemetry("cookie expired"),!0}return!1}async fetchCookie(e){if(!this.checkIsCookieExpired())return void this.logToTelemetry(`cookie not expired, skipping fetchCookie for ${e}`);const t=await this.getAuthToken();try{t&&t?.expires&&(await this._consumerGroupsImageAuthCookieApi.setupConsumerGroupsImageAuthCookie(),await this.storeCookieExpireInfo(t.expires),this._consumerGroupsImageAuthCookieExpiryTs=t.expires,this.handleCookieRefetchInterval(t.expires),this.logToTelemetry(`setupConsumerGroupsImageAuthCookie successful for ${e}`))}catch(t){this.logToTelemetry(`setupConsumerGroupsImageAuthCookie error for ${e}`,!0)}}getImageCookieRetryPolicy(){return{shouldRetry:Gx(this._imageCookieRetryMaxCount,this._logger),nextDelay:(e=this._imageCookieRetryInterval,t=>e*Math.pow(2,t))};var e}storeCookieExpireInfo(e){this._localStorage?.set(this._imageAuthCookieExpiryTsKey,`${e}`,"Auth","Global"),this.logToTelemetry("consumer groups cookie expire info stored in local storage succesfully")}handleCookieRefetchInterval(e){this._cookieRefetchInterval&&(this.logToTelemetry(`clearing previous cookie refetch interval: ${this._cookieRefetchInterval}`),this._window.clearTimeout(this._cookieRefetchInterval)),this.logToTelemetry(`setting cookie refetch interval at: ${e}`),this._cookieRefetchInterval=this._window.setTimeout((()=>this.fetchCookie("cookieRefetchInterval")),function(e){const t=1e3*e-Date.now();return Math.max(t,6e4)}(e))}async getAuthToken(){const{enableStoringErrorInfoForAuthToken:e}=this._coreSettings.get(b.J.ConsumerGroups);try{if("function"==typeof this._authenticationService?.acquireTokenV2){const e=await this._authenticationService.acquireTokenV2(Vx.jP);return this.logToTelemetry("getAuthToken successful"),e}return void this.logToTelemetry("getAuthToken failed due to missing acquireTokenV2 method")}catch(t){return void(e?this.logToTelemetry(`failed to get auth Token with error ${t.message}`,!0,t.message):this.logToTelemetry("failed to get auth Token",!0))}}cleanupCookieExpireInfo(){this._localStorage?.remove(this._imageAuthCookieExpiryTsKey,"Global")}logToTelemetry(e,t,n){t?this._logger.errorToTelemetry?.(e,Qx,n?{errors:n}:void 0,!0):this._logger.infoToTelemetry?.(e,Qx,void 0,!0)}subscribeToNetworkStateChange(){this._networkStateSubscription=this._networkState.observeIsOnline().pipe((0,Es.x)(),(0,m.h)((e=>!!e))).subscribe((async()=>{this.logToTelemetry("network state changed to online, checking cookie"),await this.fetchCookie("networkStateChange")}))}subscribeToAuthStateChange(){this._authStateProvider?this._authStateSubscription=this._authStateProvider?.observe().pipe((0,Es.x)(),(0,m.h)((e=>e.state===hl.j.Up))).subscribe((()=>{this.logToTelemetry("Auth state back Up, checking cookie"),this.fetchCookie("authStateChange")})):this.logToTelemetry("authStateProvider is not available",!0)}deleteConsumerGroupsImageAuthCookie(){return Promise.resolve({constructRequest:Jx(this._platformService,this._config),allowedResponses:[Hs.qj.HTTP_2XX]})}setupConsumerGroupsImageAuthCookie(){return Promise.resolve({constructRequest:qx(this._platformService,this._config),allowedResponses:[Hs.qj.HTTP_2XX],retryPolicy:this.getImageCookieRetryPolicy()})}}class Yx extends _e{constructor(){super(h.Yg.InitConsumerGroupsMediaAuthTask,["authStateProvider","authenticationService","config","coreSettings","endpointsManager","localStorage","loggerFactory","networkState","platformService"])}async execute(e){const t=e.coreSettings?.get(b.J.ConsumerGroups);if(!t?.useGroupsProfilePicCookieService)return;const n=function(e,t,n,i,a,o,r,s,l){return new Kx(e,t,n,i,a,o,r,s,l)}(e.loggerFactory,e.endpointsManager,e.platformService,e.authenticationService,e.networkState,e.coreSettings,e.authStateProvider,e.config,e.localStorage);return e.consumerGroupsMediaAuthService=n,n.initConsumerGroupsMediaAuthService(),async e=>{"signout"===e&&await n.logout()}}}class Xx{constructor(e){this.context=e,this.enabled=!1,this.globalWindow=window}async writeToEtw(e){if(this.enabled){const t=await(this.context.hostCommunicationService?.loadModule("etw")),n={message:e,channel:"JS_ETW",severity:TD.debug};t?.writeEtwEvent&&t?.writeEtwEvent(n)}}async start(){await this.registerEtwUpdates()}isPromiseRejectionEvent(e){return"reason"in e}isErrorEvent(e){return"message"in e}handleError(e){if(this.isPromiseRejectionEvent(e)){if(!e.reason.message)return void this.writeToEtw(`${e.reason}`);this.writeToEtw(`${e.reason.message}\n${e.reason.stack}`)}else if(this.isErrorEvent(e)){const t=[e.message,e.filename,e.lineno,e.colno,e.context,e.code,e.subContext].filter(Boolean).join(",");this.writeToEtw(t)}}registerErrorHandlers(){this.globalWindow.addEventListener("unhandledrejection",this.handleError.bind(this)),this.globalWindow.addEventListener("error",this.handleError.bind(this))}unregisterErrorHandlers(){this.globalWindow.removeEventListener("unhandledrejection",this.handleError),this.globalWindow.removeEventListener("error",this.handleError.bind(this))}async registerEtwUpdates(){const e=await(this.context.hostCommunicationService?.loadModule("etw"));if(e?.registerForTracingChanged)try{e.registerForTracingChanged((e=>{this.enabled=e.enabled,e.enabled?this.registerErrorHandlers():this.unregisterErrorHandlers()}))}catch{}}}class Zx extends _e{constructor(){super(h.Yg.InitEtwTask,[])}async execute(e){const t=new Xx(e);await t.start()}}class eR{constructor(e,t){this.coreSettings=e,this.hostCommunicationService=t;const n=this.coreSettings.get(b.J.Metadata);this.expConfigMetadata=[{client:mM,config:{expIds:n.configIds?.experiments?.join(",")??"",rolloutIds:n.configIds?.rollouts?.join(",")??"",eTag:n.eTag??"",expRolloutIdAllowList:n.expRolloutIdAllowList?.join("")??""}},{client:pM,config:{expIds:"",rolloutIds:"",eTag:n.hostETag??"",expRolloutIdAllowList:n.expRolloutIdAllowList?.join("")??""}}],this.subject=new r.X(this.expConfigMetadata),this.ecmObservable=this.subject.asObservable(),this.registerSyncHostEcm()}updateHostExperimentConfigMetadata(e){const t=e.find((e=>e.client===pM)),n=this.expConfigMetadata.findIndex((e=>e.client===pM));t&&n>-1&&(this.expConfigMetadata[n]=t,this.subject.next(this.expConfigMetadata))}updateWebExperimentConfigMetadata(e){const t=this.expConfigMetadata.find((e=>e.client===mM))?.config;t&&e.eTag&&e.configIds&&e.configIds.experiments&&(t.eTag=e.eTag,t.expIds=e.configIds.experiments.join(","),t.expRolloutIdAllowList=e.expRolloutIdAllowList?.join(",")??"",e.expRolloutIdAllowList?.length&&(t.rolloutIds=fM(e).join(",")))}async communicateWithHost(){const e=this.expConfigMetadata.find((e=>e.client===mM))?.config;if(!e)return;const t=await this.hostCommunicationService.loadModule("ecs");if(!t)return;const n=await(t.syncEcm?.([{client:mM,config:e}]));if(n&&n.client===pM){const e=[{client:pM,config:{eTag:n.config.eTag,expIds:n.config.expIds,rolloutIds:n.config.rolloutIds,expRolloutIdAllowList:n.config.expRolloutIdAllowList}}];this.updateHostExperimentConfigMetadata(e)}}registerSyncHostEcm(){this.hostCommunicationService.loadModule("ecs").then((e=>{e?.registerForOnSyncEcm?.((e=>{this.updateHostExperimentConfigMetadata(e)}))}))}}class tR extends _e{constructor(){super(h.Yg.InitExperimentation,["coreSettings","hostCommunicationService"])}async execute(e){const{coreSettings:t,hostCommunicationService:n}=e;e.experimentationService=new eR(t,n)}}class nR extends _e{constructor(){super(h.Yg.InitPreAuthSettingsEcsProvider,[])}async execute(e){const{coreSettings:t,coreSettingsContext:n,loggerFactory:i,...a}=Mm("InitPreAuthSettingsEcsProvider",e,"coreSettings","coreSettingsContext","loggerFactory","scenarioFactory","networkState","clientState","windowProvider","endpointsManager"),{enablePreAuthEcsFetch:o}=t.get(b.J.Core);if(!o)return;const r=n;await r.initializeEcsProvider({...a})}}class iR extends _e{constructor(){super(h.Yg.InitSettingsEcsProvider,["coreSettings","coreSettingsContext","authenticationService","loggerFactory","scenarioFactory","networkState","clientState","windowProvider","endpointsManager"])}async execute(e){const{coreSettings:t,coreSettingsContext:n,authenticationService:i,loggerFactory:a,scenarioFactory:o,networkState:r,clientState:s,windowProvider:l,endpointsManager:c}=e,d=n,u=async()=>{p||await d.fetchEcsSettingsIfApplicable()},{enablePreAuthEcsFetch:m}=t.get(b.J.Core),p=await this.getPrimaryUser(i,a);m||(await d.setPrimaryUser(p),await d.initializeEcsProvider({scenarioFactory:o,networkState:r,clientState:s,windowProvider:l,endpointsManager:c,authenticationUser:p})),await u()}async getPrimaryUser(e,t){let n;try{const t=await(e.getCachedUsers?.({id:(0,vl.pW)(),scenarioName:H.RG.AuthWebCachedUser,source:"init-settings-ecs-provider-task"},{isPrimaryUser:!0}));t&&t.length>0&&(n=(0,xe.KQ)(t[0]))}catch(e){t.newLogger("InitSettingsEcsProviderTask","core-services-tasks").warn("No primary user returned from authentication: ",e)}return n}}class aR extends _e{constructor(){super(h.Yg.InitSettingsMaglevHostProvider,["coreSettingsContext","hostCommunicationService"])}async execute(e){const{coreSettingsContext:t,hostCommunicationService:n}=e,{enableMaglevHostProvider:i}=t.getCoreSettings().get(b.J.Core);i&&await t.initializeMaglevHostProvider(n)}}class oR{constructor(e,t,n,i,a,o,r){this.scenarioFactory=a,this.host=o,this.clientStateProvider=r,this.namespacesToFetch=[],this.settings={},this.refreshIntervalInMs=36e5,this.fetch=()=>{if(0===this.namespacesToFetch.length)return this.logger.debug("Skipping fetch() as no namespacesToFetch registered."),Promise.resolve();const e=this.scenarioFactory.newScenario(this.getScenarioName());return this.validateEnvironment().then((()=>this.fetchPolicies(e))).catch((t=>{e.stop({errors:t},"abandoned"),this.logger.warn(`Error fetching policies: ${t}`)}))},this.validateEnvironment=()=>new Promise(((e,t)=>{this.clientStateProvider.getState()===Fe.pk.VeryActive&&(this.logger.log("Cancel policy fetching, due to app being in a very active state."),t("very active")),e()})),this.cleanupClientStateSubscription=()=>{this.clientStateSubscription?.unsubscribe(),this.clientStateSubscription=void 0},this.logger=e.newLogger(`CoreSettings/${t}`,"services-io-data-policies"),this.namespacesToFetch=(0,lu.z$)(n,i),this.namespacesToFetch.forEach((e=>{this.settings[e]={}})),this.updateConfigs(i)}async initialize(e=!0){this.isInitialized=!0,await this.fetchAndSetRefreshCadence()}subscribeForSettingsUpdates(e){this.settingsChangedCallbackFunction=e}cleanup(){this.cleanupClientStateSubscription(),this.settingsChangedCallbackFunction=void 0,this.coreSubscription?.unsubscribe(),this.coreSubscription=void 0}notifySettingsChanged(){const e=()=>{this.cleanupClientStateSubscription(),this.settingsChangedCallbackFunction?.(this.settings),this.logger.debug("Notified about policy change")};return this.clientStateProvider.getState()!==Fe.pk.VeryActive?(e(),!0):(this.clientStateSubscription||(this.clientStateSubscription=this.clientStateProvider.observe().subscribe((t=>{t!==Fe.pk.VeryActive&&e()}))),!1)}handleError(e){this.logger.error(`Failed to fetch tenant settings with error: ${e}`)}updateConfigs(e){const t=e.getObservable(b.J.Core);this.coreSubscription=t.subscribe((e=>{e.policyRefreshIntervalInMs&&this.updateRefreshCadence(e.policyRefreshIntervalInMs)}))}updateRefreshCadence(e){this.refreshIntervalInMs=e,this.isInitialized&&this.queueNextPolicyFetch()}fetchAndSetRefreshCadence(){return this.fetch().then((()=>{this.queueNextPolicyFetch()})).catch((e=>{this.logger.error(`Error fetching policies: ${e}`)}))}queueNextPolicyFetch(){if(!this.isInitialized)throw new Error("Service not initialized to queue the fetch.");this.setIntervalHandle&&(this.host.clearInterval(this.setIntervalHandle),this.setIntervalHandle=void 0,this.logger.debug("clearInterval() called.")),this.refreshIntervalInMs>0?(this.setIntervalHandle=this.host.setInterval(this.fetch,this.refreshIntervalInMs),this.logger.debug("setInterval() called.")):this.logger.error(`Refresh interval not valid: ${this.refreshIntervalInMs}`)}}class rR extends oR{constructor(e,t,n,i,a,o){super(e,"PoliciesIpcDataProvider",t,n,i,a,o),this.handleSetAggregatedSettings=e=>{const{payload:t}=e;Object.keys(t).length>0?(this.logger.log(`handleSetAggregatedSettings() called: ${Object.keys(t).join(", ")}.`),this.parsePolicies(t),this.notifySettingsChanged()):this.logger.log("handleSetAggregatedSettings() called with empty payload.")},this.windowOpener=a.opener}async initialize(e=!0){return this.windowOpener.addEventListener(O.rY.SetAggregatedSettings,this.handleSetAggregatedSettings),super.initialize()}cleanup(){super.cleanup(),this.windowOpener.removeEventListener(O.rY.SetAggregatedSettings,this.handleSetAggregatedSettings)}getScenarioName(){return H.RG.IPCPolicyFetch}fetchPolicies(e){return this.windowOpener.requestMessage(O.rY.GetAggregatedSettings).then((t=>{let n=!1,i="success";const a=t?.data;a&&0!==Object.keys(a).length?(this.logger.log(`fetchPolicies: Got policies for namespaces: ${Object.keys(a).join(", ")}.`),this.parsePolicies(a),n=this.notifySettingsChanged()):(this.logger.log("Failed to fetch policies via IPC, got empty payload data response."),i="incomplete"),e.stop({message:(0,$.u4)({notified:n})},i)})).catch((t=>{this.handleError(t),e.fail({errors:t.message??"Failed to fetch policies via IPC."})}))}parsePolicies(e){this.namespacesToFetch.forEach((t=>{e[t]&&e[t].hasOwnProperty("value")&&(this.settings[t]=e[t].value)}))}}const sR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"policies"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"correlationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"namespaces"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"policies"},arguments:[{kind:"Argument",name:{kind:"Name",value:"correlationId"},value:{kind:"Variable",name:{kind:"Name",value:"correlationId"}}},{kind:"Argument",name:{kind:"Name",value:"namespaces"},value:{kind:"Variable",name:{kind:"Name",value:"namespaces"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"jsonData"}}]}}]}}]},lR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"policiesUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"policiesUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"jsonData"}}]}}]}}]};class cR extends oR{constructor(e,t,n,i,a,o,r){super(e,"PoliciesResolversDataProvider",t,n,i,a,r),this.apolloClient=o,this.handlePoliciesUpdatedEvent=e=>{this.logger.log("handlePoliciesUpdatedEvent() called.");try{void 0!==e&&this.parsePolicies(e)?this.notifySettingsChanged():this.logger.log(`handlePoliciesUpdatedEvent(): policiesString is ${void 0===e?"undefined":"empty"}.`)}catch(e){this.logger.error(`handlePoliciesUpdatedEvent(): ${e.message}`)}}}async initialize(e=!0){const t=this;return this.policiesApolloSubscription=this.apolloClient.subscribe({query:lR}).subscribe({next(e){t.handlePoliciesUpdatedEvent(e?.data?.policiesUpdatedEvent?.jsonData??void 0)}}),super.initialize()}cleanup(){super.cleanup(),this.policiesApolloSubscription?.unsubscribe(),this.policiesApolloSubscription=void 0}getScenarioName(){return H.RG.PoliciesFetchDataResolvers}fetchPolicies(e){return this.apolloClient.query({query:sR,variables:{correlationId:e.id,namespaces:this.namespacesToFetch},fetchPolicy:"no-cache"}).then((t=>{t?.error&&this.logger.errorToTelemetry?.(`fetchPolicies:then: Message: ${t.error.message}.`,"webclient_framework_policies_resolvers_fetch_failed_event",void 0,!0),t?.errors&&t.errors.forEach((e=>{this.logger.errorToTelemetry?.(`fetchPolicies:then: Errors:Message: ${e.message}.`,"webclient_framework_policies_resolvers_fetch_failed_event",void 0,!0)}));const n=t?.data?.policies?.jsonData??void 0;let i=!1,a="success";void 0!==n&&this.parsePolicies(n)?i=this.notifySettingsChanged():(this.logger.log(`fetchPolicies(): Failed to fetch policies, got ${void 0===n?"undefined":"empty"} response.`),a="incomplete"),e.stop({message:(0,$.u4)({notified:i})},a)})).catch((t=>{this.handleError(t),e.fail({errors:t.message??"Failed to fetch policies via resolvers."})}))}parsePolicies(e){let t={};try{t=JSON.parse(e)}catch{throw new Error("parsePolicies(): Unable to parse policies string.")}return 0!==Object.keys(t).length&&(this.namespacesToFetch.forEach((e=>{t[e]&&(this.settings[e]=t[e])})),!0)}}class dR extends _e{constructor(){super(h.Yg.InitSettingsPolicyProvider,["authenticationUser","coreSettings","coreSettingsContext","loggerFactory"])}async execute(e){const{authenticationUser:t,coreSettings:n,coreSettingsContext:i,loggerFactory:a}=e,{disableNonBlockingPolicyProviderInit:o,disablePolicyProvider:r}=n.get(b.J.Core);if(r)return;if(!t||t.role===ys.w4.Anonymous)return;const s=this.createPoliciesDataProvider(e),{enableMainWindowPolicyFetch:l}=n.get(b.J.Host);if(l||o)await i.initializePolicyProvider(s);else{const e=a.newLogger("InitPolicyProviderTask","core-services-tasks");i.initializePolicyProvider(s).then((()=>{e.log("Initialized policy provider successfully.")})).catch((t=>{e.errorToTelemetry&&e.errorToTelemetry(`Initialization of policy provider failed. ${t}`,"webclient_framework_foundation_core_services",void 0,!0)}))}return e=>{if("signout"===e)s.cleanup()}}createPoliciesDataProvider(e){const{client:t,clientState:n,configLoader:i,coreSettings:a,loggerFactory:o,scenarioFactory:r,windowProvider:s}=e;let l;const{enableMainWindowPolicyFetch:c}=a.get(b.J.Host);return l=c?new rR(o,i,a,r,s,n):new cR(o,i,a,r,s,t,n),l}}const uR="preReleaseFeaturesAllowed";class mR extends _e{constructor(){super(h.Yg.InitSettingsWithDiscoveredUser,["authenticationService","authenticationUser","config","coreSettings","coreSettingsContext","endpointsManager","localStorage","loggerFactory","platformService","user"])}async execute(e){const{authenticationService:t,authenticationUser:n,config:i,coreSettings:a,coreSettingsContext:o,endpointsManager:r,localStorage:s,loggerFactory:l,platformService:c,user:d}=e;let u={};const{enablePreReleaseClientFilter:m}=a.get(b.J.Core);if(m){const e=await this.getPreReleaseUserInfo({authenticationService:t,authenticationUser:n,config:i,coreSettings:a,endpointsManager:r,localStorage:s,loggerFactory:l,platformService:c});u={...u,preReleaseFeaturesAllowed:e}}const p=o,{enableMTMA:g}=a.get(b.J.Core),h=!g||await Pu(t,n);await p.initializeProvidersWithDiscoveredUser(d,h,u)}async getPreReleaseUserInfo({authenticationService:e,authenticationUser:t,config:{experienceName:n},coreSettings:i,endpointsManager:a,localStorage:o,loggerFactory:r,platformService:s}){const l=r.newLogger("InitSettingsWithDiscoveredUserTask","core-services-tasks"),{preReleaseFeaturesAllowed:c}=i.get(b.J.Metadata);if(!c)return l.log("No pre release features are allowed."),!1;if(await Pu(e,t))return l.log(`Returning preReleaseAllowed filter for primary user: ${c}`),!!c;try{const e=o.get(uR);if(null!=e)return l.log(`Cached preReleaseAllowed filter loaded: ${e}`),JSON.parse(e);const c={userId:t?.profile.objectId,tenantId:t?.profile.tenantId},d=(0,Fp.xb)({coreSettings:i,experienceName:n,platformService:s,user:c,logger:l}),u=(0,Ap.bn)({serviceName:"ClientFilters",ecsParameters:d,loggerFactory:r,endpointsManager:a}),m=await u.fetch(),p=this.getValueFromPayload(m,d);return void 0!==p?(l.log(`Storing preReleaseAllowed filter in cache: ${p}`),o.set(uR,p.toString(),"Framework")):l.log("Could not get preReleaseAllowed filter from ECS."),!!p}catch(e){l.errorToTelemetry?.((0,vl.u4)(e),"web_infra_determine_pre_release_filter_failed")}return!1}getValueFromPayload(e,t){if(e.requestStatus===_p.m.Success)return t.agents?.some((t=>{const n=e.ecsConfiguration?.[t];return!!n?.metadata?.preReleaseFeaturesAllowed}))}}class pR extends _e{constructor(){super(h.Yg.InitSettingsWithPrimaryUser,["authenticationUser","coreSettings","coreSettingsContext","discover"])}async execute(e){const{authenticationUser:t,coreSettings:n,coreSettingsContext:i,discover:a}=e,{userTrackingService:o}=e,{enableExperimentationLicenseFilters:r}=n.get(b.J.Core),s=i;if(r){const e=(0,oc.ok)(t),n=await a.getUser(void 0,e),i=o?.getAccountCountCurrentCloud()||0;await s.setPrimaryUser(t,n,i),o&&s.setUserTrackingService(o)}else await s.setPrimaryUser(t);return async e=>{if("signout"===e)await i.clearPrimaryUser()}}}var gR;!function(e){e[e.ComposeMessageTyping=0]="ComposeMessageTyping",e[e.MessageListScroll=1]="MessageListScroll",e[e.PowerbarTyping=2]="PowerbarTyping",e[e.VirtualTreeListScroll=3]="VirtualTreeListScroll",e[e.FeedsFilterTyping=4]="FeedsFilterTyping",e[e.PeoplePickerTyping=5]="PeoplePickerTyping",e[e.SearchBoxTyping=6]="SearchBoxTyping",e[e.FloodgatePopup=7]="FloodgatePopup",e[e.ChatListSearchFilterTyping=8]="ChatListSearchFilterTyping",e[e.ChannelListSearchFilterTyping=9]="ChannelListSearchFilterTyping",e[e.CallingPerfSample=10]="CallingPerfSample",e[e.AllChannelSystemMessagesScroll=11]="AllChannelSystemMessagesScroll",e[e.AllPinnedPostsScroll=12]="AllPinnedPostsScroll",e[e.DiscoverSurfaceFeedListScroll=13]="DiscoverSurfaceFeedListScroll",e[e.TeamsAndChannelsTableScroll=14]="TeamsAndChannelsTableScroll",e[e.PostComposeTyping=15]="PostComposeTyping",e[e.UnifiedFunPickerTyping=16]="UnifiedFunPickerTyping",e[e.CreateTeamGalleryScroll=17]="CreateTeamGalleryScroll",e[e.AddMemberScroll=18]="AddMemberScroll",e[e.MeetForWorkListScroll=19]="MeetForWorkListScroll",e[e.MeetForWorkSearchFilterTyping=20]="MeetForWorkSearchFilterTyping",e[e.PeopleAppContactListScroll=21]="PeopleAppContactListScroll",e[e.SimpleCollabLeftRailScroll=22]="SimpleCollabLeftRailScroll"}(gR||(gR={}));var hR=n(970368);class yR{constructor(e){this.histogram=new Map,this.bucketSize=e.bucketSize,this.maxBucketValue=e.maxBucketValue,this.fixedDecimals=function(e){let t=0;const n=10;for(;Math.floor(e)!==e;)e*=n,t++;return t}(this.bucketSize)}record(e,t){t=(t=t||1)<1?1:t;const n=Math.min(Math.floor(e/this.bucketSize)*this.bucketSize,this.maxBucketValue).toFixed(this.fixedDecimals),i=this.histogram.get(n)||0;this.histogram.set(n,i+t)}toObject(){const e={};return Array.from(this.histogram.keys()).forEach((t=>e[t]=this.histogram.get(t))),e}clear(){this.histogram.clear()}}const vR="getAndClearAriTelemetry";class fR{constructor(e,t){this.host=e,this.context=t,this.startSlot=0,this.blinkInterval=100,this.trailingTimespan=h.B.second,this.rafRecords=new Map,this.activeUserActionType=void 0,this.wheelEventTriggeredUserActionType=void 0,this.userActions=new Map,this.validActions=new Map,this.lastEventTimeSlot=this.startSlot,this.isDebugging=!1,this.minAriDuration=200,this.minEtwTriggeringDelay=1e3,this.minEtwTriggeringFrameDelay=1e3,this.lastRafTime=0,this.strategies=[{name:"TwoRafAndLimitedStopTimeStrategy",lowestAllowedRafs:2,allowStopTimeOverwrite:!0}],this.logger=t.loggerFactory.newLogger("ARI","core-services-telemetry"),this.hostCommunicationService=t.hostCommunicationService,this.initializeOnAppLaunchAndReinit(),this.__initTestingMode__(this.context.coreSettings.get(b.J.Host)),this.defaultHost=e}trackEvent(e,t,n,i,a,o){const r=this.getUserActionType(e,t),{isDebugging:s,logger:l}=this;if(void 0===r||!(r in gR))return void(s&&l.debug(`[${this.formatActionKey(e,t)}] TrackEvent | No action found`));if(o)return void(this.wheelEventTriggeredUserActionType=r);const c=this.getMeasurementName(r),d=i.performance.now();if(s&&l.debug(`[${c} TrackEvent | [${Math.round(n)}...${Math.round(d)}] ${Math.round(d-n)}ms`),void 0===this.activeUserActionType)s&&l.debug(`[${c}] track-start`),this.startMeasurement(r,n,i,a);else if(this.activeUserActionType!==r||this.host!==i||this.actionLocation!==a)s&&l.debug(`[${c}] track-stop`),this.stopMeasurement(i),s&&l.debug(`[${c}] track-start`),this.startMeasurement(r,n,i,a);else{if(s){const e=`[${c}] track-continue`;l.debug(e),function(e,t,n){e.mark(t,n),e.clearMarks(t)}(this.host.performance,e,{startTime:n})}this.continueMeasurement(n)}}handleUnmount(e){this.stopMeasurement(e)}getTelemetry(e=hR.xL.HeartbeatMonitor){return this.getTelemetryFilteredByType(e)}getTelemetryTypeForAction(e){return e===gR.CallingPerfSample?hR.xL.CallingPerfMonitor:hR.xL.HeartbeatMonitor}isActionOfTelemetryType(e,t){return this.getTelemetryTypeForAction(e)===t}getTelemetryFilteredByType(e){void 0!==this.activeUserActionType&&this.isActionOfTelemetryType(this.activeUserActionType,e)&&this.stopMeasurement();const t={};let n=!1;const i={totalIntervalCount:0,passIntervalCount:0,measurements:0,wheelMeasurements:0,max:{totalIntervalCount:0,passIntervalCount:0}};this.userActions.forEach(((a,o)=>{if(void 0!==gR[a.type]&&this.isActionOfTelemetryType(a.type,e)){const e={};a.scores.forEach(((t,n)=>{(e=>{e&&(i.passIntervalCount+=e.passIntervalCount,i.totalIntervalCount+=e.totalIntervalCount,i.measurements+=e.measurements,i.wheelMeasurements+=e.wheelMeasurements,i.max.passIntervalCount=Math.max(i.max.passIntervalCount,e.passIntervalCount),i.max.totalIntervalCount=Math.max(i.max.totalIntervalCount,e.totalIntervalCount))})(t),e[n]=this.getAri(t),e[`${n}-score`]=t})),a.scoreHistograms.forEach(((t,n)=>{e[`${n}-scoreHistogram`]=t.toObject()})),e.frameDelayHistogram=a.frameDelayHistogram.toObject(),t[o]=e,n=!0,this.userActions.delete(o),this.isDebugging&&this.logger.debug(`[AppResponsivenessService]: clear action for type ${gR[a.type]}`)}})),t.Total=this.getAri(i),t.score=i;let a="";if(n)try{a=JSON.stringify(t)}catch(e){this.logger.error("[AppResponsivenessService]: unexpected error parsing log object. Likely because of circular reference.")}return a}clearTelemetry(){this.userActions.clear(),this.clearTelemetryTimeoutId&&this.context.windowProvider.clearTimeout(this.clearTelemetryTimeoutId),this.clearTelemetryTimeoutId=this.context.windowProvider.setTimeout((()=>{this.clearTelemetry()}),h.B.tenMinutes,!1)}initializeOnAppLaunchAndReinit(){this.initSettings(),this.registerValidActions(),this.clearTelemetry()}__initTestingMode__(e){if(e){const t=e.userType;t&&t.indexOf("test")>-1&&(this.isDebugging=!0,vR in window||(window[vR]=()=>{const e=this.getTelemetry();return this.clearTelemetry(),e}))}}registerValidActions(){this.validActions.set(this.formatActionKey(hR.PG.Floodgate,h.f_.System),gR.FloodgatePopup),this.validActions.set(this.formatActionKey(hR.PG.ComposeMessage,h.f_.Keyup),gR.ComposeMessageTyping),this.validActions.set(this.formatActionKey(hR.PG.MessageList,h.f_.Scroll),gR.MessageListScroll),this.validActions.set(this.formatActionKey(hR.PG.Powerbar,h.f_.Keyup),gR.PowerbarTyping),this.validActions.set(this.formatActionKey(hR.PG.VirtualTreeList,h.f_.Scroll),gR.VirtualTreeListScroll),this.validActions.set(this.formatActionKey(hR.PG.FeedsFilter,h.f_.Keyup),gR.FeedsFilterTyping),this.validActions.set(this.formatActionKey(hR.PG.PeoplePicker,h.f_.Keyup),gR.PeoplePickerTyping),this.validActions.set(this.formatActionKey(hR.PG.PostCompose,h.f_.Keyup),gR.PostComposeTyping),this.validActions.set(this.formatActionKey(hR.PG.SearchBox,h.f_.Keyup),gR.SearchBoxTyping),this.validActions.set(this.formatActionKey(hR.PG.ChatListSearchFilter,h.f_.Keyup),gR.ChatListSearchFilterTyping),this.validActions.set(this.formatActionKey(hR.PG.ChannelListSearchFilter,h.f_.Keyup),gR.ChannelListSearchFilterTyping),this.validActions.set(this.formatActionKey(hR.PG.CallingPerf,h.f_.Sample),gR.CallingPerfSample),this.validActions.set(this.formatActionKey(hR.PG.DiscoverSurfaceFeedList,h.f_.Scroll),gR.DiscoverSurfaceFeedListScroll),this.validActions.set(this.formatActionKey(hR.PG.AllPinnedPosts,h.f_.Scroll),gR.AllPinnedPostsScroll),this.validActions.set(this.formatActionKey(hR.PG.AllChannelSystemMessages,h.f_.Scroll),gR.AllChannelSystemMessagesScroll),this.validActions.set(this.formatActionKey(hR.PG.TeamsAndChannelsTable,h.f_.Scroll),gR.TeamsAndChannelsTableScroll),this.validActions.set(this.formatActionKey(hR.PG.UnifiedFunPicker,h.f_.Keyup),gR.UnifiedFunPickerTyping),this.validActions.set(this.formatActionKey(hR.PG.CreateTeamGallery,h.f_.Scroll),gR.CreateTeamGalleryScroll),this.validActions.set(this.formatActionKey(hR.PG.AddMember,h.f_.Scroll),gR.AddMemberScroll),this.validActions.set(this.formatActionKey(hR.PG.MeetForWorkList,h.f_.Scroll),gR.MeetForWorkListScroll),this.validActions.set(this.formatActionKey(hR.PG.MeetForWorkSearchFilter,h.f_.Keyup),gR.MeetForWorkSearchFilterTyping),this.validActions.set(this.formatActionKey(hR.PG.PeopleAppContactList,h.f_.Scroll),gR.PeopleAppContactListScroll),this.validActions.set(this.formatActionKey(hR.PG.SimpleCollabLeftRail,h.f_.Scroll),gR.SimpleCollabLeftRailScroll)}getUserActionType(e,t){const n=this.formatActionKey(t,e);return this.validActions.get(n)}formatActionKey(e,t){return`${e}_${t}`}registerRafCallback(){this.rafCallbackId||(this.lastRafTime=this.host.performance.now(),this.rafCallbackId=this.host.requestAnimationFrame((()=>this.measureRaf())))}unregisterRafCallback(){this.rafCallbackId&&(this.host.cancelAnimationFrame(this.rafCallbackId),this.clearRaf())}clearRaf(){this.rafCallbackId=void 0,this.rafRecords.clear()}getAri(e){return e&&0!==e.totalIntervalCount?Math.round(e.passIntervalCount/e.totalIntervalCount*h.B.second)/h.B.second:0}initSettings(){const{enableAriDebugging:e,appResponsivenessConstants:t}=this.context.coreSettings.get(b.J.Telemetry),n=this.context.coreSettings.get(b.J.Host).showScenarioStepsInPerfTrace||this.context.coreSettings.get(b.J.Core).showScenarioStepsInPerfTrace;this.isDebugging=e||n||!1,this.blinkInterval=t&&t.blinkInterval||100,this.trailingTimespan=t&&t.trailingTimespan||h.B.second,this.minEtwTriggeringDelay=t?.minEtwTriggeringDelay||1e3,this.minEtwTriggeringFrameDelay=t?.minEtwTriggeringFrameDelay||1e3}startMeasurement(e,t,n,i){this.assignHost(n),this.actionLocation=i,this.activeUserActionType=e,this.eventStartTime=t||this.host.performance.now(),this.lastEventTimeSlot=this.getTimeSlot(this.eventStartTime);const a=this.getMeasurementName(e);if(this.isDebugging){const e=`[${a}] START`,t=`${e} | ${this.host.performance.now()} | Event: ${this.eventStartTime}`;this.host.performance.mark(e,{startTime:this.eventStartTime}),this.logger.debug(t)}this.registerRafCallback();let o=this.userActions.get(a);void 0===o&&(o={scores:new Map,scoreHistograms:new Map,startTime:this.startSlot,type:e,frameDelayHistogram:new yR({bucketSize:500,maxBucketValue:15e3})},this.userActions.set(a,o)),o.startTime=this.eventStartTime}stopMeasurement(e=this.host){if(void 0===this.activeUserActionType)return;const t=this.getMeasurementName(this.activeUserActionType),n=this.userActions.get(t);if(void 0!==n){if(this.isDebugging){const e=`[${t}] END`;this.host.performance.mark(e),this.logger.debug(`${e} | ${this.host.performance.now()}`)}this.finalizeMeasurement(n)}this.unregisterRafCallback(),this.wheelEventTriggeredUserActionType===this.activeUserActionType&&(this.wheelEventTriggeredUserActionType=void 0),this.activeUserActionType=void 0,this.actionLocation=void 0,e===this.host&&this.assignHost(this.defaultHost)}continueMeasurement(e){this.lastEventTimeSlot=this.getTimeSlot(e)}finalizeMeasurement(e,t){this.strategies.forEach((n=>{const i=t&&n.allowStopTimeOverwrite?t:this.getCurrentTimeSlot(),a=Math.round(this.host.performance.now()-e.startTime);if(a<this.minAriDuration)return;const o=this.getResponsivenessScore(this.startSlot,i,n);this.recordPerInteractionAri(e,a,o,n);const r=e.scores.get(n.name);r?(r.passIntervalCount+=o.passIntervalCount,r.totalIntervalCount+=o.totalIntervalCount,r.measurements+=o.measurements,r.wheelMeasurements+=o.wheelMeasurements,r.max.passIntervalCount=Math.max(r.max.passIntervalCount,o.passIntervalCount),r.max.totalIntervalCount=Math.max(r.max.totalIntervalCount,o.totalIntervalCount)):e.scores.set(n.name,{totalIntervalCount:o.totalIntervalCount,passIntervalCount:o.passIntervalCount,measurements:o.measurements,wheelMeasurements:o.wheelMeasurements,max:o.max});const s=(o.passIntervalCount/o.totalIntervalCount).toFixed(2);if(this.logger.log(`[${this.getMeasurementName(e.type)}] duration: ${a}ms measurement: ${o.passIntervalCount}/${o.totalIntervalCount} (${s})`),this.isDebugging){const t=this.getMeasurementName(e.type),n={name:t,pass:o.passIntervalCount,total:o.totalIntervalCount,result:s},i=`ari-measurement => ${JSON.stringify(n)}`,a=`[${t}] START`,r=`[${t}] END`;uu(this.host.performance,i,a,r)}}))}recordFrameDelay(){if(void 0===this.activeUserActionType)return;const e=this.getMeasurementName(this.activeUserActionType),t=this.userActions.get(e);if(void 0===t)return;const n=this.host.performance.now(),i=n-this.lastRafTime;this.lastRafTime=n,t.frameDelayHistogram.record(i),i>=this.minEtwTriggeringFrameDelay&&this.hostCommunicationService?.loadModule("etw").then((e=>{e?.writeAppResponsivenessFrameDelayEvent?.({type:gR[t.type],delayMs:i})}))}recordPerInteractionAri(e,t,n,i){const a=n.passIntervalCount/n.totalIntervalCount;e.scoreHistograms.has(i.name)||e.scoreHistograms.set(i.name,new yR({bucketSize:.1,maxBucketValue:1}));e.scoreHistograms.get(i.name).record(a);const o=(1-a)*t;o>=this.minEtwTriggeringDelay&&this.hostCommunicationService?.loadModule("etw").then((n=>{n?.writeAppResponsivenessDelayEvent?.({type:gR[e.type],delayMs:o,durationMs:t})}))}measureRaf(){const e=this.getCurrentTimeSlot();this.recordFrameDelay();let t=this.rafRecords.get(e);void 0===t?t=1:t++,e-this.lastEventTimeSlot>=this.trailingTimespan?this.stopMeasurement():(this.rafRecords.size>1e3&&(this.stopMeasurement(),this.rafRecords.clear()),this.rafRecords.set(e,t),this.rafCallbackId=this.host.requestAnimationFrame((()=>this.measureRaf())))}getCurrentTimeSlot(){const e=this.host.performance.now();return this.getTimeSlot(e)}getTimeSlot(e){const t=void 0!==this.eventStartTime?e-this.eventStartTime:-1;return t<0?-1:Math.floor(t/this.blinkInterval)*this.blinkInterval}getResponsivenessScore(e,t,n){let i=0,a=0;for(;e<t;){const t=this.rafRecords.get(e);this.isDebugging&&this.logger.debug(`${e}: ${void 0===t?0:t}`),a+=void 0!==t&&t>=n.lowestAllowedRafs?1:0,i++,e+=this.blinkInterval}return{passIntervalCount:a,totalIntervalCount:i,measurements:1,wheelMeasurements:void 0!==this.wheelEventTriggeredUserActionType&&this.wheelEventTriggeredUserActionType===this.activeUserActionType?1:0,max:{passIntervalCount:a,totalIntervalCount:i}}}assignHost(e){this.host=e}getMeasurementName(e){let t=gR[e];return this.actionLocation&&(t+=`-${this.actionLocation}`),t}}const SR={"14d6962d-6eeb-4f48-8890-de55454bb136":"ActivityAppSwitch","86fcd49b-61a2-4701-b771-54728cd291fb":"ChatAppSwitch","ef56c0de-36fc-4ef8-b417-3d82ba9d073c":"CalendarAppSwitch","2a84919f-59d8-4441-a975-2a8c2643b741":"ChannelAppSwitch","3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40":"SimpleCollabAppSwitch","20c3440d-c67e-4420-9f80-0e50c39693df":"CallsMainAppSwitch","5af6a76b-40fc-4ba1-af29-8f49b08e44fd":"FilesAppSwitch","957ed0e3-e5ca-4c82-9676-fd037185c4d8":"MeetAppSwitch","a63f7012-8cc9-42d5-99c3-e35f526fab17":"MeetForWorkAppSwitch","3b95919f-59d8-4441-a975-2a8c2643c852":"CommunitiesAppSwitch","40472f6e-248f-4599-842c-ff3ed8f0ae34":"VirtualConsumerEventsAppSwitch","66aeee93-507d-479a-a3ef-8f494af43945":"AssignmentsAppSwitch","ac40aa4a-fef1-4896-aea2-46d1c14dbfd5":"StoreAppSwitch","7133fca9-0853-4e7a-bb5d-32d4e5f6020a":"HomepageAppSwitch","a02e4d17-af86-4ceb-9c97-4c2626eb3587":"QueuesAppSwitch","7831feaf-c4c4-4669-ba64-ce4ea0b56d31":"PeopleAppSwitch"},kR={"chat-list-item":"ChatSwitch","sendMessageCommands-send":"MessageSend","activity-feed-list-item":"ActivitySwitch"},CR={good:"#0CCE6A","needs-improvement":"#FFA400",poor:"#FF4E42"},bR=new Set(["slot-measurer"]),wR="not-able-to-find-a-data-tid",TR=["app-detail-","attendeesInMeeting","autocomplete-picker-item","AUTOSUGGEST_SUGGESTION_APPS","AUTOSUGGEST_SUGGESTION_FILES","AUTOSUGGEST_SUGGESTION_HISTORY","AUTOSUGGEST_SUGGESTION_PEOPLE","AUTOSUGGEST_SUGGESTION_SEARCHES","AUTOSUGGEST_SUGGESTION_SUGGESTEDSEARCH","AUTOSUGGEST_SUGGESTION_TOPHITS","background-effect","cal-category","channel-list-item-text","custom-emoji","deep-link-chiclet","emoji-categories-tab","emoticon-button","file-chiclet","give-control","InsertTable-","lazy-image-","me-control-menu-account-item","me-control-multi-account-item","me-control-set-availability-menu-item","me-control-tenant-item","message-heart","message-laugh","message-surprised","message-yes","newMessageCommands","overflow-item","participant-8:orgid","participant","participants-in-lobby","participantsFromMeeting","participantsFromTeamSuggestions","participantsFromThread","participantsInCall","participantsInLobby","people-picker-entry-","recipient-line-entry","remove-member","role-dropdown","store-item","tab-item-","tab-item-tab","team-context-menu-more-button","tid-calendar-event","tid-upcoming","username-in-call-row",["data-tid-","tabs-data-id"]],IR=["-empty",["-count","reactions-count-button"]],NR="getInpTelemetry";class ER{constructor(e){this.context=e,this.performanceObserverDurationThreshold=16,this.minEtwTriggeringDelay=500,this.minEtwTriggeringDelayForEvents={},this.track=(e,t)=>{if(!e.PerformanceObserver)return null;const n=new e.PerformanceObserver(this.performanceObserverCallback(t));return n.observe({type:"event",durationThreshold:this.performanceObserverDurationThreshold,buffered:!0}),()=>{n.disconnect()}},this.saveMousedownEntry=e=>{const t=e.filter((e=>"mousedown"===e.name)),n=t.length>=1?t.reduce(((e,t)=>e.duration>=t.duration?e:t)):null;n?.target&&(this.previousMousedownAssociatedScenario=this.attemptToFindMatch(n?.target))},this.performanceObserverCallback=e=>t=>{if(this.inpRecordCount>1e3)return;const n={},i=t.getEntries();for(const e of i){const t=e.interactionId||0;n[t]=n[t]||[],n[t].push(e)}for(const t of Object.values(n)){this.saveMousedownEntry(t);const n=t.filter((e=>"click"===e.name));if(0===n.length)continue;const i=n.reduce(((e,t)=>e.duration>=t.duration?e:t)),o=i.target,r={inp:this.getInp(i),inputDelay:this.getInputDelay(i),processingTime:this.getProcessingTime(i),presentationDelay:this.getPresentationDelay(i)},{match:s,notYetInstrumentedMatch:l,iterations:c}=this.attemptToFindMatchForClickOrPreviousMousedown(o);s?this.updateAssociatedInstrumentedScenario(s,r,e):this.updateAssociatedNotYetInstrumentedScenario(l,r,e),this.inpRecordCount++;const d=this.minEtwTriggeringDelayForEvents[s??""]??this.minEtwTriggeringDelay;if(i.duration>=d&&this.hostCommunicationService?.loadModule("etw").then((e=>{e?.writeInteractionToNextPaintEvent?.({scenario:s??l,version:"3",inputDelayMs:r.inputDelay,processingTimeMs:r.processingTime,presentationDelayMs:r.presentationDelay,inpMs:r.inp,inpEndTimestamp:i.startTime+i.duration})})),this.isDebugging){const e=i.duration,t=(a=e)<=200?"good":a<=500?"needs-improvement":"poor",n=`${e.toFixed(0)} ms`;this.logger.log(`%cInteraction tracking snippet %c${n} (${t})`,"font-weight: bold;",`font-weight: bold; color: ${CR[t]||"inherit"}`),s?this.logger.log(`Interaction associated scenario: %c${s}`,"font-family: monospace"):this.logger.log(`Interaction associated not yet implemented scenario: %c${l}`,"font-family: monospace"),this.logger.log(`Interaction event type: %c${i.name}`,"font-family: monospace"),this.logger.log("DOM Depth search iterations needed to find a match",c+1),this.logger.log(`Input delay (ms): ${r.inputDelay}\n`,`Processing time (ms): ${r.processingTime}\n`,`Presentation delay (ms): ${r.presentationDelay}`)}}var a},this.isDebugging=!1,this.__initTestingMode__(this.context.coreSettings.get(b.J.Host)),this.logger=this.context.loggerFactory.newLogger("INP","core-services-telemetry"),this.hostCommunicationService=e.hostCommunicationService,this.initSettings(),this.inpData={version:"3",events:{}},this.inpRecordCount=0,this.previousMousedownAssociatedScenario=null}getTelemetry(){let e="",t=!1;if(this.inpRecordCount>0&&(t=!0),t)try{e=JSON.stringify(this.inpData)}catch(e){this.logger.error("[InteractionToNextPaintService]: unexpected error parsing log object. Likely because of circular reference.")}return this.inpData.events={},this.inpRecordCount=0,e}initSettings(){const{interactionToNextPaintConstants:e}=this.context.coreSettings.get(b.J.Telemetry);this.performanceObserverDurationThreshold=e?.performanceObserverDurationThreshold??16,this.minEtwTriggeringDelay=e?.minEtwTriggeringDelayFallback??500,e?.minEtwTriggeringDelayForEvents?.forEach((e=>{const t=e?.eventName,n=e?.duration;t&&n&&(this.minEtwTriggeringDelayForEvents[t]=e.duration)}))}attemptToFindMatchForClickOrPreviousMousedown(e){return e?this.attemptToFindMatch(e):this.previousMousedownAssociatedScenario?this.previousMousedownAssociatedScenario:{match:null,notYetInstrumentedMatch:wR,iterations:0}}attemptToFindMatch(e){let t=0,n=null,i="",a=0;for(;t<10&&(e&&(n=this.attemptToFindInstrumentedMatch(e)),i||(i=this.maybeGetDataTid(e)??"",a=t),!n);)e=e?.parentElement,t++;return i||(i=wR),{match:n,notYetInstrumentedMatch:i,iterations:Math.min(t,a)}}attemptToFindInstrumentedMatch(e){const t=this.maybeGetDataTid(e)??"",n=e.getAttribute("id"),i=e.getAttribute("class"),a=SR[t];if(a)return a;const o=kR[t];return o?"ChatSwitch"===o?n?.includes("meeting")?"ChatMeetingSwitch":"ChatSwitch":o:n?.includes("channel")&&i?.includes("ui-tree__item")?"ChannelSwitch":null}__initTestingMode__(e){if(e){const t=e.userType;t&&t.indexOf("test")>-1&&(this.isDebugging=!0,NR in window||(window[NR]=()=>this.getTelemetry()))}}maybeGetDataTid(e){if(!e)return null;let t=e.getAttribute("data-tid")??e.getAttribute("data-testid")??e.getAttribute("data-track-module-name")??null;if(!t)return null;if(t.length>500)return null;if(bR.has(t))return null;if(t?.includes("@"))return null;for(const e of TR)if(Array.isArray(e)){if(t.startsWith(e[0])){t=e[1];break}}else if(t.startsWith(e)){t=e;break}for(const e of IR)if(Array.isArray(e)){if(t.endsWith(e[0])){t=e[1];break}}else if(t.endsWith(e)){t=e;break}return/([a-zA-Z]+ [a-zA-Z]+-\d+)/.test(t)?"first-last-index":(t=(0,ce.A)(t,[Aa.A4.PhoneNumber]),t)}getInp(e){return Math.max(Math.round(e.duration),0)}getInputDelay(e){return Math.max(Math.round(e.processingStart-e.startTime),0)}getProcessingTime(e){return Math.max(Math.round(e.processingEnd-e.processingStart),0)}getPresentationDelay(e){const t=Math.max(e.processingEnd+4,e.startTime+e.duration);return Math.max(Math.round(t-e.processingEnd),0)}updateMetricsForScenario(e,t,n){new Map([["inp",t.inp],["inputDelay",t.inputDelay],["processingTime",t.processingTime],["presentationDelay",t.presentationDelay]]).forEach(((t,n)=>{(e[n]??(e[n]=[])).push(t)})),e.mainEntityType=e.mainEntityType??(e.mainEntityType=[]),e.mainEntityType.push(n)}updateAndGetEventType(){return this.inpData.events.click??(this.inpData.events.click={instrumented:{},notYetInstrumented:{}})}updateAssociatedInstrumentedScenario(e,t,n){const i=this.updateAndGetEventType(),a=i.instrumented[e]??(i.instrumented[e]={});this.updateMetricsForScenario(a,t,n)}updateAssociatedNotYetInstrumentedScenario(e,t,n){const i=this.updateAndGetEventType(),a=i.notYetInstrumented[e]??(i.notYetInstrumented[e]={});this.updateMetricsForScenario(a,t,n)}}class AR{constructor(e){if(this.context=e,this.context.host?.performance){this.deprecatedNavigationTiming=this.context.host.performance.timing,this.navigationStart=this.deprecatedNavigationTiming?.navigationStart;const e=this.context.host.performance.getEntriesByType("navigation");e&&e[0]&&(this.navigationTiming=e[0]),this.init()}}get altScenario(){return this._altScenario}get clientStartScenario(){return this._clientStartScenario}markCoreInitSteps(){const e=this.context.host.performance.getEntriesByType("mark");e&&this.navigationStart&&(this._altScenario&&this.processCoreInitPerfMarks(this._altScenario,this.navigationStart,e),this._clientStartScenario&&(this._clientStartScenario.appendEventData({scenarioPhase:im.Core}),this.processCoreInitPerfMarks(this._clientStartScenario,this.navigationStart,e)))}processCoreInitPerfMarks(e,t,n){const i=n;for(const n of i)n.name!==`${T}${h.sM.Initialization}`?n.name.startsWith(I)&&e.mark(n.name.replace("_end_","_"),{overrideTimestamp:Math.round(n.startTime)+t}):e.mark(H.ck.PreCoreInitializationTasks,{overrideTimestamp:Math.round(n.startTime)+t})}markAltExpLoaderSteps(e,t){this.markNavigationSteps(e,t);const n=this.context.host.performance.getEntriesByName("start-execute-main-bundle","mark");n&&n[0]&&e.mark(H.ck.MainBundleDownloadParse,{overrideTimestamp:Math.round(n[0].startTime)+t})}markClientStartExpLoaderSteps(e,t){e.appendEventData({scenarioPhase:im.ExpLoader}),this.markNavigationSteps(e,t);const n=[S.IndexPageStart,S.CoreModuleLoaded,S.NotifyDesktop,S.ConfigLoaded,S.MainChunksLoadingStart,S.MainChunksLoadingStop,S.IndexPageStop,S.AsyncEntryDownloadStart,S.AsyncEntryModuleFederationUrlsInited,S.AsyncEntryDownloadStop,H.ck.MainBundleDownloadParse,"start-execute-main-bundle"],i=this.context.host.performance.getEntriesByType("mark");i&&i.filter((e=>n.includes(e.name)||e.name.startsWith("exp_loader_err_"))).forEach((n=>{e.mark(n.name,{overrideTimestamp:Math.round(n.startTime)+t})}))}markNavigationSteps(e,t){this.navigationTiming?.workerStart&&e.mark(H.ck.PreIndexServiceWorkerStartup,{overrideTimestamp:t+Math.round(this.navigationTiming.workerStart)}),this.deprecatedNavigationTiming?.fetchStart&&this.navigationTiming?.workerStart&&e.mark(H.ck.IndexServiceWorkerStartup,{overrideTimestamp:this.deprecatedNavigationTiming.fetchStart}),this.deprecatedNavigationTiming?.domainLookupStart&&e.mark(H.ck.IndexFetchIPC,{overrideTimestamp:this.deprecatedNavigationTiming.domainLookupStart}),this.deprecatedNavigationTiming?.domainLookupEnd&&e.mark(H.ck.IndexDNS,{overrideTimestamp:this.deprecatedNavigationTiming.domainLookupEnd}),this.deprecatedNavigationTiming?.connectEnd&&e.mark(H.ck.IndexConnect,{overrideTimestamp:this.deprecatedNavigationTiming.connectEnd}),this.deprecatedNavigationTiming?.responseStart&&e.mark(H.ck.IndexRequest,{overrideTimestamp:this.deprecatedNavigationTiming.responseStart}),this.deprecatedNavigationTiming?.responseEnd&&e.mark(H.ck.IndexResponse,{overrideTimestamp:this.deprecatedNavigationTiming.responseEnd})}init(){this.navigationStart&&(this._altScenario=this.context.scenarioFactory?.newScenario(H.RG.ApplicationLaunchTime,{startTime:this.navigationStart,timeoutMs:36e4}),this._clientStartScenario=this.context.scenarioFactory?.newScenario(H.RG.ClientStart,{startTime:this.navigationStart,timeoutMs:36e4}),this._altScenario&&this.markAltExpLoaderSteps(this._altScenario,this.navigationStart),this._clientStartScenario&&this.markClientStartExpLoaderSteps(this._clientStartScenario,this.navigationStart),this.markCoreInitSteps())}}class _R{constructor(e,t){this.isScenarioMemorySnapshotEnabled=e,this.globalWindow=t,this.cachedMemoryData={},this.cacheToExpireTime=0}snapshotMemoryUsage(){return this.isScenarioMemorySnapshotEnabled?(this.cacheToExpireTime<Date.now()&&this.snapshot(),this.cachedMemoryData):{}}snapshotMemoryUsageAsync(){if(!this.isScenarioMemorySnapshotEnabled)return Promise.resolve({});if(this.ongoingPromise)return this.ongoingPromise;const e=this.cacheToExpireTime-Date.now();return e>0?(this.ongoingPromise=new Promise((t=>{this.globalWindow.setTimeout((()=>{this.snapshot(),t(this.cachedMemoryData),this.ongoingPromise=void 0}),e)})),this.ongoingPromise):(this.snapshot(),Promise.resolve(this.cachedMemoryData))}snapshot(){this.cachedMemoryData={jsHeapStatistics:this.globalWindow.envPerformance.getJSHeapStatistics()||this.cachedMemoryData.jsHeapStatistics,processMemoryInfo:this.globalWindow.envPerformance.getProcessMemoryInfo()||this.cachedMemoryData.processMemoryInfo},this.cacheToExpireTime=Date.now()+3e4}}var FR=n(118423),DR=n(716415);class PR{constructor(e){this.eventTimeTracker=CM(e&&e>0?e:100)}markResponse(e){return this.eventTimeTracker.markEvent(e)}getResponsesBetweenStartAndLast(e){return this.eventTimeTracker.getEventsBetweenStartAndLast(e)}getResponsesBetween(e,t){return this.eventTimeTracker.getEventsBetween(e,t)}}const MR=e=>{const{apolloLeakInfoViewportContext:t,apolloLeakInfoEntityType:n=""}=e.apolloLeakInfo??{};return t===st.R.primary?`main:${n}`:n},xR=e=>e.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{});class RR{constructor(e,t,n,i){this.coreSettings=e,this.leakDetectorService=t,this.userTrackingService=n,this.shouldCollectStats=i,this.measurementTimeOverflow=!1,this.resultMeasurementTimeOverflow=!1,this.isLeakingUser=e=>e&&this.userTrackingService&&!this.userTrackingService.has(e);const{apolloCacheStatsThrottleTime:a,logCdlOperationsDuringWaitSettings:o}=e.get(b.J.Core);var r;this.getTelemetry=a?(0,W.throttle)((()=>this.getTelemetryInternal()),a,{leading:!0,trailing:!1}):this.getTelemetryInternal,o&&(o.enableTrackingCdlOperationsDuringWait||o.enableLoggingCdlOperationsDuringWait)&&(this.cdlResponseTracker=(r=o.trackingCdlOperationsDuringWaitBufferSize,new PR(r)))}getTelemetryInternal(){const{enableApolloCacheStats:e,enableApolloCacheSizeStats:t,enableApolloResultCacheSizeStats:n,enableApolloDataEviction:i}=this.coreSettings.get(b.J.Core);if(!e)return;const a=this.leakDetectorService?.getReachableObjects(Fo.I.DataClient).size??0,o=Array.from(this.leakDetectorService?.getReachableObjects(Fo.I.ApolloCache)??[]),r=[...Array.from(this.leakDetectorService?.getReachableObjects(Fo.I.UnwrappedWindow)??[]).map((e=>e.windowLeakInfo?.windowLeakInfoWindowId)).filter((e=>!!e)),h.ew],s=e=>!e||!r.includes(e),l=o.filter((e=>{const{apolloLeakInfo:{apolloLeakInfoWindowId:t}={}}=e;return s(t)})),c=this.getLeakedUserCaches(o),d=o.map(MR),u=l.map(MR),m=t&&!this.measurementTimeOverflow&&this.shouldCollectStats(),p=n&&!this.resultMeasurementTimeOverflow&&this.shouldCollectStats(),g={clientsCount:a,cacheCount:o.length,allEntityTypes:Array.from(new Set(d)),entityTypeStats:xR(d),leakedCacheCount:u.length,leakedEntityTypes:Array.from(new Set(u)),leakedEntityTypeStats:xR(u),leakedUserCachesCount:c.length,caches:o.map((e=>{const{apolloLeakInfo:{apolloLeakInfoWindowId:t,apolloLeakInfoEntityType:n,apolloLeakInfoViewportContext:i,apolloLeakInfoStartTime:a,apolloLeakInfoEndTime:o}={}}=e,r={windowId:t,isLeaking:s(t),apolloLeakInfoStartTime:a,apolloLeakInfoEndTime:o,entityType:n,viewportContext:i};if(m){const{cacheSize:t,measuringTime:n}=(0,FR.T)(e);r.cacheSize=t,r.measuringTime=n}if(p){const{cacheSize:t,measuringTime:n}=(0,DR.TP)(e);r.resultCacheSize=t,r.resultMeasuringTime=n}return r})),enableApolloDataEviction:i??void 0},y=g.caches.reduce(((e,t)=>({cacheSize:void 0===t.cacheSize||void 0===e.cacheSize?void 0:e.cacheSize+t.cacheSize,measuringTime:void 0===t.measuringTime||void 0===e.measuringTime?void 0:e.measuringTime+t.measuringTime,resultCacheSize:void 0===t.resultCacheSize||void 0===e.resultCacheSize?void 0:e.resultCacheSize+t.resultCacheSize,resultMeasuringTime:void 0===t.resultMeasuringTime||void 0===e.resultMeasuringTime?void 0:e.resultMeasuringTime+t.resultMeasuringTime})),{cacheSize:0,measuringTime:0,resultCacheSize:0,resultMeasuringTime:0});return y.measuringTime&&y.measuringTime>500&&(this.measurementTimeOverflow=!0),y.resultMeasuringTime&&y.resultMeasuringTime>500&&(this.resultMeasurementTimeOverflow=!0),{...g,...y}}unthrottle(){"function"==typeof this.getTelemetry.cancel&&this.getTelemetry.cancel()}markResponse(e){this.cdlResponseTracker?.markResponse(e)}getResponsesBetweenStartAndLast(e){return this.cdlResponseTracker?.getResponsesBetweenStartAndLast(e)||[]}getResponsesBetween(e,t){return this.cdlResponseTracker?.getResponsesBetween(e,t)||[]}getLeakedUserCaches(e){return e.filter((e=>{const{apolloLeakInfo:{apolloLeakInfoUserContextId:t}={}}=e;return this.isLeakingUser(t)}))}}const jR={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activeWindows"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isMainWindow"}},{kind:"Field",name:{kind:"Name",value:"isNotificationsWindow"}},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"layoutConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layoutMode"}}]}}]}}]}}]},LR=(e,t,n)=>{const i=void 0!==e[t]||Object.keys(e).length<n?t:"other";return e[i]=(e[i]||0)+1,i},OR=new Set([Se.py.breakoutroomspanel,Se.py.calendar,Se.py.callablechannels,Se.py.callsmain,Se.py.chats,Se.py.channels,Se.py.schedulingform,Se.py.search,Se.py.store,Se.py.transcriptcontent]);var $R;!function(e){e.mainActive="mainActive",e.mainContentRecord="mainContentRecord"}($R||($R={}));class UR{constructor(e){this.entityTypeLimit=e,this.active={},this.record={},this.allEntityTypes=new Set,this.usedEntityTypes=new Set,this.allLayoutModes=new Set,this.activeWindowIds=new Set}update(e,t){Object.keys(this.active).forEach((e=>{this.active[e]=0})),this.activeWindowIds.clear(),e.forEach((e=>{const n=e.activeEntities.mainEntity.type;this.allEntityTypes.add(n),this.allLayoutModes.add(e.layoutConfig.layoutMode),this.activeWindowIds.add(e.id),LR(this.active,n,this.entityTypeLimit),OR.has(n)&&this.usedEntityTypes.add(n),!this.isFirstUse(n)&&this.wasInPreviousUpdate(e,t)||LR(this.record,n,this.entityTypeLimit)}))}getStats(){return{mainActive:this.active,mainContentRecord:this.record,allEntityTypes:Array.from(this.allEntityTypes),usedEntityTypes:Array.from(this.usedEntityTypes),allLayoutModes:Array.from(this.allLayoutModes),activeWindowIds:Array.from(this.activeWindowIds)}}isFirstUse(e){return!this.record[e]}wasInPreviousUpdate(e,t){const n=t.find((t=>t.id===e.id));return!!n&&n.activeEntities.mainEntity.type===e.activeEntities.mainEntity.type&&n.activeEntities.mainEntity.id===e.activeEntities.mainEntity.id&&n.correlation.id===e.correlation.id}}const BR=new Set([Se.py.calls,Se.py.chats,Se.py.channels,Se.py.extensions,Se.py.schedulingform]);var WR;!function(e){e.popOutActive="popOutActive",e.popOutRecord="popOutRecord"}(WR||(WR={}));class HR{constructor(e){this.entityTypeLimit=e,this.active={},this.record={},this.allEntityTypes=new Set,this.usedEntityTypes=new Set,this.activeWindowIds=new Set}update(e,t){Object.keys(this.active).forEach((e=>{this.active[e]=0})),this.activeWindowIds.clear(),e.forEach((e=>{const n=e.activeEntities.mainEntity.type;this.allEntityTypes.add(n),this.activeWindowIds.add(e.id),LR(this.active,n,this.entityTypeLimit),BR.has(n)&&this.usedEntityTypes.add(n),!this.isFirstUse(n)&&this.wasInPreviousUpdate(e,t)||LR(this.record,n,this.entityTypeLimit)}))}getStats(){return{popOutActive:this.active,popOutRecord:this.record,allEntityTypes:Array.from(this.allEntityTypes),usedEntityTypes:Array.from(this.usedEntityTypes),activeWindowIds:Array.from(this.activeWindowIds)}}isFirstUse(e){return!this.record[e]}wasInPreviousUpdate(e,t){const n=t.find((t=>t.id===e.id));return!!n&&n.activeEntities.mainEntity.type===e.activeEntities.mainEntity.type}}const VR=e=>e.isMainWindow||e.isNotificationsWindow,GR=e=>!VR(e),zR=e=>Object.keys(e).reduce(((t,n)=>t+e[n]),0),qR=e=>{const t=Object.keys(e).reduce(((t,n)=>{const i=e[n];return i&&i>0&&(t[n]=i),t}),{}),n=Object.keys(t);return 1===n.length?n[0]:void 0},JR=(e,t)=>{const n=Array.from(e).filter((e=>!e.windowLeakInfo?.windowLeakInfoWindowId||!t.includes(e.windowLeakInfo.windowLeakInfoWindowId))).map((e=>{const{windowLeakInfoEntityType:t=""}=e.windowLeakInfo??{};return e.viewportContext===st.R.primary?`main:${t}`:t}));return{allEntityTypes:Array.from(new Set(n)),memActive:n.reduce(((e,t)=>(e[t]=(e[t]||0)+1,e)),{})}};class QR{constructor({client:e,leakDetectorService:t,entityTypeStatsLimit:n,activeWindowsService:i}){let a;this.isBackInMain=!1,this.main=new UR(n??20),this.popOut=new HR(n??20),a=i?.enableDecoupleCommandingFromApollo?i.getActiveWindowsObservable():(0,fe.G)(e.watchQuery({query:jR})).pipe((0,m.h)((({errors:e,loading:t})=>void 0===e&&!t)),(0,d.U)((({data:{activeWindows:e}})=>(this.isBackInMain=e.some((e=>e.id===h.ew)),e)))),this._activeWindowsSubscription=a.pipe((0,fn.G)()).subscribe((([e,t])=>{this.update(e,t)})),this.leakDetectorService=t}destroy(){this._activeWindowsSubscription.unsubscribe()}getStats(){const e=this.leakDetectorService?.getReachableObjects(Fo.I.UnwrappedWindow),t=this.leakDetectorService?.getReachableObjects(Fo.I.WindowWrapper),{activeWindowIds:n,...i}=this.main.getStats(),{activeWindowIds:a,...o}=this.popOut.getStats(),r=zR(o.popOutActive),s={backInMain:this.isBackInMain?{allEntityTypes:i.allEntityTypes,usedEntityTypes:i.usedEntityTypes,backInMainActive:i.mainActive,backInMainActiveCount:zR(i.mainActive),backInMainContentRecord:i.mainContentRecord}:void 0,t2main:this.isBackInMain?void 0:{allEntityTypes:i.allEntityTypes,allLayoutModes:i.allLayoutModes,usedEntityTypes:i.usedEntityTypes,t2MainActive:i.mainActive,t2MainActiveCount:zR(i.mainActive),t2MainContentRecord:i.mainContentRecord},popOut:{...o,popOutActiveCount:r,hasActivePopout:r>0},mainActiveEntity:qR(i.mainActive),windowCount:e?.size,windowWrapperCount:t?.size,inMem:e?JR(e,[...n,...a]):void 0,windows:e?Array.from(e).map((e=>{const{windowLeakInfoEntityType:t,windowLeakInfoWindowId:n,windowLeakInfoStartTime:i,windowLeakInfoEndTime:a}=e.windowLeakInfo??{};return{windowLeakInfoWindowId:n,windowLeakInfoEntityType:t,viewportContext:e.viewportContext,windowLeakInfoStartTime:i,windowLeakInfoEndTime:a}})):void 0},l=(s.t2main?.t2MainActiveCount??0)+s.popOut.popOutActiveCount;return{...s,windowLeaks:void 0===s.windowCount?void 0:s.windowCount-l,windowWrapperLeaks:void 0===s.windowWrapperCount?void 0:s.windowWrapperCount-l}}update(e,t){this.main.update(t.filter(VR),e.filter(VR)),this.popOut.update(t.filter(GR),e.filter(GR))}}class KR{constructor(e){this.context=e,this.inited=!1,this.logger=e.loggerFactory.newLogger("WindowTrackerService","core-services-telemetry")}init(){if(!this.inited){const{client:e,leakDetectorService:t,coreSettings:n,activeWindowsService:i}=this.context,a=(this.logger.errorToTelemetry??this.logger.error).bind(this.logger);if(e){this.inited=!0;try{this.windowEntityTypeStats=new QR({client:e,leakDetectorService:t,entityTypeStatsLimit:n?.get(b.J.Core).entityTypeStatsLimit,coreSettings:n,activeWindowsService:i})}catch(e){a("Failed to initialize WindowEntityTypeStats","webclient_framework_window_tracker_service")}}else a("Failed to initialize WindowEntityTypeStats - missing client","webclient_framework_window_tracker_service")}}getTelemetry(){return this.inited||this.init(),this.windowEntityTypeStats?.getStats()}}function YR(e,t){const n=e.location.hostname;return t&&t!==n}var XR=n(564168);function ZR(e,t,n,i,a,o){const r=o&&o.delta||0,s=function(e,t,n){let i;if("share-to-teams"===e)i=function(e,t){let n;if(t.performance&&t.performance.navigation&&0===t.performance.navigation.type){const{s:i}=e.getSearchState();if(i)n=parseInt(i,10);else{const e="outlook"===t.document.head.dataset.host,i=t.localStorage.getItem(XR.qB.STT_START_TIME);e&&i&&(n=parseInt(i,10),t.localStorage.removeItem(XR.qB.STT_START_TIME))}}return n}(t,n);return i}(e,i,a),l=s?{name:H.ck.ClickTimeAction,timestamp:n-r}:void 0,c=l?[l]:[];o&&c.push({name:o.name,timestamp:n});const d=s||n-r,u=t.newScenario(H.RG.ExperienceReady,{startTime:d});c.forEach((e=>{u.mark(e.name,{overrideTimestamp:e.timestamp})}))}function ej(e,t,n,i,a,o={cached:!1}){const r={name:e,delta:0},s=function(e,t,n,i){let a;if(function(e,t){return!e.some((e=>t.getEntriesByName(e).length<=0))}([t,n],i))try{i.measure(e,t,n);const o=i.getEntriesByName(e)[0];a=o?.duration,a&&(a=Math.round(a)),i.clearMeasures(e)}catch(e){a=void 0}return a}(e,t,n,i.performance);return void 0!==s&&(r.delta=s,a.createScenarioWithoutStarting(e).stop({delta:s,cached:o.cached})),r}var tj=n(573571);class nj{constructor(e){this.telemetrySettings=null,this.disableColumnBlocker=!1,this.fixedColumnRules={},this.blockedColumnRules={},this.columnBlockingRules={},this.wildCardMergedTables={},this.wildCardTableEmpty=!0,this.updateColumnBlockingSettings=e=>{if(e){if(this.telemetrySettings=e,this.disableColumnBlocker=e.disableColumnBlocker||!1,this.disableColumnBlocker)return this.columnBlockingRules={},this.wildCardMergedTables={},void(this.wildCardTableEmpty=!0);let t={};e.blockedColumnRules&&(t=e.blockedColumnRules),this.blockedColumnRules=t;let n={};e.fixedColumnRules&&(n=e.fixedColumnRules),this.fixedColumnRules=n,this.generateRuleSet()}};e.getObservable(b.J.Telemetry).subscribe(this.updateColumnBlockingSettings),this.telemetrySettings=e.get(b.J.Telemetry),this.updateColumnBlockingSettings(this.telemetrySettings)}isContextColumnOk(e){return(0,W.isEmpty)(this.columnBlockingRules)||(0,W.isEmpty)(this.columnBlockingRules["*"])||(0,W.isEmpty)(this.columnBlockingRules["*"]["*"])||!this.columnBlockingRules["*"]["*"][e]}applyColumnBlockingRules(e,t,n,i){try{if(this.wildCardTableEmpty||this.wildCardMergedTables[e]||(this.columnBlockingRules[e]=(0,W.merge)(this.columnBlockingRules[e],this.columnBlockingRules["*"]),this.wildCardMergedTables[e]=!0),(0,W.isEmpty)(this.columnBlockingRules[e]))return;(0,W.isEmpty)(this.columnBlockingRules[e][t])?(0,W.isEmpty)(this.columnBlockingRules[e]["*"])||this.blockEventPropertyColumn(this.columnBlockingRules[e]["*"],n,i):this.blockEventPropertyColumn(this.columnBlockingRules[e][t],n,i)}catch{return void n.setProperty("diagBlockedColumns",(0,$.XC)({parseFailed:!0}))}}blockEventPropertyColumn(e,t,n){const i=t.properties,a={},o=n?.packedData;(0,W.forEach)(e,((e,t)=>{(0,W.isEmpty)(i[t])||(i[t].value="",a[t]=e),o&&o.forEach((n=>{n[t]&&(n[t]=void 0,a[t]=e)}))})),(0,W.isEmpty)(a)||t.setProperty("diagBlockedColumns",(0,$.XC)(a))}generateRuleSet(){try{this.columnBlockingRules={},this.wildCardMergedTables={};const e=this.blockedColumnRules["*"],t=this.fixedColumnRules["*"];(0,W.forEach)(this.blockedColumnRules,((n,i)=>{if((0,W.isEmpty)(n))return;(0,W.isEmpty)(e)||"*"===i||(n=(0,W.merge)(n,e));!(0,W.isEmpty)(this.fixedColumnRules)&&!(0,W.isEmpty)(this.fixedColumnRules[i])&&!(0,W.isEmpty)(t)&&"*"!==i&&(this.fixedColumnRules[i]=(0,W.merge)(this.fixedColumnRules[i],t)),this.columnBlockingRules[i]={};const a={};(0,W.isEmpty)(n["*"])||this.mergeBlockedColumnsRulesForAllEventType(n,i,a),(0,W.isEmpty)(a)||(this.columnBlockingRules[i]["*"]=a),this.mergeBlockedColumnsRulesForEveryEventType(n,i,a),(0,W.isEmpty)(this.columnBlockingRules[i])?delete this.columnBlockingRules[i]:this.wildCardMergedTables[i]=!0})),this.wildCardTableEmpty=(0,W.isEmpty)(this.columnBlockingRules["*"])}catch{return}}mergeBlockedColumnsRulesForAllEventType(e,t,n){(0,W.forEach)(e["*"],((e,i)=>{e>(this.fixedColumnRules[t]&&this.fixedColumnRules[t]["*"]&&this.fixedColumnRules[t]["*"][i]||0)&&(n[i]=e)}))}mergeBlockedColumnsRulesForEveryEventType(e,t,n){(0,W.forEach)(e,((e,i)=>{"*"!==i&&((0,W.isEmpty)(this.fixedColumnRules[t])||(0,W.isEmpty)(this.fixedColumnRules[t][i])?this.columnBlockingRules[t][i]=(0,W.merge)(e,n):(this.columnBlockingRules[t][i]={},(0,W.forEach)(e,((e,n)=>{e>(this.fixedColumnRules[t][i][n]||0)&&(this.columnBlockingRules[t][i][n]=e)})),this.columnBlockingRules[t][i]=(0,W.merge)(this.columnBlockingRules[t][i],n),(0,W.isEmpty)(this.columnBlockingRules[t][i])&&delete this.columnBlockingRules[t][i]))}))}}var ij=n(981789),aj=n(736149),oj=n(157551),rj=n(238518),sj=n(924894);class lj extends sj.t{constructor(e,t){super(),this.logger=e,this.port=t,this.contextFilter=aj.P,this.port.onmessage=e=>{if(!e||!e.data||!e.data.name)return;const t=this.messageHandlers[e.data.name];t&&t(e.data.params)}}postMessage(e,t){["initialize","batch","newLogger"].includes(e)?this.port.postMessage({operation:e,params:t,source:"lite-worker-proxy",channel:this.logger}):"setContext"===e?this.setContextHandler(t):"logEvent"===e&&this.logEventHandler(t)}setContextHandler(e){e&&e.key&&e.value&&this.contextFilter.has(e.key)&&this.port.postMessage({operation:"setContext",params:e,source:"lite-worker-proxy",channel:this.logger})}logEventHandler(e){e&&e.key&&e.value&&(e.key=this.logger,this.port.postMessage({operation:"logEvent",params:e,source:"lite-worker-proxy",channel:this.logger}))}}class cj extends sj.t{constructor(e){super(),this.messager=e,e.onmessage=e=>{e.data&&this.messageHandlers[e.data.name]?.(e.data.params)}}postMessage(e,t,n){this.messager.postMessage({name:e,params:t},{transfer:n})}}class dj extends sj.t{constructor(e,t){super(),this.sharedWorkerUrl=t,this.worker=this.createSharedWorker(e,this.sharedWorkerUrl)}initialize(){}postMessage(e,t){try{this.worker.port.postMessage({name:e,params:t})}catch(e){console.warn(e)}}createSharedWorker(e,t){const n=t?new SharedWorker(t):e;return n.port.onmessage=e=>{if(!e||!e.data||!e.data.name)return;const t=this.messageHandlers[e.data.name];t&&t(e.data.params)},n}}const uj=(e,t,i)=>{const{url:a,hashParams:o}=i;if(e){const e=SharedWorker;SharedWorker=mj(e,t,o);const i=a?new dj(void 0,a):new dj(new SharedWorker(n.tu(new URL("/v2/worker/"+n.u(432871),n.b))));return SharedWorker=e,i}{const e=Worker;Worker=mj(e,t,o);const i=new cj(new Worker(n.tu(new URL("/v2/worker/"+n.u(573258),n.b))));return Worker=e,i}},mj=(e,t,n)=>class{constructor(i){try{return new e(t(n?`${i}#${(0,$.u4)(n)}`:i))}catch(n){return new e(t(i))}}};var pj=n(370753),gj=n(282210);const hj="Teams",yj=/(windows|win32)/i,vj=/ arm;/i,fj=/windows\sphone\s\d+\.\d+/i,Sj=/(macintosh|mac os x|mac)/i,kj=/(iPad|iPhone|iPod)(?=.*like Mac OS X)/i,Cj=/(linux|joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)/i,bj=/android/i,wj=(h.ZW,h.ZW,(e,t,n,i)=>{const a=n.telemetryLiteExperiencePort?n.telemetryLiteExperiencePort:void 0;if(i){if(a)return()=>new lj(n.experienceName,a);{const n=e.get(b.J.Telemetry).workerEnabled??!1,a=e.get(b.J.Telemetry).enableSharedWorker??!1;if(n){const{coreSecurityService:n,windowBaseUrl:o}=i,r=n.getTrustedTypePolicy("@msteams/core-services-telemetry-worker#TelemetryWorker"),s=e=>r.createScriptURL(e,o);return()=>{const n=uj(a,s,{hashParams:{publicPath:t.__webpack_public_path__}});return new gj.A(n,e).init(),n}}return()=>new rj.v(new pj.N)}}return()=>new rj.v(new pj.N)}),Tj=(e,t,n=aj.h.default)=>{tj.H.getInstance().initialize(t);const i=new nj(t);return ee.ip.getInstance().initialize(e,n),{eventSuppression:tj.H.getInstance(),columnSuppression:i,telemetrySender:ee.ip.getInstance()}},Ij=(e,t,n,i,a,o=aj.h.default)=>{const{userAgent:r}=n.config,{deviceId:s,sessionId:l,sessionStartTime:c}=n.host,d=a?An.Bh.CDLWorker:Ln(n),u=i.get(b.J.Telemetry),{defaultToken:m,enableSharedWorker:p,isSilent:g,telemetryServer:y,enableCustomCacheSize:v,eventsLimitInMem:f,normalPrioritySendTimeInSecs:S,highPrioritySendTimeInSecs:k,autoFlushPercent:C,enableOneDsSdkNs:w,oneDsCollectorUrl:T,enableCompression:I,enablePrivacyGuard:N,enableLoggingGlobalDeviceId:E,privacyGuardIngestionToken:A,disableMTMAPrimaryId:_,debugMenuCaptureContext:F,debugMenuCaptureEvents:D,enableSDKContextOverrides:P}=u,{sharedWorkerUrl:M}=i.get(b.J.Host),x=i?.get(b.J.Core)?.enableMTMA;if(!y||!m)throw t.error("Telemetry server url or app token not supplied. This is required by Aria"),(0,de.Tr)("telemetry-initialization",h.jK.Undefined,"init");const R=(e=>{let t=e;return t||(t=(0,Re.v4)()),t})(s),j=e.windowType!==oj.N.Anglr?"NS":"",L={userAgent:r,firstLaunchTime:e.appStartTime,tablePostfix:j,deviceId:R},O={debugMenuCaptureContext:!!F,debugMenuCaptureEvents:!!D},$=new ij.Mk;return $.collectorUrl=y,v&&f&&($.eventsLimitInMem=f),e.telemetryLiteExperiencePort&&(o=e.experienceName),{config:$,appTokens:{default:m},documentInfo:L,debugMenuSettings:O,isSilent:!!g,sessionId:l||void 0,sessionStartTime:c,clientType:d,sharedWorkerUrl:M||void 0,enableSharedWorker:!!p,eventsLimitInMem:f||3e3,normalPrioritySendTimeInSecs:S||15,highPrioritySendTimeInSecs:k||15,autoFlushPercent:C||.33,enableOneDsSdkNs:!!w,oneDsCollectorUrl:T||void 0,enableCompression:!!I,enablePrivacyGuard:!!N,enableLoggingGlobalDeviceId:!!E,privacyGuardIngestionToken:A||void 0,enableMTMA:x||void 0,disableMTMAPrimaryId:!!_,defaultLoggerName:o,enableSDKContextOverrides:!!P}},Nj=(e,t,n,i,a)=>{const{platformService:o,logger:r,coreSettings:s,scenarioFactory:l,columnSuppression:c,telemetryContext:d,experimentationService:u,i18nInfo:m}=n,{browser:p,browserVersion:g,clientContext:y,clientVersion:v,cpuArchitecture:f,osPlatform:S,osVersion:k,platformId:C,pullRequestId:w,buildId:T}=o.config,I=a?An.Bh.CDLWorker:Ln(o),{bootType:N,panelContext:E,sessionId:A,startReason:_}=o.host,F=s.get(b.J.Telemetry),{defaultToken:D,telemetryServer:P,disableRingNamePrefixing:M,disablePlatformServiceOsVersion:x}=F,R=s.get(b.J.Metadata),{hostAppWebVersion:j}=s.get(b.J.Host),L=(0,ii.Yf)();if(L.initialize({...t,services:{coreSettings:s,scenarioFactory:l,logger:r,columnSuppressionService:c},workerOptions:i},r),!P||!D)throw r.error("Telemetry server url or app token not supplied. This is required by Aria"),(0,de.Tr)("telemetry-initialization",h.jK.Undefined,"init");const O=R.environment===pt.s.life?BP.OV.Life:BP.OV.Work,$=yM(R,Ej(!!M,e,a),u),U=t.documentInfo,B=$.ring,W=xj(U.userAgent),H=jj(U.userAgent),V=Oj(S),G=$j(S);let z=f;"Mac OS X"===G&&(z="x64");const q=Bj();d.setContext("AppInfo.ClientType",e.clientTypeTelemetry??I),d.setContext("AppInfo.ClientContext",y),d.setContext("AppInfo.HostAppVersion",W),d.setContext("AppInfo.ProcessArchitecture",H),d.setContext("AppInfo.WebVersion",j),j&&d.setContext("AppInfo.HostAppWebVersion",Mj(j)),d.setContext("AppInfo.Language",m.localeCode),d.setContext("AppInfo.Locale",m.localeCode),d.setContext("AppInfo.PlatformId",C);const J=Rj(v,j);return F.enableEnhancedTelemetry?d.setContext("AppInfo.Version",J):d.setContext("AppInfo.Version",v),d.setContext("AppInfo.VersionNew",J),d.setContext("AppInfo.PullRequestId",w),d.setContext("AppInfo.BuildId",T),d.setContext("AppInfo.ReactAppVersion",v),d.setContext("AppInfo.ExperienceName",e.experienceName),d.setContext("DeviceInfo.OsName",G),x||d.setContext("DeviceInfo.OsVersion",k),d.setContext("DeviceInfo.OsFamily",V),d.setContext("DeviceInfo.CpuArchitecture",z),d.setContext("EventInfo.isNS",!0),d.setContext("Panel.Context",E),d.setContext("Session.Id",A),d.setContext("startReason",_),d.setContext("UserInfo.Language",m.userLanguage),d.setContext("UserInfo.Ring",B),d.setContext("UserInfo.TimeZone",q),d.setContext("userAgent",U.userAgent),d.setContext("Window.Type",e.windowType),d.setContext("DeviceInfo.BrowserName",p),d.setContext("DeviceInfo.BrowserVersion",g),d.setContext("DeviceInfo.Id",U.deviceId),d.setContext("Tenant.Model",O),d.setContext("Session.TelemetryContext","web"),d.setContext("AppInfo.BootType",N),d.setContext("UserInfo.UserLocale",m.originLocaleCode),d.setContext("UserInfo.OSorBrowserLocale",An.Bh.Desktop===I||An.Bh.Maglev===I?m.osLocale:m.userLanguage),d.setContext("telemetryRegionFetchComplete",F.telemetryRegionFetchComplete),d.setContext("UserInfo.TelemetryRegion",F.telemetryRegion),Aj(s,d,e,a,u),_j(s,d),Dj(J,s,d),Fj(s,d),{provider:L}},Ej=(e,t,n)=>!(!n||"react-web-client"!==t.experienceName)||e,Aj=(e,t,n,i,a)=>{const o=e.getObservable(b.J.Metadata),{disableRingNamePrefixing:r}=e.get(b.J.Telemetry);if(o.subscribe((e=>{a?.updateWebExperimentConfigMetadata(e),a?.communicateWithHost();const o=yM(e,Ej(!!r,n,i),a);t.setContext("UserInfo.Ring",o.ring),t.setContext("UserInfo.ETag",o.eTag),t.setContext("UserInfo.HostETag",o.hostETag),t.setContext("AppInfo.ExpIds",o.expIds),t.setContext("AppInfo.ExpRolloutIds",o.rolloutIds),t.setContext("AppInfo.Environment",o.environment)})),a){a.ecmObservable.subscribe((e=>{const n=e.find((e=>e.client===pM)),i=e.map((e=>e.config.expIds)).filter((e=>e.length>0)).join(","),a=vM(e).join(",");t.setContext("UserInfo.HostETag",n?.config.eTag),t.setContext("AppInfo.ExpIds",i),t.setContext("AppInfo.ExpRolloutIds",a)}))}},_j=(e,t)=>{e.getObservable(b.J.UserResources).subscribe((e=>{const n=e.licenseType||void 0;t.setContext("UserInfo.LicenseType",n)}))},Fj=(e,t)=>{e.getObservable(b.J.Smb).subscribe((e=>{const n=e.tenantSizeSegment||void 0;t.setContext("Tenant.SmbTenantSizeSegment",n)}))},Dj=(e,t,n)=>{t.getObservable(b.J.Host).subscribe((i=>{i&&Pj(e,t,n,i)}))},Pj=(e,t,n,i)=>{const{enableEnhancedTelemetry:a,enableGetUserTypeFromHost:o}=t.get(b.J.Telemetry),r=i.desktopVersion||void 0,s=r?e.concat(",",r):e;r&&n.setContext("AppInfo.DesktopVersion",r),n.setContext("AppInfo.VersionNew",s),i.systemManufacturer&&n.setContext("DeviceInfo.Make",i.systemManufacturer),i.systemProductName&&n.setContext("DeviceInfo.Model",i.systemProductName),n.setContext("rendererCount",i.rendererCount),a&&n.setContext("AppInfo.Version",s),n.setContext("AppInfo.WebVersion",i.hostAppWebVersion),i.hostAppWebVersion&&n.setContext("AppInfo.HostAppWebVersion",Mj(i.hostAppWebVersion)),o&&i.userType&&n.setContext("userType",i.userType)},Mj=e=>{let t="";const n=e.indexOf("/");return n>-1&&(t=e.substring(n+1,e.length)),t},xj=e=>{let t;const n=e.indexOf(hj);if(n>-1){t=e.substring(n+5+1);const i=t.indexOf(" ");t=t.substring(0,i)}return t},Rj=(e,t)=>t?e.concat(",",t):e,jj=e=>{let t=BP.Wz.unknown;return Uj(e,BP.Wz.x64)?t=BP.Wz.x64:Uj(e,BP.Wz.x86)?t=BP.Wz.x86:Uj(e,BP.Wz.ia32)&&(t=BP.Wz.ia32),t},Lj=(e,t)=>{if(t.telemetryLiteExperiencePort)return"lite";const n=e.get(b.J.Telemetry),i=n.workerEnabled,a=n.enableSharedWorker;return i?a?"shared":"dedicated":"embed"},Oj=e=>{let t=BP.Zc.UNKNOWN;const n=e?.match(yj)||e?.match(vj)||e?.match(fj),i=e?.match(Cj)||e?.match(bj),a=e?.match(Sj)||e?.match(kj);return n?t=BP.Zc.WINDOWS:i?t=BP.Zc.UNIX:a&&(t=BP.Zc.MACOSX),t},$j=e=>{switch(e){case An.NR.Windows:return"Windows";case An.NR.Mac:return"Mac OS X";case An.NR.Linux:return"Linux";case An.NR.ChromeOS:return"Chrome OS";case An.NR.Android:return"Android";case An.NR.IOS:return"iOS";case An.NR.WindowsPhone:return"Windows Phone";case An.NR.Unknown:return"Unknown";default:return e}},Uj=(e,t)=>!!(e.indexOf(t)>-1),Bj=()=>{const e=(new Date).getTimezoneOffset();let t=e%60,n=(e-t)/60;const i=n>0?"-":"+";t=Math.abs(t),n=Math.abs(n);const a=t<10?`0${t}`:t.toString();return`${i}${n<10?`0${n}`:n.toString()}:${a}`};var Wj=n(656710);class Hj extends _e{constructor(){super(h.Yg.InitTelemetry,["coreSettings","coreSettingsContext","diagnosticsService","hostCommunicationService","loggerFactory","telemetryContextService","windowProvider"])}async execute(e){const t=e.loggerFactory.newLogger("init-telemetry-task","core-services-tasks"),n=e.coreSettings.get(b.J.Telemetry),i=this.createMemoryAnalyzer(e.windowProvider,n);n.disableAriService||(e.appResponsivenessService=new fR(e.windowProvider,{loggerFactory:e.loggerFactory,windowProvider:e.windowProvider,coreSettings:e.coreSettings,hostCommunicationService:e.hostCommunicationService})),n.enableInpService&&n.heartbeatConfiguration?.inpMetricsCollection?.enabled&&(e.interactionToNextPaintService=new ER(e)),e.dataClientTrackingService=this.createDataClientTrackerService(e),this.createWindowTrackerService(e),await this.createHeartbeatMonitor(e);const{crossClientRegistrationMethods:a,desktopActiveScenarios:o,desktopContext:r,deviceInfo:s,finalizeLegacyCrossClient:l,notifyDesktopScenarioFactoryReady:c,registerForCoreContext:d,systemCpuInfo:u,systemMemoryInfo:m}=await this.initializeCrossClientTelemetry(t,e.hostCommunicationService),p={deviceInfo:s,systemCpuInfo:u,systemMemoryInfo:m},g=this.createCoreScenarioFactory(e,i,l,o,a),h=new DM(g,e.telemetryContextService,i,{isolateUserContext:e.coreSettings.get(b.J.Telemetry).isolateUserContext??!1});return d?.(((e,t)=>{h.setCoreContext(e,t)})),c?.(),e.hostCommunicationService?.setScenarioFactory(g),e.diagnosticsService.setScenarioFactory(g),e.coreSettingsContext.setScenarioFactory(g),await this.createCoreTelemetryService(e,i,g,p,e.telemetryContextService,r),e.windowProvider?.loader?.stopPieTimer?.(),this.createCoreUserBiService(e),this.startAppStartScenarios(e,g),e.altScenarioService=new AR({host:e.windowProvider,loggerFactory:e.loggerFactory,coreSettings:e.coreSettings,scenarioFactory:g}),e.hostCommunicationService&&await this.handOffContextCommsCallback(e.hostCommunicationService,e.coreSettings,h),Vj(h)}async initializeCrossClientTelemetry(e,t){const n={};if(t){try{const e=await t.loadModule("scenario");e&&(e.getActiveScenarios&&(n.desktopActiveScenarios=await e.getActiveScenarios({})),e.setScenarioCompletion&&(n.finalizeLegacyCrossClient=e.setScenarioCompletion),n.crossClientRegistrationMethods={},e.registerForScenarioMark&&e.registerForScenarioStart&&e.registerForScenarioStop&&(n.crossClientRegistrationMethods.marks={registerForScenarioStart:e.registerForScenarioStart,registerForScenarioMark:e.registerForScenarioMark,registerForScenarioStop:e.registerForScenarioStop}),e.registerForScenarioAppendEventData&&(n.crossClientRegistrationMethods.appendEventData=e.registerForScenarioAppendEventData),n.notifyDesktopScenarioFactoryReady=()=>{e.setWebAvailability?.(!0)})}catch(t){e.errorToTelemetry&&e.errorToTelemetry(Ms.LoadModuleScenarioFailed,"webclient_framework_host_comms",void 0,!0)}try{const e=await t.loadModule("osutils");e&&(n.deviceInfo=await(e.getDeviceInfo?.()),n.systemCpuInfo=await(e.getSystemCpuInfo?.()),n.systemMemoryInfo=await(e.getSystemMemoryInfo?.()))}catch(t){e.errorToTelemetry&&e.errorToTelemetry(Ms.LoadModuleOsUtilsFailed,"webclient_framework_host_comms",void 0,!0)}try{const e=await t.loadModule("telemetry"),i=e?.registerForOnNewContext;i&&(n.registerForCoreContext=e=>{i((t=>{t.filter((e=>void 0===e.userContextId)).forEach((t=>e(t.column,t.value)))}))}),n.desktopContext=await(e?.getContext?.({columns:["launchIntent","desktopVersion","deviceAuthToken","windowsChannel","windowsSku","storageInfo","outOfProcState","installationSource"]}))}catch(t){e.errorToTelemetry&&e.errorToTelemetry(Ms.LoadModuleTelemetryFailed,"webclient_framework_host_comms",void 0,!0)}}return n}async handOffContextCommsCallback(e,t,n){const i=await e.loadModule("telemetry"),a=await(i?.getPreAuthUserSamplingId?.());if(a&&this.setPreAuthUserId?.(t,n,a),i&&i.setContext){const e=i.setContext;(0,ii.Yf)().setMultiContextCallback(((t,n,i)=>e([{column:t,value:n,userContextId:i}])))}if(i&&i.setCollectorContext){const e=i.setCollectorContext;(0,ii.Yf)().setCollectorContextCallback(((t,n,i)=>e({enableTelemetryRegionReinit:t,telemetryRegion:n,telemetryRegionFetchComplete:i})))}}createMemoryAnalyzer(e,t){const{enableDesktopMemoryAnalyzer:n,isScenarioMemorySnapshotEnabled:i}=t;return n?new _R(!!i,e):void 0}createCoreScenarioFactory(e,t,n,i,a){const o=new lM({parentScenarioFactory:e.scenarioFactory,settings:aM(e.coreSettings),platformService:e.platformService,loggerFactory:e.loggerFactory,hostCommunicationService:e.hostCommunicationService,windowProvider:e.windowProvider,authenticationUser:e.authenticationUser,correlation:e.correlation},e.config.startTimeMS,t,void 0,void 0,void 0,void 0,i,a,n);return e.scenarioFactory=o,o}async createHeartbeatMonitor(e){const t=new SD.K(e);await t.start(),e.heartbeatMonitor=t}createDataClientTrackerService(e){const t=[Fe.pk.Inactive,Fe.pk.LongInactive],n=[h.eT.Inactive,h.eT.LongInactive],i=e.platformService.config.clientType===An.Bh.Maglev?()=>!!e.clientState&&t.includes(e.clientState.getState()):()=>!!e.appStateService&&n.includes(e.appStateService.getState());return new RR(e.coreSettings,e.leakDetectorService,e.userTrackingService,i)}createWindowTrackerService(e){e.windowTrackerService=new KR(e)}async createCoreTelemetryService(e,t,n,i,a,o){const{config:r,coreSettings:s,coreSecurityService:l,experimentationService:c,hostCommunicationService:d,loggerFactory:u,platformService:m,routingServices:p,windowProvider:g}=e,h=await hF(d),y=Pn(g),v={osLocale:h,userLanguage:gF(g),localeCode:yF(g,p,y.localeCode),originLocaleCode:vF(g,p,y.localeCode)},{telemetryContext:f,provider:S}=((e,t,n,i,a,o)=>{const{loggerFactory:r,coreSettings:s,platformService:l,scenarioFactory:c,host:d}=n,u=r.newLogger("Telemetry","core-services-telemetry"),m=Ij(e,u,l,s,!1),p=a||new RP(u),{columnSuppression:g}=Tj(u,s,m.defaultLoggerName),h=wj(s,d,e,i),y=Lj(s,e),{provider:v}=Nj(e,m,{logger:u,platformService:l,coreSettings:s,telemetryContext:p,i18nInfo:t,experimentationService:o,columnSuppression:g,loggerFactory:r,scenarioFactory:c},{workerType:y,workerSetup:h},!1);return{provider:v,telemetryContext:p}})({appStartTime:r.startTimeMS,experienceName:r.experienceName,windowType:r.windowType,clientTypeTelemetry:r.clientTypeTelemetry,telemetryLiteExperiencePort:r.telemetryLiteExperiencePort},v,{loggerFactory:u,platformService:m,coreSettings:s,scenarioFactory:n,host:g},{coreSecurityService:l,windowBaseUrl:g.document.location.origin},a,c);S.eventCapture=new Wj.t(g,s,S.eventCapture);const k=new DM(n,f,t,{isolateUserContext:s.get(b.J.Telemetry).isolateUserContext??!1});if(g.localStorage){const e=g.localStorage.getItem("ts.latestOid");k?.setContext("UserInfo.Id",e)}r.externalCorrelationId&&k.setCoreContext("EventInfo.ExternalCorrelationId",r.externalCorrelationId),r.embedContext&&(k.setCoreContext("Window.EmbedContext",r.embedContext),k.setCoreContext("AppInfo.EmbedReferrer",function(e,t){try{const{referrer:n}=t.getSearchState(),i=e.document.referrer,a=e.parent.opener;let o=n;return YR(e,o)||(o=i&&(0,Qo.Lp)(i),YR(e,o)||(o=a&&a.location&&a.location.hostname||void 0,!YR(e,o)&&e.location.ancestorOrigins&&e.location.ancestorOrigins.length>0&&(o=e.location.ancestorOrigins[0]))),o||""}catch(e){return""}}(g,p.state))),this.setTelemetryContext(k,i,o),k.setCoreContext("AppInfo.ArchVersion","V2"),e.telemetryService=k}setPreAuthUserId(e,t,n){const i=e.get(b.J.Telemetry);n&&i.enablePreAuthIdSampling&&(t.setCoreContext("AppInfo.PreAuthUserSamplingId",n),tj.H.getInstance().setSamplingByPreAuthId(n))}createCoreUserBiService(e){const{config:t}=e,n=e.telemetryService?.createUserBiService(e,h.ew,{id:(0,Re.v4)(),source:C.D.StandAlone,startTimestamp:t.startTimeMS});e.userBiService=n}setTelemetryContext(e,t,n){const{deviceInfo:i,systemCpuInfo:a,systemMemoryInfo:o}=t;if(i&&(e.setCoreContext("DeviceInfo.Make",i.make),e.setCoreContext("DeviceInfo.Model",i.model),e.setCoreContext("DeviceInfo.CpuArchitecture",i.cpuArchitecture),e.setCoreContext("DeviceInfo.OsVersion",i.osVersion)),a&&(e.setCoreContext("CpuInfo.Cores",a.cpuCores.length.toString()),e.setCoreContext("CpuInfo.Model",a.cpuCores[0].model),e.setCoreContext("CpuInfo.Speed",a.cpuCores[0].speed)),o&&e.setCoreContext("DeviceInfo.TotalMemory",o.totalPhysicalMemoryBytes),n&&0!==n.length){const t=n.reduce(((e,t)=>({...e,[t.column]:t.value})),{}),i=t.launchIntent,a=t.desktopVersion,o=t.deviceAuthToken,r=t.windowsChannel,s=t.windowsSku,l=t.storageInfo,c=t.outOfProcState,d=t.installationSource;i&&e.setCoreContext("AppInfo.LaunchIntent",i),a&&e.setCoreContext("AppInfo.DesktopVersion",a),c&&e.setCoreContext("AppInfo.OutOfProcState",c),o&&e.setDeviceAuthToken(o),r&&e.setCoreContext("DeviceInfo.WindowsChannel",r),s&&e.setCoreContext("DeviceInfo.WindowsSku",s),l&&e.setCoreContext("DeviceInfo.StorageInfo",l),d&&e.setCoreContext("installationSource",d)}}startAppStartScenarios(e,t){const{config:n,routingServices:i,telemetryService:a,windowProvider:o}=e,r=this.getDownloadAndParseStepData(t,o);a?.newCoreScenario(H.RG.AppStart,{startTime:n.startTimeMS}),ZR(n.experienceName,t,n.startTimeMS,i.state,o,r)}getDownloadAndParseStepData(e,t){let n;if(t.performance){t.performance.timing&&e.createScenarioWithoutStarting(H.RG.DomLoadingStart,{startTime:t.performance.timing.domLoading}).stop();const i=t.performance.getEntriesByType("resource").find((e=>"script"===e.initiatorType&&e.name.indexOf("main")>=0)),a=void 0!==i&&0===i.transferSize;n=ej(H.RG.DownloadAndParse,"execute-index-html-script","start-execute-main-bundle",t,e,{cached:a}),ej(H.RG.ResolveMainImports,"start-execute-main-bundle","resolve-main-imports-end",t,e)}return n}}const Vj=async e=>async t=>{if("quit"===t)e?.getTelemetryServicesCache().forEach((e=>e.coreScenarioFactory.incompleteRunningScenarios?.())),await(0,ii.Yf)().flush()};var Gj=n(27646);class zj extends _e{constructor(){super(h.Yg.InitUserBrbServiceTask,["activeWindowsService","scenarioFactory","loggerFactory","coreSettings","logsCollectorService","authenticationService","authenticationUser","platformService","discover","windowProvider","hostCommunicationService","endpointsManager","brbServiceManager","client","i18n"])}async execute(e){const{activeWindowsService:t,scenarioFactory:n,loggerFactory:i,coreSettings:a,logsCollectorService:o,authenticationService:r,authenticationUser:s,platformService:l,discover:c,windowProvider:d,hostCommunicationService:u,endpointsManager:m,brbServiceManager:p,client:g,i18n:h}=e;if(!s)throw new Error("authenticationUser is invalid, cannot register user brb service.");const y=(0,xe.b4)(s);return p.registerUserBrbService(y,(()=>new Gj.w(i,a,o,r,l,c,d,u,m,n,h,t,s,g))),e=>{"signout"===e&&p.unregisterUserBrbService(y)}}}class qj extends _e{constructor(){super(h.Yg.InitializePulsarTask,["coreSettings","loggerFactory","platformService"])}async execute(e){const{coreSettings:t,loggerFactory:n,platformService:i}=e,a=new ho(co.TEAMS_CORE,{sessionId:i.host.sessionId,spanExporter:new yo,loggerFactory:n,logToOTLCollector:!!t.get(b.J.Pulsar).logToOTLCollector});t.get(b.J.Pulsar).enablePulsarTelemetry&&await a.initialize(),e.pulsar=a}}class Jj extends _e{constructor(){super(h.Yg.RegisterCustomFrameThemes,["coreSettings","hostCommunicationService"])}async execute(e){const{coreSettings:t,hostCommunicationService:n}=e,{primaryWindowTitleBarHeightPx:i,secondaryWindowTitleBarHeightPx:a}=t.get(b.J.Core),o=await n.loadModule("windowcontrols");i&&a&&(o?.defineCustomFrameTheme?.("main",{buttonHeight:i,buttonWidth:44}),o?.defineCustomFrameTheme?.("default",{buttonHeight:a,buttonWidth:44}),o?.defineCustomFrameTheme?.("mainClassic",{buttonHeight:i,buttonWidth:44,light:{closeColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#c4314bff",mouseDown:"#a72037ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}},minMaxColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#4f52b2ff",mouseDown:"#3d3e78ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}}}}),o?.defineCustomFrameTheme?.("defaultClassic",{buttonHeight:a,buttonWidth:44,light:{closeColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#c4314bff",mouseDown:"#a72037ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}},minMaxColors:{background:{normal:"#444791ff",inactive:"#44479199",mouseOver:"#4f52b2ff",mouseDown:"#3d3e78ff"},foreground:{normal:"#ffffffff",inactive:"#ffffff99",mouseOver:"#ffffffff",mouseDown:"#ffffffff"}}}}))}}class Qj extends _e{constructor(){super(h.Yg.ReloadExperience,["coreSettings","platformService","rebootService","loggerFactory","scenarioFactory","windowProvider"]),this.isReloadRequired=(e,t)=>e&&t&&e!==t}async execute(e){const{coreSettings:t,platformService:n,rebootService:i,loggerFactory:a,scenarioFactory:o,windowProvider:r}=e,s=a.newLogger("ReloadExperienceTask","core-services-tasks"),{buildRing:l,assignedRing:c}=this.getRings(n,t);if(this.isReloadRequired(l,c)&&c){s.log(`Reload required: Assigned: ${c}, Build: ${l}`);return await i.rebootApp(Dr.Z.RingSwitch,Dr.d.ReloadAppTask,{qsps:{ring:c},maxRetries:1})?this.deleteEcsCaches(r):this.reportReloadNotTriggered(l,c,s,o),e=>{"signout"===e&&i.clearRetryCount(Dr.d.ReloadAppTask)}}s.debug(`No reload required: Assigned: ${c}, Build: ${l}`),i.clearRetryCount(Dr.d.ReloadAppTask)}getRings(e,t){const{ring:n}=t.get(b.J.Metadata);return{assignedRing:n?.id||void 0,buildRing:e.ecsOverrides.ring||void 0}}reportReloadNotTriggered(e,t,n,i){n.warn(`Ring Discrepancy: Assigned: ${t}, Build: ${e} `),i.createScenarioWithoutStarting(H.RG.BuildRingDiscrepancy).fail({message:e})}deleteEcsCaches(e){Object.keys(e.localStorage).filter((e=>e.endsWith(bp.EcsCache))).forEach((t=>e.localStorage.removeItem(t)))}}class Kj extends _e{constructor(){super(h.Yg.SetAppStateToTelemetryTask,["telemetryService","hostState","networkState","coreSettings"])}async execute(e){const{telemetryService:t,hostState:n,networkState:i,coreSettings:a}=e;a.get(b.J.Telemetry).enableTelemetryCancelOnSuspendAndNetworkOffline&&(n&&t.initTelemetrySuspendStateSubscription(n,a.get(b.J.Telemetry).scenarioCancelOnSuspendStateChangeBlockList??[]),i&&t.initTelemetryNetworkStateSubscription(i,a.get(b.J.Telemetry).scenarioCancelOnNetworkStateChangeBlockList??[]))}}const Yj=";path=/;secure;samesite=none;partitioned";class Xj extends _e{constructor(){super(h.Yg.SetRingFinderCookieTask,["authenticationUser","coreSettings","loggerFactory","windowProvider","discover","i18NextWrapper"]),this.setAuthCookie=(e,t,n,i)=>{if(void 0===e.document?.cookie)return void t.warn(`Cannot set cookie: '${n}'.`);t.log(`Setting '${n}' cookie.`);const a=new Date,o=a.setMonth(a.getMonth()+5);e.document.cookie=`${n}=${i};expires=${new Date(o).toUTCString()}${Yj}`},this.subscribeToCountryCode=(e,t,n,i,a)=>{const o=t?.getObservable(b.J.Metadata,["countryCode"]);this.metadataSettingsSubscription=o?.subscribe((({countryCode:o})=>{const{enableCountryInRingFinder:r}=t.get(b.J.Core);r&&o&&o!==a.country&&(a.country=o,this.setAuthCookie(e,n,i,encodeURIComponent((0,$.u4)(a))))}))},this.cleanUpCookie=(e,t,n)=>{void 0!==e.document?.cookie&&(t.log(`Expiring '${n}' cookie.`),e.document.cookie=`${n}=;max-age=0${Yj}`)}}async execute(e){const{authenticationUser:t,coreSettings:n,discover:i,loggerFactory:a,windowProvider:o,i18NextWrapper:r}=e,s=a.newLogger("SetRingFinderCookieTask","core-services-tasks");try{const{windowsInsiderChannel:e,windowsInsiderRing:a}=n.get(b.J.Host),{enableRegionParamForPDS:l,enableLocaleInRingFinder:c,enableCountryInRingFinder:d}=n.get(b.J.Core);let u;l&&(u=await i.getRegion({id:t.id,tenantId:t.profile.tenantId,oid:t.profile.objectId,accountType:t.type,userName:t.loginUserName||""}));const m=c?r.locale:void 0,{countryCode:p}=n.get(b.J.Metadata),g=d?p:void 0,h={oid:t.profile.objectId,tid:t.profile.tenantId,wipChannel:e,wipRing:a,region:u,locale:m,country:g},y="ringFinder";return this.setAuthCookie(o,s,y,encodeURIComponent((0,$.u4)(h))),this.subscribeToCountryCode(o,n,s,y,h),e=>{switch(this.metadataSettingsSubscription?.unsubscribe(),this.metadataSettingsSubscription=void 0,e){case"signout":{const{cleanupRingFinderCookie:e}=n.get(b.J.Core);e&&this.cleanUpCookie(o,s,y);break}default:return}}}catch(e){s.error(`Failed to set ring finder cookie: ${(0,de.VK)(e)}`)}}}class Zj extends _e{constructor(){super(h.Yg.SetPrimaryUserOnTelemetry,["primaryUser","loggerFactory","telemetryContextService","hostCommunicationService"])}async execute(e){const{primaryUser:t,loggerFactory:n,telemetryContextService:i,hostCommunicationService:a}=e;try{const e=(0,xe.b4)(t),n=t.profile.tenantId;i.setPrimaryUser(e,n);const o=await a.loadModule("telemetry");o?.setPrimaryUser?.(e,n)}catch(e){const i=new Me.G(Me.$.TELEMETRY_PRIMARY_USER_SET_FAILURE,e,(0,xe.b4)(t));n.newLogger("SetUserOnTelemetryContext","core-services-tasks").error?.(i.toTelemetryEntry())}}}class eL{constructor(){this.id=h.Yg.SetUserOnDiagnosticsService}async execute(e){const{authenticationUser:t,coreSettings:n,diagnosticsService:i,logsCollectorService:a}=Mm("SetUserOnDiagnosticsServiceTask",e,"authenticationUser","coreSettings","diagnosticsService","logsCollectorService");a.setPrimaryUserID(t.id);const{enableMTMA:o}=n.get(b.J.Core);if(o){const n=i.createUserDiagnosticsService(t.profile.tenantId,t.profile.objectId,t.id);n&&(e.diagnosticsService=n,a.registerUserLogsProvider(t.id,n),e.loggerFactory=new le(n,e.loggerFactory.cID))}else i.updateDiagnosticInfo(t.profile.tenantId,t.profile.objectId);return e=>{switch(e){case"quit":i.persistDiagnosticsAsPreviousSessionLogs();break;case"signout":t.id&&a.handleUserLogout(t.id),i.handleUserLogout(t.id)}}}}var tL=n(374038);class nL extends _e{constructor(){super(h.Yg.SignalCoreLifecycleChangesTask,["authenticationUser","client","clientState","config","coreSecurityService","coreSettings","coreUtilities","correlation","entityCommanding","experienceChangeReportingService","experienceLifecycleManager","hostCommunicationService","i18n","i18NextWrapper","localStorage","loggerFactory","networkState","platformService","rebootService","scenarioFactory","userBiService","windowProvider","notificationsHandler","logsCollectorService"])}async execute(e){const{activeWindowsHistoryService:t,authenticationUser:n,client:i,clientState:a,clientAccessAdminPolicyCheckService:o,config:r,coreSecurityService:s,coreSettings:l,coreUtilities:{isEntityInView:c},correlation:d,entityCommanding:u,experienceChangeReportingService:m,experienceLifecycleManager:p,hostCommunicationService:g,i18n:h,i18NextWrapper:y,localStorage:v,loggerFactory:f,networkState:S,platformService:k,rebootService:C,scenarioFactory:w,userBiService:T,userTrackingService:I,windowProvider:N,notificationsHandler:E,logsCollectorService:A}=e,_=e.localMigratedSettings,F=f.newLogger("SignalCoreLifecycleChangesTask","core-services-tasks");if(!n||!(0,tL.$l)(n))return void F.warn("Not creating user lifecycle manager as authenticated user is not available.");const{disableExperience:D}=l.get(b.J.Core),{crossCloudMeetingEnabled:P}=l.get(b.J.HostCapabilities),M=D&&n.role!==ys.w4.Anonymous,x=D&&!1===P&&n.role===ys.w4.Anonymous;if(M||x)return void F.warn(`Not creating user lifecycle manager as experience is disabled. UserRole ${n.role}, \n          disableExperience: ${D}, crossCloudMeetingEnabled: ${P}`);if(o){let e;try{e=await o.isUserAllowed()}catch(t){F.warn(`isUserAllowed encountered exception: ${t}`),e=!0}if(!e)return void F.warn("Not creating user lifecycle manager as experience is disabled by admin policy.")}const R=d.id,j=(0,xe.b4)(n);return p.manageUser(j,{activeWindowsHistoryService:t,authenticationUser:n,client:i,clientState:a,config:r,coreSecurityService:s,coreSettings:l,entityCommanding:u,i18n:h,i18NextWrapper:y,isEntityInView:c,localMigratedSettings:_,loggerFactory:f,networkState:S,platformService:k,rebootService:C,scenarioFactory:w,hostCommunicationService:g,userTrackingService:I,windowProvider:N,localStorage:v,userBiService:T,notificationsHandler:E,logsCollectorService:A}),m.report({correlationId:R,userContextId:j,type:gt.yU.UserAuthenticated,context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),(0,tL.Ej)(l,v)||m.report({correlationId:R,type:gt.yU.UserConsentedToConsumeResources,userContextId:j,context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),async e=>{switch(e){case"quit":case"signout":await p.removeUser(e,j);break;default:return}}}}class iL extends _e{constructor(){super(h.Yg.StoreBuildInfoTask,["localStorage","platformService"])}async execute(e){const{localStorage:t,platformService:n}=e,i=n.config.buildVersion;i&&!i.toLocaleLowerCase().startsWith("local")&&t.set("buildNumber",i,"Framework","Experience")}}class aL extends _e{constructor(){super(h.Yg.TrackExperienceIdle,["clientState","correlation","coreSettings","experienceChangeReportingService"])}async execute(e){const{clientState:t,correlation:n,coreSettings:i,experienceChangeReportingService:a}=e,{enableExperienceIdleStateManagement:o}=i.get(b.J.Core);if(!o)return;const r=t.observe().subscribe((async e=>{const t=e===Fe.pk.LongInactive;a.report({correlationId:n.id,type:gt.yU.ExperienceIdleStateChanged,context:{target:"core-tasks-signal-core-lifecycle-changes-task",isIdle:t}})}));return e=>{switch(e){case"signout":case"quit":r.unsubscribe()}}}}class oL extends _e{constructor(){super(h.Yg.UpdateDataClientContext,[])}async execute(e){!function(e,t){const n={...t,pubsub:e.getServices().pubsub,send:(0,Gl.UZ)(cl.l,t.networkState.observeIsOnline())},i=ty.singletonLink,a=Zk.clientResolvers;if(!i||!a)throw new Error("Link and client resolvers should be created at this point");const{maxApolloResultCacheSize:o,enableApolloDoubleWriteFix:r}=t.coreSettings.get(b.J.Core),{enableApolloDevtools:s}=t.coreSettings.get(b.J.Diagnostics),l=o??void 0,c=t.leakDetectorService?.create(),d=FE({leakDetector:c,windowId:e.cache.apolloLeakInfo?.apolloLeakInfoWindowId,entityType:e.cache.apolloLeakInfo?.apolloLeakInfoEntityType,viewportContext:"cmd"},void 0,a,l,t.loggerFactory,t.scenarioFactory,void 0,s,Jg.t.cmd,t.graphqlStoreStatsReporterService,r);oh(d,"cmdApolloClient",Boolean(s),t.platformService,t.config.experienceName);const u=IE.createUserDataRequestContext(n,d),m=xE(u,i);e.updateContext(u,m),d.setLink(m)}(e.client,e)}}class rL extends _e{constructor(){super(h.Yg.UpdateNetworkStateDetection,[])}async execute(e){const t=e.authenticationUser&&(0,xe.b4)(e.authenticationUser)||"",n=e.networkState.subscribeToEndpointsNetworkStateTracking?.(t,e.endpointsManager.networkState);return e=>{"signout"===e&&n()}}}class sL extends _e{constructor(){super(h.Yg.WaitForCDLWorkerTask,["loggerFactory","coreSettings","coreSettingsContext","delegatedCommanding"])}async execute(e){const{loggerFactory:t,coreSettings:n,coreSettingsContext:i,delegatedCommanding:a}=e,{cdlWorkerService:o}=e,r=t.newLogger("WaitForCDLWorkerTask","core-services-tasks");if(!(0,tu.Q6)(n))return;const{isCDLWorkerCriticalToStartup:s}=n.get(b.J.Core);if(o){r.log("Waiting for CDL worker to finish initialization");const e=await o.getCDLWorkerManager();if(e)e.syncEngineInitializationPromise.then((e=>{e.isSyncEngineInitialized?i.updatePlatformProviderSettings({bootType:e.bootType}):o.triggerWorkerStartupFailure(e.isExpected?"sync-engine-expected-failure":"sync-engine-failure",a)}));else if(r.errorToTelemetry?.(`CDL worker manager not initialized. isCDLWorkerCriticalToStartup: ${s}.`,"cdl_wait_for_cdl_worker_task",void 0,!0),s)throw new Me.G(Me.$.CDL_WORKER_FAILURE)}else if(r.warnToTelemetry?.(`CDL worker service not present in core context. isCDLWorkerCriticalToStartup: ${s}.`,"cdl_wait_for_cdl_worker_task",void 0,!0),s)throw new Me.G(Me.$.CDL_WORKER_FAILURE)}}class lL extends _e{constructor(){super(h.Yg.WrapChangeReportingServicesTask,["commandChangeReportingService","experienceChangeReportingService","authenticationUser"])}async execute(e){const{commandChangeReportingService:t,experienceChangeReportingService:n,authenticationUser:i}=e,a=(0,xe.b4)(i);return e.commandChangeReportingService={...e.commandChangeReportingService,report:e=>{t.report({userContextId:a,...e})},observeChanges:t.observeChanges.bind(t)},e.experienceChangeReportingService={...e.experienceChangeReportingService,report:e=>{n.report({userContextId:a,...e})},observeChanges:n.observeChanges.bind(n)},Promise.resolve()}}class cL{constructor(e,t,n){this.cache=new Map,this.lastId=0,this.blacklist=["imgpsh_fullsize"],this.currentSize=0,this.cacheHits=0,this.cacheMisses=0,this.maxCacheSize=e,this.cachePruneRatio=t,this.scenarioFactory=n}add(e,t,n){if(this.maxCacheSize<=0)return!1;if(!t)return!1;if(!this.shouldCache(e))return!1;let i;if(this.has(e,t)){const a=this.get(e,t);i={...a,...n},a&&(a.blob!==n.blob&&URL.revokeObjectURL(a.blob),this.currentSize+=i.size-(a?.size??0))}else i={...n,time:this.lastId++},this.cacheMisses++,this.currentSize+=i.size;const a=this.getCacheKey(e,t);return this.cache.set(a,i),this.pruneIfNeeded(),!0}setCapacity(e,t){this.maxCacheSize=e,this.cachePruneRatio=t,this.pruneIfNeeded()}has(e,t){return!!t&&this.cache.has(this.getCacheKey(e,t))}get(e,t){if(!t)return;const n=this.getCacheKey(e,t),i=this.cache.get(n);return i&&(i.time=this.lastId++,this.cacheHits++),i}get size(){return this.cache.size}getCacheKey(e,t){return`${e}/${t}`}getCacheHitRatio(){const e=this.cacheHits+this.cacheMisses;if(!e)return 0;return Math.round(this.cacheHits/e*100)/100}shouldCache(e){for(const t of this.blacklist)if(e.includes(t))return!1;return!0}pruneIfNeeded(){if(this.currentSize>this.maxCacheSize){const e={};e.cacheCountBeforePruning=this.size;const t=this.scenarioFactory.newScenario(H.RG.AMSMemoryCachePrune),n=Array.from(this.cache.entries());n.sort(((e,t)=>e[1].time-t[1].time));const i=Math.max(this.currentSize-this.maxCacheSize,Math.ceil(this.maxCacheSize*this.cachePruneRatio));let a=0;for(const[e,t]of n){const n=t.size;if(!(a+n<=i))break;this.currentSize-=n,this.cache.delete(e),a+=n,URL.revokeObjectURL(t.blob)}e.cacheHitRatio=this.getCacheHitRatio(),e.cacheCountAfterPruning=this.size,t.stop(e)}}}class dL extends _e{constructor(){super(h.Yg.CreateAMSImageCaches,["coreSettings","scenarioFactory"]),this.BYTE_MULTIPLIER=1e6,this.PRUNE_RATIO=.2}async execute(e){const{coreSettings:t,scenarioFactory:n}=e,i=new cL(0,this.PRUNE_RATIO,n);e.amsImageCache=i;const a=t.getObservable(b.J.ImageCache).subscribe((e=>{let t=0;"number"==typeof e.amsImageCacheMaxCapacityInMB&&(t=e.amsImageCacheMaxCapacityInMB),i.setCapacity(t*this.BYTE_MULTIPLIER,this.PRUNE_RATIO)}));return()=>a.unsubscribe()}}class uL{constructor(e,t,n,i){this._windowId=e,this._logger=t,this._enableDecoupleCommandingFromApollo=n,this._commandChangeReportingService=i,this._entityExtensionSubject=new s.t,this._extendedEntityContainerStateSubject=new s.t,this._modalState=void 0}observeModalState(){return this.enableDecoupleCommandingFromApollo?this._entityExtensionSubject:null}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}observeContainerState(){return this._extendedEntityContainerStateSubject.complete(),this._extendedEntityContainerStateSubject=new s.t,this._extendedEntityContainerStateSubject}isBlockingEntityExtension(){return!!this._blockingEntityExtension}isBlockedByEntity(e){return this.enableDecoupleCommandingFromApollo?this._blockingEntityExtension?.type===e:null}setBlockingEntityExtension(e){this._blockingEntityExtension=e}setEntityExtension(e,t,n,i){this._logger.log(`setEntityExtension is called with ${e} ${t} ${n}`),t!==this._modalState?.isExternal||this.hasEntityChanged(n)?(this._modalState={...this._modalState,isExternal:t,entity:n},this._entityExtensionSubject.next({isExternal:!!this._modalState?.isExternal,entityExtension:this._modalState?.entity,correlationId:e}),i&&this._commandChangeReportingService.report({correlationId:e,type:dt.B.WindowUpdated,context:{target:"executeEntityCommand"}})):i&&this._commandChangeReportingService.report({correlationId:e,type:dt.B.WindowNotUpdated,context:{target:"executeEntityCommand"}})}setContainerState(e,t){e!==this._modalState?.containerState&&(this._modalState={...this._modalState,containerState:e},this._modalState?.containerState&&this._extendedEntityContainerStateSubject.next({containerState:this._modalState?.containerState,hasEntityExtension:!!this._modalState?.entity?.type}),e!==ke.oq.Open&&t&&this.setEntityExtension((0,Re.v4)(),!1,void 0,t))}updateModalState(e){e.id===this._windowId?(this.setEntityExtension(e.correlation.id,e.extendedEntityContainerState?.isExternal||!1,e.activeEntities?.entityExtension||void 0,!1),this.setContainerState(e.extendedEntityContainerState?.containerState,!1)):this._logger.errorToTelemetry?.("updateModalState got called on wrong window","webclient_framework_foundation_core_services_active_windows")}hasEntityChanged(e){const t=this._modalState?.entity;return t?.id!==e?.id||t?.type!==e?.type||t?.action!==e?.action||t?.options!==e?.options}}class mL{constructor(e,t,n,i,a){this._userContextId=t,this._enableDecoupleCommandingFromApollo=i,this._modalManager=new uL(e,n,i,a)}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}get modalManager(){return this._modalManager}setUserContextId(e){this._userContextId=e}validateUserContext(e){return this._userContextId!==e}}function pL({correlation:e,entity:t,openOnMainWindow:n,mainWindowLayoutMode:i,userContextId:a,windowId:o=h.ew}){let r=o;this._logger.log(`handleExtendCommand is called with: openOnMainWindow:${n}, mainWindowLayoutMode:${i}, userContextId: ${a}, windowId: ${o}, entity: ${t}`),n&&(r=this.getMainWindowWithLayoutMode(i??ke.lO.standard)?.id);const s=r?this.getActiveWindow(r):void 0;if(("switchaccountdialog"!==t?.type||"view"!==t?.action)&&null!==s?.userContextId&&this.getWindowLayoutService(r).validateUserContext(a))return this._logger.log("User context of source window does not match user context of command. Rejecting command"),void this._commandChangeReportingService.report({correlationId:e.id||"",type:dt.B.Incomplete,context:{errorInfo:ct.y.UserContextMismatch,target:"handleExtendCommand"}});const l=this.getWindowLayoutService(r);this._logger.log(`handleExtendCommand is acting on window ${r}`),l.modalManager.setEntityExtension(e.id,!1,t,!0)}class gL{constructor(e,t,n,i){this._enableDecoupleCommandingFromApollo=t,this._enableDecoupleCommandingFromApolloRerenderForCorrelation=n,this._commandChangeReportingService=i,this._activeWindowsSubject=new s.t,this.cleanup=(e,t)=>{this._logger.log(`cleaning up activeWindowsService for user: ${t} due to ${e}`)},this._activeWindows=new Map,this._windowLayoutServices=new Map,this._logger=e.newLogger("ActiveWindowsService","core-services-active-windows"),this._defaultMainWindowLayoutService=new mL(h.ew,void 0,this._logger,t,this._commandChangeReportingService),this._windowLayoutServices.set(h.ew,this._defaultMainWindowLayoutService)}getActiveWindowsObservable(){return this._activeWindowsSubject.pipe((0,d.U)((e=>Array.from(e.values()))))}getActiveWindowObservable(e){return this._activeWindowsSubject.pipe((0,d.U)((t=>t.get(e))),(0,m.h)((e=>!!e)),(0,Es.x)(((e,t)=>this.comparator(e,t))))}getActiveWindows(){return Array.from(this._activeWindows.values())}getActiveWindow(e){return this._activeWindows.get(e)}setActiveWindows(e,t){const n=new Set(Array.from(this._activeWindows.keys()));this._activeWindows.clear(),e.forEach((e=>{this._createWindowLayoutService(e.id,e.userContextId||void 0),this._activeWindows.set(e.id,e),n.delete(e.id)})),n.forEach((e=>this._windowLayoutServices.delete(e))),t?.(),this._activeWindowsSubject.next(this._activeWindows)}removeActiveWindowById(e){this._windowLayoutServices.delete(e);const t=this._activeWindows.get(e);return this._activeWindows.delete(e),this._activeWindowsSubject.next(this._activeWindows),t}getStandardMainWindow(){const e=this.getActiveWindows();return e?.find((e=>e.isMainWindow&&e.layoutConfig.layoutMode===ke.lO.standard))}getMainWindowWithLayoutMode(e){const t=this.getActiveWindows();return t?.find((t=>t.isMainWindow&&t.layoutConfig.layoutMode===e))}getWindowLayoutService(e=h.ew){if(!this._enableDecoupleCommandingFromApollo)return this._defaultMainWindowLayoutService;const t=this._windowLayoutServices.get(e);if(!t)throw new Me.G(Me.$.CORE_SERVICES_MISSING,new Error(`windowLayoutService was not created for windowId: ${e}`));return t}executeCommand(e){return{handleExtendCommand:pL.bind(this)}[e]}getMatchingWindow(e,t,n){return this.getActiveWindows().find((i=>this._matchingWindowFinder(i,e,t,n)))}get enableDecoupleCommandingFromApollo(){return this._enableDecoupleCommandingFromApollo}_matchingWindowFinder(e,t,n,i){if(n!==e.userContextId||i?.includes(e.id))return!1;const a=e.activeEntities.mainEntity,o=e.activeEntities.endEntity,r=e.activeEntities.mainEntity?.linkedEntity,s=e.activeEntities.endEntity?.linkedEntity;return[a,o,r,s].find((e=>t.find((t=>e?.type===t?.type&&e?.id===t?.id))))}_createWindowLayoutService(e,t){this._windowLayoutServices.get(e)?this._windowLayoutServices.get(e)?.setUserContextId(t):this._windowLayoutServices.set(e,new mL(e,t,this._logger,this._enableDecoupleCommandingFromApollo,this._commandChangeReportingService))}comparator(e,t){return e?.userContextId===t?.userContextId&&this.hasSameActiveEntities(e?.activeEntities,t?.activeEntities)&&this.hasSameLayoutConfig(e?.layoutConfig,t?.layoutConfig)&&!(t?.correlation.id!==e?.correlation.id&&this._enableDecoupleCommandingFromApolloRerenderForCorrelation)}hasSameActiveEntities(e,t){return 0===Object.keys(Se.$z).filter((n=>{const i=e?.[n],a=t?.[n];return i?.action!==a?.action||i?.id!==a?.id||i?.linkedEntity?.action!==a?.linkedEntity?.action||i?.linkedEntity?.id!==a?.linkedEntity?.id||i?.linkedEntity?.type!==a?.linkedEntity?.type||i?.options!==a?.options||i?.type!==a?.type})).length}hasSameLayoutConfig(e,t){if(e?.isFullscreen!==t?.isFullscreen||e?.layoutMode!==t?.layoutMode)return!1;return 0===Object.keys(ke.mR).filter((n=>{const i=e?.slots?.[n],a=t?.slots?.[n];return i?.height!==a?.height||i?.isHidden!==a?.isHidden||i?.width!==a?.width})).length}}class hL extends _e{constructor(){super(h.Yg.CreateActiveWindowsServiceTask,["loggerFactory","coreSettings","commandChangeReportingService"])}async execute(e){const{commandChangeReportingService:t,coreSettings:n,loggerFactory:i}=e,{enableDecoupleCommandingFromApollo:a,enableDecoupleCommandingFromApolloRerenderForCorrelation:o}=n.get(b.J.Core),r=new gL(i,!!a,!!o,t);return e.activeWindowsService=r,e=>r.cleanup(e)}}var yL=n(752983);class vL{constructor(e,t,n){this.logger=n;const i=this;this.proxy=new Proxy(t,{get(t,a){const o=t[a];if(o)return"function"!=typeof o?o:(...r)=>{let s="";s=i.getParamsAsString(r,!0),n.log(`Calling ${e}.${String(a)}(${s})`);const l=o.apply(t,r);return l&&l.then&&l.then((t=>n.log(`${e}.${String(a)}(${s}) response: ${i.getParamsAsString(t)}`))).catch((t=>n.error(`${e}.${String(a)}(${s}) response: ${i.getParamsAsString(t)}`))),l};n.error(`${e}.${String(a)}: Not Available`)}})}getProxy(){return this.proxy}getParamsAsString(e,t=!1){let n="";try{n=t?e.map((e=>JSON.stringify(e))).join(","):JSON.stringify(e);const i=1e3;if("string"==typeof n&&n.length>i){const e="...";n=`${n.substring(0,i-e.length)}${e}"`}}catch(e){this.logger.log(`Failed to serialize params: ${e.message}`)}return n}}const fL="tmp.vdiOptimizationMode";class SL{constructor(e,t,n){this.loggerFactory=e,this.hostCommunicationService=t,this.windowProvider=n,this.logger=this.loggerFactory.newLogger("VDIPlatformService","core-services-vdi")}async init(){try{await this.loadVDIModule();const e=await(this.vdiModule?.getAllVDISettings?.());if(e){const{mode:t,provider:n,isAvRemoted:i,configFilter:a,optimizationMode:o,citrixVdaVersion:r,vmwareVdaVersion:s,sessionId:l,isWebRTCEnabled:c}=e,d=this.getVDIPlatformProvider(n);if(d===Bp.None)return;const u=this.getVDISubProvider(n),m=this.getProxiedVdiModule(),p=e=>Promise.reject(`${e}: Not Available`),g={isVDI:!0,mode:t,provider:d,subProvider:u,isAvRemoted:i,configFilter:"string"==typeof a&&a.length?a:null,sessionId:l,vdiOptimizationMode:o,isWebRTCEnabled:c,utils:{getWVDConfig:()=>m.getWVDConfig?.()??p("getWVDConfig"),getWindowHandleAsHex:async()=>{const e=await this.getMainWindowId();return this.getNativeWindowHandleAsHex(e??"invalid-id")},getNativeWindowHandle:async e=>this.getNativeWindowHandleAsHex(e),getVDILocalStackPolicy:()=>m.getVDILocalStackPolicy?.()??p("getVDILocalStackPolicy"),getVMWareSecureWebPort:()=>m.getVMWareSecureWebPort?.()??p("getVMWareSecureWebPort"),getCitrixMSTeamsRedir:()=>m.getCitrixMSTeamsRedir?.()??p("getCitrixMSTeamsRedir"),getCitrixVdaVersion:()=>Promise.resolve(r),getVMwareVdaVersion:()=>Promise.resolve(s),getVMWareViewClientId:()=>m.getVMWareViewClientId?.()??p("getVMWareViewClientId"),setVDIOptimizationMode:e=>this.setVDIOptimizationModeOverride(e),resetVDIOptimizationMode:()=>this.setVDIOptimizationModeOverride(void 0),isWV2Whitelisted:()=>m.isWV2Whitelisted?.()??p("isWV2Whitelisted")}},h=this.getVDIOptimizationSettingsOverride(g,c);return g&&h&&(g.mode=h.mode,g.isAvRemoted=h.isAvRemoted,g.configFilter=h.configFilter,g.vdiOptimizationMode=h.vdiOptimizationMode,this.logger.log("VDIOptimizationSettingsOverride vdiPlatformConfig.vdiOptimizationMode:",g.vdiOptimizationMode)),g}}catch(e){let t="Unknown Error";this.vdiModule||(t="Failed to load vdiModule"),this.logger.error(`Failed to setup VDI environment: ${t}`)}}setVDIOptimizationModeOverride(e){switch(e){case yL.bT.webrtc:case yL.bT.slimcore:case yL.bT.none:this.windowProvider.localStorage.setItem(fL,e);break;default:this.windowProvider.localStorage.removeItem(fL)}}getVDIOptimizationModeOverride(){const e=this.windowProvider.localStorage.getItem(fL);switch(e){case yL.bT.webrtc:case yL.bT.slimcore:case yL.bT.none:return e;default:return}}getVDIOptimizationSettingsOverride(e,t){const n=this.getVDIOptimizationModeOverride();return!1===t&&yL.bT.webrtc===n?null:n&&e?{mode:this.getVdiModeOverride(e.mode,n),isAvRemoted:yL.bT.webrtc===n,configFilter:this.getConfigFilterOverride(e.provider,n),vdiOptimizationMode:n}:null}getVdiModeOverride(e,t){let n="0";switch(t){case yL.bT.webrtc:n="1";break;case yL.bT.slimcore:n="2"}return 4===e.length?e[0]+n+e.substring(2):e}getConfigFilterOverride(e,t){let n="vdi";const i=this.getProviderConfigString(e);if(i)switch(t){case yL.bT.webrtc:n="vdi-av-".concat(i);break;case yL.bT.slimcore:n="vdi-slimcore-".concat(i)}return n}getProviderConfigString(e){switch(e){case Bp.CitrixXenDesktop:case Bp.CitrixXenApp:return"citrix";case Bp.VMWare:return"vmware";case Bp.WVD:return"wvd";default:return""}}getVDIPlatformProvider(e=yL.GV.None){let t=Bp.None;switch(e){case yL.GV.Citrix:t=Bp.CitrixXenDesktop;break;case yL.GV.VMware:t=Bp.VMWare;break;case yL.GV.AVD:case yL.GV.Windows365:t=Bp.WVD;break;case yL.GV.None:default:t=Bp.None}return t}getVDISubProvider(e=yL.GV.None){let t=Wp.none;if(e===yL.GV.Windows365)t=Wp.windows365;else t=Wp.none;return t}async getMainWindowId(){return this.loadWindowControlsModule().then((e=>{if(e?.getWindowByTag)return e.getWindowByTag(ni.px.Main);throw new Error("Could not load window controls module")})).then((e=>(this.logger.log(`[getMainWindowId] Got main window ID: ${e}`),e))).catch((e=>{throw this.logger.error("[getMainWindowId] Failed to retrieve main window ID"),e}))}async getNativeWindowHandleAsHex(e){return this.logger.log(`[getNativeWindowHandleAsHex] trying to get native window handle for windowId: ${e}`),this.getNativeWindowHandle(e).then((t=>{if(t?.handle)return this.windowHandleToHex(t.handle);{const t=`Failed to retrieve native window handle for windowId: ${e}`;throw this.logger.log(`[getNativeWindowHandleAsHex] ${t}`),new Error(t)}})).then((e=>(this.logger.log(`[getNativeWindowHandleAsHex] Got native window handle as hex: ${e}`),e)))}async getNativeWindowHandle(e){return this.logger.log(`[getNativeWindowHandle] trying to get native window handle for windowId: ${e}`),this.loadOSUtilsModule().then((t=>{if(t?.getHostWindowHandle)return t.getHostWindowHandle(e).then((t=>(this.logger.log(`[getNativeWindowHandle] Got native window handle for ${e}: ${t?.handle}`),t))).catch((t=>{throw this.logger.error(`[getNativeWindowHandle] Failed to retrieve native window handle for ${e}`),t}));throw new Error("osUtils.getHostWindowHandle is not available")}))}windowHandleToHex(e){let t=e.toString(16);for(;t.length<16;)t=`0${t}`;return t.length%2!=0&&(t=`0${t}`),this.logger.log(`[windowHandleToHex] Converted native window handle ${e} to hex: ${t}`),this.convertWindowHandleHexEndianness(t)}convertWindowHandleHexEndianness(e){return e?.match(/[0-9a-f]{2}/gi)?.reverse().join("")??null}async loadVDIModule(){return void 0===this.vdiModule&&(this.vdiModule=await this.hostCommunicationService.loadModule("vdi")),this.vdiModule}getProxiedVdiModule(){return!this.proxiedVDIModule&&this.vdiModule&&(this.proxiedVDIModule=new vL("vdiModule",this.vdiModule,this.logger).getProxy()),this.proxiedVDIModule}async loadOSUtilsModule(){return void 0===this.osUtilsModule&&(this.osUtilsModule=await this.hostCommunicationService.loadModule("osutils")),this.osUtilsModule}async loadWindowControlsModule(){return void 0===this.windowControlsModule&&(this.windowControlsModule=await this.hostCommunicationService.loadModule("windowcontrols")),this.windowControlsModule}}class kL{constructor(e){this.utils=e}setSlimCoreCallingSupportService(e){this.vdiSlimCoreCallingSupportService=e}provideCallingSupportService(){return this.vdiSlimCoreCallingSupportService??void 0}}class CL{constructor(){}setVdiMediaService(e){this.service=e}provide(){return this.service}}class bL extends _e{constructor(){super(h.Yg.InitVDIPlatformServiceTask,["loggerFactory","getPlatformConfigurationOverrides","windowProvider"])}async execute(e){const{loggerFactory:t,getPlatformConfigurationOverrides:n,windowProvider:i}=e,a=t.newLogger("InitVDIPlatformServiceTask","core-services-tasks");if(xn(i)&&!this.isTFL(i)){const o=K_(a),r=new SL(t,o,i),s=await r.init();if(s){const t=(e,t)=>{const i=n(e,t);if(!i.vdi){const{provider:e,mode:t,isAvRemoted:n,configFilter:a,sessionId:o,isVDI:r,vdiOptimizationMode:l,isWebRTCEnabled:c,utils:d,subProvider:u}=s;i.vdi={isVDI:r,mode:t,provider:e,isAvRemoted:n,configFilter:a,sessionId:o,vdiOptimizationMode:l,isWebRTCEnabled:c,utils:d,subProvider:u}}return i};e.getPlatformConfigurationOverrides=t,e.vdiServiceProvider=new kL(s.utils),e.vdiMediaServiceProvider=new CL}}}isTFL(e){return(e.loader?.getProperties()?.environment||pt.s.prod)===pt.s.life}}const wL={disableAnimations:!1};class TL extends _e{constructor(){super(h.Yg.UpdateCoreSettingDependantClientPreferences,["coreSettings","clientPreferences"])}async execute(e){const{coreSettings:t,clientPreferences:n}=e,i=t.get(b.J.Core).disableAnimationsByDefault;void 0===n.getPreferences("animation").disableAnimations&&n.updatePreferences({animation:{disableAnimations:i??wL.disableAnimations}})}}const IL="[LocalMigratedSettingsService]",NL="localMigratedSettingsService.completedConsumers",EL=["client-preferences","device-settings","i18n"];function AL(e,t){e.errorToTelemetry?e.errorToTelemetry(`${IL} ${t}`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0):e.error(`${IL} ${t}`)}class _L{constructor(e,t){this.localStorage=e,this.logger=t}isMarked(e){return this.markedConsumers.includes(e)}areAllMarked(){return 0===this.getUnmarked().length}getUnmarked(){const e=new Set(this.markedConsumers);return EL.filter((t=>!e.has(t)))}mark(e){this.isMarked(e)||(this.markedConsumers.push(e),this.localStorage.trySet(NL,JSON.stringify(this.markedConsumers),"Settings","Experience")||AL(this.logger,"failed to save completed consumers to local storage"))}get markedConsumers(){return void 0===this.cachedMarkedConsumers&&(this.cachedMarkedConsumers=[],this.readInitialCompletedConsumers()),this.cachedMarkedConsumers}readInitialCompletedConsumers(){let e=null;try{e=this.localStorage.get(NL,"Experience")}catch{return void AL(this.logger,"failed to read initial completed consumers from local storage")}if((0,W.isNil)(e))return this.logger.log(`${IL} no previously completed consumers`),void(this.cachedMarkedConsumers=[]);try{this.cachedMarkedConsumers=JSON.parse(e)}catch{AL(this.logger,"failed to parse initial completed consumers value")}this.logger.log(`${IL} previously completed consumers: ${this.cachedMarkedConsumers?.join(", ")}`)}}const FL="tmp.localMigratedSettings",DL=1e3;class PL{constructor(e,t,n,i,a,o){this.coreSettings=e,this.scenarioFactory=a,this.timerPreviouslySet=!1,this.host=n,this.hostCommunicationService=i,this.logger=o.newLogger("LocalMigratedSettingsService","core-services-local-migrated-settings"),this.localMigratedSettings=e.get(b.J.LocalMigrated),this.completedConsumers=new _L(t,this.logger),this.scenario=a.newScenario(H.RG.LocalSettingsMigration,{timeoutMs:9e5});const r=Object.keys(this.localMigratedSettings);this.logger.infoToTelemetry?.(`${IL} initialized migrated settings with ${r.length} keys: ${r.join(", ")}`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0);const s=function(e){if(!e.reservedMetadata)return;const t=e.reservedMetadata,n={};t.correlationId&&(n.migratedSettingsCorrelationId=t.correlationId);t.version&&(n.migratedSettingsSchemaVersion=t.version);t.reason&&(n.migrationReason=t.reason);t.created&&(n.migratedSettingsAgeSeconds=function(e){const t=new Date(e);if(isNaN(t.getTime()))return-1;const n=new Date;return Math.ceil((n.getTime()-t.getTime())/DL)}(t.created));return Object.keys(n).length>0?n:void 0}(this.localMigratedSettings);s&&this.scenario.appendEventData(s)}startTimer(){if(this.timerPreviouslySet)return void this.logger.logNoPii?.(`${IL} Will not start timer again as it was previously started.`);if(this.completedConsumers.areAllMarked())return void this.logger.logNoPii?.(`${IL} Will not start timer again as all consumers have completed.`);this.timerPreviouslySet=!0;const e=ML(this.coreSettings);this.logger.logNoPii?.(`${IL} Starting migration timer with timeout ${e}ms`),this.timer=this.host.setTimeout((()=>this.reportMigrationCompletion(!0)),e),this.scenarioFactory.changeTimeout?.(this.scenario,e+3e4)}registerConsumer(e,t){return this.notifyConsumer(e,t),{unregister:()=>{}}}nothingToMigrate(){return 0===Object.keys(this.localMigratedSettings).length}async notifyConsumer(e,t){if(!this.nothingToMigrate()){if(this.completedConsumers.isMarked(e))this.logger.infoToTelemetry?.(`${IL} Skipping previously migrated consumer ${e}.`,"webclient_framework_infrastructure_local_migrated_settings",void 0,!0);else{this.scenario.mark(H.ck.LocalSettingsMigrationStepConsumerStarted,{consumer:e});try{await t(this.localMigratedSettings)}catch{return AL(this.logger,`handler for ${e} failed.`),void this.scenario.mark(H.ck.LocalSettingsMigrationStepConsumerCompleted,{consumer:e,consumerStatus:"Failed"})}this.scenario.mark(H.ck.LocalSettingsMigrationStepConsumerCompleted,{consumer:e,consumerStatus:"Completed"}),this.completedConsumers.mark(e)}this.completedConsumers.areAllMarked()&&await this.reportMigrationCompletion()}}async reportMigrationCompletion(e){const{reportLocalMigratedSettingsCompletionToDesktop:t}=this.coreSettings.get(b.J.Core,["reportLocalMigratedSettingsCompletionToDesktop"]);if(this.timer&&this.host.clearTimeout(this.timer),this.timer=void 0,e?this.logger.log(`${IL} Migration timed out. Incomplete consumers: ${this.completedConsumers.getUnmarked().join(", ")}.`):this.logger.log(`${IL} Migration completed successfully.`),this.host.localStorage.getItem(FL))try{this.host.localStorage.removeItem(FL)}catch(e){return void this.scenario.fail({reason:"FailedRemoveMigratedSettingsFromLocalStorage",incompleteConsumers:this.completedConsumers.getUnmarked()})}if(t){let e;try{e=await this.hostCommunicationService.loadModule("appswitcher")}catch{return void this.scenario.fail({reason:"FailedNoAppSwitcherModule",incompleteConsumers:this.completedConsumers.getUnmarked()})}const t=e?.completeT1LocalSettingsMigration;if(!t)return void this.scenario.fail({reason:"FailedNoCompletionApi",incompleteConsumers:this.completedConsumers.getUnmarked()});try{t()}catch(e){return void this.scenario.fail({reason:"FailedNotifyMigrationCompletion",incompleteConsumers:this.completedConsumers.getUnmarked()})}}e?this.scenario.fail({reason:"TimedOut",incompleteConsumers:this.completedConsumers.getUnmarked()}):this.scenario.stop()}}const ML=e=>{const{localMigratedSettingsConsumptionTimeoutInMs:t}=e.get(b.J.Core,["localMigratedSettingsConsumptionTimeoutInMs"]);return t??6e4};class xL extends _e{constructor(){super(h.Yg.CreateLocalMigratedSettingsServiceTask,["clientPreferences","coreSettings","hostCommunicationService","localStorage","loggerFactory","scenarioFactory","windowProvider"])}async execute(e){const{clientPreferences:t,coreSettings:n,hostCommunicationService:i,localStorage:a,loggerFactory:o,scenarioFactory:r,windowProvider:s}=e,l=o.newLogger("CreateLocalMigratedSettingsServiceTask","core-services-tasks"),{skip:c,reason:d}=function(e){if(function(e){const{disableLocalMigratedSettingsService:t}=e.get(b.J.Core,["disableLocalMigratedSettingsService"]);return!!t}(e))return{skip:!0,reason:"Service is disabled"};if(function(e){const t=e.get(b.J.LocalMigrated);if(!t)return!0;return 0===Object.keys(t).length}(e))return{skip:!0,reason:"Nothing to migrate"};return{skip:!1}}(n);if(c)return void l.log(`Skipping service creation. Reason: ${d}`);const u=function(e,t,n,i,a,o){return new PL(e,t,n,i,a,o)}(n,a,s,i,r,o);!function(e,t,n){e.registerConsumer("client-preferences",(async e=>{const i={};if((0,W.isNil)(e.chatDensity)||(i.density={chatDensity:RL(e.chatDensity)}),(0,W.isNil)(e.messagePreviewShown)||(i.messagePreviews={messagePreviewsSetting:jL(e.messagePreviewShown)}),(0,W.isNil)(e.performanceMode)||(i.animation={disableAnimations:LL(e.performanceMode)}),!(0,W.isNil)(e.cachedImage)){const{imageId:t,path:n,imageSrc:a}=e.cachedImage,o={imageId:t,imagePath:n,imageSrc:a,imageNeedsMigration:!0};i.backgroundEffect={lastUsedBackgroundEffect:o},i.videoEffect={lastUsedBackgroundImage:o}}0!==Object.keys(i).length?(n.log(`Updating client preferences to: ${JSON.stringify(i)}`),t.updatePreferences(i)):n.log("No client preferences to update.")}))}(u,t,l),e.localMigratedSettings=u}}const RL=e=>{switch(e){case"Comfy":default:return"comfy";case"Compact":return"compact"}},jL=e=>{switch(e){case"Default":default:return"default";case"ShowPreviews":return"showPreviews";case"HidePreviews":return"hidePreviews"}},LL=e=>"Low"===e;class OL extends _e{constructor(){super(h.Yg.CreateAuthStateConnector,["networkState","authStateProvider","coreSettings"])}async execute(e){const{networkState:t,authStateProvider:n,coreSettings:i}=e,{enableNetworkOnlineDetection:a,disableNetworkDetectionOnResume:o}=i.get(b.J.Core);!o&&a&&t.subscribeAuthStateEvent(n)}}var $L;!function(e){e.AUTH_NOT_OPT_IN="auth_not_opt_in",e.ANON_NOT_SELECTED="anon_not_selected"}($L||($L={}));class UL extends _e{constructor(){super(h.Yg.CreateAnonJoinPreflightTask,["windowProvider","coreSettings","authenticationService","scenarioFactory","localStorage","loggerFactory","platformService"])}async execute(e){const t=e.windowProvider,n=e.coreSettings,i=e.authenticationService,a=e.scenarioFactory,o=e.localStorage,r=e.loggerFactory,s=e.platformService,l=r.newLogger("CreateAnonJoinPreflightTask","core-services-tasks"),c=a.findScenario(H.RG.AnonJoinPreflightCoreTask)||a.newScenario(H.RG.AnonJoinPreflightCoreTask),d=a.findScenario(H.RG.ClientStart),{enableT2PreflightForAnonUser:u,enableAnonJoinPreflightCoreTask:m}=n.get(b.J.Calling),p=new URL(t.location.href),g="true"===o.get("isOptedIntoT2Web","Global"),h="true"===p.searchParams.get("meetingjoin");if(l.infoToTelemetry?.(`[anon-join-core-task]: isOptedInT2-${g}, enableT2PreflightForAnonUser-${u}, enableAnonJoinPreflightCoreTask-${m}`,"cmd_horizontals_web_anon_join_task",void 0,!0),!h)return c.stop({reason:"meetingjoin QSP is not true"}),void l.infoToTelemetry?.("[anon-join-core-task]:meetingjoin QSP is not true","cmd_horizontals_web_anon_join_task",void 0,!0);if(!m)return this.verifyOptInStateBeforeContinueToT2({windowProvider:t,currentUrl:p,isOptedInT2:g,scenario:c,reason:"Core task feature flag enableAnonJoinPreflightCoreTask is not enabled.",logger:l,localStorage:o,platformService:s}),void l.infoToTelemetry?.("[anon-join-core-task]:Core task feature flag enableAnonJoinPreflightCoreTask is not enabled.","cmd_horizontals_web_anon_join_task",void 0,!0);const y=new URLSearchParams(p.hash).get("deeplinkId")??void 0,v=await i.getUser();if(l.infoToTelemetry?.(`[anon-join-core-task]: user role ${v?.role}`,"cmd_horizontals_web_anon_join_task",void 0,!0),v&&v.role!==ys.w4.Anonymous)return this.verifyOptInStateBeforeContinueToT2({windowProvider:t,currentUrl:p,isOptedInT2:g,scenario:c,reason:"Auth user.",deeplinkId:y,isAuth:!0,logger:l,localStorage:o,platformService:s}),void l.infoToTelemetry?.("[anon-join-core-task]:auth user end","cmd_horizontals_web_anon_join_task",void 0,!0);const{hash:f,pathname:S,search:k}=p,C=`searchLength::${k.length}::hashLength::${f.length}::pathnameLength::${S.length}::deeplinkIdLength::${y?.length}`;if(u)return c.stop({reason:"Anon user selected as part of T2 preflight"}),d?.appendEventData({reason:`WebAnonJoin::${C}`}),void l.infoToTelemetry?.(`[anon-join-core-task]:Anon user selected as part of T2 preflight::${C}`,"cmd_horizontals_web_anon_join_task",void 0,!0);this.redirectToT1Web({windowProvider:t,currentUrl:p,isOptedInT2:g,scenario:c,reason:"Anon user not selected as part of T2 preflight",deeplinkId:y,logger:l,localStorage:o,platformService:s,redirectReason:$L.ANON_NOT_SELECTED})}verifyOptInStateBeforeContinueToT2(e){const{isOptedInT2:t,scenario:n,reason:i,logger:a}=e;if(t)return n.stop({reason:`${i} Opted into T2 web`}),void a.infoToTelemetry?.(`[anon-join-core-task]:${i} Opted into T2 web`,"cmd_horizontals_web_anon_join_task",void 0,!0);a.infoToTelemetry?.("[anon-join-core-task]:redirecting to T1 web","cmd_horizontals_web_anon_join_task",void 0,!0),this.redirectToT1Web({...e,redirectReason:$L.AUTH_NOT_OPT_IN})}redirectToT1Web({windowProvider:e,currentUrl:t,scenario:n,reason:i,deeplinkId:a,isAuth:o,logger:r,localStorage:s,platformService:l,redirectReason:c}){const d=["clearcontainer","container","version"];for(const e of d)if(t.searchParams.has(e))return n.stop({reason:`${i} URL contains noRedirectQSPs ${e}, and skipping redirect to T1 web.`}),void r.infoToTelemetry?.(`[anon-join-core-task]:${i} URL contains noRedirectQSPs ${e}, and skipping redirect to T1 web.`,"cmd_horizontals_web_anon_join_task",void 0,!0);t.pathname=o?"/":"/_",t.searchParams.delete("meetingjoin"),a&&n.appendEventData({deeplinkId:a}),n.stop({reason:`${i} Redirecting to T1 web with isAuth=${o}`}),r.infoToTelemetry?.(`[anon-join-core-task]:${i} Redirecting to T1 web with isAuth=${o}`,"cmd_horizontals_web_anon_join_task",void 0,!0),s.set("redirectReason",JSON.stringify({sessionId:l.host.sessionId,reason:c}),"CMD","Global"),e.location.replace(t.href)}}class BL extends _e{constructor(){super(h.Yg.SetResourceBufferCacheTask,["coreSettings"]),this.key="resourceEntriesOverflowCache_TEST_ONLY",this.dumpEntriesBuffer=()=>{const e=localStorage.getItem(this.key);let t=JSON.parse(e||"[]");t=t.concat(performance.getEntriesByType("resource")),performance.clearResourceTimings(),localStorage.setItem(this.key,JSON.stringify(t))}}async execute(e){const t=e.coreSettings,{persistResourceEntries:n}=t.get(b.J.Test),{userType:i}=t.get(b.J.Host);if(n&&i&&i.indexOf("test")>-1)return localStorage.setItem(this.key,"[]"),performance.addEventListener("resourcetimingbufferfull",this.dumpEntriesBuffer),()=>{performance.removeEventListener("resourcetimingbufferfull",this.dumpEntriesBuffer),localStorage.removeItem(this.key)}}}class WL extends _e{constructor(){super(h.Yg.UpdateI18nStorage,["coreSettings","windowProvider","localStorage","loggerFactory"])}async execute(e){const{coreSettings:t,windowProvider:n,localStorage:i,loggerFactory:a}=e,{enableLocaleSyncWithMSAccount:o}=t.get(b.J.Localization);if(!o)return;!function(e,t,n){try{const n={...fF(t),localeCode:e.localStorage.getItem(pF.GENERAL_LOCALE_CODE)};if(null!==n.isLocaleInSyncWithAccount&&void 0!==n.isLocaleInSyncWithAccount||t.set(pF.IS_LOCALE_IN_SYNC_WITH_ACCOUNT,"1","Localization"),null===n.applicationLocaleCode||void 0===n.applicationLocaleCode){const e=n.localeCode||h.ZW;t.set(pF.APPLICATION_LOCALE_CODE,e,"Localization")}}catch(e){const t=e.errorCode;n.error("Failed to set default localization data in the local storage. Error code is: ",t)}}(n,i,a.newLogger("UpdateI18nStorageTask","core-services-tasks"))}}class HL extends _e{constructor(){super(h.Yg.ClearHostSettingsTask,["loggerFactory"])}async execute(e){const{loggerFactory:t}=e,n=t.newLogger("ClearHostSettingsTask","core-services-tasks");e.hostSettings=void 0,n.log("ClearHostSettingsTask: Host settings cleared from task init context.")}}class VL extends _e{constructor(){super(h.Yg.CreateHostedWindowContext,["hostedWindowContext","hostSettings"])}async execute(e){const{hostedWindowContext:t,hostSettings:n}=e,i=n.hostSettings;i&&(t.sessionStartTime=i.createdTime,t.localeCode=i.localeCode,t.ring=i.hostRingId),"general_gcc"===t.ring&&i?.enableDevTools&&(t.ring="ring0_gcc")}}class GL extends _e{constructor(){super(h.Yg.EmbedExitEarlyIfPreAuthOnlyTask,["config","hostCommunicationService","scenarioFactory","loggerFactory","windowProvider"])}async execute(e){const{config:t,hostCommunicationService:n,scenarioFactory:i,loggerFactory:a,windowProvider:o}=e;if(!t.preInitAuth)return Promise.resolve();const r=i.newScenario(H.RG.EmbedPreAuth,{startTime:t.preInitAuthStartTime}),s=i.findScenario(H.RG.ExperienceReady);s?.cancel();const l=(0,Re.v4)();o.localStorage.setItem("embed-pre-auth-correlation-id",l),o.localStorage.setItem("embed-pre-auth-timestamp",Date.now().toString()),r.appendEventData({secondaryCorrelationId:l});const c=await n.loadModule("core"),d=await(0,ii.Yf)();return new Promise((e=>{if(!c||!c.registerForOnContinueWithTeamsCoreTasks||!c.signalPreAuthComplete){const e="Failed to load coreModule in EmbedExitEarlyIfPreAuthOnlyTask to signal preauth complete.";throw r.stop({message:e}),new Error(e)}c.registerForOnContinueWithTeamsCoreTasks((({reason:t})=>{a.newLogger("EmbedExitEarlyIfPreAuthOnlyTask","core-services-tasks").log(`Continue with core tasks because: ${t}`),e()})),r.stop();const t=o.setTimeout((()=>{d.flush(!0).finally((()=>{c?.signalPreAuthComplete?.()})),o.clearTimeout(t)}),1e3)}))}}class zL extends _e{constructor(){super(h.Yg.FetchHostSettingsTask,["config","hostedWindowContext","loggerFactory","windowProvider"])}async execute(e){const{config:t,hostedWindowContext:n,loggerFactory:i,windowProvider:a}=e,{isInCypressFrame:o,isInIframe:r}=n,s=i.newLogger("FetchHostSettingsTask","core-services-tasks");let l={};if(t.shouldFetchBootstrapData&&r&&!o)try{s.log("Hosted in web. Fetching host settings from host over IPC.");l={...(await a.opener.requestMessage(O.rY.GetStateData,{requestType:"hostSettings"})).hostSettings}}catch(e){s.errorToTelemetry&&s.errorToTelemetry(`Error fetching host settings over IPC ${e}`,"webclient_framework_foundation_core_services_tasks",void 0,!0)}else{s.log("Hosted in desktop. Getting host settings from window object.");const e=window;e.hostSettings&&(s.log("Found window.hostSettings."),l={...e.hostSettings},delete e.hostSettings)}if(!t.allowEmptyHostSettings&&!Object.keys(l).length)throw(0,de.Tr)(h.w5.Core,h.jK.Undefined,"FetchHostSettingsTask",void 0,"hostSettings are missing in experience that requires them.");s.log("setting context.hostSettings"),e.hostSettings=l}}var qL;!function(e){e[e.Unknown=5e4]="Unknown",e[e.GetSingletonStoreFailed=4e4]="GetSingletonStoreFailed",e[e.CreateStoreFailed=40001]="CreateStoreFailed",e[e.ActionNotSupported=40002]="ActionNotSupported"}(qL||(qL={}));var JL=n(942794),QL=n(52138),KL=n(88237);const YL={code:qL.CreateStoreFailed,message:"Store is not available"};function XL(e){return new ZL(e)}class ZL extends Cn.y{constructor(e){const t=e?eO(e):(0,JL._)(YL);super((e=>t.subscribe(e))),this._dispatcher=e?Promise.resolve(e):Promise.reject(YL)}async dispatch(e){return(await this._dispatcher).dispatch(e)}}const eO=e=>(0,c.D)(Promise.resolve(e)).pipe((0,mt.w)((e=>new Cn.y((t=>e.subscribe((e=>t.next(e))))))),(0,QL._)(1),(0,KL.x)());class tO extends Cn.y{constructor(e,t){const n=t.pipe((0,d.U)((t=>t?.windows[e]?.lifecycle)),(0,Es.x)(W.isEqual),(0,m.h)((e=>void 0!==e)),(0,vn.o)((e=>void 0===e.closedTime),!0));super((e=>n.subscribe(e))),this._id=e,this._dispatcher=t}pushWltMarks(e){return this._dispatcher.dispatch({type:"RECORD_WINDOW_LIFECYCLE_MARKS",windowId:this._id,markers:e})}}var nO=n(96638),iO=n(480080);class aO{constructor(e,t,n){if(this.exitFullscreen=e=>this._observableStore.dispatch((e=>({type:"SET_FULLSCREEN",windowId:e,fullscreen:!1}))(e)),this.focus=e=>this._observableStore.dispatch((e=>({type:"FOCUS_WINDOW",windowId:e}))(e)),this.maximize=e=>this._observableStore.dispatch((e=>({type:"TOGGLE_MAXIMIZE_WINDOW",windowId:e}))(e)),this.minimize=e=>this._observableStore.dispatch((e=>({type:"MINIMIZE_WINDOW",windowId:e}))(e)),this.requestFullscreen=e=>this._observableStore.dispatch((e=>({type:"SET_FULLSCREEN",windowId:e,fullscreen:!0}))(e)),this.show=e=>this._observableStore.dispatch((e=>({type:"SHOW_WINDOW",windowId:e}))(e)),this.windowTitleDblClick=e=>this._observableStore.dispatch((e=>({type:"INVOKE_DOUBLE_CLICK",windowId:e}))(e)),e.createInterprocessStore){const i=e.createInterprocessStore({logDebug:(...e)=>t.debug(...e),logError:(...e)=>t.error(...e),logInfo:(...e)=>t.log(...e),logScenario:e=>{n.newScenario(e.name).stop(void 0,e.status)}});this._observableStore=XL(i)}else this._observableStore=XL(null)}onWindowFullscreen(e){return this._observableStore.pipe((0,nO.j)("windows",e),(0,iO.n)((e=>void 0===e)),(0,vn.o)((e=>void 0===e.lifecycle?.closedTime)),(0,nO.j)("layout","fullscreen"),(0,Es.x)())}onLifecycleMarks(e){return new tO(e,this._observableStore)}}class oO extends _e{constructor(){super(h.Yg.InitInterprocessStore,["windowProvider","loggerFactory","scenarioFactory","coreSettings"])}async execute(e){const{windowProvider:t,loggerFactory:n,scenarioFactory:i,coreSettings:a}=e;a.get(b.J.Core).disableInterprocessStore||(e.interprocessStoreService=new aO(t,n.newLogger("InterProcessStore","core-services-tasks"),i)),delete t.createInterprocessStore}}class rO extends _e{constructor(){super(h.Yg.Polyfills,[])}async execute(){this.applyAsyncIteratorPolyfillIfNeeded()}applyAsyncIteratorPolyfillIfNeeded(){void 0===Symbol.asyncIterator&&(Symbol.asyncIterator=Symbol.asyncIterator||n(212673).$$asyncIterator)}}class sO{constructor(e){this.logsProviderTimeoutMs=2e4,this.coreProviders=[],this.userProviders={},this.primaryUserID="",this.allowZipLogFiles=!1,this.environmentName="",this.isDownloadLogStarted=new r.X(!1),this.observeDownloadLogStatus=()=>this.isDownloadLogStarted.asObservable(),this.setDownloadLogStatus=e=>{this.isDownloadLogStarted.next(e)},this.logger=e.newLogger("LogsCollectorService","core-services-logs-collector")}subscribeToCoreSettings(e){if(!e)return void this.logger.error("Failed to subscribe to core settings");e.getObservable(b.J.Diagnostics,["logsProviderTimeoutMs","shouldZipLogFiles"]).subscribe((({logsProviderTimeoutMs:e,shouldZipLogFiles:t})=>{e&&(this.logsProviderTimeoutMs=e),this.allowZipLogFiles=!!t}));e.getObservable(b.J.Metadata,["environment"]).subscribe((({environment:e})=>{e&&(this.environmentName=e)}))}registerCoreLogsProvider(e){e.logsProviderName===E.DIAGNOSTICSSERVICE?this.diagnosticsLogProvider=e:this.coreProviders.some((t=>t.logsProviderName===e.logsProviderName))?this.logger.warnNoPii?.(`Registering redundant core logger with name ${e.logsProviderName}`):this.coreProviders.push(e)}registerUserLogsProvider(e,t){this.primaryUserID&&!e&&(e=this.primaryUserID),this.userProviders[e]?this.userProviders[e].some((e=>e.logsProviderName===t.logsProviderName))?this.logger.warnNoPii?.(`Registering redundant user logger with name ${t.logsProviderName}`):this.userProviders[e].push(t):this.userProviders[e]=[t]}unregisterUserLogsProvider(e,t){this.primaryUserID&&!e&&(e=this.primaryUserID),this.userProviders[e]?(this.userProviders[e]=this.userProviders[e].filter((e=>e.logsProviderName!==t)),0===this.userProviders[e].length&&delete this.userProviders[e]):this.logger.warnNoPii?.(`Unregistering user logger with name ${t} failed, user ${e} not found`)}getCoreLogsProvider(e){return this.coreProviders.find((t=>t.logsProviderName===e))}getUserLogsProvider(e,t){return this.userProviders[e]?.find((e=>e.logsProviderName===t))}handleUserLogout(e){delete this.userProviders[e]}async callOnLogsFiles(e,t=!1,n=!1,i=0){return this.callOnUserLogsFiles(Object.keys(this.userProviders),e,t,n,i)}async callOnUserLogsFiles(e,t,i=!1,a=!1,o=0){let r;if(i&&this.allowZipLogFiles)try{const e=(await n.e(981578).then(n.t.bind(n,508413,23)))?.default;e&&(r=new e)}catch(e){this.logger.errorToTelemetry?.(`Load jszip failed - ${e}`,"logs_loading_jszip")}const s={fileName:"summary.txt",content:"",isPiiFree:!0},l=e=>r?.file?(r.file(e.fileName,e.content),Promise.resolve(!0)):(e.fileName=`WebLogs/${e.fileName}`,t(e)),c=await this.callOnOnlyCoreLogsFiles(l,s,a,o),d=await this.callOnOnlyUserLogsFiles(e,l,s,a,o),u=await this.createSummaryFile(l,s);if(r){const e=await r.generateAsync({type:"blob",compression:"DEFLATE"}),n=this.environmentName?`${this.environmentName.toUpperCase()}-`:"";return t({fileName:`${n}WebLogs-${(new Date).toISOString()}.zip`,content:e,isPiiFree:!0})}return c&&d&&u}async getSystemInfo(){let e=new Map;try{const t=async e=>{try{return await(0,V.E)(e.getSystemInfo(),this.logsProviderTimeoutMs)}catch(t){if((0,V.T)(t))return this.logger.error(`Timed out fetching system info from logs provider - ${e.logsProviderName}`),new Map;throw t}},n=this.coreProviders.map(t);this.diagnosticsLogProvider&&n.push(t(this.diagnosticsLogProvider));const i=await Promise.all(n);i&&i.length>0&&(e=i.reduce(((e,t)=>new Map([...Array.from(e.entries()),...Array.from(t.entries())]))))}catch(e){this.logger.error("Fetching system info from logs providers failed with error:",e)}return e}setPrimaryUserID(e){if(e&&!this.primaryUserID){this.primaryUserID=e;const t=this.userProviders[""];t&&(this.userProviders[this.primaryUserID]=t,delete this.userProviders[""])}}setGetSummaryFunction(e){this.generateSummary=e}getUserLogFileName(e,t){return`User (${e===this.primaryUserID?"Primary; ":""}${e})/${t}`}getCoreLogFileName(e){return`Core/${e}`}async callOnOnlyCoreLogsFiles(e,t,n=!1,i=0){try{const a=t=>(t.fileName=t.userId?this.getUserLogFileName(t.userId,t.fileName):this.getCoreLogFileName(t.fileName),e(t));this.logger.log(`Fetching files from providers: ${this.coreProviders.reduce(((e,t)=>e+`${t?.logsProviderName}, `),"")}`);const o=await this.callOnLogsFilesOfLogsProviders(this.coreProviders,a,t,n,i),r=!this.diagnosticsLogProvider||await this.callOnLogsFilesOfLogsProviders([this.diagnosticsLogProvider],a,t,n,i);return o&&r}catch(e){return this.logger.error("Error calling callback on logs files from all logs providers - error:",e),!1}}async callOnOnlyUserLogsFiles(e,t,n,i=!1,a=0){const o=[];return e.length>0&&e.forEach((e=>{if(this.userProviders[e]&&this.userProviders[e].length>0){const r=n=>(n.fileName=this.getUserLogFileName(e,n.fileName),t(n));o.push(this.callOnLogsFilesOfLogsProviders(this.userProviders[e],r,n,i,a))}})),(await Promise.all(o)).every(Boolean)}async timeoutSafeGetLogsFiles(e,t=!1,n=0){try{return await(0,V.E)(e.getLogsFiles(t,n),this.logsProviderTimeoutMs)}catch(t){if((0,V.T)(t))return this.logger.errorToTelemetry?.(`Timed out fetching logs files from logs provider - ${e.logsProviderName}`,"logs_fetching_error"),[];throw t}}async callOnLogsFilesOfLogsProviders(e,t,n,i=!1,a=0){const o=e.map((e=>this.timeoutSafeGetLogsFiles(e,i,a))),r=await Promise.all(o),s=[];r.forEach((e=>{e&&e.length>0&&s.push(...e)}));const l=s.map((e=>{try{return"latestErrors"===e.fileName?(n.content=`${n.content}${e.content}\r\n`,Promise.resolve(!0)):t(e)}catch(t){return this.logger.error(`Error calling callback on logs file, ${e?.fileName} - error:`,t),!1}}));return(await Promise.all(l)).every((e=>e))}async createSummaryFile(e,t){const n=await(this.generateSummary?.());return n&&(t.content=`${n}\r\n${t.content}`),e(t)}}var lO=n(701595);function cO(e,t){return`${e}_core_task_end_${t||""}`}function dO(e,t,n,i,a=!1){const o=e.createScenarioWithoutStarting(H.RG.CoreUserContextCreate,{startTime:n}),r=a?h.sM.OnUserAuthenticated_MTMA:h.sM.OnUserAuthenticated;return i&&function(e,t,n,i){const a=i.timeOrigin,o=i.getEntriesByName(t,"mark")||[];for(const t of o){const i=t.detail.taskId,o=t.detail.errorCode;e.mark(`${n}_${i}`,{overrideTimestamp:Math.round(t.startTime+a),errorCode:o})}i.clearMarks(t)}(o,cO(r,t),`core_task_${r}`,i),o}class uO{constructor(e,t){this.contextFactory=e,this.userRenderingContextMap=new Map,this.logger=t.newLogger("RenderingContextManager","core-services-activator")}async cleanupWithPriority(e){if(!this.defaultRenderingContext)return Promise.reject(new Me.G(Me.$.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=this.userRenderingContextMap.keys(),n=Array.from(t).map((t=>()=>this.cleanupActiveWindowsHistoryService(e,t)));await pO(n,this.defaultRenderingContext)}async createCoreServices(){this.logger.log("createCoreServices: start");const{coreTaskErrors:e,...t}=await this.contextFactory.createContext();this.defaultRenderingContext=t,this.logger.log("createCoreServices: done");const n=t&&Object.keys(t).sort(),i=`createCoreServices: ${(0,$.u4)(n)}`;return this.logger.infoToTelemetry?.(i,"webclient_framework_foundation_core_init",void 0,!0),{...t,error:mO(e,t,this.logger)}}async executePrimaryUserTasks(e){if(!this.defaultRenderingContext)return Promise.reject(new Me.G(Me.$.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=(0,xe.b4)(e);this.logger.log(`executePrimaryUserTasks(${t}): start`);const{coreTaskErrors:n,...i}=await this.contextFactory.createContext({authenticationUser:e,defaultRenderingContext:this.defaultRenderingContext,isPrimaryUser:!0}),a=mO(n,this.defaultRenderingContext,this.logger);if(delete i.authenticationUser,this.primaryUserContext=i,a)throw a;return this.logger.log(`executePrimaryUserTasks(${t}): done`),this.primaryUserContext}async removeAllRenderingContexts(e){if(!this.defaultRenderingContext)return Promise.reject(new Me.G(Me.$.RENDERING_CONTEXT_DOES_NOT_EXIST));const t=this.userRenderingContextMap.keys(),n=Array.from(t).map((t=>()=>this.removeUserRenderingContext(e,t)));await pO(n,this.defaultRenderingContext),this.primaryUserContext&&await this.contextFactory.destroyContext({context:this.primaryUserContext,reason:e}),await this.contextFactory.destroyContext({context:this.defaultRenderingContext,reason:e})}getUserRenderingContext(e){return this.userRenderingContextMap.get(e)}getDefaultRenderingContext(){return this.defaultRenderingContext}getOrCreateUserRenderingContext(e){const t=(0,xe.b4)(e);return this.defaultRenderingContext?(this.userRenderingContextMap.get(t)||this.userRenderingContextMap.set(t,this.createUserContextWithTelemetry(e,this.defaultRenderingContext)),this.userRenderingContextMap.get(t)):Promise.reject(new Me.G(Me.$.RENDERING_CONTEXT_DOES_NOT_EXIST,void 0,t))}async removeUserRenderingContext(e,t){const n=this.userRenderingContextMap.get(t);if(n){let i;"unknown_destroy"===e&&this.logger.errorToTelemetry?.(`Removing user context due to unknown. userRenderingContextSize: ${this.userRenderingContextMap.size}`,"webclient_framework_foundation_core_services",void 0,!0),this.userRenderingContextMap.delete(t);try{i=await n}catch(e){let t;return t=e instanceof Ee.G&&Ee.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():e&&`${e.name}::${e.message}`,this.logger.errorToTelemetry?.(`${Me.$.CLEANUP}::contextPromise::${t}`,"webclient_framework_foundation_core_services",void 0,!0),!1}return e="unknown_destroy"===e?"signout":e,await this.cleanupUserRenderingContext(i,e),this.primaryUserContext?.primaryUser?.id===t&&await this.cleanupPrimaryUserContext(e),!0}return this.logger.warn("RenderingContextManager::contextPromise is not defined"),!1}async createUserContextWithTelemetry(e,t){const{scenarioFactory:n}=t,i=!!t.coreSettings.get(b.J.Core)?.enableMTMA,a=n.findScenario(H.RG.GetAuthUser),[o,r]=He(n);o?.mark(H.ck.CoreUserContextStart);const s=Date.now(),l=(0,xe.b4)(e);try{const t=await this.createUserRenderingContext(e,i);return this.reportUserContextSuccess({getUserAuthScenario:a,expReadyScenario:r,clientStartScenario:o,scenarioStartTime:s,userContextId:l,isMTMAEnabled:i,scenarioFactory:t.scenarioFactory}),t}catch(e){const n=Ve(e,l);throw this.reportUserContextFailure({getUserAuthScenario:a,expReadyScenario:r,scenarioStartTime:s,error:n,userContextId:l,isMTMAEnabled:i,scenarioFactory:t.scenarioFactory}),n}}reportUserContextSuccess({getUserAuthScenario:e,expReadyScenario:t,clientStartScenario:n,scenarioStartTime:i,userContextId:a,isMTMAEnabled:o,scenarioFactory:r}){e&&e.stop(),t?.mark(H.ck.GetAuthUser),n?.mark(H.ck.CoreUserContextStop),dO(r,a,i,this.defaultRenderingContext?.windowProvider.performance,o).stop(void 0,"success")}reportUserContextFailure({getUserAuthScenario:e,expReadyScenario:t,scenarioStartTime:n,error:i,userContextId:a,isMTMAEnabled:o,scenarioFactory:r}){e&&e.fail(),t?.mark(H.ck.GetAuthUser,void 0,"failure"),dO(r,a,n,this.defaultRenderingContext?.windowProvider.performance,o).fail({message:`Failed to create user context for ${a}`,...ze(i,this.defaultRenderingContext?.coreSettings)})}async cleanupActiveWindowsHistoryService(e,t){let n;try{n=await this.getUserRenderingContext(t)}catch(e){return}try{n?.activeWindowsHistoryService?.cleanup(e)}catch(e){const t=new Me.G(Me.$.CLEANUP,e);this.logger.errorToTelemetry?.(t.toTelemetryEntry(),"webclient_framework_foundation_core_services_active_windows_history",void 0,!0)}}async cleanupUserRenderingContext(e,t){return await this.contextFactory.destroyContext({context:e,reason:t}),!0}async cleanupPrimaryUserContext(e){return this.logger.log("Cleaning up primary user context..."),await this.contextFactory.destroyContext({context:this.primaryUserContext,reason:e}),!0}async createUserRenderingContext(e,t){const n=(0,xe.b4)(e);this.logger.log(`createUserContext(${n}): start`);const{coreTaskErrors:i,...a}=await this.contextFactory.createContext({authenticationUser:e,defaultRenderingContext:this.defaultRenderingContext,isMTMAEnabled:t}),o=mO(i,this.defaultRenderingContext,this.logger);if(o)throw o;return this.logger.log(`createUserContext(${n}): done`),a}}function mO(e,t,n){let i;if(e&&e?.length>0)if(t?.coreSettings.get(b.J.Core).strictErrorMode)i=e[0];else{const t=e.filter((e=>e instanceof Ae));t.length>0&&t.forEach((e=>{n.errorToTelemetry?.(e.toTelemetryEntry(),"webclient_framework_foundation_core_services",void 0,!0)})),i=e.find((e=>e instanceof Me.G||e instanceof Bl.l||e instanceof Ae&&(e.prevError instanceof Me.G||e.prevError instanceof Bl.l)))}return i}async function pO(e,t){const n=t?.coreSettings.get(b.J.Core)?.readInSequence;if(n)for(const t of e)await t();else await Promise.all(e.map((e=>e())))}var gO=n(250033),hO=n(818319);const yO={id:"com.microsoft.teams.corelayout",actors:["corelayout"],name:"CoreLayoutApp"};var vO=n(250497);const fO={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutResizeSlotDimensionsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"width"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slotName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resizeSlotDimensions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"width"},value:{kind:"Variable",name:{kind:"Name",value:"width"}}},{kind:"Argument",name:{kind:"Name",value:"slotName"},value:{kind:"Variable",name:{kind:"Name",value:"slotName"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};const SO={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutResizeHeaderMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"height"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resizeHeaderSlot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"height"},value:{kind:"Variable",name:{kind:"Name",value:"height"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},kO={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutChangeSlotsVisibilityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"slotNames"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SlotName"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isHidden"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSlotsVisibility"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"slotNames"},value:{kind:"Variable",name:{kind:"Name",value:"slotNames"}}},{kind:"Argument",name:{kind:"Name",value:"isHidden"},value:{kind:"Variable",name:{kind:"Name",value:"isHidden"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},CO={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCoreLayoutChangeMonitorSlotMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityType"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityAction"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntityAction"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeMonitorSlotContent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"entityType"},value:{kind:"Variable",name:{kind:"Name",value:"entityType"}}},{kind:"Argument",name:{kind:"Name",value:"entityAction"},value:{kind:"Variable",name:{kind:"Name",value:"entityAction"}}},{kind:"Argument",name:{kind:"Name",value:"entityOptions"},value:{kind:"Variable",name:{kind:"Name",value:"entityOptions"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},bO="activity",wO="viewActivityApp",TO=()=>({actor:bO,action:wO}),IO="calendar",NO="viewCalendarApp",EO=()=>({actor:IO,action:NO}),AO="communities",_O="viewCommunitiesApp",FO=()=>({actor:AO,action:_O}),DO="VirtualConsumerEvents",PO="createVirtualConsumerEvent",MO="deleteVirtualConsumerEvent",xO="editVirtualConsumerEvent",RO="joinVirtualConsumerEvent",jO="shareVirtualConsumerEvent",LO="viewVirtualConsumerEvent",OO="viewVirtualConsumerEvents",$O=e=>({actor:DO,action:PO,data:e}),UO=e=>({actor:DO,action:MO,data:e}),BO=e=>({actor:DO,action:xO,data:e}),WO=e=>({actor:DO,action:RO,data:e}),HO=e=>({actor:DO,action:jO,data:e}),VO=e=>({actor:DO,action:LO,data:e}),GO=()=>({actor:DO,action:OO}),zO="calls-main",qO="viewCallsMainApp",JO="markAllAsRead",QO="startAudioCall",KO=()=>({actor:zO,action:qO}),YO=()=>({actor:zO,action:JO}),XO=e=>({actor:zO,action:QO,data:e}),ZO="chat",e$="viewChatApp",t$="chatWithUsers",n$="newChat",i$="popNewChat",a$="openChatThreadPane",o$="hideChatThreadPane",r$=()=>({actor:ZO,action:e$}),s$=e=>({actor:ZO,action:t$,data:e}),l$=()=>({actor:ZO,action:n$}),c$=()=>({actor:ZO,action:i$}),d$=e=>({actor:ZO,action:a$,data:e}),u$=e=>({actor:ZO,action:o$,data:e}),m$=e=>e.action===t$,p$=e=>e.action===a$,g$=e=>e.action===o$,h$="meet",y$="viewMeetApp",v$=()=>({actor:h$,action:y$}),f$="teamsandchannels",S$="viewTeamsAndChannelsApp",k$="switchToChannel",C$="loadUserOnboardingToTeamPage",b$="getLinkToChannel",w$="viewChannelEmail",T$="manageChannelMembers",I$="manageTeam",N$="leaveChannel",E$="manageChannel",A$="channelAddMembers",_$="shareChannelWithUser",F$="shareChannelWithTeam",D$="channelNotificationSettings",P$="manageTeamChannels",M$=()=>({actor:f$,action:S$}),x$=e=>({actor:f$,action:k$,data:e}),R$=e=>({actor:f$,action:C$,data:e}),j$=e=>({actor:f$,action:b$,data:e}),L$=e=>({actor:f$,action:w$,data:e}),O$=e=>({actor:f$,action:T$,data:e}),$$=e=>({actor:f$,action:I$,data:e}),U$=e=>({actor:f$,action:P$,data:e}),B$=e=>({actor:f$,action:N$,data:e}),W$=e=>({actor:f$,action:E$,data:e}),H$=e=>({actor:f$,action:A$,data:e}),V$=e=>({actor:f$,action:_$,data:e}),G$=e=>({actor:f$,action:F$,data:e}),z$=e=>({actor:f$,action:D$,data:e}),q$="simplecollab",J$="viewSimpleCollabApp",Q$="viewSimpleCollabSwitchBackConfirmationDialog",K$="switchToChat",Y$="switchToChannel",X$="channelNotificationSettings",Z$="channelWorkflows",eU="archiveChannel",tU="deleteChannel",nU="editChannel",iU="getLinkToChannel",aU="staleChannelsAdhocDialog",oU="manageChannel",rU="manageChannelTags",sU="manageChannelMembers",lU="viewChannelEmail",cU="manageTeam",dU="manageTags",uU="getLinkToTeam",mU="leaveTeam",pU="teamAddMember",gU="teamAddChannel",hU="deleteTeam",yU="channelAddMembers",vU="leaveChannel",fU="shareChannelWithUser",SU="shareChannelWithTeam",kU="shareChannelWithTeamYouOwn",CU="viewDiscover",bU="createConversationFolder",wU="removeConversationFolder",TU="renameConversationFolder",IU="chatManageApps",NU="leaveChat",EU="deleteChat",AU="viewTeamSeeAllChannels",_U="joinTeam",FU="createChannel",DU="createTeam",PU="manageTeams",MU="manageTeamChannels",xU="openFilterLeftRail",RU="switchToBizChatMetaOS",jU="openManageTeams",LU="createTeamOnMainView",OU=e=>({actor:q$,action:Q$,data:e}),$U=()=>({actor:q$,action:J$}),UU=e=>({actor:q$,action:K$,data:e}),BU=e=>({actor:q$,action:RU,data:e}),WU=e=>({actor:q$,action:Y$,data:e}),HU=e=>({actor:q$,action:X$,data:e}),VU=e=>({actor:q$,action:Z$,data:e}),GU=e=>({actor:q$,action:eU,data:e}),zU=e=>({actor:q$,action:tU,data:e}),qU=e=>({actor:q$,action:nU,data:e}),JU=e=>({actor:q$,action:iU,data:e}),QU=e=>({actor:q$,action:aU,data:e}),KU=e=>({actor:q$,action:oU,data:e}),YU=e=>({actor:q$,action:sU,data:e}),XU=e=>({actor:q$,action:rU,data:e}),ZU=e=>({actor:q$,action:lU,data:e}),eB=e=>({actor:q$,action:yU,data:e}),tB=e=>({actor:q$,action:vU,data:e}),nB=e=>({actor:q$,action:fU,data:e}),iB=e=>({actor:q$,action:SU,data:e}),aB=e=>({actor:q$,action:kU,data:e}),oB=e=>({actor:q$,action:cU,data:e}),rB=e=>({actor:q$,action:MU,data:e}),sB=e=>({actor:q$,action:dU,data:e}),lB=e=>({actor:q$,action:uU,data:e}),cB=e=>({actor:q$,action:mU,data:e}),dB=e=>({actor:q$,action:pU,data:e}),uB=e=>({actor:q$,action:gU,data:e}),mB=e=>({actor:q$,action:hU,data:e}),pB=e=>({actor:q$,action:IU,data:e}),gB=e=>({actor:q$,action:NU,data:e}),hB=e=>({actor:q$,action:EU,data:e}),yB=()=>({actor:q$,action:CU}),vB=e=>({actor:q$,action:bU,data:e}),fB=e=>({actor:q$,action:wU,data:e}),SB=e=>({actor:q$,action:TU,data:e}),kB=e=>({actor:q$,action:AU,data:e}),CB=e=>({actor:q$,action:_U,data:e}),bB=e=>({actor:q$,action:FU,data:e}),wB=e=>({actor:q$,action:DU,data:e}),TB=e=>({actor:q$,action:PU,data:e}),IB=e=>({actor:q$,action:"",data:e}),NB=e=>({actor:q$,action:xU,data:e}),EB=()=>({actor:q$,action:jU}),AB=e=>({actor:q$,action:LU,data:e}),_B="platform",FB="viewPlatformApp",DB="loadPlatformChunks",PB="openAppDetailsDialog",MB="openAboutDialog",xB="installPlatformApp",RB="uninstallPlatformApp",jB="blockUnblockBotChat",LB="openSuggestedLink",OB=(e,t)=>({actor:_B,action:FB,data:{appId:e,isMultiWindow:t}}),$B=()=>({actor:_B,action:DB}),UB=(e,t)=>({actor:_B,action:PB,data:{appId:e,scrollToSection:t}}),BB=e=>({actor:_B,action:xB,data:{appId:e}}),WB=(e,t,n)=>({actor:_B,action:RB,data:{appId:e,appName:t,isInUse:n}}),HB=e=>({actor:_B,action:MB,data:{appId:e}}),VB=e=>({actor:_B,action:jB,data:{appId:e}}),GB=e=>({actor:_B,action:LB,data:{tileId:e}}),zB="queues",qB="viewDefaultQueuesApp",JB="viewQueuesApp",QB="switchToCallQueue",KB="selectQueueUser",YB="selectCallHistoryRow",XB="switchToQueuesAnalytics",ZB="selectRealTimeAnalyticsNavigationItem",eW="selectHistoricalAnalyticsNavigationItem",tW="selectCallQueueOverview",nW="navigateToChannel",iW="navigateToSettings",aW=()=>({actor:zB,action:qB}),oW=()=>({actor:zB,action:XB}),rW=e=>({actor:zB,action:ZB,data:e}),sW=e=>({actor:zB,action:eW,data:e}),lW=e=>({actor:zB,action:QB,data:e}),cW=e=>({actor:zB,action:KB,data:e}),dW=e=>({actor:zB,action:YB,data:e}),uW=e=>({actor:zB,action:tW,data:e}),mW=e=>({actor:zB,action:nW,data:e}),pW=e=>({actor:zB,action:iW,data:e}),gW="store",hW="viewStoreApp",yW=()=>({actor:gW,action:hW}),vW="homepage",fW="viewHomepageApp",SW=()=>({actor:vW,action:fW}),kW={People:"People",LivePersonaEditor:"LivePersonaEditor"},CW="viewPeopleApp",bW="subscribeToPresence",wW="switchToContactTag",TW="openLivePersonaEditorDialog",IW="closeLivePersonaEditorDialog",NW="openAddContactDialog",EW=e=>({actor:kW.LivePersonaEditor,action:TW,data:e}),AW=()=>({actor:kW.LivePersonaEditor,action:IW}),_W=e=>({actor:kW.People,action:wW,data:e}),FW=e=>({actor:kW.People,action:bW,data:e}),DW=()=>({actor:kW.People,action:CW}),PW=()=>({actor:kW.People,action:NW}),MW="14d6962d-6eeb-4f48-8890-de55454bb136",xW="86fcd49b-61a2-4701-b771-54728cd291fb",RW="ef56c0de-36fc-4ef8-b417-3d82ba9d073c",jW="2a84919f-59d8-4441-a975-2a8c2643b741",LW="3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40",OW="20c3440d-c67e-4420-9f80-0e50c39693df",$W="5af6a76b-40fc-4ba1-af29-8f49b08e44fd",UW="957ed0e3-e5ca-4c82-9676-fd037185c4d8",BW="a63f7012-8cc9-42d5-99c3-e35f526fab17",WW="3b95919f-59d8-4441-a975-2a8c2643c852",HW="40472f6e-248f-4599-842c-ff3ed8f0ae34",VW="66aeee93-507d-479a-a3ef-8f494af43945",GW="ac40aa4a-fef1-4896-aea2-46d1c14dbfd5",zW="7133fca9-0853-4e7a-bb5d-32d4e5f6020a",qW="a02e4d17-af86-4ceb-9c97-4c2626eb3587",JW="7831feaf-c4c4-4669-ba64-ce4ea0b56d31",QW=(e,t)=>{if("platform"===t.platformType)return{appName:"platformApp",appViewCommand:{command:OB(e,t.launchOut||!1)}};switch(e){case GW:return{appName:"store",appViewCommand:{command:yW()}};case MW:return{appName:"activity",appViewCommand:{command:TO()},focusOnLeftRailItem:!0};case RW:return{appName:"calendar",appViewCommand:{command:EO()}};case OW:return{appName:"callsmain",appViewCommand:{command:KO()}};case jW:return{appName:"channel",appViewCommand:{command:M$()},focusOnLeftRailItem:!0};case LW:return{appName:"simpleCollab",appViewCommand:{command:$U()},focusOnLeftRailItem:!0};case xW:return{appName:"chat",appViewCommand:{command:r$()},focusOnLeftRailItem:!0};case WW:return{appName:"communities",appViewCommand:{command:FO()},focusOnLeftRailItem:!0};case HW:return{appName:"virtualConsumerEvents",appViewCommand:{command:GO()}};case UW:case BW:return{appName:"meet",appViewCommand:{command:v$()}};case VW:return{appName:"assignments",appViewCommand:{command:OB(VW,t.launchOut||!1)}};case zW:return{appName:"homepage",appViewCommand:{command:SW()}};case qW:return{appName:"queues",appViewCommand:{command:aW()}};case JW:return{appName:"peopleApp",appViewCommand:{command:DW()}};default:return}},KW={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCoreLayoutDefaultAppQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365DefaultApp"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultAppId"}},{kind:"Field",name:{kind:"Name",value:"platformType"}}]}}]}}]},YW="DefaultCommand",XW=async(e,t)=>{const{data:{m365DefaultApp:{defaultAppId:n,platformType:i}}}=await e.query({query:KW}),{appViewCommand:a,appName:o}=QW(n,{platformType:i})||{};return t.log(`${YW} - Default app found: ${o}`),a},ZW=(e,t,n)=>t?e.getActiveWindow(t):e.getMainWindowWithLayoutMode(n||ke.lO.standard),eH=e=>!!e?.activeEntities,tH=({forceTransition:e=!1,shouldShowWithoutFocus:t=!1})=>({entity:{type:Se.py.default,action:e?Se.uk.view:Se.uk.default},command:{visibilityState:t?ke.fe.showWithoutFocusing:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.CoreLayoutApp}}}),nH=e=>({entity:e,command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.CoreLayoutApp}},entityOptions:e.options&&JSON.parse(e.options)}),iH=e=>"entity"in e;const aH={eventHandlers:{onEventReceived:async e=>{const{appViewState:t,eventInput:n,requestContext:{client:i,loggerFactory:a},windowId:o}=e,r=a.newLogger("apps-core-layout","apps-core-layout"),s=n.event;if(!function(e){if(e.originator!==vO.kn)return!1;for(const t in vO.uS)if(t===e.type)return!0;return!1}(s))return r.error(`Unhandled event ${n} is not a core layout event`),Promise.reject(new Error(`Unhandled event ${n.event.type} is not a core layout event`));switch(s.type){case vO.uS.criticalAppPhaseReached:return t.postCriticalPhaseReached.update(!1),void t.completePhaseReached.update(!1);case vO.uS.postCriticalAppPhaseReached:return void t.postCriticalPhaseReached.update(!0);case vO.uS.completeAppPhaseReached:return void t.completePhaseReached.update(!0);case vO.uS.resizeSlot:return void i.mutate({mutation:fO,variables:{slotName:s.data?.().slotName,width:s.data?.().width,windowId:o}});case vO.uS.updateAmsV2Domain:const{amsV2Domain:e}=s.data();return void(t.amsV2Domain.read()!==e&&t.amsV2Domain.update(e||""));case vO.uS.updateMeControlAvatarSrc:const{meControlAvatarSrc:a}=s.data();return void(t.meControlAvatarSrc.read()!==a&&t.meControlAvatarSrc.update(a||""));case vO.uS.updateBaseImageUrl:const{baseImageUrl:l}=s.data();return r.log(`Received baseImageUrl core-layout event with data ${l}`),void(t.baseImageUrl.read()!==l&&(r.log(`Updating baseImageUrl app view state ${l}`),t.baseImageUrl.update(l||"")));case vO.uS.updateIsImageAuthCookieValid:const{isImageAuthCookieValid:c}=s.data?.()||{};return void(void 0!==c&&t.isImageAuthCookieValid.read()!==c&&t.isImageAuthCookieValid.update(c));case vO.uS.showMonitor:return Promise.resolve({command:Nt.CN.showMonitor(n.event.data?.())});case vO.uS.updateDialogState:return Promise.resolve({command:Nt.CN.updateDialogState(n.event.data?.())});case vO.uS.closeMonitor:return Promise.resolve({command:Nt.CN.closeMonitor()});case vO.uS.hideMonitor:return Promise.resolve({command:Nt.CN.hideMonitor()});case vO.uS.unhideMonitor:return Promise.resolve({command:Nt.CN.unhideMonitor()});default:return r.error(`Unhandled event ${n}`),Promise.reject(new Error(`Unhandled event ${n.event.type}`))}}},onCommandReceived:async e=>{const{activeWindowsService:t,appsRegistryService:n,commandInput:i,requestContext:{client:a,loggerFactory:o,coreSettings:r},slotDimensionsOptions:s,windowId:l}=e,{command:{action:c,actor:d,data:u}}=i,m=o.newLogger("CoreLayoutApp onCommandReceived","apps-core-layout");if(!yO.actors.includes(d))return void m.error(`Command  ${i.command} is sent to the wrong App.`);const{header:{height:p}}=s,{collapsed:g,expanded:h}=p||{};switch(c){case Nt.Nw.collapseHeader:a.mutate({mutation:SO,variables:{height:g,windowId:l}});break;case Nt.Nw.expandHeader:a.mutate({mutation:SO,variables:{height:h,windowId:l}});break;case Nt.Nw.hideHeader:{const e=[yt.WL.HEADER];a.mutate({mutation:kO,variables:{slotNames:e,windowId:l,isHidden:!0}});break}case Nt.Nw.unhideHeader:{const e=[yt.WL.HEADER];a.mutate({mutation:kO,variables:{slotNames:e,windowId:l,isHidden:!1}});break}case Nt.Nw.expandTab:{const{excludeHeader:e}=u||{},t=e?[yt.WL.NOTIFICATIONS,yt.WL.SUBNAV]:[yt.WL.HEADER,yt.WL.NOTIFICATIONS,yt.WL.SUBNAV];a.mutate({mutation:kO,variables:{slotNames:t,windowId:l,isHidden:!0}});break}case Nt.Nw.maximizeTab:a.mutate({mutation:kO,variables:{slotNames:[yt.WL.HEADER,yt.WL.NAV,yt.WL.NOTIFICATIONS,yt.WL.SUBNAV,yt.WL.TITLE_BAR],windowId:l,isHidden:!0}});break;case Nt.Nw.openCoreDialog:const{entity:o,correlation:s,targetWindow:d}=u,p=await(async(e,t,n,i,a)=>{const{activeWindowsService:o,appsRegistryService:r,requestContext:{client:s,coreSettings:l}}=t,{enableHandlingDefaultCommandsInCoreLayoutApp:c}=l.get(b.J.Core,["enableHandlingDefaultCommandsInCoreLayoutApp"]);if(!c)return nH(e);if(ZW(o,n,i))return nH(e);const d=await XW(s,a);if(!d)return nH(e);a.log(`${YW} - Getting default command behind modal for: ${d.command.actor}`);const u=r.getAppByActor(d.command.actor);if(!u||!u.onCommandReceived)return nH(e);const m=await u.onCommandReceived({...t,commandInput:d});return m&&iH(m)?(a.log(`${YW} - Got a default command command behind modal with entity type: ${m.entity.type}`),{...nH(e),defaultEntityBehindExtension:m.entity}):nH(e)})(o,e,d?.id,d?.layoutMode,m);if(p)return p;t.executeCommand("handleExtendCommand")({entity:o,correlation:{id:s?.id||(0,Re.v4)(),startTimestamp:s?.startTimestamp||Date.now(),source:s?.source||C.D.Core},openOnMainWindow:!!d?.name,mainWindowLayoutMode:d?.layoutMode,windowId:l,userContextId:l&&t.getActiveWindow(l)?.userContextId||null});break;case Nt.Nw.updateDialogState:const{containerState:y}=u;t.getWindowLayoutService(l).modalManager.setContainerState(y,!0);break;case Nt.Nw.resetLayoutOverrides:a.mutate({mutation:kO,variables:{slotNames:[yt.WL.HEADER,yt.WL.NAV,yt.WL.NOTIFICATIONS,yt.WL.SUBNAV,yt.WL.TITLE_BAR],windowId:l,isHidden:!1}});break;case Nt.Nw.showMonitor:a.mutate({mutation:CO,variables:{windowId:l,entityType:"floatingmonitor",entityAction:"view",entityOptions:JSON.stringify(i.command.data)}});break;case Nt.Nw.closeMonitor:a.mutate({mutation:CO,variables:{windowId:l,entityType:"floatingmonitor",entityAction:"leave"}});break;case Nt.Nw.hideMonitor:a.mutate({mutation:kO,variables:{slotNames:[yt.WL.MONITOR],windowId:l,isHidden:!0}});break;case Nt.Nw.unhideMonitor:a.mutate({mutation:kO,variables:{slotNames:[yt.WL.MONITOR],windowId:l,isHidden:!1}});break;case Nt.Nw.showOopsPage:return function(e,t,n,i){const{error:a}=e,o=i?n.getActiveWindow(i):n.getStandardMainWindow(),r=o?.correlation.id;r||t.warn("Unable to get active target window for use in correlating oops page.");let s;try{s=a.serialize()}catch{t.warn("Could not serialize error in showing oops page.")}return{entity:{type:Se.py.error,action:Se.uk.view},command:{stateTransition:ke.su.forceFlush,visibilityState:ke.fe.show,correlation:{source:C.D.LayoutError,id:r}},entityOptions:{errorReason:a.code,serializedError:s}}}(u,m,t,l);case Nt.Nw.defaultCommand:return(async(e,t,n,i,a,{forceTransition:o,windowId:r,layoutMode:s,shouldShowWithoutFocus:l,userContextId:c})=>{const{enableHandlingDefaultCommandsInCoreLayoutApp:d}=t.get(b.J.Core,["enableHandlingDefaultCommandsInCoreLayoutApp"]),u=tH({forceTransition:o,shouldShowWithoutFocus:l});if(!d)return u;const m=ZW(n,r,s),p=!(!c||!m?.isMainWindow)&&c!==m?.userContextId;if(!p&&!o&&eH(m))return i.log(`${YW} - Suppressing default command for window: ${r}, isUserSwitch:${p}, forceTransition:${o}`),u;const g=await XW(e,i);return g&&i.log(`${YW} - Default command found: ${g.command.action}`),g?a.getAppByActor(g.command.actor)?g:(i.warn(`${YW} - No app found for default command: ${g.command.actor}, falling back to default/default to be handled by entityCommandResolvers`),u):(i.warn(`${YW} - No default command found, falling back to default/default to be handled by entityCommandResolvers`),u)})(a,r,t,m,n,u);default:m.error(`Command action ${c} is not supported at CoreLayoutApp.`)}},onViewUpdateCommandResolved:async()=>{},viewStateRegistration:{gqlTypeName:"CoreLayoutAppViewState",queryFieldName:"coreLayoutAppViewState",navigationalFieldDefaultValues:{},nonNavigationalFieldDefaultValues:{amsV2Domain:"",baseImageUrl:"",completePhaseReached:!1,isImageAuthCookieValid:!1,meControlAvatarSrc:"",postCriticalPhaseReached:!1},computedValues:void 0}};class oH{constructor(e){this._taskManagerService=e}createContext(e={}){const{authenticationUser:t,defaultRenderingContext:n,isMTMAEnabled:i,isPrimaryUser:a}=e;if(!t)return this._taskManagerService.notifyLifeCycleEvent(h.sM.Initialization);if(a)return this._taskManagerService.notifyLifeCycleEvent(h.sM.OnPrimaryUser,{...n,primaryUser:t,authenticationUser:t});const o=i?h.sM.OnUserAuthenticated_MTMA:h.sM.OnUserAuthenticated,r=(0,xe.b4)(t);return this._taskManagerService.notifyLifeCycleEvent(o,{...n,authenticationUser:t},((e,t)=>n?.windowProvider.performance&&function(e,t,n,i,a){const o=a?ze(a):void 0;n.mark(cO(i,t),{detail:{taskId:h.Yg[e],errorCode:o?.errorCode}})}(e,r,n?.windowProvider.performance,h.sM[o],t)))}destroyContext(e){const{context:t,reason:n}=e;return this._taskManagerService.destroyContext(t,n)}}const rH=function(){const e=()=>null;return{...aH,manifest:yO,render:async()=>(0,gO.t)(e,{})}}(),sH="authenticated_user_subscription_failed",lH="create_user_context_failed",cH="init_core_service_failure",dH="show_taskbar_caution_indicator_failed",uH="user_data_undefined",mH="user_renderingContext_generation_error",pH=(e,t,n)=>{e.errorToTelemetry&&e.errorToTelemetry(t,n,void 0,!0)};class gH{constructor(e){this._activeWindows=new r.X([]),this._contextSubject=new s.t(1),this._isCleanupRunning=!1,this.AppStateToCleanupReasonMap=new Map([[y.G5.quit,"quit"],[y.G5.restart,"restart"]]),this.cleanupOnAppStateChangedCallback=async e=>{const{appState:t}=e;if(!et.has(t))return;if(this._isCleanupRunning){const e=new Me.G(Me.$.CLEANUP,new Error(`cleanupOnAppStateChangedCallback run more than once ${t}`));return void(this._logger.warnToTelemetry&&this._logger.warnToTelemetry(e.toTelemetryEntry(),"webclient_framework_foundation_core_services",void 0,!0))}this._isCleanupRunning=!0;const n=this.AppStateToCleanupReasonMap.get(t);if(!n){const e=new Me.G(Me.$.CLEANUP,new Error(`cleanupOnAppStateChangedCallback has undefined reason from ${t}`));throw pH(this._logger,e.toTelemetryEntry(),"webclient_framework_foundation_core_services"),e}await tt({hostCommunicationService:this.coreServices.hostCommunicationService,logger:this._logger,reason:n,renderingContextManager:this._renderingContextManager})},this.trackAuthUsers=e=>{const t=this.isMTMACoreEnabled(e.coreSettings);return(0,l.z)((0,d.U)((e=>t?e:e.slice(0,1))),(0,d.U)((e=>e.map((e=>({...e,id:(0,xe.b4)(e)}))))),ge((async e=>this.onUserAuthenticated(e)),(async e=>this.onUserDestroy(await e)),(async(e,t)=>t),((e,n)=>{if(!t)throw n})))};const t=(0,L.J)(),n=t?.defaultConsoleLogLevel||t?.loader?.getInitConsoleLogLevel?.(),a=t?.loader?.getProperties?.(),o=new Z(a?.sessionId||"",e.config.experienceName,i.DiagnosticsLogsMain,n?.preECSConsoleLogLevel,n?.userConsoleLogLevel),c=new te(t);o.setLogsCountReporter(c);const u=new le(o,"00000000-0000-0000-0000-000000000000");this._config=e.config;const m=new Ne(u,this._config,rH,e.apps);this._logger=u.newLogger("Core","core-services-activator");const p=new sO(u);let g;a&&a.isMaglev&&(g=a.preCoreHostCommunication),this._preCoreLogsFileService=new lO.N(u,p,void 0,g),t.addEventListener("downloadLogs",(async()=>{await this._preCoreLogsFileService.downloadLogsFiles(t)})),p.registerCoreLogsProvider(o);const h=t?.loader?.getLogsProvider?.();h&&p.registerCoreLogsProvider(h),a&&a.isMaglev&&a.preCoreHostCommunication&&this.registerForLogsDownloadSignalFromDesktop(t,a.preCoreHostCommunication);const v=e.config.useReactWebClientCoreTasks?{Initialization:()=>[new Uu,new jP,new bx,new bL,new NP,new TP,new mP,new PA,new Gu,new dg,new TL,new Ix,new qj,new Vm,new tF,new aR,new MA,new IF,new tR,new Hj,new q_,new CF,new FP,new xP,new f_,new bc,new ll,new Kj,new nR,new hL,new bg,new CP,new xL,new H_,new L_,new dc,new UL,new xx,new xA,new G_,new Cc,new iR,new BL,new AA,new $u,new Ru,new nu,new Tx,new xm,new iF,new lP,new LE,new $P,new qu,new zu,new C_,new pg,new NA,new k_,new Rm,new R_,new gg,new Wx,new $x,new VD,new Jj,new iL,new wc,new SP,new TF,new wF,new dL,new Zx],OnPrimaryUser:()=>[new eL,new Zj,new PM,new Xj,new pR,new Hx,new Qj,new kx],OnUserAuthenticated:()=>[new eL,new PM,new zl,new Px,new hc,new XD,new Nc,new lL,new oL,new WL,new iu,new dR,new Ax,new vs,new AP,new nL,new wx,new mR,new Rm,new ws,new zj,new ul,new Nx,new Yx,new aL,new sL],OnUserAuthenticated_MTMA:()=>[new eL,new MM,new PM,new XD,new ug,new zl,new OL,new G_,new Cc,new f_,new hc,new rL,new lL,new WL,new wx,new mR,new Nc,new xu,new ul,new Yx,new UP,new $P,new qu,new zu,new C_,new pg,new k_,new Rm,new Px,new iu,new dR,new Ax,new vs,new AP,new nL,new ws,new zj,new Nx,new aL,new sL]}:{Initialization:()=>[new rO,new Uu,new jP,new bx,new NP,new TP,new zL,new VL,new mP,new PA,new Gu,new dg,new hL,new qj,new Vm,new tF,new MA,new IF,new Hj,new CF,new FP,new f_,new bc,new ll,new HL,new CP,new H_,new L_,new dc,new GL,new xx,new xA,new G_,new Cc,new iR,new AA,new $u,new Ru,new nu,new xm,new iF,new lP,new LE,new $P,new qu,new zu,new C_,new NA,new k_,new gg,new VD,new R_,new oO,new wc,new SP,new TF,new Zx],OnUserAuthenticated:()=>[new eL,new PM,new Xj,new pR,new wx,new mR,new zl,new Px,new XD,new Nc,new oL,new iu,new dR,new Ax,new nL,new zj,new sL]};this._taskManagerService=new Je(u,m,e.config,e.loadConfigs,function(e){const t=je({externalId:e,source:C.D.ExternalCommand});return t.id=`Core-${t.id}`,t}(this._config.externalCorrelationId),v,o,p,this.waitForRenderingContextReady.bind(this),this.isEntityInView.bind(this),e.criticalDynamicImports,e.getPlatformConfigurationOverrides),this._templateGenerator=e.generateChildWindowTemplate,this._trackWindowsOperator=vr;const f=new oH(this._taskManagerService);this._renderingContextManager=new uO(f,u)}get activeWindows(){return this._activeWindows}async init(){try{const e=await this.initializeCoreServices();!function(e){const{coreSettings:t,logsCollectorService:n}=e,{testAutomation:i}=t.get(b.J.Test);if(i){const e=window;e.WeakRef&&(e.hooks||(e.hooks={}),e.hooks.__TEST_ONLY_LOGS_COLLECTOR_SERVICE_REF=new e.WeakRef(n))}}(e),this._config.supportsAsyncUserContext||await this.awaitUserContextIfAvailable(),this.signalCoreInitSuccess(e);const t={logger:this._logger,renderingContextManager:this._renderingContextManager};e.authenticationService?.registerCleanUpOnLogoutCallback?.(C.D.Core,(n=>nt({...t,coreSettings:e.coreSettings,reason:"signout",user:n&&(0,xe.KQ)(n)}))),this.registerForAppStateChanged(e.hostCommunicationService)}catch(e){throw this.reportCoreInitError(e,this._coreServices),e}}get coreServices(){if(!this._coreServices)throw(0,de.Tr)("Entry",h.jK.NotPresent,"CoreServices not available");return this._coreServices}get userContexts(){return this._contextSubject}async initializeCoreServices(){const{error:e,...t}=await this._renderingContextManager.createCoreServices();this._coreServices=t,this.initializeKPIs(t.scenarioFactory),e&&this.handleError(e);return this._coreServices.coreSettings.get(b.J.Core).chainObserveUsersAfter1stNavigationCompletes?this.setupNavigationHandling(t,!!e).then((()=>{const e=this._coreServices?.coreSettings.get(b.J.Core).enableSkipObserveAuthUsers;e||this.observeAuthenticatedUsers(t)})):(this.setupNavigationHandling(t,!!e),this.observeAuthenticatedUsers(t)),t}signalCoreInitSuccess(e){const[t,n]=He(e.scenarioFactory);n?.mark(H.ck.InitCoreServicesComplete),t?.mark(H.ck.CoreInitStop),t&&(0,L.J)()?.loader?.stopPieTimer?.(),this._logger.log("hostComms::setCoreInitialized"),e.hostCommunicationService.loadModule("core").then((e=>{e?.setCoreInitialized?.()})),this.markCoreInitCompleteInAltScenario(e.altScenarioService);const i=Date.now();e.telemetryService.setCoreInitTime(i),e.logsCollectorService.setGetSummaryFunction(Ge(this._coreServices?.platformService,this._coreServices?.i18n,this._coreServices?.authenticationService,this._coreServices?.coreSettings))}handleError(e){if(!this.canDisplayCriticalErrorPage(this._coreServices))throw this.reportCoreInitError(e,this._coreServices),e;this.reportCoreInitError(e,this._coreServices,H.ck.CoreInitFailure),this._contextSubject.error(Ve(e))}setupNavigationHandling(e,t){if(!this.canHandleNavigationIntents(e)){const t=e&&Object.keys(e).sort(),n=`Unable to process navigation intents, ${`${(0,$.u4)(t)}`}:: dataClient::${Boolean(e?.client)}, deeplink::${Boolean(e.deeplinkService)}, entityCommanding::${Boolean(e.entityCommanding)}`;throw(0,de.Tr)(h.w5.Core,h.jK.CoreNavigationServicesMissing,n)}return e.coreSettings.get(b.J.Core).enableIframeTracking&&(this._trackWindowsOperator=jo),e.activeWindowsService.enableDecoupleCommandingFromApollo?this.observeWindowsWithoutApollo(e).subscribe(this._activeWindows):this.observeWindows(e).subscribe(this._activeWindows),((e,t)=>{const{windowProvider:n,loggerFactory:i,clientState:a,dataClientTrackingService:o,windowTrackerService:r,graphqlOpsCountService:s,leakDetectorService:l}=e,c=i.newLogger("Main-Window-Event-Listeners","core-services-activator");(0,Vo.R)(n.opener,O.rY.ShouldShowChatNotification).pipe((0,Go.M)(t,a.observe())).subscribe((async([i])=>{try{if(!i||!i.payload||!i.payload.convId)throw new Error(`Invalid payload for shouldShowChatNotification with ${JSON.stringify(i)}`);let a="chats";i.payload.entityType?a=i.payload.entityType:c.log(`null entityType received: ${i.payload.entityType}`),c.log(`Received shouldShowNotification request for conv ${i.payload.convId} with entityType ${a}`);const o=await Ue({action:Se.uk.view,id:i.payload.convId,linkedEntity:null,type:a},e.client,c),r=!Be(o,t,e.clientState,c);zo(n,r,o),c.log(`Sending windowid: ${o} and shouldShowChatNotification: ${r} for conv ${i.payload.convId}`)}catch(e){c.error(`Failed to query window for entity with error ${e}`),zo(n,!0,void 0)}})),r?.init(),(0,Vo.R)(n.opener,O.rY.GetWindowEntityTypeStats).subscribe((()=>{n.opener.postMessage(O.rY.GetWindowEntityTypeStats,{windowEntityTypeStats:r?.getTelemetry()})})),(0,Vo.R)(n.opener,O.rY.GetApolloCacheStats).subscribe((()=>{n.opener.postMessage(O.rY.GetApolloCacheStats,{apolloCacheStats:o?.getTelemetry()})})),s&&(0,Vo.R)(n.opener,O.rY.GetCdlStats).subscribe((()=>{n.opener.postMessage(O.rY.GetCdlStats,{cdlStats:s?.getLatestDataAndClear()})}));(0,Vo.R)(n.opener,O.rY.GetHeartbeat).subscribe((()=>{let t="";e.appResponsivenessService&&(t=e.appResponsivenessService.getTelemetry()),n.opener.postMessage(O.rY.GetHeartbeat,{windowEntityTypeStats:r?.getTelemetry(),apolloCacheStats:o?.getTelemetry(),ariTelemetry:t,OLDStats:l?.getTelemetry()})}))})(e,this.activeWindows),e.deeplinkService.init(t)}async awaitUserContextIfAvailable(){await this._contextSubject.pipe((0,u.P)()).toPromise()}initializeKPIs(e){if(e){const t=e.findScenario(H.RG.ClientStart),n=(0,L.J)()?.loader?.getProperties?.();n?.deeplinkId&&t?.appendEventData({deeplinkId:n.deeplinkId}),n?.RelaunchReason&&t?.appendEventData({RelaunchReason:n.RelaunchReason});const i=(0,L.J)()?.localStorage.getItem(f.T2WebOptInSessionId);i&&t?.appendEventData({t2WebOptInSessionId:i});const a=(0,L.J)()?.localStorage.getItem(f.AttemptedWebBootCount);a&&t?.appendEventData({attemptedWebBootCount:a}),t?.mark(H.ck.CoreInitStart)}const t=e?.findScenario(H.RG.ExperienceReady);t?.mark(H.ck.InitCoreServices),t?.startStep(H.ck.GetAuthUser)}reportCoreInitError(e,t={},n){const i=e instanceof Ee.G?(e=>e.prevError||(0,de.Tr)(h.w5.Core,h.jK.NotInitialized,e.code,void 0,e.message))(e):e,a=i.context===h.w5.Core?i:(0,de.Tr)(h.w5.Core,i.code||h.jK.NotInitialized,i.context,{innerError:i}),o=a.subContext||"UnknownCoreInitFailure",r=(0,ce.A)((0,de.B9)(a));this._logger.warn(`Initializing Core failed. Message: ${r}, subContext: ${o}`);const[s,l]=He(t.scenarioFactory),c={errorCode:e instanceof Ee.G&&Ee.G.isFunction(e.toTelemetryEntry)?e.toTelemetryEntry():a.code??h.jK.CoreInitFailure,reason:h.jK.CoreInitFailure},d=(0,L.J)()?.loader;n?(s?.mark(n,c),t?.altScenarioService?.altScenario?.mark(n,c)):(s?.fail(c),t?.altScenarioService?.altScenario?.fail(c)),s&&d?.stopPieTimer?.(),this._coreServices?.diagnosticsService?.persistDiagnosticsAsPreviousSessionLogs(),d?.persistLoaderLogsAsPreviousSession(),l?.fail({contentType:(0,ce.A)(`${a.context}-${a.subContext}`),errorCode:(0,de.qZ)(a),errors:r,reason:cH}),t?.windowProvider?.opener.postMessage(w.W.CoreInitializationFailed,{errorDescription:o}),t?.coreSettings?.get(b.J.Core)?.enableTaskbarIconOnCoreInitFailure&&async function(e,t){try{const t=await(e?.loadModule("taskbar"));t?.showBadge?.({icon:{glyphBadge:{glyph:A.t.attention}}})}catch(e){pH(t,`${dH}: ${e}`,"webclient_framework_foundation_core_services")}}(t?.hostCommunicationService,this._logger)}markCoreInitCompleteInAltScenario(e){performance?.mark?.(N),e?.altScenario?.mark(H.ck.PostCoreInitializationTasks)}async waitForRenderingContextReady(e,t){return this.isGettingContextByIdEnabled(this._coreServices?.coreSettings)?this.getOrCreateRenderingContextForId(t):this._contextSubject.pipe((0,m.h)((t=>!e||!!t.authenticationUser?.isAuthenticated)),(0,u.P)()).toPromise()}getExistingContextForId(e){if(!e){const e=this._renderingContextManager.getDefaultRenderingContext();return e&&Promise.resolve(e)||Promise.reject(new Me.G(Me.$.RENDERING_CONTEXT_DOES_NOT_EXIST))}return this._renderingContextManager.getUserRenderingContext(e)}getContextObservable(e){return!this.isGettingContextByIdEnabled(this._coreServices?.coreSettings)||this._contextSubject.hasError?this._contextSubject:(0,c.D)(this.getExistingContextForId(e)??Promise.reject(new Me.G(Me.$.RENDERING_CONTEXT_DOES_NOT_EXIST)))}async getOrCreateRenderingContextForId(e){const t=await this.getExistingContextForId(e);if(t)return t;const n=this.coreServices?.authenticationService;if(!n)return Promise.reject(new Me.G(Me.$.CORE_SERVICES_MISSING,void 0,e));const i=await async function(e,t,n){if(!t)throw new Me.G(Me.$.USERCONTEXTID_EMPTY,void 0,t);const i=await n.getUser({correlation:e,accountId:t});if(!i)throw new Me.G(Me.$.USER_DOES_NOT_EXIST,void 0,t);if(!i.isAuthenticated)throw new Me.G(Me.$.USER_NOT_AUTHENTICATED,void 0,t);return(0,xe.KQ)(i)}({...je({source:C.D.Core}),scenarioName:H.RG.AuthWebCachedUser},e,n);return await this.tryExecutePrimaryUserTasks(),this._renderingContextManager.getOrCreateUserRenderingContext(i)}isMTMACoreEnabled(e){const t=e?.get(b.J.Core)?.enableMTMA;return!!t&&!!this.isGettingContextByIdEnabled(e)}isGettingContextByIdEnabled(e){const t=e?.get(b.J.Auth)?.enableIntegratedAuthApp;return!!t&&!!this._config.supportsAsyncUserContext}async tryExecutePrimaryUserTasks(){if(!this._taskManagerService.hasTasks(h.sM.OnPrimaryUser))return;if(this._coreServices?.primaryUser)return;if(this._primaryUserTasksPromise)return this._primaryUserTasksPromise;const e=this._coreServices?.authenticationService,t=await(e?.getCachedUsers?.({...je({source:C.D.Core}),scenarioName:H.RG.AuthWebCachedUser},{isPrimaryUser:!0,isAuthenticated:!0})),n=t?.filter((e=>!0===e.isAuthenticated))?.[0];return n&&!this._primaryUserTasksPromise&&(this._primaryUserTasksPromise=this._renderingContextManager.executePrimaryUserTasks((0,xe.KQ)(n)).then((e=>{this._coreServices=e}))),this._primaryUserTasksPromise}observeAuthenticatedUsers(e){this.observeUsers(e,this._logger).pipe(this.trackAuthUsers(e),(0,p.K)((t=>{const n=t instanceof Ee.G&&Ee.G.isFunction(t.toTelemetryEntry)?t:new Me.G(t?.code,t||new Error("Unknown error"));this._logger.errorToTelemetry?.(`Core Initialization: ${mH}`,"webclient_framework_foundation_core_services",{errorCode:n.toTelemetryEntry()},!0);const i=(0,de.Tr)("Core",h.jK.NotInitialized,n.prevError?.context,{innerError:n.prevError});throw e.errorState.error=i,e.coreSettings.get(b.J.Core).enableCoreErrorsV2?n:i})),(0,g.b)((()=>{const[t,n]=He(e.scenarioFactory);t?.mark(H.ck.CoreRenderingContextReady)})),(0,d.U)((e=>e.length>0?e[0]:this._renderingContextManager.getDefaultRenderingContext()))).subscribe(this._contextSubject)}canDisplayCriticalErrorPage(e){return!!(e?.rebootService&&e.i18n&&e.scenarioFactory&&e.coreSettings&&e.hostCommunicationService&&!e.coreSettings.get(b.J.Core).enableThrowingToExperienceEntry&&e.coreSettings.get(b.J.Core).enableCoreErrorsV2)}canHandleNavigationIntents(e){return!!(e?.client&&e.deeplinkService&&e.entityCommanding)}async registerForAppStateChanged(e){let t;try{t=await e.loadModule("core")}catch(e){const t=`${Ps}${Ms.LoadModuleCoreFailed} registerForAppStateChanged`;return void pH(this._logger,t,"webclient_framework_host_comms")}try{t?.registerForAppStateChanged?.(this.cleanupOnAppStateChangedCallback)}catch(e){const t=`${Ps}${Ms.RegisterForAppStateChangedFailed}`;return void pH(this._logger,t,"webclient_framework_host_comms")}}observeWindowsWithoutApollo(e){return e.activeWindowsService.getActiveWindowsObservable().pipe((0,d.U)((e=>e.map((t=>({...t,screenState:{numOpenWindows:e.length}}))))),this._trackWindowsOperator(this.getContextObservable.bind(this),e,this._templateGenerator,this._config.getExperienceWindowFeatures))}observeWindows(e){return(0,fe.G)(e.client.watchQuery({query:Ke})).pipe((0,m.h)((({errors:e,loading:t})=>void 0===e&&!t)),(0,d.U)((({data:{activeWindows:e}})=>e.map((t=>({...t,screenState:{numOpenWindows:e.length}}))))),this._trackWindowsOperator(this.getContextObservable.bind(this),e,this._templateGenerator,this._config.getExperienceWindowFeatures))}observeUsers(e,t){const n=this.observeUsersEvents(e.client);return(0,fe.G)(n).pipe((0,d.U)((e=>this.toUserContexts(e,t))),(0,p.K)((e=>{const t=`Core Initialization: ${sH}`;throw this._logger.errorToTelemetry?.(`${t} ${e.message}`,"webclient_framework_foundation_core_services",{errorCode:e.code,context:e.context,errors:`${e?.reason}-${(0,$.u4)(e?.serverResponse)}`},!0),Ve(e)})))}observeUsersEvents(e){const t={filter:{isAuthenticated:!0}},n=e.watchQuery({query:Xe,variables:t});return n.subscribeToMore({document:Ye,variables:t,updateQuery:(e,t)=>t.subscriptionData.data.authenticationUsersEvent}),n}async onUserAuthenticated(e){return await this.tryExecutePrimaryUserTasks(),this._renderingContextManager.getOrCreateUserRenderingContext(e)}onUserDestroy(e){const t={logger:this._logger,renderingContextManager:this._renderingContextManager},n=e.authenticationUser,i=`[onUserDestroy] role: ${n?.role}, isAuthenticated: ${n?.isAuthenticated}`;this._logger.log(`${i}, id: ${n?.id}`),this._logger.infoToTelemetry&&this._logger.infoToTelemetry(i,"webclient_framework_foundation_core_services",void 0,!0),n&&nt({...t,coreSettings:e.coreSettings,reason:"unknown_destroy",user:n})}toUserContexts({data:e,loading:t,errors:n},i){if(n)throw pH(i,lH,"webclient_framework_foundation_core_services"),(0,ue.E6)({graphQLErrors:n.concat(),extraInfo:void 0,networkError:null,name:"AuthenticationUsers subscription error",message:"Error in authentication users subscription"});if(!t){if(!e)return pH(i,uH,"webclient_framework_foundation_core_services"),[];return(e.authenticationUsers??[]).filter((e=>!0===e.isAuthenticated)).map(this.toUserContext)}return[]}toUserContext(e){const{id:t,isAuthenticated:n,cloud:i,profile:{tenantId:a,objectId:o,puid:r},role:s,type:l,subType:c,loginUserName:d,homeAccountId:u}=e;return{id:t,isAuthenticated:n,profile:{tenantId:a,objectId:o,puid:r},cloud:i,role:s,type:l,subType:c,loginUserName:d,homeAccountId:u||void 0}}async isEntityInView(e,t){if(!this._coreServices)return Promise.resolve(!1);const{clientState:n,coreSettings:i}=this._coreServices;return $e(e,t,n,this._activeWindows,this._logger,i)}async registerForLogsDownloadSignalFromDesktop(e,t){const n=await t.loadModule("logscollection");n&&n?.registerForRequestWebLogsDownload?.((t=>{const n=!t.webLogsId;this._preCoreLogsFileService.downloadLogsFiles(e,n,t.webLogsId)}))}}const hH={auth:{enableRedirectToSignIn:[{viewportContext:["iFrame"],value:!1}],enableAuthenticateOrGetUser:[{viewportContext:["iFrame"],value:!1}],enableLoginFlow:[{viewportContext:["primary"],value:!0}],enableSISUOnMiniMode:[{viewportContext:["flyout"],value:!1}]},calendar:{disableCalendarOptimisticClosingForm:[{viewportContext:["secondary"],value:!0}],enableCalendarBIMSpecificOperations:[{viewportContext:["primary"],value:!0}],enableCalendarBlockingDiscardConfirmationDialog:[{viewportContext:["flyout","minimode","primary","secondary"],value:!1}],enableSFCloseRouteToCalendarSurface:[{viewportContext:["secondary"],value:!1}]},calling:{isCallingScreenInteractive:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],isCallingAlertDismissEnabled:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],enableRosterButtonInUbar:[{entityType:["meetingroomconsolecall"],value:!1}],enableVideoPreviewPopup:[{entityType:["callsmonitor","presentertoolbar"],value:!1}],enableExternalCallMonitor:[{entityType:["callscontent","callsgallery","callsgalleryandcontent","meetingroomconsolecall","meetingroomallinonecall","meetingroomallinone"],value:!1}],enableModernCallMonitor:[{entityType:["callscontent","callsgallery","callsgalleryandcontent","meetingroomconsolecall","meetingroomallinonecall","meetingroomallinone"],value:!1}],allowMultipleCallingAlertBanners:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],allowPinningParticipantFromOutside:[{entityType:["callsgallery","callsgalleryandcontent"],value:!0}],allowGalleryToggleFromOutside:[{entityType:["callsgallery","callsgalleryandcontent"],value:!0}],forceDisableTitleBar:[{entityType:["callsmonitor"],value:!0}],isCallingAlertActionEnabled:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!1}],isContentSharingShownOnCallingScreen:[{entityType:["callsgallery"],value:!1}],isContentOnlyCallingScreen:[{entityType:["callscontent","stagecontent"],value:!0}],isLayoutSwitcherSupported:[{entityType:["callsgalleryandcontent"],value:!0}],showAllCallingAlertsAsBanner:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!0}],isContentCameraSharingSupported:[{entityType:["callscontent","callsgallery","callsgalleryandcontent"],value:!0}],isIncomingCallScreenSupported:[{entityType:["callsgallery","callsgalleryandcontent"],value:!0}],shouldShowCallingEndScreen:[{entityType:["callscontent","callsgallery","callsgalleryandcontent","meetingroomallinonecall","meetingroomallinone"],value:!1}],enableCallCloseHook:[{entityType:["callsmonitor","stagecontent","byodattendeewindow"],value:!1}],enableAVFramework:[{entityType:["callsmonitor","presentertoolbar"],value:!1}],isNonInteractiveMeetingChat:[{entityType:["byodattendeewindow"],value:!0}],enableUbarNonCriticalPhaseDelayedLoad:[{entityType:["presentertoolbar"],value:!1}],enableHideMyselfV2:[{entityType:["callsmonitor"],value:!1}],disableCoachmarksInUbar:[{entityType:["meetingroomconsolecall","callsmonitor"],value:!0}],enableEspCoachmarksInUbar:[{entityType:["meetingroomconsolecall","callsmonitor"],value:!1}],isBYODAttendeeWindow:[{entityType:["byodattendeewindow"],value:!0}],enableAgentMonitorSessionMenuBar:[{entityType:["callsmonitor"],value:!0}],isTranscriptButtonClickInMainWindow:[{viewportContext:["primary","iFrame"],value:!0}]},core:{isHeaderDisabled:[{viewportContext:["iFrame"],value:!0}],isMinimodeWindow:[{viewportContext:["minimode"],value:!0}],isPrimaryWindow:[{viewportContext:["primary"],value:!0}],isSecondaryWindow:[{viewportContext:["secondary"],value:!0}],enableFluentTabs:[{viewportContext:["secondary"],value:!1}],enableSearchBoxInMainWindow:[{viewportContext:["primary"],value:!0}],enableNavControlInMainWindow:[{viewportContext:["primary"],value:!0}],enableMainWindowTitleBarStyles:[{viewportContext:["primary"],value:!0}],enableTitleTextInChildWindow:[{viewportContext:["secondary"],value:!0}],enableTransparentTitleBar:[{entityType:["calls","callingdeeplink"],value:!1}],enableAppSwitcher:[{viewportContext:["secondary"],value:!1}],adjustSpacingBetweenChatHeaderButtons:[{viewportContext:["secondary"],value:!1}],isBorderDisabled:[{viewportContext:["primary"],value:!0}],enableThickFlyoutBorder:[{viewportContext:["flyout","minimode"],value:!0}],enableNovaMeControlAvatarSrcContext:[{viewportContext:["primary"],value:!0}],enableLonglivedSubscriptionForChannelsAppViewportSetting:[{viewportContext:["primary"],value:!0}],enableWaffle:[{viewportContext:["secondary"],value:!1}],isMainWindowAppTitleEnabled:[{viewportContext:["primary"],value:!0}],shouldClearLocalStorageOnMainWindowError:[{viewportContext:["primary"],value:!0}]},people:{avatarDoubleClickDelayInMs:[{viewportContext:["flyout","minimode"],value:0}]},activity:{enableMTMANotificationBellInMainWindow:[{viewportContext:["primary"],value:!0}]},channels:{enableOnlyInMainWindowNotPopouts:[{viewportContext:["iFrame","primary"],value:!0}],showCloseButtonInChannelsRepliesPane:[{viewportContext:["iFrame","primary"],value:!0}],allowPostPopout:[{viewportContext:["iFrame","primary"],value:!0}],enableTabsInChannels:[{viewportContext:["secondary"],value:!1}]},chatList:{enableBlockContact:[{viewportContext:["minimode"],value:!0}]},compose:{enableEditorCiqAddOn:[{viewportContext:["flyout"],value:!1}]},extensibility:{enableAtGetBots:[{entityType:["email"],value:!1}],enableSTTV9Controls:[{entityType:["email"],value:!1}],openChatInNewWindowForSTT:[{entityType:["email"],value:!0}]},files:{showPreferenceDialog:[{viewportContext:["primary"],value:!0}],enablePopups:[{viewportContext:["primary"],value:!0}],loadItemsViewStringsFromHost:[{viewportContext:["primary"],value:!0}]},meetingRecap:{isRecapInPopout:[{viewportContext:["flyout","minimode","secondary"],value:!0}]},messaging:{enableSaveNewChatDraftOnMainWindow:[{viewportContext:["primary"],value:!0}],enableDisableAutoScrollForHighActivityMeetings:[{viewportContext:["iFrame","primary"],value:!1}],fluidIsRenderingInPopout:[{viewportContext:["primary","secondary"],value:!0}],enableChatHeaderMeetingDetailsButton:[{viewportContext:["primary"],value:!0}],enableInlineVideoMessageDownload:[{viewportContext:["flyout","minimode"],value:!1}],disableInlineVideoMessageFullscreen:[{viewportContext:["flyout","minimode"],value:!0}],inlineVideoIsRenderingInPopout:[{viewportContext:["secondary"],value:!0}],recorderIsRenderingInPopout:[{viewportContext:["secondary"],value:!0}],showSingeMessageView:[{viewportContext:["primary"],value:!0}],showContextualSearchPrompt:[{viewportContext:["primary"],value:!0}],enableComposeCriticalPhaseLoadSecondaryViewport:[{viewportContext:["secondary"],value:!0}],enableComposeDebouncedDraftSyncSecondaryViewport:[{viewportContext:["secondary"],build:">=22011801900",value:!0}],entityCommandingTransitionForceFlush:[{viewportContext:["primary"],value:!0}],enableChatPopoutInContextMenu:[{viewportContext:["secondary"],value:!1}],disableAutoFocusOnCompose:[{viewportContext:["primary"],value:!0}]},chat:{disableChatPaneLoader:[{viewportContext:["primary"],value:!0}],chatSwitchInPopOut:[{viewportContext:["secondary"],value:!0}]},shortcuts:{shortcutsForPopout:[{viewportContext:["secondary"],value:!0}]},broadcast:{isRenderingInEmbedMode:[{viewportContext:["iFrame"],value:!0},{viewportContext:["primary"],value:!1}]},ufd:{maxUnstackedPermanentDialogs:[{entityType:["meetingroomconsolecall"],value:4}],overrideUfdSyncSeverities:[{entityType:["meetingroomconsolecall"],value:["Critical"]}]},flyout:{enableLoadFlyoutChatBundleInL1:[{viewportContext:["flyout","minimode"],value:!0}],enableFlyoutV2WhenZoomed:[{viewportContext:["minimode"],value:!0}],isMinimodeChat:[{viewportContext:["minimode"],value:!0}],isFlyoutChat:[{viewportContext:["flyout","minimode"],value:!0}],showChatHeaderInFlyout:[{viewportContext:["flyout","minimode"],value:!0}],hideTabsInChatFlyout:[{viewportContext:["flyout","minimode"],value:!0}],enableSimplifiedFeaturesInFlyoutChat:[{viewportContext:["flyout","minimode"],value:!0}],useSimplePickerInChatFlyout:[{viewportContext:["flyout","minimode"],value:!0}],flyoutV2WebcamPreviewFooterButtonsConfig:[{viewportContext:["minimode"],value:["MeetNow","NewChat","People"]}],enablePeopleExperience:[{viewportContext:["minimode"],value:!0}],enableFrequentlyUsedContactsInChatFlyout:[{viewportContext:["minimode"],value:!0}],enableMeetNowUxUpdate:[{viewportContext:["minimode"],value:!0}],enablePrimaryActionUxUpdate:[{viewportContext:["minimode"],value:!0}],enableForYouSection:[{viewportContext:["minimode"],value:!0}],enableAcrylicEffect:[{viewportContext:["minimode"],value:!0}]},mercuryDesign:{enableMercuryDesign:[{viewportContext:["flyout","minimode"],value:!1}]}},yH={calendar:{enableYammerQnACalendar:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],isMeetingOnenoteAgendaEnabled:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCalendarViewDescriptionCollapsible:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},calling:{disableDefaultBotDataLanguage:[{region:["gcc","dod","gcchigh"],value:!0,resolutionStrategy:["merge"]}],callingEnableBufferSharing:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],isMeetingFluidAgendaEnabled:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableYammerQnaInMeetingNewActivityNotification:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableYammerQnaInMeetingNewActivityNotificationForVirtualEvents:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableOverrideWikiNotesWithFluidInMeeting:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStyleMyRoom:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},core:{enableEDUColdBootApp:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},cdlWorker:{enableStartupUsingPartialData:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableConversationTableVersionGCC:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},telemetry:{coreAllowListEnabled:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]}]},channels:{enableChannelLPCCardInT21:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},chatList:{enableSmbChatListSuggestedContacts:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbAllDirectorySuggestedContacts:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbExternalChatListSuggestedContacts:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSuggestedOrgGroupChats:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSuggestedProjectGroupChats:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableBizChatMetaOSChatListEntryPoint:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},compose:{enableDesignerInChannelAnnouncementPost:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["merge"]},{region:["amer"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableGenerateImageInDesignerMini:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["merge"]},{region:["amer"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},discoverSurface:{enableHybridDiscoverSurface:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDiscoverSurfaceSyncEngine:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},esp:{enableEspIrisIntegration:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableEspDLSurfaces:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},extensibility:{enableCardSharing:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableActionCommands:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableAppContextMenu:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableWorkflowsInChat:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},files:{enableFilesAppBasedFileHandlingForPDFTMP:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableFilesAdminPreinstallCheckForPDFAppTMP:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},meetingArtifacts:{byPassTeamsPremiumLicenseCheckForMA:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMeetingAnalyticsForTPUser:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},meetingRecap:{enableSpeakersInRecap:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableTopicsInRecap:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMeetingSummaryInRecap:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSuggestedTasksInRecap:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableFluidNoteInRecap:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMentionsInRecap:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableChaptersInRecap:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},messaging:{enableTfwTflFederation:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCustomEmoji:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDeprecatedM365ChatBanner:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMetaOSCopilotToggleInSettings:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},smb:{enableFetchingSmbTenantSettings:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbChatListInvite:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSmbChatZeroState:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTenantDirectoryStateMachine:[{userLicenseCategory:["SmbLicense"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},teamsAndChannels:{enableArchiveChannel:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCreateTeamFromGroup:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCreateTeamFromScratch:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],hideCreateTeamContextMenuItem:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableShowArchiveRestoreOptionInContextMenu:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableGeneralChannelShowHide:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableGeneralChannelRecommend:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableTeamsAndChannelsFilterWithTags:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableLegacyChannelConnectorsToWorkflows:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableMemberMute:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeamMute:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeamLayoutSetting:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],defaultTeamLayoutSettingIsGrid:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableShareWithTeamSensitivityLabelEnforcementReact:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSensitivityLabelPrivacyValidationOptInBehavior:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableLeftRailAddChannelButton:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],disableSensitivityLabelEdu:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStaleChannelsFlow:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsAdHocFlow:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsBatchAPI:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableStaleChannelsHiddenFirstOrder:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableUserOnboardingToTeam:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableChannelHeaderBackButton:[{userLicenseCategory:["EducationStudent","EducationFaculty"],value:!1,resolutionStrategy:["merge"]},{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableUserOnboardingToTeamRecommended:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableCreateTeamSimplification:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},virtualEvents:{enableSchedulingTownhalls:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableDuplicateEvents:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],isGroupMailboxEnabled:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableEndpointsManagerOnVirtualEventService:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSchedulingTownhallsInGcc:[{region:["gcc"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTownhallApps:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},brb:{enableBrb:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["merge"]},{preReleaseFeaturesAllowed:[!0],value:!0,resolutionStrategy:["merge"]}]},virtualAppointments:{enableSchedulingVirtualAppointments:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]},edu:{enableEduAskCommunity:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduSuggestFeature:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentInsightsLink:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeacherCreateTeam:[{userLicenseCategory:["EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentCreateBasicTeam:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduTeamActions:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeacherCreateTeamFromGroup:[{userLicenseCategory:["EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentTeamifyCustomization:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduAddMemberCustomization:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableAssignmentsApp:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableSupportAppForFaculty:[{userLicenseCategory:["EducationFaculty"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableEduEmptyChannelActionSets:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableTeamClassSettings:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}],enableStudentCloneTeamCustomization:[{userLicenseCategory:["EducationStudent"],value:!0,resolutionStrategy:["merge"]},{value:!1,resolutionStrategy:["merge"]}]},simpleCollab:{enableSimpleCollabApp:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}],enableSimpleCollabAppToggle:[{region:["gcc"],value:!1,resolutionStrategy:["merge"]},{value:!0,resolutionStrategy:["merge"]}]}},vH={calendar:{calendarAppPhaseTimeouts:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:{critical:36e3,postCritical:36e3},resolutionStrategy:["override"]}]},calling:{customViewBots:[{region:["gcc"],value:[{audienceBotId:"28:b102ccd8-1925-448b-90a7-b083aba25074",largeGridBotId:"28:556b15e7-452c-4773-b728-6313eaa47b77"}],resolutionStrategy:["override"]}],callingConstants:[{region:["gcc"],resolutionStrategy:["override"],value:{audienceBotMri:"28:b102ccd8-1925-448b-90a7-b083aba25074",largeGridBotMri:"28:556b15e7-452c-4773-b728-6313eaa47b77",callRecording:{recordingBotMri:"28:4b25d9f8-18f5-4d09-a582-cd0a28f63181",closedCaptionsBotMri:"28:a8011016-05a6-4f6e-b2b3-26543cf329a0",recordingBotMrisFromAlternateRegions:["28:bdd75849-e0a6-4cce-8fc1-d7c0d4da43e5"]},transcript:{artifacts:{endpoint:"https://gcc-mtis.cortana.ai/meetingArtifacts/api/v2"},endpoint:"https://mi.svcs.gcc.teams.microsoft.com",settingsEndpoint:"https://mi.svcs.gcc.teams.microsoft.com"}}}],closedCaptionsBotMriForClientRegion:[{region:["gcc"],resolutionStrategy:["override"],value:"28:a8011016-05a6-4f6e-b2b3-26543cf329a0"}],pptBootstrapperUrl:[{region:["gcc"],value:"https://powerpoint.cdn.office365.us/pods/s/PptScripts/powerpoint.boot.js",resolutionStrategy:["override"]}],pptFeatureGates:[{region:["gcc"],value:'{"ModernWebGLBlockListForBrowserVersion": "Chrome:66;Edge:19","ModernWebGLBlockListForGPURenderer": "PowerVR Rogue GX6250;SwiftShader", "ModernSlideShowAllowListForFileType": "pptx;ppsx;potx;pptm;ppsm;pot;ppt;odp;pps", "DetectAbandonsWithinIframeTimeouts":true, "PresUrlBootTimeoutMS":4000}â€‹â€‹â€‹â€‹',resolutionStrategy:["override"]}],enableStateServiceInPreviewerFeatures:[{region:["gcc"],value:["Ink","Nav","NavSync","Media","OpticalZoomSync"],resolutionStrategy:["override"]}],enableCombinedRecordingBot:[{region:["gcc"],resolutionStrategy:["override"],value:!1}]},people:{lokiTokenResourceUrl:[{region:["gcc"],value:"https://gcc.loki.delve.office.com/",resolutionStrategy:["override"]}],lokiEnvironment:[{region:["gcc"],value:"gcc",resolutionStrategy:["override"]}]},telemetry:{toolingSamplingRules:[{region:["gcc"],value:{scenarions:{"*":1},userbins:{"*":100},loggingns:{"*":1},endpointns:{"*":1},httpns:{"*":1}},resolutionStrategy:["override"]}],oneDsCollectorUrl:[{region:["gcc"],value:"https://us-teams.events.data.microsoft.com/OneCollector/1.0/",resolutionStrategy:["override"]}],enableTelemetryRegionReinit:[{region:["gcc"],value:!0,resolutionStrategy:["override"]}]},channels:{fluid:[{region:["gcc"],value:{composeEnabledComponents:[],composeInChannelEnabled:!1,embedModeComposeEnabled:!1,embedModeLoadEnabled:!1,embedModePasteEnabled:!1,loadEnabled:!1,loadInChannelEnabled:!1,pasteEnabled:!1,pasteGrantPermissionsEnabled:!1,pasteInChannelEnabled:!1},resolutionStrategy:["override"]}]},cmdMeetingArtifactsService:{cmdMeetingArtifactsServiceEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/mcps/gcc/collab",resolutionStrategy:["override"]}]},extensibility:{storeDataProvidersList:[{region:["gcc"],value:[0],resolutionStrategy:["override"]}],workflowApp:[{region:["gcc"],value:{id:"c3a1996d-db0f-4857-a6ea-7aabf0266b00",linkedApps:[{id:"00001016-de05-492e-9106-4828fc8a8687",linkedAppId:"c3a1996d-db0f-4857-a6ea-7aabf0266b00"}],providerInfo:[{botId:"e4a2d064-3c07-48bd-a16d-6173958714c5",id:"00001016-de05-492e-9106-4828fc8a8687",nameOverride:"Power Automate"},{botId:"509e64f1-1e70-4744-91dc-3bba3977d3e2",id:"c3a1996d-db0f-4857-a6ea-7aabf0266b00",nameOverride:"Power Automate"}]},resolutionStrategy:["override"]}],cloudSpecificRingId:[{region:["gcc"],value:"gcc",resolutionStrategy:["override"]}],legacyChannelConnectorsToWorkflows:[{region:["gcc"],value:{searchUrl:"https://gov.api.flow.microsoft.us/providers/Microsoft.ProcessSimple/galleries/public/teamsworkflowtemplates?$filter=properties/categoryNames/any(x:x eq 'microsoftteams_channel') and properties/categoryNames/all(x:x ne 'reported')&useNewConfigUrl=true&supportBigTiles=true",collections:["wf:co:all"]},resolutionStrategy:["override"]}],workflowsEntryPointConfig:[{region:["gcc"],value:[{entrypoint:"channelworkflows",searchUrl:"https://gov.api.flow.microsoft.us/providers/Microsoft.ProcessSimple/galleries/public/teamsworkflowtemplates?$filter=properties/categoryNames/any(x:x eq 'microsoftteams_channel') and properties/categoryNames/all(x:x ne 'reported')&useNewConfigUrl=true&supportBigTiles=true",collections:["wf:co:all"]},{entrypoint:"chatworkflows",searchUrl:"https://gov.api.flow.microsoft.us/providers/Microsoft.ProcessSimple/galleries/public/teamsworkflowtemplates?$filter=properties/categoryNames/any(x:x eq 'microsoftteams_chat') and properties/categoryNames/all(x:x ne 'reported')&useNewConfigUrl=true&supportBigTiles=true",collections:["wf:co:all"]}],resolutionStrategy:["override"]}],channelWorkflowsTemplates:[{region:["gcc"],value:{heroTemplates:[{heroCollectionTitle:"notify_a_team",heroTemplateIds:["wf:it:ed6dc6ffc0154db5bb90694ee15b9289","wf:it:c058ab6a8be646d5a7afb7b7bdeba59c","wf:it:e6670d91f2834394aeb63f1cb6f263bf","wf:it:817f4d64144e4c0aae710da4ab6297b8","wf:it:d3ea3143c7634106b20952709e52af95"]},{heroCollectionTitle:"post_a_digest",heroTemplateIds:["wf:it:e2c131a4be2e48f3a22af4a01509c780","wf:it:0916e2b8504d45edbb7ca76352e87663"]}],allTemplates:{allCollectionTitle:"all_templates",allTemplateIds:["wf:it:c058ab6a8be646d5a7afb7b7bdeba59c","wf:it:c778b7fc01d943528786b4012b011702","wf:it:40649abe579f479c9dcacd6d6c9ca1ef","wf:it:e2c131a4be2e48f3a22af4a01509c780","wf:it:3c6294b5e0fd42ffbfe827dfb8023cb0","wf:it:ed6dc6ffc0154db5bb90694ee15b9289","wf:it:0916e2b8504d45edbb7ca76352e87663","wf:it:382aa0f154094795952014fb511b9ad2","wf:it:39e2b109962a4dc3b283197f71323eec","wf:it:383c63172a0048dabb702c53c7f95d49","wf:it:189cb2567d2d4370bcc5f37c0c4f0c86","wf:it:50baef9c102f44289d71d860b6e0eccc","wf:it:46327ebee65f467c9f0c552203c8c99d","wf:it:e1efc42fcf0742da94b88057dcac01ab"]}},resolutionStrategy:["override"]}],chatWorkflowsTemplates:[{region:["gcc"],value:{heroTemplates:[{heroCollectionTitle:"notify_a_chat",heroTemplateIds:["wf:it:4572ea5465834767a303acc1006234c6","wf:it:9c104efa45ad432788a3bfdfd1c41188","wf:it:91ad3a43282143acb71977ec6e41322b","wf:it:22be1e10dcfa440fbb2a59533d4d8f26","wf:it:08d52de1a3524f12ae9636c507b98dfb"]},{heroCollectionTitle:"post_a_digest",heroTemplateIds:["wf:it:be04eb4566ee4553b92cb8335dde41d9","wf:it:974a60f84a1340ec8cdfef31fdadc2a8"]}],allTemplates:{allCollectionTitle:"all_templates",allTemplateIds:["wf:it:be04eb4566ee4553b92cb8335dde41d9","wf:it:4572ea5465834767a303acc1006234c6","wf:it:40649abe579f479c9dcacd6d6c9ca1ef","wf:it:9c104efa45ad432788a3bfdfd1c41188","wf:it:91ad3a43282143acb71977ec6e41322b","wf:it:974a60f84a1340ec8cdfef31fdadc2a8","wf:it:22be1e10dcfa440fbb2a59533d4d8f26","wf:it:08d52de1a3524f12ae9636c507b98dfb"]}},resolutionStrategy:["override"]}],workflowsAuthResourceUrl:[{region:["gcc"],value:"https://gov.service.flow.microsoft.us/",resolutionStrategy:["override"]}]},meetingArtifacts:{meetingArtifactsServiceEndpoint:[{region:["gcc"],value:"https://gcc-mtis.cortana.ai/MeetingArtifacts/api",resolutionStrategy:["override"]}],cmdTmisEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/artifacts/gcc/attendancereport/",resolutionStrategy:["override"]}],tmisEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/attendancereport/gcc/",resolutionStrategy:["override"]}],transcriptServiceEndpoint:[{region:["gcc"],value:"https://gcc-mtis.cortana.ai/meetingArtifacts/api/v2",resolutionStrategy:["override"]}],yammerQnaEndpointUrl:[{region:["gcc"],value:"https://web.gov.yammer.com/teamsmeeting/teams-meeting",resolutionStrategy:["override"]}]},messaging:{fluid:[{region:["gcc"],value:{coachmarkEnabledList:[],composeEnabledComponents:[],eduEnabled:!1,embedModeComposeEnabled:!1,embedModeLoadEnabled:!1,embedModePasteEnabled:!1,enableClientSPOCallForFluidTenantSetting:!1,loadEnabled:!1,pasteEnabled:!1,prefetchOdspTokensEnabled:!1,useServiceDeliveredDriver:!1},resolutionStrategy:["override"]}]},teamsAndChannels:{channelPhaseTimeoutSettings:[{userLicenseCategory:["EducationFaculty","EducationStudent"],value:{critical:6e4,postCritical:1e4},resolutionStrategy:["override"]},{value:{critical:41e3,postCritical:1e4},resolutionStrategy:["override"]}]},csaService:{apiConstants:[{region:["gcc"],value:{resource:"https://chatsvcagg.gcc.teams.microsoft.com",host:"https://chatsvcagg.gcc.teams.microsoft.com",version:"/api/v1/",endpoints:{startupclean:"teams/users/me",startupdelta:"teams/users/me/updates",startupgroupchats:"teams/users/me/groupchats",startupnonrecentchats:"teams/users/me/nonrecentchats",startupcleananonymous:"teams/users/anonymous",startupdeltaanonymous:"teams/users/anonymous/updates"}},resolutionStrategy:["override"]}],apiConstantsGCC:[{region:["gcc"],value:{resource:"https://chatsvcagg.gcc.teams.microsoft.com",host:"https://chatsvcagg.gcc.teams.microsoft.com",version:"/api/v1/",endpoints:{startupclean:"teams/users/me",startupdelta:"teams/users/me/updates",startupgroupchats:"teams/users/me/groupchats",startupnonrecentchats:"teams/users/me/nonrecentchats",startupcleananonymous:"teams/users/anonymous",startupdeltaanonymous:"teams/users/anonymous/updates"}},resolutionStrategy:["override"]}]},broadcast:{liveStreamPlayerJsSources:[{region:["gcc","dod","gcchigh"],value:["https://amp.azure.net/libs/amp/2.3.11/azuremediaplayer.min.js","/evergreen-assets/broadcast/player-skin.min.js"],resolutionStrategy:["override"]}],liveStreamPlayerCssSources:[{region:["gcc","dod","gcchigh"],value:["/evergreen-assets/broadcast/player-skin.min.css?v=3"],resolutionStrategy:["override"]}],microsoftSdnPluginUrl:[{region:["gcc"],value:"https://sdk.ecdn.gcc.teams.microsoft.com/peer5.microsoft-teams.plugin.js",resolutionStrategy:["override"]}]},virtualEvents:{virtualEventsServiceEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/virtualevents/gcc/beta",resolutionStrategy:["override"]}],virtualEventInsightsUrl:[{region:["gcc"],resolutionStrategy:["override"],value:"https://app.tha.gcc.teams.microsoft.com/event-view?thread={threadId}#preferred_username={userEmail}"}]},feedback:{enableInAppFeedback:[{userLicenseCategory:["EducationStudent"],value:!1,resolutionStrategy:["override"]}]},meetingTemplates:{meetingTemplateServiceEndpoint:[{region:["gcc"],value:"https://teams.microsoft.com/api/artifacts/gcc/meetingTemplate",resolutionStrategy:["override"]}]}},fH={mappings:{calendar:{isOnCloud:{name:"userPropertiesSettings.isOnCloud"},autodiscoverSettings:{name:"userPropertiesSettings.autodiscoverSettings"},allowPrivateMeetingSchedulingPolicy:{name:"meetingPolicy.allowPrivateMeetingScheduling"},allowChannelMeetingSchedulingPolicy:{name:"meetingPolicy.allowChannelMeetingScheduling"},allowEngagementReportPolicy:{name:"meetingPolicy.allowEngagementReport"},enableCoachByPolicy:{name:"meetingPolicy.allowMeetingCoach"},allowFluidCollaboratePolicy:{name:"messagingPolicy.allowFluidCollaborate"},allowMeetingRegistrationPolicy:{name:"meetingPolicy.allowMeetingRegistration"},allowBroadcastSchedulingPolicy:{name:"broadcastMeetingPolicy.allowBroadcastScheduling"},whoCanRegisterPolicy:{name:"meetingPolicy.whoCanRegister"},allowWebinarsV2Policy:{name:"teamsEventsPolicy.allowWebinars"}},calling:{allowPrivateCallingPolicy:{name:"callingPolicy.allowPrivateCalling"},myPhoneNumber:{name:"voiceAdminSettings.phoneNumber"},adminSettings:{name:"adminSettings"},callingPolicy:{name:"callingPolicy"},policySettings:{name:"policySettings"},teamsMeetingBrandingPolicy:{name:"teamsMeetingBrandingPolicy"},syntheticAutomatedCallPolicy:{name:"syntheticAutomatedCallPolicy"},meetingPolicy:{name:"meetingPolicy"},tenantSettingsV2:{name:"tenantSettingsV2"},tenantVoiceSettings:{name:"tenantVoiceSettings"},userResourcesSettings:{name:"userResourcesSettings"},voiceAdminSettings:{name:"voiceAdminSettings"},teamsEmergencyCallingPolicy:{name:"teamsEmergencyCallingPolicy"},teamsEmergencyCallRoutingPolicy:{name:"teamsEmergencyCallRoutingPolicy"},teamsUserPhoneNumbers:{name:"teamsUserPhoneNumbers"},teamsMediaConnectivityPolicy:{name:"teamsMediaConnectivityPolicy"},delegationSettingsPolicy:{name:"voiceAdminSettings.delegationSettings"},dialPlanPolicy:{name:"policySettings.dialPlanPolicy"},safeTransferPolicy:{name:"callingPolicy.safeTransferEnabled"},allowCloudRecordingPolicy:{name:"meetingPolicy.allowCloudRecording"},allowRecordingStorageOutsideRegion:{name:"meetingPolicy.allowRecordingStorageOutsideRegion"},recordingStorageMode:{name:"meetingPolicy.recordingStorageMode"},allowCloudRecordingForCallsPolicy:{name:"callingPolicy.allowCloudRecordingForCalls"},closedCaptionsPolicy:{name:"meetingPolicy.liveCaptionsEnabledType"},closedCaptionsForCallingPolicy:{name:"callingPolicy.liveCaptionsEnabledTypeForCalling"},isPptSharingAllowedByPolicy:{name:"meetingPolicy.allowPowerPointSharing"},areMeetingNotesEnabledByPolicy:{name:"meetingPolicy.allowSharedNotes"},isMeetingReactionsAllowedByPolicy:{name:"meetingPolicy.allowMeetingReactions"},isAnnotationsEnabledByPolicy:{name:"meetingPolicy.allowAnnotations"},customVideoBackgroundsFilterByPolicy:{name:"meetingPolicy.videoFiltersMode"},screenSharingModePolicy:{name:"meetingPolicy.screenSharingMode"},meetingChatEnableTypePolicy:{name:"meetingPolicy.meetingChatEnableType"},allowPrivateMeetingSchedulingPolicy:{name:"meetingPolicy.allowPrivateMeetingScheduling"},allowMeetNowPolicy:{name:"meetingPolicy.allowMeetNow"},callParkPolicy:{name:"callParkPolicy"},teamsEnhancedEncryptionPolicy:{name:"teamsEnhancedEncryptionPolicy"},messagingPolicy:{name:"messagingPolicy"},isVideoAllowedByPolicy:{name:"meetingPolicy.allowIPVideo"},enableCallTranscriptByPolicy:{name:"meetingPolicy.allowTranscription"},enableCallTranscriptInCallsByPolicy:{name:"callingPolicy.allowTranscriptionForCalling"},onlineDialinConferencingPolicy:{name:"onlineDialinConferencingPolicy"},teamsVoiceApplicationsPolicy:{name:"teamsVoiceApplicationsPolicy"},allowLocalRecordingPolicy:{name:"meetingPolicy.allowLocalRecording"},enableCoachByPolicy:{name:"meetingPolicy.allowMeetingCoach"},allowFluidMeetingCalendarPolicy:{name:"callingPolicy.allowFluidMeetingCalendar"},allowDocumentCollaborationPolicy:{name:"meetingPolicy.allowDocumentCollaboration"},allowPrivateMeetNowPolicy:{name:"meetingPolicy.allowPrivateMeetNow"},enableMandatoryBackgroundPolicy:{name:"teamsMeetingBrandingPolicy.requireBackgroundEffect"},allowThirdPartyDevicesPolicy:{name:"meetingPolicy.connectToMeetingControls"},voicemailPolicy:{name:"voicemailPolicy"},teamsMediaLoggingPolicy:{name:"teamsMediaLoggingPolicy"},branchSurvivabilityPolicy:{name:"branchSurvivabilityPolicy"},vdiPolicy:{name:"vdiPolicy"},vdiSlimcoreOptimizationPolicy:{name:"vdiPolicy.vdI2Optimization"}},core:{useNewTeamsClient:{name:"updateManagementPolicy.useNewTeamsClient"},allowPublicPreview:{name:"updateManagementPolicy.allowPublicPreview"}},host:{enableBreakoutRoomsPreMeetingAssignmentTabInBiM:{name:"meetingPolicy.allowBreakoutRooms"}},people:{allowScopedPeopleSearchandAccess:{name:"clientSettings.allowScopedPeopleSearchandAccess",defaultValue:!1}},tenant:{isOrganizationTabEnabled:{name:"clientSettings.allowOrganizationTab",defaultValue:!0},tenantSiteUrl:{name:"tenantSiteUrl"},tenantSiteUrlAndDomains:{name:"tenantSiteUrlAndDomains"}},compose:{designerForBackgroundsAndImages:{name:"messagingPolicy.designerForBackgroundsAndImages"}},extensibility:{isSideLoadingInteractionEnabled:{name:"tenantSettingsV2.apps.isSideLoadingInteractionEnabled"},storeAppTenantBackground:{name:"tenantSettingsV2.apps.lobBackground"},storeAppTenantLogo:{name:"tenantSettingsV2.apps.lobLogo"},storeAppTenantTextColor:{name:"tenantSettingsV2.apps.lobTextColor"},storeAppTenantIcon:{name:"tenantSettingsV2.apps.lobLogomark"},teamsAppPermissionPolicyHash:{name:"teamsAppPermissionPolicy.policyHash"},teamsAppSetupPolicyHash:{name:"teamsAppSetupPolicy.policyHash"},appsTenantSettingsLastUpdatedTimestamp:{name:"tenantSettingsV2.apps.lastUpdatedTimestamp"},isUserPinningAllowed:{name:"teamsAppSetupPolicy.isUserPinningAllowed"}},files:{nativeFileEntryPoints:{name:"filesPolicy.nativeFileEntryPoints",defaultValue:"Enabled"},defaultFileUploadAppId:{name:"filesPolicy.defaultFileUploadAppId",defaultValue:""},enableFederationAccess:{name:"externalAccessPolicy.enableFederationAccess",defaultValue:!0},teamsLinkBrowserPreferencePolicy:{name:"teamsLinkPolicy.browserChoice"}},guardians:{parentGuardianPreferredContactMethod:{name:"educationSettings.parentGuardianPreferredContactMethod"}},meet:{isMailboxDiscoverable:{name:"userPropertiesSettings.isMailboxDiscoverable"},isOnCloud:{name:"userPropertiesSettings.isOnCloud"},enableMeetForWork:{name:"userPropertiesSettings.isOnCloud"}},meetingArtifacts:{allowEngagementReportPolicy:{name:"meetingPolicy.allowEngagementReport"},allowTrackingInReportPolicy:{name:"meetingPolicy.allowTrackingInReport"},speakerAttributionModePolicy:{name:"meetingPolicy.speakerAttributionMode"}},messaging:{receiptsEnabledType:{name:"messagingPolicy.readReceiptsEnabledType",defaultValue:"UserPreference"},enableM365ChatFeedback:{name:"feedbackPolicy.ocpsAllowSendFeedback"},allowPasteInternetImage:{name:"messagingPolicy.allowPasteInternetImage",defaultValue:!0},EnableUpToEditInMW:{name:"messagingPolicy.allowUserEditMessage",defaultValue:!0},allowUserEditMessage:{name:"messagingPolicy.allowUserEditMessage",defaultValue:!0},allowGiphy:{name:"messagingPolicy.allowGiphy",defaultValue:!0},allowGiphyDisplay:{name:"messagingPolicy.allowGiphyDisplay",defaultValue:!0},allowStickers:{name:"messagingPolicy.allowStickers",defaultValue:!0},giphyRatingType:{name:"messagingPolicy.giphyRatingType",defaultValue:"Moderate"},allowPriorityMessages:{name:"messagingPolicy.allowPriorityMessages",defaultValue:!0},allowImmersiveReader:{name:"messagingPolicy.allowImmersiveReader",defaultValue:!0},allowUserChat:{name:"messagingPolicy.allowUserChat",defaultValue:!0},allowRemoveUser:{name:"messagingPolicy.allowRemoveUser",defaultValue:!0},areUrlPreviewsAllowed:{name:"messagingPolicy.allowUrlPreviews",defaultValue:!0},allowUserDeleteMessage:{name:"messagingPolicy.allowUserDeleteMessage",defaultValue:!0},enableSms:{name:"voiceAdminSettings.isSmsEnabled"},messagingPolicy:{name:"messagingPolicy"},enableTeamsConsumerAccess:{name:"externalAccessPolicy.enableTeamsConsumerAccess",defaultValue:!0},enableFederationAccess:{name:"externalAccessPolicy.enableFederationAccess",defaultValue:!1},enablePublicCloudAccess:{name:"externalAccessPolicy.enablePublicCloudAccess",defaultValue:!1},allowFluidCollaborate:{name:"messagingPolicy.allowFluidCollaborate",defaultValue:!1},enableVideoMessaging:{name:"messagingPolicy.allowVideoMessages",defaultValue:!1},enableInlineVideoMessageClosedCaptions:{name:"teamsMessagingConfiguration.enableVideoMessageCaptions",defaultValue:!0},enableCustomEmoji:{name:"teamsMessagingConfiguration.customEmojis"},enableCustomEmojiCreation:{name:"messagingPolicy.createCustomEmojis"},enableCustomEmojiDeletion:{name:"messagingPolicy.deleteCustomEmojis"},allowPrivateMeetingSchedulingPolicy:{name:"meetingPolicy.allowPrivateMeetingScheduling"},isMailboxDiscoverable:{name:"userPropertiesSettings.isMailboxDiscoverable"},isOnCloud:{name:"userPropertiesSettings.isOnCloud"},autodiscoverSettings:{name:"userPropertiesSettings.autodiscoverSettings"},allowCommunicationComplianceEndUserReporting:{name:"messagingPolicy.allowCommunicationComplianceEndUserReporting",defaultValue:!1},allowSmartReply:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableSmartRepliesForGroupChat:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableAnimatedEmojisInSmartReplies:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableSmartFilesSuggestions:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},enableSmartSchedulingSuggestions:{name:"messagingPolicy.allowSmartReply",defaultValue:!0},allowMemes:{name:"messagingPolicy.allowMemes",defaultValue:!0},allowUserTranslation:{name:"messagingPolicy.allowUserTranslation",defaultValue:!1},chatPermissionRole:{name:"messagingPolicy.chatPermissionRole",defaultValue:"Restricted"},allowFullChatPermissionUserToDeleteAnyMessage:{name:"messagingPolicy.allowFullChatPermissionUserToDeleteAnyMessage",defaultValue:!1},allowOwnerDeleteMessage:{name:"messagingPolicy.allowOwnerDeleteMessage",defaultValue:!0},userInitiatedMode:{name:"feedbackPolicy.userInitiatedMode"},enableM365ChatFeedbackLogCollection:{name:"feedbackPolicy.ocpsAllowLogCollection"},allowSecurityEndUserReporting:{name:"messagingPolicy.allowSecurityEndUserReporting",defaultValue:!1},userLanguageAccountSettings:{name:"userLanguageAccountSettings"},allowImmersiveReaderV2:{name:"messagingPolicy.allowImmersiveReader",defaultValue:!0},allowGroupChatJoinLinks:{name:"messagingPolicy.allowGroupChatJoinLinks",defaultValue:!0},allowUserDeleteChat:{name:"messagingPolicy.allowUserDeleteChat",defaultValue:!1},teamsUserPhoneNumbers:{name:"teamsUserPhoneNumbers"},enableInOrganizationChatControl:{name:"teamsMessagingConfiguration.enableInOrganizationChatControl",defaultValue:!1},inOrganizationChatControl:{name:"messagingPolicy.inOrganizationChatControl",defaultValue:"BlockingDisallowed"}},peopleTargeting:{tagPermissions:{name:"targetingPolicy.manageTagsPermissionMode"},ownersCanOverwriteTagSettings:{name:"targetingPolicy.teamOwnersEditWhoCanManageTagsMode"},suggestedTags:{name:"targetingPolicy.suggestedPresetTags"},customTagMode:{name:"targetingPolicy.customTagsMode"},disallowedSources:{name:"targetingPolicy.disallowedSources"}},smb:{tenantSizeSegment:{name:"smbTenantSettings.tenantSizeSegment"}},teamsAndChannels:{allowPrivateChannelCreation:{name:"teamsAndChannelsPolicy.allowPrivateChannelCreation"},allowSharedChannelCreation:{name:"teamsAndChannelsPolicy.allowSharedChannelCreation"},allowEmailIntoChannel:{name:"clientSettings.allowEmailIntoChannel"},restrictedSenderList:{name:"clientSettings.restrictedSenderList"},allowChannelSharingToExternalUser:{name:"teamsAndChannelsPolicy.allowChannelSharingToExternalUser"},allowGuestUser:{name:"clientSettings.allowGuestUser",defaultValue:"false"},showExternalTenantOnboardingSupportPage:{name:"tenantSettingsV2.miscellaneous.showTenantSupportPage",defaultValue:!1},externalTenantOnboardingSupportPageURL:{name:"tenantSettingsV2.miscellaneous.tenantSupportPageURL",defaultValue:""}},chat:{allowRoleBasedChatPermissions:{name:"clientSettings.allowRoleBasedChatPermissions",defaultValue:!1}},localization:{userAccountLocaleCodePolicy:{name:"userLanguageAccountSettings.defaultDisplayLanguage.locale"}},broadcast:{sdnConfiguration:{name:"broadcastMeetingPolicy.broadcastMeetingSDNConfigurationJsonBlob"}},virtualEvents:{eventAccessTypePolicy:{name:"teamsEventsPolicy.eventAccessType"},allowTownhallsPolicy:{name:"teamsEventsPolicy.allowTownhalls"},allowEventIntegrationsPolicy:{name:"teamsEventsPolicy.allowEventIntegrations"},allowedWebinarTypesForRecordingPublish:{name:"teamsEventsPolicy.allowedWebinarTypesForRecordingPublish"},allowedTownhallTypesForRecordingPublish:{name:"teamsEventsPolicy.allowedTownhallTypesForRecordingPublish"},allowEmailEditingPolicy:{name:"teamsEventsPolicy.allowEmailEditing"},allowedQuestionTypesInRegistrationFormPolicy:{name:"teamsEventsPolicy.allowedQuestionTypesInRegistrationForm"}},feedback:{receiveSurveysMode:{name:"feedbackPolicy.receiveSurveysMode"},allowEmailCollection:{name:"feedbackPolicy.allowEmailCollection"},allowScreenshotCollection:{name:"feedbackPolicy.allowScreenshotCollection",defaultValue:!1},allowLogCollection:{name:"feedbackPolicy.allowLogCollection",defaultValue:!1},enableFeatureSuggestions:{name:"feedbackPolicy.enableFeatureSuggestions"},ocpsSendFeedback:{name:"feedbackPolicy.ocpsSendFeedback"},ocpsSendSurvey:{name:"feedbackPolicy.ocpsSendSurvey"},ocpsLogCollection:{name:"feedbackPolicy.ocpsLogCollection"},ocpsEmailCollection:{name:"feedbackPolicy.ocpsEmailCollection"},ocpsScreenshotCollection:{name:"feedbackPolicy.ocpsScreenshotCollection"},ocpsEmailCollectionDefault:{name:"feedbackPolicy.ocpsEmailCollectionDefault"},ocpsScreenshotCollectionDefault:{name:"feedbackPolicy.ocpsScreenshotCollectionDefault"},ocpsContentCollectionDefault:{name:"feedbackPolicy.ocpsContentCollectionDefault"}},userResources:{isSfbCloud:{name:"userResourcesSettings.isSfbCloud"},isSipEnabled:{name:"userResourcesSettings.isSipEnabled"},isSfbCloudInBVD:{name:"voiceAdminSettings.isSfbCloud"},isSipEnabledInBVD:{name:"voiceAdminSettings.isSipEnabled"},licenseSettings:{name:"userResourcesSettings.licenseSettings"},licenseType:{name:"userResourcesSettings.licenseType"},userClassifications:{name:"userResourcesSettings.userClassifications"},isTenantAdmin:{name:"userResourcesSettings.isTenantAdmin"}},coach:{enableCoachByPolicy:{name:"meetingPolicy.allowMeetingCoach"}},meetingOptions:{enableWatermarkCustomizationForScreenSharing:{name:"meetingPolicy.allowWatermarkCustomizationForScreenSharing"},enableWatermarkCustomizationForCameraVideo:{name:"meetingPolicy.allowWatermarkCustomizationForCameraVideo"},enableVoiceIsolation:{name:"meetingPolicy.voiceIsolation"}},sdk:{licenseCategories:{name:"tenantSettingsV2.licenseCategorySettingsMap"}},distributionLists:{allowChatWithGroup:{name:"messagingPolicy.allowChatWithGroup",defaultValue:!0}},ageConsent:{ageGroup:{name:"ageConsentPolicy.ageGroup"}},marketplace:{defaultMarket:{name:"deviceStoreMetadata.market"},deviceStorePurchaseEnabled:{name:"deviceStoreMetadata.purchaseEnabled",defaultValue:!1},deviceStoreAdminEnabled:{name:"deviceStoreMetadata.storeVisibility",defaultValue:!1},deviceStoreMarket:{name:"deviceStoreMetadata.market"}},virtualAppointments:{enableSmsNotificationsPolicy:{name:"teamsVirtualAppointmentsPolicy.enableSmsNotifications"}},edu:{parentDigestEnabledType:{name:"educationAssignmentsAppPolicy.parentDigestEnabledType"}}},namespaces:["userPropertiesSettings","meetingPolicy","messagingPolicy","broadcastMeetingPolicy","teamsEventsPolicy","callingPolicy","voiceAdminSettings","adminSettings","policySettings","teamsMeetingBrandingPolicy","syntheticAutomatedCallPolicy","tenantSettingsV2","tenantVoiceSettings","userResourcesSettings","teamsEmergencyCallingPolicy","teamsEmergencyCallRoutingPolicy","teamsUserPhoneNumbers","teamsMediaConnectivityPolicy","callParkPolicy","teamsEnhancedEncryptionPolicy","onlineDialinConferencingPolicy","teamsVoiceApplicationsPolicy","voicemailPolicy","teamsMediaLoggingPolicy","branchSurvivabilityPolicy","vdiPolicy","updateManagementPolicy","clientSettings","tenantSiteUrl","tenantSiteUrlAndDomains","teamsAppPermissionPolicy","teamsAppSetupPolicy","filesPolicy","externalAccessPolicy","teamsLinkPolicy","educationSettings","feedbackPolicy","teamsMessagingConfiguration","userLanguageAccountSettings","targetingPolicy","smbTenantSettings","teamsAndChannelsPolicy","ageConsentPolicy","deviceStoreMetadata","teamsVirtualAppointmentsPolicy","educationAssignmentsAppPolicy"]},SH={cdlWorkerOnly:{activity:["activityComponentLoggerWaitTime","appsAllowedForActivities","appsDisallowedForActivities","defaultMissedActivityEmailDelayOption","disabledActivities","enableActivityProvider","enableAppActivitiesContextualSettings","enableBatchingForNewActivities","enableBotFeedItems","enableCachedSyncWindowToPreventDuplicateSyncJobs","enableChannelSpecificContextualSettings","enableContextualSettingsPhase1","enableDLPActivity","enableFeedProcessorAPICallBatching","enableHydrationDropOnUserRemoval","enableInviteeJoinedActivity","enableMarkAllAsReadLogic","enableMarkAsReadNetworkCallThrottling","enableMissedCallFeedCallBackAction","enableMissedCallFeedChatAction","enableSplitJoinInviteActivityType","enableUserOnboardingToTeamNavigationInFeed","getConversationMaxBatchSize","honourAppsAllowlistForGraphActivities","markAsReadAPIThrottleRate","missedActivityEmailDelayOptions","mtmaMissedNotificationsProfilePicturePrefix","preventCommunitiesAFHydrationFailureOnConvNotFound","timestampClashTolerance"],activityNotification:["disableEmailSettingsForUserGraphSettings","enableAllTeamsChannelsMacTooltip","enableCoachmarkTimestampInUPS","enableGraphSettings","enableRefactorForGraphSettings","enableTeamsAndChannelsSettings","enableTrimGraphSettingsPayload"],artifactsPlatform:["artifactsPlatformAttachmentsCacheExpiryTimeInMinute","artifactsTableDataExpireDays","artifactsTableDataRefreshTimeInMinute","currentArtifactsPlatformTableVersion","enableArtifactsPlatformAttachmentsBatchSync","enableArtifactsPlatformAttachmentsSync","enableArtifactsPlatformBatchStore","enableLastUpdateTimeBasedDBCleanup","enableMeetingArtifactsBatchSync","enableMeetingArtifactsSync","enableMeetingRecommendationsBatchSync","enableMeetingRecommendationsSync","enableVersionBasedDBCleanup","meetingRecommendationsCacheExpiryTimeInMinute","meetingRecommendationsTableDataExpireDays"],auth:["disableThrowingErrorIfSkypeTokenIsEmpty","prefetchTokens","useForceRenewInSkypeTokenRetry"],autosuggest:["disableSubstrateTCC","discoverServiceTimeoutInMs","domainScopingConfig","enableAdditionalPropertiesInSubstrateChat","enableAdditionalUserTypes","enableAppSuggestions","enableAutosuggestTopHits","enableClassicAttachments","enableDiscoverSurfaceEntryForAutosuggest","enableEmpty3SZQOnColdBoot","enableExternalPhoneSearchSuggestions","enableFeedbackForAutosuggest","enableGroupChatRosterSearch","enableMTOLabelInPowerbar","enableMTOSuggestions","enableMessageSerpEntry","enablePopOutChat","enablePrivateChannel","enableQuerySuggestions","enableReloadingOfNamespace","enableSharedChannel","enableSortingLocalTCCSearch","enableSubstrateSuggestions","enableTopNSuggestions","enableUnnamedGroupChatsFrom3S","enableVisioOneNoteFileType","localSearchDelayInMs","minQueryLengthConfig","minQueryLengthFederatedUsers","slashCommands","suggestionEntityTimeoutConfig","zeroQueryExperienceType"],calling:["enableCallGroupNotification","enableNativeCallsApp","enablePersonSchemaForCallHistory","skipCapiv3MigrationCheck"],channels:["channelInfoPaneCsaRequestDebounceTime","channelInfoPaneDeltaSyncThresholdInMS","channelInfoPaneGetReplyChainsCount","channelInfoPaneRecentContributorsRequestDebounceTime"],chatList:["smbAllDirectorySuggestedContactsExtraUsersToFetch","smbAllDirectorySuggestedContactsLimit","smbTotalSuggestedContactsLimit"],chatService:["maxChatsToShowSuggestedContacts","maxPinnedChats","useChatServiceAfd"],consumerGroups:["createOneOnOneTwoWaySmsChatEndpoint","inviteOffNetworkEndpoint","locationSharingQueryEndpoint","sendMessageEmailToMembersEndpoint"],core:["appsUsageSyncStrategyRefreshIntervalInMs","disablePoliciesSyncStrategy","enableChatBadgeCount","enableT1EndgameNamespaceOverride","offlineActionsManagerDefaultActionExpirationInMs","offlineActionsManagerDefaultCrossSessionRetries","offlineActionsSyncStrategyRefreshIntervalInMs","offlineSupportedResolvers","policiesEndpointManagerConfig","policiesSettingsSyncStrategyRefreshIntervalInMs","policiesSyncStrategyRefreshIntervalInMs"],discoverSurface:["disablePollingUntilFirstReq","discoverCDLLoadMoreCount","discoverChannelsRequiredConfig","discoverHydrationOptimization","enableDataFetchOptimizer","enableDataSync","enableDiscoverDataValidation","enableItemComparison","enableZeroChannelSyncSkip","minPageSizeForLoadMoreAPI"],extensibility:["adaptiveCardsv2CacheLimit","aggregatedAppEntitlementsSyncDebounceMaxWaitMs","aggregatedAppEntitlementsSyncDebounceMs","appAmsImagesManagerConfig","appDefinitionsCacheExpirationSeconds","appEntitlementsCacheExpirationSeconds","appIdList","appStatusesCacheExpirationSeconds","appsRatingTrackerConfig","createAppEntitlementAllowedErrors","customAppPolicyCacheExpirationSeconds","defaultAppDefinitionsForAnonymous","defaultReviewsRequestFilter","disableAppTenantOrgPush","disableFilesAppSupportForGuestUsers","disableInstalledChatAppsPreCheckLogic","enableACv2JITInstallFromCDLv2","enableAboutForPersonalApps","enableAggregatedAppEntitlementsSyncDebounce","enableAppAmsImagesFetch","enableAppMTAPIs","enableAppPolicyPush","enableBlockUnblockBotChatForPersonalApps","enableBotDefinitionSyncWithProfileManager","enableCertificationFilters","enableClientSideLocalizationOfAppBarApps","enableContextlessChatAppsPreCheckLogic","enableContextlessInstall","enableContextlessUpgrade","enableDefaultAppDefinitionsForAnonymous","enableInstalledAppQueryFromTab","enableInstalledAppsUpdateSubscription","enablePaginationForApps","enablePersonalLobApps","enablePlatformPersonalApps","enablePreCheckLogicForMeetings","enablePricingFilters","enableUserSpecificContentInAdaptiveCards","enableUserSpecificContentInChannels","extensibilityAppPickerUnifiedAppsChannelEntryPointConfig","extensibilityAppPickerUnifiedAppsChatEntryPointConfig","isAllowedAppList","isSubmitStagingAppsAllowed","meetingAddTabFlyoutConfig","meetingAddTabPanelConfig","messageExtensionFlyoutConfig","outgoingWebhookConstants","priorityStaticTabAppIds"],files:["p2pFilesListService"],gallery:["enablePhotosTab"],growth:["enableMFUProfileCleanup","enableMfuContactsInPowerBar","enableTflJoinLinkSuggestion","enableTflPowerBarZeroState","espAllIrisPlacementIds","irisAllCampaignCache","irisCacheThrottleEmptyResponse","irisCacheValidTimeWhenCampaignExists","mfuContactsSyncRefreshIntervalInMs","mfuProfileCacheCapacity"],guardians:["enableAnnouncementsChatSuppression","membersAndRelatedContactsCacheExpirationSeconds","relatedContactsCacheExpirationSeconds","suppressAddMemberMessagesForGuardianChats"],host:["enableSyncEngine"],meet:["disablePrefetchOnStartup","enableFetchMRE","enableThumbnailFromMCO"],messaging:["enableCommentStreamReceiveHTMLSanitization","enableSelfChatAutoPin","msgDisableCallSystemMessageExcludeFromPillCount","msgEnableIncludeMutedChatIntoPillCount","msgEnableSfCInteropChats","oneOnOneTwoWaySMSThreadsInSearchEnabled","smartNavigatorTimeOutMillisecond","suggestedScheduleMessageDeliveryPreWorkHoursBufferMinutes","tflSmsFriendlyNameCacheExpiryInMinutes"],notifications:["disableCommunitiesMessageUpdateToasts","enableAppBadgeVNext","enableCommunitiesCalendarEventsToastNotifications","enableCommunitiesMembershipJoinRequestCreatedToastNotifications","enableCommunitiesMembershipPromotedToAdminToastNotifications","enableCommunitiesMembershipRequestToJoinToastNotifications","enableCommunitiesMentionEveryoneToastNotifications","enableCommunitiesMentionUserToastNotifications","enableCommunitiesNotificationFiltering","enableCommunitiesPersonalReplyToastNotifications","enableCommunitiesPostReplyNotificationsWebhook","enableCommunitiesReactionsToastNotifications","enableCommunitiesReplyNotificationsActivityManager","enableCommunitiesReplyToReplyToastNotifications","enableCommunitiesReplyToastNotifications","enableDropLongpollMessagesFromReadThreads","enablePriorityContactsNotifications","enableSettingsPageWarnUser","enableUrgentNotifications","showInviteJoinedNotification","taskListCreatedNotification"],notificationsEngine:["enableConversationsReminder","intervalMinsBetweenMessageShouldBeShownConversationsReminderNotification","intervalMinsBetweenRemindersConversationsReminderNotification","intervalMsCdlStrategy","intervalMsMeetNowLinksNotification","intervalMsXDaysOfInactiveStatusNotification","timesToBeShownMeetNowLinksNotification","timesToBeShownXDaysOfInactiveStatusNotification"],people:["bufferTimeForSuggestedContactsEvent","capiV3ContactsPageSize","capiv3ContactsMaxCount","capiv3ContactsSyncMaxRetryCount","contactsSyncDeltaIntervalForLargerSetInMilliSeconds","contactsSyncDeltaIntervalInMilliSeconds","contactsSyncFetchPageSize","contactsSyncServiceEndpointManagerMaxRetries","contactsSyncStrategyIntervalInMilliSeconds","ddrProfileExpiryInMinutes","ddrProfileUpdateSyncChunkSize","ddrProfileUpdateSyncRefreshIntervalInMs","default3SScenarioName","emailAndPhoneChunkSize","enableAddingDefaultContactsSyncSettings","enableAppendingImageUriForGroup","enableCachedProfileBackgroundFetch","enableCachedUserDataLoader","enableCallerInfoSanityCheckForProfileAPIs","enableEmailSearchForLocalProfileSearch","enableEmitProfilesUpdateEvent","enableEndpointsManagerForPeopleService","enableEndpointsManagerOnContactsSyncService","enableEndpointsManagerOnPeoplePickerService","enableExpiryForWorkingSetProfiles","enableGroupAvatarsFor3SSuggestions","enableMTCallToSendKeepAliveSignalToSCD","enableMTCallToUnsyncSourceFromSCD","enableOfflineErrorCheckForPeopleScenarios","enableProfilePictureV2","enableProfileUpdateSyncWorkflowOnAppLongInactive","enableProfileUpdateSyncWorkflowOnInterval","enableRankedSyncContacts","enableRefreshMeProfileOnStartUp","enableSetEmptyAvatarETagToSignedInTime","enableSfCProfileFetch","enableSubstrateInstrumentation","enableSubstrateSuggestions","enableSubstrateTopNAndWorkingSetComparison","enableSyncContactInteropStatus","enableSyncContactsSortingOnRank","enableTflProfileFetch","enableTfwUserProfileFetch","enableThrottleUnknownUserFetch","enableTopNSuggestions","enableUseInitialsForAvatarAsDefault","federatedProfileChunkSize","federatedProfileExpiryInMinutes","fullSyncRefreshTimestampOnECS","groupMaxSearchResultsFrom3S","includeOnlyPrimaryAliasInSuggestedContacts","includeOnlyRankedContacts","includeSearchInUpn","localSearchDelayInMs","maxBatchSizeForExternalUsers","maxSearchResultsFromCache","maxUserActionAllowedOnSyncBanner","mtoProfileExpiryInMinutes","nonWorkingSetProfileExpiryInMinutes","peopleBackfillTimeoutInMs","peopleCoreSyncStrategyOnIntervalJitter","peopleCoreSyncStrategyRefreshIntervalInMs","peopleMaxSearchResultsFrom3S","peopleServiceEndpointManagerMaxRetries","profileExpiryInMinutes","profileFetchChunkSize","profileFetchWorkingSetDeltaRefreshIntervalInMs","sharedChannelProfileChunkSize","shouldMakePeopleDBCall","shouldRemoveFormatCharacters","skypeConsumerFetchChunkSize","substrateSearchTimeOutInMs","syncBannerDisplayInterval","tflConsumerFetchChunkSize","tflProfileFetchChunkSize","unknownUserBackroundRefreshThrottleInMinutes","unknownUserFetchStopThreshold","unknownUserFetchThrottleInMinutes","unknownUserFetchThrottleThreshold","useChatDataFromSubstrate","useUserLevelTimestampForAvatarETag","workingSetFetchPageSize","workingSetFetchTopNSize","workingSetProfileExpiryInMinutes","workingSetSyncStrategyRefreshIntervalInMs"],peopleTargeting:["enablePeopleTargetingCDLManager"],presence:["debouncePublishPresenceTimeInMs","enableExtendedLogging","enableHandleSetPresenceSuccess","enableSerializingPublishPresence","enableStatesAggregationForUserActivity","getPresenceDebounceTimeInMs","getPresenceDebounceTimeMaxInMs","maxMrisToTrackPresence","maxNumberOfUpsEndpointIdsPerDevice","pendingMriListSyncDelay","presenceMriEntriesLogLimit","presencePostHeartbeatIntervalInMs","presencePostHeartbeatTrouterIntervalInMs","presenceStrategyPollingIntervalInMs","presenceSyncIntervalInMs","removePresenceTrackingInfoOnCDLUnsubscribe","shouldCheckMachineState","shouldDebouncePublishPresenceWhenStateChange","shouldSetUserActivityInTrouterNotificationsProvider","shouldUnsetTrouterDisconnectedTimestamp","trackingPresenceUpdateDebounceTimeInMs","trackingPresenceUpdateDebounceTimeMaxInMs"],queues:["enableQueuesApp","queuesHistoricReportingServiceSettings"],searchCommon:["enableFullTextSearchOnTopN","maxTopNFetchSize","noOfResultsToLoadFromTopN","scenarioNameForSubstrateTopN","topNSuggestionsCacheExpiry"],smb:["enableExternalSuggestedTflUsersOnly"],sync:["channelReplyChainsToPrefetchInStore","chatReplyChainsToFetch","chatRetentionCount","chatServiceGapDetectionDebouncePeriodInMins","chatsStartupJobDeltaPageSize","chatsStartupJobPageSize","clearHistoryPruningBatchSize","conversationEventThrottlingOptions","conversationGapsThresholdForSync","conversationPruningBatchSize","conversationPruningIntervalDays","conversationsFetchDebounceInvokeOnTrailing","conversationsFetchDebounceMaxWaitMs","conversationsFetchDebounceMs","conversationsSyncDebounceInvokeOnTrailing","conversationsSyncDebounceMaxWaitMs","conversationsSyncDebounceMs","currentConversationTableVersion","currentConversationVersion","deadConversationPruningBatchSize","deepLinkNavigationThreshold","defaultWorkflowTimeoutSeconds","deltaSyncDebounceInvokeOnTrailing","deltaSyncDebounceMaxWaitMs","deltaSyncDebounceMs","deltaSyncJitter","disableBatchedLegacyConversationUpdateEvent","disableCancelJobOnAuthNetworkUnavailable","disableConversationSupportedCheckForLongpollUpdate","disableConversationVersionFiltering","disableDisconnectBannerOnStartupForTrouter","disableIgnoreThreadUpdateOfSharedChannelParentTeam","disableInteropOneToOneChatFetch","disableIsReplyChainSyncedCheckInRelatedMessageSyncWorkflow","disableLegacyLastMessageUpdateComparison","disableLieLastMessageResolve","disableLowRangeExclusiveOverride","disableMergeThreadProperties","disableMessageIdFetchValidation","disableNetworkFetchForMissingMessageInGetReplyChain","disablePartialLoadConversationNetworkFetch","disableRelatedMessageSyncOptimization","disableReplyChainResponseMissingMessageDetection","disableResolveablesFilteringInReplychains","disableScheduledMessageDeliverySuggestionWorkingHoursCache","disableSkipAccessCheckForSharedChannel","disableSyncMessagesPrefetch","disableTempjoinChannelIfExpired","disableTopicsCheckForReplyChainSync","disableTopicsCheckToDetermineChannelHardDelete","disableUsingTrouterForNetworkState","emitCreatorMRIs","enableChatMessageVersionFilterForDbWrites","enableChatNavigationOnChatServiceEventSubscription","enableClientLieInsertionValidation","enableConversationFetchResiliency","enableConversationPruning","enableConversationSyncForLargeChannelTempJoin","enableDataSpillageHardDeletion","enableErrorThrowOnEmptyConversationFetchResult","enableExecutingJobPriorityUpdate","enableFakeDraftLieResolvable","enableForcedMaintenanceWorkflow","enableGapDetectionForMessages","enableInMemoryCleanup","enableKillingTrouterConnection","enableL2chSync","enableLoggingOfRosterSummaryUpdate","enableMessageForReplyChainTrim","enableMessageIdLogs","enableMissingMessagesBanner","enablePersistencePruning","enableProcessingAndMutatingEmotionProperty","enableReplyChainPrefetchFromDb","enableReplychainMessagesPartialLoad","enableRestartNotificationProviderOnAuthUp","enableRestoreInvalidConsumptionHorizon","enableRetentionBasedLastMessageNuke","enableRetentionHorizonBasedPruning","enableRetentionHorizonV2Property","enableRetryNetworkFetchForSingleReplyChainFetchFailure","enableScheduledAndInstantMeetingsInRecents","enableSkipCNSEndpointCreation","enableSkypeMessageClassSanitization","enableStartNotificationProviderOnAuthUp","enableStartupStrategiesUnblockingForAnonymous","enableStartupSyncOnAuthUp","enableStartupSyncOnMachineActive","enableStartupSyncOnMachineUnsuspend","enableStopNotificationProviderOnRegistrationFailure","enableStopNotificationProviderOnTerminalError","enableStoppingTrouterNotificationProviderOnRefreshTokenFailure","enableStrictMessageSanitization","enableTPSGetPushUpdatesWithRetry","enableThreadDetailsFetch","enableThreadDetailsSyncOnNavigation","enableTokenRefreshOnTokenRevocation","enableTokenRefreshOnTrouterClaimsChallenge","enableTriggerSyncForGapDetection","enableUseTrouterStateDirectly","enableVerboseWorkerLogging","enableVivaInsightsLicenseCache","enableWorkflowDebouncer","enabledConvertToRCSJForLargeChannelDuringDeltaSync","eventLoopBusynessTimeoutValueInSeconds","excludeInactiveStateFromActiveState","extendHistoryPageSize","fanoutRosterSizeForLargeChannel","feedsStoreSettings","forceMaintenanceIntervalSeconds","forcedMaintenanceJobs","gqlResponseTrackerCleanupIntervalMs","groupChatsSyncJobPriority","inMemoryCleanupBatchSize","isReclaimEnabled","isVersionBasedDBCleanupEnabled","legacyActiveConversationConfig","loadMissingMessagesLimit","maxConcurrentJobsByPriority","maxMembersForMeetingForTitleCaching","maxMessageIdCountToLog","maxSyncTimeMultiplier","messagesGapThreshold","missingMessageReportingWaitIntervalMinutes","missingMessagesReportingConfig","mruChannelsSize","notificationProviderStateChangeHistoryLimit","outOfOrderWaitIntervalSeconds","overrideThreadTypeForPrivateFeeds","persistencePruningBatchSize","persistencePruningJobTimeOutSeconds","realTimeMessagingEventsLoggingPeriodInSeconds","requireValidAuthTokenBeforeDBCleanup","retentionPruningBatchSize","scheduledMessageDeliverySuggestionWorkingHoursCacheLengthSeconds","shouldCheckCachedTrouterEndpointOnDisk","shouldCleanupOnVersionBumpIfOffline","shouldSupportMachineState","shouldUseStartupSyncFailuresDuringIntervalSyncCheck","shouldUseStartupSyncFailuresDuringIntervalSyncCheckV2","skipIntervalForUnutilizedAcctConfig","startupJobTimeOutSeconds","suppressBotAddMemberLastMessageUpdate","syncEngineCommandDelay","syncIntervalSeconds","syncSchedulerDiagnosticsDebounceMs","syncSchedulerLongRunningTimeMs","syncSchedulerMaxJobCount","syncSchedulerStarvationTimeMs","threadDetailsSyncDebounceInvokeOnTrailing","threadDetailsSyncDebounceMaxWaitMs","threadDetailsSyncDebounceMs","threadRosterLimitForRelatedMessageSync","tpsSyncStrategyLoadTimeoutMs","updateOnlineStateOnMachineStateChange","verboseWorkerLoggerMaxQueueLength","vivaInsightsLicenseCacheLengthSeconds"],teamsAndChannels:["disableExplicityAddCheckForSharedChannelBeforeHardDeleting","enableForceFetchUnjoinedConversation","teamsAndChannelsProvisioningServiceConstants"],whatsNew:["enableBadgeInTaskBar"]},forwardToCdlWorker:{activity:["activityCustomizations","enableActivityAppCommandResultHook","enableActivityDotBadge","enableActivityFeedForSubCommunity","enableActivityFeedItemDeletion","enableActivityFeedItemDeletionOnUI","enableActivityFeedItemDeletionWithToast","enableActivitySlices","enableAvatarUrlResolutionInActivityFeeds","enableChatLocationDisplayNameParity","enableCommunitiesCalendarEventsFeedItems","enableCommunitiesFeedItems","enableCommunitiesInviteAcceptedActivity","enableCommunitiesOwnerPromotionActivity","enableEnhancedFilters","enableMTMAMissedNotificationsDotBadge","enableMTMAMissedNotificationsInTrustedUI","enableMTMANotificationsReadFromMaglevStorage","enableMTMANotificationsUnseenBehavior","enableMutePostInChannel","enableRealTimeUpdatesToMissedMTMANotifications","enableSeparateDateTimeParsing","enableUnreadToggle","enableVoicemailFeedItems","enabledCommunitiesActivities","enabledGenericActivities","localesWhereLastNamePreferred","mtmaNotificationsFetchMoreDebounceInterval","mtmaNotificationsPublishDebounceInterval"],activityNotification:["enableActivitySettingsV2","enableEnhancedSettingsExperience","enableEnhancedSettingsExperienceForApps","notificationFeedSettingsNoiseThreshold"],ageConsent:["ageGroup"],artifactsPlatform:["channelMeetingAttachmentsMap","enable3SRTelemetry","enableChannelMeetingAttachmentsInMCO"],auth:["allowCdlWorkerToUpdateSetting","claimsChallenge401RetryMax","disableSTMFallback","disableSkipTokenRefreshForAnon","disableSkypeTokenOnCsa","disableSkypeTokenToMtInGtm","enableAsyncBatchScenario","enableCachedUser","enableMTO","enableRegionAndSTMHeadersOnCsa","enableSTMHeaderForAuthZ","enableSkypeTokenMigrationForMT","enableSkypeTokenMigrationForTrouter","forceRenewForAADToken","sendMigrationHeaderToMtInGtm","skypeTokenMigrationEnabled","skypeTokenMigrationServiceInfo","stmFallbackMapTimerInHr","stmSourceList"],autosuggest:["enable3SMessagesInQf","enable3SSharedChannelSuggestion","enable3sQueryTextSuggestionDelete","enableAppScopedSearchInVC","enableAppScopedSearchInVE","enableCenteredEchoQuery","enableContextualSearchEntryPointInASTypeahead","enableContextualSearchEntryPointInZQ","enableDomainScopingV1","enableEDUSersInAutosuggest","enableExternalSearchSuggestions","enableHelpForAutosuggest","enableMirroringDomainScoping","enableMriFromServiceForMessage","enableQuickActions","enableSMSContactAutosuggest","enableSearchBoxAlignmentWithSerp","enableSearchV2ForGuestInAutosuggest","enableSeeMoreForMessages","enableSerpCorsPreload","enableSlashCommand","enableSubstrateInstrumentation","learningSlotConfig","pcsFilterConfig","serpCorsPreloadScenarioName","smsContactSupportedRegions","wpsSearchConfig"],calendar:["enableCalendarInviteRouting","enableM365Calendar","enableM365CalendarToggle","enableRememberAnonymousExternalContacts","enableRememberingExternalUsersInCalendar","enableResolvingInTenantEmailsInPasting","enableWhiteboardCalendarTab"],calling:["addCountryCodeDuringNormalization","allowNonE164Mri","allowPrivateCallingPolicy","callHistorySettings","callLogsBlacklistedMRIs","commentStreamFetchPageSize","delegationSettingsPolicy","dialPlanPolicy","disablePrivateLineActivityFeed","enableCallHistoryExternalTagging","enableCallsAppPhaseStateMachine","enableCapiV3Contacts","enableDialPlans","enableFixForDtmfTone","enableFormatNumberV2ForUI","enableFormattingFixForExtension","enableMaskAttendeesInMeetings","enableMediaConnectivityPolicy","enableMeetingChatAcceptBlockFlow","enableMeetingChatAcceptBlockFlowUI","enableMeetingDataAdditionalTelemetry","enableMeetingStartedNotificationV2","enableMeetingsActiveCallIndicator","enableNewCallsBadging","enableNovaSpeedDial","enablePrivateLine","enablePstnWithExtnFix","enableRemoveMeetingChatAcceptBlockAfterCallJoin","enableRichCallHistory","enableRichCallHistoryExtension","enableSLABossTabsForMW","enableSLACallHistory","enableSLACallHistoryFromPersonalHistory","enableStarfieldBackgroundsPromo","enableStreamChatFeature","enableUpdatedGetVoicemailsPath","enableWhiteboardAG08","enableWhiteboardAG09","enableWhiteboardPolicy","forceCommentStreamForConversations","isFluidDefaultOn","meetingPolicy","sharedVoicemailServiceSettings","showCustomChatPaneErrorForNonChannelMember","stopNormalizationOnPlus","teamsVoiceApplicationsPolicy","useFluidWhiteboard","userIdPrefix","voicemailServiceSettings","yammerQnaGraphqlAuthEndpoint","yammerQnaGraphqlEndpoint"],cdlWorker:["conversationUpdatesBatchingConfig","currentConversationTableVersionGCC","disableFullLaunchIntentCheck","disableLiveMessageUpdatesOverPNH","disableNoAccessChannelCleanup","disableSyncForFavoritesRequireStatusFailed","disableUnreadCountCalculationInChannelActivitiesPublisher","eduRosterSyncIntervalInHours","enableAllowErrorsInSubscriptions","enableAvatarUserInfoCache","enableConversationFolderManagerStore","enableConversationTableVersionGCC","enableConversationUpdatesBatching","enableLiveMessagesNotificationsOverANS","enableLiveMessagesNotificationsOverTrouter","enableLoggingMissingMessagesBetweenSyncAndWritingToStore","enableMTMAUserDataInMaglevStorage","enableRosterSync","enableSettingTeamsAndChannelsFolderViewType","enableTelemetryOnMachineActive","forceGroupChatSync","maxMissingMessagesToReportToTelemetry","recentChatListPageSize","recentChatMaxHiddenPages","rosterSyncFrequencyInHours","rosterSyncIntervalInHours","shouldSkipGroupChatSyncBasedOnIsPartialData","telemetryOnMachineActiveScenarioTimeoutMs"],channels:["enableAtMentionManyRecipientsWarningBanner","enableChannelCopilotInL1MessageAction","enableChannelCopilotInL2Header","enableChannelMessagesUserResolutionByUserDataLoader","enableInfoPaneUserFetchingByUserDataLoader"],chat:["enableAvatarMoreErrorInfoLogging","enableChatInfoPaneSharedSection","enableDebounceCreateChat","enableMultiplePinnedMessages","enableNewChatOnAppBarContextMenu","enableNewChatPopOut","enableRSVPBasedMeetingChatNotifications","enableRenderedMessagesVerificationForTelemetry","enableRoleBasedChatPermissions","maxNumberOfMultiplePinnedMessages","numberOfSharedItemsInL1ChatInfoPane","shouldNotAddNewPinnedMessageToPropertyOnPin"],chatList:["bizChatMetaOSAppId","disablePinnedChatsInUserPreferences","enableBizChatMetaOSChatListEntryPoint","enableChatListRawErrorLogging","enableGroupChatActiveCallIndicator","enablePopoutAction","enableRemoveMemberIds","enableShowMissedActivitiesInChatList","enableSmbAllDirectorySuggestedContacts","enableSmbChatListSuggestedContacts","enableSmbExternalChatListSuggestedContacts","enableSuggestedOrgGroupChats","enableSuggestedProjectGroupChats"],communities:["allowCommunitiesStatusBasedCancel","atMentionsSearchMembersLimit","atMentionsStorageExpiryTime","communitiesDeletedDanglingReplyRetentionInMinutes","communityAvatarMaxSizeInMB","enableCommunitiesApp","enableCommunitiesAtMentionsEveryone","enableCommunitiesAtMentionsWorkerResolver","enableCommunitiesCreate","enableCommunitiesDetailedBadgeCount","enableCommunitiesJoinDialogForPostlink","enableCommunitiesJoinFlyout","enableCommunitiesNicknames","enableCommunitiesNicknamesActivityFeed","enableCommunitiesNicknamesToast","enableCommunitiesOnNetworkInviteEmailToggle","enableCommunitiesReportAConcernTombstone","enableCommunitiesV2Mutations","enableCommunitiesV2Schema","enableDeltaProfilesFetchAtMention","enableDeltaProfilesFetchAtMentionUsingRosterDiff","enableMediaScanDeleteTombStone","enableMemberThreadDetailsSync","hideCommunitiesDeletedDanglingReplies","nicknameExpiryTimeout","removeAdminCheckFromShareJoinLink","showTextScanDeletedPost","updateCommunitiesAtMentionLabelToEveryone","useV2FetchReplyChainApiForSubcommunities"],compose:["enableDesignerInChannelAnnouncementPost","enableSendPostAsEmail"],core:["coreColdBootAppId","disableAppBarAppsSubscriptionThrottling","disableCachingM365SuggestedApps","disableTrouterConnectivityTracker","enable1JSEcsClient","enable1JSGraphqlSearchBox","enableAppBarPinning","enableCommunitiesBadgeCount","enableLocaleFilterForFeatureFlags","enablePersonalFlyoutSearch","enablePersonalFlyoutSuggestions","enablePlatformAppsBadgeCount","enablePoliciesPushUpdates","enableRelay","enableSettingsPushUpdates","enableSimpleCollabAutopin","enableSupermassiveCDL","enableSupermassiveResolverTracing","searchBoxSuggestions"],crossDeviceAttach:["enableMobileAttachFilePicker"],csaService:["apiConstantsGCC","chatsStartupCallMaxRetryCount","chatsStartupCallMaxRetryInterval","chatsStartupCallMinRetryInterval","chatsStartupCallStalledInterval","csaRetryOverrides","enableChatsStartupCallStalledTimeout","enableStartupV3API","startupV3EnabledTenants","useCSARetryOverridesMap"],diagnostics:["clientExtendedDiagnosticsData","consoleLogLevel","diagnosticsLogsThrottling","disableExtendedDiagnosticsDataToggle","enableWorkerStoreDiagnosticsLogsInIDB","logReporterSendCountInterval","logReporterSendErrorCountInterval","logReporterSendTimeInterval","loggerReportCountInterval","loggerReportTimeInterval","loggerThrottleList","logsMarkInterval","savingLogsIntoIDBThrottleTime","throttleCapacity","throttleWindowSizeMs","workerDiagnosticsEventQueueMaxSize","workerDiagnosticsLogBufferArraySize","workerDiagnosticsLogsIDBObjectCount"],discoverSurface:["disableDiscoverForGuestUsers","enableDiscoverManagerRefactoring","enableHybridDiscoverSurface"],edu:["enableAssignmentsApp","enableStudentTeamifyCustomization"],esp:["enableEspDLSurfaces","irisEspCacheRefreshIntervalHours"],extensibility:["appBarNotToLandApps","appDefinitionsCacheExpirationPeriodSeconds","appEntitlementsCacheExpirationPeriodSeconds","appStudioServiceAuthResource","appStudioServiceBaseURL","appSuggestionsExperiments","appsTenantSettingsLastUpdatedTimestamp","botDynamicCommandDebounceMaxWaitMs","botDynamicCommandDebounceMs","botDynamicCommandsSyncStrategyRefreshIntervalInMs","disableFetchBotInfoOptimization","disableMessageExtensionsInMeeting","disabledTabAppIds","eduSelectAppEntityAllowList","enableAppEntitlementsEtag","enableAppServiceInPlatformService","enableBannerLayouts","enableBotDynamicCommandsSyncEngine","enableBotSsoV2","enableConversationalAppsFilterSyncEngine","enableEditorialArticlesInStore","enableFallbackClientStoreSearch","enableFilterPinnedAppsBasedOnPolicy","enableFlyoutQuickAccessSection","enableFlyoutSeeAllButton","enableForceFetchBlockedStoreAppsById","enableLowCodeWorkflowTemplatesSyncEngine","enableMessageExtensionInTFLCommunities","enableNewAdminPreinstalledAppCoachmark","enablePowerbarMESearch","enablePowerbarUninstalledAppsSearch","enableReactTaskModuleForBIM","enableServerSideStoreSearch","enableSharedInstalledAppsInManageApps","enableStaticTabsPhase1","enableStaticTabsPhase1InChannels","enableStoreApiCapabilities","enableStoreAppPolicyCheck","enableStoreWorkerDataProvider","enableSuggestionsServiceOdataEndpoints","enableSynchronizedSyncAndStorePut","enableTenantSiteUrlAndDomains","flyoutQuickAccessExcludedAppIds","flyoutQuickAccessSize","flyoutSeeAllButtonIndex","includeOpenAIPlugins","isSideLoadingInteractionEnabled","isUserPinningAllowed","lowCodeWorkflowTemplatesSyncStrategyRefreshInMs","ratingsOnRankingExperiment","sharedChannelSupportedAppIds","storeApiCategoryMaxAgeInMinutes","storeApiMaxBackoffInMinutes","storeApiMaxOverviewItems","storeApiMinBackoffInMinutes","storeAppItemsMaxAgeInMinutes","storeAppTenantBackground","storeAppTenantIcon","storeAppTenantLogo","storeAppTenantTextColor","storeAppsArticlesDoc","storeAppsCollections","storeAppsCollectionsDoc","storeBannerAppsCollectionsId","storeContentCollectionsMaxAgeInMinutes","storeContentConfigs","storeContentHost","storeContentPreviewHost","storeDefaultDataProviderType","storePersistedCacheMinBuildVersion","storePersistedCacheMinTimestamp","storeProviderConfigs","storeSearchQueryDebounceMs","storeSearchQueryTimeoutMs","storeSearchSettings","storeWorkerDataProvidersList","teamsAppPermissionPolicyHash","teamsAppSetupPolicyHash","workflowApp"],federated:["enableFederatedUsersInAddToChat","enableFederatedUsersInAddToSpeedDialOrContacts"],files:["enableEndpointsManagerOnSharepointRestClientService","enableFilesPolicy","nativeFileEntryPoints"],flyout:["enableOverflowMenuInFlyout","enablePeopleExperience","enableScheduledMeetingsInForYou","enableTflFeaturedCommunitiesSync","frequentlyUsedContactsListSize","staticNowCardPromotionCampaigns","tflFeaturedCommunitiesSyncIntervalInMs"],homepage:["enableTflHomepage"],host:["enableProfilePicturesWithObjectId","enableRecordingAndTranscribingInCallsAppV2"],hostCapabilities:["fullLaunchIntent","phoneLinkingBlocked","storagePartition"],localization:["enableLocaleSyncWithMSAccount","userAccountLocaleCodePolicy"],marketplace:["defaultMarket","deviceStoreAdminEnabled","deviceStoreCatalogCDNHost","deviceStorePurchaseEnabled","enableDeviceStoreMetadataFetch","enableStoreCartCdl","stopDeviceStoreEntryLog"],meet:["busyUserInsightCountPerWeek","busyUserMeetingCountPerWeek","checkUserTypeThreshold","diffFetchBusyUser","disableArtifactsStoreSubscription","disableDynamicJobQueuePriority","disableLazyLoadUpcomingEventDetails","disableMCUMeetAppScenario","disableMeetForWorkManager","disableMeetForWorkRecentRefreshStrategy","disableMeetForWorkScenarioDetails","disableReduceCalendarCallOnIntervalForUpcoming","disableThumbnailFromMCO","disableUpcomingPagination","enableCalendarEventCountTelemetry","enableCalendarTPSForRecent","enableFetchBeforeEnterMeetApp","enableFetchUserProfilesInBatch","enableFileRecommendation","enableMCUMeetAppScenario","enableMeetAppAugloopWorkflow","enableMeetForWork","enableMeetForWorkCDL","enableMeetForWorkPrePin","enableMeetForWorkRecentRefreshStrategy","enableMeetingPreparation","enableMockCalendarFetchError","enableMockMCOFetchError","enableMockMCUFetchError","enableMockMREFetchError","enableNativeMeetApp","enablePrefetchOnInterval","enableRecapLastOccurrence","enableRecentShortSummary","enableSubstrateEventSearch","enableUserProfilesCache","getThumbnailIgnoringMCU","graphqlBaseUrl","insightsProviderVersion","isMailboxDiscoverable","isOnCloud","maxRecentSyncingDays","maxStepForBusyUser","maxStepForNonBusyUser","mcuFlights","meetForWorkCDLSettings","mockFeatureForABTest","moreTelemetryForFetch","preFetchRecentAttendee","substrateBaseUrl","throttlePublishTime"],meetingArtifacts:["allowEngagementReportPolicy","enableBypassingEngagementReportPolicy","enableCheckCoOrganizerInRecentAttendanceReport","enableHidingOneOnOneMeetingAttendanceReportEntrances","transcriptServiceEndpoint","transcriptServiceResource"],meetingRecap:["blockedMeetingTypesTemplateIds","convertROnlyToRnT","disableRecapsFilterOnFixedDuration","enableMergeSeriesMasterCollabObject","enableRecapForChannelMeetings","enableRecapForSharedChannelMeetings","enableRecapTranscriptOnly","getDateOffset","recapDurationDaysOffset"],messaging:["allowGroupChatJoinLinks","allowSmartReply","allowUserChat","chatHighlightsSmartActionUnreadThreshold","chatSmartNavigatorMaximumHistoryDays","chatSmartNavigatorUnreadMessageCharCountThreshold","chatSummarizationMaximumDays","commCopilotSummarizationRequestConfig","copilotPluginServiceAuthUrl","copilotPluginServiceUrl","disableChatHighlightsSmartAction","disableChatHighlightsSmartActionForGroup","disableChatHighlightsSmartActionForMeeting","disableChatHighlightsSmartActionForOneOne","disableSmartRepliesForMessagesOlderThan24Hours","emergencyMRIs","emergencySmsNumbers","enableAutoDeleteV2","enableAutoEditV2","enableAutomaticTranslationV2","enableCallKMApiDirectly","enableCallingSmartSuggestions","enableChatHighlightsSmartAction","enableChatJoinLinksForTfwGroupChats","enableChatPinEventErrorMessageLogging","enableChatWithMtoFederatedIdentity","enableChattingWithMtoUserBanner","enableConsumerConversations","enableForwardMessageUnreadMarkers","enableGroupChatAudioDropin","enableHasTeamsProProtectionLicenseCheck","enableHideExternalLabelForMTOUsers","enableHolisticRecap","enableInOrganizationChatControl","enableInOrganizationChatControlFeature","enableLicenseCheckForM365ChatBot","enableMarkAllChannelsAsRead","enableMarkAllChatsAsRead","enableMeetingChatAutoUnmute","enableMtoUserChatBanner","enableOnDemandTranslation","enablePaidSmsChat","enableRoamMessageDraft","enableSmartFilesSuggestions","enableSmartNavigator","enableSmartReplyV2","enableSmartSchedulingSuggestions","enableThreadingInChat","enableTogetherEmojisV2","enableTopicAnnotationLogMismatch","enableTopicInline","enableTopicInlinePreview","enableTopicSmartReplies","enableTopicSmartRepliesPreview","enableTopicsSdkWebWorker","enableTranslationIntelligentSuggestions","enableTranslationSettingsRoaming","enablefeatureSettingManager","enablefeatureSettingResolver","hotlineSMSNumbers","inOrganizationChatControl","isMultiWindowSendPipeline","markAllAsReadBatchSize","msgEnableSfbCloudFromBVD","msgEnableUnlimitedReactions","rejectNonAmsURLFromAsyncMediaService","shouldOverrideM365ChatBotLicense","smartNavigatorSupportedLocales","supportedSMSRegions","sydneyPromptServiceAuthUrl","sydneyPromptServiceUrl","teamsUserPhoneNumbers","topicAnnotationsMaxParticipants","topicAnnotationsMinParticipants","topicSmartRepliesMinAnnotationScore","topicSmartRepliesMinRelevanceScore","translationLanguageStampingTunerSettings","translationSettingChangesExpirationTime","useKServingInTopicsSDK","userFeatureSettingsConfig","userLanguageAccountSettings","vivaTopicsAriaCollectorUri"],metadata:["region"],notifications:["enableShowPreviewInToastsCheckbox","enableSkypeUsersIcons","enableSubCommunitiesToastNotifications","enableThrottleNotifications","enableUrgentToastsContentFixes","notificationThrottleTimeMs","showGenericNotificationsSoundSetting","showNotificationsCallsSoundSetting"],onboarding:["enableSignInToTflMobileWhatsNew"],people:["allowScopedPeopleSearchandAccess","disableGroupChatDelimiterUsage","disableUnverifiedLabelForPSTNUsers","enableAdditionalRequestHeadersToUPS","enableAtMentionInStatusNote","enableCapiv3MigrationStateCheckInLPC","enableDDRForProfileAndAvatarFreshness","enableEditContactCAPIDisplayNameWorkaround","enableEditContactSDSDisplayNameWorkaround","enableEditContactSDSNamesWorkaround","enableExtendedDirectory","enableExternalTagForPSTNUsers","enableInitialsImageForPstn","enableLPCOneGQLPerson","enableLPCPhotoViaOneGQLPerson","enableLabelingUsersByTrustLevel","enableLokiContactModifiedOnPersonMutation","enableMTOLabel","enableMentionManagerCacheRefresh","enableNativeAvatarForMTO","enablePBCCreation","enablePBCsForEnterpriseOutTenantUsers","enablePeopleApp","enablePeopleAppPresence","enablePeoplePickerConfRoomRemovalAndAddition","enableSearchV2SearchForGuests","enableSilentLokiAuthTokenRetrieval","enableTfwUpdateGroupChatAvatar","enableTfwUpdateGroupChatTransparentBackgroundAvatar","experimentalPeoplePickerOrderChanges","hotlineNumbersMapping","janaContactListFirstPageSize","janaContactListSubsequentPageSize","lokiTokenResourceUrl","lpcOneGQLPersonDebugPrefix","topNSuggestionsExpiryCheckIntervalMiliseconds"],peopleTargeting:["customTagMode","disallowedSources","enableAutomaticTags","enableOwnersTag","enableOwnersTagInPrivateChannel","enableScheduledTags","enableTagsInPrivateChannels","enableTagsInSharedChannels","ownersCanOverwriteTagSettings","suggestedTags","tagPermissions"],phonelinkSms:["csaPhonelinkSmsRequestTimeout","enablePhoneLinkSmsWhatsNew","enablePhonelinkAltMeetLink","enablePhonelinkEUDMAContent","enablePhonelinkErrorStopSyncing","enablePhonelinkMainEntry","enablePhonelinkOobeFlow","enablePhonelinkRichTextProcessing","enablePhonelinkSms","enablePhonelinkSmsDismissUpsells","onlySkypeTokenForPhonelinkAPIsPlaywright","phonelinkSmsDCGEndpoint","phonelinkSmsDCGEndpointOverride","phonelinkSmsDCGResource"],platform:["deviceInfo","isOcdi"],presence:["createEndpointAfterTrouterConnectsDelayInMs","disableSourceEncodedMri","enableAlwaysIncludeSelfInPresenceSubscription","enableAlwaysProcessUpdatePresence","enableAnonymousRequestsFiltering","enableAvailabilityComputationInCreateEndpointWorkflow","enableCallingClientState","enableCreateEndpointAfterTrouterConnects","enableMultipleGetPresenceFix","enablePresenceServiceRetries","enableRefreshPresenceSubscriptions","enableRetrievingEndpointIdOnlyFromPresenceManager","enableSkipPresenceSyncWhileLongInactive","enableT1PresenceEtagCheck","enableUnknownPresenceAppOffline","enableUnknownPresenceFix","enableUnknownPresenceFixTest","presenceServiceMaxRetries","presenceSubscribeIntervalInMs","removePresenceDbProvider","shouldCheckMachineIdleState","updateEventBatchCacheDebounceInMs","updateEventBatchUpdatesDebounceInMs"],queues:["enableHistoricalReportingForQueuesApp","enableRealTimeStatsForQueuesApp","enableRealTimeStatsForQueuesAppOnStartUp","enableRefreshConnectionForQueuesRealTimeStats","queuesRtaSignalRServiceSettings","queuesRtaVoiceAppsServiceSettings"],search:["enablePeopleSearchV2"],serp:["enableBackButtonFixForTabSwitch","enableClientVersionHeader","groupChatSettingConfig","substrateInstrumentationClientVersion","substrateTokenUrl","teamChannelSearchConfig"],simpleCollab:["enableBizChatMetaOSSimpleCollabEntryPoint","enableChannelsFlatListViewType","enableSimpleCollabApp","enableSimpleCollabAppSplitView","enableSimpleCollabAppToggle","enableSimpleCollabConversationFolderSorting","simpleCollabAppECSOverride"],smb:["enableSmbChatZeroState","enableTenantDirectoryStateMachine","externalTopNSuggestionsCacheExpiry","tenantDirectoryCacheExpiryMinutes"],sync:["disableUserActivityReportingOnTrouterConnect","enablePrefetchUnreadMessages","messageSyncColdBootMaxCallCount","unreadMessageMaxCallCount","unreadMessageSequenceIdGapThresholdForBackwardSync","unreadMessagesBidirectionalFetchLimit"],teamsAndChannels:["allowEmailIntoChannel","eduRosterSyncIntervalInHours","enableArchiveChannel","enableAutoFavoriteChannel","enableChannelActiveCallsResolver","enableCreateTeamSimplification","enableGeneralChannelShowHide","enableLeftRailAddChannelButton","enableLegacyChannelConnectorsToWorkflows","enablePrivateAndSharedChannelUseTeamMention","enablePrivateChannelOnLWGT2","enableReactJoinTeamsGallery","enableRecommendedTeamsSync","enableRenameGeneralChannel","enableRetentionLabel","enableRosterSync","enableSensitivityLabelPrivacyValidationOptInBehavior","enableShareWithTeamSensitivityLabelEnforcementReact","enableSharedChannelLieCreation","enableStaleChannelsAdHocFlow","enableStaleChannelsBatchAPI","enableStaleChannelsFlow","enableStaleChannelsHiddenFirstOrder","enableStaleTeamsFlow","enableT2ChannelsAtMentionBadging","enableT2ChannelsBadgingAppBar","enableTeamCreateOnMainView","enableTeamsAndChannelsUserResolutionByUserDataLoader","enableUserFetchForJoinTeamGallery","enableUserOnboardingToTeam","enableUserOnboardingToTeamRecommended","enableUserResolutionForChannelModeratorList","lastTimeFavoritedPropertyBatchSize","privateChannelsOnLWGAllowedGroupsListT2","recommendedTeamsCacheIntervalInHours","rosterSyncFrequencyInHours","rosterSyncIntervalInHours","staleChannelsAdHocRunIntervalInDays","staleTeamsAbsentTotalDays","staleTeamsCalculationAdHocBatchLimit","staleTeamsCalculationAutomatedBatchLimit","staleTeamsCalculationChannelsLimit","staleTeamsCalculationTeamsLimit","staleTeamsFavoritedTotalDays","staleTeamsInactiveTotalDays","staleTeamsMinimumTotalTeams","staleTeamsRunJobInterval"],telemetry:["enableToolingSamplingRules","enableWorkerBroadcast","samplingRules","toolingSamplingRules"],test:["testAutomation"],userResources:["isSfbCloud","isSfbCloudInBVD","isSipEnabled","isSipEnabledInBVD","isTenantAdmin"],virtualConsumerEvents:["enableVirtualConsumerEvents"],whatsNew:["chatViaSms","communities5k","communitiesBeta","communitiesCreate","communityBot","contactsSync","designerInChannelAnnouncementPost","enableEntryPointPromotions","enableWhatsNew","flyoutInlineChat","flyoutV2","gamebarWidget","maxFeaturesInOverlayCount","maxValidFromDaysToBeShown","mobileDownloadQrPromo","onDemandTranslations","peopleExperience","phonelinkSms","polls","sendPostAsEmail","signInToMobile","starfieldBackgroundsPromo","togetherEmojisHighFive","togetherEmojisV2","uploadCustomBackground"],windowsSignatureExperiences:["enableGamebarWidgetWhatsNew","enableHighFiveTogetherEmojis"]}};function kH(e){switch(e){case"ag08":return n.e(427573).then(n.bind(n,426985)).then((e=>e.default));case"ag09":return n.e(529709).then(n.bind(n,965209)).then((e=>e.default));case"dod":return n.e(248735).then(n.bind(n,877421)).then((e=>e.default));case"gallatin":return n.e(693334).then(n.bind(n,238835)).then((e=>e.default));case"gcc":return n.e(324925).then(n.bind(n,556326)).then((e=>e.default));case"gcchigh":return n.e(854668).then(n.bind(n,98653)).then((e=>e.default));case"life":return n.e(872564).then(n.bind(n,807679)).then((e=>e.default));case"prod":return n.e(362376).then(n.bind(n,718605)).then((e=>e.default));case"viewportOverrides":return hH;case"clientFiltersMerge":return yH;case"clientFiltersOverride":return vH;case"policies":return fH;case"forwardCdlWorkerAllowlist":return SH;default:throw new Error(`Requested config does not exist: ${e}`)}}const CH=[{importFunc:()=>Promise.all([n.e(813382),n.e(34781),n.e(192873),n.e(934882)]).then(n.bind(n,19226)),chunkName:"data-schema"},{importFunc:()=>Promise.all([n.e(377348),n.e(112403),n.e(463781),n.e(681896),n.e(909020),n.e(591878),n.e(607784),n.e(773923),n.e(505990),n.e(120894),n.e(51724),n.e(591395),n.e(635026),n.e(130631),n.e(228737),n.e(578578),n.e(641062),n.e(379371),n.e(890962),n.e(585815),n.e(243012),n.e(474133),n.e(224284),n.e(802054)]).then(n.bind(n,923678)),chunkName:"core-essentials"},{importFunc:()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(84274),n.e(393890),n.e(773923),n.e(65537),n.e(505990),n.e(865804),n.e(152739),n.e(361845),n.e(766254),n.e(664625),n.e(457535),n.e(896201),n.e(255279),n.e(44025),n.e(551124),n.e(129609),n.e(788241),n.e(240446),n.e(95719),n.e(448808),n.e(547521),n.e(896963),n.e(604994),n.e(129462),n.e(100385),n.e(954305),n.e(565168),n.e(418198),n.e(6605),n.e(669491),n.e(128916),n.e(917359),n.e(979549),n.e(630169),n.e(390466),n.e(785695),n.e(68816),n.e(720930),n.e(928362),n.e(652421),n.e(841342),n.e(68021),n.e(429986),n.e(103554),n.e(375387),n.e(10531),n.e(73598),n.e(336048),n.e(262775),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(360134),n.e(357903),n.e(949636),n.e(281467),n.e(678342),n.e(126541),n.e(258544),n.e(253408),n.e(347076),n.e(1626),n.e(592714),n.e(408654),n.e(883971),n.e(247982),n.e(469794),n.e(196623),n.e(931153),n.e(305271)]).then(n.bind(n,499425)),chunkName:"shell-app"}];var bH=n(358050),wH=n(588641);const TH=(e,t,n)=>{const i=t[e]?.width;return{0:i?.get(wH.Rd.IS_GREATER_THAN_0)||n,947:i?.get(wH.Rd.IS_AT_LEAST_947)||n,1350:i?.get(wH.Rd.IS_AT_LEAST_1350)||n,1500:i?.get(wH.Rd.IS_AT_LEAST_1500)||n,1680:i?.get(wH.Rd.IS_AT_LEAST_1680)||n,2560:i?.get(wH.Rd.IS_AT_LEAST_2560)||n}},IH=yt.WL.CONTEXTUAL_NOTIFICATIONS,NH=yt.WL.END,EH=yt.WL.HEADER,AH=yt.WL.MAIN,_H=yt.WL.MODAL,FH=yt.WL.NOTIFICATIONS,DH=yt.WL.TITLE_BAR,PH=yt.WL.TOASTS,MH=yt.u5.LINE_LOADER,xH="minmax(0, 1fr)",RH="minmax(0, 1fr)",jH="0",LH="3.2rem",OH=[{layoutKey:bH.FU.HYER,slots:[IH,AH,_H,DH,PH],responsiveTemplates:e=>{const t=e[DH]?.height||LH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n          "${DH}            ${DH}"           ${t}\n          "${MH}          ${MH}"         ${jH}\n          "${PH}              ${AH}"               ${xH} /\n          0                       ${RH}\n        `}]}},{layoutKey:bH.FU.HYER,slots:[IH,AH,_H,PH],responsiveTemplates:[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n          "${MH}    ${MH}"         ${jH}\n          "${PH}        ${AH}"               ${xH} /\n           0                ${RH}\n        `}]},{layoutKey:bH.FU.HYER,slots:[IH,AH,_H,FH,PH],responsiveTemplates:[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${MH}          ${MH}"      ${jH}\n        "${FH}       ${FH}"   auto\n        "${PH}              ${AH}"            ${xH} /\n        0                       ${RH}\n      `}]},{layoutKey:bH.FU.HYER,slots:[IH,AH,_H,FH,DH,PH],responsiveTemplates:e=>{const t=e[DH]?.height||LH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${DH}          ${DH}"        ${t}\n        "${MH}        ${MH}"      ${jH}\n        "${FH}     ${FH}"   auto\n        "${PH}            ${AH}"            ${xH} /\n        0                     ${RH}\n      `}]}},{layoutKey:bH.FU.HYER,slots:[IH,EH,AH,_H,FH,PH],responsiveTemplates:e=>{const t=e[EH]?.height||"auto";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${MH}                  ${MH}"                 ${jH}\n        "${FH}               ${FH}"              auto\n        "${PH}                      ${EH}"                     ${t}\n        "${PH}                      ${IH}"    0\n        "${PH}                      ${AH}"                       ${xH} /\n        0                               ${RH}\n      `}]}},{layoutKey:bH.FU.HYER,slots:[IH,EH,AH,_H,PH],responsiveTemplates:e=>{const t=e[EH]?.height||"auto";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${MH}                   ${MH}"               ${jH}\n        "${PH}                       ${EH}"                   ${t}\n        "${PH}                       ${IH}"  0\n        "${PH}                       ${AH}"                     ${xH} /\n         0                               ${RH}\n      `}]}},{layoutKey:bH.FU.HYER,slots:[IH,NH,AH,_H,FH,DH,PH],responsiveTemplates:e=>{const t=e[DH]?.height||LH,n=TH(NH,e,"32rem"),i=e=>({template:`\n      "${DH}         ${DH}         ${DH}"         ${t}\n      "${MH}       ${MH}       ${MH}"       ${jH}\n      "${FH}    ${FH}    ${FH}"    auto\n      "${PH}           ${AH}             ${NH}"              ${xH} /\n       0                   ${RH}        ${e}\n    `});return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,...i(n[0])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,...i(n[947])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,...i(n[1350])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,...i(n[1500])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,...i(n[1680])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,...i(n[2560])}]}},{layoutKey:bH.FU.HYER,slots:[IH,EH,AH,_H,FH,DH,PH],responsiveTemplates:e=>{const t=e[DH]?.height||LH,n=e[EH]?.height||"auto";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${DH}            ${DH}"        ${t}\n        "${MH}          ${MH}"      ${jH}\n        "${FH}       ${FH}"   auto\n        "${PH}              ${EH}"          ${n}\n        "${PH}              ${AH}"            ${xH} /\n        0                       ${RH}\n      `}]}},{layoutKey:bH.FU.HYER,slots:[IH,NH,EH,AH,_H,FH,PH],responsiveTemplates:e=>{const t=TH(NH,e,"32rem"),n=e=>({template:`\n        "${MH}       ${MH}       ${MH}"       ${jH}\n        "${FH}    ${FH}    ${FH}"    auto\n        "${PH}           ${EH}           ${EH}"           auto\n        "${PH}           ${AH}             ${NH}"              ${xH} /\n         0                   ${RH}        ${e}\n      `});return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,...n(t[0])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,...n(t[947])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,...n(t[1350])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,...n(t[1500])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,...n(t[1680])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,...n(t[2560])}]}},{layoutKey:bH.FU.HYER,slots:[IH,NH,EH,AH,_H,FH,DH,PH],responsiveTemplates:e=>{const t=e[DH]?.height||LH,n=TH(NH,e,"32rem"),i=e=>({template:`\n        "${DH}        ${DH}         ${DH}"         ${t}\n        "${MH}      ${MH}       ${MH}"       ${jH}\n        "${FH}   ${FH}    ${FH}"    auto\n        "${PH}          ${EH}           ${EH}"           auto\n        "${PH}          ${AH}             ${NH}"              ${xH} /\n         0                  ${RH}        ${e}\n      `});return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,...i(n[0])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,...i(n[947])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,...i(n[1350])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,...i(n[1500])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,...i(n[1680])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,...i(n[2560])}]}}],$H=yt.WL.CONTEXTUAL_NOTIFICATIONS,UH=yt.WL.MAIN,BH=yt.WL.MODAL,WH=yt.WL.NOTIFICATIONS,HH=yt.WL.TOASTS,VH=yt.u5.LINE_LOADER,GH="minmax(0, 1fr)",zH="minmax(0, 1fr)",qH=[{layoutKey:bH.FU.HYER,slots:[$H,UH,BH,HH],responsiveTemplates:[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${VH} ${VH}" 0\n        "${HH}     ${UH}"       ${GH} /\n        0              ${zH}\n        `}]},{layoutKey:bH.FU.HYER,slots:[$H,UH,BH,WH,HH],responsiveTemplates:[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${VH}    ${VH}" 0\n        "${HH}        ${UH}"       ${GH} /\n        0                 ${zH}\n        `}]},{layoutKey:bH.FU.HYER,slots:[UH],responsiveTemplates:[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n        "${VH}        ${VH}" 0\n        "${HH}            ${UH}"       ${GH} /\n        0                     ${zH}\n        `}]}],JH="6.1rem",QH="4.8rem",KH="6.8rem",YH=yt.WL.CONTEXTUAL_NOTIFICATIONS,XH=yt.WL.END,ZH=yt.WL.HEADER,eV=yt.WL.MAIN,tV=yt.WL.MODAL,nV=yt.WL.MID_NAV,iV=yt.WL.NAV,aV=yt.WL.NOTIFICATIONS,oV=yt.WL.SUBNAV,rV=yt.WL.TITLE_BAR,sV=yt.WL.START,lV=yt.u5.LINE_LOADER,cV=yt.WL.TOASTS,dV="minmax(0, 1fr)",uV="minmax(0, 1fr)",mV="0",pV="0",gV=[{layoutKey:bH.FU.HYER,slots:[YH,eV,tV,aV,sV,rV,cV,ZH,iV],responsiveTemplates:e=>{const t=e[rV]?.height||QH,n=e[aV]?.height||"auto",i=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,a=e[ZH]?.height||JH,o=e[sV]?.width,r=o?.get(wH.Rd.IS_GREATER_THAN_0)||"0",s=o?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",l=o?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",c=o?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}       ${rV}         ${rV}         ${rV}"         ${t}\n            "${lV}     ${lV}       ${lV}       ${lV}"       ${pV}\n            "${aV}  ${aV}    ${aV}    ${aV}"    ${n}\n            "${cV}         ${iV}              ${ZH}           ${ZH}"           ${a}\n            "${cV}         ${iV}              ${sV}            ${eV}"             ${dV} /\n            0                  ${i}         ${r}      ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${rV}       ${rV}         ${rV}         ${rV}"         ${t}\n            "${lV}     ${lV}       ${lV}       ${lV}"       ${pV}\n            "${aV}  ${aV}    ${aV}    ${aV}"    ${n}\n            "${cV}         ${iV}              ${ZH}           ${ZH}"           ${a}\n            "${cV}         ${iV}              ${sV}            ${eV}"             ${dV} /\n            0                  ${i}         ${s}    ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${rV}       ${rV}         ${rV}         ${rV}"         ${t}\n            "${lV}     ${lV}       ${lV}       ${lV}"       ${pV}\n            "${aV}  ${aV}    ${aV}    ${aV}"    ${n}\n            "${cV}         ${iV}              ${ZH}           ${ZH} "          ${a}\n            "${cV}         ${iV}              ${sV}            ${eV}"             ${dV} /\n            0                  ${i}         ${l}   ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${rV}       ${rV}         ${rV}         ${rV}"         ${t}\n            "${lV}     ${lV}       ${lV}       ${lV}"       ${pV}\n            "${aV}  ${aV}    ${aV}    ${aV}"    ${n}\n            "${cV}         ${iV}              ${ZH}           ${ZH}"           ${a}\n            "${cV}         ${iV}              ${sV}            ${eV}"             ${dV} /\n            0                  ${i}         ${c}   ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,eV,tV,aV,cV],responsiveTemplates:e=>{const t=e[aV]?.height||"auto";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${lV}        ${lV}"       ${pV}\n            "${aV}     ${aV}"    ${t}\n            "${cV}            ${eV}"             ${dV} /\n             0                    ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,ZH,eV,tV,aV,cV],responsiveTemplates:e=>{const t=e[aV]?.height||"auto",n=e[ZH]?.height||JH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${lV}        ${lV}"       ${pV}\n            "${aV}     ${aV}"    ${t}\n            "${cV}            ${ZH}"           ${n}\n            "${cV}            ${eV}"             ${dV} /\n             0                    ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,XH,ZH,eV,tV,aV,cV],responsiveTemplates:e=>{const t=e[aV]?.height||"auto",n=e[ZH]?.height||JH,i=TH(XH,e,"32rem"),a=e=>({template:`\n        "${lV}        ${lV}        ${lV}"       ${pV}\n        "${aV}     ${aV}     ${aV}"    ${t}\n        "${cV}            ${ZH}            ${ZH}"           ${n}\n        "${cV}            ${eV}              ${XH}"              ${dV} /\n         0                    ${uV}         ${e}\n      `});return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,...a(i[0])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,...a(i[947])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,...a(i[1350])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,...a(i[1500])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,...a(i[1680])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,...a(i[2560])}]}},{layoutKey:bH.FU.HYER,slots:[YH,eV,tV,aV,rV,cV],responsiveTemplates:e=>{const t=e[aV]?.height||"auto",n=e[rV]?.height||QH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}          ${rV}"         ${n}\n            "${lV}        ${lV}"       ${pV}\n            "${aV}     ${aV}"    ${t}\n            "${cV}            ${eV}"             ${dV} /\n             0                    ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,eV,tV,iV,rV,cV],responsiveTemplates:e=>{const t=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,n=e[rV]?.height||QH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}         ${rV}      ${rV}"          ${n}\n            "${lV}       ${lV}    ${lV}"        ${pV}\n            "${cV}           ${iV}           ${eV}"              ${dV} /\n             0                   ${t}      ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,eV,tV,iV,aV,rV,cV],responsiveTemplates:e=>{const t=e[aV]?.height||"auto",n=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,i=e[rV]?.height||QH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}       ${rV}         ${rV}"         ${i}\n            "${lV}     ${lV}       ${lV}"       ${pV}\n            "${aV}  ${aV}    ${aV}"    ${t}\n            "${cV}         ${iV}              ${eV}"             ${dV} /\n             0                 ${n}         ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,ZH,eV,tV,iV,aV,rV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,a=e[rV]?.height||QH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}       ${rV}      ${rV}"         ${a}\n            "${lV}     ${lV}    ${lV}"       ${pV}\n            "${aV}  ${aV} ${aV}"    ${n}\n            "${cV}         ${iV}           ${ZH}"           ${t}\n            "${cV}         ${iV}           ${eV}"             ${dV} /\n             0                 ${i}      ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,XH,eV,tV,iV,aV,rV,cV],responsiveTemplates:e=>{const t=e[XH]?.width,n=e[aV]?.height||"auto",i=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,a=e[rV]?.height||QH,o=t?.get(wH.Rd.IS_GREATER_THAN_0)||"0",r=t?.get(wH.Rd.IS_AT_LEAST_947)||"0",s=t?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",l=t?.get(wH.Rd.IS_AT_LEAST_1500)||"32rem",c=t?.get(wH.Rd.IS_AT_LEAST_1680)||"32rem",d=t?.get(wH.Rd.IS_AT_LEAST_2560)||"32rem",u=e=>({template:`\n        "${rV}       ${rV}      ${rV}         ${rV}"         ${a}\n        "${lV}     ${lV}    ${lV}       ${lV}"       ${pV}\n        "${aV}  ${aV} ${aV}    ${aV}"    ${n}\n        "${cV}         ${iV}           ${eV}             ${XH}"              ${dV} /\n         0                 ${i}      ${uV}        ${e}"\n      `});return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,...u(o)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,...u(r)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,...u(s)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,...u(l)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,...u(c)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,...u(d)}]}},{layoutKey:bH.FU.HYER,slots:[YH,ZH,eV,tV,iV,aV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${lV}      ${lV}    ${lV}"      ${pV}\n            "${aV}  ${aV} ${aV}"    ${n}\n            "${cV}         ${iV}           ${ZH}"           ${t}\n            "${cV}         ${iV}           ${eV}"             ${dV} /\n             0                 ${i}      ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,XH,ZH,eV,tV,iV,aV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,a=e[XH]?.width,o=a?.get(wH.Rd.IS_GREATER_THAN_0)||"0",r=a?.get(wH.Rd.IS_AT_LEAST_947)||"0",s=a?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",l=a?.get(wH.Rd.IS_AT_LEAST_1500)||"32rem",c=a?.get(wH.Rd.IS_AT_LEAST_1680)||"32rem",d=a?.get(wH.Rd.IS_AT_LEAST_2560)||"32rem",u=e=>({template:`\n      "${lV}     ${lV}    ${lV}       ${lV}"       ${pV}\n      "${aV}  ${aV} ${aV}    ${aV}"    ${n}\n      "${cV}         ${iV}           ${ZH}           ${ZH}"           ${t}\n      "${cV}         ${iV}           ${eV}             ${XH}"              ${dV} /\n       0                 ${i}      ${uV}        ${e}"\n    `});return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,...u(o)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,...u(r)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,...u(s)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,...u(l)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,...u(c)},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,...u(d)}]}},{layoutKey:bH.FU.HYER,slots:[YH,XH,ZH,eV,tV,iV,aV,rV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=TH(XH,e,"32rem"),a=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,o=e[rV]?.height||QH,r=e=>({template:`\n            "${rV}         ${rV}      ${rV}         ${rV}"                 ${o}\n            "${lV}       ${lV}    ${lV}       ${lV}"               ${pV}\n            "${aV}    ${aV} ${aV}    ${aV}"            ${n}\n            "${cV}           ${iV}           ${ZH}           ${ZH}"                   ${t}\n            "${cV}           ${iV}           ${eV}             ${XH}"                      ${dV} /\n             0                   ${a}      ${uV}        ${e}\n          `});return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,...r(i[0])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,...r(i[947])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,...r(i[1350])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,...r(i[1500])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,...r(i[1680])},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,...r(i[2560])}]}},{layoutKey:bH.FU.HYER,slots:[YH,eV,tV,iV,aV,oV,rV,cV],responsiveTemplates:e=>{const t=e[aV]?.height||"auto",n=e[rV]?.height||QH,i=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,a=e[oV]?.width,o=a?.get(wH.Rd.IS_GREATER_THAN_0)||"0",r=a?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",s=a?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",l=a?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}       ${rV}      ${rV}       ${rV}"         ${n}\n            "${lV}     ${lV}    ${lV}     ${lV}"       ${pV}\n            "${aV}  ${aV} ${aV}  ${aV}"    ${t}\n            "${cV}         ${iV}           ${oV}         ${eV}"             ${dV} /\n             0                 ${i}      ${o}   ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${rV}       ${rV}      ${rV}                ${rV}"         ${n}\n            "${lV}     ${lV}    ${lV}              ${lV}"       ${pV}\n            "${aV}  ${aV} ${aV}           ${aV}"    ${t}\n            "${cV}         ${iV}           ${oV}                  ${eV}"             ${dV} /\n             0                 ${i}      ${r}          ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${rV}       ${rV}      ${rV}                ${rV}"         ${n}\n            "${lV}     ${lV}    ${lV}              ${lV}"       ${pV}\n            "${aV}  ${aV} ${aV}           ${aV}"    ${t}\n            "${cV}         ${iV}           ${oV}                  ${eV}"             ${dV} /\n             0                 ${i}      ${s}         ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${rV}      ${rV}      ${rV}                 ${rV}"         ${n}\n            "${lV}    ${lV}    ${lV}               ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}            ${aV}"    ${t}\n            "${cV}        ${iV}           ${oV}                   ${eV}"             ${dV} /\n             0                ${i}      ${l}          ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,ZH,eV,tV,nV,iV,aV,oV,rV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=e[rV]?.height||QH,a=e[oV]?.width,o=e[nV]?.width,r=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,s=a?.get(wH.Rd.IS_GREATER_THAN_0)||"0",l=a?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",c=a?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",d=a?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem",u=o?.get(wH.Rd.IS_GREATER_THAN_0)||"0",m=o?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",p=o?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",g=a?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}       ${rV}          ${rV}         ${rV}          ${rV}"                ${i}\n            "${lV}     ${lV}        ${lV}       ${lV}        ${lV}"              ${pV}\n            "${aV}  ${aV}     ${aV}    ${aV}     ${aV}"           ${n}\n            "${cV}         ${iV}               ${nV}           ${oV}            ${ZH}"                  ${t}\n            "${cV}         ${iV}               ${nV}           ${oV}            ${YH}" ${mV}\n            "${cV}         ${iV}               ${nV}           ${oV}            ${eV}"                    ${dV} /\n             0                 ${r}          ${u}     ${s}      ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${rV}      ${rV}           ${rV}          ${rV}              ${rV}"                  ${i}\n            "${lV}    ${lV}         ${lV}        ${lV}            ${lV}"                ${pV}\n            "${aV} ${aV}      ${aV}     ${aV}         ${aV}"             ${n}\n            "${cV}        ${iV}                ${nV}            ${oV}                ${ZH}"                    ${t}\n            "${cV}        ${iV}                ${nV}            ${oV}                ${YH}"   ${mV}\n            "${cV}        ${iV}                ${nV}            ${oV}                ${eV}"                      ${dV} /\n             0                ${r}           ${m}    ${l}        ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${rV}      ${rV}           ${rV}           ${rV}              ${rV}"                  ${i}\n            "${lV}    ${lV}         ${lV}         ${lV}            ${lV}"                ${pV}\n            "${aV} ${aV}      ${aV}      ${aV}         ${aV}"             ${n}\n            "${cV}        ${iV}                ${nV}             ${oV}                ${ZH}"                    ${t}\n            "${cV}        ${iV}                ${nV}             ${oV}                ${YH}"   ${mV}\n            "${cV}        ${iV}                ${nV}             ${oV}                ${eV}"                      ${dV} /\n             0                ${r}           ${p}    ${c}       ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${rV}      ${rV}           ${rV}           ${rV}                ${rV}"                  ${i}\n            "${lV}    ${lV}         ${lV}         ${lV}              ${lV}"                ${pV}\n            "${aV} ${aV}      ${aV}      ${aV}           ${aV}"             ${n}\n            "${cV}        ${iV}                ${nV}             ${oV}                  ${ZH}"                    ${t}\n            "${cV}        ${iV}                ${nV}             ${oV}                  ${YH}"   ${mV}\n            "${cV}        ${iV}                ${nV}             ${oV}                  ${eV}"                      ${dV} /\n             0                ${r}           ${g}    ${d}         ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,eV,tV,nV,iV,aV,oV,rV,cV],responsiveTemplates:e=>{const t=e[aV]?.height||"auto",n=e[rV]?.height||QH,i=e[oV]?.width,a=e[nV]?.width,o=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,r=i?.get(wH.Rd.IS_GREATER_THAN_0)||"0",s=i?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",l=i?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",c=i?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem",d=a?.get(wH.Rd.IS_GREATER_THAN_0)||"0",u=a?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",m=a?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",p=i?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}       ${rV}      ${rV}         ${rV}          ${rV}"                ${n}\n            "${lV}     ${lV}    ${lV}       ${lV}        ${lV}"              ${pV}\n            "${aV}  ${aV} ${aV}    ${aV}     ${aV}"           ${t}\n            "${cV}         ${iV}           ${nV}           ${oV}            ${YH}" ${mV}\n            "${cV}         ${iV}           ${nV}           ${oV}            ${eV}"                    ${dV} /\n             0                 ${o}      ${d}     ${r}      ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${rV}      ${rV}         ${rV}           ${rV}             ${rV}"                  ${n}\n            "${lV}    ${lV}       ${lV}         ${lV}           ${lV}"                ${pV}\n            "${aV} ${aV}    ${aV}      ${aV}        ${aV}"             ${t}\n            "${cV}        ${iV}              ${nV}             ${oV}               ${YH}"   ${mV}\n            "${cV}        ${iV}              ${nV}             ${oV}               ${eV}"                      ${dV} /\n             0                ${o}         ${u}     ${s}       ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${rV}      ${rV}          ${rV}           ${rV}              ${rV}"                  ${n}\n            "${lV}    ${lV}        ${lV}         ${lV}            ${lV}"                ${pV}\n            "${aV} ${aV}     ${aV}      ${aV}         ${aV}"             ${t}\n            "${cV}        ${iV}               ${nV}             ${oV}                ${YH}"   ${mV}\n            "${cV}        ${iV}               ${nV}             ${oV}                ${eV}"                      ${dV} /\n             0                ${o}          ${m}    ${l}       ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${rV}      ${rV}           ${rV}           ${rV}               ${rV}"                  ${n}\n            "${lV}    ${lV}         ${lV}         ${lV}             ${lV}"                ${pV}\n            "${aV} ${aV}      ${aV}      ${aV}          ${aV}"             ${t}\n            "${cV}        ${iV}                ${nV}             ${oV}                 ${YH}"   ${mV}\n            "${cV}        ${iV}                ${nV}             ${oV}                 ${eV}"                      ${dV} /\n             0                ${o}           ${p}    ${c}        ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,ZH,eV,tV,iV,aV,oV,rV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=e[rV]?.height||QH,a=e[oV]?.width,o=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,r=a?.get(wH.Rd.IS_GREATER_THAN_0)||"0",s=a?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",l=a?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",c=a?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}       ${rV}      ${rV}       ${rV}"                ${i}\n            "${lV}     ${lV}    ${lV}     ${lV}"              ${pV}\n            "${aV}  ${aV} ${aV}  ${aV}"           ${n}\n            "${cV}         ${iV}           ${oV}         ${ZH}"                  ${t}\n            "${cV}         ${iV}           ${oV}         ${YH}" ${mV}\n            "${cV}         ${iV}           ${oV}         ${eV}"                    ${dV} /\n             0                 ${o}      ${r}   ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}"                  ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}"                ${pV}\n            "${aV} ${aV} ${aV}           ${aV}"             ${n}\n            "${cV}        ${iV}           ${oV}                  ${ZH}"                    ${t}\n            "${cV}        ${iV}           ${oV}                  ${YH}"   ${mV}\n            "${cV}        ${iV}           ${oV}                  ${eV}"                      ${dV} /\n             0                ${o}      ${s}          ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}"                  ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}"                ${pV}\n            "${aV} ${aV} ${aV}           ${aV}"             ${n}\n            "${cV}        ${iV}           ${oV}                  ${ZH}"                    ${t}\n            "${cV}        ${iV}           ${oV}                  ${YH}"   ${mV}\n            "${cV}        ${iV}           ${oV}                  ${eV}"                      ${dV} /\n             0                ${o}      ${l}         ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}"                  ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}"                ${pV}\n            "${aV} ${aV} ${aV}           ${aV}"             ${n}\n            "${cV}        ${iV}           ${oV}                  ${ZH}"                    ${t}\n            "${cV}        ${iV}           ${oV}                  ${YH}"   ${mV}\n            "${cV}        ${iV}           ${oV}                  ${eV}"                      ${dV} /\n             0                ${o}      ${c}         ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,ZH,eV,tV,iV,aV,oV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=e[oV]?.width,a=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,o=i?.get(wH.Rd.IS_GREATER_THAN_0)||"0",r=i?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",s=i?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",l=i?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${lV}     ${lV}    ${lV}     ${lV}"              ${pV}\n            "${aV}  ${aV} ${aV}  ${aV}"           ${n}\n            "${cV}         ${iV}           ${oV}         ${ZH}"                  ${t}\n            "${cV}         ${iV}           ${oV}         ${YH}" ${mV}\n            "${cV}         ${iV}           ${oV}         ${eV}"                    ${dV} /\n             0                 ${a}      ${o}   ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${lV}    ${lV}    ${lV}              ${lV}"                ${pV}\n            "${aV} ${aV} ${aV}           ${aV}"             ${n}\n            "${cV}        ${iV}           ${oV}                  ${ZH}"                    ${t}\n            "${cV}        ${iV}           ${oV}                  ${YH}"   ${mV}\n            "${cV}        ${iV}           ${oV}                  ${eV}"                      ${dV} /\n             0                ${a}      ${r}          ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${lV}    ${lV}    ${lV}              ${lV}"                ${pV}\n            "${aV} ${aV} ${aV}           ${aV}"             ${n}\n            "${cV}        ${iV}           ${oV}                  ${ZH}"                    ${t}\n            "${cV}        ${iV}           ${oV}                  ${YH}"   ${mV}\n            "${cV}        ${iV}           ${oV}                  ${eV}"                      ${dV} /\n             0                ${a}      ${s}         ${uV}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${lV}    ${lV}    ${lV}              ${lV}"                ${pV}\n            "${aV} ${aV} ${aV}           ${aV}"             ${n}\n            "${cV}        ${iV}           ${oV}                  ${ZH}"                    ${t}\n            "${cV}        ${iV}           ${oV}                  ${YH}"   ${mV}\n            "${cV}        ${iV}           ${oV}                  ${eV}"                      ${dV} /\n             0                ${a}      ${l}         ${uV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,XH,eV,tV,iV,aV,oV,rV,cV],responsiveTemplates:e=>{const t=e[XH]?.width,n=e[aV]?.height||"auto",i=e[rV]?.height||QH,a=e[oV]?.width,o=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,r=t?.get(wH.Rd.IS_GREATER_THAN_0)||"0",s=t?.get(wH.Rd.IS_AT_LEAST_947)||"0",l=t?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",c=t?.get(wH.Rd.IS_AT_LEAST_1500)||"32rem",d=t?.get(wH.Rd.IS_AT_LEAST_1680)||"32rem",u=t?.get(wH.Rd.IS_AT_LEAST_2560)||"32rem",m=a?.get(wH.Rd.IS_GREATER_THAN_0)||"0",p=a?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",g=a?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",h=a?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}      ${rV}      ${rV}      ${rV}         ${rV}"         ${i}\n            "${lV}    ${lV}    ${lV}    ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV} ${aV}    ${aV}"    ${n}\n            "${cV}        ${iV}           ${oV}        ${eV}             ${XH}"              ${dV} /\n             0                ${o}      ${m}  ${uV}        ${r}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}         ${rV}"         ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n            "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n             0                ${o}      ${p}          ${uV}        ${s}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}         ${rV}"         ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n            "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n             0                ${o}      ${g}         ${uV}        ${l}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}         ${rV}"         ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n            "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n             0                ${o}      ${h}         ${uV}        ${c}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}         ${rV}"         ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n            "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n             0                ${o}      ${h}         ${uV}        ${d}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}         ${rV}"         ${i}\n            "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n            "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n             0                ${o}      ${h}         ${uV}        ${u}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,XH,ZH,eV,tV,iV,aV,oV,cV],responsiveTemplates:e=>{const t=e[ZH]?.height||JH,n=e[aV]?.height||"auto",i=e[oV]?.width,a=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,o=e[XH]?.width,r=o?.get(wH.Rd.IS_GREATER_THAN_0)||"0",s=o?.get(wH.Rd.IS_AT_LEAST_947)||"0",l=o?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",c=o?.get(wH.Rd.IS_AT_LEAST_1500)||"32rem",d=o?.get(wH.Rd.IS_AT_LEAST_1680)||"32rem",u=o?.get(wH.Rd.IS_AT_LEAST_2560)||"32rem",m=i?.get(wH.Rd.IS_GREATER_THAN_0)||"0",p=i?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",g=i?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",h=i?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${lV}    ${lV}    ${lV}    ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV} ${aV}    ${aV}"    ${n}\n            "${ZH}        ${ZH}        ${ZH}        ${ZH}           ${ZH}"           ${t}\n            "${cV}        ${iV}           ${oV}        ${eV}             ${XH}"              ${dV} /\n             0                ${a}      ${m}  ${uV}        ${r}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n          "${lV}      ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n          "${aV}   ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n          "${ZH}          ${ZH}        ${ZH}                  ${ZH}           ${ZH}"           ${t}\n          "${cV}          ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n           0                  ${a}      ${p}          ${uV}        ${s}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n          "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n          "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n          "${ZH}        ${ZH}        ${ZH}                  ${ZH}           ${ZH}"           ${t}\n          "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n           0                ${a}      ${g}         ${uV}        ${l}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n          "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n          "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n          "${ZH}        ${ZH}        ${ZH}                  ${ZH}           ${ZH}"           ${t}\n          "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n           0                ${a}      ${h}         ${uV}        ${c}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,template:`\n          "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n          "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n          "${ZH}        ${ZH}        ${ZH}                  ${ZH}           ${ZH}"           ${t}\n          "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n           0                ${a}      ${h}         ${uV}        ${d}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,template:`\n          "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n          "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${n}\n          "${ZH}        ${ZH}        ${ZH}                  ${ZH}           ${ZH}"           ${t}\n          "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n           0                ${a}      ${h}         ${uV}        ${u}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[YH,XH,ZH,eV,tV,iV,aV,oV,rV,cV],responsiveTemplates:e=>{const t=e[XH]?.width,n=e[ZH]?.height||JH,i=e[aV]?.height||"auto",a=e[rV]?.height||QH,o=e[oV]?.width,r=e[iV]?.width?.get(wH.Rd.IS_GREATER_THAN_0)||KH,s=o?.get(wH.Rd.IS_GREATER_THAN_0)||"0",l=o?.get(wH.Rd.IS_AT_LEAST_947)||"28rem",c=o?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",d=o?.get(wH.Rd.IS_AT_LEAST_1500)||"36rem",u=t?.get(wH.Rd.IS_GREATER_THAN_0)||"0",m=t?.get(wH.Rd.IS_AT_LEAST_947)||"0",p=t?.get(wH.Rd.IS_AT_LEAST_1350)||"32rem",g=t?.get(wH.Rd.IS_AT_LEAST_1500)||"32rem",h=t?.get(wH.Rd.IS_AT_LEAST_1680)||"32rem",y=t?.get(wH.Rd.IS_AT_LEAST_2560)||"32rem";return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n            "${rV}         ${rV}      ${rV}         ${rV}         ${rV}"         ${a}\n            "${lV}       ${lV}    ${lV}       ${lV}       ${lV}"       ${pV}\n            "${aV}    ${aV} ${aV}    ${aV}    ${aV}"    ${i}\n            "${cV}           ${iV}           ${oV}           ${ZH}           ${ZH}"           ${n}\n            "${cV}           ${iV}           ${oV}           ${eV}             ${XH}"              ${dV} /\n             0                   ${r}      ${s}     ${uV}        ${u}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_947,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}         ${rV}"         ${a}\n            "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${i}\n            "${cV}        ${iV}           ${oV}                  ${ZH}           ${ZH}"           ${n}\n            "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n             0                ${r}      ${l}          ${uV}        ${m}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1350,template:`\n            "${rV}      ${rV}      ${rV}                ${rV}         ${rV}"         ${a}\n            "${lV}    ${lV}    ${lV}              ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}           ${aV}    ${aV}"    ${i}\n            "${cV}        ${iV}           ${oV}                  ${ZH}           ${ZH}"           ${n}\n            "${cV}        ${iV}           ${oV}                  ${eV}             ${XH}"              ${dV} /\n             0                ${r}      ${c}         ${uV}        ${p}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1500,template:`\n            "${rV}      ${rV}      ${rV}               ${rV}         ${rV}"         ${a}\n            "${lV}    ${lV}    ${lV}             ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}          ${aV}    ${aV}"    ${i}\n            "${cV}        ${iV}           ${oV}                 ${ZH}           ${ZH}"           ${n}\n            "${cV}        ${iV}           ${oV}                 ${eV}             ${XH}"              ${dV} /\n             0                ${r}      ${d}        ${uV}        ${g}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_1680,template:`\n            "${rV}      ${rV}      ${rV}               ${rV}         ${rV}"         ${a}\n            "${lV}    ${lV}    ${lV}             ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}          ${aV}    ${aV}"    ${i}\n            "${cV}        ${iV}           ${oV}                 ${ZH}           ${ZH}"           ${n}\n            "${cV}        ${iV}           ${oV}                 ${eV}             ${XH}"              ${dV} /\n             0                ${r}      ${d}        ${uV}        ${h}\n          `},{minWidthBreakpoint:wH.Rd.IS_AT_LEAST_2560,template:`\n            "${rV}      ${rV}      ${rV}               ${rV}         ${rV}"         ${a}\n            "${lV}    ${lV}    ${lV}             ${lV}       ${lV}"       ${pV}\n            "${aV} ${aV} ${aV}          ${aV}    ${aV}"    ${i}\n            "${cV}        ${iV}           ${oV}                 ${ZH}           ${ZH}"           ${n}\n            "${cV}        ${iV}           ${oV}                 ${eV}             ${XH}"              ${dV} /\n             0                ${r}      ${d}        ${uV}        ${y}\n          `}]}}],hV=yt.WL.CONTEXTUAL_NOTIFICATIONS,yV=yt.WL.MAIN,vV=yt.WL.MODAL,fV=yt.WL.NOTIFICATIONS,SV=yt.WL.TOASTS,kV=yt.WL.TITLE_BAR,CV=yt.u5.LINE_LOADER,bV="minmax(0, 1fr)",wV="minmax(0, 1fr)",TV="4.8rem",IV=[{layoutKey:bH.FU.HYER,slots:[hV,yV,vV,kV,SV],responsiveTemplates:e=>{const t=e[kV]?.height||TV;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n          "${kV}        ${kV}"    ${t}   \n          "${CV}      ${CV}"  0       \n          "${SV}          ${yV}"        ${bV} /\n           0                  ${wV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[hV,yV,vV,fV,kV,SV],responsiveTemplates:e=>{const t=e[kV]?.height||TV;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n          "${kV}        ${kV}"   ${t}          \n          "${CV}      ${CV}" 0\n          "${SV}          ${yV}"       ${bV} /\n           0                  ${wV}\n          `}]}},{layoutKey:bH.FU.HYER,slots:[yV,kV],responsiveTemplates:e=>{const t=e[kV]?.height||TV;return[{minWidthBreakpoint:wH.Rd.IS_GREATER_THAN_0,template:`\n          "${kV}        ${kV}"        ${t}\n          "${CV}      ${CV}"      0\n          "${SV}          ${yV}"            ${bV} /\n           0                  ${wV}    \n          `}]}}];function NV({layoutKey:e,layoutMode:t}){const n={[ke.lO.focus]:OH,[ke.lO.minimal]:qH,[ke.lO.standard]:gV,[ke.lO.minimode]:IV};return new bH.ZG({layoutKey:e,layoutMode:t,layoutTemplatesPerLayoutMode:n})}var EV=n(871799),AV=n(706827),_V=n(515719),FV=n(650411),DV=n(671491);const PV=({environment:e,theme:t,cspNonce:n,publicPathScript:i,containerVer:a,viewportContext:o})=>{const{favicons:r}=EV.L;return AV({htmlWebpackPlugin:{options:{containerVer:a,publicPathScript:i,cspNonce:n,theme:t,viewportContext:o,partials:{favicons:r(),themeStyles:_V(),titleBar:o===st.R.flyout?void 0:FV({environment:e}),titleBarStyles:o===st.R.flyout?void 0:DV()}},files:{}}})};var MV=n(69841),xV=n(649680);const RV=({action:e,appRenderMode:t,coreSettings:n})=>{const i=new MV.H,{criticalPhaseTimeout:a,postCriticalPhaseTimeout:o,enableRenderingOrder:r}=n.get(b.J.Activity),s=[];switch(t){case Mt.S.Rail:r?(s.push(xV.G.FEED_LIST_ITEMS_RENDERED),s.push(xV.G.FEED_ITEM_NAVIGATION)):s.push(xV.G.VIRTUAL_LIST_RENDER_BUFFER_FILLED);case Mt.S.Main:e===Se.uk.empty&&s.push(xV.G.NO_FEED_GRAPHICS_RENDERED)}return i.registerAppPhase({phase:yt.nh.CRITICAL,signals:s,timeout:a||6e4}),i.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:[],timeout:o||12e4}),i.appPhases},jV={id:"com.microsoft.teams.activity",name:"Activity",getLocalizedName:async e=>(await e.waitForNamespace("activity"),e.stringTranslate("activity","activity_app_name")),actors:[bO],supportedEntities:[Se.py.activity,Se.py.notificationsettingsdefault,Se.py.activityinapptoastundo,Se.py.activityslicecontent,Se.py.activityslices],supportedRenderModes:[Mt.S.Main,Mt.S.Rail,Mt.S.Modal],getDefaultCommand:()=>({type:Se.py.activity,action:Se.uk.default}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20},shouldDeferNavigationToMainSlotApp:!0},LV=e=>{if(OV(e))return $V(e)?{subNavEntity:UV(e),headerEntity:BV(e),startEntity:WV(e),mainEntity:HV(e),endEntity:GV(e),midNavEntity:VV(e)}:null},OV=({layoutMode:e,entity:t,coreSettings:n})=>{const{action:i=null,type:a}={...t},o=[ke.lO.standard].includes(e),r=[Se.uk.list,Se.uk.default,Se.uk.empty].includes(i),s=n?.get(b.J.Activity).enableActivitySlices??!1,l=[Se.py.activity];s&&l.push(Se.py.activityslices,Se.py.activityslicecontent);const c=l.includes(a);return!!(o&&c&&r)},$V=()=>!0,UV=({entity:e})=>e,BV=({entity:e,contextEntity:t})=>qV(e,t),WV=()=>null,HV=({entity:e,contextEntity:t})=>{const{action:n=null}={...e};return n&&n===Se.uk.empty?{...e,action:n}:qV(e,t)},VV=({coreSettings:e,entity:t})=>e?.get(b.J.Activity).enableActivitySlices??!1?{...t,type:Se.py.activityslicecontent}:null,GV=()=>null,zV=({areEmptySlotsTransparent:e,coreSettings:t})=>{const n=t?.get(b.J.Platform).deviceInfo,i=n&&(0,Lx.Y)(n),a=!!t?.get(b.J.Core).enableTransparentLeftRail;return{subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!i&&(a||e),isColorSchemeDefaultBackground3:!e,isWideSubNav:!!t?.get(b.J.MercuryDesign).enableMercuryDesign}}}},qV=(e,t)=>t&&(e=>e&&e.type===Se.py.activity&&e.action===Se.uk.default)(e)?{...t,linkedEntity:null}:null,JV=e=>H.RG.ActivitySwitch,QV=e=>e.command.stateTransition===ke.su.flow?H.RG.ActivitySwitch:void 0,KV={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==Se.py.activity,shouldRestoreClientToEntities:e=>e.subNavEntity?.type!==Se.py.activity};var YV=n(158425);const XV="entitymoreinfo",ZV="requestPersonMoreInfo",eG="requestPersonMoreOrgInfo",tG="requestTopicMoreInfo",nG=e=>({actor:XV,action:ZV,data:e}),iG=e=>({actor:XV,action:eG,data:e}),aG=e=>({actor:XV,action:tG,data:e}),oG={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}};var rG=n(988917),sG=n(123901),lG=n(591518),cG=n(636355);const dG=e=>({visibilityState:ke.fe.show,stateTransition:e,correlation:{source:C.D.AppBar}}),uG=e=>({id:e,action:Se.uk.default,type:Se.py.activity}),mG=e=>({entity:uG(e),command:dG(ke.su.flush)}),pG="ActivityEarlyFirstPageFetch",gG=(e,t,n)=>{const i=e?.edges[0]?.node;if(!i)return n.log("Top feed unavailable, cannot intercept command"),null;const{activityNavigationParams:a}=i;let o=!1,r=null;const s=t.executionContext.viewEntities.mainEntity?.type;if(a.navigationTarget===si.m$.chat)o=s===Se.py.chats,r=(({messageId:e,threadId:t},n,i)=>{if(!t)throw(0,de.Tr)(pG,h.jK.MissingParameter,"getInterceptedChatCommand");const a=n.client?.ctx?.entityCommanding?.chat;if(!a)throw i.error("Did not find activityCommanding"),(0,de.Tr)(pG,h.jK.NotPresent,"getInterceptedChatCommand");const o=a.getChatByIdCommand(t,{entityOptions:{focusOnLoad:ri.t.DoNotMove,messageId:e}});if(!o)return i.error("Chat commanding did not return a command"),null;const{entity:r,entityOptions:s}=o;return{entity:{...r,linkedEntity:uG(rG.F4.noNavOnSameMainEntity)},command:dG(ke.su.forceFlush),entityOptions:s}})(a,t,n),n.log(`Top feed mainEntity: chat, previousMainEntity: ${s}`);return null===r?null:o?r:mG(rG.F4.navOnDifferentMainEntity)},hG=async({commandInput:e,requestContext:t})=>{const{command:{action:n}}=e,i=t.loggerFactory.newLogger("ActivityApp onCommandReceived","apps-activity");if(e.command.actor!==bO)return void i.error(`Command for actor '${e.command.actor}' cannot be handled by ActivityApp.`);const a=t?.coreSettings?.get(b.J.Activity).enableActivitySlices;if(n===wO){if(a)return yG();const e={entity:{id:rG.F4.navWithoutEarlyFetch,type:Se.py.activity,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.AppBar}}};return await vG(t,i)??e}i.error(`Command action '${n}' is not supported at ActivityApp.`)},yG=async()=>({entity:{id:sG.J.navWithoutEarlyFetch,type:Se.py.activityslices,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.AppBar}}}),vG=async(e,t)=>{const n=e.scenarioFactory.findScenario(H.RG.ActivitySwitch);if(n&&!e.executionContext.isHandlingAppActiveApp&&e.coreSettings.get(b.J.Activity).enableEarlyFirstPageFetch){if(!fG(e,t))return null;n.mark(H.ck.CDLEarlyFetchStart);const i=await SG(e,n,t);if(n.mark(H.ck.CDLEarlyFetchEnd),i){const e=CG(i);return lG.c.appendFeedDataBag(t,n,{earlyFetchNavType:e}),t.log(`Early fetch succesful load type: ${e}`),i}}return null},fG=(e,t)=>{const n=e.executionContext.viewEntities.mainEntity?.type,i=n===Se.py.chats;return i||t.log(`Early fetch for entity ${n} not supported`),i},SG=async(e,t,n)=>{try{const{earlyFirstPageFetchWaitTimeout:i,paginationFirstLoad:a,enableAvatarUrlResolutionInActivityFeeds:o}=e.coreSettings.get(b.J.Activity),r=Date.now(),{data:{activities:s}}=await(0,V.E)(e.client.query({query:cG.I,variables:{first:a??rG.ch,isFirstPage:!0,filters:{feedTypes:[]},enableAvatarUrlResolutionInActivityFeeds:!!o},fetchPolicy:"network-only"}),i??rG.LI),l=Date.now()-r;return lG.c.appendFeedDataBag(n,t,{earlyFetchWorkerResponseTime:l}),s?kG(s,e,t,n)??mG(rG.F4.navOnEarlyFetch):(n.warn("Did not find activities in CDL response"),null)}catch(e){const i=(0,de.qZ)(e);return lG.c.appendFeedDataBag(n,t,{earlyFetchErrorCode:i}),n.error(`Early first page fetch failed with code ${i}`),null}},kG=(e,t,n,i)=>{try{return gG(e,t,i)}catch(e){const t=(0,de.qZ)(e);return lG.c.appendFeedDataBag(i,n,{earlyFetchErrorCode:t}),i.error(`Early fetch command interception failed with code ${t}`),null}},CG=e=>e.entity.linkedEntity?.id??e.entity.id??"unknown";var bG=n(62996);const wG=async e=>{const{entityCommand:{entity:{type:t,action:n},command:{visibilityState:i}},requestContext:{loggerFactory:a,coreSettings:o}}=e,{enableActivityAppCommandResultHook:r}=o.get(b.J.Activity);if(!r)return;const s=a.newLogger("ActivityApp[onCommandResult]","apps-activity");if(t!==Se.py.activity&&n===Se.uk.view&&(s.log(`Windowing command with visibilityState: ${i}`),i===ke.fe.show)){const t=e.entityCommand.metadata?.deepLink;if(t){const n=new URL(t),i=new URLSearchParams(n.search).get("activityId")||"",a=e.requestContext.client;return TG(s,a,i)}s.warn("Deeplink Url not present")}},TG=async(e,t,n)=>{e.log(`Marking activity activityId=${n} as read`);try{if(!n)return void e.warn(`Could not mark activity as read: activityId: ${n}`);await t.mutate({mutation:bG.e,variables:{id:n,isRead:!0}})}catch(t){e.errorToTelemetry?.(`mark activity as read failed: activityId ${n} failed`,"feeds_mark_as_read_failed",void 0,!0)}};var IG;!function(e){e.ActivityApp="activity-app",e.ActivityFeedDialogs="activity-feed-dialogs",e.ActivityMainPane="activity-main-pane",e.SlicesActivityApp="slices-activity-app",e.SlicesActivitySubNav="slices-activity-sub-nav"}(IG||(IG={}));const NG=()=>Promise.all([n.e(187946),n.e(182149),n.e(586535),n.e(865804),n.e(88373),n.e(612377),n.e(233171),n.e(63770),n.e(378236),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(636873),n.e(474133),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(123513),n.e(998264),n.e(735313),n.e(126541),n.e(258544),n.e(963461),n.e(34671),n.e(638108),n.e(802909),n.e(579320)]).then(n.bind(n,524121)),EG=()=>Promise.all([n.e(909176),n.e(261148)]).then(n.bind(n,396604)),AG=()=>Promise.all([n.e(187946),n.e(182149),n.e(586535),n.e(865804),n.e(88373),n.e(612377),n.e(438152),n.e(233171),n.e(63770),n.e(378236),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(636873),n.e(474133),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(123513),n.e(998264),n.e(735313),n.e(126541),n.e(258544),n.e(963461),n.e(34671),n.e(638108),n.e(802909),n.e(369829),n.e(855798)]).then(n.bind(n,365117)),_G=()=>null,FG=async(e,t,n,i)=>{switch(t("ChunkLoadStarted",{chunkName:e}),e){case IG.ActivityApp:const{ActivityViewsRenderer:a}=await(0,ac.mT)(NG,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(a,{coreSettings:i});case IG.SlicesActivityApp:const{SlicesViewsRenderer:o}=await(0,ac.mT)(AG,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(o,{});case IG.SlicesActivitySubNav:const{SlicesActivityViewsRenderer:r}=await(0,ac.mT)(AG,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(r,{coreSettings:i});case IG.ActivityFeedDialogs:const{ActivityDialogViewsRenderer:s}=await(0,ac.mT)(EG,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(s,{});case IG.ActivityMainPane:const{ActivityMainPane:l}=await(0,ac.mT)(NG,e,n);return t("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(l,{});default:return(0,gO.t)(_G,{})}};var DG=n(751701),PG=n(689427),MG=n(210048),xG=n(374541),RG=n(286512),jG=n(211330),LG=n(226169),OG=n(326938),$G=n(157210),UG=n(634333),BG=n(696618);const WG=(0,BG.s)({dialogSurface:{B2u0y6b:"fvgz9i8",Bqenvij:"fu2thx1",z8tnut:"f1jfh9s1",z189sj:["f15kemlc","fdgang7"],Byoj8tv:"fl2zwns",uwmqm3:["fdgang7","f15kemlc"]},dialogTitle:{a9b677:"f4cn2hj",B6of3ja:"f1xdg43u"},dialogSubTitle:{a9b677:"fl6va0v",B6of3ja:"f7w72kx"},dialogContent:{mc9l5x:"f22iagw",Beiy3e4:"f1vx9l62",B6of3ja:"f2zxqi"},dialogContentRow:{mc9l5x:"f22iagw",Beiy3e4:"f1063pyq",B6of3ja:"f1xdg43u",Bt984gj:"f122n59",Brf1p80:"f1869bpl"},dropdown:{a9b677:"f1hp80ii"},dropdownLabel:{a9b677:"f19i1hda"},dialogActions:{a9b677:"fly5x3f",B6of3ja:"f109tmk6"},dialogActionsRow:{mc9l5x:"f22iagw",Beiy3e4:"f1063pyq",Bt984gj:"f122n59",a9b677:"fly5x3f"},dialogActionButtons:{a9b677:"f1kyr2gn",Frg6f3:["ff9s3yw","f1phki43"]},dialogActionLink:{a9b677:"f1fay27e"},dialogActionButtonGroup:{mc9l5x:"f22iagw",Beiy3e4:"f1063pyq",Frg6f3:["fcgxt0o","f1ujusj6"]}},{d:[".fvgz9i8{max-width:600px;}",".fu2thx1{height:386px;}",".f1jfh9s1{padding-top:28px;}",".f15kemlc{padding-right:24px;}",".fdgang7{padding-left:24px;}",".fl2zwns{padding-bottom:24px;}",".f4cn2hj{width:321px;}",".f1xdg43u{margin-top:12px;}",".fl6va0v{width:415px;}",".f7w72kx{margin-top:20px;}",".f22iagw{display:flex;}",".f1vx9l62{flex-direction:column;}",".f2zxqi{margin-top:8px;}",".f1063pyq{flex-direction:row;}",".f122n59{align-items:center;}",".f1869bpl{justify-content:space-between;}",".f1hp80ii{width:280px;}",".f19i1hda{width:230px;}",".fly5x3f{width:100%;}",".f109tmk6{margin-top:34px;}",".f1kyr2gn{width:96px;}",".ff9s3yw{margin-left:8px;}",".f1phki43{margin-right:8px;}",".f1fay27e{width:158px;}",".fcgxt0o{margin-left:auto;}",".f1ujusj6{margin-right:auto;}"]}),HG=()=>{const[e,t]=hO.useState(!0),n=WG(),i=hO.useCallback(((e,n)=>{t(n.open)}),[]);return(0,gO.t)(MG.V,{open:e,onOpenChange:i,children:(0,gO.t)(xG.c,{className:n.dialogSurface,children:(0,gO.t)(RG.a,{children:[(0,gO.t)(jG.$,{children:(0,gO.t)($G.O,{animation:"pulse",children:[(0,gO.t)(UG.j,{size:20,className:n.dialogTitle,"data-testid":"shape"}),(0,gO.t)(UG.j,{size:12,className:n.dialogSubTitle,"data-testid":"shape"})]})}),(0,gO.t)(LG.c,{className:n.dialogContent,children:(0,gO.t)($G.O,{animation:"pulse",children:[...Array(4)].map(((e,t)=>(0,gO.t)("div",{className:n.dialogContentRow,children:[(0,gO.t)(UG.j,{size:12,className:n.dropdownLabel,"data-testid":"shape"}),(0,gO.t)(UG.j,{size:32,className:n.dropdown,"data-testid":"shape"})]},t)))})}),(0,gO.t)(OG.k,{fluid:!0,className:n.dialogActions,children:(0,gO.t)($G.O,{animation:"pulse",className:n.dialogActionsRow,children:[(0,gO.t)(UG.j,{size:12,className:n.dialogActionLink,"data-testid":"shape"}),(0,gO.t)("div",{className:n.dialogActionButtonGroup,children:[...Array(2)].map(((e,t)=>(0,gO.t)(UG.j,{size:32,className:n.dialogActionButtons,"data-testid":"shape"},t)))})]})})]})})})},VG=()=>Promise.all([n.e(65537),n.e(699725),n.e(466470)]).then(n.bind(n,929703)),GG=e=>(0,gO.t)(PG.S,{loggerName:"LazyNotificationSettingsRecommendationDialogEntityView",children:(0,gO.t)(DG.o,{factory:VG,props:e,fallback:(0,gO.t)(HG,{})})});GG.displayName="LazyNotificationSettingsRecommendationDialogEntityView";var zG=n(996181),qG=n(364565);const JG=async e=>{const{entityCommand:t}=e,{entity:{type:n,action:i}}=t;if(n!==Se.py.activityinapptoastundo||i!==Se.uk.mutate)return t;await QG(e)},QG=async e=>{const{entityCommand:t,requestContext:n}=e,{userBiService:i,loggerFactory:a}=n,o=t.entityOptions,r=a.newLogger("ActivityOnBeforeCommandHandled","apps-activity");switch(YG(i,o),o.supportedAction){case rG.HX.turnOffLikesAndReactions:case rG.HX.turnOffAllTeamAndChannelMentions:await KG(o,n,qG.NN.Notifications,r);break;case rG.HX.muteApp:await KG(o,n,qG.NN.GraphApps,r)}},KG=async(e,t,n,i)=>{const{scenarioFactory:a}=t,o=e.previousSettings;if(o&&o.length){const r=a.newScenario(H.RG.ActivityContextualSettingsUpdate);try{await t.client.mutate({mutation:zG._,variables:{settingsUpdate:{updatedSettings:o},appId:n,subCategoryPageId:e.appId}}),r.stop({supportedActions:`${e.supportedAction}-undo`},"success")}catch(t){const n=`ActivityOnBeforeCommandHandled: Couldn't update activity settings for supportedAction: ${e.supportedAction}, appId: ${e.appId}`;i.error(n),r.fail({supportedActions:`${e.supportedAction}-undo`,reason:n})}}else i.warn(`ActivityOnBeforeCommandHandled: noop, previousSettings is empty for supportedAction: ${e.supportedAction}, appId: ${e.appId}`)},YG=(e,t)=>{const n=e.createDatabag?.();if(n){const{supportedAction:e,activityType:i,activitySubtype:a}=t;n.type=i,n.subType=a,n.supportedAction=e}e.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.undo,actionScenario:dA.Tk.activityInAppToastUndo,actionScenarioType:dA.Yu.inAppToast,panelType:dA.wh.inAppToast,dataBag:n}),n?.dispose()},XG=()=>jV.windowFeatures||{};function ZG(){const e=()=>null;return{eventHandlers:oG,getAppPhases:RV,getAppViewEntities:LV,getAppViewEntitiesProps:zV,getAppWindowFeatures:XG,getCommandScenarioName:JV,getCommandScenarioNameFromSource:QV,getPlatformAppIdForEntity:e=>e.type===Se.py.activity?"14d6962d-6eeb-4f48-8890-de55454bb136":void 0,manifest:jV,onBeforeAddToNavigation:KV,onBeforeCommandHandled:JG,onCommandReceived:hG,onCommandResult:wG,render:async({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a,entity:o})=>{switch(t){case Mt.S.Main:return FG(IG.ActivityMainPane,i,a,n);case Mt.S.Rail:switch(o.type){case Se.py.activityslicecontent:return FG(IG.SlicesActivityApp,i,a,n);case Se.py.activityslices:return FG(IG.SlicesActivitySubNav,i,a,n);case Se.py.activity:default:return FG(IG.ActivityApp,i,a,n)}case Mt.S.Modal:return o.type===Se.py.notificationsettingsdefault?(0,gO.t)(GG,{}):FG(IG.ActivityFeedDialogs,i,a,n);default:return(0,gO.t)(e,{})}}}}var ez=n(173292);const tz=e=>{if(nz(e))return iz(e)?{subNavEntity:az(e),headerEntity:oz(e),startEntity:rz(e),mainEntity:sz(e),endEntity:lz(e)}:null},nz=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.annotation].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},iz=()=>!0,az=()=>null,oz=()=>null,rz=()=>null,sz=({entity:e})=>e,lz=()=>null,cz=()=>({mainEntity:{[Mt.S.Main]:{forceDisableTitleBar:!0,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:!0,isSlotBackgroundTransparent:!0,UNSAFE_enablePptProvider:!0,disableNotificationsBanners:!0}}}),dz={id:"com.microsoft.teams.annotation",name:"AnnotationApp",supportedEntities:[Se.py.annotation],supportedRenderModes:[Mt.S.Main],windowFeatures:{additionalFeatures:{alwaysOnTop:"true",excludeWindowFromScreenSharing:"true",contentprotection:"true",transparent:"true",hideWindowControl:"true",resizable:"false",movable:"false"},top:0,left:0,height:360,width:640,minHeight:360,minWidth:640}},uz=()=>Promise.all([n.e(782721),n.e(188357)]).then(n.bind(n,90454)),mz=({windowOptions:e})=>e&&dz.windowFeatures?{additionalFeatures:dz.windowFeatures.additionalFeatures,top:e.top,left:e.left>0?e.left:e.left/2,width:dz.windowFeatures.width,height:dz.windowFeatures.height,minWidth:dz.windowFeatures.minWidth,minHeight:dz.windowFeatures.minHeight,fullscreen:!0}:{...dz.windowFeatures,fullscreen:!0};function pz(){const e=()=>null;return{getAppViewEntities:tz,getAppViewEntitiesProps:cz,getAppWindowFeatures:mz,manifest:dz,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===Mt.S.Main){const{Annotation:e}=await(0,ac.mT)(uz,"annotation-app",n);return(0,gO.t)(ez.f,{namespace:"calling",loaderRenderer:null,children:(0,gO.t)(e,{})})}return(0,gO.t)(e,{})}}}const gz={id:"com.microsoft.teams.breakout-rooms",name:"BreakoutRoomsApp",supportedEntities:[Se.py.breakoutrooms,Se.py.breakoutroomsassignment,Se.py.breakoutroomsassignmenttype,Se.py.breakoutroomscreaterooms,Se.py.breakoutroomsdeleteroom,Se.py.breakoutroomsdeleterooms,Se.py.breakoutroomseditroom,Se.py.breakoutroomssettings],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar,Mt.S.Rail],getDefaultCommand:()=>({type:Se.py.breakoutrooms,action:Se.uk.view}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20}},hz=e=>{if(yz(e))return vz(e)?{subNavEntity:fz(e),headerEntity:Sz(e),startEntity:kz(e),mainEntity:Cz(e),endEntity:bz(e)}:null},yz=({entity:e,layoutMode:t})=>{const{action:n=null,type:i}={...e},a=[ke.lO.standard,ke.lO.focus].includes(t),o=[Se.uk.view,null].includes(n),r=[Se.py.breakoutrooms].includes(i);return!!(n&&a&&r&&o)},vz=()=>!0,fz=({entity:e,layoutMode:t})=>[ke.lO.standard].includes(t)?e:null,Sz=({entity:e,layoutMode:t})=>[ke.lO.standard].includes(t)?e:null,kz=()=>null,Cz=({layoutMode:e,entity:t})=>[ke.lO.standard,ke.lO.focus].includes(e)?t:null,bz=()=>null,wz=({areEmptySlotsTransparent:e})=>({mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!0}},subNavEntity:{[Mt.S.Rail]:{isBackgroundTransparent:e}},headerEntity:{[Mt.S.HorizontalBar]:{isBackgroundTransparent:e}}}),Tz=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(909020),n.e(586535),n.e(591878),n.e(773923),n.e(120894),n.e(51724),n.e(635026),n.e(373318),n.e(149115),n.e(130631),n.e(228737),n.e(681238),n.e(652137),n.e(928362),n.e(213629),n.e(796594),n.e(585815),n.e(782721),n.e(404742),n.e(90653),n.e(738789),n.e(383478),n.e(885673),n.e(384037)]).then(n.bind(n,665692)),Iz="breakout-rooms-northstar-app",Nz=()=>gz.windowFeatures||{};function Ez(){const e=()=>null;return{manifest:gz,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main){n("ChunkLoadStarted",{chunkName:Iz});const{BreakoutRoomsAppEntry:e}=await(0,ac.mT)(Tz,Iz,i);return n("ChunkLoadSucceeded",{chunkName:Iz}),(0,gO.t)(ez.f,{namespaces:["breakoutRooms"],loaderRenderer:null,children:(0,gO.t)(e,{})})}return(0,gO.t)(e,{})},getAppViewEntities:hz,getAppViewEntitiesProps:wz,getAppWindowFeatures:Nz,onRegister:e=>{e.registerTask(new ul)}}}var Az=n(451330),_z=n(839860);const Fz=e=>({entityCommand:{entity:{type:"unsupporteddeeplinkdialog",action:"view"},command:{layoutMode:"standard",stateTransition:"extend",visibilityState:"show"},entityOptions:{originalDeeplink:e}},metadata:{allowAnonymous:!1,userContextId:void 0}}),Dz=(e,t,n,i,a,o)=>{const{tenantId:r,organizerId:s,conversationId:l,rootMessageId:c}=e,d=`${r}__${s}__${l}__${c}`;if(i&&a?.config.clientType===An.Bh.Web)return Promise.resolve({entityCommand:{entity:{id:d,type:"broadcasts",action:"view"},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,layoutMode:ke.lO.standard},entityOptions:{threadId:l,messageId:c,tenantId:r,organizerId:s}},metadata:{allowAnonymous:!0,tenantId:r}});if(n){if(a&&a.config.clientType===An.Bh.Maglev)return Promise.resolve({entityCommand:{entity:{id:d,type:"broadcasts",action:"view"},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new,layoutMode:ke.lO.focus},entityOptions:{threadId:l,messageId:c,tenantId:r,organizerId:s}},metadata:{allowAnonymous:!0,tenantId:r}});if(o&&a&&a.config.clientType===An.Bh.Web){const e=(0,L.J)(),t=(0,_z.Dk)(d,o,!0);return e.open(t,"_blank"),Promise.resolve(void 0)}}return Promise.resolve(Fz(t))};var Pz,Mz=n(218420);!function(e){e.EmptyDeeplinkUrl="empty-deeplink-url-received",e.EmptyContext="empty-context-received",e.InvalidIsBroadcastMeetingType="invalid-isBroadcastMeeting-type",e.InvalidRoleType="invalid-role-type"}(Pz||(Pz={}));const xz=/\{\"Tid\":\"([\w\-]{36})\",\"Oid\":\"([\w\-]{36})\",\"IsBr/,Rz={filter:e=>{if(!e.pathname.includes("/l/meetup-join"))return!1;const t=new URLSearchParams(e.search).get("context");if(!t)return!1;try{const{IsBroadcastMeeting:e}=JSON.parse(t);return e}catch(e){return!!(e=>3===decodeURIComponent(e).match(xz)?.length)(t)}},execute:async({deeplinkUrl:{pathname:e,search:t},context:{coreSettings:n,__doNotUse_globalDataClient:i}})=>{const{allowBroadcastAttendeeMeetingJoinsInT2:a,allowBroadcastAttendeeMeetingJoinsInT2Web:o,conveneTemplateUrl:r,allowBroadcastPresenterJoinsInT2:s}=n.get(b.J.Broadcast);if(!e)return Promise.reject({message:Pz.EmptyDeeplinkUrl});t=decodeURIComponent(t);const l=decodeURIComponent(e).split(/[/?&]/),c=l.indexOf("meetup-join")+1,d=l[c],u=l[c+1],m=new URLSearchParams(t);let p=!1;try{p=JSON.parse(m.get("anon")||"false")}catch(e){}m.set("anon","true");const g=m.get("deeplinkId"),h=m.get("context");if(!h)return Promise.reject({message:Pz.EmptyContext});const{tenantId:y,organizerId:v,isBroadcastMeeting:f,roleHint:S,isTruncatedBroadcastLink:k}=await(e=>{let t,n,i,a;try{const o=JSON.parse(e);return t=o.Tid,n=o.Oid,i=o.IsBroadcastMeeting,a=o.role,{tenantId:t,organizerId:n,isBroadcastMeeting:i,roleHint:a,isTruncatedBroadcastLink:!1}}catch(o){const r=e.match(xz);if(3===r?.length){const e=2;return t=r[1],n=r[e],i=!0,a="a",{tenantId:t,organizerId:n,isBroadcastMeeting:i,roleHint:a,isTruncatedBroadcastLink:!0}}return Promise.reject(o)}})(h);if(k&&m.set("context",JSON.stringify({Tid:y,Oid:v,IsBroadcastMeeting:f,role:S})),!(0,W.isBoolean)(f))return Promise.reject({message:Pz.InvalidIsBroadcastMeetingType});if(!("a"===S||void 0===S))return Promise.reject({message:Pz.InvalidRoleType});const C="a"===S,w=`${e}?${m.toString()}`;let T;const I=((e,t)=>{if("null"!==e)return e;const n=t.get("fqdn");return n?`https://${n}`:void 0})(origin,m);I&&(T=`${I}/_#${e}?${m.toString()}`);const N={joinType:"Legacy",conversationId:d,messageId:u,rootMessageId:u,isChannel:"0"!==u,isAdhoc:!1,tenantId:y,organizerId:v,meetingCloud:m.get("fqdn")||(0,Mz.uO)(origin)};return((e,t,n,i,a,o,r,s,l,c,d,u,m)=>{const{tenantId:p,conversationId:g,rootMessageId:h}=o;return n&&!r?a?.config.clientType===An.Bh.Web?Dz(o,i,e,t,a,c):Promise.resolve({entityCommand:{entity:{type:"callingdeeplink",action:"join",id:`${g}/${h}`},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new,layoutMode:ke.lO.focus},entityOptions:{deeplinkUrl:i,coordinates:o,directMeetingLink:u,deepLinkId:d,roleHint:s,isBroadcastMeeting:l}},metadata:{allowAnonymous:!!m,tenantId:p}}):r?Dz(o,i,e,t,a,c):Promise.resolve(Fz(i))})(a||!1,o||!1,s||!1,w,i?.ctx?.platformService,N,C,S,f,r||void 0,g,T,!!p)}},jz=[Rz],Lz=e=>{if(Oz(e))return $z(e)?{subNavEntity:Uz(e),headerEntity:Bz(e),startEntity:Wz(e),mainEntity:Hz(e),endEntity:Vz(e)}:null},Oz=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.broadcasts,Se.py.eventsbroadcastqna,Se.py.broadcastwebjoinnotsupporteddialog].includes(i),r=[Se.uk.create,Se.uk.default,Se.uk.list,Se.uk.view,Se.uk.info],s=n&&r.includes(n);return!!(a&&o&&s)},$z=()=>!0,Uz=()=>null,Bz=({entity:e})=>e,Wz=()=>null,Hz=({entity:e})=>e,Vz=({contextEntity:e})=>{const{action:t,type:n}=e||{};return e&&(n===Se.py.broadcasts&&t===Se.uk.info||n===Se.py.eventsbroadcastqna)||e&&n===Se.py.broadcastwebjoinnotsupporteddialog?e:null},Gz={id:"com.microsoft.teams.broadcast",name:"Broadcast",supportedEntities:[Se.py.broadcasts,Se.py.broadcastfeedback,Se.py.eventsbroadcastqna,Se.py.broadcastwebjoinnotsupporteddialog],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Rail,Mt.S.Modal],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600}};var zz=n(634195),qz=n(28950);const Jz={onEventReceived:async({eventInput:e})=>e.event.type===qz.R_.leaveBroadcastQualityFeedback?Promise.resolve({command:Nt.CN.defaultCommand({forceTransition:!0})}):Promise.resolve(void 0)},Qz=()=>Promise.all([n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(591878),n.e(986797),n.e(393890),n.e(152739),n.e(120894),n.e(373318),n.e(149115),n.e(980585),n.e(206681),n.e(918249),n.e(928362),n.e(652421),n.e(241070),n.e(995293),n.e(685827),n.e(609660),n.e(702573),n.e(360134),n.e(949636),n.e(281467),n.e(678342),n.e(968147),n.e(782721),n.e(404742),n.e(90653),n.e(550701),n.e(608462),n.e(738789),n.e(479908),n.e(187784),n.e(772819),n.e(468557)]).then(n.bind(n,304548)),Kz=({coreServices:e,host:t,isResize:n})=>{const{minHeight:i,minWidth:a}=Gz.windowFeatures||{},o=t?.screen;if(n&&!o)return Gz.windowFeatures||null;if(!o)return null;let{height:r=1,width:s=1}=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=Gz.windowFeatures||{};let{width:a,height:o}=Gz.windowFeatures||{};if(!t)return{height:o,width:a,minHeight:n,minWidth:i};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:c}=t.coreSettings.get(b.J.Broadcast);if(s&&l&&c)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=c*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/c*a}return{height:o,width:a}})(o,e);const l=o.availHeight-20,c=s>=o.availWidth||r>=l;c&&(r=o.availHeight,s=o.availWidth);const{left:d,top:u}=((e,t,n,i,a)=>{if(i)return{left:0,top:0};const o="availLeft"in e?e.availLeft:0,r="availTop"in e?e.availTop:0,s=o+e.availWidth/2-t/2;let l;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":l=r+a;break;default:l=r+e.availHeight/2-n/2}return{left:s,top:l}})(o,s,r,c,20);return{additionalFeatures:{minHeight:`${i}`,minWidth:`${a}`},height:r,width:s,fullScreen:c,left:d,top:u,minHeight:i,minWidth:a}};function Yz(){const e=()=>null;return{getAppViewEntities:Lz,getAppWindowFeatures:Kz,onBeforeDeeplinkParsed:jz,manifest:Gz,render:async({appRenderMode:t,scenarioFactory:n})=>{const i=(0,Re.v4)();switch(t){case Mt.S.HorizontalBar:case Mt.S.Main:case Mt.S.Rail:case Mt.S.Modal:const a="broadcast-app",{BroadcastViewsRenderer:o}=await(0,ac.mT)(Qz,a,n);return(0,gO.t)(zz.vb,{joinId:i,children:(0,gO.t)(ez.f,{namespace:"broadcast",loaderRenderer:null,children:(0,gO.t)(Az.yx,{children:(0,gO.t)(o,{appRenderMode:t})})})});default:return(0,gO.t)(e,{})}},eventHandlers:Jz}}const Xz=e=>{if(Zz(e))return eq(e)?{subNavEntity:tq(e),headerEntity:nq(e),startEntity:iq(e),mainEntity:aq(e),endEntity:oq(e)}:null},Zz=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.standard,ke.lO.focus].includes(e),o=[Se.uk.create,Se.uk.default,Se.uk.view,Se.uk.list],r=n&&o.includes(n),s=[Se.py.calendar,Se.py.schedulingform].includes(i),l=Se.py.schedulingform!==i&&Se.uk.view===n&&ke.lO.focus===e;return!(!(a&&s&&r)||l)},eq=()=>!0,tq=()=>null,nq=({entity:e,coreSettings:t})=>{const n=t?.get(b.J.Calendar).enableCalendarSchedulingFormMultiSlot,i=t?.get(b.J.Calendar).enableFluentCalendarSurface,a=!!n&&e.type===Se.py.schedulingform,o=!!i&&e.type===Se.py.calendar;return a||o?e:null},iq=()=>null,aq=({contextEntity:e,entity:t})=>{const n=[Se.py.extensions,Se.py.attendancereport,Se.py.meetinganalytics,Se.py.meetingrecap,Se.py.transcriptcontent];return e?.type&&n.includes(e.type)?e:t},oq=({contextEntity:e})=>e&&e.action&&e.type===Se.py.meetingcollaboration?e:null,rq=({coreSettings:e})=>{const t=e?.get(b.J.Calendar).enableCalendarAppTransparentBackground;return{mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!!t}}}},sq={id:"com.microsoft.teams.calendar",name:"CalendarApp",getLocalizedName:async e=>(await e.waitForNamespace("calendar"),e.stringTranslate("calendar","calendar_app_name")),actors:[IO],supportedEntities:[Se.py.calendar,Se.py.schedulingform,Se.py.connectedcalendardialog,Se.py.connectedcalendarsurfacedialog,Se.py.channelcalendar],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar,Mt.S.Modal],getDefaultCommand:()=>({type:Se.py.calendar,action:Se.uk.default}),windowFeatures:{minWidth:565,width:1241,minHeight:720,height:720}};const lq=({action:e,appRenderMode:t,type:n,coreSettings:i})=>{const a=new MV.H,{calendarAppPhaseTimeouts:o}=i.get(b.J.Calendar,["calendarAppPhaseTimeouts"]),r=[],s=[];return n===Se.py.calendar?function(e,t){switch(e){case Mt.S.Main:t.push(xV.G.CALENDAR_VIEW_RENDERED);break;case Mt.S.HorizontalBar:t.push(xV.G.CALENDAR_HEADER_RENDERED)}}(t,r):n===Se.py.schedulingform&&function(e,t,n,i){switch(t){case Mt.S.Main:n.push(xV.G.CALENDAR_SF_VIEW_RENDERED),e===Se.uk.view&&i.push(xV.G.CALENDAR_SF_TRACKING_VIEW_RENDERED);break;case Mt.S.HorizontalBar:n.push(xV.G.CALENDAR_SF_HEADER_RENDERED)}}(e,t,r,s),r.length>0&&a.registerAppPhase({phase:yt.nh.CRITICAL,signals:r,timeout:o?.critical||1e4}),s.length>0&&a.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:s,timeout:o?.postCritical||1e4}),a.appPhases},cq={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCalendarTryStartMeetingBotPublisherMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tryStartMeetingBotPublisher"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};function dq(e){const{client:t,coreSettings:n,loggerFactory:i}=e,a=t,o=i.newLogger("[MeetingBot-StartJob]","apps-calendar");return{id:"start-meeting-bot",runOncePerId:!0,job:()=>{n.get(b.J.MeetingBot).enableMeetingBot?a.mutate({mutation:cq,fetchPolicy:"no-cache"}):o.log("meetingbot is disabled")}}}const uq={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}},mq=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("CalendarApp onCommandReceived","apps-calendar");if(e.command.actor===IO)return n===NO?{entity:{type:Se.py.calendar,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}}:void i.error(`Command action '${n}' is not supported at CalendarApp.`);i.error(`Command for actor '${e.command.actor}' cannot be handled by CalendarApp.`)},pq={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCalendarSyncConnectedCalendarSettingsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syncConnectedCalendarSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"accountAddress"}},{kind:"Field",name:{kind:"Name",value:"accountId"}},{kind:"Field",name:{kind:"Name",value:"isSyncAllowed"}}]}}]}}]},gq={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCalendarGetExternalAccountsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"connectedAccountRequestResource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ConnectedAccountRequestSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getExternalAccounts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}},{kind:"Argument",name:{kind:"Name",value:"connectedAccountRequestResource"},value:{kind:"Variable",name:{kind:"Name",value:"connectedAccountRequestResource"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"oAuthProviderDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"oAuthProviderType"}}]}},{kind:"Field",name:{kind:"Name",value:"userAccount"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"alternateId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"emailAddress"}}]}},{kind:"Field",name:{kind:"Name",value:"refreshTokenExpirationUnixTimestamp"}}]}}]}}]},hq={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCalendarRefreshExternalAccountMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"refreshExternalAccount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]},yq="lastRefreshAttemptTimestamp",vq="pauseRefresh",fq=e=>e/86400,Sq=()=>Math.round(Date.now()/1e3),kq=async(e,t)=>{const{data:n}=await t.query({query:gq,fetchPolicy:"network-only",variables:{callerInfo:e,connectedAccountRequestResource:"TflCloudCache"}});return n?.getExternalAccounts},Cq=async(e,t)=>{let n;const{data:i}=await t.query({query:pq,fetchPolicy:"network-only",variables:{callerInfo:e}});return i?.syncConnectedCalendarSettings?.length&&(n=i.syncConnectedCalendarSettings.filter((e=>!1===e.isSyncAllowed))),n},bq=async(e,t,n)=>{await n.mutate({mutation:hq,variables:{accountId:e,callerInfo:t}})},wq=(e,t)=>{if(!e||!t)return!0;const n=Number(e);if(isNaN(n))return!0;const i=Sq();return fq(n-i)<=t},Tq=e=>`tmp.${e}.refreshExternalAccount`,Iq=(e,t,n,i)=>{const a={[yq]:t,[vq]:!!i};return n?.trySet(Tq(e),JSON.stringify(a),"Calendar","UserAndExperience")},Nq=(e,t,n,i)=>{const a=((e,t)=>{const n={[yq]:null,[vq]:!1};if(!t)return n;const i=t.get(Tq(e));if(!i)return n;try{const e=JSON.parse(i);n[yq]=e[yq]||null,n[vq]=e[vq]||!1}catch{return n}return n})(e,n);if(a[vq])return t.mark(H.ck.NoSrtRefreshNeededDueToPause),!1;if(!i)return!0;const o=a[yq],r=Number(o);if(isNaN(r))return!0;const s=Sq();return!(fq(s-r)<=i)||(t.mark(H.ck.NoSrtRefreshNeededBasedOnLastRefreshTimestamp),!1)},Eq=(e,t,n,i)=>{let a=!1;for(const o of e){Nq(o.accountId,t,n,i)&&(a=!0)}return a},Aq=(e,t,n,i)=>{const a=`Failed createConnectedAccountRefreshSrtJob with error code: ${i}`;e.errorToTelemetry?.(a,"connected_account_refresh_srt_job"),n&&t.fail({errors:a})},_q=async e=>{if(!e)return null;const t=e.graphQLErrors,n=t&&t[0]?.originalError?.serverResponse;if(!n)return null;try{const e=await n.body.clone().json();return{errorCode:e.errorCode,message:e.message}}catch{return{message:"Failed to extract server response in extractServerError"}}},Fq=e=>{if(!e)return!1;const t=e.graphQLErrors,n=t?.[0]?.originalError,i=n?.reason?.innerError?.context,a=n?.serverResponse;return i===h.w5.Authentication||a?.status===Hs.qb.NOT_AUTHORIZED},Dq="createConnectedAccountRefreshSrtJob";var Pq=n(219983);const Mq="/scheduling-form/";var xq,Rq,jq,Lq,Oq,$q,Uq;!function(e){e[e.Channel=0]="Channel",e[e.PrivateChat=1]="PrivateChat"}(xq||(xq={})),function(e){e[e.UserEventUsingEventId=0]="UserEventUsingEventId",e[e.TeamEventUsingEventId=1]="TeamEventUsingEventId",e[e.UserEventUsingICalUId=2]="UserEventUsingICalUId",e[e.TeamEventUsingICalUId=3]="TeamEventUsingICalUId",e[e.UserSeriesEventUsingOccurenceEventId=4]="UserSeriesEventUsingOccurenceEventId"}(Rq||(Rq={})),function(e){e.newMeeting="/l/meeting/new",e.viewMeeting="/l/meeting/details",e.meetingDetails="/l/calendar/scheduling-form",e.surface="/l/calendar/surface"}(jq||(jq={})),function(e){e.NoEventId="calendar_on_before_deep_link_parsed_no_event_id_error",e.FeatureNotEnabled="calendar_on_before_deep_link_parsed_feature_not_enabled_error",e.InvalidContext="calendar_on_before_deep_link_parsed_invalid_context_error"}(Lq||(Lq={})),function(e){e.NoEventId="Parsed calendar deep link does not contain the event id",e.FeatureNotEnabled="Feature for parsing T1 calendar deep links in T2.1 is not enabled",e.InvalidContext="Parsed calendar deep link does not contain valid context query param"}(Oq||(Oq={})),function(e){e.StartTime="startTime",e.EndTime="endTime",e.Subject="subject",e.Content="content",e.Attendees="attendees",e.TemplateId="templateId",e.CorrelationId="correlationId",e.Source="source",e.SourceVersion="sourceVersion",e.UserObjectId="oid"}($q||($q={})),function(e){e.EventId="eventId",e.Context="context"}(Uq||(Uq={}));const Bq=({deeplinkUrl:e,parsedDeeplinkHash:t,preferredCommandInput:n,context:{coreSettings:i,loggerFactory:a}})=>{const o=a.newLogger("CalendarApp onBeforeDeeplinkParsed","apps-calendar"),{enableParseT1CalendarDeeplinks:r}=i.get(b.J.Calendar);if(!r)throw o.errorToTelemetry?.(Oq.FeatureNotEnabled,Lq.FeatureNotEnabled),Error(Oq.FeatureNotEnabled);let s,l,c,d,u;if(t?.search){const{search:e}=t;s=e.eventId,l=e.conversationId,c=parseInt(e.providerType,10)||Rq.UserEventUsingEventId,d=parseInt(e.opener,10)||xq.PrivateChat,u=Wq(e.context,o)}else{const{search:t}=e,n=new URLSearchParams(t);s=n.get(Uq.EventId)||void 0,c=Rq.UserEventUsingEventId,d=xq.PrivateChat;const i=n.get(Uq.Context);u=Wq(i,o)}const m=[C.D.ActivityFeed,C.D.ActivityFeedBellClick],p=!!n?.correlation.source&&m.includes(n.correlation.source)?Pq.kH.NOTIFICATION_POPOVER:Pq.kH.DEEP_LINK;if(s)return Promise.resolve({entityCommand:{entity:{type:Se.py.schedulingform,action:Se.uk.view,id:s},command:{stateTransition:n?.stateTransition??ke.su.flush,visibilityState:n?.visibilityState??ke.fe.show},entityOptions:{navCtx:p,eventId:s,opener:d,conversationId:l,providerType:c,...u}},metadata:{allowAnonymous:!1}});throw o.errorToTelemetry?.(Oq.NoEventId,Lq.NoEventId),Error(Oq.NoEventId)},Wq=(e,t)=>e&&(0,am.D)(e,{},(()=>{throw t.errorToTelemetry?.(Oq.InvalidContext,Lq.InvalidContext),Error(Oq.InvalidContext)})),Hq=async({deeplinkUrl:e,parsedDeeplinkHash:t,context:{coreSettings:n,loggerFactory:i,getUserContexts:a}})=>{const o=i.newLogger("CalendarApp onBeforeDeeplinkParsed","apps-calendar"),{enableVirtualAppointmentDeepLink:r}=n.get(b.J.VirtualAppointments),{enableParseT1CalendarDeeplinks:s,enableCalendarSchedulingFormInNewWindow:l}=n.get(b.J.Calendar);if(!s)throw o.errorToTelemetry?.(Oq.FeatureNotEnabled,Lq.FeatureNotEnabled),Error(Oq.FeatureNotEnabled);let c,d,u,m,p,g,h,y,v,f;if(t?.search){const{search:e}=t;c=e.startTime&&new Date(e.startTime)||void 0,d=e.endTime&&new Date(e.endTime)||void 0,u=e.subject,m=e.content,p=e.attendees,g=e.templateId,h=e.source,y=e.sourceVersion,v=e.correlationId,f=e.oid}else{const{search:t}=e,n=new URLSearchParams(t),i=n.get($q.StartTime),a=n.get($q.EndTime);c=i&&new Date(i)||void 0,d=a&&new Date(a)||void 0,u=n.get($q.Subject)||void 0,m=n.get($q.Content)||void 0,p=n.get($q.Attendees)||void 0,g=n.get($q.TemplateId)||void 0,h=n.get($q.Source)||void 0,y=n.get($q.SourceVersion)||void 0,v=n.get($q.CorrelationId)||void 0,f=n.get($q.UserObjectId)||void 0}let S,k=void 0!==g?{templateId:g}:void 0;!1==!!r&&(h=void 0,y=void 0,v=void 0,f=void 0,k=void 0),k&&(S=Kq(await a(),f));const C=Yq(!!k,!!l);return Promise.resolve({entityCommand:{entity:{type:Se.py.schedulingform,action:Se.uk.create,id:(0,Re.v4)()},command:C,entityOptions:{navCtx:Pq.kH.DEEP_LINK,startTime:c,endTime:d,subject:u,content:m,attendees:p,opener:1,templateMeetingParameters:k,externalSource:h,externalSourceVersion:y,externalSourceCorrelationId:v}},metadata:{allowAnonymous:!1,accountsToUse:S}})},Vq={filter:jq.surface,execute:({deeplinkUrl:e,preferredCommandInput:t})=>{const n="m365-calendar"===e.searchParams?.get("source")?C.D.CalendarM365:C.D.Calendar;return Promise.resolve({entityCommand:{entity:{type:Se.py.calendar,action:Se.uk.view,id:(0,Re.v4)()},command:{stateTransition:t?.stateTransition??ke.su.flush,visibilityState:t?.visibilityState??ke.fe.show},entityOptions:{navCtx:Pq.kH.DEEP_LINK,source:n}},metadata:{allowAnonymous:!1}})}},Gq={filter:(e,t)=>!!e.hash&&t?.pathname===Mq&&!t?.search?.eventId,execute:Hq},zq={filter:jq.newMeeting,execute:Hq},qq={filter:(e,t)=>!!e.hash&&t?.pathname===Mq&&!!t?.search?.eventId,execute:Bq},Jq={filter:jq.viewMeeting,execute:Bq},Qq={filter:jq.meetingDetails,execute:({deeplinkUrl:e,preferredCommandInput:t,context:{coreSettings:n,loggerFactory:i}})=>{const a=i.newLogger("CalendarApp onBeforeDeeplinkParsed","apps-calendar"),{enableParseT1CalendarDeeplinks:o}=n.get(b.J.Calendar);if(!o)throw a.errorToTelemetry?.(Oq.FeatureNotEnabled,Lq.FeatureNotEnabled),Error(Oq.FeatureNotEnabled);const{pathname:r,searchParams:s}=e,l=r.split("/")[4],c=(0,am.D)(s.get("context"),{},(()=>{throw a.errorToTelemetry?.(Oq.InvalidContext,Lq.InvalidContext),Error(Oq.InvalidContext)}));if(!l)throw a.errorToTelemetry?.(Oq.NoEventId,Lq.NoEventId),Error(Oq.NoEventId);return Promise.resolve({entityCommand:{entity:{type:Se.py.schedulingform,action:Se.uk.view,id:l},command:{stateTransition:t?.stateTransition??ke.su.flush,visibilityState:t?.visibilityState??ke.fe.show},entityOptions:{navCtx:Pq.kH.DEEP_LINK,opener:xq.PrivateChat,eventId:l,...c}},metadata:{allowAnonymous:!1}})}},Kq=(e,t)=>{const n=e.filter((e=>e.context?.client?.ctx?.authenticationUser?.profile?.objectId===t))[0]?.userContextId;return n?[n]:void 0},Yq=(e,t)=>e&&t?{stateTransition:ke.su.new,visibilityState:ke.fe.show,layoutMode:ke.lO.focus}:{stateTransition:ke.su.flush,visibilityState:ke.fe.show},Xq=[zq,Jq,Gq,qq,Qq,Vq],Zq={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCalendarSaveCalendarSettingsIndexdbMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"calendarSettings"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CalendarSettingsInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"saveCalendarSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"calendarSettings"},value:{kind:"Variable",name:{kind:"Name",value:"calendarSettings"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CalendarSettings"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"enableM365Calendar"}}]}}]}}]}}]},eJ=e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},entityOptions:a},requestContext:{userBiService:o,loggerFactory:r,client:s}}=e,l=r.newLogger("CallingOnBeforeCommandHandled","apps-calendar");return n===Se.py.calendar&&i===Se.uk.view&&a?.source===C.D.CalendarM365&&o.recordPanelAction({actionScenario:dA.Tk.toggleCalendarSwitcher,actionGesture:dA.uS.toggle,actionOutcome:dA.$K.Off},l),"viewM365CalendarSurface"===a?.searchQuery?(s.mutate({mutation:Zq,variables:{calendarSettings:{id:"calendarSettings",enableM365Calendar:!0}}}),o.recordPanelAction({actionScenario:dA.Tk.toggleCalendarSwitcher,actionGesture:dA.uS.toggle,actionOutcome:dA.$K.On},l),Promise.resolve({entity:{type:Se.py.extensions,action:Se.uk.view,id:JSON.stringify({appId:"5966c135-e05f-4ce0-81e0-e138fe8e9583"})},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.Unknown}}})):Promise.resolve(t)},tJ=()=>Promise.all([n.e(112403),n.e(681896),n.e(909020),n.e(586535),n.e(865804),n.e(397833),n.e(832961),n.e(729265),n.e(65923),n.e(577767),n.e(908285),n.e(801870),n.e(101614),n.e(765721),n.e(652421),n.e(68021),n.e(371898),n.e(482266),n.e(158529),n.e(586617),n.e(668778)]).then(n.bind(n,870159)),nJ=()=>sq.windowFeatures||{};function iJ(){return{eventHandlers:uq,getAppViewEntities:Xz,getAppViewEntitiesProps:rq,getAppWindowFeatures:nJ,getCommandScenarioName:aJ,getPlatformAppIdForEntity:e=>e.type===Se.py.calendar||e.type===Se.py.schedulingform?"ef56c0de-36fc-4ef8-b417-3d82ba9d073c":void 0,manifest:sq,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="calendar-app";t("ChunkLoadStarted",{chunkName:i});const{CalendarViewsRenderer:a}=await(0,ac.mT)(tJ,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(ez.f,{namespaces:["calendar","compose","extensibility","files"],loaderRenderer:null,children:(0,gO.t)(a,{appRenderMode:e,onRenderEvent:t,scenarioFactory:n})})},onBeforeDeeplinkParsed:Xq,onBeforeCommandHandled:eJ,onCommandReceived:mq,onPreWarm:e=>{const{context:t}=e,n=t.coreSettings,{enableConnectedAccountSrtRefresh:i}=n.get(b.J.Calendar),a=[dq(t)];return i&&a.push(function(e){const{client:t,coreSettings:n,localStorage:i,loggerFactory:a,scenarioFactory:o}=e,r=a.newLogger("connected-account-refresh-srt-job","apps-calendar"),s=t,{numberOfDaysToWaitBeforeSrtExpires:l,numberOfDaysToWaitSinceLastSrtRefresh:c}=n.get(b.J.Calendar);return{id:"connected-account-refresh-srt-job",runOncePerId:!0,job:async()=>{const e=o.newScenario(H.RG.ConnectedAccountRefreshSrtJob);let n=!1;const a=[];try{const o=await Cq(Dq,t);if(e.mark(H.ck.GetConnectedCalendarSettingsComplete),!o||0===o.length)return e.mark(H.ck.NoUnsyncedConnectedCalendarSettingFound),void e.stop();if(!Eq(o,e,i,c))return void e.stop();const d=await kq(Dq,t);e.mark(H.ck.GetExternalAccountsComplete),d&&0!==d.length||e.mark(H.ck.NoExternalAccountsFound);for(let t=0;d&&t<d.length;t++){const c=d[t];if(!c)continue;const u=c.userAccount?.id,m=o.find((e=>e.accountId===u));try{if(!m){e.mark(H.ck.NoMatchingExternalAccountToRefresh);continue}e.mark(H.ck.ExternalAccountFound);const t=c.refreshTokenExpirationUnixTimestamp;wq(t,l)?(await bq(u,Dq,s),e.mark(H.ck.RefreshExternalAccountComplete)):e.mark(H.ck.NoSrtRefreshNeededBasedOnSrtExpirationTimestamp),Iq(u,Sq(),i)}catch(t){let o;o=Fq(t)?h.jK.Unauthorized:(await _q(t))?.errorCode,Iq(u,Sq(),i,o===h.jK.Unauthorized),Aq(r,e,!1,o),n=!0,a.push(o)}}e.stop()}catch(t){const{errorCode:n}=await _q(t)||{};Aq(r,e,!0,n)}n&&Aq(r,e,!0,a.join(", "))}}}(t)),a},getAppPhases:lq}}const aJ=e=>{const{command:t,entity:n}=e;switch(n.type){case Se.py.schedulingform:if(t.visibilityState===ke.fe.hide)return;return n.action===Se.uk.create?H.RG.CalSchedulingFormLoadForCreateMode:H.RG.CalSchedulingFormLoad;case Se.py.calendar:return H.RG.CalendarSurfaceLoad;case Se.py.channelcalendar:return H.RG.ChannelCalendarLoad;case Se.py.connectedcalendardialog:return H.RG.ConnectedCalendarDialogLoad;default:return}},oJ={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}};var rJ=n(208418);const sJ=e=>{if(lJ(e))return cJ(e)?{subNavEntity:dJ(e),headerEntity:uJ(e),startEntity:mJ(e),mainEntity:pJ(e),endEntity:gJ(e)}:null},lJ=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.callablechannels].includes(i),r=[Se.uk.create,Se.uk.default,Se.uk.list,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},cJ=()=>!0,dJ=({entity:e})=>e,uJ=({entity:e})=>e,mJ=()=>null,pJ=({entity:e})=>e,gJ=()=>null,hJ={id:"com.microsoft.teams.callable-channel",name:"CallableChannelApp",supportedEntities:[Se.py.callablechannels],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Rail],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},yJ=()=>Promise.all([n.e(837458),n.e(724526)]).then(n.bind(n,410402)),vJ=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,967117)),fJ=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,450812));function SJ(){const e=()=>null;return{eventHandlers:oJ,getAppViewEntities:sJ,manifest:hJ,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,coreSettings:a})=>{if(t===Mt.S.Main){const e="callable-channels-app";n("ChunkLoadStarted",{chunkName:e});const{enableEntityMoreInfo:t}=a.get(b.J.Core),o=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),{LPC:r}=t?{LPC:o}:await(0,ac.mT)(fJ,e,i),s=t?o:rJ.p3;n("ChunkLoadSucceeded",{chunkName:e});const[{CallableChannelEntryContainer:l},{CallsTabContextProvider:c}]=await Promise.all([(0,ac.mT)(yJ,e,i),(0,ac.mT)(vJ,e,i)]);return(0,gO.t)(ez.f,{namespaces:["calling","messaging"],loaderRenderer:null,children:(0,gO.t)(r,{children:(0,gO.t)(s,{children:(0,gO.t)(c,{children:(0,gO.t)(l,{})})})})})}return(0,gO.t)(e,{})}}}const kJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"InitCallingService"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entryPoint"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingServiceEntrypointType"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"initCallingService"},arguments:[{kind:"Argument",name:{kind:"Name",value:"entryPoint"},value:{kind:"Variable",name:{kind:"Name",value:"entryPoint"}}}]}]}}]},CJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingDisposeCallingServiceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"disposeReason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DisposeReason"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"disposeSource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"DisposeSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"disposeCallingService"},arguments:[{kind:"Argument",name:{kind:"Name",value:"disposeReason"},value:{kind:"Variable",name:{kind:"Name",value:"disposeReason"}}},{kind:"Argument",name:{kind:"Name",value:"disposeSource"},value:{kind:"Variable",name:{kind:"Name",value:"disposeSource"}}}]}]}}]};var bJ;!function(e){e.DisposeMutationGenericJobError="DisposeMutationGenericJobError"}(bJ||(bJ={}));const wJ=(e,t,n,i,a)=>({id:"standup-calling",runOncePerId:!0,job:async()=>{const o=i.newScenario(H.RG.CallingAppInit,{clientId:(0,Re.v4)()});o.appendEventData({context:n});const r=i.newScenario(H.RG.StandupCallingAppExecute);r.appendEventData({context:n}),r.mark(H.ck.ExecuteJob);const s=t.newLogger("getStandupCallingJob","apps-calling");s.log("[getStandupCallingJob] Initializing calling service");const{enableCallingSignOut:l,callingServiceDisposeTimeoutInMs:c,enableStandupCallingAppExecuteErrorStack:d}=a.get(b.J.Calling);try{const t=(e=>{switch(e){case H.ck.OnAppPreWarm:return"onAppPreWarm";case H.ck.OnAppPreInit:return"onAppPreInit";default:throw new Error(`StandupCallingJob - ${H.ck} is not on_app_pre_warm or on_app_pre_init`)}})(n);if(o.mark(H.ck.InitCallingServiceMutation),r.pause({reason:h.jK.WaitingForResponse}),!e||!e.mutate)throw new Error(`apollo is missing. [client:${!!e}, mutation:${!!e?.mutate}]`);await e.mutate({mutation:kJ,variables:{entryPoint:t},context:{scenarioClientId:o.clientId,scenarioName:o.name}}),r.resume()}catch(e){throw s.error(`[getStandupCallingJob] Error initializing calling service [error.name=${e?.name}, error.message=${e?.message}]`),d&&r.appendEventData({error:e?.stack}),r.fail({errors:e.name,message:`${H.ck.ExecuteJob} failed with ${e.message}`}),o.fail({errors:e.name,message:`${H.ck.InitCallingServiceMutation} failed with ${e.message}`}),(0,de.Tr)(n,h.jK.StandupCallingJobError,e.name,void 0,e.message)}if(r.mark(H.ck.JobCompleted),o.mark(H.ck.EndStandupCallingJob),s.log("[getStandupCallingJob] Calling service initialized"),r.stop(),o.stop(),l)return async()=>TJ(e,s,i,n,c||45e3)}}),TJ=async(e,t,n,i,a)=>{const o="SignOut",r="StandupCallingAppJob",s=n.newScenario(H.RG.CallingServiceDispose);s.appendEventData({context:o,dataSource:r,origin:i}),n.hoistScenarioToCore?.(s),t.log(`[getStandupCallingJob] Calling service disposal initiated. [step: ${i}, reason:${o}, source:${r}, timeout:${a}]`);try{const t=e.mutate({mutation:CJ,variables:{disposeReason:o,disposeSource:r}});await(0,V.E)(t,a,`Dispose mutation timed out. [timeoutAmount:${a}]`)}catch(e){throw t.error(`[getStandupCallingJob] Error disposing calling service [error.name=${e?.name}, error.code=${e?.code}, error.message=${e?.message}, timeout:${a}]`),s.fail({reason:e?.code||bJ.DisposeMutationGenericJobError,message:e?.message||e}),(0,de.Tr)(H.RG.CallingServiceDispose,h.jK.StandupCallingJobError,o,void 0,e?.message)}s.stop(),t.log("[getStandupCallingJob] Calling service disposed")},IJ={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingContentEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingContentEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"action"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"visibility"}}]}},{kind:"Field",name:{kind:"Name",value:"content"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBannerContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingLocalRecordingNotificationContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_mainAppContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_autoBrbDialogContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBreakoutRoomPanelContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingWindowingContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingDialogContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingNotificationContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToChatContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToChatListContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToSettingsPaneContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingToCallListContent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"crossCloudMeetingJoinContent"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBannerContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingBannerContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"intentLevel"}},{kind:"Field",name:{kind:"Name",value:"dismissable"}},{kind:"Field",name:{kind:"Name",value:"duration"}},{kind:"Field",name:{kind:"Name",value:"bannerScenario"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"dismissOnAction"}},{kind:"Field",name:{kind:"Name",value:"actionButtonText"}},{kind:"Field",name:{kind:"Name",value:"bannerActions"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingLocalRecordingNotificationContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingLocalRecordingNotificationContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"fileId"}},{kind:"Field",name:{kind:"Name",value:"localRecordingNotificationType"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_mainAppContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MainAppContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_autoBrbDialogContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AutoBrbDialogContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"category"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCallingCallingAppEventsFragment_callingBreakoutRoomPanelContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingBreakoutRoomPanelContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"containerId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingWindowingContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingWindowingContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"coordsType"}},{kind:"Field",name:{kind:"Name",value:"windowingMode"}},{kind:"Field",name:{kind:"Name",value:"linkedContent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}}]}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingDialogContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingDialogContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"dialogActions"}},{kind:"Field",name:{kind:"Name",value:"dialogStrings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"text"}}]}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingNotificationContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingNotificationContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"callId"}},{kind:"Field",name:{kind:"Name",value:"crossClientScenarioName"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"subtitle"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"toastType"}},{kind:"Field",name:{kind:"Name",value:"bypassOsLevelDoNotDisturb"}},{kind:"Field",name:{kind:"Name",value:"image"}},{kind:"Field",name:{kind:"Name",value:"ringtoneAssetUrl"}},{kind:"Field",name:{kind:"Name",value:"time"}},{kind:"Field",name:{kind:"Name",value:"userid"}},{kind:"Field",name:{kind:"Name",value:"primaryAction"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceLabel"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceLabelSecondary"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceId"}},{kind:"Field",name:{kind:"Name",value:"audioDeviceIdSecondary"}},{kind:"Field",name:{kind:"Name",value:"audioApplicationDeviceId"}},{kind:"Field",name:{kind:"Name",value:"audioApplicationDeviceIdSecondary"}},{kind:"Field",name:{kind:"Name",value:"actions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"label"}},{kind:"Field",name:{kind:"Name",value:"icon"}},{kind:"Field",name:{kind:"Name",value:"actionType"}}]}},{kind:"Field",name:{kind:"Name",value:"header"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultImageDataUrl"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"subtitle"}},{kind:"Field",name:{kind:"Name",value:"mri"}}]}},{kind:"Field",name:{kind:"Name",value:"isSilent"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"members"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"Field",name:{kind:"Name",value:"displayDuration"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToChatContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToChatContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"messageId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToChatListContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToChatListContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToSettingsPaneContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToSettingsPaneContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"tabItemId"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingToCallListContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingToCallListContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}}]}}]}.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"crossCloudMeetingJoinContent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CrossCloudMeetingJoinContent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"meetingUrl"}}]}}]}.definitions]},NJ={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingAppSetupEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingAppSetupEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"result"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingAppEventsSetupSuccess"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingAppEventsSetupSuccess"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingAppEventsSetupSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"_"}}]}}]}.definitions]},EJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsCallingCallingAppEventsSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingAppEvents"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingAppEvent"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingAppEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingAppEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"event"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingContentEvent"}},{kind:"FragmentSpread",name:{kind:"Name",value:"callingAppSetupEvent"}}]}},{kind:"Field",name:{kind:"Name",value:"context"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"externalId"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}},{kind:"Field",name:{kind:"Name",value:"source"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}}]}}]}},...IJ.definitions,...NJ.definitions]}.definitions]};function AJ(e,t,n){const{id:i,title:a,callId:o,crossClientScenarioName:r,subtitle:s,image:l,time:c,actions:d,type:u,primaryAction:m,header:p,toastType:g,ringtoneAssetUrl:h,audioDeviceLabel:v,audioDeviceLabelSecondary:f,audioDeviceId:S,audioDeviceIdSecondary:k,audioApplicationDeviceId:w,audioApplicationDeviceIdSecondary:T,isSilent:I,displayDuration:N}=e,E=parseInt(c,10),A=p?{alt:p.subtitle,src:p.defaultImageDataUrl}:void 0;return{command:{correlation:{source:C.D.Notifications,id:n},stateTransition:ke.su.new,visibilityState:ke.fe.show},entityOptions:{buttons:d?.map((e=>function(e,t,n,i,a){const{actionType:o,label:r,icon:s}=t;return{...s&&{image:{alt:r,src:s}},targetEntity:{action:y.A$.mutate,dataOptions:{actionType:o,toastId:e,toastType:a},id:e,type:y.dt.calls},text:r,preferImageOnly:n.get(b.J.Calling).forceTextOnT2Notifications?void 0:!!s,style:DJ(o,i)}}(i,e,t,u,g))),callId:o,crossClientScenarioName:r,bypassOsLevelDoNotDisturb:_J(u,t),isIncomingCall:FJ(u),mainImage:{alt:a,src:l},ringtone:h,targetEntity:{action:y.A$.mutate,dataOptions:{actionType:m,toastId:i,toastType:g},id:i,type:y.dt.calls},text:s,time:new Date(E),title:a,headerImage:A,headerTitle:p?.title,headerSubtitle:p?.subtitle,deviceLabel:v,deviceLabelSecondary:f,deviceId:S,deviceIdSecondary:k,applicationDeviceId:w,applicationDeviceIdSecondary:T,isSilent:I,displayDuration:N,useTeamsChime:!1}}}const _J=(e,t)=>{let n;if("MeetingWentLive"===e)n=!!t.get(b.J.Calling).enableUrgentMeetingStartedNotificationV2;else n=!1;return n},FJ=e=>"MeetingWentLive"!==e;function DJ(e,t){if("Meeting"!==t)switch(e){case"ReplyIncomingCall":return;case"RejectIncomingCall":return y.p6.critical;default:return y.p6.success}}function PJ(e,t,n,i){const{id:a,coordsType:o,windowingMode:r,linkedContent:s}=n,{action:{visibility:l}}=t,{source:c,timeStamp:d}=i,u=function(e){return"Show"===e?ke.fe.show:ke.fe.hide}(l),m=function(e){return"SingleWindow"===e?ke.su.flush:ke.su.new}(r),p=s&&function(e){if(!e||!e.id)return;return{id:e.id,type:Se.py.chats}}(s),g=function(e){switch(e){case"RigelGallery":return Se.py.callsgallery;case"RigelContent":return Se.py.callscontent;case"RigelGalleryAndContent":return Se.py.callsgalleryandcontent;case"RigelMain":return Se.py.meetingroomallinonecall;default:return Se.py.calls}}(o);return{entity:{id:a,type:g,action:Se.uk.view,linkedEntity:p},command:{visibilityState:u,stateTransition:m,correlation:{id:e,startTimestamp:d||void 0,source:`${C.D.CallingAppEvent}::${c.name}::${c.description}`}}}}function MJ(e,t){switch(e){case"Show":return ke.fe.show;case"Hide":return ke.fe.hide;default:return t.warn(`${e} cannot be converted to visibility state, defaulting to hide`),ke.fe.hide}}var xJ,RJ=n(355617);!function(e){e.Calling="Calling",e.Notifications="Notifications",e.Devices="Devices",e.PremiumBenefits="PremiumBenefits",e.Privacy="Privacy"}(xJ||(xJ={}));const jJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"msaUserProfilePicture"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},LJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingMsaGroupProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MsaGroupProfilePictureInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaGroupProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"msaGroupInfo"},value:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]},OJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingPriorityContactsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"shouldFetchFromNetwork"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"priorityContacts"},arguments:[{kind:"Argument",name:{kind:"Name",value:"shouldFetchFromNetwork"},value:{kind:"Variable",name:{kind:"Name",value:"shouldFetchFromNetwork"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"jobTitle"}}]}}]}}]},$J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"toastImageAsDataUri"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]};const UJ=new class{constructor(){this.deeplinkEntitySet=!1,this.callingAppEventsSubscribed=!1,this.unlockDeeplinkEntity=()=>{const e=this.deeplinkEntityId;return this.deeplinkEntityId=void 0,this.deeplinkEntitySet=!1,this.resolvePromise&&this.resolvePromise(),e},this.lockDeeplinkEntity=e=>{this.deeplinkEntitySet||(this.initializingPromise=new Promise((e=>{this.resolvePromise=()=>{e()}})),this.deeplinkEntityId=e,this.deeplinkEntitySet=!0)},this.getDeeplinkEntityLocked=()=>this.deeplinkEntitySet,this.getDeeplinkReady=()=>this.initializingPromise,this.getCallingAppEventsSubscribed=()=>this.callingAppEventsSubscribed,this.setCallingAppEventsSubscribed=e=>{this.callingAppEventsSubscribed=e}}},BJ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"resolveCallingAppEvent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingAppEventResolution"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingAppEventResolution"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolveCallingAppEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingAppEventResolution"},value:{kind:"Variable",name:{kind:"Name",value:"callingAppEventResolution"}}}]}]}}]};function WJ(e,t,n){const{eventId:i,resolution:a,context:o}=e,{source:r}=o;return n.log(`[resolveCallingAppEvent] Resolving calling app event [eventId=${i}, source.name=${r.name}, source.description=${r.description}]`),t.mutate({mutation:BJ,variables:{callingAppEventResolution:{eventId:i,resolution:a,context:o}},fetchPolicy:"no-cache"})}function HJ(e,t,n){if(e&&t)return t.getAccountMode()===OE.b.MultipleAccounts?(n.log(li.f.ReturningUserKeyForToastCollection),(0,xe.b4)(e)):void n.error(li.f.CollectionIdUndefined);n.error(li.f.NoAutheticatedUserOrTrackingService)}function VJ(e,t,n){const{id:i,name:a,dialogActions:o,dialogStrings:r}=t,{action:{visibility:s}}=e,{timeStamp:l}=n;let c;if("Show"===s)c=ke.fe.show;else{if("Hide"!==s)return;c=ke.fe.hide}const d={visibilityState:c,stateTransition:ke.su.extend,correlation:{id:i,startTimestamp:l||void 0,source:a}},u=function(e){switch(e){case"WindowingError":return Se.py.windowingerrordialog;case"CallingRestartRecomendedError":return Se.py.restartrecomendeddialog;case"Alert":return Se.py.callingalertdialog;case"CallingUnparkCall":return Se.py.unparkcalldialog;case"CallingConfirm":return Se.py.callingconfirmdialog;case"OptionsSettings":return Se.py.optionssettingsdialog;case"PrejoinOverlay":return Se.py.prejoinoverlaydialog;case"UserMedia":return Se.py.usermediadialog;default:return}}(a);if(!u)return;const m={dialogActions:o?[...o]:[],dialogStrings:r?[...r]:[]};return{entity:{id:i,type:u,action:Se.uk.create},entityOptions:m,command:d}}function GJ(e,t,n){const{id:i,bannerScenario:a,bannerActions:o}=t,{action:{visibility:r}}=e,{timeStamp:s}=n,l=function(e){let t;if("Show"===e)t=ke.fe.show;else{if("Hide"!==e)return;t=ke.fe.hide}return t}(r);if(void 0===l)return;const c={visibilityState:l,stateTransition:ke.su.extend,correlation:{id:i,startTimestamp:s||void 0,source:a}},d=function(e){switch(e){case"EndpointTransfer":case"LocationChange":return Se.py.callingbannernotification;default:return}}(a),u=function(e,t){let n;if(e===ke.fe.show)switch(t){case"EndpointTransfer":n=Se.uk.join;break;case"LocationChange":n=Se.uk.default;break;default:n=void 0}else e===ke.fe.hide&&(n=Se.uk.delete);return n}(l,a);return d&&u?{bannerPrimaryActionEntity:{id:i,type:d,action:u},entityOptions:{bannerActions:o},command:c,bannerDismissCommandEntity:{id:i,type:Se.py.callingbannernotification,action:Se.uk.delete}}:void 0}async function zJ(e,t,n,i){try{const{eventId:i,resolution:a,context:o}=e;await WJ({eventId:i,resolution:a,context:o},t,n)}catch(e){n.error(i,`error: [errorName=${e.name}, errorMessage=${e.message}]]`)}}function qJ(e,t,n,i,a){let o={success:{_:!0}};return i&&a&&(o={error:{name:i,message:a}}),{eventId:e,resolution:o,context:{source:{name:t,description:n}}}}var JJ=n(285474),QJ=n.n(JJ),KJ=n(383657),YJ=n.n(KJ),XJ=n(381721),ZJ=n.n(XJ);const eQ={AssemblyStarted:QJ(),AssemblyFinished:YJ(),AssemblyError:ZJ()};const tQ=e=>({name:e.name||"unknown-show-breakout-room-panel-event-error",message:e.message||"unknown-windowing-commanding-error-message"}),nQ=async e=>{const{loggerFactory:t,entityCommanding:n,event:i,content:a,context:o,eventId:r,dataClient:s}=e,l=t.newLogger("handleCallingBreakoutRoomPanelContentEvent","apps-calling");l.log("Start executing breakout room panel content event handler");const{command:c}=function(e,t,n,i){const{action:{visibility:a}}=t,{timeStamp:o}=i;return{command:{visibilityState:MJ(a,n),stateTransition:ke.su.none,correlation:{id:e,startTimestamp:o||void 0,source:C.D.CallingAppEvent}}}}(r,i,l,o);try{await n.call.callBreakoutRoomById(a.containerId,c),l.log("Breakout room panel content event handler was executed successfully")}catch(e){return l.error("Error during processing of breakout room panel content event"),(async({eventId:e,logger:t,dataClient:n,error:i})=>{try{await WJ({eventId:e,resolution:{error:tQ(i)},context:{source:{name:"WindowingCommandingTriggerError",description:`Error triggering windowing command on event to open breakout room panel (eventId=${e})`}}},n,t)}catch(n){t.error(`[handleCallingBreakoutRoomPanelContentEvent] Error when reporting event resolution [eventId=${e}, error.message=${n?.message}]`)}})({logger:l,dataClient:s,eventId:r,error:e})}},iQ="CN:",aQ=(e,t,n,i,a,o,r,s)=>async()=>{const l=n.newLogger("getSetupAppEventsJob","apps-calling"),{enableCallingAppEventSubscriptionTelemetry:c,enableCallingEventJobsCleanup:d}=i.get(b.J.Calling);let u=!1;const m=(0,zc.P)();let p;c&&(p=a.newScenario(H.RG.CallingAppEventsSubscribe)),UJ.setCallingAppEventsSubscribed(!0);const g=e.subscribe({query:EJ,fetchPolicy:"no-cache"}).map((({data:e})=>e?.callingAppEvents)).subscribe({next:async o=>{let d;if(c&&(d=a.newScenario(H.RG.CallingAppEventSubscriptionNext,{clientId:o?.id})),!o)return l.error("[getSetupAppEventsInnerJob] Received undefined calling app event"),void d?.fail({reason:"undefined-calling-app-event"});if("CallingAppSetupEvent"===o.event.__typename&&o.event.result&&"CallingAppEventsSetupSuccess"===o.event.result.__typename)return l.log("[getSetupAppEventsInnerJob] Successfully subscribed."),u=!0,m.resolve(),void p?.stop();const{context:g}=o,{source:y}=g;l.log(`[getSetupAppEventsInnerJob] Received calling app event [event.id=${o.id}][context.externalId=${g.externalId}][source.name=${y.name}][source.description=${y.description}]`);try{await oQ(r,o,i,e,t,n,a,s),d?.stop()}catch(t){l.error(`Calling app event handler threw error. [error.name=${t?.name}][error.message=${t?.message}]`),d?.fail({errorCode:t.name,message:t.message,reason:"job-subscription-next-error"}),WJ({eventId:o.id,resolution:{error:{name:t?.errorCode||h.jK.HandleCallingAppEventError,message:t?.errorMessage||`Unhandled exception while handling calling app events in job [eventId=${o.id}]`}},context:{source:{name:"CallingAppEventJobHandlerError",description:`Error handling event in app job setup calling app events [eventId=${o.id} error.errorCode=${t?.errorCode}, error.message=${t?.errorMessage}]`}}},e,l)}},error:e=>{if(l.error(`[getSetupAppEventsInnerJob] Error in calling app events subscription [error.name=${e?.name}][error.message=${e?.message}]`),!u){const t=(0,de.Tr)(o,h.jK.SetupCallingAppEventsJobError,"",{},`[getSetupAppEventsInnerJob] error.name=${e?.name}, error.message=${e?.message}`);m.reject(t)}if(c){let t=a.findScenario(H.RG.CallingAppEventsSubscribe);t||(t=a.newScenario(H.RG.CallingAppEventsSubscribe)),t.fail({errorCode:e?.name,message:e?.message,reason:"app-job-subscription-error"})}},complete:()=>{if(c){a.newScenario(H.RG.CallingAppEventsUnsubscribe).stop()}}});return d?e=>{l.log(`Cleanup SetupCallingAppEventsJob called. reason: ${e}`),g?.unsubscribe(),UJ.unlockDeeplinkEntity(),UJ.setCallingAppEventsSubscribed(!1)}:m.promise},oQ=async(e,t,n,i,a,o,r,s)=>{const{id:l,event:c,context:d}=t;if(!("action"in c)||!("content"in c)){throw o.newLogger("appEventsHandler","apps-calling").error("[getSetupAppEventsInnerJob] Expected event of type CallingAppEvent, not CallingAppSetupEvent."),new Error("IncorrectCallingAppEventTypeError")}switch(c.content.__typename){case"AutoBrbDialogContent":!async function(e,t,n,i,a,o){const r=e.newLogger("handleAutoBrbDialogContentEvent","apps-calling"),{enableAutoBrbViaScenarioCallback:s}=i.get(b.J.Calling);if(!s)return void r.warn("handleAutoBrbDialogContentEvent should not be called if enableAutoBrbViaScenarioCallback is false");const{title:l,category:c,correlationId:d}=n;if(r.log("Auto Brb with dialog request received"),!(l&&c&&d&&o)){const e=`[handleAutoBrbDialogContentEvent] Error handling auto brb content event due to undefined commanding with [eventId=${o},`,t=qJ(o,"AutoBrbCommandingError",`Error converting auto brb content to commanding [eventId=${o}]`,"auto-brb-invalid-parameter",`Error in converting auto brb content to command, a required parameter is undefined [titleMissing: ${!!l}, categoryMissing: ${!!c}, correlationIdMissing: ${!!d}}, eventIdMissing: ${!!o}, eventId ${o}}]`);return void await zJ(t,a,r,e)}const u={feedbackSelectedCategory:n.category,feedbackText:n.title},m=C.D.AutoBrb,p={visibilityState:ke.fe.show,stateTransition:ke.su.new,correlation:{id:d,source:m}};try{t.brbFeedback.autoBrbFlowDialog(p,u);const e=`Show auto brb dialog command resolved successfully [eventId=${o}, correlationId=${d}]`,n=`[handleAutoBrbDialogContentEvent] Error when reporting show auto brb event "success" with [eventId=${o}, correlationId=${d},`,i=qJ(o,"AutoBrbCommandingSuccess",e);await zJ(i,a,r,n)}catch(e){const t=e?.name||"unknown-auto-brb-commanding-error-name",n=e?.message||"unknown-auto-brb-app-commanding-error-message";r.error(`[handleAutoBrbDialogContentEvent] Commanding error errorName=${t}, eventSource=${m}, errorMessage=${n}, correlationId: ${d}}, eventId: ${o}]`);const i="AutoBrbCommandingError",s=`Error triggering Auto Brb command [eventId=${o}, eventSource=${m}, correlationId: ${d}]`,l=`[handleAutoBrbDialogContentEvent] Error when reporting event "error" [eventId=${o}, eventSource=${m}, correlationId: ${d}, error.name=${e?.name}, error.message=${e?.message},`,c=qJ(o,i,s,t,n);await zJ(c,a,r,l)}}(o,a,c.content,n,i,l);break;case"MainAppContent":!async function(e,t,n,i,a){const o=e.newLogger("handleMainAppContentEvent","apps-calling"),r={id:a.context.externalId||"undefined",startTimestamp:a.context.timeStamp||"undefined",scenarioName:H.RG.CallingAppEventMainApp,source:C.D.CallingAppEvent};try{await t.deepLink.launchMainApp(r)}catch(e){const t=e?.name||"unknown-launch-main-app-commanding-error-name",a=e?.message||"unknown-launch-main-app-commanding-error-message";o.error(`[handleMainAppContentEvent] Commanding error errorName=${t}, eventSource=${r.source}, errorMessage=${a}]`);try{await WJ({eventId:i,resolution:{error:{name:t,message:a}},context:{source:{name:"MainAppCommandingError",description:`Error triggering launch main app command [eventId=${i}, eventSource=${r.source}]`}}},n,o)}catch(e){o.error(`[handleMainAppContentEvent] Error when reporting event "error" [eventId=${i}, eventSource=${r.source}, error.name=${e?.name}, error.message=${e?.message}]`)}return}o.log(`[handleMainAppContentEvent] Commanding success [eventId=${i}, eventSource=${r.source}]`);try{await WJ({eventId:i,resolution:{success:{_:!0}},context:{source:{name:"MainAppCommandingSuccess",description:`Command resolved successfully [eventId=${i}, eventSource=${r.source}]`}}},n,o)}catch(e){o.error(`[handleMainAppContentEvent] Error when reporting event "success" [error.name=${e?.name}, error.message=${e?.message}]`)}}(o,a,i,l,t);break;case"CallingWindowingContent":!async function(e,t,n,i,a,o,r,s){const l=e.newLogger("handleCallingWindowingContentEvent","apps-calling"),{entity:c,command:d}=PJ(i,a,o,r),u=UJ.unlockDeeplinkEntity();try{"AgentMonitorSession"===o.coordsType?await t.call.callMonitorById(o.id,{visibilityState:d.visibilityState,stateTransition:d.stateTransition,correlation:d.correlation}):await t.call.callById(c.id,{visibilityState:d.visibilityState,stateTransition:d.stateTransition,correlation:d.correlation},c?.linkedEntity?.id,c.type,u)}catch(e){const t=e?.name||"unknown-windowing-commanding-error-name",a=e?.message||"unknown-windowing-commanding-error-message";l.error(`[handleCallingWindowingContentEvent] Windowing commanding error [entity.id=${c.id}, errorName=${t}, errorMessage=${a}]`);try{await WJ({eventId:i,resolution:{error:{name:t,message:a}},context:{source:{name:"WindowingCommandingTriggerError",description:`Error triggering windowing command [eventId=${i}, entity.id=${c.id}]`}}},n,l)}catch(e){l.error(`[handleCallingWindowingContentEvent] Error when reporting event "error" [eventId=${i}, entity.id=${c.id}, error.name=${e?.name}, error.message=${e?.message}]`)}return}const{enableCallingAppCommandResolvedHook:m}=s.get(b.J.Calling);if(m)return;l.log(`[handleCallingWindowingContentEvent] Windowing commanding success [eventId=${i}, entity.id=${c.id}]`);try{await WJ({eventId:i,resolution:{success:{_:!0}},context:{source:{name:"WindowingCommandingSuccess",description:`Windowing command resolved successfully [eventId=${i}, entity.id=${c.id}]`}}},n,l)}catch(e){l.error(`[handleCallingWindowingContentEvent] Error when reporting event "success" [entity.id=${c.id}, error.name=${e?.name}, error.message=${e?.message}]`)}}(o,a,i,l,c,c.content,d,n);break;case"CallingToChatContent":!async function(e,t,n,i,a){const o=e.newLogger("handleCallingToChatContentEvent","apps-calling"),{entity:r,command:s}=function(e,t,n,i){const a=t.id,{action:{visibility:o}}=e,{externalId:r,timeStamp:s}=i,l=MJ(o,n),c=t.messageId?{id:t.messageId,type:Se.py.messages}:void 0;return{entity:{id:a,type:Se.py.chats,action:Se.uk.view,linkedEntity:c},command:{visibilityState:l,stateTransition:ke.su.new,correlation:{id:r||void 0,startTimestamp:s||void 0,source:C.D.CallingAppEvent}}}}(n,i,o,a);try{await t.chat.chatById(r.id,{entityCommand:{visibilityState:s.visibilityState,stateTransition:s.stateTransition,correlation:s.correlation},entityOptions:{messageId:r.linkedEntity?.id}})}catch(e){o.error(`[getSetupAppEventsInnerJob] Navigation to chat commanding error [entity.id: ${r.id}, error.name: ${e?.name}, error.message: ${e?.message}]`)}o.log(`[getSetupAppEventsInnerJob] Navigation to chat commanding success [entity.id: ${r.id}]`)}(o,a,c,c.content,d);break;case"CallingBreakoutRoomPanelContent":nQ({eventId:l,loggerFactory:o,entityCommanding:a,dataClient:i,event:c,content:c.content,context:d});break;case"CrossCloudMeetingJoinContent":!async function(e,t,n,i,{meetingUrl:a}){let o;const r=e.newLogger("handleCrossCloudMeetingJoinContentEvent","apps-calling");r.log("handleCrossCloudMeetingJoinContentEvent called");try{await t.deepLink.executeFromUrlV2(a,void 0,void 0),o={success:{_:!0}}}catch(e){const t=e?.name||"unknown-cross-cloud-meeting-join-content-event";o={error:{name:t,message:e?.message||"unknown-windowing-commanding-error-message"}},r.error(`[handleCrossCloudMeetingJoinContentEvent] Cross Cloud commanding error [meetingUrl=${a}, errorName=${t}]`)}try{await WJ({eventId:i,resolution:o,context:{source:{name:"WindowingCommandingTriggerError",description:`Error triggering windowing command [eventId=${i}]`}}},n,r)}catch(e){r.error(`[handleCrossCloudMeetingJoinContentEvent] Error when reporting event resolution [eventId=${i}, error.name=${e?.name}, error.message=${e?.message}]`)}}(o,a,i,l,c.content);break;case"CallingToChatListContent":!async function(e,t,n,i){const a=e.newLogger("handleCallingToChatListContentEvent","apps-calling"),{command:o}=function(e,t,n){const{action:{visibility:i}}=e,{externalId:a,timeStamp:o}=n,r=MJ(i,t);return{entity:{type:Se.py.chats,action:Se.uk.view},command:{visibilityState:r,stateTransition:ke.su.none,correlation:{id:a||void 0,startTimestamp:o||void 0,source:C.D.CallingAppEvent}}}}(n,a,i);try{await t.chat.chatList({visibilityState:o.visibilityState,stateTransition:o.stateTransition,correlation:o.correlation})}catch(e){a.error(`[getSetupAppEventsInnerJob] Navigation to chat list commanding error, error.name: ${e?.name}, error.message: ${e?.message}]`)}a.log("[getSetupAppEventsInnerJob] Navigation to chat list commanding success")}(o,a,c,d);break;case"CallingToCallListContent":!async function(e,t,n,i){const a=e.newLogger("handleCallingToCallListContentEvent","apps-calling"),{command:o}=function(e,t,n){const{action:{visibility:i}}=e,{externalId:a,timeStamp:o}=n,r=MJ(i,t);return{entity:{type:Se.py.callsmain,action:Se.uk.view},command:{visibilityState:r,stateTransition:ke.su.none,correlation:{id:a||void 0,startTimestamp:o||void 0,source:C.D.CallingAppEvent}}}}(n,a,i);try{await t.call.callList({visibilityState:o.visibilityState,stateTransition:o.stateTransition,correlation:o.correlation})}catch(e){a.error(`[getSetupAppEventsInnerJob] Navigation to call list commanding error, error.name: ${e?.name}, error.message: ${e?.message}]`)}a.log("[getSetupAppEventsInnerJob] Navigation to call list commanding success")}(o,a,c,d);break;case"CallingToSettingsPaneContent":!async function(e,t,n){const i=e.newLogger("handleCallingToSettingsPaneContentEvent","apps-calling"),a=function(e){const t=new Map([[xJ.Calling,RJ.Y.Calls],[xJ.Notifications,RJ.Y.Notifications],[xJ.Devices,RJ.Y.Devices],[xJ.PremiumBenefits,RJ.Y.Benefits],[xJ.Privacy,RJ.Y.Privacy]]);return{id:e.tabItemId?t.get(e.tabItemId):void 0,command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.CallingAppEvent}}}}(n),{id:o,command:r}=a;try{await t.settings.launchSection(o,r)}catch(e){i.error(`[getSetupAppEventsInnerJob] setting commanding error [entity.id: ${o}, error.name: ${e?.name}, error.message: ${e?.message}]`)}}(o,a,c.content);break;case"CallingBannerContent":!async function(e,t,n,i,a,o,r,s){const l=e.newLogger("handleCallingBannerContentEvent","apps-calling"),{enableCallingBannerContent:c}=s.get(b.J.Calling);if(!c)return;const d=GJ(a,o,r);if(!d){l.error("[handleCallingBannerContentEvent] Banner commanding error - no command to fire, visibility state is undefined");const e=`[handleCallingBannerContentEvent] Error in handling calling banner content event due to undefined commanding with [eventId=${i},`,t=qJ(i,"BannerContentToCommandingConversionError",`Error converting banner content to commanding [eventId=${i}]`,"Unknown-banner-commanding-error-name",`Unhandled exception while handling calling app events in job, error in converting banner content to command, visibility state is undefined [eventId=${i}]`);return void await zJ(t,n,l,e)}const{bannerPrimaryActionEntity:u,entityOptions:m,command:p,bannerDismissCommandEntity:g}=d,{action:{visibility:h}}=a;if("Show"===h)try{await t.shell.showBanner({id:o.id,text:o.text,intentLevel:o.intentLevel,action:o.actionButtonText?{text:o.actionButtonText,command:{entity:u,entityOptions:m,command:p},dismissOnAction:o.dismissOnAction}:void 0,dismissable:o.dismissable||void 0,dismissActionCommand:{entity:g,entityOptions:m,command:p},duration:o.duration,bannerScenario:o.bannerScenario,source:o.source});const e="ShowBannerSuccess",a=`Show banner command resolved successfully [eventId=${i}, entity.id=${u.id}]`,r=`[handleCallingBannerContentEvent] Error when reporting show banner event "success" with [eventId=${i}, entity.id=${u.id},`,s=qJ(i,e,a);await zJ(s,n,l,r)}catch(e){l.error(`Error is displaying banner through shell.showBanner with [entity.id: ${u.id}, error.name: ${e.name}, error.message: ${e.message}]`);const t=`[handleCallingBannerContentEvent] Error in handling calling banner content event due to failure of shell.showBanner with [eventId=${i},`,a=qJ(i,"ShowBannerError",`Error in showing banner through shell.showBanner [eventId=${i}]`,"Unknown-show-banner-error-name",`Unhandled exception while handling calling app events in job, failed to trigger shell.showBanner function, error in showing banner [eventId=${i}]`);await zJ(a,n,l,t)}if("Hide"===h)try{await t.shell.dismissBanner(o.id,o.source),l.log(`[dismissBanner] Successfully hiding the banner with [bannerId: ${o.id}] when call is no longer active.`);const e="DismissBannerSuccess",a=`Dismiss banner command resolved successfully [eventId=${i}, entity.id=${g.id}]`,r=`[handleCallingBannerContentEvent] Error when reporting dismiss banner event "success" with [eventId=${i}, entity.id=${g.id},`,s=qJ(i,e,a);await zJ(s,n,l,r)}catch(e){l.error(`Error in dismissing the banner when call is no longer active. entity.id: ${g.id}, entity.action: ${g.action}, error.name=${e.name}, error.message=${e.message}]`);const t=`[handleCallingBannerContentEvent] Error in handling calling banner content event due to failure of shell.dismissBanner with [eventId=${i},`,a=qJ(i,"DismissBannerError",`Error in dismissing banner through shell.dismissBanner [eventId=${i}]`,"Unknown-dismiss-banner-error-name",`Unhandled exception while handling calling app events in job, failed to trigger shell.dimissBanner function, error in dismissing banner [eventId=${i}]`);await zJ(a,n,l,t)}}(o,a,i,l,c,c.content,d,n);break;case"CallingLocalRecordingNotificationContent":!function(e,t,n){e.newLogger("handleCallingLocalRecordingNotificationEvent","apps-calling").log("Local recording notification event received",n.localRecordingNotificationType),t.toasts.showLocalRecordingAssemblyNotification(`${Date.now()}`,{title:n.title,text:n.text,mainImage:{alt:"",src:eQ[n.localRecordingNotificationType]},time:new Date,type:"LocalRecordingAssembly",quickReply:!1,conversationId:""})}(o,a,c.content);break;case"CallingDialogContent":!async function(e,t,n,i,a,o){const r=e.newLogger("handleCallingDialogContentEvent","apps-calling"),{id:s}=i,l=o.findScenarioByNameAndId(H.RG.CallingDialogOpen,s);l||r.error(`[getSetupAppEventsInnerJob] Cannot find calling_dialog_open scenario [dialogId: ${s}]`),l?.mark(H.ck.CallingDialogCallingAppEventReceived);const c=VJ(n,i,a);if(!c){const e="[getSetupAppEventsInnerJob] Dialog commanding error - no command to fire, command is undefined";return r.error(e),void l?.fail({errors:e,errorCode:"command-is-undefined"})}const{entity:d,entityOptions:u,command:m}=c;if(!d.type){const e=`[getSetupAppEventsInnerJob] Dialog commanding error - no command to fire, entity type is undefined [entity.id: ${d.id}]`;return r.error(e),void l?.fail({errors:e,errorCode:"entity-type-is-undefined"})}l?.mark(H.ck.BeforeCallingDialogEntityCommandTriggered);try{await t.call.openDialog(d,m,u)}catch(e){const t=`[getSetupAppEventsInnerJob] Dialog ENTITY commanding error [entity.id: ${d.id}, error.name: ${e?.name}, error.message: ${e?.message}]`;return r.error(t),void l?.fail({errors:t,errorCode:"open-dialog-commanding-error"})}l?.mark(H.ck.AfterCallingDialogEntityCommandTriggered),r.log(`[getSetupAppEventsInnerJob] Dialog commanding success [entity.id: ${d.id}]`)}(o,a,c,c.content,d,r);break;case"CallingNotificationContent":!async function(e,t,n,i,a,o,r,s,l,c,d){const u=e.newLogger("handleCallingNotificationContentEvent","apps-calling");let m;const p=(0,Re.v4)(),{enableIncomingCallCrossClientTelemetry:g}=r.get(b.J.Calling);g&&n.callId&&n.crossClientScenarioName&&(m=s.findScenarioByNameAndId(n.crossClientScenarioName,n.callId));const h=AJ(n,r,p);h.entityOptions&&r.get(b.J.Notifications).enableToastCollections&&(h.entityOptions.collectionId=HJ(c,d,u));if(await Promise.all([lQ(n,o,h,u,m),rQ(n,o,h,u,m)]),"CreateNotificationWithActions"===a.source?.name)if("Show"===i){let e;m?.mark(H.ck.CrossClientTriggerShowToast);try{e=await t.call.callNotification(h,n.id,p,"Show")}catch(e){m?.fail({errorCode:li.f.SubscriptionFailed,reason:"Subscription failed on show"});const t=e?.name,o=`${iQ}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${t}]`;u.errorToTelemetry?.(o,"call_command_subscription_error",void 0,!0)}try{!function(e,t,n,i){WJ({eventId:t,resolution:e?{success:{_:!0}}:{error:{name:"Notification dropped",message:`Call Notification was not executed, notification might be dropped for expected reasons [eventId=${t}]`}},context:{source:{name:"CallingAppEventJobHandlerError",description:`Commading call notification [eventId=${t}] [notificationResult=${e}]`}}},n,i)}(e,l,o,u)}catch(e){m?.mark(H.ck.CrossClientCallingNotificationError);const t=e?.name,o=`${iQ}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${t}]`;u.errorToTelemetry?.(o,"call_command_notification_error",void 0,!0)}}else{m?.mark(H.ck.CrossClientTriggerHideToast);try{await t.call.callNotification(h,n.id,p,"Hide")}catch(e){m?.fail({errorCode:li.f.SubscriptionFailed,reason:"Subscription failed on hide"}),u.error(`${iQ}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${e?.name}, error.message: ${e?.message}]`)}}else{if("UpdateNotification"!==a.source?.name)return m?.fail({errorCode:li.f.SubscriptionFailed,reason:`Invalid context.source.name [${a.source?.name}]`}),void u.error(`${iQ}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error invalid context.source.name [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}`);m?.mark(H.ck.CrossClientTriggerUpdateToast);try{await t.call.callNotification(h,n.id,p,"Show")}catch(e){m?.fail({errorCode:li.f.SubscriptionFailed,reason:"Subscription failed on update"}),u.error(`${iQ}${n.id}:[handleCallingNotificationContentEvent] Notification commanding error on [${a.source?.name}] [[content.id: ${n.id}], entity.id: toasts, visibility: ${i.toString()}, error.name: ${e?.name}, error.message: ${e?.message}]`)}}m?.mark(H.ck.CrossClientEntityCommandTriggered),u.log(`${iQ}${n.id}:[handleCallingNotificationContentEvent] Notification commanding success [content.id: ${n.id}][entity.id: toasts][visibility: ${i.toString()}]`)}(o,a,c.content,c.action.visibility,d,i,n,r,l,e,s)}};async function rQ(e,t,n,i,a){try{const o=await async function(e,t){try{const n=await e.query({query:OJ,fetchPolicy:"network-only"});return n?n.data.priorityContacts.map((e=>e.id)):(t.error(`${iQ}[handleCallingNotificationContentEvent] Failed to fetch priority contacts`),[])}catch(e){return t.error(`${iQ}[handleCallingNotificationContentEvent] Failed to fetch priority contacts`),[]}}(t,i);n.entityOptions.isUrgent=o.includes(e.userid),a?.mark(H.ck.PriorityContactsFetched)}catch(t){i.error(`${iQ}${e.id}:[handleCallingNotificationContentEvent] Error when fetching priority contacts. Error: ${t}`)}}async function sQ(e,t,n,i,a,o,r){try{const s=o?await async function(e,t,n){if(!n?.length)return null;const i=await e.query({query:LJ,variables:{msaGroupInfo:{pictureReadyUsers:n.map((({id:e,displayName:t})=>({userId:e,displayName:t}))).slice(0,4),conversationId:t}}});return i?.data.msaGroupProfilePicture}(e,r||"",o):await async function(e,t,n){const i=await e.query({query:jJ,variables:{userId:t,displayName:n,profilePictureSize:"HR96x96"}});return i?.data.msaUserProfilePicture}(e,t,n);if(!s)return void a.error(`${iQ}${i}:[handleCallingNotificationContentEvent] Failed to generate avatar image url`);const l=await e.query({query:$J,variables:{url:s}});return l?.data.toastImageAsDataUri||void 0}catch(e){return void a.error(`${iQ}${i}:[handleCallingNotificationContentEvent] failed to fetch avatar image. Error.name: ${e?.name}, error.message: ${e?.message}`)}}async function lQ(e,t,n,i,a){try{let o,r;e.userid&&n.entityOptions?.mainImage?o=sQ(t,e.userid,e.title,e.id,i):e.members?.length&&n.entityOptions?.mainImage&&"HuddleMeetingStart"===n.entityOptions?.targetEntity?.dataOptions?.toastType?o=sQ(t,"",e.title,e.id,i,e.members,e.conversationId||""):i.log("[handleCallingNotificationContentEvent] Primary avatar not fetched, user id or main image property is not present on the content."),e.header?.mri&&n.entityOptions?.headerImage&&(r=sQ(t,e.header.mri,e.header.subtitle,e.id,i));const[s,l]=await Promise.all([o,r]);s&&(n.entityOptions.mainImage={src:s,alt:e.title??""},a?.mark(H.ck.CrossClientAvatarFetched)),l&&(n.entityOptions.headerImage={src:l,alt:e.header?.subtitle??""})}catch(e){i.error(`[handleCallingNotificationContentEvent] failed handle avatar fetches. Error: ${e}`)}}var cQ=n(974065);const dQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingSetCallStatePresenceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingClientState"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingClientStatePresence"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setCallStatePresence"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingClientState"},value:{kind:"Variable",name:{kind:"Name",value:"callingClientState"}}}]}]}}]},uQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"callingClientStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingClientStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingClientStateEvent"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"callingClientStateEvent"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingClientStateEvent"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"inCall"}},{kind:"Field",name:{kind:"Name",value:"isScreenSharing"}}]}}]}.definitions]},mQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"updateClientStateVeryActive"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isVeryActive"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UpdateClientStateSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateClientStateVeryActive"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isVeryActive"},value:{kind:"Variable",name:{kind:"Name",value:"isVeryActive"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}]}]}}]},pQ=(e,t,n)=>async()=>{const i=t.newLogger("getCallingClientEventsJob","apps-calling"),{enableCallingEventJobsCleanup:a}=n.get(b.J.Calling),o=e.subscribe({query:uQ,fetchPolicy:"no-cache"}).subscribe((async({data:n,errors:a})=>{if(a){const e=a.map((e=>e.message));i.error(`handleCallingClientStateEvent: Error receiving callingClientStateEvent [Errors: ${e.join()}]`)}else n&&(i.log(`handleCallingClientStateEvent: Processing callingClientStateEvent [Received: ${(0,$.u4)(n)}]`),async function(e,t,n){const i=e.newLogger("handleCallingClientStateEvent","apps-calling");i.log(`Event received: ${(0,$.u4)(t)}`);try{await n.mutate({mutation:mQ,variables:{isVeryActive:t.inCall||t.isScreenSharing,source:"Calling"}})}catch(e){i.error(`mutation updateClientStateVeryActiveDocument error, error.name: ${e?.name}, error.message: ${e?.message}]`)}}(t,n.callingClientStateEvent,e),n.callingClientStateEvent.inCall&&n.callingClientStateEvent.isScreenSharing?(gQ(t,"Presenting",e),hQ("ScreenSharing",e)):n.callingClientStateEvent.inCall?(gQ(t,"InACall",e),hQ("InCall",e)):(gQ(t,"NotInACall",e),hQ("None",e)))}));if(a){return e=>{i.log(`Cleanup CallingClientEventsJob called. reason: ${e}`),o?.unsubscribe()}}};async function gQ(e,t,n){const i=e.newLogger("setCallingClientStatePresence","apps-calling");i.log(`Call state presence received: ${t}`);try{await n.mutate({mutation:dQ,variables:{callingClientState:t}})}catch(e){i.error(`mutation AppsCallingSetCallStatePresenceMutationDocument error, error.name: ${e?.name}, error.message: ${e?.message}]`)}}async function hQ(e,t){await t.mutate({mutation:cQ.b,variables:{newState:e},fetchPolicy:"no-cache"})}var yQ=n(279457),vQ=n(710745);function fQ(e,t,n,i,a){const o=n.newLogger("emergency-location-notification-job-logger","apps-shell");return{id:"emergency-location-notification",job:async()=>{const n=i.stringTranslate(b.J.Calling,"emergency_manage_location_button_text"),r=e.subscribe({query:yQ.x}).subscribe((({data:e})=>{if((0,vQ.uF)(e?.emergencyAddressUpdatedEvent)){const a=((e,t)=>{const n=e.stringTranslate(b.J.Calling,"emergency_location_needs_confirmation_banner_text"),i=e.stringTranslate(b.J.Calling,"emergency_location_not_detected_banner_text");return"CLS"===t?.type?n:!t||t.editable&&"None"===t.type?i:""})(i,e?.emergencyAddressUpdatedEvent);!function(e,t,n){n.shell.showBanner({id:"E911LocationBanner",source:C.D.ShellE911LocationChange,bannerScenario:"emergency_location_banner",intentLevel:"Severe",cause:"EmergencyLocationBanner",text:e,action:{text:t,command:{entity:{type:Se.py.locationnotificationbanner,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.ShellE911LocationChange}}},dismissOnAction:!0},dismissable:!0,duration:0})}(a,n,t)}else t.shell.dismissBanner("E911LocationBanner",C.D.ShellE911LocationChange);a&&a()}));return()=>{r.unsubscribe(),o.log("[location] unsubscribing ...")}}}}const SQ=(e,t,n,i,a,o,r,s,l)=>{const{enableCallingStackInitialization:c,enableCallingClientEvents:d,enableCallingAppEvents:u,enableEmergencyLocationGlobalBanner:m}=a.get(b.J.Calling),p=[];if(c){const t=kQ(i,H.RG.StandupCallingAppJob,o);p.push(wJ(e,n,o,i,a)),t.mark(H.ck.JobAdded),t.stop()}return u&&p.push(((e,t,n,i,a,o,r,s)=>({id:"setup-calling-app-events",runOncePerId:!0,job:aQ(e,t,n,i,a,o,r,s)}))(e,t,n,a,i,o,l,s)),d&&p.push(((e,t,n)=>({id:"calling-client-events",runOncePerId:!0,job:pQ(e,t,n)}))(e,n,a)),m&&r&&p.push(fQ(e,t,n,r)),p},kQ=(e,t,n)=>{let i=e.findScenario(t);return i||(i=e.newScenario(t)),i.mark(n),i},CQ=({context:{authenticationUser:e,client:t,coreSettings:n,entityCommanding:i,i18n:a,loggerFactory:o,scenarioFactory:r,userTrackingService:s}})=>SQ(t,i,o,r,n,H.ck.OnAppPreWarm,a,s,e),bQ=({context:{client:e,coreSettings:t,entityCommanding:n,loggerFactory:i,scenarioFactory:a}})=>SQ(e,n,i,a,t,H.ck.OnAppPreInit);var wQ;!function(e){e.EmptyDeeplinkUrl="empty-deeplink-url-received",e.MeetingCodeParse="meeting-code-parse-error",e.LegacyCoordinatesParse="legacy-coordinates-parse-error",e.EmptyContext="empty-context-received",e.EmptyParsedUrlParams="empty-parsed-url-params",e.None="no-entity-command-expected",e.PresentDeepLinkT2Disabled="present-deeplink-t2-disabled",e.EmptySearch="empty-search-url",e.MeetingShareDeepLinkT2Disabled="meeting-share-deeplink-t2-disabled"}(wQ||(wQ={}));const TQ=e=>({visibilityState:ke.fe.show,stateTransition:e?ke.su.flush:ke.su.new,layoutMode:e?ke.lO.standard:ke.lO.focus}),IQ=(e,t)=>{if("null"!==e)return e;const n=t.get("fqdn");return n?`https://${n}`:void 0},NQ=(e,t)=>t.get("fqdn")||(0,Mz.uO)(e),EQ={filter:"/meet/meet-now",execute:({deeplinkUrl:{pathname:e,search:t},context:{loggerFactory:n,coreSettings:i,scenarioFactory:a}})=>{const o=a.newScenario(H.RG.SeamlessMeetNowLaunchDeeplinkCondition),r=n.newLogger("[Calling][onBeforeDeeplinkParsed][/meeting/meet-now]","apps-calling"),{enableSeamlessMeetNowLaunchFromOutlook:s,enableDeeplinkFlushCommand:l}=i.get(b.J.Calling);if(o.mark(H.ck.SeamlessMeetNowLaunchDeeplinkConditionEnabled),!s){const e="Flag enableSeamlessMeetNowLaunchFromOutlook is not enabled. Skipping deeplink processing.";return r.debug(e),o.cancel({reason:e}),Promise.resolve(void 0)}r.infoToTelemetry&&r.infoToTelemetry(`MeetNow launch from Outlook deeplink condition executed. Pathname: ${e}`,"cmd_meeting_join",void 0,!1),r.log(`Parsing pathname: ${e}, search: ${t}, enableSeamlessMeetNowLaunchFromOutlook: ${s}`);const c=TQ(!!l);return r.infoToTelemetry&&r.infoToTelemetry(`Requesting entity command: ${c}.`,"cmd_meeting_join",void 0,!1),o.stop({reason:H.ck.SeamlessMeetNowLaunchDeeplinkConditionExecuted}),Promise.resolve({entityCommand:{entity:{type:Se.py.callingdeeplink,action:Se.uk.join},command:c,entityOptions:{deeplinkUrl:e,coordinates:{joinType:"MeetingData",meetingData:{},isAdhoc:!0}}},metadata:{allowAnonymous:!1}})}};var AQ=n(882066);const _Q=e=>"tel:"===e||"callto:"===e,FQ={filter:({protocol:e})=>_Q(e),execute:async({deeplinkUrl:{pathname:e,protocol:t},context:{coreSettings:n,loggerFactory:i}})=>{const a=i.newLogger("[Calling][OnBeforeDeeplinkParsed][CallingProtocol]","apps-calling"),{enableCallWithUsersDeeplink:o}=n.get(b.J.Calling);if(!o||!_Q(t)){const e=`enableCallWithUsersDeeplink=${o} or protocol=${t} is not supported`;throw a.warnToTelemetry?.(e,"calling_protocol_deeplink_condition",void 0,!0),new Error(e)}a.infoToTelemetry?.(`Returning calling protocol dialog intent for protocol=${t}`,"calling_protocol_deeplink_condition",void 0,!0),e=decodeURIComponent(e);const r=(0,AQ.TE)(e);return{entityCommand:{entity:{type:Se.py.callingprotocoldeeplinkdialog,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,layoutMode:ke.lO.standard},entityOptions:{protocol:t,target:e,isPSTNNumber:r}},metadata:{allowAnonymous:!1}}}},DQ="/l/meetup-join",PQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingHandlePresentDeeplinkMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ver"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pptContext"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"handlePresentDeepLink"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ver"},value:{kind:"Variable",name:{kind:"Name",value:"ver"}}},{kind:"Argument",name:{kind:"Name",value:"deeplinkId"},value:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}}},{kind:"Argument",name:{kind:"Name",value:"pptContext"},value:{kind:"Variable",name:{kind:"Name",value:"pptContext"}}}]}]}}]},MQ={filter:"/l/present",execute:async({deeplinkUrl:{search:e},context:{coreSettings:t,loggerFactory:n,__doNotUse_globalDataClient:i}})=>{const{enablePresentDeepLinkForMTMA:a}=t.get(b.J.Calling),o=n.newLogger("[Calling][onBeforeDeeplinkParsed][/present]","apps-calling");if(o.log(`EnablePresentToTeamsT2: ${a}. Parsing search length: ${e.length}`),!a)return Promise.reject({message:wQ.PresentDeepLinkT2Disabled});if(""===e)return Promise.reject({message:wQ.EmptySearch});const r=new URLSearchParams(e),s=r.get("ver"),l=r.get("deeplinkId"),c=r.get("pptContext");if(o.log(`Parsed params ver: ${s}, deeplinkId: ${l}`),!s||!l||!c)return Promise.reject({message:wQ.EmptyParsedUrlParams});let d;try{d=await i.mutate({mutation:PQ,variables:{ver:s,deeplinkId:l,pptContext:c}})}catch(e){throw o.errorToTelemetry?.(e.message,"cmd_meetings_pptsharing_handle_present_deeplink_mutation_error"),new Error(e.message)}return d&&d.data&&!d.data.handlePresentDeepLink?Promise.resolve({entityCommand:{entity:{type:Se.py.presentdeeplinknomeetingcontextdialog,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,layoutMode:ke.lO.standard}},metadata:{allowAnonymous:!1}}):void 0}},xQ=e=>{const[,,t,n]=e.pathname.split("/"),{users:i,withVideo:a}=(({searchParams:e})=>{const t=(e.get("users")||"").trim(),n="true"===(e.get("withVideo")||"").toLocaleLowerCase();if(0===t.length)return{users:[],withVideo:n};const i=t.split(",").filter(Boolean).map((e=>e.toLocaleLowerCase()));return{users:[...new Set(i)],withVideo:n}})(e);return{type:t,containerId:n,users:i,withVideo:a}},RQ={filter:"/l/call",execute:async({deeplinkUrl:e,context:{coreSettings:t,loggerFactory:n}})=>{const i=n.newLogger("[Calling][OnBeforeDeeplinkParsed][CallingDeeplink]","apps-calling"),{enableCallingDeeplink:a}=t.get(b.J.Calling),o=(0,$E.P)(e,t),{type:r,containerId:s,users:l,withVideo:c}=xQ(o),d=JSON.stringify({type:r,containerId:s,usersCount:l.length});if(!a||!(e=>{const{type:t,containerId:n,users:i}=xQ(e);return"call"===t&&"0"===n&&i.length>0})(o)){const e=`Skip rendering deeplink dialog: enableCallingDeeplink=${a}, infoFromUrl=${d}`;throw i.warnToTelemetry?.(e,"calling_deeplink_navigation",void 0,!0),new Error(e)}return i.infoToTelemetry?.(`Render deeplink dialog: infoFromUrl=${d}`,"calling_deeplink_navigation",void 0,!0),{entityCommand:{entity:{type:Se.py.callingdeeplinkDialog,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,layoutMode:ke.lO.standard},entityOptions:{users:l,withVideo:c}},metadata:{allowAnonymous:!1}}}},jQ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingHandleMeetingShareDeeplinkMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appContext"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"handleShareDeeplinkToStage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"deeplinkId"},value:{kind:"Variable",name:{kind:"Name",value:"deeplinkId"}}},{kind:"Argument",name:{kind:"Name",value:"appContext"},value:{kind:"Variable",name:{kind:"Name",value:"appContext"}}}]}]}}]},LQ={filter:"/l/meeting-share",execute:async({deeplinkUrl:{search:e},context:{coreSettings:t,loggerFactory:n,getUserContexts:i}})=>{const{enableDeepLinkShareExtensibleApp:a}=t.get(b.J.Calling),o=n.newLogger("[Calling][onBeforeDeeplinkParsed][/meeting-share]","apps-calling");o.log(`enableDeepLinkShareExtensibleAppT2: ${a}. Parsing search length: ${e.length}`);const r=await i(),s=r[r.length-1].context.client;if(!a)return Promise.reject({message:wQ.MeetingShareDeepLinkT2Disabled});if(""===e)return Promise.reject({message:wQ.EmptyParsedUrlParams});const l=new URLSearchParams(e),c=l.get("deeplinkId"),d=l.get("appContext");if(o.log(`Parsed params - deeplinkId: ${c}`),!c||!d)return o.errorToTelemetry?.(`Empty Params for either deeplinkId or AppContext -deeplinkId: ${c}`,"cmd_meetings_appsharing_handle_meetingshare_deeplink"),Promise.reject({message:wQ.EmptyParsedUrlParams});let u;try{u=await s.mutate({mutation:jQ,variables:{deeplinkId:c,appContext:d}})}catch(e){throw o.errorToTelemetry?.(e.message,"cmd_meetings_appsharing_handle_meetingshare_deeplink"),new Error(e.message)}return u&&u.data&&!u.data.handleShareDeeplinkToStage?Promise.resolve({entityCommand:{entity:{type:Se.py.presentdeeplinknomeetingcontextdialog,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,layoutMode:ke.lO.standard}},metadata:{allowAnonymous:!1}}):void 0}},OQ=[EQ,FQ,{filter:e=>{if(!(e.pathname.startsWith(DQ)||e.pathname.startsWith("/v2"+DQ)))return!1;const t=new URLSearchParams(e.search).get("context");if(!t)return!1;try{const{IsBroadcastMeeting:e}=JSON.parse(t);return!e}catch(e){return!t.includes("IsBroadcastMeeting")}},execute:({deeplinkUrl:e,context:{coreSettings:t,loggerFactory:n},homeCloud:i})=>{const a=n.newLogger("[Calling][onBeforeDeeplinkParsed][/l/meetup-join]","apps-calling"),o=e=>{a.infoToTelemetry?.(`Legacy deepling condition: ${e}`,"cmd_meeting_join",void 0,!1)};o("Execution started");const r=decodeURIComponent(e.href),s=new URL(r),{pathname:l,search:c,origin:d}=s,{allowAnonymousMeetingJoin:u,enableDeeplinkFlushCommand:m}=t.get(b.J.Calling);if(a.log(`Parsing pathname: ${l}, search: ${c}, allowAnonymousMeetingJoin: ${u}`),!l)return Promise.reject({message:wQ.EmptyDeeplinkUrl});const p=l.split(/[/?&]/),g=p.indexOf("meetup-join")+1,h=p[g],y=p[g+1],v=new URLSearchParams(c);v.set("anon","true");const f=v.get("context");if(!f)return Promise.reject({message:wQ.EmptyContext});const S=v.get("pp"),{Tid:k,Oid:C,MessageId:w,prid:T,isPublic:I}=JSON.parse(f);if(!(h&&y&&k&&C)){const e=`${h?"":"empty-conversationId"} ${y?"":"empty-rootMessageId"} ${k?"":"empty-tenantId"} ${C?"":"empty-organizerId"}`;return a.infoToTelemetry?.(`Legacy deepling condition Promise.reject(${e}).`,"cmd_meeting_join",void 0,!1),Promise.reject({message:wQ.LegacyCoordinatesParse,reason:e})}let N;const E=IQ(d,v);E&&(N=`${E}/_#${l}?${v.toString()}`),o(`deeplink origin present: ${!!E}`);const A={joinType:"Legacy",conversationId:h,messageId:w||y,rootMessageId:y,isChannel:"0"!==y,isAdhoc:!1,tenantId:k,organizerId:C,meetingCloud:NQ(d,v),participantPin:S,registration:T?{participantRegistrationId:T,isPublicEvent:I||!1}:null},_=v.get("deeplinkId");a.log(`Resolving ${JSON.stringify(A)}`),o(`Requesting entity command. deeplinkId: ${_}`);const F=TQ(!!m);return o(`Resolving legacy deeplink condition with coordinates. deeplinkId: ${_}`),Promise.resolve({entityCommand:{entity:{type:Se.py.callingdeeplink,action:Se.uk.join,id:`${h}/${y}`},command:F,entityOptions:{deeplinkUrl:l,coordinates:A,directMeetingLink:N,homeCloud:i,deeplinkId:_,correlationId:v.get("correlationId")||void 0,context:v.get("ctx")||void 0,laEntry:v.get("laEntry")||void 0,laExpId:v.get("laExpId")||void 0}},metadata:{allowAnonymous:u||!1,tenantId:k,prioritizeUserContextId:"true"===v.get("prioritizeUserContextId")||void 0}})}},{filter:({pathname:e})=>e.startsWith("/meet/")||e.startsWith("/v2/meet/"),execute:({deeplinkUrl:{pathname:e,search:t,origin:n},context:{coreSettings:i,loggerFactory:a},homeCloud:o})=>{const r=a.newLogger("[Calling][onBeforeDeeplinkParsed][/meet]","apps-calling");r.infoToTelemetry?.("Meet deepling condition executed.","cmd_meeting_join",void 0,!1);const{allowAnonymousMeetingJoin:s,defaultAnonTenantId:l,enableDeeplinkFlushCommand:c}=i.get(b.J.Calling),{enableXboxWatchparties:d}=i.get(b.J.WindowsSignatureExperiences);if(r.log(`Parsing pathname: ${e}, search: ${t}, allowAnonymousMeetingJoin: ${s}`),!e)return Promise.reject({message:wQ.EmptyDeeplinkUrl});const u=e.split(/[/?&]/),m=u.indexOf("meet"),p=u[m+1];if(!p||-1===m)return Promise.reject({message:wQ.MeetingCodeParse});const g=new URLSearchParams(t);let h,y;g.set("anon","true");const v=IQ(n,g);v&&(h=`${v}/_#${e}?${g.toString()}`,y=`${v}${e}${t}`);const f=g.get("deeplinkId");r.infoToTelemetry?.(`Requesting entity command. deeplinkId: ${f}`,"cmd_meeting_join",void 0,!1);const S=TQ(!!c);return r.log(`Resolving ${p}`),r.infoToTelemetry?.(`Resolving meet deeplink condition, deeplinkId=${f}`,"cmd_meeting_join",void 0,!1),Promise.resolve({entityCommand:{entity:{type:Se.py.callingdeeplink,action:Se.uk.join,id:p},command:S,entityOptions:{deeplinkUrl:e,coordinates:{joinType:"MeetingData",meetingData:{meetingCode:p,passcode:g.get("p"),meetingUrl:y},participantPin:g.get("pp"),isAdhoc:!1,meetingCloud:NQ(n,g)},directMeetingLink:h,homeCloud:o,deeplinkId:f,correlationId:g.get("correlationId")||void 0,laEntry:g.get("laEntry")||void 0,laExpId:g.get("laExpId")||void 0,context:g.get("ctx")||void 0,isWatchParty:"true"===g.get("isWatchParty")&&d}},metadata:{allowAnonymous:s||!1,tenantId:l||void 0,prioritizeUserContextId:"true"===g.get("prioritizeUserContextId")||void 0}})}},MQ,{filter:"/convene/events",execute:({deeplinkUrl:{pathname:e,search:t,origin:n},context:{coreSettings:i,loggerFactory:a}})=>{const o=a.newLogger("[Calling][onBeforeDeeplinkParsed][events]","apps-calling"),{enableEmbedForTownhallStreamingAttendees:r}=i.get(b.J.Streaming);if(!r)return Promise.resolve(void 0);const{allowAnonymousMeetingJoin:s}=i.get(b.J.Calling);if(o.log(`Parsing pathname: ${e}, search: ${t}, allowAnonymousMeetingJoin: ${s}`),!e)return Promise.reject({message:wQ.EmptyDeeplinkUrl});if(!e.startsWith("/convene/events"))return Promise.reject({message:wQ.MeetingCodeParse});const l=new URLSearchParams(t);l.set("anon","true");const c=`${n}/_#${e}?${l.toString()}`,d=l.get("url");if(!d)return Promise.reject({message:wQ.MeetingCodeParse});const u="true"===l.get("hidePrejoin"),m=new URL(d),p=decodeURIComponent(m.pathname).split("/").find((e=>e.startsWith("19:")))??"",g=m.searchParams.get("context");if(!g)return Promise.reject({message:wQ.MeetingCodeParse});const{Tid:h,Oid:y,prid:v}=JSON.parse(g),f=m.searchParams.get("displayName");return Promise.resolve({entityCommand:{entity:{type:Se.py.events,action:Se.uk.join},command:{visibilityState:ke.fe.show,stateTransition:ke.su.none,layoutMode:ke.lO.standard,correlation:{id:(0,Re.v4)(),startTimestamp:Date.now(),source:C.D.CallingOnBeforeDeeplinkParsed}},entityOptions:{embedUrl:c,meetingUrl:d,threadId:p,messageId:"0",tenantId:h,organizerId:y,registrationId:v,displayName:f,shouldShowPrejoinScreen:!u}},metadata:{allowAnonymous:s||!1,tenantId:h}})}},RQ,LQ],$Q={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==Se.py.callingdeeplink&&e.mainEntity?.type!==Se.py.calls,shouldRestoreClientToEntities:e=>e.mainEntity?.type!==Se.py.callingdeeplink&&e.mainEntity?.type!==Se.py.calls},UQ="Calling",BQ="hideUbar",WQ="unhideUbar",HQ=()=>({originator:UQ,type:BQ}),VQ=()=>({originator:UQ,type:WQ}),GQ={onEventReceived:({eventInput:e})=>{switch(e.event.type){case YV.uS.requestPersonMoreInfo:const t=e.event.data?.();return Promise.resolve({command:nG(t)});case vO.uS.showMonitor:return Promise.resolve({command:Nt.CN.showMonitor(e.event.data?.())});case vO.uS.closeMonitor:return Promise.resolve({command:Nt.CN.closeMonitor()});case vO.uS.hideMonitor:return Promise.resolve({command:Nt.CN.hideMonitor()});case vO.uS.unhideMonitor:return Promise.resolve({command:Nt.CN.unhideMonitor()});case BQ:return Promise.resolve({command:Nt.CN.hideHeader()});case WQ:return Promise.resolve({command:Nt.CN.unhideHeader()})}return Promise.resolve(void 0)}},zQ=({appRenderMode:e,coreSettings:t})=>{const n=new MV.H,{criticalPhaseTimeout:i}=t.get(b.J.Calling);return e!==Mt.S.Main||n.registerAppPhase({phase:yt.nh.CRITICAL,signals:[xV.G.CALLING_SCREEN_RENDERED],timeout:i||9e4}),n.appPhases};var qQ=n(671885);const JQ=e=>{if(QQ(e))return YQ(e)?{subNavEntity:XQ(e),headerEntity:ZQ(e),startEntity:eK(e),mainEntity:tK(e),endEntity:nK(e)}:null},QQ=({layoutMode:e,entity:t,contextEntity:n})=>{const{action:i=null,type:a}={...t},o=[ke.lO.focus,ke.lO.standard].includes(e),r=[Se.py.callingdeeplink,Se.py.calls,Se.py.callsmonitor,Se.py.meetings,Se.py.events,Se.py.meetingcollaboration,Se.py.meetingroomallinonecall,Se.py.yammerqna].includes(a),s=[Se.uk.create,Se.uk.default,Se.uk.list,Se.uk.view,Se.uk.join],l=i&&s.includes(i)||a===Se.py.callingdeeplink&&!i&&!!n;return!!(o&&r&&l)},KQ=[Se.py.identity,Se.py.tflfre],YQ=({contextEntity:e})=>!e||!KQ.includes(e.type),XQ=()=>null,ZQ=({entity:e,contextEntity:t})=>e.type===Se.py.callingdeeplink||e.type===Se.py.events?t||null:e,eK=()=>null,tK=({entity:e,contextEntity:t})=>e.type===Se.py.callingdeeplink&&t?.type===Se.py.calls?t:e,nK=({contextEntity:e})=>{const t=[Se.py.byodchat,Se.py.chats,Se.py.devicesettings,Se.py.meetings,Se.py.extensions,Se.py.transcript,Se.py.meetingdetails,Se.py.roster,Se.py.byodroster,Se.py.breakoutroomspanel,Se.py.yammerqna,Se.py.accessibilitypanel,Se.py.meetingcollaboration,Se.py.closedcaptionssettings,Se.py.videobackgrounds,Se.py.extensibilityapppickercallingpanel,Se.py.stagecustomizationpanel,Se.py.roomremote,Se.py.audiosettings,Se.py.videoeffectsandsettings];return e&&e.action&&t.includes(e.type)||e?.action===Se.uk.info&&e?.type===Se.py.calls||e?.action===Se.uk.health&&e?.type===Se.py.calls?e:null},iK=({entity:e,coreSettings:t,themeOptions:n})=>{const{enableLightThemeSupport:i=!1,forceDisableTitleBar:a=!1,renderHeaderAtBottomForCalls:o=!1,enableSmartDeviceLayout:r=!1,monitorSlotPosition:s=qQ.Y.BottomRight}=t?.get(b.J.Calling)??{},{enableCollapsibleUbar:l=!1}=t?.get(b.J.Streaming)??{},c=new Set([Se.py.calls,Se.py.meetingroomallinonecall]),d=n?.isCallingWindowDarkTheme;return e?.type===Se.py.callsmonitor||e?.type===Se.py.callingdialog?{mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!!a,doesHeaderOverlapMain:!1,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:!i||d,UNSAFE_enablePptProvider:!0}},headerEntity:{[Mt.S.HorizontalBar]:{slotHeightOverrides:"5.4rem",doesHeaderOverlapMain:!1,isBackgroundTransparent:!0}}}:{mainEntity:{[Mt.S.Main]:{forceDisableTitleBar:!!a,doesHeaderOverlapMain:!!l,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:!i||d,canOverrideMeetingTheme:!1,UNSAFE_enablePptProvider:!0}},headerEntity:{[Mt.S.HorizontalBar]:{slotHeightOverrides:"auto",doesHeaderOverlapMain:!!l,isBackgroundTransparent:!1,renderHeaderAtBottom:!(!o&&!r||void 0===e?.type||!c.has(e.type))}},endEntity:{[Mt.S.Rail]:{doesHeaderOverlapMain:e?.type===Se.py.videobackgrounds,isBackgroundTransparent:!!e&&aK.includes(e.type),isHideInfoPaneDisabled:!0}},monitorEntity:{[Mt.S.Monitor]:{areaRectangle:{height:"auto",position:s,width:"32rem"},draggableAreaHeight:"3.2rem"}}}},aK=[Se.py.videobackgrounds,Se.py.videoeffectsandavatar,Se.py.videoeffectscustomization,Se.py.videoeffectsmoreview,Se.py.stylemyroom,Se.py.videoeffectsandsettings],oK={id:"com.microsoft.teams.calling",name:"Calls",supportedEntities:[Se.py.callingdeeplink,Se.py.callingdeeplinkDialog,Se.py.callingprotocoldeeplinkdialog,Se.py.calls,Se.py.callscontent,Se.py.callsgallery,Se.py.callsgalleryandcontent,Se.py.meetingroomallinonecall,Se.py.callsmonitor,Se.py.cameraeffects,Se.py.contentcamerasetup,Se.py.callingalertdialog,Se.py.callingdialog,Se.py.callingbannernotification,Se.py.callingconfirmdialog,Se.py.unparkcalldialog,Se.py.usermediadialog,Se.py.devicesettings,Se.py.audiosettings,Se.py.notes,Se.py.mediastreams,Se.py.meetingdetails,Se.py.meetings,Se.py.meetingstream,Se.py.roster,Se.py.pstncallmedialog,Se.py.videobackgrounds,Se.py.stylemyroom,Se.py.broadcastqna,Se.py.transcript,Se.py.shareMeetingInfo,Se.py.stagecontent,Se.py.breakoutroomspanel,Se.py.invisionwhiteboard,Se.py.videoeffectscustomization,Se.py.videoeffectsmoreview,Se.py.videoeffectsandavatar,Se.py.videoeffectsandsettings,Se.py.windowingerrordialog,Se.py.restartrecomendeddialog,Se.py.stagingroomstartmeetingconfirmationdialog,Se.py.meshavatar,Se.py.events,Se.py.yammerqna,Se.py.roomremote,Se.py.accessibilitypanel,Se.py.closedcaptionssettings,Se.py.meetingcollaboration,Se.py.presentdeeplinknomeetingcontextdialog,Se.py.floatingmonitor,Se.py.byodattendeewindow,Se.py.stagecustomizationpanel,Se.py.byodroster,Se.py.extensibilityapppickercallingpanel],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Modal,Mt.S.Rail,Mt.S.Monitor],windowFeatures:{otherEntityTypes:{minWidth:800,width:800,minHeight:670,height:600},[Se.py.callingdialog]:{width:700,height:400,top:300,left:400,additionalFeatures:{transparent:"true"}},[Se.py.callsmonitor]:{height:247,width:304,additionalFeatures:{alwaysOnTop:"true",resizable:"false",fullscreenable:"false",maximizable:"false",closable:"false",hideWindowControl:"true",frame:"false",contentprotection:"true",excludeWindowFromScreenSharing:"true",closeoverride:"true",visibleOnAllWorkspaces:"true",positionClientArea:"true"}},[Se.py.byodattendeewindow]:{minWidth:100,width:800,minHeight:100,height:600,additionalFeatures:{contentprotection:"true",excludeWindowFromScreenSharing:"true"}},[Se.py.calls]:{additionalFeatures:{closePrompt:"meeting"}}},shouldErrorOnEntityCommandTimeout:!0},rK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"triggerCallingToastAction"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"notificationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actionType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerCallingToastAction"},arguments:[{kind:"Argument",name:{kind:"Name",value:"notificationId"},value:{kind:"Variable",name:{kind:"Name",value:"notificationId"}}},{kind:"Argument",name:{kind:"Name",value:"actionType"},value:{kind:"Variable",name:{kind:"Name",value:"actionType"}}}]}]}}]},sK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"fireCallingIntent"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fireCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntent"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},lK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingMoveUpcomingMeetingToPastMeetingsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"moveUpcomingMeetingToPastMeetings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}]}]}}]};var cK=n(461618);const dK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallingTriggerBannerActionMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"bannerId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actionName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"BannerAction"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerBannerAction"},arguments:[{kind:"Argument",name:{kind:"Name",value:"bannerId"},value:{kind:"Variable",name:{kind:"Name",value:"bannerId"}}},{kind:"Argument",name:{kind:"Name",value:"actionName"},value:{kind:"Variable",name:{kind:"Name",value:"actionName"}}}]}]}}]},uK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingBroadcastRoleQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"roleHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"joinId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"broadcast"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}},{kind:"Argument",name:{kind:"Name",value:"roleHint"},value:{kind:"Variable",name:{kind:"Name",value:"roleHint"}}},{kind:"Argument",name:{kind:"Name",value:"joinId"},value:{kind:"Variable",name:{kind:"Name",value:"joinId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"userRole"}},{kind:"Field",name:{kind:"Name",value:"byoe"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isEnabled"}}]}},{kind:"Field",name:{kind:"Name",value:"streamResource"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"encoderSource"}}]}}]}}]}}]},mK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingCallByCallIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamsCallIdByCallId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callId"},value:{kind:"Variable",name:{kind:"Name",value:"callId"}}}]}]}}]},pK={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCallingCallMeetingInfoQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callMeetingInfo"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"organizerId"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}}]}}]}}]},gK=async(e,t,n,i)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:a}=e.coreSettings.get(b.J.Calling);if(a&&i.infoToTelemetry?.(`handleBroadcastDeeplink. correlationId=${t.command.correlation.id}`,"app_on_before_command_handled_info"),!t.entityOptions){const e="[handleDeeplink] No entity options";return i.error(e),Promise.reject(e)}const{coordinates:o,roleHint:r}=t.entityOptions,{tenantId:s,organizerId:l,conversationId:c,messageId:d,broadcast:u}=o,{allowBroadcastProducerJoinsInT2:m}=e.coreSettings.get(b.J.Broadcast),p=`${s}__${l}__${c}__${d}`,g=await(async(e,t,n,i,a,o)=>{const r=e.newScenario(H.RG.BroadcastResolveRole);r.appendEventData({correlationId:a});try{const{data:e}=await t.query({query:uK,variables:{id:n,roleHint:i,joinId:a}});return o.log(`[getBroadcastRole] userRole: ${e.broadcast.userRole}`),r.stop({"Call.BroadcastRole":e.broadcast.userRole}),e.broadcast}catch(e){return o.log("[getBroadcastRole] error: broadcastRoleQuery failed"),r.fail({"Call.BroadcastRole":null,broadcastError:"broadcastRoleQuery failed"}),{userRole:"None",streamResource:null,byoe:null}}})(e.scenarioFactory,n,p,r,t.command.correlation.id,i),h=u?.role||g.userRole;return yK(g,h,e,m||!1)?(i.infoToTelemetry?.(`[handleBroadcastMeetingRedirect] launch launchUnsupportedDeeplink with userRole - ${h} and correlationId ${t.command.correlation.id} succeeded`,"cmd_meetings_virtual_events_broadcast_trigger_unsupported_deeplink_dialog_success"),{...t,entity:{...t.entity,type:Se.py.unsupporteddeeplinkdialog,action:Se.uk.view},command:{...t.command,layoutMode:ke.lO.standard,stateTransition:ke.su.extend,visibilityState:ke.fe.show}}):hK(h,m||!1)?(t.entityOptions={...t.entityOptions,coordinates:{...o,broadcast:{role:h}}},vK(e,t,i)):{...t,entity:{...t.entity,id:p,type:Se.py.broadcasts,action:Se.uk.view},command:{...t.command,visibilityState:ke.fe.show,stateTransition:ke.su.new,layoutMode:ke.lO.focus},entityOptions:{...t.entityOptions,threadId:c,messageId:d,tenantId:s,organizerId:l}}},hK=(e,t)=>"Contributor"===e||"Producer"===e&&t,yK=(e,t,n,i)=>"Producer"===t&&!i||"Contributor"===t&&n.platformService?.config.clientType===An.Bh.Web||!!e.byoe?.isEnabled&&null===e.streamResource?.encoderSource||"Contributor"!==t&&!!e.byoe?.isEnabled&&"teams"===e.streamResource?.encoderSource,vK=async(e,t,n)=>{const{coordinates:i}=t.entityOptions,a=UJ.getDeeplinkEntityLocked(),{enableAppOnBeforeCommandHandledExtraTelemetry:o}=e.coreSettings.get(b.J.Calling);if(o&&n.infoToTelemetry?.(`handleLockedDeeplink. coordinates=${JSON.stringify(i)} - locked=${a}`,"app_on_before_command_handled_info"),a||!a&&UJ.getCallingAppEventsSubscribed())return UJ.getDeeplinkReady()&&(n.log("[handleDeeplink] awaiting getDeeplinkReady"),await UJ.getDeeplinkReady()),fK(e,t,n);const{conversationId:r,rootMessageId:s}=i,l=`${r}/${s}`;if(!l){const e="[handleDeeplink] Deeplink entity cannot be locked because lockId is undefined";return n.error(e),Promise.reject(e)}return n.log("[handleDeeplink] lockDeeplinkEntity"),UJ.lockDeeplinkEntity(l),t},fK=async(e,t,n)=>{const i=t.entityOptions,{coordinates:a,deeplinkId:o}=i,{enableAppOnBeforeCommandHandledExtraTelemetry:r}=e.coreSettings.get(b.J.Calling);r&&n.infoToTelemetry?.(`handleDeeplink. coordinates=${JSON.stringify(a)} - deeplinkId=${o} - correlationId=${t.command.correlation.id}`,"app_on_before_command_handled_info");const s=(0,Ut.sM)(a,o);return n.log("[handleDeeplink] triggering fireCallingIntent mutation"),e.client.mutate({mutation:sK,variables:{callingIntent:s}}).then((()=>{n.log("[handleDeeplink] fireCallingIntent succeeded")})).catch((e=>(n.error(`failed to fireCallingintent with ${(0,ce.A)(e)}`),Promise.reject(e))))},SK=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},dataOptions:a},requestContext:o,requestContext:{client:r}}=e,{allowBroadcastPresenterJoinsInT2:s,allowBroadcastProducerJoinsInT2:l}=o.coreSettings.get(b.J.Broadcast),{enableMeetNowLinksReminder:c}=o.coreSettings.get(b.J.Host),{enableAppOnBeforeCommandHandledExtraTelemetry:d,enableSeamlessMeetNowLaunchFromOutlook:u}=o.coreSettings.get(b.J.Calling),m=o.loggerFactory.newLogger("CallingOnBeforeCommandHandled","apps-calling");if(_K(m,`CallingOnBeforeCommandHandled. type=${n} - action=${i} - correlationId=${t.command.correlation.id}`,!!d),TK(n,i))return IK(o,t,m);if(((e,t)=>e===Se.py.callingbannernotification&&t===Se.uk.join)(n,i))return((e,t)=>{const n=e.loggerFactory.newLogger("CallingBannerCommandHandler[handleBannerPrimaryAction]","apps-calling");if(!t.entityOptions){const e=`Error when handling banner's primary action, join click since entity options is undefined for entityId=${t.entity.id}, entityType=${t.entity.type} and entityAction=${t.entity.action}`;return n.error(e),Promise.reject(new Error(e))}return e.client.mutate({mutation:dK,variables:{bannerId:t.entity.id,actionName:"PrimaryAction"}})})(o,t);if(((e,t)=>e===Se.py.callingbannernotification&&t===Se.uk.delete)(n,i))return((e,t)=>{const n=e.loggerFactory.newLogger("CallingBannerCommandHandler[handleBannerDismiss]","apps-calling");if(!t.entityOptions){const e=`Error when handling banner dismiss since entity options is undefined for entityId=${t.entity.id}, entityType=${t.entity.type} and entityAction=${t.entity.action}`;return n.error(e),Promise.reject(new Error(e))}return e.client.mutate({mutation:dK,variables:{bannerId:t.entity.id,actionName:"DismissAction"}})})(o,t);if(CK(n,i,t.entityOptions||{}))return gK(o,t,r,m);if(wK(n,i)){const{coordinates:e}=t.entityOptions,n=UJ.getDeeplinkEntityLocked(),{deeplinkUrl:i}=t.entityOptions;if(_K(m,`shouldHandleDeeplink. coordinates=${JSON.stringify(t.entityOptions)}} - locked=${n} - correlationId=${t.command.correlation.id}`,!!d),n||!n&&UJ.getCallingAppEventsSubscribed())return UJ.getDeeplinkReady()&&await(async e=>{e.log("[handleDeeplink] awaiting getDeeplinkReady"),await UJ.getDeeplinkReady()})(m),c&&await(async(e,t,n)=>e.mutate({mutation:lK,variables:{id:n.entityOptions?.deeplinkId}}).catch((()=>(t.errorToTelemetry?.("[CallingToastActionMutationFailed] failed","calling_deeplink_navigation"),Promise.reject(li.f.CallingToastActionMutationFailed)))))(r,m,t),NK(o,t,m);let a=(0,cK.N6)(e)?`${e.conversationId}/${e.rootMessageId}`:e.meetingData.meetingCode||(e.meetingData.meetingUrl?(e=>{const t=e.split(/[/?&]/);return t[t.indexOf("meet")+1]})(e.meetingData.meetingUrl):void 0);if(!a&&u&&(e=>!!e&&e.includes("meet/meet-now"))(i)&&(a=(0,Re.v4)()),!a)return(e=>{const t="[handleDeeplink] Deeplink entity cannot be locked because lockId is undefined";return e.errorToTelemetry?.(t,"calling_deeplink_navigation"),Promise.reject(t)})(m);_K(m,`[handleDeeplink] lockDeeplinkEntity. lockId=${a} - correlationId=${t.command.correlation.id}`,!!d),UJ.lockDeeplinkEntity(a)}return a&&kK(n,i,a)?EK(a,s,l,r,t):Promise.resolve(t)},kK=(e,t,n)=>!!bK(n)&&(!!n.toastId&&e===Se.py.calls&&t===Se.uk.mutate&&"Unknown"!==n.actionType),CK=(e,t,n)=>e===Se.py.callingdeeplink&&t===Se.uk.join&&!!n.isBroadcastMeeting,bK=e=>void 0!==e.toastId,wK=(e,t)=>e===Se.py.callingdeeplink&&t===Se.uk.join,TK=(e,t)=>e===Se.py.meetings&&t===Se.uk.join,IK=(e,t,n)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:i}=e.coreSettings.get(b.J.Calling);if(_K(n,`handleMeetingJoin. correlationId=${t.command.correlation.id}`,!!i),!t.entityOptions||!t.entityOptions.callingIntent){const e=`entityOptions must be of type IMeetingJoinOptions. entity.id=${t.entity.id} - correlationId=${t.command.correlation.id} - source=${t.command.correlation.source}`;return _K(n,e,!!i,!0),Promise.reject(e)}const{callingIntent:a}=t.entityOptions,{correlation:o}=t.command;return _K(n,`[handleMeetingJoin] triggering fireCallingIntent mutation. correlationId=${o.id}`,!!i),AK(e,n,a,o.id)},NK=async(e,t,n)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:i}=e.coreSettings.get(b.J.Calling);if(_K(n,`handleDeeplink. correlationId=${t.command.correlation.id}`,!!i),!t.entityOptions){const e="[handleDeeplink] No entity options";return _K(n,e,!!i,!0),Promise.reject(e)}const{correlation:a}=t.command,o=t.entityOptions,{coordinates:r,deeplinkId:s,isWatchParty:l,homeCloud:c,correlationId:d,context:u}=o;let m;return m=l?(0,Ut.W5)(s):(0,Ut.sM)(r,s,c,d,u),_K(n,"[handleDeeplink] triggering fireCallingIntent mutation",!!i),AK(e,n,m,a.id)},EK=async(e,t,n,i,a)=>{const o=e,r=o.toastId,s=o.actionType;return s?"AcceptIncomingCallThroughPrejoin"===s&&t&&!n&&await(async(e,t)=>{if(!e||!t)return!1;const{data:n}=await t.query({query:mK,variables:{callId:e}});if(!n||!n.teamsCallIdByCallId)return!1;const{data:i}=await t.query({query:pK,variables:{id:n.teamsCallIdByCallId}});if(!i||!i.callMeetingInfo)return!1;const a=(0,_z.l0)(i.callMeetingInfo?.tenantId,i.callMeetingInfo?.organizerId,i.callMeetingInfo?.threadId,i.callMeetingInfo?.messageId),{data:o}=await t.query({query:uK,variables:{id:a}});return"Producer"===o?.broadcast?.userRole})(o.callId,i)?Promise.resolve({...a,entity:{...a.entity,type:Se.py.unsupporteddeeplinkdialog,action:Se.uk.view},command:{...a.command,layoutMode:ke.lO.standard,stateTransition:ke.su.extend,visibilityState:ke.fe.show}}):i.mutate({mutation:rK,variables:{notificationId:r,actionType:s}}).then((()=>{})).catch((()=>Promise.reject(li.f.CallingToastActionMutationFailed))):Promise.reject(li.f.CallsActionTypeToNotificationActionFailed)},AK=async(e,t,n,i)=>{const{enableAppOnBeforeCommandHandledExtraTelemetry:a}=e.coreSettings.get(b.J.Calling),o=DK(n),r=FK(e.scenarioFactory,o,i);return e.client.mutate({mutation:sK,variables:{callingIntent:o},context:{correlationId:i}}).then((()=>{_K(t,`fireCallingIntent succeeded. navigation_command correlationId=${i}`,!!a)})).catch((e=>{const n=`failed to fireCallingintent with ${(0,ce.A)(e)}`;return _K(t,n,!!a,!0),r.fail({message:n}),Promise.reject(e)}))},_K=(e,t,n=!1,i=!1)=>{i?(e.error(t),n&&e.errorToTelemetry?.(t,"app_on_before_command_handled_info")):(e.log(t),n&&e.infoToTelemetry?.(t,"app_on_before_command_handled_info"))},FK=(e,t,n)=>{const i=e.newScenario(H.RG.FireCallingIntent),a=t.coordinates,o=t.joinOptions?.meeting;return i.appendEventData({secondaryCorrelationId:n,context:t.joinOptions?.context||""}),o&&i.appendEventData({correlationId:o.correlationId||"",homeCloud:o.homeCloud||"",deeplinkId:o.deeplinkId||""}),a.legacyMeeting?i.appendEventData({threadId:a.legacyMeeting.conversationId,messageId:a.legacyMeeting.messageId,organizerId:a.legacyMeeting.organizerId,meetingTenantId:a.legacyMeeting.tenantId}):a.meetingData&&i.appendEventData({meetingCode:a.meetingData.meetingCode||""}),i},DK=e=>e.joinOptions?.meeting?{...e,joinOptions:{...e.joinOptions,meeting:{...e.joinOptions.meeting,correlationId:e.joinOptions.meeting.correlationId||e.joinOptions.meeting.deeplinkId||(0,Re.v4)()}}}:e,PK=e=>{return t=e.entityCommand.entity.type,Se.py.callingdialog===t&&(({requestContext:e,result:t})=>t===Ju.Incomplete&&"main"===e.client.name&&e.error?.errorCode===ct.y.UserContextMismatch)(e);var t};var MK;!function(e){e.Success="Success",e.Failure="Failure"}(MK||(MK={}));const xK=[Se.py.calls,Se.py.callsgalleryandcontent,Se.py.callscontent,Se.py.callsgallery,Se.py.meetingroomallinonecall,Se.py.callsmonitor],RK=async e=>{const{entityCommand:{entity:{type:t,action:n},command:{visibilityState:i,correlation:a}},requestContext:{coreSettings:o,loggerFactory:r}}=e,s=r.newLogger("CallingApp[onCommandResult]","apps-calling"),{enableBlockUnsanctionedAppEventsResolution:l,enableCallingAppCommandResolvedHook:c,enableCallingAppEventLogging:d,enableDialogWindow:u,enableWindowingFailOnNonSuccess:m}=o.get(b.J.Calling);if(c){if(t===Se.py.breakoutroomspanel&&a.source===C.D.CallingAppEvent)return jK(e,!!m);if(xK.includes(t)&&n===Se.uk.view){if(l&&!a.id.includes("calling-app-event")){const e=`CMD windowing triggered outside of calling app event. [correlationId:${a.id}, source:${a.source}, correlatedScenario:${a.scenarioName}]`;return void(d?s.errorToTelemetry?.(e,"cmd_horizontals_app_events",void 0,!0):s.warn(e))}if(s.log(`[onCommandResult] Windowing command with visibilityState: ${i}, correlation: ${a.id}, type: ${t}, action: ${n}`),i===ke.fe.show)return jK(e,!!m)}return u&&PK(e)?(async e=>{const{entityCommand:{entity:t,command:n,entityOptions:i},requestContext:{entityCommanding:a,scenarioFactory:o}}=e;if(!i)throw new Error("[handleDialogContainerCommand] Error no entityOptions");const{entity:r,command:s,options:l}=i;if(!t.id)throw new Error(`[handleDialogContainerCommand] Error no dialog id: [type: ${r.type}]`);const c=o.findScenarioByNameAndId(H.RG.CallingDialogOpen,t.id);try{c?.mark(H.ck.BeforeCallingDialogContainerCommandTriggered),await a.call.openDialog(r,s,l,{correlation:n.correlation,stateTransition:ke.su.new,visibilityState:ke.fe.show})}catch(e){throw c?.fail({errors:`[handleDialogContainerCommand] Error calling dialog container command: [type: ${r.type}, dialogId: ${t.id}, error.name: ${e?.name}, error.message: ${e?.message}]`,errorCode:"dialog-container-commanding-error"}),new Error(`[handleDialogContainerCommand] Error calling dialog container command: [type: ${r.type}, dialogId: ${t.id}, error.name: ${e?.name}, error.message: ${e?.message}]`)}c?.mark(H.ck.AfterCallingDialogContainerCommandTriggered)})(e):void 0}},jK=async(e,t)=>{const{entityCommand:{entity:{id:n},command:{correlation:{id:i}}},result:a,requestContext:{client:o,loggerFactory:r,scenarioFactory:s,error:l}}=e,c=r.newLogger("CallingApp[onCommandResult]","apps-calling");let d,u;const m=a===Ju.Failure;if(t?"WindowNotUpdated"!==l?.errorCode?.toString()&&a!==Ju.Success:m){d=MK.Failure;const e=n?s.findScenarioByNameAndId(H.RG.CallingWindowPopoutIntent,n):void 0;e?.mark("OnAfterCommandResolved"),e?.appendEventData({errorCode:l?.errorCode||h.jK.CallingCallsViewCommandError,message:l?.errorMessage||"[onCommandResult] Window Rendering command for a call resulted in Failure or Incomplete.",context:"CallingApp"}),u=LK(d,i,n,l)}else d=MK.Success,u=LK(d,i,n);try{await WJ(u,o,c)}catch(l){throw c.error(`[handleCallingWindowingContentEvent] Error when reporting event "${d}" [entity.id=${n}, error.name=${l.name}, error.message=${l.message}]`),new Error(`onCommandResult[error.name=${l.name},error.message=${l.message}]::resolveCallingAppEvent::${d}`)}},LK=(e,t,n,i)=>e===MK.Success?{eventId:t,resolution:{success:{_:!0}},context:{source:{name:"WindowingCommandingSuccess",description:`Windowing command resolved successfully [eventId=${t}, entity.id=${n}]`}}}:{eventId:t,resolution:{error:{name:i?.errorCode||h.jK.CallingCallsViewCommandError,message:i?.errorMessage||`[onCommandResult] calls-view command resolved with an error [eventId=${t}][entity.id=${n}]`}},context:{source:{name:"WindowingCommandingTriggerError",description:`Error processing windowing command [eventId=${t}, entity.id=${n}, error.errorCode=${i?.errorCode}, error.message=${i?.errorMessage}]`}}};var OK=n(743749),$K=n(629494),UK=n(768385),BK=n(883282);const WK=(0,BG.s)({flexContainer:{mc9l5x:"ftgm304"}},{d:[".ftgm304{display:block;}"]}),HK=({isHeader:e,children:t})=>{const{enableCollapsibleUbar:n}=(0,$K.NC)(b.J.Streaming,["enableCollapsibleUbar"]),i=(0,BK.useNovaEventing)(),a=WK(),o=hO.useCallback((e=>{i.bubble({reactEvent:e,event:VQ()})}),[i]),r=hO.useCallback((e=>{i.bubble({reactEvent:e,event:HQ()})}),[i]);return(0,gO.t)(UK.k,{fill:!0,hAlign:"center",vAlign:"center",className:e?a.flexContainer:"",...!!n&&{onPointerLeave:e=>{r(e)},onPointerEnter:e=>{o(e)}},"data-testid":"embedded-events-layout-manager",children:t})},VK=e=>{const{entity:{type:t,action:n}}=e;if(t===Se.py.calls&&n===Se.uk.view)return H.RG.CallingEntityCommandCallsView};var GK=n(379263),zK=n(112020),qK=n(483902),JK=n(994575),QK=n(899617),KK=n(439809),YK=n(922790),XK=n(980026);const ZK=(0,BG.s)({isWebCallMonitorWrapper:{Bbmb7ep:["fclariu","fyjfh2l"],Beyfa6y:["fyjfh2l","fclariu"],B7oj6ja:["f11xeu6h","f1knf8zw"],Btl43ni:["f1knf8zw","f11xeu6h"],B4j52fo:"ftac7j7",Bekrc4i:["f1w0yd9v","f1h0xgbp"],Bn0qgzm:"fdwcyh7",ibv6hh:["f1h0xgbp","f1w0yd9v"],icvyot:"fzkkow9",vrafjx:["fcdblym","fjik90z"],oivjwe:"fg706s2",wvpqe5:["fjik90z","fcdblym"],g2u3we:"fgybt4j",h3c5rm:["fm8sagc","f10vrri"],B9xav0g:"f1pr7p4w",zhjwy3:["f10vrri","fm8sagc"],Bqenvij:"fk3a66p",a9b677:"fly5x3f"},isWebCallMonitorWrapperWithinMCM:{Bqenvij:"fk3a66p",a9b677:"fly5x3f"},isWebCallMonitorUbar:{a9b677:"fly5x3f",Bqenvij:"fyhdfh7"},isWebCallMonitorCallingScreen:{a9b677:"fly5x3f",Bqenvij:"f1l02sjl"}},{d:[".fclariu{border-bottom-right-radius:3px;}",".fyjfh2l{border-bottom-left-radius:3px;}",".f11xeu6h{border-top-right-radius:3px;}",".f1knf8zw{border-top-left-radius:3px;}",".ftac7j7{border-top-width:2px;}",".f1w0yd9v{border-right-width:2px;}",".f1h0xgbp{border-left-width:2px;}",".fdwcyh7{border-bottom-width:2px;}",".fzkkow9{border-top-style:solid;}",".fcdblym{border-right-style:solid;}",".fjik90z{border-left-style:solid;}",".fg706s2{border-bottom-style:solid;}",".fgybt4j{border-top-color:var(--colorStrokeFocus2);}",".fm8sagc{border-right-color:var(--colorStrokeFocus2);}",".f10vrri{border-left-color:var(--colorStrokeFocus2);}",".f1pr7p4w{border-bottom-color:var(--colorStrokeFocus2);}",".fk3a66p{height:25.7rem;}",".fly5x3f{width:100%;}",".fyhdfh7{height:7.2rem;}",".f1l02sjl{height:100%;}"]}),eY=({ubar:e,callingScreen:t})=>{const n=(0,$K.NC)(b.J.Calling),i=ZK(),{intentIdOverride:a}=(0,zK.Te)();return a?(0,gO.t)(UK.k,{"data-tid":"floating-call-monitor",column:!0,className:n.enableMultiCallMonitorForWeb?i.isWebCallMonitorWrapperWithinMCM:i.isWebCallMonitorWrapper,children:[(0,gO.t)(XK.W,{className:i.isWebCallMonitorUbar,children:e}),(0,gO.t)(XK.W,{className:i.isWebCallMonitorCallingScreen,children:t})]}):null},tY=({ubar:e,callingScreen:t})=>{const n=(0,$K.NC)(b.J.Calling),{id:i}=(0,GK.sV)().getEntityOptions(Se.py.floatingmonitor,Se.uk.view);return n.enableMultiCallMonitorForWeb?(0,gO.t)(UK.k,{"data-tid":"floating-monitor",column:!0,children:(0,gO.t)(eY,{ubar:e,callingScreen:t})}):(0,gO.t)(zK.UN,{intentIdOverride:i,children:(0,gO.t)(UK.k,{"data-tid":"floating-monitor",column:!0,children:(0,gO.t)(eY,{ubar:e,callingScreen:t})})})},nY=(0,BG.s)({isWebMultiCallMonitorWrapper:{a9b677:"fly5x3f",Bqenvij:"f1l02sjl",De3pzq:"f1dmdbja",Bbmb7ep:["fclariu","fyjfh2l"],Beyfa6y:["fyjfh2l","fclariu"],B7oj6ja:["f11xeu6h","f1knf8zw"],Btl43ni:["f1knf8zw","f11xeu6h"],B4j52fo:"ftac7j7",Bekrc4i:["f1w0yd9v","f1h0xgbp"],Bn0qgzm:"fdwcyh7",ibv6hh:["f1h0xgbp","f1w0yd9v"],icvyot:"fzkkow9",vrafjx:["fcdblym","fjik90z"],oivjwe:"fg706s2",wvpqe5:["fjik90z","fcdblym"],g2u3we:"fgybt4j",h3c5rm:["fm8sagc","f10vrri"],B9xav0g:"f1pr7p4w",zhjwy3:["f10vrri","fm8sagc"]},isIconWrapper:{a9b677:"fly5x3f",Bqenvij:"f3ra7uv",De3pzq:"f1dmdbja",Brf1p80:"f4d9j23",Bt984gj:"f122n59"}},{d:[".fly5x3f{width:100%;}",".f1l02sjl{height:100%;}",".f1dmdbja{background-color:var(--colorNeutralBackground2);}",".fclariu{border-bottom-right-radius:3px;}",".fyjfh2l{border-bottom-left-radius:3px;}",".f11xeu6h{border-top-right-radius:3px;}",".f1knf8zw{border-top-left-radius:3px;}",".ftac7j7{border-top-width:2px;}",".f1w0yd9v{border-right-width:2px;}",".f1h0xgbp{border-left-width:2px;}",".fdwcyh7{border-bottom-width:2px;}",".fzkkow9{border-top-style:solid;}",".fcdblym{border-right-style:solid;}",".fjik90z{border-left-style:solid;}",".fg706s2{border-bottom-style:solid;}",".fgybt4j{border-top-color:var(--colorStrokeFocus2);}",".fm8sagc{border-right-color:var(--colorStrokeFocus2);}",".f10vrri{border-left-color:var(--colorStrokeFocus2);}",".f1pr7p4w{border-bottom-color:var(--colorStrokeFocus2);}",".f3ra7uv{height:1.5rem;}",".f4d9j23{justify-content:center;}",".f122n59{align-items:center;}"]});var iY=n(224611),aY=n(609446),oY=n(503720),rY=n(217394),sY=n(119579),lY=n(557687),cY=n(564087),dY=n(681971),uY=n(332534),mY=n(202992),pY=n(181091);const gY=(0,BG.s)({isMultiCallListItemWrapper:{Bt984gj:"f122n59",a9b677:"fly5x3f",Bqenvij:"fyw3hzw",jrapky:"f1itd6yx",B6of3ja:"f10kaskc",De3pzq:"f1dmdbja",z8tnut:"fttrv26",z189sj:["fymo3i9","ff1nj48"],Byoj8tv:"f6p0d5s",uwmqm3:["ff1nj48","fymo3i9"]},isMultiCallListItemButtonContainer:{Brf1p80:"f9c4gz4",a9b677:"f43i5ed"},isResumeCallButton:{Jwef8y:"ftrin2t",ecr2s2:"fazgzzr",iro3zm:"ff7k10l",f5ssp4:"f1kntyx9"},isLeaveCallButton:{Jwef8y:"fpsin02",ecr2s2:"f1au4jtj",iro3zm:"fmvue4i",f5ssp4:"f1mcyvn2",t0hwav:"f14p701a",g1a405:"fabs2s9",B1wtsvt:["f13fn5ob","f757zx4"],dm7nc1:"f17rcxh0",n6tcun:["f757zx4","f13fn5ob"]},isStatusText:{sj55zd:"f11d4kpn"},isCallInfo:{Haddrg:"f14ujvnu",a9b677:"fr584hq",Frg6f3:["f9swhlu","f1wift5j"],t21cq0:["f1wift5j","f9swhlu"]},isCallTitle:{B68tc82:"f1p9o1ba",Bmxbyg5:"f1sil6mw",Huce71:"fz5stix"}},{d:[".f122n59{align-items:center;}",".fly5x3f{width:100%;}",".fyw3hzw{height:6rem;}",".f1itd6yx{margin-bottom:0.1rem;}",".f10kaskc{margin-top:0.1rem;}",".f1dmdbja{background-color:var(--colorNeutralBackground2);}",".fttrv26{padding-top:1.5rem;}",".fymo3i9{padding-right:1.5rem;}",".ff1nj48{padding-left:1.5rem;}",".f6p0d5s{padding-bottom:1.5rem;}",".f9c4gz4{justify-content:flex-end;}",".f43i5ed{width:30%;}",".f11d4kpn{color:var(--colorNeutralForeground3);}",".f14ujvnu{over-flow:hidden;}",".fr584hq{width:50%;}",".f9swhlu{margin-left:1.5rem;}",".f1wift5j{margin-right:1.5rem;}",".f1p9o1ba{overflow-x:hidden;}",".f1sil6mw{overflow-y:hidden;}",".fz5stix{white-space:nowrap;}"],h:[".ftrin2t:hover{background-color:var(--colorCompoundBrandForeground1);}",".ff7k10l:hover:active{background-color:var(--colorCompoundBrandForeground1);}",".fpsin02:hover{background-color:var(--colorPaletteRedBackground3);}",".fmvue4i:hover:active{background-color:var(--colorPaletteRedBackground3);}"],a:[".fazgzzr:active{background-color:var(--colorCompoundBrandForeground1);}",".f1au4jtj:active{background-color:var(--colorPaletteRedBackground3);}"],f:[".f1kntyx9:focus{background-color:var(--colorCompoundBrandForeground1);}",".f1mcyvn2:focus{background-color:var(--colorPaletteRedBackground3);}",".f14p701a:focus{color:var(--colorNeutralForeground1Selected);}",".fabs2s9:focus{border-top-color:var(--colorNeutralStroke1Selected);}",".f13fn5ob:focus{border-right-color:var(--colorNeutralStroke1Selected);}",".f757zx4:focus{border-left-color:var(--colorNeutralStroke1Selected);}",".f17rcxh0:focus{border-bottom-color:var(--colorNeutralStroke1Selected);}"]});var hY=n(440960);const yY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetCallTitleQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getCallTitle"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}]}]}}]},vY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetParticipantsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"participantCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"nParticipants"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}},{kind:"Argument",name:{kind:"Name",value:"participantCount"},value:{kind:"Variable",name:{kind:"Name",value:"participantCount"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},fY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorToggleHoldCallMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context"}},type:{kind:"NamedType",name:{kind:"Name",value:"ToggleHoldCallContext"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toggleHoldCall"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}},{kind:"Argument",name:{kind:"Name",value:"context"},value:{kind:"Variable",name:{kind:"Name",value:"context"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},SY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorStopCallMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"stopOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"StopOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"stopCall"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callId"},value:{kind:"Variable",name:{kind:"Name",value:"callId"}}},{kind:"Argument",name:{kind:"Name",value:"context"},value:{kind:"Variable",name:{kind:"Name",value:"context"}}},{kind:"Argument",name:{kind:"Name",value:"stopOptions"},value:{kind:"Variable",name:{kind:"Name",value:"stopOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},{useState:kY,useEffect:CY,useCallback:bY}=hO,wY=({callId:e,callHeldAt:t,title:n,callState:i,extendedCallState:a,callStateTitle:o,isServerHold:r,failureType:s,showDuration:l})=>{const c=gY(),d=(0,uY.Cq)(),u=bY((t=>(0,gO.t)(rY.x,{"data-testid":`multi-call-list-item-${e}-duration`,className:c.isStatusText,size:200,children:t})),[e,c.isStatusText]);return(0,gO.t)(UK.k,{className:c.isCallInfo,"data-testid":`multi-call-list-item-${e}-title`,column:!0,children:[(0,gO.t)(rY.x,{className:c.isCallTitle,size:300,children:n}),(0,gO.t)(UK.k,{"data-testid":`multi-call-list-item-${e}-status`,gap:"gap.small",children:[(0,gO.t)((()=>{if((0,hY.Hj)(a)||(0,hY._u)(a))return(0,gO.t)(rY.x,{className:c.isStatusText,size:200,children:o});switch(i){case aY.OX.LocalHold:case aY.OX.RemoteHold:return(0,gO.t)(rY.x,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_hold_button_icon_label")});case aY.OX.Disconnecting:case aY.OX.Disconnected:return s===oY.Qq.CallDropped?(0,gO.t)(rY.x,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_call_dropped")}):(0,gO.t)(rY.x,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_call_ended")});case aY.OX.Observing:if(r)return(0,gO.t)(rY.x,{className:c.isStatusText,size:200,children:d.stringTranslate("calling","calling_hold_button_icon_label")})}return(0,gO.t)(OK.e,{})}),{}),l&&(0,gO.t)(mY.W5,{startedAt:t,render:u})]})]})},TY=({callId:e,title:t,disableMonitorSwitch:n,shouldShowResumeButton:i,leaveCall:a,toggleHoldResume:o})=>{const r=gY(),s=(0,uY.Cq)(),{loggerFactory:{newLogger:l}}=(0,dY.SE)();return(0,gO.t)(UK.k,{className:r.isMultiCallListItemButtonContainer,gap:"gap.small",children:[(0,gO.t)(pY.q,{panelRegion:dA.Ai.multiCallMonitor,panelType:dA.wh.ResumeButton,newLogger:l,disableWrapper:!0,children:i&&(0,gO.t)(sY.z,{className:r.isResumeCallButton,"data-testid":`multi-call-list-item-${e}-resume-button`,icon:(0,gO.t)(qK.shV,{filled:!0}),shape:"circular",appearance:"outline",disabled:n,title:s.stringTranslate("calling","resume_call_multi_call_title",{callTitle:t}),onClick:o})}),(0,gO.t)(pY.q,{panelRegion:dA.Ai.multiCallMonitor,panelType:dA.wh.LeaveButton,newLogger:l,disableWrapper:!0,children:(0,gO.t)(sY.z,{className:r.isLeaveCallButton,"data-testid":`multi-call-list-item-${e}-leave-button`,icon:(0,gO.t)(qK.dB2,{filled:!0}),shape:"circular",appearance:"outline",title:s.stringTranslate("calling","end_call_multi_call_title",{callTitle:t}),onClick:a})})]})},IY=({callId:e,teamsCallId:t,callState:n,extendedCallState:i,callOrigin:a,callStateTitle:o,failureType:r,isServerHold:s,callHeldAt:l,intentId:c,isCallingWindowVisible:d,disableMonitorSwitch:u,disableCallSwitchToggle:m})=>{const p=(0,JK.w)("MultiCallListItem"),g=gY(),{setIntentIdOverride:h,showCallWindow:y}=(0,zK.Te)(),[v,f]=kY(""),[S]=(0,iY.D)(fY,{fetchPolicy:"no-cache"}),[k]=(0,iY.D)(SY,{ignoreResults:!0,fetchPolicy:"no-cache"}),{data:C,loading:b,error:w}=(0,QK.a)(yY,{variables:{teamsCallId:t},fetchPolicy:"no-cache"}),{data:T,loading:I,error:N}=(0,QK.a)(vY,{variables:{teamsCallId:t,participantCount:2},fetchPolicy:"no-cache"}),E=bY((()=>{c?(m(!0),p.log(`ResumeCall triggered for call ${e}, teamsCallId ${t}`),S({variables:{teamsCallId:t}}).catch((t=>{p.error(`Error in toggleHoldCall [callId:${e}][error:${t}]`)})).finally((()=>{m(!1)})),h(c),d&&y(t)):p.error(`Intent id is undefined for call ${e}`)}),[e,m,c,d,p,h,y,t,S]);CY((()=>{b||(w?p.error(`Could not fetch call title for callId: ${e} - ${w.message}`):C?.getCallTitle?f(C.getCallTitle):p.log(`No call title found for callId: ${e} - ${C?.getCallTitle}`))}),[C,b,w,e,p]),CY((()=>{I||(N?p.error(`Could not fetch participants for callId: ${e} - ${N.message}`):T?.nParticipants||p.log(`No participants found for callId: ${e} - ${T?.nParticipants}`))}),[T,I,N,e,p]);return(0,gO.t)(UK.k,{className:g.isMultiCallListItemWrapper,"data-testid":`multi-call-list-item-${e}`,children:[(0,gO.t)(lY.mw,{"aria-hidden":!0,"data-testid":`multi-call-list-item-${e}-avatar`,users:T?.nParticipants?.map((e=>({id:e.id,displayName:null})))||[],profilePictureSize:cY.$D.Large,showPresence:!1,isFocusable:!1,callerInfo:"multi-call-list-item"}),(0,gO.t)(wY,{callId:e,callHeldAt:l,title:v,callState:n,extendedCallState:i,callStateTitle:o,isServerHold:s,failureType:r,showDuration:(0,hY.Rb)(n)&&!(0,hY.Bw)(n)&&!(0,hY._u)(i)&&!(0,hY.Hj)(i)}),(0,gO.t)(TY,{callId:e,title:v,disableMonitorSwitch:u,shouldShowResumeButton:!!((0,hY.Rb)(n)&&i!==oY.Tk.Transferring&&i!==oY.Tk.TransferSucceeded&&i!==oY.Tk.Parking&&i!==oY.Tk.ParkSucceeded&&!(0,hY.fg)(a)||(0,hY.tO)(n,s)),leaveCall:async()=>{p.log(`LeaveCall triggered for call ${e}`);try{await k({variables:{callId:e,context:"multi-call-list-hangup_click",stopOptions:{forEveryone:!1,forAllUserEndpoints:!1}}})}catch(t){p.error(`Leave call failed for call ${e} - ${t.message}`)}},toggleHoldResume:E})]})};var NY=n(455146);const EY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetAllCallsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getAllCalls"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingFields"}}]}}]}},...NY.f.definitions]},AY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorCallCreatedRemovedUpdatedSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callCreatedRemovedUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallAdded"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"call"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingFields"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallRemoved"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"call"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingFields"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallUpdated"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"call"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingFields"}}]}}]}}]}}]}},...NY.f.definitions]},_Y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorGetRenderedCallQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getRenderedCallInCallingWindow"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"callingFields"}}]}}]}},...NY.f.definitions]},FY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorCallingWindowingContainerVisibilityEventForMultiCallMonitorSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"callingWindowingContainerVisibilityEventForMultiCallMonitor"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CallingWindowingContainerVisibilityEventForMultiCallMonitor"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isCallingWindowVisible"}}]}}]}}]}}]},DY={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsWebMultiCallMonitorIsCallingWindowVisibleQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isCallingWindowVisible"}}]}}]},{useState:PY,useEffect:MY,useCallback:xY}=hO,RY=({ubar:e,callingScreen:t})=>{const n=(0,JK.w)("MultiCallList"),i=nY(),{close:a,mounted:o}=(0,zK.Te)(),[r,s]=PY([]),[l,c]=PY(""),[d,u]=PY(!1),[m,p]=PY(!1),{data:g,loading:h,error:y}=(0,QK.a)(EY,{fetchPolicy:"no-cache"}),[v,{data:f,loading:S,error:k}]=(0,KK.t)(_Y,{fetchPolicy:"no-cache"}),{data:C,loading:b,error:w}=(0,QK.a)(DY,{fetchPolicy:"no-cache"}),{data:T,error:I}=(0,YK.m)(AY),{data:N,error:E}=(0,YK.m)(FY),A=xY((e=>{p(e)}),[]);MY((()=>{o("call-list"),v()}),[o,v]),MY((()=>{h||(y?n.error(`Could not fetch call details - ${y.message}`):g?.getAllCalls?(n.log(`Received ${g.getAllCalls.length} calls`),s([...g.getAllCalls])):n.log(`No calls found - ${g?.getAllCalls}`))}),[g,h,y,s,n]),MY((()=>{if(!S){if(k)return n.error(`Could not fetch rendered call details - ${k.message}`),void c("");if(!f?.getRenderedCallInCallingWindow)return n.log(`No rendered calls found - ${f?.getRenderedCallInCallingWindow}`),void c("");n.log(`Rendered call id is ${f.getRenderedCallInCallingWindow.callId}`),c(f.getRenderedCallInCallingWindow.callId)}}),[f,S,k,c,n]),MY((()=>{b||(w?n.error(`Could not fetch calling window visibility - ${w.message}`):C&&0!==Object.keys(C).length?(n.log(`Calling window visibility is ${C.isCallingWindowVisible}`),C.isCallingWindowVisible&&v(),u(C.isCallingWindowVisible)):n.log("Calling window visibility not found"))}),[b,w,C,u,v,n]),MY((()=>{if(I)return void n.error(`Call subscription error - ${I.message}`);if(!T?.callCreatedRemovedUpdatedEvent?.call)return void n.log(`No calls found in the subscription - ${T?.callCreatedRemovedUpdatedEvent?.call}`);const e=T.callCreatedRemovedUpdatedEvent.call,t=T.callCreatedRemovedUpdatedEvent.__typename;n.log(`Call subscription received for call ${e.callId} and operation ${t}`);let i=[];switch(t){case"CallAdded":v(),i=[...r,e],s(i);break;case"CallRemoved":v();for(const t of r)t.callId!==e.callId&&i.push(t);0===i.length&&(n.log("Closing the call list"),a("call-list")),s(i);break;case"CallUpdated":for(const t of r)t.callId===e.callId?(t.state!==e.state&&v(),i.push(e)):i.push(t);s(i)}}),[T,I,s,n]),MY((()=>{E?n.error(`Calling window subscription error - ${E.message}`):N?.callingWindowingContainerVisibilityEventForMultiCallMonitor&&void 0!==N.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible&&null!==N.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible?(N.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible&&v(),u(N.callingWindowingContainerVisibilityEventForMultiCallMonitor.isCallingWindowVisible)):n.log("Calling window visibility not found")}),[N,E,u,v,n]);const[_,F]=(({allCalls:e,isCallingWindowVisible:t,renderedCallId:n,ubar:i,callingScreen:a,disableMonitorSwitch:o,disableCallSwitchToggle:r,logger:s})=>{let l=0;return t&&1===e.length||0===e.length?(s.log(`CallList is empty - isCallingWindowVisible: ${t}, totalCallsCount - ${e.length}`),[null,0]):[(0,gO.t)(hO.Fragment,{children:e.map((e=>t&&e.callId===n?(s.log(`MultiCallList skipped displaying for a call with call id ${e.callId} and intent id ${e.intent?.id} because calling window visibility is ${t} and rendered call id is ${n}`),(0,gO.t)(OK.e,{},e.id)):(0,hY.Xf)(e)?(s.log(`MultiCallListItem displayed for ${e.callId} with call state as ${e.state} and extended state as ${e.extendedCallState} with calling window visibility as ${t}`),l++,(0,gO.t)(IY,{callId:e.callId,teamsCallId:e.id,callState:e.state,extendedCallState:e.extendedCallState,callOrigin:e.callOrigin,callStateTitle:e.callStateProps?.title,failureType:e.failureType,isServerHold:e.isServerHold,callHeldAt:e.callHeldAt||void 0,intentId:e.intent?.id,isCallingWindowVisible:t,disableMonitorSwitch:o,disableCallSwitchToggle:r},e.id)):(0,hY.A4)(e)?(s.log(`Call Monitor Window displayed for ${e.callId} with call state as ${e.state} and extended state as ${e.extendedCallState} with calling window visibility as ${t}`),l++,(0,gO.t)(tY,{ubar:i,callingScreen:a},e.id)):(s.log(`MultiCallList skipped displaying for call ${e.callId} with call state as ${e.state} and extended state as ${e.extendedCallState} with calling window visibility as ${t}`),(0,gO.t)(OK.e,{},e.id))))}),l]})({allCalls:r,isCallingWindowVisible:d,renderedCallId:l,ubar:e,callingScreen:t,disableMonitorSwitch:m,disableCallSwitchToggle:A,logger:n});return 0===F?(n.log("MultiCallList is hidden - callCountInSlotView - 0"),(0,gO.t)(OK.e,{})):(0,gO.t)(UK.k,{className:i.isWebMultiCallMonitorWrapper,"data-tid":"multi-call-list",column:!0,children:[(0,gO.t)(UK.k,{className:i.isIconWrapper,children:(0,gO.t)(qK.cSU,{filled:!0})}),_]})},jY=e=>{const t=(0,GK.sV)(),{id:n}=t.getEntityOptions(Se.py.floatingmonitor,Se.uk.view);return(0,gO.t)(zK.UN,{intentIdOverride:n,children:(0,gO.t)(RY,{...e})})},LY=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(84274),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(553486),n.e(540003),n.e(392718),n.e(591395),n.e(832961),n.e(255279),n.e(869026),n.e(649162),n.e(704043),n.e(651510),n.e(729265),n.e(373318),n.e(593837),n.e(526824),n.e(149115),n.e(383625),n.e(625001),n.e(10495),n.e(309799),n.e(710814),n.e(384720),n.e(572001),n.e(100385),n.e(995297),n.e(908285),n.e(979549),n.e(352779),n.e(889333),n.e(685338),n.e(262541),n.e(587628),n.e(903187),n.e(885503),n.e(260299),n.e(71592),n.e(131055),n.e(8361),n.e(791770),n.e(606338),n.e(547699),n.e(435262),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(241070),n.e(917217),n.e(813012),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(949636),n.e(940495),n.e(123513),n.e(98223),n.e(281467),n.e(678342),n.e(350959),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(782721),n.e(48523),n.e(404742),n.e(342293),n.e(90653),n.e(550701),n.e(551663),n.e(608462),n.e(986305),n.e(193651),n.e(103338),n.e(613899),n.e(398164),n.e(894153),n.e(657229),n.e(148076),n.e(334926),n.e(439571),n.e(259682),n.e(142331),n.e(544565),n.e(738789),n.e(778597),n.e(730645),n.e(466425),n.e(273375),n.e(466157),n.e(996875),n.e(883971),n.e(141466),n.e(276018),n.e(260857),n.e(278319),n.e(985351),n.e(326378),n.e(149776),n.e(770326)]).then(n.bind(n,154604)),OY=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(84274),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(553486),n.e(540003),n.e(392718),n.e(591395),n.e(832961),n.e(255279),n.e(869026),n.e(649162),n.e(704043),n.e(651510),n.e(729265),n.e(373318),n.e(593837),n.e(526824),n.e(149115),n.e(383625),n.e(625001),n.e(10495),n.e(309799),n.e(710814),n.e(384720),n.e(572001),n.e(100385),n.e(995297),n.e(908285),n.e(979549),n.e(352779),n.e(889333),n.e(685338),n.e(262541),n.e(587628),n.e(903187),n.e(885503),n.e(260299),n.e(71592),n.e(131055),n.e(8361),n.e(791770),n.e(606338),n.e(547699),n.e(435262),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(241070),n.e(917217),n.e(813012),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(949636),n.e(940495),n.e(123513),n.e(98223),n.e(281467),n.e(678342),n.e(350959),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(782721),n.e(48523),n.e(404742),n.e(342293),n.e(90653),n.e(550701),n.e(551663),n.e(608462),n.e(986305),n.e(193651),n.e(103338),n.e(613899),n.e(398164),n.e(894153),n.e(657229),n.e(148076),n.e(334926),n.e(439571),n.e(259682),n.e(142331),n.e(544565),n.e(738789),n.e(778597),n.e(730645),n.e(466425),n.e(273375),n.e(466157),n.e(996875),n.e(883971),n.e(141466),n.e(276018),n.e(260857),n.e(278319),n.e(985351),n.e(326378),n.e(149776),n.e(770326)]).then(n.bind(n,395386)),$Y=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(84274),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(553486),n.e(540003),n.e(392718),n.e(591395),n.e(832961),n.e(255279),n.e(869026),n.e(649162),n.e(704043),n.e(651510),n.e(729265),n.e(373318),n.e(593837),n.e(526824),n.e(149115),n.e(383625),n.e(625001),n.e(10495),n.e(309799),n.e(710814),n.e(384720),n.e(572001),n.e(100385),n.e(995297),n.e(908285),n.e(979549),n.e(352779),n.e(889333),n.e(685338),n.e(262541),n.e(587628),n.e(903187),n.e(885503),n.e(260299),n.e(71592),n.e(131055),n.e(8361),n.e(791770),n.e(606338),n.e(547699),n.e(435262),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(241070),n.e(917217),n.e(813012),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(949636),n.e(940495),n.e(123513),n.e(98223),n.e(281467),n.e(678342),n.e(350959),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(782721),n.e(48523),n.e(404742),n.e(342293),n.e(90653),n.e(550701),n.e(551663),n.e(608462),n.e(986305),n.e(193651),n.e(103338),n.e(613899),n.e(398164),n.e(894153),n.e(657229),n.e(148076),n.e(334926),n.e(439571),n.e(259682),n.e(142331),n.e(544565),n.e(738789),n.e(778597),n.e(730645),n.e(466425),n.e(273375),n.e(466157),n.e(996875),n.e(883971),n.e(141466),n.e(276018),n.e(260857),n.e(278319),n.e(985351),n.e(326378),n.e(149776),n.e(770326)]).then(n.bind(n,450812)),UY="calling-app-LPC",BY="calling-app",WY=async({appRenderMode:e,coreSettings:t,host:n,isHeader:i,isMainPanel:a,logger:o,onRenderEvent:r,scenarioFactory:s})=>{o.log(`renderWithLPC: import LPC: isMainPanel=${a} isHeader=${i}`);const l=(0,ac.mT)($Y,UY,s);if(e===Mt.S.Main){r("ChunkLoadStarted",{chunkName:UY});const{chunkLoadTimerPromise:e,chunkLoadTimer:s}=(({coreSettings:e,host:t})=>{let n=0;return{chunkLoadTimerPromise:new Promise(((i,a)=>{let{chunkLoadTimeout:o}=e.get(b.J.Calling);o||(o=Number.MAX_SAFE_INTEGER),n=t.setTimeout(a,o,(0,de.Tr)("CallingApp",h.jK.ChunkLoadTimedOut,"renderMain"))})),chunkLoadTimer:n}})({coreSettings:t,host:n});await Promise.race([l,e]).then((()=>clearTimeout(s))).catch((e=>{throw o.error(`renderWithLPC: ChunkLoadTimedOut: isMainPanel=${a} isHeader=${i}`),e})),r("ChunkLoadSucceeded",{chunkName:UY})}const{LPC:c}=await l;return o.log(`renderWithLPC: construct the slot element: isMainPanel=${a} isHeader=${i}`),c},HY=({coreServices:e,host:t,isResize:n,entityType:i,windowOptions:a,entityOptions:o})=>{const{minHeight:r,minWidth:s}=oK.windowFeatures.otherEntityTypes||{},l=!!e?.coreSettings.get(b.J.Calling,["enableSpeedbump"]).enableSpeedbump,c=t?.screen;if(i===Se.py.callsmonitor)return(({host:e,windowOptions:t,coreServices:n})=>{const i={...oK.windowFeatures?.[Se.py.callsmonitor]}??{},a={width:i.width||0,height:i.height||0};return t&&(a.width=t.width||a.width,a.height=t.height||a.height),!!n?.coreSettings.get(b.J.Calling,["disableContentprotection"]).disableContentprotection&&i.additionalFeatures&&(i.additionalFeatures={...i.additionalFeatures,contentprotection:"false"}),e&&e.screen&&a.width&&a.height&&(i.top=0===t?.top||t?.top?t.top:e.screen.availHeight-(a.height+100),i.left=0===t?.left||t?.left?t.left:e.screen.availWidth-(a.width+100)),{...i,...a}})({host:t,windowOptions:a,coreServices:e});if(i===Se.py.byodattendeewindow)return(({entityOptions:e,coreServices:t})=>{const{minHeight:n,minWidth:i,additionalFeatures:a}=oK.windowFeatures.byodattendeewindow||{};if(!e)return null;const o=JSON.parse(e).displayProperties;return{additionalFeatures:{minHeight:`${n}`,minWidth:`${i}`,show:"false",contentprotection:`${t?.coreSettings.get(b.J.Calling,["disableContentprotection"]).disableContentprotection?"false":a?.contentprotection}`,excludeWindowFromScreenSharing:`${a?.excludeWindowFromScreenSharing}`},height:o?.height,width:o?.width,fullScreen:!0,left:o?.x,top:o?.y,minHeight:n,minWidth:i}})({entityOptions:o,coreServices:e});if(i===Se.py.callingdialog)return(({host:e})=>{const t={...oK.windowFeatures?.[Se.py.callingdialog]}??{};return e&&e.screen&&(t.top=0,t.left=0,t.width=e.screen.width,t.height=e.screen.height),{...t}})({host:t});if(n&&!c)return oK.windowFeatures.otherEntityTypes||null;if(!c)return null;let{height:d=1,width:u=1}=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=oK.windowFeatures.otherEntityTypes||{};let{width:a,height:o}=oK.windowFeatures.otherEntityTypes||{};if(!t)return{height:o,width:a,minHeight:n,minWidth:i};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:c}=t.coreSettings.get(b.J.Calling);if(s&&l&&c)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=c*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/c*a}return{height:o,width:a}})(c,e);const m=c.availHeight-20,p=u>=c.availWidth||d>=m;p&&(d=c.availHeight,u=c.availWidth);const{left:g,top:h}=((e,t,n,i,a)=>{if(i)return{left:0,top:0};const o="availLeft"in e?e.availLeft:0,r="availTop"in e?e.availTop:0,s=o+e.availWidth/2-t/2;let l;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":l=r+a;break;default:l=r+e.availHeight/2-n/2}return{left:s,top:l}})(c,u,d,p,20),y={additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},height:d,width:u,fullScreen:p,left:g,top:h,minHeight:r,minWidth:s};return i===Se.py.calls&&l?(e=>{const t=oK.windowFeatures.calls.additionalFeatures.closePrompt||"";return{...e,additionalFeatures:{...e.additionalFeatures,closePrompt:t}}})(y):y},VY=async e=>{const{logger:t,scenarioFactory:n,isMainPanel:i,isHeader:a,isModal:o,onRenderEvent:r}=e;r("ChunkLoadStarted",{chunkName:BY}),t.log(`render: import the necessary subcomponents: isMainPanel=${i} isHeader=${a} isModal=${o}`);const[{CallingViewsRenderer:s},{CallingContextProvider:l}]=await Promise.all([(0,ac.mT)(LY,BY,n),(0,ac.mT)(OY,BY,n)]);return r("ChunkLoadSucceeded",{chunkName:BY}),{CallingViewsRenderer:s,CallingContextProvider:l}},GY=(e,t,n)=>n?.isInEmbedContext()?(0,gO.t)(Az.yx,{conveneHostMessaging:n,children:(0,gO.t)(HK,{isHeader:e,children:t})}):(0,gO.t)(hO.Fragment,{children:t}),zY=async e=>{const{isMainPanel:t,isHeader:n,isModal:i,logger:a,conveneHostMessaging:o}=e,{CallingViewsRenderer:r,CallingContextProvider:s}=await VY(e);return a.log(`render: construct the slot element: isMainPanel=${t} isHeader=${n} isModal=${i}`),(0,gO.t)(QY,{children:(0,gO.t)(s,{children:GY(n,(0,gO.t)(r,{isMainPanel:t,isHeader:n,isModal:i}),o)})})},qY=async({appRenderMode:e,loggerFactory:t,host:n,scenarioFactory:i,...a})=>{if(e===Mt.S.HorizontalBar||e===Mt.S.Main){const o=t.newLogger("CallingApp","apps-calling"),r=e===Mt.S.HorizontalBar;return zY({isMainPanel:!0,isHeader:r,isModal:!1,logger:o,scenarioFactory:i,appRenderMode:e,host:n,...a})}return(0,gO.t)(OK.e,{})};function JY(e){return{eventHandlers:GQ,getAppPhases:zQ,getAppViewEntities:JQ,getAppViewEntitiesProps:iK,getAppWindowFeatures:HY,getCommandScenarioName:VK,manifest:oK,render:async({appRenderMode:t,entity:n,loggerFactory:i,...a})=>{const o=i.newLogger("CallingApp","apps-calling");if(n.type===Se.py.floatingmonitor)return(async({loggerFactory:e,entity:t,appRenderMode:n,...i})=>{const a=i.coreSettings.get(b.J.Calling),[o,r]=await Promise.all([qY({appRenderMode:Mt.S.HorizontalBar,entity:t,loggerFactory:e,...i}),qY({appRenderMode:Mt.S.Main,entity:t,loggerFactory:e,...i})]);return a.enableMultiCallMonitorForWeb?(0,gO.t)(jY,{ubar:o,callingScreen:r}):(0,gO.t)(tY,{ubar:o,callingScreen:r})})({appRenderMode:t,entity:n,loggerFactory:i,...a});if(n.type===Se.py.callsmonitor)return qY({appRenderMode:t,entity:n,loggerFactory:i,...a});if(t===Mt.S.HorizontalBar||t===Mt.S.Modal){const n=t===Mt.S.HorizontalBar,i=t===Mt.S.HorizontalBar,r=t===Mt.S.Modal;return zY({conveneHostMessaging:e,isMainPanel:n,isHeader:i,isModal:r,logger:o,appRenderMode:t,...a})}if(t===Mt.S.Main||t===Mt.S.Rail){const n=t===Mt.S.Main;return(async e=>{const{isMainPanel:t,isHeader:n,isModal:i,logger:a,coreSettings:o,conveneHostMessaging:r}=e,{CallingViewsRenderer:s,CallingContextProvider:l}=await VY(e);a.log(`render: construct the slot element: isMainPanel=${t} isHeader=${n} isModal=${i}`);const{enableEntityMoreInfo:c=!1}=o.get(b.J.Core),d=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),u=c?d:await WY(e),m=c?d:rJ.p3;return(0,gO.t)(QY,{children:(0,gO.t)(u,{children:(0,gO.t)(m,{children:(0,gO.t)(l,{children:GY(n,(0,gO.t)(s,{isMainPanel:t,isHeader:n,isModal:i}),r||Az.Id)})})})})})({conveneHostMessaging:e,isMainPanel:n,isHeader:!1,isModal:!1,appRenderMode:t,logger:o,...a})}return(0,gO.t)(OK.e,{})},onPreWarm:CQ,onPreInit:bQ,onBeforeAddToNavigation:$Q,onBeforeCommandHandled:SK,onBeforeDeeplinkParsed:OQ,onCommandResult:RK}}const QY=({children:e})=>(0,gO.t)(ez.f,{namespaces:["calling","broadcast","extensibility","hololens","messaging","meetingOptions","datepicker"],loaderRenderer:null,children:e}),KY={id:"com.microsoft.teams.closedcaptionsflyout",name:"ClosedCaptionsApp",supportedEntities:[Se.py.closedcaptionsflyout],supportedRenderModes:[Mt.S.Main],windowFeatures:{height:247,width:720,additionalFeatures:{alwaysOnTop:"true",resizable:"true",fullscreenable:"false",maximizable:"false",closable:"true",hideWindowControl:"true",frame:"false",contentprotection:"true",excludeWindowFromScreenSharing:"true",closeoverride:"false"}}},YY=e=>{if(XY(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:ZY(e),endEntity:null}},XY=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===Se.py.closedcaptionsflyout,a=t===Se.uk.view;return Boolean(i&&a)},ZY=({entity:e})=>e,eX=()=>({mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0,disableBorderInHighContrast:!0}}}),tX=()=>n.e(676760).then(n.bind(n,700636)),nX=({host:e})=>{const t=e?.screen;if(!t)return null;const n=KY.windowFeatures.width||480,i=KY.windowFeatures.height||60;return{additionalFeatures:{alwaysOnTop:"true",closable:"false",excludeWindowFromScreenSharing:"true",fullscreenable:"false",maximizable:"false",minimizable:"false",resizable:"true",movable:"true",hideWindowControl:"true",frame:"false",closeoverride:"true",transparent:"true",visibleOnAllWorkspaces:"true"},top:KY.windowFeatures.offset||10,left:("availLeft"in t?t.availLeft:0)+t.availWidth/2-n/2,width:n,height:i}};function iX(){const e=()=>null;return{getAppViewEntities:YY,getAppViewEntitiesProps:eX,getAppWindowFeatures:nX,manifest:KY,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===Mt.S.Main&&n===Se.py.closedcaptionsflyout){const{FlyoutClosedCaptions:e}=await(0,ac.mT)(tX,"flyout-closed-captions-app",i);return(0,gO.t)(e,{})}return(0,gO.t)(e,{})}}}const aX={id:"com.microsoft.teams.campaign-notifications",name:"CampaignNotificationsApp",supportedEntities:[Se.py.campaignnotifications],supportedRenderModes:[Mt.S.Main]},oX=e=>{if(rX(e))return sX(e)?{subNavEntity:lX(e),headerEntity:cX(e),startEntity:dX(e),mainEntity:uX(e),endEntity:mX(e)}:null},rX=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=Boolean(Se.py.campaignnotifications===i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},sX=()=>!0,lX=()=>null,cX=()=>null,dX=()=>null,uX=({entity:e})=>e,mX=()=>null,pX=({appRenderMode:e})=>{const t=new MV.H,n=[],i=[],a={};if(e===Mt.S.Main)gX({criticalSignals:n,featureFlags:a,postCriticalSignals:i});return t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:1e4}),t.appPhases},gX=({criticalSignals:e})=>{e.push(xV.G.CAMPAIGN_VIEW_RENDERED)},hX=()=>Promise.all([n.e(377348),n.e(112403),n.e(463781),n.e(681896),n.e(909020),n.e(591878),n.e(773923),n.e(120894),n.e(128770),n.e(649800),n.e(51724),n.e(649162),n.e(635026),n.e(383625),n.e(130631),n.e(228737),n.e(577767),n.e(129462),n.e(801870),n.e(683079),n.e(82398),n.e(724640),n.e(585815),n.e(677762)]).then(n.bind(n,985548));function yX(){const e=()=>null;return{getAppPhases:pX,getAppViewEntities:oX,manifest:aX,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main){const e="campaign-notifications";n("ChunkLoadStarted",{chunkName:e});const{CampaignNotifications:t}=await(0,ac.mT)(hX,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(t,{})}return(0,gO.t)(e,{})}}}const vX={id:"com.microsoft.teams.changeDefaultApp",name:"ChangeDefaultApp",supportedEntities:[Se.py.fileopensettings],supportedRenderModes:[Mt.S.Modal]};var fX=n(677362);var SX;!function(e){e.DeepLinkNotEnabled="deeplink-not-enabled-error",e.MissingFileType="missing-fileType-error"}(SX||(SX={}));const kX=e=>{const{fileType:t,serviceName:n,context:i}=e;return Promise.resolve({entityCommand:{entity:{type:Se.py.fileopensettings,action:Se.uk.update},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.ChangeDefaultAppDialog}},entityOptions:{fileType:t,serviceName:n,context:i}},metadata:{allowAnonymous:!1}})},CX=[{filter:"/l/change-file-open-preference",execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{if(!bX(t))return Promise.reject({message:SX.DeepLinkNotEnabled});const{entityOptions:n}=(e=>{const{searchParams:t}=e;return{entityOptions:{fileType:t.get("fileType")??"",serviceName:t.get("serviceName")??"",context:fX.Hr.ns}}})(e);return n.fileType?kX(n):Promise.reject({message:SX.MissingFileType})}}],bX=e=>!!e?.get(b.J.Files).enableChangeDefaultAppDialogV2,wX=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(120894),n.e(666384),n.e(253400),n.e(397833),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(255279),n.e(869026),n.e(30577),n.e(704043),n.e(729265),n.e(65923),n.e(577767),n.e(908285),n.e(801870),n.e(32705),n.e(101614),n.e(69599),n.e(141377),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(241070),n.e(600213),n.e(916297),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(799855),n.e(269518),n.e(48523),n.e(206887),n.e(613899),n.e(656436),n.e(749666),n.e(198610),n.e(266004),n.e(158529),n.e(868123)]).then(n.bind(n,696701));function TX(){const e=()=>null;return{manifest:vX,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{const o=a.newLogger("ChangeDefaultApp","apps-change-default-app");if(t===Mt.S.Modal){const e="change-default-app";o.log("chunk load start"),n("ChunkLoadStarted",{chunkName:e}),o.log("experimental import start");const{ChangeDefaultAppDialog:t}=await(0,ac.mT)(wX,e,i);return o.log("report chunk load success"),n("ChunkLoadSucceeded",{chunkName:e}),o.log("Rendering change default app dialog"),(0,gO.t)(t,{})}return(0,gO.t)(e,{})},onBeforeDeeplinkParsed:CX}}var IX=n(325506),NX=n(569864),EX=n(864860),AX=n(532522),_X=n(924340);const FX=async(e,t)=>{const{enableSimpleCollabApp:n,enableSimpleCollabAppToggle:i,enableSimpleCollabAppSplitView:a}=t.get(b.J.SimpleCollab);if(n&&i){const{data:t}=await e.query({query:_X.T,fetchPolicy:"cache-first"}),o=t?.userPreferencesForSimpleCollab;let r={};o&&"simpleCollabUserSettings"in o&&o.simpleCollabUserSettings&&(r=o.simpleCollabUserSettings);const s=(0,AX.UM)(!!n,!!i,!!a,r);return(0,ii.Yf)().setContext("UserInfo.CollabAppEnabled",s===AX.JP.unified),(0,ii.Yf)().setContext("UserInfo.NewChatAndChannelEnabled",s!==AX.JP.none),s}return AX.JP.none},DX={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"sendMessage"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"message"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SendMessageInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"action"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SendMessageAction"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"correlationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sendMessage"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}},{kind:"Argument",name:{kind:"Name",value:"message"},value:{kind:"Variable",name:{kind:"Name",value:"message"}}},{kind:"Argument",name:{kind:"Name",value:"action"},value:{kind:"Variable",name:{kind:"Name",value:"action"}}},{kind:"Argument",name:{kind:"Name",value:"correlationId"},value:{kind:"Variable",name:{kind:"Name",value:"correlationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},PX={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatChatHighlightsCommandOptionsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chatHighlightsDetailsCommandOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convId"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"lastMessageOriginalArrivalTime"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]},MX={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatNotifyActiveContextChangedMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activeContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activeContextType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ActiveContextType"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notifyActiveContextChangedToCDLWorker"},arguments:[{kind:"Argument",name:{kind:"Name",value:"activeContextId"},value:{kind:"Variable",name:{kind:"Name",value:"activeContextId"}}},{kind:"Argument",name:{kind:"Name",value:"activeContextType"},value:{kind:"Variable",name:{kind:"Name",value:"activeContextType"}}}]}]}}]};var xX=n(526462),RX=n(309501);const jX=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i,id:a},dataOptions:o,entityOptions:r},requestContext:s}=e,l=s.client,{enableChatEnablePolicyCheckForCommand:c}=s.coreSettings.get(b.J.Chat);if(c&&n===Se.py.chats&&r&&r.shouldCheckChatPolicy&&(0,EX.t3)(s.coreSettings.get(b.J.Messaging))===EX.i1.Disabled)return Promise.resolve(void 0);if(WX(l,s.coreSettings,n,i,a),n===Se.py.chatHighlightsDetails&&"chatHighlightsDetailsCoachmark"===a)return LX(l,t,s.loggerFactory);if(!(t.entityOptions&&t.entityOptions.isViewFromSimpleCollab||!1)){const e=await FX(l,s.coreSettings),n=e!==AX.JP.none,{enablePopoutAction:i}=s.coreSettings.get(b.J.ChatList);if(UX(t,n,i)){const n=e===AX.JP.split?Se.py.simplecollabchats:Se.py.simplecollab,i={...t,entity:{...t.entity,type:n}};return Promise.resolve(i)}}return OX(l,o,t,n,i)},LX=(e,t,n)=>{const i=n.newLogger("chatCopilotCoachmark","apps-chat");try{const n=e.readQuery({query:PX});if(!n?.chatHighlightsDetailsCommandOptions)throw new Error;{const{convId:e,lastMessageOriginalArrivalTime:a}=n.chatHighlightsDetailsCommandOptions;t.entity.id=e,t.entityOptions?t.entityOptions={...t.entityOptions,lastMessageOriginalArrivalTime:a}:t.entityOptions={lastMessageOriginalArrivalTime:a},i.log(`Received chat id: ${e} ${a}`)}}catch(e){return Promise.reject("handleChatHighlightsDetailsCoachmark: falied to get chat id")}return Promise.resolve(t)},OX=(e,t,n,i,a)=>t&&$X(i,a)?BX(t)&&t.convId&&t.message?e.mutate({mutation:DX,variables:{convId:t.convId,message:{clientMessageId:(0,xX.K)(),messageType:RX.Cs.HTML,content:t.message},action:"Create"}}).then((()=>{})).catch((()=>Promise.reject(li.f.ChatToastActionMutationFailed))):Promise.reject(li.f.ChatActionTypeToNotificationActionFailed):Promise.resolve(n),$X=(e,t)=>e===Se.py.chats&&t===Se.uk.mutate,UX=(e,t,n)=>{const i=["flow","none","extend"];return n&&i.push("new"),!(e.entity.type===Se.py.simplecollab||!t||i.includes(e.command.stateTransition)||e.entity.linkedEntity&&e.entity.linkedEntity?.type===Se.py.simplecollab)},BX=e=>e.actionType===ei.quickReply,WX=(e,t,n,i,a)=>{t.get(b.J.CdlWorker).enableNotifyActiveContextChangedToCDLWorker&&a&&n===Se.py.chats&&i===Se.uk.view&&e.mutate({mutation:MX,fetchPolicy:"no-cache",variables:{activeContextId:a,activeContextType:"chat"}})},HX=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(84274),n.e(393890),n.e(773923),n.e(65537),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(152739),n.e(612377),n.e(361845),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(128770),n.e(540003),n.e(812934),n.e(649800),n.e(51724),n.e(564211),n.e(714650),n.e(663276),n.e(123977),n.e(682492),n.e(891369),n.e(591395),n.e(440413),n.e(832961),n.e(255279),n.e(869026),n.e(553940),n.e(635026),n.e(44025),n.e(30577),n.e(136462),n.e(732691),n.e(551124),n.e(129609),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(81),n.e(788241),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(310307),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(862824),n.e(503847),n.e(373318),n.e(654936),n.e(593837),n.e(526824),n.e(875436),n.e(374968),n.e(302494),n.e(383625),n.e(10495),n.e(547642),n.e(513251),n.e(981041),n.e(710814),n.e(577767),n.e(384720),n.e(669233),n.e(289814),n.e(290718),n.e(672822),n.e(462698),n.e(129462),n.e(83395),n.e(93644),n.e(727035),n.e(479236),n.e(180830),n.e(316808),n.e(345213),n.e(609787),n.e(92103),n.e(588134),n.e(908688),n.e(618412),n.e(696684),n.e(809546),n.e(819075),n.e(801870),n.e(689835),n.e(352779),n.e(410595),n.e(124516),n.e(8361),n.e(662755),n.e(695026),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(475063),n.e(241070),n.e(625402),n.e(890962),n.e(666369),n.e(84215),n.e(222020),n.e(209252),n.e(978327),n.e(540873),n.e(870049),n.e(351549),n.e(433129),n.e(501383),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(360134),n.e(406628),n.e(566118),n.e(357903),n.e(949636),n.e(940495),n.e(123513),n.e(98223),n.e(281467),n.e(678342),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(6348),n.e(782721),n.e(799855),n.e(65722),n.e(376960),n.e(269518),n.e(48523),n.e(146244),n.e(404742),n.e(638108),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(342293),n.e(182115),n.e(700818),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(986305),n.e(52047),n.e(458629),n.e(467533),n.e(109515),n.e(143699),n.e(311896),n.e(666181),n.e(992290),n.e(482266),n.e(931506),n.e(38878),n.e(413104),n.e(230471),n.e(667349),n.e(148076),n.e(723299),n.e(106311),n.e(984961),n.e(290987),n.e(133963),n.e(363428),n.e(923207),n.e(701227),n.e(20934),n.e(259682),n.e(312659),n.e(544706),n.e(792751),n.e(623025),n.e(833837),n.e(467602),n.e(803407),n.e(532717),n.e(648261),n.e(459361),n.e(481647)]).then(n.bind(n,584767)),VX=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(84274),n.e(393890),n.e(773923),n.e(65537),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(152739),n.e(612377),n.e(361845),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(128770),n.e(540003),n.e(812934),n.e(649800),n.e(51724),n.e(564211),n.e(714650),n.e(663276),n.e(123977),n.e(682492),n.e(891369),n.e(591395),n.e(440413),n.e(832961),n.e(255279),n.e(869026),n.e(553940),n.e(635026),n.e(44025),n.e(30577),n.e(136462),n.e(732691),n.e(551124),n.e(129609),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(81),n.e(788241),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(310307),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(862824),n.e(503847),n.e(373318),n.e(654936),n.e(593837),n.e(526824),n.e(875436),n.e(374968),n.e(302494),n.e(383625),n.e(10495),n.e(547642),n.e(513251),n.e(981041),n.e(710814),n.e(577767),n.e(384720),n.e(669233),n.e(289814),n.e(290718),n.e(672822),n.e(462698),n.e(129462),n.e(83395),n.e(93644),n.e(727035),n.e(479236),n.e(180830),n.e(316808),n.e(345213),n.e(609787),n.e(92103),n.e(588134),n.e(908688),n.e(618412),n.e(696684),n.e(809546),n.e(819075),n.e(801870),n.e(689835),n.e(352779),n.e(410595),n.e(124516),n.e(8361),n.e(662755),n.e(695026),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(475063),n.e(241070),n.e(625402),n.e(890962),n.e(666369),n.e(84215),n.e(222020),n.e(209252),n.e(978327),n.e(540873),n.e(870049),n.e(351549),n.e(433129),n.e(501383),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(360134),n.e(406628),n.e(566118),n.e(357903),n.e(949636),n.e(940495),n.e(123513),n.e(98223),n.e(281467),n.e(678342),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(6348),n.e(782721),n.e(799855),n.e(65722),n.e(376960),n.e(269518),n.e(48523),n.e(146244),n.e(404742),n.e(638108),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(342293),n.e(182115),n.e(700818),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(986305),n.e(52047),n.e(458629),n.e(467533),n.e(109515),n.e(143699),n.e(311896),n.e(666181),n.e(992290),n.e(482266),n.e(931506),n.e(38878),n.e(413104),n.e(230471),n.e(667349),n.e(148076),n.e(723299),n.e(106311),n.e(984961),n.e(290987),n.e(133963),n.e(363428),n.e(923207),n.e(701227),n.e(20934),n.e(259682),n.e(312659),n.e(544706),n.e(792751),n.e(623025),n.e(833837),n.e(467602),n.e(803407),n.e(532717),n.e(648261),n.e(459361),n.e(481647)]).then(n.bind(n,450812)),GX=({action:e,appRenderMode:t,coreSettings:n,type:i})=>{const a=new MV.H,{isHeaderDisabled:o=!1}=n.get(b.J.Core),{chatAppPhaseTimeouts:r,enableComposeCriticalPhaseLoad:s=!1,enableComposeCriticalPhaseLoadSecondaryViewport:l=!1,enableComposeCriticalPhaseLoadSecondaryViewportGate:c=!1}=n.get(b.J.Messaging),d=[],u=[];switch(t){case Mt.S.HorizontalBar:zX({criticalSignals:d,featureFlags:{isHeaderDisabled:o},postCriticalSignals:u,type:i});break;case Mt.S.Main:qX({action:e,criticalSignals:d,featureFlags:{enableComposeCriticalPhaseLoad:s},postCriticalSignals:u,type:i});break;case Mt.S.Rail:JX({action:e,criticalSignals:d,featureFlags:{enableComposeCriticalPhaseLoad:s,enableComposeCriticalPhaseLoadSecondaryViewport:l,enableComposeCriticalPhaseLoadSecondaryViewportGate:c},postCriticalSignals:u,type:i})}return a.registerAppPhase({phase:yt.nh.CRITICAL,signals:d,timeout:r?.critical||6e4}),a.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:u,timeout:r?.postCritical||1e4}),a.appPhases},zX=({featureFlags:{isHeaderDisabled:e},criticalSignals:t,postCriticalSignals:n,type:i})=>{i!==Se.py.chatschannelconv?(!e&&t.push(xV.G.CHAT_HEADER_TITLE_RENDERED),!e&&n.push(xV.G.CHAT_HEADER_BUTTONS_RENDERED)):t.push(xV.G.CHANNEL_HEADER_RENDERED)},qX=({action:e,criticalSignals:t,featureFlags:{enableComposeCriticalPhaseLoad:n},postCriticalSignals:i,type:a})=>{if(e===Se.uk.join)return;if(a===Se.py.chatschannelconv){t.push(xV.G.MESSAGES_RENDERED);return n?t.push(xV.G.COMPOSE_LOADED):i.push(xV.G.COMPOSE_LOADED),void i.push(xV.G.MESSAGE_REACTIONS_RENDERED,xV.G.PRESENCES_RENDERED,xV.G.VIRTUAL_LIST_RENDER_BUFFER_FILLED)}t.push(xV.G.MESSAGES_RENDERED);const o=n;o&&t.push(xV.G.COMPOSE_LOADED),i.push(xV.G.MESSAGE_REACTIONS_RENDERED,xV.G.PRESENCES_RENDERED,xV.G.VIRTUAL_LIST_RENDER_BUFFER_FILLED),!o&&i.push(xV.G.COMPOSE_LOADED)},JX=({action:e,criticalSignals:t,featureFlags:{enableComposeCriticalPhaseLoad:n,enableComposeCriticalPhaseLoadSecondaryViewport:i,enableComposeCriticalPhaseLoadSecondaryViewportGate:a},postCriticalSignals:o,type:r})=>{if(e===Se.uk.list)t.push(xV.G.CHAT_LIST_ITEMS_RENDERED),o.push(xV.G.PRESENCES_RENDERED);else if(e===Se.uk.view){t.push(xV.G.MESSAGES_RENDERED);const e=a&&i,s=r!==Se.py.byodchat&&(n||e);s&&t.push(xV.G.COMPOSE_LOADED),o.push(xV.G.MESSAGE_REACTIONS_RENDERED,xV.G.PRESENCES_RENDERED,xV.G.VIRTUAL_LIST_RENDER_BUFFER_FILLED),s||r===Se.py.byodchat||o.push(xV.G.COMPOSE_LOADED)}},QX={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"discardDuringMeetingsAndCalls"}},{kind:"Field",name:{kind:"Name",value:"interopConversationStatus"}},{kind:"Field",name:{kind:"Name",value:"members"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"givenName"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"messagePreviewTemplateOption"}},{kind:"Field",name:{kind:"Name",value:"parentEntityTitle"}},{kind:"Field",name:{kind:"Name",value:"reaction"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderDecoratedDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderSurname"}},{kind:"Field",name:{kind:"Name",value:"senderId"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"tabId"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"topic"}},{kind:"Field",name:{kind:"Name",value:"translatedPreview"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"fromExternalUser"}},{kind:"Field",name:{kind:"Name",value:"activityId"}},{kind:"Field",name:{kind:"Name",value:"isFromPriorityContact"}},{kind:"Field",name:{kind:"Name",value:"isUrgent"}},{kind:"Field",name:{kind:"Name",value:"isTextMessageVisible"}},{kind:"Field",name:{kind:"Name",value:"externalAppIcon"}}]}}]}}]};var KX,YX;!function(e){e.GroupMessage="GroupMessage",e.Message="Message",e.Mention="Mention",e.Reaction="Reaction",e.InviteJoined="InviteJoined",e.TeamsTasks="TeamsTasks",e.Reminder="Reminder",e.Priority="Priority",e.DLP="DLP"}(KX||(KX={})),function(e){e.Small="HR64x64"}(YX||(YX={}));var XX=n(416609);const ZX={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"msaUserProfilePicture"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},eZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"msaGroupProfilePicture"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MsaGroupProfilePictureInput"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaGroupProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"msaGroupInfo"},value:{kind:"Variable",name:{kind:"Name",value:"msaGroupInfo"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}]}]}}]},tZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"toastImageAsDataUri"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]},nZ={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatEmoticonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"categoryId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"searchEmoticons"},arguments:[{kind:"Argument",name:{kind:"Name",value:"searchFilter"},value:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}}},{kind:"Argument",name:{kind:"Name",value:"exactMatch"},value:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}}},{kind:"Argument",name:{kind:"Name",value:"includeShortCuts"},value:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}}},{kind:"Argument",name:{kind:"Name",value:"includeKeywords"},value:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}}},{kind:"Argument",name:{kind:"Name",value:"maxResultCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}}},{kind:"Argument",name:{kind:"Name",value:"categoryId"},value:{kind:"Variable",name:{kind:"Name",value:"categoryId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsChatEmoticonFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsChatEmoticonFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Emoticon"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"unicode"}},{kind:"Field",name:{kind:"Name",value:"animation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsChatEmoticonFragment_animation"}}]}},{kind:"Field",name:{kind:"Name",value:"etag"}},{kind:"Field",name:{kind:"Name",value:"diverse"}},{kind:"Field",name:{kind:"Name",value:"shortcuts"}},{kind:"Field",name:{kind:"Name",value:"searchMatch"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsChatEmoticonFragment_animation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmoticonAnimation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fps"}},{kind:"Field",name:{kind:"Name",value:"framesCount"}},{kind:"Field",name:{kind:"Name",value:"firstFrame"}}]}}]}.definitions]}.definitions]};var iZ=n(439697),aZ=n(257710),oZ=n(960981),rZ=n(928470);function sZ(e,t,n){let i=e.senderGivenName||e.senderDisplayName;if(i||(n.mark(H.ck.AssignedUnknownUserNameToChatToast),i=mZ(t)),e.subtype)return t.stringTranslate("toastNotifications","new_task_list_added_toast_title",{sender:i})}function lZ(e,t,n){const i=function(e,t,n){const i=t.topic;if(i)return i;if(!t.members?.length)return;return PZ(e,t.members,n)?.displayName}(e,t,n);return t.subtype===rZ.YQ.tFLPlanCreated&&i&&t.text?e.stringTranslate("toastNotifications","task_list_in_group_chat_added_text",{groupChatTitle:i,taskListTitle:t.text}):t.text||void 0}function cZ(e,t,n,i){const{enableInviteeJoinedActivity:a}=n.get(b.J.Activity),o=uZ(e,a?t.senderDisplayName:t.senderGivenName,i);return e.stringTranslate("toastNotifications",a?"toast_invite_joined_with_activity_feed_title":"toast_invite_joined",{sender:o})}function dZ(e,t,n,i,a){const{enableInviteeJoinedActivity:o}=i.get(b.J.Activity);if(o){const t=uZ(e,n.senderDisplayName,a);return e.stringTranslate("toastNotifications","toast_invite_joined_with_activity_feed_text",{sender:t})}return n.members&&n.members.length?n.topic||t(e,n.members,a):void 0}function uZ(e,t,n){return t||(n.mark(H.ck.AssignedUnknownUserNameToTFLtToast),mZ(e))}function mZ(e){return e.stringTranslate("toastNotifications","toast_unknown_user")}var pZ=n(327557),gZ=n(626340),hZ=n(54927);async function yZ(e,t,n,i){const{enableInAppNotificationsForChatsAndChannels:a}=i.get(b.J.Notifications,["enableInAppNotificationsForChatsAndChannels"]),{enableCustomNotificationsForChats:o}=i.get(b.J.Core,["enableCustomNotificationsForChats"]);try{const i=!a&&!o;if(n.type===KX.Priority&&i)return t.log(`${li.f.ReturningHardcodedImage}: Returning default priority message avatar for toast ${n.correlationId}`),pZ.ap;if(n.type===KX.DLP)return t.log(`${li.f.ReturningHardcodedImage}: Returning default dlp message avatar for toast ${n.correlationId}`),pZ.Uw;if(1===n.members?.length&&n.type===KX.GroupMessage)return t.log(`${li.f.ReturningHardcodedImage} Returning default group message avatar for toast ${n.correlationId} as there is just one member`),pZ.dA;if((0,NX.j8)(n.conversationId)&&(0,vy.EG)(n.senderId))return t.log(`${li.f.ReturningHardcodedImage} Returning default PSTN avatar for toast ${n.correlationId} as sender is PSTN contact`),pZ.Az;const r=n.type===KX.GroupMessage?await async function(e,t){if(!t.members?.length)return null;const{data:n}=await e.query({query:eZ,variables:{msaGroupInfo:{pictureReadyUsers:t.members.map((({id:e,displayName:t})=>({userId:e,displayName:t}))).slice(0,bl.gT.FOUR),conversationId:t.conversationId}}});return n.msaGroupProfilePicture}(e,n):await async function(e,t){const{data:n}=await e.query({query:ZX,variables:{userId:t.senderId,displayName:t.senderDisplayName,profilePictureSize:YX.Small}});return n.msaUserProfilePicture}(e,n);if(!r)return void t.error(li.f.ImageUrlGenerationFailed);const s=await e.query({query:tZ,variables:{url:r}}),l=s?.data.toastImageAsDataUri;return l?(t.log(li.f.ReturningFetchedImage),t.log(`Returning fetched image for toast ${n.correlationId}`),l):void t.error(li.f.ToastImageAsDataUriIsUndefined)}catch(e){return void t.error(li.f.ImageFetchFailed)}}function vZ(e,t,n){const{enableToastMediaTextPreview:i,enableUrgentToastsContentFixes:a,enableToastDefaultTextFallbackFix:o}=e.get(b.J.Notifications);return n.interopConversationStatus===RX.uI.AcceptPending||n.interopConversationStatus===RX.uI.ExtendedDirectoryAcceptPending?t.stringTranslate("people","invite_free_quarantined_notification_content"):n.isUrgent&&a?fZ(t,n,!!o):i?SZ(t,n,!!o):CZ(t,n.text,!!o)}function fZ(e,t,n){return t.messagePreviewTemplateOption===rG.yF.hasText?kZ(e,t,n):CZ(e,t.translatedPreview,n)}function SZ(e,t,n){switch(t.contentType){case hZ.zc.FILE:return e.stringTranslate("toastNotifications","toast_messaging_sent_a_file");case hZ.zc.VOICE:return e.stringTranslate("toastNotifications","toast_messaging_sent_a_voice_message");case hZ.zc.IMAGE:return e.stringTranslate("toastNotifications","toast_messaging_sent_an_image");case hZ.zc.LOCATION:return e.stringTranslate("toastNotifications","toast_messaging_sent_a_location_message");case hZ.zc.VIDEO:return e.stringTranslate("toastNotifications","toast_messaging_sent_an_video");case hZ.zc.TEXT:return kZ(e,t,n);default:return CZ(e,t.text,n)}}function kZ(e,t,n){return!t.isTextMessageVisible&&n?e.stringTranslate("toastNotifications","toast_messaging_preview_hidden"):CZ(e,t.text,n)}function CZ(e,t,n){const i=function(e){const t=(0,aZ.S)(e,!0).replace(/\s\s+/g," ");return(n=t,n.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g,"Â ").replace(/&quot;/g,'"')).trim();var n}(t||"");return n?i||e.stringTranslate("toastNotifications","toast_messaging_default_fallback"):i}async function bZ(e,t,n,i,a,o){switch(a.log(`${li.f.MappingCommandOptions}: Generating command options for type ${n.type}`),n.type){case KX.Message:case KX.Priority:return function(e,t,n,i){return{...AZ(n),...EZ(t,n.interopConversationStatus),text:vZ(e,t,n),title:wZ(e,t,n,i),isUrgent:!!n.isUrgent,isFromPriorityContact:!!n.isFromPriorityContact,externalAppIconType:n.externalAppIcon?n.externalAppIcon:void 0}}(e,t,n,o);case KX.GroupMessage:return function(e,t,n,i){return{...AZ(n),...EZ(t,n.interopConversationStatus),text:NZ(e,t,n),title:n.topic||DZ(t,n.members,i)}}(e,t,n,o);case KX.Mention:case KX.Reaction:return async function(e,t,n,i,a){const o=t.type===KX.Reaction?await async function(e,t,n){try{const{id:t}=(0,gZ.Mc)(n?.toLocaleLowerCase().trim());if(!t)return;const{data:i}=await e.query({query:nZ,variables:{searchFilter:t,exactMatch:!0}});return(i?.searchEmoticons||[])[0]}catch(e){return void t.error(li.f.ChatToastEmoticonsQueryFailed)}}(n,i,t.reaction):void 0;return{...AZ(t),text:t.topic||FZ(e,t.senderGivenName||t.senderDisplayName,t.members,a),isUrgent:!!t.isUrgent,isFromPriorityContact:!!t.isFromPriorityContact,title:TZ(e,t,o?.unicode||void 0)}}(t,n,i,a,o);case KX.InviteJoined:return function(e,t,n,i){return{...AZ(n),text:dZ(t,DZ,n,e,i),title:cZ(t,n,e,i)}}(e,t,n,o);case KX.TeamsTasks:return async function(e,t,n,i,a){const o=await async function(e,t,n,i){if(!i)return;const a=await e.query({query:oZ.b,variables:{id:n,queryType:"QueryByThread"},fetchPolicy:"network-only"}).catch((()=>{t.error(li.f.ChatTabsFetchFailed)})),o=a?.data.platformTabs?.find((e=>e?.entityId&&e?.entityId.toLowerCase().includes(i.toLowerCase())));o||t.log(li.f.ToastNavigationDataNotFound);return o}(n,i,t.conversationId,t.tabId);return{...AZ(t),text:lZ(e,t,a)||"",title:sZ(t,e,a)??"",type:KX.TeamsTasks,tabId:JSON.stringify({tabId:o?.baseInfo.id,threadId:t.conversationId,appId:o?.baseInfo.appId,tabEntityId:o?.entityId})}}(t,n,i,a,o);case KX.DLP:return async function(e,t,n){return{...AZ(t),text:t.topic||_Z(e,t.displayName||t.senderDisplayName,t.members,n),isUrgent:!!t.isUrgent,title:IZ(e,t)}}(t,n,o);default:return}}function wZ(e,t,n,i){let a=function(e,t,n){if(!t.senderDisplayName||iZ.eo.isDisplayNameUnknownUser(t.senderDisplayName))return n.mark(H.ck.AssignedUnknownUserNameToChatToast),e.stringTranslate("toastNotifications","toast_unknown_user");return t.senderDisplayName}(t,n,i);if(iZ.eo.isTFLSmsMri(n.senderId))return t.stringTranslate("toastNotifications","toast_messaging_sms_user_given_name",{sender:a});return n.fromExternalUser&&n.senderDecoratedDisplayName&&(a=n.senderDecoratedDisplayName),n.isUrgent&&e.get(b.J.Notifications)?.enableUrgentToastsContentFixes?t.stringTranslate("toastNotifications","toast_messaging_urgent_message_title",{sender:a}):a}function TZ(e,t,n){switch(t.type){case KX.Mention:const i="everyone"===t.subtype?"toast_messaging_mention_everyone":"toast_messaging_mention";return`@ ${e.stringTranslate("toastNotifications",i,{sender:t.senderDisplayName})}`;case KX.Reaction:return e.stringTranslate("toastNotifications","toast_messaging_reaction",{sender:t.senderDisplayName,emoji:n})}}function IZ(e,t){if(t.type===KX.DLP)return e.stringTranslate("toastNotifications","dlp_notify_sender_header")}function NZ(e,t,n){const{enableToastMediaTextPreview:i,enableUrgentToastsContentFixes:a,enableToastDefaultTextFallbackFix:o}=e.get(b.J.Notifications);let r=n.text;if(r=n.isUrgent&&a?fZ(t,n,!!o):i?SZ(t,n,!!o):CZ(t,n.text,!!o),!r)return;let s=(0,XX.VQ)(t.locale,n.senderSurname||void 0,n.senderGivenName||void 0,n.senderDisplayName||void 0);if(iZ.eo.isTFLSmsMri(n.senderId))return t.stringTranslate("toastNotifications","toast_messaging_sms_group_text_with_sender",{sender:s,text:r});s=n.senderDecoratedDisplayName||s;const{enableGroupChatInviteFlow:l}=e.get(b.J.Messaging);return l&&n.interopConversationStatus===RX.uI.AcceptPending?t.stringTranslate("toastNotifications","toast_messaging_group_chat_invite_flow_text_with_sender",{displayName:s}):t.stringTranslate("toastNotifications","toast_messaging_group_text_with_sender",{sender:s,text:r})}function EZ(e,t){return t===RX.uI.AcceptPending||t===RX.uI.ExtendedDirectoryAcceptPending||t===RX.uI.Quarantined?{quickReply:!1}:{quickReply:!0,quickReplyPlaceholder:e.stringTranslate("toastNotifications","toast_messaging_quickreply_placeholder_text"),quickReplyButton:e.stringTranslate("toastNotifications","toast_messaging_quickreply_button_text")}}function AZ(e){return{conversationId:e.conversationId,messageId:e.messageId,quickReply:!1,time:new Date(+e.timestamp),discardDuringMeetingsAndCalls:!!e.discardDuringMeetingsAndCalls}}function _Z(e,t,n,i){if(t)return e.stringTranslate("toastNotifications","toast_messaging_activity_text",{participants:t});const a=PZ(e,n,i);return a?e.stringTranslate("toastNotifications",a.count?"toast_messaging_activity_text_with_count":"toast_messaging_activity_text",{participants:a.displayName,count:a.count}):e.stringTranslate("toastNotifications","toast_messaging_default_group_topic")}function FZ(e,t,n,i){const a=PZ(e,n,i);return a?e.stringTranslate("toastNotifications",a.count?"toast_messaging_activity_text_with_count":"toast_messaging_activity_text",{participants:a.displayName,count:a.count}):t?e.stringTranslate("toastNotifications","toast_messaging_activity_text",{participants:t}):e.stringTranslate("toastNotifications","toast_messaging_default_group_topic")}function DZ(e,t,n){const i=PZ(e,t,n);return i?e.stringTranslate("toastNotifications",i.count?"toast_messaging_group_topic_with_count":"toast_messaging_group_topic",{participants:i.displayName,count:i.count}):e.stringTranslate("toastNotifications","toast_messaging_default_group_topic")}function PZ(e,t,n){if(!t||!Array.isArray(t)||0===t.length)return;const i=e.stringTranslate("toastNotifications","toast_unknown_user");let a=!1;const o=t.map((t=>{const n=(0,XX.VQ)(e.locale,t.surname||void 0,t.givenName||void 0,t.displayName||void 0);return n||(a=!0,i)}));return a&&n.mark(H.ck.AssignedUnknownUserNameToGroupChatToast),(0,XX.Nh)(o,t.length)}function MZ(e,t,n,i,a,o,r,s,l){const{enableCommandToHostCommService:c}=t.get(b.J.Core,["enableCommandToHostCommService"]),{enableBrowserToasts:d,enableInAppNotifications:u,enableInAppNotificationsForChatsAndChannels:m}=t.get(b.J.Notifications,["enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"toast-event-subscription",runOncePerId:!0,job:async()=>{const p=r.newLogger("ToastEventSubscription","apps-chat");c||d||u&&m?(p.log(li.f.Subscribing),n.subscribe({query:QX,fetchPolicy:"no-cache"}).forEach(function(e,t,n,i,a,o,r,s,l){const{enableToastCollections:c}=t.get(b.J.Notifications);return async d=>{if(d.errors){const e=(0,$.u4)(d.errors.map((e=>e.message)).join());return r.error(`${li.f.SubscriptionFailed} ${e}`),void xZ(s,{errorCode:li.f.SubscriptionFailed,errors:e})}if(!d.data?.toastEvent)return r.error(li.f.EmptyEvent),void xZ(s,{errorCode:li.f.EmptyEvent});r.log(`${li.f.ToastEventReceivedInJob}: Received a valid event in the toast subscription job, correlationId:${d.data.toastEvent.correlationId}, activityId:${d.data.toastEvent.activityId}`);const{toastEvent:u}=d.data,m=s.newScenario(H.RG.CrossClientToastView,{startTime:+u.timestamp});m.clientId=u.correlationId,m.appendEventData({activityId:d.data.toastEvent.activityId,isUrgent:!!d.data.toastEvent.isUrgent,mainEntityType:Se.py.chats,mainEntitySubtype:d.data.toastEvent.type,messageId:d.data.toastEvent.messageId}),m.mark(H.ck.CrossClientToastEventReceived),r.log(`${li.f.LogToastInfo}: ${JSON.stringify(m.eventData)}`);const p=await bZ(t,a,u,n,r,m);if(!p)return r.log(`${li.f.UnhandledType} ${u.type}`),void m.incomplete({reason:li.f.UnhandledType});const g=await o({id:p.conversationId,type:Se.py.chats,action:Se.uk.view,linkedEntity:null},n);if(m.mark(H.ck.CrossClientConversationFocusChecked),g)return r.log(li.f.ToastSuppressedForWindowInFocus),void m.incomplete({reason:li.f.ToastSuppressedForWindowInFocus});const h=await yZ(n,r,u,t);m.mark(H.ck.CrossClientAvatarFetched),h&&(p.mainImage={alt:"",src:h}),s.hoistScenarioToCore?.(m),c&&(p.collectionId=HJ(e,l,r)),p.type===KX.TeamsTasks?i.toasts.showChatTabEntityNotification(u.correlationId,p):i.toasts.showMessage(u.correlationId,p),m.mark(H.ck.CrossClientEntityCommandTriggered),r.log(`${li.f.ToastCommandSent} type:${p.type} correlationId:${u.correlationId} activityId:${u.activityId}`)}}(e,t,n,i,a,o,p,s,l))):p.log(li.f.NotEnabled)}}}function xZ(e,t){const n=e.newScenario(H.RG.CrossClientToastView);n.appendEventData({mainEntityType:Se.py.chats}),n.fail(t)}const RZ=({context:{authenticationUser:e,client:t,coreSettings:n,entityCommanding:i,i18n:a,isEntityInView:o,loggerFactory:r,scenarioFactory:s,userTrackingService:l}})=>[MZ(e,n,t,i,a,o,r,s,l)],jZ=({context:{scenarioFactory:e,coreSettings:t}})=>{const n=[{id:"import-chat-bundle",runOncePerId:!0,job:()=>(async({scenarioFactory:e,coreSettings:t})=>{const n=t?.get(b.J.Core).enableSerializeChunkImport,i="chat-app";if(n){const t=e.findScenario("application_launch_time");t?.mark("load_chat_app_start"),await(0,ac.mT)(HX,i,e),t?.mark("load_chat_app_end")}else(0,ac.mT)(HX,i,e)})({scenarioFactory:e,coreSettings:t})}];return n};var LZ=n(750949);function OZ({scenarioFactory:e,loggerFactory:t,client:n,windowProvider:i,coreSettings:a,localStorage:o,authenticationUser:r}){return{id:"bizchat-app-pre-warm",runOncePerId:!0,job:async()=>(async(e,t,n,i,a,o,r)=>{const s=t.newLogger("BizChatAppPreWarmStrategy","apps-chat"),l=e.newScenario(H.RG.BizChatPreWarm);l.appendEventData({correlationId:(0,Re.v4)()});const c=async e=>{i.document.getElementById("bizChatAppIframe")?.remove(),s.infoToTelemetry?.("Removed Hidden Iframe","bizchat_pre_warm_info"),l?.stop({reason:"iframe-removed"}),Promise.resolve()};try{if(s.infoToTelemetry?.("BizChat pre-warm job started","bizchat_pre_warm_info"),!r?.profile.objectId||!r?.profile.tenantId)return s.errorToTelemetry?.("No authentication user found","bizchat_pre_warm_error"),void l?.fail();const{data:e}=await n.query({query:LZ.V,variables:{scope:"Personal",appId:"b5abf2ae-c16b-4310-8f8a-d3bcdb52f162"},context:{callerInfo:"BizChatAppPreWarmStrategy"}});if(!e||!e.appDefinition)return s.infoToTelemetry?.("No app definition found. Cancelling bizchat pre-warm job","bizchat_pre_warm_info"),void l?.cancel({reason:"No App Definition"});let t=e.appDefinition?.staticTabs&&e.appDefinition.staticTabs[0]?.contentUrl||void 0;if(!t)return s.errorToTelemetry?.("No contentUrl found in the app definition","bizchat_pre_warm_error"),void l?.fail();const d=t.split("hosted/semanticoverview"),u=d[0],m=d[1],p=i.loader?.getProperties?.(),g=p?.sessionId||Ze.get("sessionId"),{telemetryRegion:h}=a.get(b.J.Telemetry),{ring:y}=a.get(b.J.Metadata),v=encodeURIComponent(r.profile.objectId),f=encodeURIComponent(r.profile.tenantId),S=encodeURIComponent(g??""),k=encodeURIComponent(l.eventData.correlationId??"");t=`${u}semanticoverview/Users('OID:${v}@${f}')${m}&prewarm=true&sessionid=${S}&prewarmid=${k}&isEU=${encodeURIComponent("EMEA"===h)}&hostring=${encodeURIComponent(y?.id??"")}`;const C=((e,t)=>{const n=e.document.createElement("iframe");return n&&(n.setAttribute("id","bizChatAppIframe"),n.style.display="none",n.setAttribute("target","_self"),n.setAttribute("sandbox","allow-scripts allow-same-origin"),n.setAttribute("referrerpolicy","strict-origin-when-cross-origin"),n.setAttribute("allow",""),n.setAttribute("src",t),e.document.body.appendChild(n)),n&&n.contentWindow||null})(i,t);if(!C)return s.errorToTelemetry?.("Failed to create hidden iframe","bizchat_pre_warm_error"),void l?.fail();((e,t,n)=>{let i;i=void 0,i=t.setTimeout((()=>{n?.(!0),t.clearTimeout(i)}),e)})(18e3,i,c),o?.set("BizChatAppPreWarmTimeStamp",Date.now().toString(),"Messaging")}catch(e){const t=`Failed BizChatAppPreWarmStrategy with errorCode ${e?.errorCode||e?.code}`;s.errorToTelemetry?.(t,"bizchat_pre_warm_error"),l?.fail()}})(e,t,n,i,a,o,r)}}const $Z=({context:{coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,entityCommanding:s,platformService:l,networkState:c,config:d,clientState:u,rebootService:m,userTrackingService:p,authenticationUser:g}})=>{const h=[],{enableBizChatPreWarm:y,bizChatPreWarmRelaunchInterval:v}=e.get(b.J.Messaging);if(y){const y=i?.newScenario(H.RG.BizChatPreWarmIdleStateTrigger),f=o?.get("BizChatAppPreWarmTimeStamp");let S=!0;if(f){const e=v??288e5,t=+f;S=Date.now()-t>e}S?(y?.stop({reason:"Job-pushed"}),h.push(OZ({coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,entityCommanding:s,platformService:l,networkState:c,config:d,clientState:u,rebootService:m,userTrackingService:p,authenticationUser:g}))):y?.stop({reason:"Job-Skipped"})}return h},UZ=e=>{if(BZ(e))return WZ(e)?{subNavEntity:HZ(e),headerEntity:VZ(e),startEntity:GZ(e),mainEntity:zZ(e),endEntity:qZ(e)}:null},BZ=({contextEntity:e,entity:t,layoutMode:n})=>{const{action:i=null,type:a}={...t},{type:o,action:r}=e||{},s=[ke.lO.standard,ke.lO.focus].includes(n),l=[Se.uk.create,Se.uk.default,Se.uk.empty,Se.uk.info,Se.uk.infoDetails,Se.uk.join,Se.uk.list,Se.uk.view,Se.uk.manage],c=i&&l.includes(i),d=r&&o,u=[Se.py.byodchat,Se.py.chats,Se.py.chatthread,Se.py.chatschannelconv,Se.py.chatsInfo,Se.py.chatContextualSearch,Se.py.chatcopilotsynthesis,Se.py.chatsInfoView,Se.py.chatManageApps,Se.py.chatHighlightsDetails,Se.py.chatfluidthread,Se.py.chatfilesdetails,Se.py.chatpeopledetails,Se.py.chatworkflows,Se.py.messageactionworkflows,Se.py.messageextensionworkflows,Se.py.chatpinnedmessagesdetails,Se.py.holisticrecap,Se.py.extensibilityapppickersidepanel].includes(a),m=n===ke.lO.focus&&i===Se.uk.list;return!(!s||!u||!c&&!d||m)},WZ=({entity:e,contextEntity:t})=>{const{type:n}=t||{},{action:i=null,type:a}=e||{},o=[Se.py.byodattendeewindow,Se.py.calls,Se.py.callsgalleryandcontent,Se.py.callsgallery,Se.py.callscontent,Se.py.platformStage,Se.py.meetingroomallinonecall];return!(a!==Se.py.chats&&a!==Se.py.chatthread&&a!==Se.py.byodchat&&a!==Se.py.chatsInfoView&&a!==Se.py.chatschannelconv&&a!==Se.py.holisticrecap&&!o0(a)||!(i||n&&!o.includes(n)))},HZ=({contextEntity:e,entity:t,layoutMode:n})=>{if(n===ke.lO.focus)return null;const{type:i,action:a}=t;if(i===Se.py.chatthread)return null;let o;"options"in t?o=r0(t):e&&"options"in e&&(o=r0(e)),o||i!==Se.py.chats&&i!==Se.py.chatschannelconv||a!==Se.uk.default||(o=ri.Y.LeftRailSelectedItem);return{action:Se.uk.list,entityState:{flushableByLinkedEntity:!0},id:null,linkedEntity:null,options:o?(0,$.u4)({focusOnLoad:o}):null,type:i,windowOptions:null}},VZ=({entity:e})=>{let t=Se.uk.view;const{type:n,action:i=null}={...e},a=[Se.uk.create,Se.uk.default,Se.uk.empty,Se.uk.join];return i&&a.includes(i)&&(t=i),n===Se.py.chatthread?{id:e.id?.split(";replyChainId")[0]??"",type:Se.py.chats,action:Se.uk.view}:{...e,action:t}},GZ=()=>null,zZ=({entity:e,contextEntity:t})=>{let n=Se.uk.view;const{type:i,action:a=null}={...e},o=[Se.uk.create,Se.uk.default,Se.uk.empty,Se.uk.join,Se.uk.manage];return a&&o.includes(a)&&(n=a),i===Se.py.chatthread?{id:e.id?.split(";replyChainId")[0]??"",type:Se.py.chats,action:Se.uk.view}:t||{...e,action:n}},qZ=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const{chatInfoPaneVisibilityState:o}=n?.get(b.J.Host)||{},{enableChatInfoPaneSearch:r,enableCopilotSynthesisInChat:s}=n?.get(b.J.Messaging)||{},{enableChatInfoPane:l}=n?.get(b.J.Host)||{},{enableExtensibilityAppPicker:c}=n?.get(b.J.Extensibility)||{},d=QZ(n),u=YZ(o,a,d);let m,p,g,h;if(t){if(({id:m,type:p,options:g,action:h}=t),p===Se.py.meetingcollaboration)return t}else({id:m,type:p}=e),"options"in e&&(g=e.options);if(!((e,t,n,i,a,o)=>!(a!==Se.py.chatContextualSearch&&a!==Se.py.chatcopilotsynthesis&&a!==Se.py.chatHighlightsDetails&&a!==Se.py.chatfluidthread&&a!==Se.py.chatsInfoView&&a!==Se.py.chatsInfo&&a!==Se.py.chatpeopledetails&&a!==Se.py.chatfilesdetails&&a!==Se.py.chatpinnedmessagesdetails&&a!==Se.py.extensibilityapppickersidepanel&&a!==Se.py.chatthread&&(t!==ke.lO.standard||e||!i?.get(b.J.Core)?.enableInfoPaneAsResponsiveMenu)||!(a!==Se.py.chatsInfoView&&a!==Se.py.chatsInfo&&a!==Se.py.chats||o)||n&&t!==ke.lO.standard&&t!==ke.lO.focus))(u,i,r,n,p,l))return null;const y=KZ(m),v=(0,IX.fM)(m);if(y||v)return null;const f=JZ(p);if(a0(p,h,r,s,!!c)){return{action:Se.uk.info,id:m||"",type:p,options:g}}if(f){return{action:Se.uk.info,id:m||"",type:Se.py.chatsInfoView}}if(o0(p)){return{action:Se.uk.infoDetails,id:m||"",type:p,options:g}}return p===Se.py.chatthread?{action:Se.uk.view,id:m??"",type:p,options:g}:null},JZ=e=>e===Se.py.byodchat||e===Se.py.chats||e===Se.py.chatschannelconv||e===Se.py.chatsInfoView,QZ=e=>{if(e){const{enableChatInfoPaneDefaultOpen:t}=e.get(b.J.Messaging),{enableChatInfoPaneDefaultOpen:n}=e.get(b.J.Host);return t||n}return!1},KZ=e=>(0,IX.wm)(e)||(0,IX.UL)(e),YZ=(e,t,n)=>"closed"===(e??t?.infoPane?.chatsInfoView??(n?"hidden":"closed")),XZ=e=>new Map([[wH.Rd.IS_GREATER_THAN_0,e],[wH.Rd.IS_AT_LEAST_947,e],[wH.Rd.IS_AT_LEAST_1350,e],[wH.Rd.IS_AT_LEAST_1500,e]]),ZZ=(e,t)=>e?.find((e=>e.breakpoint===t))?.width,e0="41rem",t0="32rem",n0="0",i0=({areEmptySlotsTransparent:e,coreSettings:t,entity:n})=>{const{isFlyoutChat:i}=t?.get(b.J.Flyout)??{},{isNonInteractiveMeetingChat:a,chatPaneWidthOnLargeScreen:o}=t?.get(b.J.Calling)??{};let r=["Teacher","Student"].includes(t?.get(b.J.UserResources).licenseType)?XZ("32rem"):void 0;if(!r&&a){const{enableResponsiveChatPanel:e}=t?.get(b.J.Calling)??{};r=e?new Map([[wH.Rd.IS_GREATER_THAN_0,t0],[wH.Rd.IS_AT_LEAST_1350,ZZ(o,wH.Rd.IS_AT_LEAST_1350)??e0],[wH.Rd.IS_AT_LEAST_2560,ZZ(o,wH.Rd.IS_AT_LEAST_2560)??"47rem"],[wH.Rd.IS_AT_LEAST_3840,ZZ(o,wH.Rd.IS_AT_LEAST_3840)??"72rem"]]):XZ(e0)}const{chatInfoPaneVisibilityState:s}=t?.get(b.J.Host)??{};return r=s&&"hidden"===s?new Map([[wH.Rd.IS_GREATER_THAN_0,n0],[wH.Rd.IS_AT_LEAST_947,n0],[wH.Rd.IS_AT_LEAST_1350,t0],[wH.Rd.IS_AT_LEAST_1500,t0]]):r,r=n?.type===Se.py.extensibilityapppickersidepanel?new Map([[wH.Rd.IS_GREATER_THAN_0,n0],[wH.Rd.IS_AT_LEAST_947,n0],[wH.Rd.IS_AT_LEAST_1350,t0],[wH.Rd.IS_AT_LEAST_1500,t0]]):r,r=n?.type===Se.py.chatfluidthread?new Map([[wH.Rd.IS_GREATER_THAN_0,"30rem"],[wH.Rd.IS_AT_LEAST_947,"40rem"],[wH.Rd.IS_AT_LEAST_1350,"50rem"],[wH.Rd.IS_AT_LEAST_1500,"75rem"],[wH.Rd.IS_AT_LEAST_1680,"85rem"],[wH.Rd.IS_AT_LEAST_2560,"100rem"]]):r,{endEntity:{[Mt.S.Rail]:{slotWidthOverrides:r,isHideInfoPaneDisabled:n?.type===Se.py.chatContextualSearch||n?.type===Se.py.chatcopilotsynthesis||n?.type===Se.py.chatHighlightsDetails||n?.type===Se.py.chatfluidthread||n?.type===Se.py.extensibilityapppickersidepanel,infoPaneVisibilityStateInHybrid:s}},subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e,isWideSubNav:!!t?.get(b.J.MercuryDesign).enableMercuryDesign}},mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!!i,infoPaneVisibilityStateInHybrid:s}},headerEntity:{[Mt.S.HorizontalBar]:{isBackgroundTransparent:e}}}},a0=(e,t,n,i,a)=>t!==Se.uk.infoDetails&&(e===Se.py.chatHighlightsDetails||e===Se.py.chatfluidthread||e===Se.py.extensibilityapppickersidepanel&&a||e===Se.py.chatContextualSearch&&n||e===Se.py.chatcopilotsynthesis&&i),o0=e=>e===Se.py.chatpeopledetails||e===Se.py.chatfilesdetails||e===Se.py.chatpinnedmessagesdetails||e===Se.py.chatHighlightsDetails||e===Se.py.chatContextualSearch||e===Se.py.chatcopilotsynthesis||e===Se.py.chatfluidthread||e===Se.py.chatsInfo||e===Se.py.extensibilityapppickersidepanel,r0=e=>{const t=e.options&&(0,am.D)(e.options);if(t?.messageId||t?.searchSessionId||t?.focusOnLoad)return ri.Y.DoNotMove};var s0=n(1947),l0=n(596358),c0=n(894917),d0=n(267089),u0=n(8643);const m0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatShowPrivateMeetingConversationMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"context"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showPrivateMeetingConversation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"context"},value:{kind:"Variable",name:{kind:"Name",value:"context"}}}]}]}}]},p0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatSaveCopilotAppStatesMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"streamStopped"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appFocused"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"saveCopilotAppStates"},arguments:[{kind:"Argument",name:{kind:"Name",value:"streamStopped"},value:{kind:"Variable",name:{kind:"Name",value:"streamStopped"}}},{kind:"Argument",name:{kind:"Name",value:"appFocused"},value:{kind:"Variable",name:{kind:"Name",value:"appFocused"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"streamStopped"}},{kind:"Field",name:{kind:"Name",value:"appFocused"}}]}}]}}]},g0="/l/invite/",h0="/l/claim",y0={[h0]:sa.DL.Claim,[g0]:sa.DL.Invite},v0=new Set([h0,g0]),f0=async(e,t,n,i,a,o)=>{const r=new URLSearchParams(e.search),s=r.get("users")?.split(",").map((e=>e.trim())),l=r.get("message"),c=r.get("topicName");t.log("deeplink_to_chat_qsp_received");const d=i?.context?.client;if(d&&s){let e;try{e=await(0,d0.yA)(d,s,!1,!0,!1,!1,c)}catch(n){t.warn(`deeplink to chat with users: cannot get chat with user, userCount-${s?.length}`),e=null}n.stop({reason:`deeplink to chat with users: userCount-${s?.length} isMessagePresent:${!!l} isTopicNamePresent:${!!c}`});const r=e?.id||IX.FX;return(0,IX.wm)(r)&&await d.mutate({mutation:u0.J}),Promise.resolve({entityCommand:{entity:{type:Se.py.chats,action:Se.uk.view,id:r},command:{visibilityState:o?.visibilityState??ke.fe.show,stateTransition:o?.stateTransition??ke.su.forceFlush},correlation:{source:C.D.ChatDeeplinkUsers},entityOptions:{focusOnLoad:ri.t.Compose,initialComposeMessage:l}},metadata:{allowAnonymous:!1,accountsToUse:C0(a,i)}})}return n.fail({reason:`deeplink to chat with users: cannot get client with userCount-${s?.length} isMessagePresent:${!!l} isTopicNamePresent:${!!c} clientExists:${!!d}`}),Promise.reject("deeplink to chat with users fail")},S0=async(e,t,n,i,a,o)=>{const r=e.pathname.split("/");if(r.length>3){const s=decodeURIComponent(r[3]);if(s.startsWith(RX.at.SkypeSpacesThread)||(0,NX.mB)(s)||(0,IX.wm)(s)){const r=a?.context?.client;if(r){const e=await b0(r,s,t,n,i);if(e)return Promise.resolve(e)}return n.stop({reason:`deeplink to chat with id: ${s}`}),Promise.resolve({entityCommand:{entity:{type:Se.py.chats,action:Se.uk.view,id:s},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new},correlation:{source:C.D.ChatDeeplinkId}},metadata:{allowAnonymous:!1,accountsToUse:C0(o,a),tenantId:w0(e)}})}}return n.fail({reason:`deeplink to chat fail with invalid path: ${(0,ce.A)(e.pathname.replace(/@/g,"_at_"))}`}),t.warnNoPii?.(`invalid path name ${e.pathname}`),Promise.reject("Deeplink to chat path invalid")},k0=(e,t)=>Promise.resolve({entityCommand:{entity:{type:Se.py.chats,action:Se.uk.join},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush},entityOptions:{inviteLinkType:t,inviteLinkUrl:e.toString()}},metadata:{allowAnonymous:!1}}),C0=(e,t)=>{if(e)return t?[t.userContextId]:void 0},b0=async(e,t,n,i,a)=>{const{enableChatDeeplinkUnhideThread:o}=a.get(b.J.Calling);o&&(0,IX.Eu)(t)&&(n.log(`Unhiding chat thread ${t} in deeplink to chat message`),i.mark(H.ck.ExtDeeplinkToChatMessageUnhideThreadStart),await(async(e,t,n,i)=>{try{await e.mutate({mutation:m0,variables:{conversationId:t,context:"apps-chat"}}),i.mark(H.ck.ExtDeeplinkToChatMessageUnhideThreadSuccess)}catch{const e=`Failed to unhide chat thread ${t} in deeplink to chat message`;n.errorNoPii?.(e),i.mark(H.ck.ExtDeeplinkToChatMessageUnhideThreadFail)}})(e,t,n,i));const{data:r}=await e.query({query:c0.v,variables:{convId:t},context:{callerInfo:"apps-chat"}}),s=r?.chat;return!s||s.memberIds&&0!==s.memberIds.length?null:(i.fail({reason:H.ck.ExtDeeplinkToChatMessageUserIsNotMember}),n.log("ext_deeplink_to_chat_message_user_is_not_member."),{entityCommand:{entity:{type:Se.py.chats,action:Se.uk.error,id:s0.P.UnableToViewChat},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}})},w0=e=>new URLSearchParams(e.search).get("tenantId")||void 0,T0={id:"com.microsoft.teams.chat",name:"Chat",getLocalizedName:async e=>(await e.waitForNamespace("messaging"),e.stringTranslate("messaging","messaging_app_name")),actors:[ZO],supportedEntities:[Se.py.alttext,Se.py.byodchat,Se.py.chats,Se.py.chatthread,Se.py.chatschannelconv,Se.py.chatContextualSearch,Se.py.chatcopilotsynthesis,Se.py.chatHighlightsDetails,Se.py.chatfilesdetails,Se.py.chatpinnedmessagesdetails,Se.py.chatfluidthread,Se.py.chatManageApps,Se.py.chatmaxmultiplepinnedmessages,Se.py.chatpeopledetails,Se.py.chatsInfo,Se.py.chatsInfoView,Se.py.codesnippet,Se.py.customizereactions,Se.py.customemojiupload,Se.py.deletechat,Se.py.dlp,Se.py.fluid,Se.py.giphyconsent,Se.py.hyperlink,Se.py.holisticrecap,Se.py.chatInviteConfirmation,Se.py.leavechat,Se.py.messagedraft,Se.py.pinnedchatsmaxreached,Se.py.pinnedconversationitems,Se.py.removechatuser,Se.py.reportConcern,Se.py.forwardMessage,Se.py.reportConcernForTFW,Se.py.sharechatlink,Se.py.streamcamera,Se.py.streamcamerainchannels,Se.py.streamcameraincommunities,Se.py.translationfeedback,Se.py.twowaysmsfriendlyname,Se.py.updategroupchatavatar,Se.py.tfwupdategroupchatavatar,Se.py.blockChat,Se.py.multiStepAcceptChat,Se.py.leaveGroupAndBlockUser,Se.py.m365ChatLike,Se.py.m365ChatDislike,Se.py.m365ChatReportHarm,Se.py.chatworkflows,Se.py.messageactionworkflows,Se.py.messageextensionworkflows,Se.py.extensibilityapppickersidepanel],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Modal,Mt.S.Rail],getDefaultCommand:e=>{const{enableFilterPinnedAppsBasedOnPolicy:t}=e.get(b.J.Extensibility);if(!t||(0,EX.t3)(e.get(b.J.Messaging))!==EX.i1.Disabled)return{action:Se.uk.default,type:Se.py.chats}},windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125},infoPaneStateMapping:{[Se.py.chatpeopledetails]:Se.py.chatsInfoView,[Se.py.chatfilesdetails]:Se.py.chatsInfoView,[Se.py.chatpinnedmessagesdetails]:Se.py.chatsInfoView},getAllowUserWindowingPreference:({coreSettings:e})=>!!e.get(b.J.Chat).chatDeeplinkRespectUserPreference},I0={shouldAddEntitiesToWindowHistory:e=>!(0,IX.UL)(e?.mainEntity?.id)&&e?.mainEntity?.action!==Se.uk.create,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:()=>!0};var N0=n(915323);const E0={onEventReceived:async({eventInput:e})=>{const{event:t,event:{originator:n}}=e;if(n===N0.kn)return A0(t,e.source);switch(t.type){case YV.uS.requestPersonMoreInfo:const n=t.data?.();return Promise.resolve({command:nG(n)});case YV.uS.requestTopicMoreInfo:{const e=t.data?.();return Promise.resolve({command:aG(e)})}case vO.uS.expandTab:{const e=t.data?.();return Promise.resolve({command:Nt.CN.expandTab(e)})}case vO.uS.resetLayoutOverrides:return Promise.resolve({command:Nt.CN.resetLayoutOverrides()});case vO.uS.maximizeTab:return Promise.resolve({command:Nt.CN.maximizeTab()});case vO.uS.showMonitor:return Promise.resolve({command:Nt.CN.showMonitor(e.event.data?.())});case vO.uS.closeMonitor:return Promise.resolve({command:Nt.CN.closeMonitor()});case vO.uS.hideMonitor:return Promise.resolve({command:Nt.CN.hideMonitor()});case vO.uS.unhideMonitor:return Promise.resolve({command:Nt.CN.unhideMonitor()})}return Promise.resolve(void 0)}},A0=async(e,t)=>N0.qh.isOpenThreadPaneEvent(e)?{command:d$(e.data()),source:t}:N0.qh.isHideThreadPaneEvent(e)?{command:u$(e.data()),source:t}:void 0,_0="openContextualSearch",F0=e=>({actor:"chat",action:_0,data:e}),D0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatChatWithUserQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"createLieIfNotFound"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chatWithUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"createLieIfNotFound"},value:{kind:"Variable",name:{kind:"Name",value:"createLieIfNotFound"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},P0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsChatUserPreferenceNewChatQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPersonalSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messagingSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"alwaysPopOutNewChat"}}]}}]}}]}}]}}]},M0={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsChatCreateNewChatMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNewChat"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"conversation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}}]}},{kind:"Field",name:{kind:"Name",value:"memberIds"}},{kind:"Field",name:{kind:"Name",value:"membersLimited"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"givenName"}}]}},{kind:"Field",name:{kind:"Name",value:"memberDisplayNamesLimited"}},{kind:"Field",name:{kind:"Name",value:"chatDisabledContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isUIDisabled"}},{kind:"Field",name:{kind:"Name",value:"disabledReason"}},{kind:"Field",name:{kind:"Name",value:"extendedData"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTime"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"hasIBPolicyRejectedUsers"}}]}}]}}]};var x0=n(90934);const R0=async(e,t,n)=>{await e.mutate({mutation:M0});let i=n;return i||(i=await(async(e,t)=>{const{enableNewChatPopOut:n,enableDefaultSettingsNewChatPopOut:i}=t.get(b.J.Chat);if(!n)return!1;const{data:a}=await e.query({query:P0});return a?.userPreferences?.userPersonalSettings?.messagingSettings?.alwaysPopOutNewChat??!!i})(e,t)),{entity:{type:Se.py.chats,action:Se.uk.view,id:IX.FX},command:{visibilityState:ke.fe.show,stateTransition:i?ke.su.new:ke.su.forceFlush,correlation:{source:C.D.AppBarContextMenu}}}},j0=async({commandInput:e,requestContext:{loggerFactory:t,client:n,executionContext:i,coreSettings:a}})=>{const{command:o,command:{action:r,data:s}}=e,l=t.newLogger("ChatApp onCommandReceived","apps-chat");if(e.command.actor===ZO)switch(r){case e$:return{entity:{type:Se.py.chats,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}};case n$:return R0(n,a,!1);case i$:return R0(n,a,!0);case t$:if(!m$(o)||!o.data?.mri||!o.data?.correlationSource)return void l.error(`Command for action '${o.action}' requires an mri and correlationSource.`);const e=n,t=await(async(e,t)=>{const{data:n}=await e.query({query:D0,variables:{userId:t,createLieIfNotFound:!0},fetchPolicy:"network-only"});return n?.chatWithUser})(e,o.data.mri),c=t?.id;return c?{entity:{type:Se.py.chats,action:Se.uk.view,id:c},command:{stateTransition:ke.su.new,visibilityState:ke.fe.show,correlation:{id:(0,Re.v4)(),source:o.data.correlationSource,startTimestamp:Date.now()}}}:void l.error("Could not fetch the user conversation using the mri");case a$:case o$:return L0(o);case _0:if(!(e=>"object"==typeof e&&null!==e&&"searchQuery"in e&&"entrySource"in e&&"convId"in e&&"logicalId"in e)(s))return void l.error(`Command for action '${r}' requires a searchQuery, entrySource, convId and logiclaId.`);const{entityTypeChat:d,entityTypeChannel:u}=(e=>{const t=e.viewEntities.mainEntity?.type;return{entityTypeChat:t===Se.py.chats,entityTypeChannel:t===Se.py.channels}})(i);if(!d&&!u)return void l.error(`Command for action '${r}' requires entity type to be ${Se.py.chats} or ${Se.py.channels}`);const m=((e,t)=>{let n;if(t)n=e.viewEntities.mainEntity?.id||"";else{const t=JSON.parse(e.viewEntities.mainEntity?.id||"").channelId;n=JSON.stringify({channelId:`${t}`})}return n})(i,d),p=d?Se.py.chatContextualSearch:Se.py.channelcontextualsearch,g=d?C.D.ChatContextualSearch:C.D.ChannelContextualSearch;return{entity:{id:m,action:Se.uk.info,type:p},command:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{id:(0,Re.v4)(),source:g}},entityOptions:{detailViewType:x0.em.Search,searchQuery:s.searchQuery,entrySource:s.entrySource,convId:s.convId,logicalId:s.logicalId}};default:l.error(`Command action '${r}' is not supported at ChatApp.`)}else l.error(`Command for actor '${e.command.actor}' cannot be handled by ChatApp.`)},L0=async e=>{if(p$(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i,showBackButton:a}=e.data;return{entity:{id:`${t};replyChainId=${n}`,type:Se.py.chatthread,action:Se.uk.view},entityOptions:{showBackButton:a},command:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{source:i}}}}if(g$(e)&&e.data){const{convId:t,replyChainId:n,commandSource:i}=e.data;return{entity:{id:`${t};replyChainId=${n}`,type:Se.py.chatthread,action:Se.uk.view},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.none,correlation:{source:i}}}}},O0=({appViewState:e,availableEntities:t,requestContext:n})=>{const{selectedChatId:i}=e,{coreSettings:a}=n,o=a.get(b.J.ChatList).bizChatMetaOSAppId;if(t.mainEntity?.type===Se.py.chats&&(t.mainEntity?.action===Se.uk.view||t.mainEntity?.action===Se.uk.create||t.mainEntity?.action===Se.uk.default)||t.mainEntity?.type===Se.py.chatschannelconv&&t.mainEntity?.action===Se.uk.view||t.mainEntity?.type===Se.py.chatManageApps){const e=t.mainEntity?.id;i?.read()!==e&&i?.update(t.mainEntity?.action===Se.uk.create?void 0:t.mainEntity?.id)}else if(t.mainEntity?.type===Se.py.extensions&&t.mainEntity.action===Se.uk.view&&t.mainEntity.id){let e;try{e=JSON.parse(t.mainEntity.id).appId}catch(t){e=void 0}e&&o===e&&i?.read()!==e&&i?.update(e)}return Promise.resolve(void 0)},$0={gqlTypeName:"ChatAppViewState",queryFieldName:"chatAppViewState",computedValues:void 0,navigationalFieldDefaultValues:{},nonNavigationalFieldDefaultValues:{selectedChatId:null}},U0=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),B0=(e,t,n)=>{const i=e.command.correlation.source,{entity:a,command:o,entityOptions:r}=e,s=!(!r||!r.messageId);if(a.type===Se.py.chats&&o.stateTransition===ke.su.new&&o.visibilityState===ke.fe.show){if(s)return H.RG.EntityCommand;if((0,IX.Eu)(a.id))return H.RG.MeetingChatPopOut;const{isNewContextSupportEnabled:e}=n.get(b.J.Host);return e?(0,NX.j8)(a.id)?H.RG.PhonelinkSmsChatPopOut:H.RG.ChatPopOut:H.RG.ChatSwitchPopOut}return a.type!==Se.py.chats&&a.type!==Se.py.byodchat||a.action!==Se.uk.view&&a.action!==Se.uk.default||o.visibilityState!==ke.fe.show||i===C.D.StandAlone?a.type===Se.py.chatContextualSearch&&a.action===Se.uk.info&&o.visibilityState!==ke.fe.hide?H.RG.ContextualSearchStart:a.type===Se.py.chatHighlightsDetails&&a.action===Se.uk.info&&o.visibilityState===ke.fe.show?H.RG.ChatHighlightsDetailsStart:H.RG.EntityCommand:s?H.RG.EntityCommand:((e,t,n)=>{if(e.id===IX.FX)return H.RG.NewChat;if(t===C.D.ChatListMeetingItem||t===C.D.Calendar||(0,IX.Eu)(e.id))return H.RG.MeetingChatSwitch;const{isFlyoutChat:i}=n.get(b.J.Flyout);if(i)return(0,NX.j8)(e.id)?H.RG.PhonelinkSmsInlineChatSwitch:H.RG.InlineChatSwitch;const{chatSwitchInPopOut:a}=n.get(b.J.Chat);return a?H.RG.ChatSwitchPopOut:(0,NX.j8)(e.id)?H.RG.PhonelinkSmsChatSwitch:H.RG.ChatSwitch})(a,i,n)},W0=({coreServices:e,host:t,prevEntityType:n,screenState:i,windowOptions:a})=>{if(n===Se.py.chats)return null;const{height:o,minHeight:r,minWidth:s,offset:l,width:c}=T0.windowFeatures||{},d=t?.screenX||0,u=t?.screenY||0,m=(i?.numOpenWindows||1)*(l||1);return{additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},height:o,left:d+m,minHeight:r,minWidth:s,top:u+m,width:c,...e?.coreSettings.get(b.J.Core).enableRatioToScreenBasedSizing&&H0(t,T0.windowFeatures),...a}};function H0(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}const V0=()=>{const e=({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("ChatApp","apps-chat");return((e,t,n)=>{const{pathname:i}=n,{enableInviteLinks:a}=e.get(b.J.InviteLinks);for(const e of Array.from(v0))if(i.startsWith(e)){if(!a){const e="Invite link redemption is disabled for this experience";return t.error(e),Promise.reject(e)}const i=y0[e];if(void 0===i){const e="No Invite link type found for the specified prefixType";return t.error(e),Promise.reject(e)}return k0(n,i)}const o="No DeeplinkPrefixType found for the specified deeplinkUrl";return t.error(o),Promise.reject(o)})(t.coreSettings,n,e)},t=(e,t)=>{if(t){const t=e.find((e=>e.userContextAccountType===zE.SourceWindow));if(t)return t}const n=e.find((e=>e.userContextAccountType===zE.MainWindow));return n||(e&&e.length>0?e[e.length-1]:void 0)},n={filter:"/l/chat",execute:async({deeplinkUrl:e,context:{getUserContexts:n,loggerFactory:i,scenarioFactory:a,coreSettings:o},preferredCommandInput:r})=>{const s=i.newLogger("ChatApp_parseChatDeeplink","apps-chat"),l=!!o.get(b.J.Chat).chatDeeplinkRespectUserPreference,c=await n(),d=t(c,l);return((e,t,n,i,a,o,r)=>{const s=n.newScenario(H.RG.ExtDeeplinkToChat);if(e.pathname.startsWith("/l/chat/0/0"))return f0(e,t,s,a,o,r);{const{pathname:l,search:c}=e;t.log(`Parsing deeplinkUrl - pathname: ${l}, search: ${c}`);const d=decodeURIComponent(l),u=d.split("/"),m=d?.split(/[/?&]/),p=m?.indexOf("chat"),g=m?.[p+l0.ei],h=u.findIndex((e=>e.startsWith(RX.at.SkypeSpacesThread))),y=u[h],v=new URLSearchParams(c),f=v.get("context");let S;try{S=f&&JSON.parse(f)}catch{const e="executeChatDeeplinkUrl(): Unable to parse context.";throw s.fail({reason:e}),new Error(e)}const k=v.get("tenantId")||void 0;if(g?.startsWith(l0.pQ)||Object.keys(l0.ox).includes(g)){const t=(0,l0.Jj)("",y,e,k,S,g,n,r);return s.stop({reason:"deeplink to chat tab"}),Promise.resolve(t)}return S0(e,t,s,i,a,o)}})((0,$E.P)(e,o),s,a,o,d,l,r)}};return[{filter:"/l/claim",execute:e},{filter:"/l/invite/",execute:e},n,{filter:e=>{if(e.pathname?.startsWith("/l/message")){const t=new URLSearchParams(e.search).get("context");try{const e=null==t?null:JSON.parse(t);return"chat"===e?.contextType}catch{return!1}}return!1},execute:async({deeplinkUrl:e,preferredCommandInput:n,context:{getUserContexts:i,loggerFactory:a,scenarioFactory:o,coreSettings:r}})=>{const s=a.newLogger("ChatApp_parseChatDeeplink","apps-chat"),l=[C.D.ActivityFeed,C.D.ActivityFeedBellClick],c=!(!!n?.correlation?.source&&l.includes(n?.correlation?.source))&&!!r.get(b.J.Chat).chatDeeplinkRespectUserPreference,d=await i(),u=t(d,c);return(async(e,t,n,i,a,o,r)=>{const s=i.newScenario(H.RG.ExtDeeplinkToChatMessage);if(!e.pathname.startsWith("/l/message"))return s.fail({reason:H.ck.ExtDeeplinkToChatMessagePathNotFound}),n.log("ext_deeplink_to_chat_message_path_not_found"),Promise.reject("Deeplink to chat message path not found");const l=e.pathname.split("/"),c=decodeURIComponent(l[3]);if(s.appendEventData({"Thread.Id":c}),l.length>3&&!c.startsWith(RX.at.SkypeSpacesThread)&&!c.startsWith(RX.at.PrivateFeed))return s.fail({reason:H.ck.ExtDeeplinkToChatMessageTypeNotSupported}),n.log("ext_deeplink_to_chat_message_type_not_supported"),Promise.reject("Deeplink to chat message type not supported");let d=4<=l.length?l[4]:void 0;d="0"===d?void 0:d,s.mark(H.ck.ExtDeeplinkToChatMessageParamsReceived),n.log("ext_deeplink_to_chat_message_params_received");const u=o?.context?.client;if(u){const e=await b0(u,c,n,s,t);if(e)return Promise.resolve(e)}s.stop({reason:H.ck.ExtDeeplinkToChatMessageResolved}),n.log("ext_deeplink_to_chat_message_resolved");const m=(0,Re.v4)();return Promise.resolve({entityCommand:{entity:{type:Se.py.chats,action:Se.uk.view,id:c},command:{visibilityState:a?.visibilityState??ke.fe.show,stateTransition:a?.stateTransition??ke.su.flush},correlation:{source:C.D.ChatDeeplinkMessage},entityOptions:{messageId:d,uniqueId:m}},metadata:{allowAnonymous:!1,accountsToUse:C0(r,o)}})})((0,$E.P)(e,r),r,s,o,n,u,c)}},{filter:({protocol:e,pathname:t})=>{return"im:"===e||"sip:"===e&&(n=t.trim(),/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n.toLowerCase()));var n},execute:async({deeplinkUrl:e,context:{getUserContexts:n,loggerFactory:i,coreSettings:a}})=>{const o=i.newLogger("ChatApp_parseChatProtocolDeeplink","apps-chat"),r=T0.getAllowUserWindowingPreference?.({coreSettings:a})||!1,s=await n();return(async(e,t,n,i)=>{const{protocol:a,pathname:o}=e;t.log(`ChatApp_parseChatProtocolDeeplink: Deeplink to chat from protocol ${a} with pathname: ${o} received`);const r=n?.context?.client;if(r){let a;try{a=await(0,d0.PM)(r,e.pathname,!1,!0)}catch(e){t.warn("ChatApp_parseChatProtocolDeeplink: cannot get chat with user"),a=null}const o=a?.id||IX.FX;return(0,IX.wm)(o)&&await r.mutate({mutation:u0.J}),Promise.resolve({entityCommand:{entity:{type:Se.py.chats,action:Se.uk.view,id:o},command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush},correlation:{source:C.D.ChatProtocolDeeplink},entityOptions:{focusOnLoad:ri.t.Compose}},metadata:{allowAnonymous:!1,accountsToUse:C0(i,n)}})}return t.warn("ChatApp_parseChatProtocolDeeplink: canot get apollo client"),Promise.reject("ChatApp_parseChatProtocolDeeplink fail")})(e,o,t(s,r),r)}},{filter:"/l/copilot",execute:async({deeplinkUrl:e,context:{getUserContexts:n,loggerFactory:i,coreSettings:a,scenarioFactory:o}})=>{const r=!!a.get(b.J.ChatList).enableBizChatMetaOSEntryPoint,s=i.newLogger("ChatApp_parseCopilotDeeplink","apps-chat"),l=!!a.get(b.J.Chat).chatDeeplinkRespectUserPreference,c=await n();return((e,t,n,i,a)=>{const o=a?.context?.client,{search:r}=e,s=n.newScenario(H.RG.CopilotAppDeeplinkExecute);if(!e.pathname.startsWith("/l/copilot"))return s.fail({reason:"Invalid deeplink path"}),Promise.reject("Invalid deeplink path");if(s.mark(H.ck.CopilotAppDeeplinkReceived),!i)return s.stop({reason:"Deeplink call not handled because enableBizChatMetaOSEntryPoint is not enabled."}),Promise.resolve(void 0);if("?bold=false"===r)return s.stop({reason:"Expected: deeplink call not handled due to app reloads."}),Promise.resolve(void 0);try{o.mutate({mutation:p0,variables:{streamStopped:!0},fetchPolicy:"no-cache"}).then((()=>{s.mark(H.ck.CopilotAppDeeplinkStatesWritten),s.stop({reason:"Deeplink call successfully handled."})}))}catch(e){t.errorToTelemetry?.("Could not write copilot app states to the cache.","messaging_copilot_app",void 0,!0),s.fail({reason:"Could not write copilot app states to the cache."})}return Promise.resolve(void 0)})(e,s,o,r,t(c,l))}},{filter:"/l/loopthread",execute:async({deeplinkUrl:e,preferredCommandInput:n,context:{getUserContexts:i,coreSettings:a}})=>{const o=!!a.get(b.J.Chat).chatDeeplinkRespectUserPreference,r=await i();return((e,t,n,i)=>{if(!e.pathname.startsWith("/l/loopthread/"))return Promise.reject("Invalid deeplink path");const a=e.pathname.split("/");return Promise.resolve({type:"navigateWithEntityCommand",entityCommand:{entity:{type:Se.py.chatfluidthread,action:Se.uk.view,id:a[3]},command:{visibilityState:t?.visibilityState??ke.fe.show,stateTransition:t?.stateTransition??ke.su.new},correlation:{source:C.D.ChatDeeplinkId}},metadata:{allowAnonymous:!1,accountToUse:C0(i,n)}})})(e,n,t(r,o),o)}}]};function G0(){const e=V0();return{eventHandlers:E0,getAppPhases:GX,getAppViewEntities:UZ,getAppViewEntitiesProps:i0,getAppWindowFeatures:W0,getCommandScenarioName:B0,getPlatformAppIdForEntity:e=>e.type===Se.py.chats||e.type===Se.py.chatschannelconv?"86fcd49b-61a2-4701-b771-54728cd291fb":void 0,manifest:T0,onBeforeAddToNavigation:I0,onBeforeCommandHandled:jX,onBeforeDeeplinkParsed:e,onCommandReceived:j0,onPreInit:jZ,onPreWarm:RZ,onRegister:e=>{e.registerTask(new ul)},onViewUpdateCommandResolved:O0,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n,coreSettings:i})=>{const{enableEntityMoreInfo:a=!1}=i.get(b.J.Core),{ChatViewsRenderer:o,LPC:r}=await(async(e,t,n)=>{const i="chat-app";t("ChunkLoadStarted",{chunkName:i});const{ChatViewsRenderer:a}=await(0,ac.mT)(HX,i,e),{LPC:o}=n?{LPC:U0}:await(0,ac.mT)(VX,i,e);return t("ChunkLoadSucceeded",{chunkName:i}),{ChatViewsRenderer:a,LPC:o}})(n,t,!!a),s=a?U0:rJ.p3;return(0,gO.t)(ez.f,{namespaces:["artifactsPlatform","calling","chatList","compose","extensibility","files","lightbox","messaging","meetingAnalytics","meetingRecap","urlPreview","datepicker","phonelinkSms"],loaderRenderer:null,children:(0,gO.t)(r,{children:(0,gO.t)(s,{children:(0,gO.t)(o,{appRenderMode:e})})})})},viewStateRegistration:$0,onExperienceLongIdle:$Z}}const z0="shell",q0="showToast",J0="updateProfilePicture",Q0="updateDisplayName",K0="openPhonelinkDialog",Y0=e=>({actor:z0,action:q0,data:e}),X0=()=>({actor:z0,action:J0}),Z0=()=>({actor:z0,action:Q0}),e1=()=>({actor:z0,action:K0});var t1=n(449800),n1=n(783279);const i1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainSetSpeedDialMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"setSpeedDialSystemTagInput"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SetSpeedDialSystemTagInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setSpeedDialSystemTag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"setSpeedDialSystemTagInput"},value:{kind:"Variable",name:{kind:"Name",value:"setSpeedDialSystemTagInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SetSpeedDialSystemTagMutationSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"successMessage"}},{kind:"Field",name:{kind:"Name",value:"edge"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cursor"}},{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_Person"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"contactId"}},{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonOneGqlPersonFragment"}}]}}]}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SpeedDialContactsError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}},...n(402938).W.definitions]},a1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainDeleteContactMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contactPayload"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_DeleteContactInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteContact"},arguments:[{kind:"Argument",name:{kind:"Name",value:"contactPayload"},value:{kind:"Variable",name:{kind:"Name",value:"contactPayload"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_ContactMutationSuccess"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"successMessage"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_ContactMutationErrorGeneric"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"OneGQL_ContactMutationErrorNetworkOffline"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorMessage"}}]}}]}}]}}]},o1={onEventReceived:({eventInput:{event:e},requestContext:t})=>{return r1(e)?Promise.resolve({command:nG(e.data())}):s1(e)?Promise.resolve({command:iG(e.data())}):(0,n1.Pu)(e)?Promise.resolve({command:EW(e.data())}):(0,t1.VR)(e)?(n=t.client,i=e.data(),n.mutate({mutation:i1,variables:{setSpeedDialSystemTagInput:i}})).then((({data:e})=>({command:Y0({title:"SetSpeedDialSystemTagMutationSuccess"===e.setSpeedDialSystemTag.__typename?e.setSpeedDialSystemTag.successMessage:e.setSpeedDialSystemTag.errorMessage,intent:"SetSpeedDialSystemTagMutationSuccess"===e.setSpeedDialSystemTag.__typename?"Success":"Error",dismissOnAction:!0,duration:3e3})}))):(0,t1.sF)(e)?Promise.resolve({command:Y0({title:e.data().errorMessage,intent:"Error",dismissOnAction:!0,duration:3e3})}):(0,t1.DE)(e)?((e,t)=>e.mutate({mutation:a1,variables:{contactPayload:t},update(e){const n=e.identify({id:t.id,__typename:"OneGQL_Person"});e.evict({id:n}),e.gc()}}))(t.client,e.data()).then((({data:{deleteContact:e}})=>({command:Y0({title:"OneGQL_ContactMutationSuccess"===e.__typename?e.successMessage:e.errorMessage,intent:"OneGQL_ContactMutationSuccess"===e.__typename?"Success":"Error",dismissOnAction:!0,duration:3e3})}))):Promise.resolve(void 0);var n,i}},r1=e=>e.type===YV.uS.requestPersonMoreInfo,s1=e=>e.type===YV.uS.requestPersonMoreOrgInfo,l1=e=>{if(c1(e))return d1(e)?{subNavEntity:u1(e),headerEntity:m1(e),startEntity:p1(e),mainEntity:g1(e),endEntity:h1(e)}:null},c1=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.callsmain,Se.py.locationnotification,Se.py.locationnotificationbanner].includes(i),r=[Se.uk.create,Se.uk.default,Se.uk.list,Se.uk.view,Se.uk.locationhandler],s=n&&r.includes(n);return!!(a&&o&&s)},d1=()=>!0,u1=()=>null,m1=({entity:e})=>e,p1=()=>null,g1=({entity:e})=>e,h1=()=>null,y1={id:"com.microsoft.teams.callsmain",name:"CallsMain",actors:[zO],supportedEntities:[Se.py.callsmain,Se.py.locationnotification,Se.py.locationnotificationbanner],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Rail,Mt.S.Modal],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600},getDefaultCommand:()=>({type:Se.py.callsmain,action:Se.uk.view})},v1=({appRenderMode:e,coreSettings:t})=>{const{callsAppPhaseTimeouts:n,enableCallsAppPhaseStateMachine:i}=t.get(b.J.Calling),a=new MV.H;if(!i)return a.appPhases;const o=[],r=[];switch(e){case Mt.S.HorizontalBar:o.push(xV.G.CALLS_APP_HEADER_RENDERED);break;case Mt.S.Main:o.push(xV.G.DIALPAD_RENDERED),r.push(xV.G.CALL_GROUP_OWNERS_RENDERED),r.push(xV.G.CALL_FORWARDING_SETTINGS_RENDERED),r.push(xV.G.AUDIO_DEVICE_SETTINGS_RENDERED),o.push(xV.G.CALLS_APP_HISTORY_FETCH_STARTED),o.push(xV.G.CALLS_APP_HISTORY_FETCH_COMPLETED),o.push(xV.G.CALL_HISTORY_RENDERED),o.push(xV.G.CALLS_APP_SPEED_DIAL_FETCH_STARTED),o.push(xV.G.CALLS_APP_SPEED_DIAL_FETCH_COMPLETED),o.push(xV.G.SPEED_DIAL_RENDERED)}return a.registerAppPhase({phase:yt.nh.CRITICAL,signals:o,timeout:n?.critical||1e4}),a.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:r,timeout:n?.postCritical||1e4}),a.appPhases},f1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainMarkAllCallsAsReadMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"markMissedCallsAsRead"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivityReadStatusUpdateError"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorFaced"}}]}}]}}]}}]},S1={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsCallsMainFireCallingIntentMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fireCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntent"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},k1=async({commandInput:e,requestContext:{loggerFactory:t,client:n,coreSettings:i}})=>{const{command:{action:a,data:o}}=e,r=t.newLogger("CallsMainApp onCommandReceived","apps-calling");if(e.command.actor===zO)switch(a){case qO:return{entity:{type:Se.py.callsmain,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}};case JO:return r.infoToTelemetry?.("[UI]: marking all missed calls as read","calling_badge",void 0,!0),void n.mutate({mutation:f1}).then((({data:e})=>{const t=e?.markMissedCallsAsRead?.errorFaced;t?r.errorToTelemetry?.(`[UI]: marking all as read action failed: ${t}.`,"calling_badge",void 0,!0):r.infoToTelemetry?.("[UI]: successfully marked all missed calls as read","calling_badge",void 0,!0)})).catch((e=>{r.errorToTelemetry?.(`[UI]: marking all as read action failed: ${e.message}.`,"calling_badge",void 0,!0)}));case QO:if(!(e=>"object"==typeof e&&null!==e&&"mri"in e&&"correlationSource"in e)(o))return void r.error(`Command for action '${a}' requires an mri and correlationSource.`);const e=n,{enableTfwTflCallingFederation:t}=i.get(b.J.Calling),s=await(async(e,t,n)=>{const i={callingIntent:{type:"OneToOneCall",joinOptions:{outgoingVideo:!1,outgoingAudio:!0,oneToOne:{sharingSourceId:void 0,...n&&{targetApplicationType:"TFL"}},context:"NovaCommandStartAudioCall"},coordinates:{oneToOne:{mri:t}}}},{data:a}=await e.mutate({mutation:S1,variables:i});return a?.fireCallingIntent?.id})(e,o.mri,!!t);return s?{entity:{type:Se.py.calls,action:Se.uk.view,id:s},command:{stateTransition:ke.su.new,visibilityState:ke.fe.show,correlation:{intentId:(0,Re.v4)(),source:o.correlationSource,startTimestamp:Date.now()}}}:void r.error("Could not fetch the user calling IntentId using user mri");default:r.error(`Command action '${a}' is not supported at CallsMainApp.`)}else r.error(`Command for actor '${e.command.actor}' cannot be handled by CallsMainApp.`)},C1=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,938455)),b1=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,967117)),w1=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,565509)),T1=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,450812)),I1=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,932177)),N1=()=>y1.windowFeatures||{},E1=()=>H.RG.CallsAppSwitch,A1="calls-main-app",_1=({children:e})=>(0,gO.t)(hO.Fragment,{children:e});function F1(){const e=()=>null;return{eventHandlers:o1,getAppPhases:v1,getAppViewEntities:l1,getAppWindowFeatures:N1,getCommandScenarioName:E1,getPlatformAppIdForEntity:e=>e.type===Se.py.callsmain?"20c3440d-c67e-4420-9f80-0e50c39693df":void 0,manifest:y1,onCommandReceived:k1,render:async({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a})=>{let o=!0;const r=e=>o=e,{enableLocationNotificationPopup:s,enableEmergencyLocationGlobalBanner:l}=n.get(b.J.Calling);if(t===Mt.S.Rail||t===Mt.S.Main){const e=t===Mt.S.Main,{enableEntityMoreInfo:o}=n.get(b.J.Core),r=e=>e?{LPC:_1}:(0,ac.mT)(T1,A1,a),s=o?_1:rJ.p3;e&&i("ChunkLoadStarted",{chunkName:A1});const[{CallsMainViewsRenderer:l},{CallsTabContextProvider:c},{LPC:d}]=await Promise.all([(0,ac.mT)(C1,A1,a),(0,ac.mT)(b1,A1,a),r(!!o)]);return e&&i("ChunkLoadSucceeded",{chunkName:A1}),(0,gO.t)(ez.f,{namespaces:["calling","messaging"],loaderRenderer:null,children:(0,gO.t)(d,{children:(0,gO.t)(s,{children:(0,gO.t)(c,{children:(0,gO.t)(l,{isMainPanel:e})})})})})}if(t===Mt.S.Modal&&(s||l)){const e="calls-main-app";i("ChunkLoadStarted",{chunkName:A1});const{EditEmergencyAddressDialogComponent:t}=await(0,ac.mT)(I1,e,a);return i("ChunkLoadSucceeded",{chunkName:A1}),(0,gO.t)(t,{showEditAddressDialog:o,setShowEditAddressDialog:r,moduleName:dA.rA.emergencyLocationManageLocationButton})}const{enableCallsAppHeader:c}=n.get(b.J.Calling);if(c&&t===Mt.S.HorizontalBar){i("ChunkLoadStarted",{chunkName:A1});const[{CallsHeaderRenderer:e},{CallsTabContextProvider:t}]=await Promise.all([(0,ac.mT)(w1,A1,a),(0,ac.mT)(b1,A1,a)]);return i("ChunkLoadSucceeded",{chunkName:A1}),(0,gO.t)(t,{children:(0,gO.t)(e,{})})}return(0,gO.t)(e,{})}}}const D1={id:"com.microsoft.teams.cast",name:"CastApp",supportedEntities:[Se.py.cast],supportedRenderModes:[Mt.S.Main],windowFeatures:{width:640,height:720,minWidth:640,minHeight:720}},P1=e=>{if(M1(e))return x1(e)?{subNavEntity:R1(e),headerEntity:j1(e),startEntity:L1(e),mainEntity:O1(e),endEntity:$1(e)}:null},M1=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.cast].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},x1=()=>!0,R1=()=>null,j1=()=>null,L1=()=>null,O1=({entity:e})=>e,$1=()=>null,U1=()=>({mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!1,isThemePinnedToDarkOrHighContrast:!0,UNSAFE_enablePptProvider:!0}}}),B1={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==Se.py.cast,shouldRestoreClientToEntities:()=>!0},W1=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(666384),n.e(553486),n.e(255279),n.e(704043),n.e(979549),n.e(889333),n.e(131055),n.e(196563),n.e(928362),n.e(652421),n.e(846257),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(940495),n.e(98223),n.e(350959),n.e(206237),n.e(48523),n.e(613899),n.e(466157),n.e(326378),n.e(376657)]).then(n.bind(n,423908)),H1=({host:e})=>{const t=e?.screen;if(!t)return{};if(!D1.windowFeatures)return{};const{minHeight:n,minWidth:i}=D1.windowFeatures,{height:a=1,width:o=1}=D1.windowFeatures,{left:r,top:s}=((e,t,n,i)=>{const a=e.availLeft+e.availWidth/2-t/2;let o;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":o=e.availTop+i;break;default:o=e.availTop+e.availHeight/2-n/2}return{left:a,top:o}})(t,o,a,20);return{additionalFeatures:{minHeight:`${n}`,minWidth:`${i}`},height:a,width:o,left:r,top:s,minHeight:n,minWidth:i}};function V1(){const e=()=>null;return{getAppViewEntities:P1,getAppViewEntitiesProps:U1,getAppWindowFeatures:H1,manifest:D1,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main){const e="cast-app";n("ChunkLoadStarted",{chunkName:e});const{CastWizard:t}=await(0,ac.mT)(W1,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(t,{})}return(0,gO.t)(e,{})},onBeforeAddToNavigation:B1}}const G1={id:"com.microsoft.teams.communities",name:"CommunitiesApp",getLocalizedName:async e=>(await e.waitForNamespace("communities"),e.stringTranslate("communities","communities_app_name")),actors:[AO],supportedEntities:[Se.py.communities,Se.py.communitiesonboarding,Se.py.sharecommunitieslink,Se.py.reportconcerncommunities,Se.py.communitiesaddmember,Se.py.communitiesblockmembers,Se.py.communitiescreatechannel,Se.py.communitieseditchannel,Se.py.communitiesdelete,Se.py.communitiesdeletechannel,Se.py.communitiesevents,Se.py.communitiescreateevent,Se.py.communitiesguidelinesdialog,Se.py.communitiesmembers,Se.py.communitiesremovemember,Se.py.communitiessendpostasemaildialog,Se.py.communitiesgetappdialog,Se.py.communitiescreatedialog,Se.py.communitieswelcomebotconfigdialog,Se.py.communitieseditdialog,Se.py.communitiesjoinrequest,Se.py.communitiesjoininviteview,Se.py.embedcommunitycodedialog,Se.py.leavecommunity,Se.py.percommunitynotificationsettingsdialog,Se.py.ownerleavecommunity,Se.py.communitiessettings,Se.py.communitiesreplychain,Se.py.communitiescopilot,Se.py.communitiesnickname,Se.py.communitiesgallery,Se.py.communitiesexplore,Se.py.featurecommunityapplicationdialog],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar,Mt.S.Rail,Mt.S.Modal],getDefaultCommand:()=>({type:Se.py.communitiesonboarding,action:Se.uk.default}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125}},z1=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("CommunitiesApp onCommandReceived","apps-communities");if(e.command.actor===AO)return n===_O?{entity:{type:Se.py.communitiesonboarding,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}}:void i.error(`Command action '${n}' is not supported at CommunitiesApp.`);i.error(`Command for actor '${e.command.actor}' cannot be handled by CommunitiesApp.`)};var q1=n(580632);const J1={onEventReceived:async({requestContext:{loggerFactory:e},eventInput:{event:{originator:t,type:n,data:i},source:a}})=>{const o=e.newLogger("onEventReceived","apps-communities-on-event-received");if(n===vO.uS.expandHeader||n===vO.uS.collapseHeader)return{command:Nt.CN[n](),source:a};if(t===q1.kn)switch(n){case q1.uS.createVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.RB)(e)?{command:$O({...e}),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.deleteVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.nW)(e)?{command:UO({...e}),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.editVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.HY)(e)?{command:BO({...e}),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.shareVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.gM)(e)?{command:HO({...e}),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.viewVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.t5)(e)?{command:VO({...e}),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}default:return void o.error(`Event type '${n}' is not supported by CommunitiesApp.`)}o.error(`Event from originator '${t}' cannot be handled by CommunitiesApp.`)}};var Q1=n(105726);const K1=e=>{if(Y1(e))return X1(e)?{subNavEntity:Z1(e),headerEntity:e3(e),startEntity:t3(e),mainEntity:n3(e),endEntity:i3(e)}:null},Y1=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.standard].includes(e),o=[Se.py.communities,Se.py.communitiesonboarding,Se.py.communitiesevents,Se.py.communitiescreateevent,Se.py.communitiesmembers,Se.py.communitiesjoinrequest,Se.py.communitiesjoininviteview,Se.py.communitiesblockmembers,Se.py.communitiessettings,Se.py.communitiescopilot,Se.py.communitiesgallery,Se.py.communitiesexplore].includes(i),r=[Se.uk.default,Se.uk.view,Se.uk.join,Se.uk.manage,Se.uk.update,Se.uk.info],s=n&&r.includes(n);return!!(a&&o&&s)},X1=()=>!0,Z1=({entity:e})=>{switch(e.type){case Se.py.communitiesonboarding:case Se.py.communitiescreateevent:return null;default:return e}},e3=({entity:e,coreSettings:t})=>{if(e.type===Se.py.communitiesonboarding)return null;const n=t?.get(b.J.Calendar).enableCalendarSchedulingFormMultiSlot;return e.type!==Se.py.communitiescreateevent||n?e:null},t3=()=>null,n3=({entity:e})=>e,i3=({entity:e,contextEntity:t})=>{if(t?.type===Se.py.communitiescopilot){return{id:t.id||e.id||"",action:Se.uk.info,type:Se.py.communitiescopilot}}return null},a3=({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e,isWideSubNav:!!t?.get(b.J.MercuryDesign).enableMercuryDesign}},mainEntity:{[Mt.S.Main]:{isColorSchemeDefaultBackground2:!0,isSlotBackgroundSemiTransparent2:!!t?.get(b.J.MercuryDesign).enableMercuryDesign}},headerEntity:{[Mt.S.HorizontalBar]:{slotHeightOverrides:t?.get(b.J.Communities).enableCommunitiesCoverImage?"auto":void 0,isHeaderSlotExpandedOnMount:!!t?.get(b.J.Communities).enableCommunitiesCoverImage}}});var o3,r3=n(919154),s3=n(449492),l3=n(206661),c3=n(225990);!function(e){e.invitecommunity="/l/community/invite",e.message="/l/message",e.community="/l/community",e.createeventcommunity="/l/community/create-event",e.eventscommunity="/l/community/events",e.createpostcommunity="/l/community/create-post",e.createcommunity="/l/community/create",e.editcommunity="/l/community/edit",e.addmembercommunity="/l/community/add-member"}(o3||(o3={}));const d3=Object.values(o3),u3=d3.reduce(((e,t)=>({...e,[t]:sa.DL.Community})),{}),m3=new Set(d3),p3=e=>{const t=(0,c3.qK)(),n=t?{channelId:t}:null;return Promise.resolve({entityCommand:{entity:{type:Se.py.communities,action:Se.uk.update,...n?{id:JSON.stringify(n)}:{}},command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush},entityOptions:{inviteLinkUrl:e.toString()}},metadata:{allowAnonymous:!1}})},g3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesCommunityWithoutPostQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newestCommunityWithoutPosts"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},h3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesLastCreatedCommunityQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lastCreatedCommunity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var y3,v3;!function(e){e.NoChannelId="Parsed communities deep link does not contain the channel id",e.NoJoinCode="Parsed communities join link does not contain the join code",e.MinorAccount="Communities use is forbidden for the minor"}(y3||(y3={})),function(e){e.NoChannelId="channel_on_before_deep_link_parsed_no_channel_id_error",e.NoJoinCode="communities_join_no_join_code_failure",e.MinorAccount="channel_on_before_deep_link_parsed_feature_not_enabled_error"}(v3||(v3={}));const f3=(e,t,n,i)=>Promise.resolve({entityCommand:{entity:{type:Se.py.communities,action:Se.uk.view,id:JSON.stringify({channelId:e,replyChainId:t})},command:{stateTransition:ke.su.forceFlush,visibilityState:ke.fe.show},entityOptions:{deepLinkId:n,...i?{owningTeamId:i}:{},isPostLink:!0}},metadata:{allowAnonymous:!1}}),S3={filter:o3.message,execute:({deeplinkUrl:e,context:{loggerFactory:t,coreSettings:n}})=>{const i=t.newLogger("CommunitiesApp onBeforeDeeplinkParsed","apps-communities"),{pathname:a,search:o}=e;i.log(`Parsing deeplinkUrl - pathname: ${a}, search: ${o}`);const r=a.split("/"),s=r.findIndex((e=>e.startsWith("19:"))),l=new URLSearchParams(o),c=r[s],d=r[s+1],u=l.get("parentMessageId")||void 0,m=l.get("owningTeamId");if((0,l3.su)(n))throw i.errorToTelemetry?.(y3.MinorAccount,v3.MinorAccount),Error(y3.MinorAccount);if(c)return i.log(`toNavigationIntent - channelId: ${c}, messageId: ${d}`),f3(c,u,d,m);throw i.errorToTelemetry?.(y3.NoChannelId,v3.NoChannelId),Error(y3.NoChannelId)}},k3=({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[3];if((0,l3.su)(t.coreSettings))throw n.errorToTelemetry?.(y3.MinorAccount,v3.MinorAccount),Error(y3.MinorAccount);return a?((e,t,n)=>{const{pathname:i}=n,{enableCommunitiesLinkJoin:a}=e.get(b.J.Communities);if(!a){const e="Invite link redemption is disabled for this experience";return t.error(e),Promise.reject(e)}for(const e of Array.from(m3)){const t=u3[e];if(i.startsWith(e)&&t)return p3(n)}const o="No DeeplinkPrefixType found for the specified deeplinkUrl";return t.error(o),Promise.reject(o)})(t.coreSettings,n,e):(n.errorToTelemetry?.(y3.NoJoinCode,v3.NoJoinCode),Promise.resolve({entityCommand:{entity:{type:Se.py.communities,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush}},metadata:{allowAnonymous:!1}}))},C3=({deeplinkUrl:e,context:t})=>k3({deeplinkUrl:e,context:t}),b3={filter:o3.community,execute:C3},w3={filter:o3.invitecommunity,execute:C3},T3={filter:o3.createcommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{enableCommunitiesCreationDeeplink:i}=t.coreSettings.get(b.J.Communities);return i?Promise.resolve({entityCommand:{entity:{id:"",type:Se.py.communitiescreatedialog,action:Se.uk.view},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}}):(n.debug(`Flag enableCommunitiesCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},I3={filter:o3.createeventcommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[4];if(!a)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const{enableCommunitiesEventCreationDeeplink:o}=t.coreSettings.get(b.J.Communities);return o?Promise.resolve({entityCommand:{entity:{id:JSON.stringify({channelId:a}),type:Se.py.communitiescreateevent,action:Se.uk.view},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show},entityOptions:{isGroup:!0,conversationId:a}},metadata:{allowAnonymous:!0}}):(n.debug(`Flag enableCommunitiesEventCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},N3={filter:o3.eventscommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[4];if(!a)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const{enableCommunitiesEventsDeeplink:o}=t.coreSettings.get(b.J.Communities);return o?Promise.resolve({entityCommand:{entity:{id:a,type:Se.py.communitiesevents,action:Se.uk.view},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!0}}):(n.debug(`Flag enableCommunitiesEventCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},E3={filter:o3.createpostcommunity,execute:({deeplinkUrl:e,context:t})=>(async({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{enableCommunitiesPostCreationDeeplink:i}=t.coreSettings.get(b.J.Communities);if(!i)return n.debug(`Flag enableCommunitiesPostCreationDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const a=(await t.getUserContexts())[0].context.client,o=await(async()=>{try{const{data:e}=await a.query({query:g3,fetchPolicy:"no-cache"});return e?.newestCommunityWithoutPosts}catch(e){const t=`Error while fetching last created community id. Failed with code: ${e.errorCode}. The reason is: ${e.reason}`;return void n.errorToTelemetry?.(t,"life_web_and_desktop_growth_synthetic_notification_campaign_error")}})();if(!o||!o.id)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const r=o.id;return Promise.resolve({entityCommand:{entity:{id:r,type:Se.py.communities,action:Se.uk.view},command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}})})({deeplinkUrl:e,context:t})},A3={filter:o3.editcommunity,execute:({deeplinkUrl:e,context:t})=>(({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{pathname:i}=e,a=i.split("/")[4];if(!a)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const{enableCommunitiesEditDeeplink:o}=t.coreSettings.get(b.J.Communities);return o?Promise.resolve({entityCommand:{entity:{id:a,type:Se.py.communitieseditdialog,action:Se.uk.view},command:{correlation:{source:C.D.CommunitiesEditDialog},stateTransition:ke.su.extend,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!0}}):(n.debug(`Flag enableCommunitiesEditDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0))})({deeplinkUrl:e,context:t})},_3={filter:o3.addmembercommunity,execute:({deeplinkUrl:e,context:t})=>(async({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("CommunitiesApp","apps-communities"),{enableCommunitiesAddMemberDeeplink:i}=t.coreSettings.get(b.J.Communities);if(!i)return n.debug(`Flag enableCommunitiesAddMemberDeeplink is not enabled. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const a=(await t.getUserContexts())[0].context.client,o=await(async()=>{try{const{data:e}=await a.query({query:h3,fetchPolicy:"no-cache"});return e?.lastCreatedCommunity}catch(e){const t=`Error while fetching last created community id. Failed with code: ${e.errorCode}. The reason is: ${e.reason}`;return void n.errorToTelemetry?.(t,"life_web_and_desktop_growth_synthetic_notification_campaign_error")}})();if(!o||!o.id)return n.debug(`CommunityId is not defined. Skipping deeplink processing. Deeplink: ${e}`),Promise.resolve(void 0);const r=o.id;return Promise.resolve({entityCommand:{entity:{id:r,type:Se.py.campaignnotifications,action:Se.uk.view},command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show},entityOptions:{campaignId:"communityInviteCampaign"}},metadata:{allowAnonymous:!1}})})({deeplinkUrl:e,context:t})},F3=[I3,E3,T3,N3,A3,_3,S3,b3,w3],D3={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==Se.py.communitiesonboarding,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:e=>{const{replyChainId:t}=(0,Q1.jd)(e?.id||"");return e?.type===Se.py.communities&&e?.action===Se.uk.view&&!t}},P3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsCommunitiesToastEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"communitiesToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"count"}},{kind:"Field",name:{kind:"Name",value:"teamId"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"channelName"}},{kind:"Field",name:{kind:"Name",value:"reaction"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderMri"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"replyChainId"}},{kind:"Field",name:{kind:"Name",value:"userNickname"}}]}}]}}]};var M3,x3,R3;!function(e){e.Follow="Follow",e.Reply="Reply",e.PersonalReply="PersonalReply",e.ReplyToReply="ReplyToReply",e.MentionInCommunity="MentionInCommunity",e.MentionInSubCommunity="MentionInSubCommunity",e.CommunityMention="CommunityMention",e.ReactionInCommunity="ReactionInCommunity",e.ReactionInSubCommunity="ReactionInSubCommunity",e.CommunityReply="CommunityReply",e.CommunityReplyToReply="CommunityReplyToReply",e.CommunityMembership="CommunityMembership",e.Calendar="Calendar"}(M3||(M3={})),function(e){e.Person="Person",e.Team="Team",e.Community="Community",e.CommunityMembershipJoinRequestCreated="CommunityMembershipJoinRequestCreated",e.CommunityMembershipJoinRequestAccepted="CommunityMembershipJoinRequestAccepted",e.CommunityMembershipPromotedToAdmin="CommunityMembershipPromotedToAdmin",e.NewCalendarEvent="NewCalendarEvent",e.CalendarEventCanceled="CalendarEventCanceled",e.CalendarEventUpdated="CalendarEventUpdated"}(x3||(x3={})),function(e){e.L1="L1",e.L2="L2",e.MemberRequests="MemberRequests",e.MembersView="MembersView"}(R3||(R3={}));const j3="toastNotifications",L3={communitiesPost:"new_community_post_toast_header",reply:"community_reply_toast_header",personalreply:"community_personal_reply_toast_header",mentionInCommunityPerson:"community_mention_person_toast_header",communityMentionEveryone:"community_mention_everyone_toast_header",singleMemberReactionInCommunity:"community_single_member_reaction_header",multipleMembersRactionInCommunity:"community_multiple_members_reaction_header",communityMembershipJoinRequestCreated:"community_join_request_created_toast_header",communityMembershipRequestToJoinAccepted:"community_request_to_join_accepted_header",communityMembershipPromotedToAdmin:"community_membership_promoted_to_admin_header",newCalendarEvent:"new_community_calendar_event_toast_header",calendarEventCancelled:"community_calendar_event_canceled_toast_header",calendarEventUpdated:"community_calendar_event_updated_toast_header"},O3={communityMembershipJoinRequestCreated:"community_join_request_created_toast_text",communityMembershipPromotedToAdmin:"community_membership_promoted_to_admin_toast_text"},$3="communities_toast_event_subscription_job";var U3=n(819827);const B3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesMsaUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},W3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]};async function H3(e,t,n,i){try{const a=await async function(e,t,n){const{data:i}=await e.query({query:B3,variables:{userId:t,displayName:n,profilePictureSize:U3.$D.Small}});return i.msaUserProfilePicture}(e,n,i);if(!a)return void t.errorToTelemetry?.(li.f.ImageUrlGenerationFailed,$3,void 0,!0);const o=await e.query({query:W3,variables:{url:a}});return o?.data.toastImageAsDataUri||void 0}catch(e){return void t.errorToTelemetry?.(li.f.ImageFetchFailed,$3,void 0,!0)}}const V3={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"categoryId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"searchEmoticons"},arguments:[{kind:"Argument",name:{kind:"Name",value:"searchFilter"},value:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}}},{kind:"Argument",name:{kind:"Name",value:"exactMatch"},value:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}}},{kind:"Argument",name:{kind:"Name",value:"includeShortCuts"},value:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}}},{kind:"Argument",name:{kind:"Name",value:"includeKeywords"},value:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}}},{kind:"Argument",name:{kind:"Name",value:"maxResultCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}}},{kind:"Argument",name:{kind:"Name",value:"categoryId"},value:{kind:"Variable",name:{kind:"Name",value:"categoryId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Emoticon"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"unicode"}},{kind:"Field",name:{kind:"Name",value:"animation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment_animation"}}]}},{kind:"Field",name:{kind:"Name",value:"etag"}},{kind:"Field",name:{kind:"Name",value:"diverse"}},{kind:"Field",name:{kind:"Name",value:"shortcuts"}},{kind:"Field",name:{kind:"Name",value:"searchMatch"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsCommunitiesToastEmoticonFragment_animation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmoticonAnimation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fps"}},{kind:"Field",name:{kind:"Name",value:"framesCount"}},{kind:"Field",name:{kind:"Name",value:"firstFrame"}}]}}]}.definitions]}.definitions]};function G3(e,t,n){const{enableCommunitiesNicknamesToast:i}=e.get(b.J.Communities);return i&&t!==x3.CommunityMembershipJoinRequestCreated&&n?n:""}const z3="";async function q3({teamName:e,type:t,senderDisplayName:n,senderGivenName:i,subtype:a,count:o,userNickname:r},s,l,c,d){const u=n||i;if(!u)return z3;const m={senderDisplayName:G3(d,a,r)||u,teamName:e};switch(t){case M3.Follow:return J3(L3.communitiesPost,m,s);case M3.Reply:case M3.PersonalReply:case M3.ReplyToReply:return J3(L3.reply,m,s);case M3.CommunityReply:return J3(L3.personalreply,m,s);case M3.CommunityReplyToReply:return J3(L3.reply,m,s);case M3.MentionInCommunity:case M3.MentionInSubCommunity:return a===x3.Person?J3(L3.mentionInCommunityPerson,m,s):z3;case M3.CommunityMention:return a===x3.Community?J3(L3.communityMentionEveryone,m,s):z3;case M3.ReactionInCommunity:case M3.ReactionInSubCommunity:const e=await async function(e,t,n){try{const{id:t}=(0,gZ.Mc)(n?.toLocaleLowerCase().trim());if(!t)return;const{data:i}=await e.query({query:V3,variables:{searchFilter:t,exactMatch:!0}});return(i?.searchEmoticons||[])[0]}catch(e){return void t.errorToTelemetry?.(`communities toast emoticon query failed for ${n}`,"communities_toast_emoticon_query_failed")}}(l,c,a),t=e?.unicode||void 0;return o&&o>0?J3(L3.multipleMembersRactionInCommunity,{...m,emoji:t,count:o},s):J3(L3.singleMemberReactionInCommunity,{...m,emoji:t},s);case M3.CommunityMembership:switch(a){case x3.CommunityMembershipJoinRequestCreated:return J3(L3.communityMembershipJoinRequestCreated,m,s);case x3.CommunityMembershipJoinRequestAccepted:return J3(L3.communityMembershipRequestToJoinAccepted,m,s);case x3.CommunityMembershipPromotedToAdmin:return J3(L3.communityMembershipPromotedToAdmin,m,s)}return z3;case M3.Calendar:switch(a){case x3.NewCalendarEvent:return J3(L3.newCalendarEvent,m,s);case x3.CalendarEventCanceled:return J3(L3.calendarEventCancelled,m,s);case x3.CalendarEventUpdated:return J3(L3.calendarEventUpdated,m,s);default:return z3}default:return z3}}function J3(e,{emoji:t,teamName:n,senderDisplayName:i,count:a},o){return o.stringTranslate(j3,e,{emoji:t,senderDisplayName:i,teamName:n,count:a})}const Q3="";function K3(e,{teamName:t,senderDisplayName:n},i){return i.stringTranslate(j3,e,{senderDisplayName:n,teamName:t})}async function Y3(e,t,n,i,a){const{conversationId:o,messageId:r,startTimestamp:s,teamName:l,senderMri:c,senderDisplayName:d,type:u,subtype:m,replyChainId:p,text:g}=e,h=await H3(n,i,c,d||""),y=function(e,t){switch(e){case M3.Reply:case M3.PersonalReply:case M3.ReplyToReply:case M3.CommunityReply:case M3.CommunityReplyToReply:case M3.MentionInCommunity:case M3.MentionInSubCommunity:case M3.CommunityMention:case M3.ReactionInCommunity:case M3.ReactionInSubCommunity:return R3.L2;case M3.Follow:case M3.CommunityMembership:if(t)switch(t){case x3.CommunityMembershipJoinRequestCreated:return R3.MemberRequests;case x3.CommunityMembershipJoinRequestAccepted:return R3.L1;case x3.CommunityMembershipPromotedToAdmin:return R3.MembersView}return R3.L1;default:return R3.L1}}(u,m),v=p&&y===R3.L2?p:void 0,f=await q3(e,t,n,i,a),S=await async function({teamName:e,type:t,senderDisplayName:n,senderGivenName:i,subtype:a,channelName:o,userNickname:r},s,l){const{enableSubCommunitiesToastNotifications:c}=l.get(b.J.Notifications);if(o&&c)return s.stringTranslate(j3,"shared_channel_toast_text",{teamName:e,channelName:o});const d=G3(l,a,r)||n||i;if(!d)return Q3;const u={senderDisplayName:d,teamName:e};if(t===M3.CommunityMembership){switch(a){case x3.CommunityMembershipJoinRequestCreated:return K3(O3.communityMembershipJoinRequestCreated,u,s);case x3.CommunityMembershipPromotedToAdmin:return K3(O3.communityMembershipPromotedToAdmin,u,s)}return Q3}return Q3}(e,t,a);return{conversationId:o,quickReply:!1,messageId:(k=u,C=m,k===M3.CommunityMembership&&C&&C===x3.CommunityMembershipJoinRequestAccepted?void 0:r),time:new Date(+s),replyChainId:v,text:(S||l||g)??void 0,title:f,mainImage:h?{alt:"",src:h}:void 0,type:u};var k,C}function X3(e,t,n,i,a,o,r,s,l){const{enableCommandToHostCommService:c}=t.get(b.J.Core,["enableCommandToHostCommService"]),{enableBrowserToasts:d,enableInAppNotifications:u,enableInAppNotificationsForChatsAndChannels:m}=t.get(b.J.Notifications,["enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"communities-toast-event-subscription",runOncePerId:!0,job:async()=>{const p=i.newLogger("CommunitiesToastEventSubscription","apps-communities");c||d||u&&m?n.subscribe({query:P3,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a,o,r,s,l){const{enableToastCollections:c}=t.get(b.J.Notifications);return async d=>{if(d.errors)return void n.errorToTelemetry?.(`${li.f.SubscriptionFailed}`,$3,void 0,!0);const u=d?.data?.communitiesToastEvent;if(!u)return void n.errorToTelemetry?.(li.f.EmptyEvent,$3,void 0,!0);const m=i.newScenario(H.RG.CrossClientToastView,{startTime:+u.startTimestamp});m.clientId=u.correlationId,m.appendEventData({mainEntityType:Se.py.communities}),m.mark("get_communities_toast_display_data_started");const p={channelId:u.conversationId,replyChainId:u.replyChainId},g=await l({id:JSON.stringify(p),type:Se.py.communities,action:Se.uk.view},r);if(m.mark(H.ck.CrossClientConversationFocusChecked),g)return n.debugToTelemetry?.(li.f.ToastSuppressedForWindowInFocus,$3,void 0,!0),void m.stop({reason:li.f.ToastSuppressedForWindowInFocus});const h=await Y3(u,a,r,n,t);if(m.mark("get_communities_toast_display_data_completed"),!h?.title)return m.mark("unhandled_type_in_communities_toast"),n.errorToTelemetry?.(`${li.f.UnhandledType} ${u.type}`,$3,void 0,!0),void m.stop({reason:li.f.UnhandledType});switch(c&&(h.collectionId=HJ(e,s,n)),i.hoistScenarioToCore?.(m),u.type){case M3.Calendar:return o.toasts.showCommunitiesCalendarEventsNotifications(u.correlationId,h);case M3.CommunityMembership:switch(u.subtype){case x3.CommunityMembershipJoinRequestCreated:return o.toasts.showCommunitiesMemberRequestsNotifications(u.correlationId,h);case x3.CommunityMembershipPromotedToAdmin:return o.toasts.showCommunitiesMembersViewNotifications(u.correlationId,h)}}return o.toasts.showCommunitiesNotifications(u.correlationId,h)}}(e,t,p,a,o,r,n,s,l)):p.debugToTelemetry?.(li.f.NotEnabled,$3,void 0,!0)}}}const Z3=({context:{authenticationUser:e,client:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,i18n:o,entityCommanding:r,userTrackingService:s,isEntityInView:l}})=>[X3(e,n,t,i,a,o,r,s,l)],e4=({action:e,appRenderMode:t,coreSettings:n,type:i})=>{const a=new MV.H,{enableComposeCriticalPhaseLoadCommunities:o=!1,communitiesAppPhaseTimeouts:r}=n.get(b.J.Communities),s=[],l=[];switch(t){case Mt.S.HorizontalBar:t4({type:i,criticalSignals:s,featureFlags:{},postCriticalSignals:l});break;case Mt.S.Main:n4({type:i,criticalSignals:s,featureFlags:{enableComposeCriticalPhaseLoadCommunities:o},postCriticalSignals:l});break;case Mt.S.Rail:i4({action:e,criticalSignals:s,postCriticalSignals:l,type:i,featureFlags:{}})}return a.registerAppPhase({phase:yt.nh.CRITICAL,signals:s,timeout:r?.critical||25e3}),a.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:l,timeout:r?.postCritical||1e4}),a.appPhases},t4=({criticalSignals:e,type:t})=>{switch(t){case Se.py.communities:case Se.py.communitiesjoinrequest:case Se.py.communitiesmembers:e.push(xV.G.COMMUNITIES_HEADER_RENDERED)}},n4=({criticalSignals:e,featureFlags:{enableComposeCriticalPhaseLoadCommunities:t},postCriticalSignals:n,type:i})=>{switch(i){case Se.py.communities:e.push(xV.G.MESSAGES_RENDERED),t?e.push(xV.G.COMPOSE_LOADED):n.push(xV.G.COMPOSE_LOADED),n.push(xV.G.MESSAGE_REACTIONS_RENDERED,xV.G.PRESENCES_RENDERED,xV.G.VIRTUAL_LIST_RENDER_BUFFER_FILLED);break;case Se.py.communitiesjoininviteview:e.push(xV.G.COMMUNITIES_JOIN_INVITE_VIEW_RENDERED);break;case Se.py.communitiesjoinrequest:case Se.py.communitiesmembers:e.push(xV.G.COMMUNITIES_MANAGE_VIEW_RENDERED)}},i4=({action:e,criticalSignals:t,type:n})=>{n!==Se.py.communities||e!==Se.uk.view&&e!==Se.uk.default||t.push(xV.G.CHANNEL_LIST_ITEMS_RENDERED)},a4=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(540003),n.e(812934),n.e(564211),n.e(714650),n.e(392718),n.e(663276),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(869026),n.e(649162),n.e(553940),n.e(635026),n.e(30577),n.e(136462),n.e(732691),n.e(551124),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(240446),n.e(593837),n.e(526824),n.e(875436),n.e(374968),n.e(302494),n.e(251843),n.e(625001),n.e(547642),n.e(384648),n.e(513251),n.e(710814),n.e(289814),n.e(557370),n.e(305180),n.e(908285),n.e(922277),n.e(683079),n.e(848625),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(890962),n.e(707238),n.e(666369),n.e(57605),n.e(209252),n.e(765976),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(799855),n.e(65722),n.e(376960),n.e(269518),n.e(146244),n.e(404742),n.e(638108),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(342293),n.e(182115),n.e(776577),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(986305),n.e(270954),n.e(52047),n.e(554897),n.e(467533),n.e(109515),n.e(666181),n.e(189684),n.e(482266),n.e(38878),n.e(282487),n.e(262610),n.e(728137),n.e(784669),n.e(424584),n.e(548435),n.e(106311),n.e(532951),n.e(863213),n.e(164471),n.e(184787),n.e(771686),n.e(509014),n.e(740085)]).then(n.bind(n,458985)),o4=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(540003),n.e(812934),n.e(564211),n.e(714650),n.e(392718),n.e(663276),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(869026),n.e(649162),n.e(553940),n.e(635026),n.e(30577),n.e(136462),n.e(732691),n.e(551124),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(240446),n.e(593837),n.e(526824),n.e(875436),n.e(374968),n.e(302494),n.e(251843),n.e(625001),n.e(547642),n.e(384648),n.e(513251),n.e(710814),n.e(289814),n.e(557370),n.e(305180),n.e(908285),n.e(922277),n.e(683079),n.e(848625),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(890962),n.e(707238),n.e(666369),n.e(57605),n.e(209252),n.e(765976),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(799855),n.e(65722),n.e(376960),n.e(269518),n.e(146244),n.e(404742),n.e(638108),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(342293),n.e(182115),n.e(776577),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(986305),n.e(270954),n.e(52047),n.e(554897),n.e(467533),n.e(109515),n.e(666181),n.e(189684),n.e(482266),n.e(38878),n.e(282487),n.e(262610),n.e(728137),n.e(784669),n.e(424584),n.e(548435),n.e(106311),n.e(532951),n.e(863213),n.e(164471),n.e(184787),n.e(771686),n.e(509014),n.e(740085)]).then(n.bind(n,450812)),r4=({coreServices:e,host:t,screenState:n,windowOptions:i})=>{const{height:a,minHeight:o,minWidth:r,offset:s,width:l}=G1.windowFeatures||{},c=t?.screenX||0,d=t?.screenY||0,u=(n?.numOpenWindows||1)*(s||1);return{additionalFeatures:{minHeight:`${o}`,minWidth:`${r}`},height:a,left:c+u,minHeight:o,minWidth:r,top:d+u,width:l,...G1.windowFeatures,...e?.coreSettings.get(b.J.Core).enableRatioToScreenBasedSizing&&s4(t,G1.windowFeatures),...i}};function s4(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}const l4=(e,t)=>{const{entity:n,command:i}=e,a=i?.correlation?.source,o=i.stateTransition===ke.su.flush||i.stateTransition===ke.su.forceFlush||i.stateTransition===ke.su.new;if(n.type===Se.py.communitiesonboarding&&n.action===Se.uk.default)return H.RG.CommunitiesAppInitiate;if(n.type===Se.py.communities&&n.action===Se.uk.default)return H.RG.CommunitiesAppLoad;if(n.type===Se.py.communities&&n.action===Se.uk.view&&i.visibilityState===ke.fe.show&&o&&n.id){const{channelId:e,replyChainId:o}=(0,Q1.jd)(n.id,t);if(e){const e=[C.D.ChannelListItem,C.D.CommunitiesList,C.D.ChannelPostMessage,C.D.ChannelRepliesPane];if(i.stateTransition===ke.su.new)return o?H.RG.CommunitiesSwitchL2Popout:void 0;if(o)return H.RG.CommunitiesSwitchL2;if(e.includes(a))return H.RG.CommunitiesSwitchL1}}};const c4="com.microsoft.teams.homepage",d4={id:c4,name:"HomepageApp",actors:[vW],supportedEntities:[Se.py.homepage],supportedRenderModes:[Mt.S.Main],getDefaultCommand:e=>{const{enableTflHomepage:t}=e.get(b.J.Homepage),{coreColdBootAppId:n}=e.get(b.J.Core);if(t&&(n&&n===c4))return{type:Se.py.homepage,action:Se.uk.default}}},u4=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("HomepageApp onCommandReceived","apps-homepage");if(e.command.actor===vW)return n===fW?{entity:{type:Se.py.homepage,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}}:void i.log(`Command action '${n}' is not supported at HomepageApp.`);i.log(`Command for actor '${e.command.actor}' cannot be handled by HomepageApp.`)},m4=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(84274),n.e(393890),n.e(75298),n.e(152739),n.e(361845),n.e(253400),n.e(314991),n.e(128770),n.e(649800),n.e(714650),n.e(832961),n.e(649162),n.e(44025),n.e(732691),n.e(81),n.e(438152),n.e(448808),n.e(290718),n.e(875351),n.e(565168),n.e(826792),n.e(6605),n.e(630169),n.e(420266),n.e(91),n.e(896817),n.e(928362),n.e(652421),n.e(213629),n.e(796594),n.e(68021),n.e(600213),n.e(84215),n.e(57605),n.e(222020),n.e(540873),n.e(375387),n.e(947338),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(360134),n.e(357903),n.e(949636),n.e(281467),n.e(678342),n.e(412523),n.e(209674),n.e(126541),n.e(638108),n.e(270954),n.e(347076),n.e(931506),n.e(1626),n.e(923207),n.e(519889),n.e(183587),n.e(893197),n.e(592714),n.e(544706),n.e(119126),n.e(721778)]).then(n.bind(n,455115)),p4=()=>null,g4=e=>{const{entity:t,command:n}=e;return(n.stateTransition===ke.su.flush||n.stateTransition===ke.su.forceFlush||n.stateTransition===ke.su.new)&&t.type===Se.py.homepage&&t.action===Se.uk.default?H.RG.HomepageAppLoad:void 0};const h4=e=>e.type===Se.py.homepage?"7133fca9-0853-4e7a-bb5d-32d4e5f6020a":void 0;var y4=n(114676);const v4={id:"com.microsoft.teams.contacts-sync",name:"ContactsSyncApp",supportedEntities:[Se.py.contactssync],supportedRenderModes:[Mt.S.Main,Mt.S.Modal],windowFeatures:{additionalFeatures:{minHeight:"490",minWidth:"530"},minWidth:530,width:775,minHeight:490,height:585}},f4=()=>Promise.all([n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(346992),n.e(586535),n.e(459868),n.e(314991),n.e(123977),n.e(255279),n.e(875351),n.e(826792),n.e(674374),n.e(328056),n.e(685827),n.e(609660),n.e(357903),n.e(347076),n.e(518723),n.e(988406)]).then(n.bind(n,881052)),S4=()=>Promise.all([n.e(75298),n.e(459868),n.e(440413),n.e(420266),n.e(741884),n.e(631205),n.e(440548)]).then(n.bind(n,930650)),k4=()=>Promise.all([n.e(22386),n.e(186160)]).then(n.bind(n,351547)),C4=()=>v4.windowFeatures||{};function b4(){const e=()=>null;return{getAppWindowFeatures:C4,manifest:v4,render:async({appRenderMode:t,entity:n,onRenderEvent:i,scenarioFactory:a})=>{if("contactssync"===n.type)switch(n.id){case void 0:case null:case y4.M.Default:if(t===Mt.S.Main||t===Mt.S.Modal){const e="contacts-sync-dialog";i("ChunkLoadStarted",{chunkName:e});const[{ContactsSyncDialog:n}]=await Promise.all([(0,ac.mT)(f4,e,a)]);return i("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(n,{isModal:t===Mt.S.Modal})}break;case y4.M.MobileSync:if(t===Mt.S.Modal||t===Mt.S.Main){const e="contacts-sync-mobile-sync-dialog";i("ChunkLoadStarted",{chunkName:e});const[{ContactsSyncMobileSyncDialog:n}]=await Promise.all([(0,ac.mT)(S4,e,a)]);return i("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(n,{isModal:t===Mt.S.Modal})}break;case y4.M.MobileUnsync:if(t===Mt.S.Modal){const e="contacts-sync-mobile-unsync-dialog";i("ChunkLoadStarted",{chunkName:e});const[{ContactsSyncMobileUnsyncDialog:t}]=await Promise.all([(0,ac.mT)(k4,e,a)]);return i("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(t,{})}}return(0,gO.t)(e,{})}}}const w4={id:"com.microsoft.teams.discover-surface",name:"DiscoverSurfaceApp",supportedEntities:[Se.py.discoversurface,Se.py.discoversurfacesettings],supportedRenderModes:[Mt.S.Main,Mt.S.Rail,Mt.S.HorizontalBar,Mt.S.Modal],getDefaultCommand:()=>({type:Se.py.discoversurface,action:Se.uk.default})},T4=e=>{if(I4(e))return N4(e)?{subNavEntity:E4(e),headerEntity:A4(e),startEntity:_4(e),mainEntity:F4(e),endEntity:D4(e)}:null},I4=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.standard].includes(e),o=[Se.uk.view,Se.uk.default],r=n&&o.includes(n),s=[Se.py.discoversurface].includes(i);return!!(a&&s&&r)},N4=()=>!0,E4=({coreSettings:e})=>{const{enableHybridChannelList:t}=e?.get(b.J.Host)||{};return t?{action:Se.uk.list,entityState:{flushableByLinkedEntity:!0},id:null,linkedEntity:null,options:null,type:Se.py.channels,windowOptions:null}:null},A4=({entity:e})=>e,_4=()=>null,F4=({entity:e})=>e,D4=()=>null,P4=()=>({}),M4=({appRenderMode:e,coreSettings:t})=>{const n=new MV.H,{criticalPhaseTimeout:i,postCriticalPhaseTimeout:a}=t.get(b.J.DiscoverSurface),o=[];switch(e){case Mt.S.HorizontalBar:o.push(xV.G.DISCOVER_SURFACE_HEADER_RENDERED);break;case Mt.S.Main:o.push(xV.G.DISCOVER_SURFACE_VIEW_RENDERED)}return n.registerAppPhase({phase:yt.nh.CRITICAL,signals:o,timeout:i||25e3}),n.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:[],timeout:a||1e4}),n.appPhases};var x4=n(114310);const R4=e=>H.RG.DiscoverSurfaceSwitchV2,j4=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(812934),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(649162),n.e(553940),n.e(136462),n.e(732691),n.e(551124),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(526824),n.e(875436),n.e(374968),n.e(547642),n.e(513251),n.e(710814),n.e(557370),n.e(213520),n.e(725573),n.e(754996),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(707238),n.e(666369),n.e(790004),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(450367),n.e(230050),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(198863),n.e(342293),n.e(182115),n.e(776577),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(52047),n.e(784669),n.e(548435),n.e(106311),n.e(184787),n.e(996583)]).then(n.bind(n,626378)),L4=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(812934),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(649162),n.e(553940),n.e(136462),n.e(732691),n.e(551124),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(526824),n.e(875436),n.e(374968),n.e(547642),n.e(513251),n.e(710814),n.e(557370),n.e(213520),n.e(725573),n.e(754996),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(707238),n.e(666369),n.e(790004),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(450367),n.e(230050),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(198863),n.e(342293),n.e(182115),n.e(776577),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(52047),n.e(784669),n.e(548435),n.e(106311),n.e(184787),n.e(996583)]).then(n.bind(n,450812)),O4="discover-surface-app";function $4(){const e=()=>null;return{manifest:w4,render:async({appRenderMode:t,entity:n,scenarioFactory:i,onRenderEvent:a})=>{if(a("ChunkLoadStarted",{chunkName:O4}),t===Mt.S.Modal&&n.type===Se.py.discoversurfacesettings){const{DiscoverSurfaceUserPreferencesDialogLazyRenderer:e}=await(0,ac.mT)(j4,O4,i);return(0,gO.t)(e,{})}const[{DiscoverFeed:o,DiscoverSurfaceHeader:r},{LPC:s}]=await Promise.all([(0,ac.mT)(j4,O4,i),(0,ac.mT)(L4,O4,i)]);return a("ChunkLoadSucceeded",{chunkName:O4}),t===Mt.S.Main||t===Mt.S.HorizontalBar?(0,gO.t)(ez.f,{namespaces:["channels","teamsAndChannels","funstuff","discoverSurface"],loaderRenderer:null,children:[t===Mt.S.Main&&(0,gO.t)(s,{children:(0,gO.t)(rJ.p3,{children:(0,gO.t)(x4.l8,{children:(0,gO.t)(o,{})})})}),t===Mt.S.HorizontalBar&&(0,gO.t)(r,{})]}):(0,gO.t)(e,{})},getAppPhases:M4,getAppViewEntities:T4,getAppViewEntitiesProps:P4,getCommandScenarioName:R4}}var U4=n(649641);const B4=e=>{if(W4(e))return{subNavEntity:H4(e),headerEntity:V4(e),startEntity:G4(e),mainEntity:z4(e),endEntity:q4(e)}},W4=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=i===Se.py.error,r=n===Se.uk.view;return!!(a&&o&&r)},H4=()=>null,V4=()=>null,G4=()=>null,z4=({entity:e})=>e,q4=()=>null,J4=()=>({mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,isBackgroundTransparent:!0}}});var Q4=n(396957);const K4={id:"com.microsoft.teams.error",name:"ErrorApp",supportedEntities:[Se.py.error],supportedRenderModes:[Mt.S.Main]};var Y4=n(237867);const{useMemo:X4}=hO;const Z4=async(e,t)=>{if(e!==Mt.S.Main)return(0,gO.t)(OK.e,{});const{ErrorActionContextProvider:i,ErrorPage:a}=await Promise.all([n.e(377348),n.e(112403),n.e(463781),n.e(681896),n.e(909020),n.e(591878),n.e(607784),n.e(773923),n.e(505990),n.e(120894),n.e(51724),n.e(591395),n.e(635026),n.e(130631),n.e(228737),n.e(578578),n.e(641062),n.e(379371),n.e(890962),n.e(585815),n.e(243012),n.e(474133),n.e(224284),n.e(802054)]).then(n.bind(n,293292));return(0,gO.t)((()=>{const{getEntityOptions:e}=(0,GK.sV)(),{serializedError:n}=e(Se.py.error,Se.uk.view),o=(0,Y4.x)(),{coreSettings:r,host:s,loggerFactory:l}=(0,dY.SE)(),c=l.newLogger("ErrorAppViewsRenderer","apps-error"),{isOnline:d}=(0,dY.cJ)(),u=n&&function(e){let t;try{t=JSON.parse(e)}catch(t){return new Q4.K(t,{source:"error-app",serializedError:e})}const n=t2(t);return null!=n?n:new Q4.K(new Error(e),{source:"error-app",serializedError:e})}(n),m=d?u||new Me.G(Me.$.UNKNOWN):new Me.G(Me.$.NETWORK_OFFLINE);e2(d,t,n,c);const{hostCommunicationService:p}=(0,U4.i)(),g=X4((()=>({client:o,coreSettings:r,loggerFactory:l,hostCommunicationService:p})),[o,r,l,p]);return(0,gO.t)(i,{errorActionServices:g,children:(0,gO.t)(a,{error:m,coreSettings:r,windowProvider:s,skipFluentThemeProvider:!0})})}),{})},e2=(e,t,n,i)=>{e?(i.errorToTelemetry&&i.errorToTelemetry(`ErrorAppViewsRenderer: errorApp caught an error ${n}`,"webclient_framework_foundation_apps_error",void 0,!0),t("RenderingFailure",{errorInfo:ct.y.ErrorAppError,errorMessage:n})):t("RenderingCanceled",{errorInfo:ct.y.NetworkOffline})};function t2(e){if(!e)return;if(e.prevError){const t=t2(e.prevError);t&&(e.prevError=t)}let t=null;switch(e?.type){case"AuthError":t=Bl.l.fromSerialized(e);break;case"CoreError":t=Me.G.fromSerialized(e);break;case"TaskError":t=Ae.fromSerialized(e)}return t}const n2={id:"com.microsoft.teams.esp",name:"EspApp",supportedEntities:[Se.py.esp],supportedRenderModes:[Mt.S.Modal],getDefaultCommand:()=>({type:Se.py.esp,action:Se.uk.default}),windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}};var i2=n(663782);class a2{constructor(e,t){this.userBiService=e,this.logger=t.newLogger("esp-bi-telemetry","apps-esp")}recordEspPanelView(e,t,n,i){const a=this.userBiService?.createDatabag?.();a&&(a.identifier=t,a.irisCampaignId=i);const o={panelType:n?dA.wh.EligibleEngagementSurface:dA.wh.DisplayedEngagementSurface,panelRegion:(0,i2.B4)(e),dataBag:a};this.userBiService?.recordPanelView(o,this.logger),a&&a.dispose()}}const o2=()=>Promise.all([n.e(652709),n.e(966725)]).then(n.bind(n,376467)),r2=async e=>(0,ac.mT)(o2,"esp-engine",e);var s2=n(167312);const l2="growth_growthplatform_start_esp_job",c2="growth_growthplatform_esp_engine";function d2(e){const{client:t,coreSettings:n,entityCommanding:i,loggerFactory:a,platformService:o,scenarioFactory:r,userBiService:s,authenticationUser:l,isMainWindow:c}=e;return{id:"start-esp-app-ready-hander",runOncePerId:!0,job:async()=>{const{enableEsp:e,enableEspAppReadyWindowWarmTrigger:d,enableFirstRunTrigger:u,enableSetFirstLoginInformation:m}=n.get(b.J.Esp);if(!l?.type||"Anonymous"===l?.type)return;if(!c)return;const p=a.newLogger("esp-engine","apps-esp");p.debug("AppReady handler started");let g=!1;if(m){const e=await(0,s2.I1)(t,p);try{const n=await async function(e,t){const{clientType:n}=t?.config??{},i=n===An.Bh.Maglev&&!e?.maglev,a=n===An.Bh.Web&&!e?.WebNorthStar;return i?"maglev":a?"WebNorthStar":void 0}(e,o);n&&(p.log("Setting first login information"),g=!0,await(0,s2.Zm)(t,n,new Date,e,p))}catch(e){const t=(0,de.qZ)(e);p.errorToTelemetry?.(`Failed to update first login information ${t}`,l2)}}e&&d&&(g&&u?await u2(t,n,a,r,i,s,o,l,p,"FirstRun"):await u2(t,n,a,r,i,s,o,l,p,"AppReady"))}}}async function u2(e,t,n,i,a,o,r,s,l,c){const{enableBlockingUntilAppReadyTriggers:d}=t.get(b.J.Esp);try{const{displayEspSurface:l}=await r2(i),d=await l(e,t,n,r,c,new a2(o,n),s);if(d){const{entity:{id:e,type:t}}=d;e&&a.esp.launchDialog(e,t)}}catch(e){const t=(0,de.qZ)(e);l.errorToTelemetry?.(`${c} failed to show any surface. Error: ${t}`,c2)}finally{d&&(0,s2.m8)(e,l)}}const m2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsEspTriggerSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espTriggerEvent"}}]}}]};function p2(e){const{client:t,coreSettings:n,authenticationUser:i}=e;return{id:"esp-time-based-trigger-job",runOncePerId:!0,job:async()=>{const{enableEsp:a,enableTimeBasedEspTrigger:o}=n.get(b.J.Esp);if(!a||!o)return;if(!i?.type||"Anonymous"===i?.type)return;const r=t.subscribe({query:m2,fetchPolicy:"no-cache"}).subscribe((()=>async function(e){const{client:t,coreSettings:n,loggerFactory:i,platformService:a,scenarioFactory:o,userBiService:r,authenticationUser:s}=e,l="esp_time_based_trigger_job",c=i.newLogger(l,"apps-esp");try{const{displayEspSurface:e}=await r2(o);await e(t,n,i,a,"Daily",new a2(r,i),s),c.infoToTelemetry?c.infoToTelemetry("Daily Trigger was invoked",l):c.log("Daily Trigger was invoked")}catch(e){const t=(0,de.qZ)(e);c.errorToTelemetry?c.errorToTelemetry(`Daily Trigger has an error ${t}`,l):c.error("Daily Trigger has an error")}}(e)));return()=>{r.unsubscribe()}}}}const g2=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i,id:a},entityOptions:o},requestContext:{client:r,coreSettings:s,loggerFactory:l,platformService:c,scenarioFactory:d,userBiService:u,authenticationUser:m}}=e,{enableEsp:p}=s.get(b.J.Esp),g=a||void 0;if(!m?.type||"Anonymous"===m?.type)return t;if(n===Se.py.esp&&i===Se.uk.create){let e;if(p){const t=l.newLogger("esp-engine","apps-esp"),{forceShow:n,triggerType:i,customParams:a}=o||{},p="FollowUp"===i?"FollowUp":"Manual";try{const{displayEspSurface:t}=await r2(d);e=await t(r,s,l,c,p,new a2(u,l),m,{surfaceId:g,forceShow:n,customParams:a})}catch(e){const n=(0,de.qZ)(e);t.errorToTelemetry?.(`${p} failed to show any surface. Error: ${n}`,"growth_growthplatform_esp_engine",{surfaceId:g})}}return e}return t},h2=[{filter:"/l/discover-teams",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/discover-teams]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableDiscoverTeamsDeeplink:o}=i.get(b.J.Esp);return o?{entityCommand:{entity:{id:"",type:Se.py.teamsgallery,action:Se.uk.view},command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableDiscoverTeamsDeeplink is not enabled. Skipping deeplink processing.")}},{filter:"/l/campaign/chat",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/campaign/chat]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableSyntheticNotificationCampaignDeeplink:o}=i.get(b.J.Esp);return o?{entityCommand:{entity:{id:"chatCampaign",type:Se.py.campaignnotifications,action:Se.uk.view},command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableSyntheticNotificationCampaignDeeplink is not enabled. Skipping deeplink processing.")}},{filter:"/l/campaign/meeting",execute:async({deeplinkUrl:{pathname:e,searchParams:t},context:{loggerFactory:n,coreSettings:i}})=>{const a=n.newLogger("[ESP][/campaign/meeting]","apps-esp");a.debug(`Deeplink path: ${e}`,`, Deeplink params: ${t}`);const{enableSyntheticNotificationCampaignDeeplink:o}=i.get(b.J.Esp);return o?{entityCommand:{entity:{id:"meetingCampaign",type:Se.py.campaignnotifications,action:Se.uk.view},command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}}:void a.debug("Flag enableSyntheticNotificationCampaignDeeplink is not enabled. Skipping deeplink processing.")}}],y2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsEspSyntheticNotificationToastSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syntheticNotificationToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderId"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"campaignType"}},{kind:"Field",name:{kind:"Name",value:"imageUrl"}},{kind:"Field",name:{kind:"Name",value:"title"}}]}}]}}]},v2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEspToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"credentials"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}},{kind:"Argument",name:{kind:"Name",value:"credentials"},value:{kind:"Variable",name:{kind:"Name",value:"credentials"}}}]}]}}]};var f2;function S2(e){const{client:t,coreSettings:n,i18n:i,entityCommanding:a,loggerFactory:o,authenticationUser:r}=e;return{id:"esp-synthetic-notification-toast-subscription-job",runOncePerId:!0,job:async()=>{const{enableEsp:e,enableSyntheticNotificationToast:s}=n.get(b.J.Esp);if(!e||!s)return;if(!r?.type||"Anonymous"===r?.type)return;const l=t.subscribe({query:y2,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i){return async a=>{const o=n.newLogger("SyntheticNotificationToastEventSubscription","apps-esp");if(a.errors){const e=(0,$.u4)(a.errors.map((e=>e.message)).join());return void o.error?.(`${li.f.SubscriptionFailed} ${e}`)}if(!a.data?.syntheticNotificationToastEvent)return void o.error?.(li.f.EmptyEvent);const{syntheticNotificationToastEvent:r}=a.data,s=function(e,t,n){return{conversationId:t.messageId,messageId:t.messageId,quickReply:!1,time:new Date(+t.timestamp),text:k2(e,t,"description",n),title:k2(e,t,"title",n),type:"SyntheticNotification",campaignType:t.campaignType??void 0}}(t,r,o),l=await C2(i,o,r.imageUrl||void 0);return l&&(s.mainImage={alt:"",src:l}),e.toasts.showEspSyntheticNotification(r.correlationId,s)}}(a,i,o,t));return()=>{l.unsubscribe()}}}}function k2(e,t,n,i){if(t.campaignType){const a=(()=>{switch(t.campaignType){case f2.meeting:return`activity_esp_meeting_recommendation_${n}`;case f2.chat:return`activity_esp_chat_recommendation_${n}`;case f2.upgrade:return`activity_esp_upgrade_recommendation_${n}`;case f2.files:return`activity_esp_files_recommendation_${n}`;default:return void i.error(`Campaign Type is not valid ${t.campaignType}`)}})();return a?e.stringTranslate("activity",a):""}return"title"===n?t.title||"":t.text||""}!function(e){e.chat="chatCampaign",e.meeting="meetingCampaign",e.upgrade="upgradeCampaign",e.files="filesCampaign"}(f2||(f2={}));const C2=async(e,t,n)=>{if(n)try{const t=await e.query({query:v2,fetchPolicy:"no-cache",variables:{url:n,credentials:"omit"}});return t?.data.toastImageAsDataUri||void 0}catch(e){return void t.error(li.f.ImageFetchFailed)}};const b2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ComponentsEspCommonEspSurfacesUpdateSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espSurfacesUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ComponentsEspCommonSurfaceFragment"}}]}}]}},...n(953819).wh.definitions]};var w2=n(4254),T2=n(674271);const I2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsEspSurfaceShownSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"surfaceIds"}},type:{kind:"ListType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espSurfaceShownEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"surfaceIds"},value:{kind:"Variable",name:{kind:"Name",value:"surfaceIds"}}}]}]}}]};class N2{constructor(e,t,n,i,a,o,r,s){this.logger=i,this.entityCommanding=a,this.parseExpression=o,this.getEspConfig=r,this.displaySurface=s;const l=t.getObservable(b.J.Esp);this.biSurfaces=this.toBiSurfaces(e),this.configSubscription=l.subscribe((async()=>{await this.updateSurfaces()})),this.espCdlSurfaceSubscription=n.subscribe({query:b2,fetchPolicy:"no-cache"}).subscribe((async()=>{await this.updateSurfaces(),await n.query({query:w2.Y,fetchPolicy:"network-only"})})),this.surfaceShownSubscription=n.subscribe({query:I2,variables:{surfaceIds:this.biSurfaces.map((e=>e.id))},fetchPolicy:"no-cache"}).subscribe((async()=>{await this.updateSurfaces()}))}async onSignal(e){const t=this.biSurfaces.filter((t=>t.invoke(e))).map((e=>e.id));if(!t.length)return;let n=e.data["Panel.WindowID"];this.isEventFromSyntheticNotificationToast(e)&&(n=T2.f5);const i=await this.displaySurface(t,n);if(i){const{entity:{id:e,type:t}}=i;e&&this.entityCommanding.esp.launchDialog(e,t)}}unsubscribe(){this.configSubscription.unsubscribe(),this.surfaceShownSubscription.unsubscribe(),this.espCdlSurfaceSubscription.unsubscribe()}toBiSurfaces(e){return e.filter((e=>-1===e.recur||e.recur>e.displayed.length)).filter((e=>"BIEvent"===e.trigger)).map((e=>{try{const t=this.parseExpression(e.triggerFilter||"");return{id:e.id,invoke:e=>t.evaluate(e)}}catch{return void this.logger.error(`invalid BITrigger trigger filter value for surface ${e.id} with triggerFilter ${e.triggerFilter}`)}})).filter((e=>!!e))}isEventFromSyntheticNotificationToast(e){return"SyntheticNotification"===e.data["Panel.Type"]&&"toast"===e.data["Panel.Region"]}async updateSurfaces(){const{surfaces:e}=await this.getEspConfig();this.biSurfaces=this.toBiSurfaces(e)}}const E2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsEspRecordCompletedActionMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actions"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"recordEspCompletedActions"},arguments:[{kind:"Argument",name:{kind:"Name",value:"actions"},value:{kind:"Variable",name:{kind:"Name",value:"actions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"completedActions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"action"}}]}}]}}]}}]};var A2=n(613853);class _2{constructor(e,t,n,i,a,o){this.logger=t,this.parseExpression=n,this.client=i,this.coreSettings=a;const r=a.getObservable(b.J.Esp);this.actionRegistrations=this.getActionRegistrations(e),this.configSubscription=r.subscribe((async()=>{const{espState:e}=await o();this.actionRegistrations=this.getActionRegistrations(e)}))}onSignal(e){const t=this.actionRegistrations.filter((t=>t.invoke(e))).map((e=>e.action));if(t.length){this.actionRegistrations=this.actionRegistrations.filter((e=>-1===t.indexOf(e.action)));const{enableEspStateApolloCache:e}=this.coreSettings.get(b.J.Esp);this.client.mutate({mutation:E2,variables:{actions:t},refetchQueries:e?[{query:A2.$,fetchPolicy:"no-cache"}]:void 0})}}unsubscribe(){this.configSubscription.unsubscribe()}getActionRegistrations(e){const t=e.userState.completedActions.reduce(((e,t)=>e.add(t.action)),new Set);return this.getEspTrackedActions(this.coreSettings).filter((e=>!t.has(e.action))).map((e=>{try{const t=this.parseExpression(e.expression);return{action:e.action,invoke:e=>t.evaluate(e)}}catch{return void this.logger.errorToTelemetry?.(`invalid data registration expression for action ${e.action} with expression ${e.expression}`,"esp_signal_handler")}})).filter((e=>!!e))}getEspTrackedActions(e){const t=e.get(b.J.Esp),n=[];return Object.keys(t).forEach((e=>{const i=t[e];i?.trackedAction&&!i?.disabled&&n.push({action:i.trackedAction,expression:i.expression})})),n}}class F2{onSignal(e){}unsubscribe(){}}function D2(e){const{coreSettings:t,userBiService:n,scenarioFactory:i,client:a,loggerFactory:o,platformService:r,entityCommanding:s,authenticationUser:l}=e;return{id:"esp-signal-handler-job",runOncePerId:!0,job:async()=>{const{enableEsp:e,enableEspBiEventTrigger:c,enableEspCompletedActions:d}=t.get(b.J.Esp);if(!e)return;if(!l?.type||"Anonymous"===l?.type)return;if(!c&&!d)return;const{getConfig:u,parseExpression:m,displayEspSurface:p}=await r2(i),g=o.newLogger("esp-signal-handler-job","apps-esp"),{surfaces:h,espState:y}=await u(a,t,g),v=()=>u(a,t,g,"network-only"),f=c?new N2(h,t,a,g,s,m,v,((e,i)=>p(a,t,o,r,"BIEvent",new a2(n,o),l,{surfaceIds:e},i))):new F2,S=d?new _2(y,g,m,a,t,v):new F2,k=n?.observe?.().subscribe({next:async e=>{S.onSignal(e),f.onSignal(e)}});return()=>{k?.unsubscribe(),f.unsubscribe(),S.unsubscribe()}}}}const P2=()=>Promise.all([n.e(613224),n.e(976612),n.e(849736)]).then(n.bind(n,713397));function M2(){const e=()=>null;return{manifest:n2,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Modal){const e="esp-dialog";n("ChunkLoadStarted",{chunkName:e});const{EspDialogComponent:t}=await(0,ac.mT)(P2,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(t,{})}return(0,gO.t)(e,{})},onPreWarm:e=>{const{context:t}=e;return[p2(t),S2(t),D2(t)]},onUserWindowPreWarm:e=>{const{context:t}=e;return[d2(t)]},onBeforeCommandHandled:g2,onBeforeDeeplinkParsed:h2}}const x2={id:"com.microsoft.teams.filePicker",name:"FilePickerApp",supportedEntities:[Se.py.filepicker],supportedRenderModes:[Mt.S.Modal]},R2=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(120894),n.e(666384),n.e(253400),n.e(397833),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(255279),n.e(869026),n.e(30577),n.e(704043),n.e(729265),n.e(65923),n.e(577767),n.e(908285),n.e(801870),n.e(32705),n.e(101614),n.e(69599),n.e(141377),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(241070),n.e(600213),n.e(916297),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(799855),n.e(269518),n.e(48523),n.e(206887),n.e(613899),n.e(656436),n.e(749666),n.e(198610),n.e(266004),n.e(158529),n.e(868123)]).then(n.bind(n,611985));function j2(){const e=()=>null;return{manifest:x2,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{const o=a.newLogger("FilePickerApp","apps-file-picker");if(t===Mt.S.Modal){const e="file-picker-app";o.log("chunk load start"),n("ChunkLoadStarted",{chunkName:e}),o.log("experimental import start");const{FilePickerComposeDialogRenderer:t}=await(0,ac.mT)(R2,e,i);return o.log("report chunk load success"),n("ChunkLoadSucceeded",{chunkName:e}),o.log("Rendering file picker compose dialog"),(0,gO.t)(t,{})}return(0,gO.t)(e,{})}}}const L2={id:"com.microsoft.teams.add-cloud-storage-folder-dialog",name:"AddCloudStorageFolderDialogApp",supportedEntities:[Se.py.cloudStorageDialog],supportedRenderModes:[Mt.S.Modal]},O2=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(909020),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(666384),n.e(553486),n.e(255279),n.e(704043),n.e(32705),n.e(928362),n.e(652421),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(940495),n.e(98223),n.e(350959),n.e(206237),n.e(48523),n.e(206887),n.e(613899),n.e(266004),n.e(260071)]).then(n.bind(n,611985));const $2={id:"com.microsoft.teams.files",name:"FilesApp",supportedEntities:[Se.py.file],supportedRenderModes:[Mt.S.Main],getDefaultCommand:()=>({type:Se.py.file,action:Se.uk.error}),windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},U2=({appRenderMode:e,coreSettings:t})=>{const n=new MV.H,{criticalPhaseTimeout:i,postCriticalPhaseTimeout:a}=t.get(b.J.Files),o=[];if(e===Mt.S.Main)o.push(xV.G.P2P_FILES_LIST_VIEW_RENDERED);return n.registerAppPhase({phase:yt.nh.CRITICAL,signals:o,timeout:i||6e4}),n.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:[],timeout:a||1e4}),n.appPhases},B2=({entity:e})=>e.type!==Se.py.file||e.action!==Se.uk.list&&e.action!==Se.uk.update?H.RG.FilesAppSwitch:H.RG.P2PFilesListSwitch,W2=e=>{if(H2(e))return V2(e)?{subNavEntity:G2(e),headerEntity:z2(e),startEntity:q2(e),mainEntity:J2(e),endEntity:Q2(e)}:null},H2=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=i===Se.py.file,r=[Se.uk.list,Se.uk.error],s=n&&r.includes(n);return!!(a&&o&&s)},V2=()=>!0,G2=()=>null,z2=()=>null,q2=()=>null,J2=({entity:e})=>e,Q2=()=>null,K2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesPersonalSiteDetailsUserPreferenceStoreQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getPersonalSiteInfoFromUserPreferenceStore"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"listUrl"}}]}}]}}]},Y2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsFilesRegisterTokenWarmingResourceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"service"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"resource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"registerTokenWarmingResource"},arguments:[{kind:"Argument",name:{kind:"Name",value:"service"},value:{kind:"Variable",name:{kind:"Name",value:"service"}}},{kind:"Argument",name:{kind:"Name",value:"resource"},value:{kind:"Variable",name:{kind:"Name",value:"resource"}}}]}]}}]},X2={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesPersonalSiteDetailsFromUploadQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getPersonalSiteInfoForUpload"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"siteUrl"}},{kind:"Field",name:{kind:"Name",value:"listUrl"}}]}}]}}]},Z2=({context:{client:e,coreSettings:t,scenarioFactory:n}})=>[{id:"files-register-resources",runOncePerId:!0,job:async()=>{const{environment:i}=t.get(b.J.Metadata);if(i===pt.s.life)return;const a=n.newScenario(H.RG.FileSPOHomeSiteODTokenPrewarm);try{const{enableTenantSiteUrlAndDomains:n}=t.get(b.J.Extensibility);let i;if(n){const{tenantSiteUrlAndDomains:e}=t.get(b.J.Tenant);i=e?.webUrl&&new URL(e?.webUrl)}else{const{tenantSiteUrl:e}=t.get(b.J.Tenant);i=e?.webUrl&&new URL(e?.webUrl)}const o=i&&i.origin||void 0;o?(e.mutate({mutation:Y2,variables:{service:"Files",resource:o}}),a.stop()):a.incomplete()}catch(e){a.mark("Home site domain token prewarm failed"),a.fail({errorMessage:"Home site domain token prewarm failed"})}const o=n.newScenario(H.RG.FileSPOPersonalODTokenPrewarm);let r;try{const t=await e.query({query:K2,fetchPolicy:"cache-first"});r=t?.data?.getPersonalSiteInfoFromUserPreferenceStore?.siteUrl}catch(e){o.mark("Preference Store fetch failed")}try{if(!r||""===r){o.mark("Falling back to upload query");const t=await e.query({query:X2,context:{scenario:o}});r=t?.data?.getPersonalSiteInfoForUpload?.siteUrl}if(!r||""===r)return void o.fail({errorMessage:"Personal OD Token Prewarming failed due to invalid personal siteUrl"})}catch(e){o.fail({errorMessage:"upload query fetch failed"})}try{const t=new URL(r),n=t&&t.origin;o.mark("Starting Prewarm code"),e.mutate({mutation:Y2,variables:{service:"PersonalFiles",resource:n}}),o.stop()}catch(e){o.fail({errorMessage:"Personal OD Token Prewarming failed"})}}}],e6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ComponentsFileBrowserPreWarmAuthenticationTokenQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"resource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"AcquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resource"},value:{kind:"Variable",name:{kind:"Name",value:"resource"}}},{kind:"Argument",name:{kind:"Name",value:"acquireTokenOptions"},value:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"token"}}]}}]}}]},t6=async(e,t,n,i)=>{const a=new URL(t).origin,o=await n({resource:a});if(o&&e){const n=e.document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","access_token"),n.setAttribute("value",o);const a=e.document.createElement("form");a.appendChild(n),a.setAttribute("action",t),a.setAttribute("method","POST"),e.document.body.appendChild(a),a.submit(),i?.mark("Form Created and submitted")}else i?.fail({errorMessage:"Token fetch failed"})},n6=(e,t,n,i)=>{let a;return new Promise(((o,r)=>{let s;const l=e=>{if(e.source&&t&&e.source===t){if("initialize"===e.data.type){s&&(clearInterval(s),s=void 0);const t=e.ports&&e.ports[0];if(t)return a=t,void o(a);r(a)}}};i?(n.removeEventListener("message",l),o(a)):t?(s=setInterval((()=>{a?(clearInterval(s),s=void 0):t.postMessage({type:"identify-parent",channelId:e},n.document.location?.origin)}),100),n.addEventListener("message",l)):o(a)}))};var i6=n(131523);const a6=(e,t,n,i)=>({close:async()=>{n?.log("Close post meessage received"),i?.mark(i6.le.telemetry.markers.filebrowser_prewarm_close_post_message),await t(!1)},authenticate:async t=>{n?.log(`Authenticate post meessage received for ${t.resource}`),i?.mark(i6.le.telemetry.markers.filebrowser_prewarm_auth_post_message);const a=await e({resource:t.resource});return a?{result:"token",scheme:"bearer",token:a}:(n?.log("Not able to PreWarm the App"),i?.mark(i6.le.telemetry.markers.filebrowser_prewarm_auth_token_failed),{result:"error",error:{code:"NoTokenObtained",message:"Could not obtain a token for resource."}})}}),o6=()=>({result:"success"}),r6=(e,t)=>(t.error("Error executing command in filebrowser pre warm: ".concat(e.message)),{result:"error",error:{code:e.code||"unknown",message:e.message}}),s6=e=>({result:"error",error:{code:"unsupportedCommand",message:e.command}}),l6=e=>t=>{e(t.data)},c6=(e,t,n)=>{const{close:i,authenticate:a}=t,o=(({sendAck:e,sendCommandResult:t,close:n,authenticate:i,logger:a})=>async o=>{if("command"===o.type){e(o);const r=o.data;switch(r.command){case"close":n(r).then((()=>{t(o,o6())}),(e=>{t(o,r6(e,a))}));break;case"authenticate":i(r).then((e=>{t(o,e)}),(e=>{t(o,r6(e,a))}));break;default:t(o,s6(r))}}})({sendAck:t=>{e&&e.postMessage({type:"acknowledge",id:t.id})},sendCommandResult:(t,n)=>{e&&e.postMessage({type:"result",id:t.id,data:n})},close:i,authenticate:a,logger:n});((e,t)=>{const n=l6(t);e&&(e.addEventListener("message",n),e.start(),e.postMessage({type:"activate"}))})(e,o)},d6=e=>{const t=e.document.createElement("iframe");return t&&(t.setAttribute("id","filesAppIframe"),t.style.display="none",t.setAttribute("target","_self"),e.document.body.appendChild(t)),t&&t.contentWindow||null},u6=(e,t,n)=>{let i,a=12e3;e&&e>0&&(a=e),i=void 0,i=t.setTimeout((()=>{n(!0),t.clearTimeout(i)}),a)},m6=(e,t,n,i,a)=>`${e}_layouts/15/${a?"prewarm.ashx":"filebrowser.aspx"}?app=TeamsFile&fileBrowser={"sdk":"8.0","messaging":{"origin":"${t?.location?.origin??void 0}","channelId":"${n}"},"authentication":{},"entry":{"oneDrive":{"recent":{}}}}&scenario=OneDriveFiles&auth=none&locale=${i}&hostName=TeamsModern&preWarmFB=true`;function p6(e,t){const{authenticationUser:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,coreSettings:l,networkState:c,platformService:d}=e;return{id:"files-app-pre-warm-job",job:async()=>{const e=a.newScenario("Idle"===t?H.RG.FileBrowserPreWarmOnIdle:H.RG.FileBrowserPreWarm),u=i.newLogger("FilesAppPreWarmJob","apps-files");u.log("files_app_pre_warm_job triggered");try{if(!c.isOnline())return void e.incomplete({errorMessage:"No network, Terminating the Job"});if(n?.role===ys.w4.Guest||n?.role===ys.w4.Anonymous)return void e.incomplete({errorMessage:"Guest-Anonymous User, Terminating the Job"});let t;try{const e=await o.query({query:K2});t=e?.data?.getPersonalSiteInfoFromUserPreferenceStore?.siteUrl}catch{e.mark("Preference Store fetch failed")}if(!t){e.mark("Reading from IndexDB");const n=await o.query({query:X2,context:{scenario:e}});t=n?.data?.getPersonalSiteInfoForUpload?.siteUrl}t?(e.mark("Starting Prewarm code"),await(async(e,t,n,i,a,o,r,s,l)=>{const c=n.newLogger("fileBrowserPreWarm","components-file-browser-pre-warm"),d=t.findScenario(H.RG.FileBrowserPreWarm)||t.findScenario(H.RG.FileBrowserPreWarmOnIdle),{fileBrowserHiddenIframeCloseInterval:u,enableDedicatedPrewarm:m,enablePrewarmInStoragePartition:p}=o.get(b.J.Files),g=`${Math.random().toFixed(8)}`;let h=null;const y=async e=>{const{resource:t}=e,n=new URL(t).origin;c.log(`getAuthToken triggered for resource: ${t}`),d?.mark(i6.le.telemetry.markers.filebrowser_prewarm_auth_token_start);const a=await i.query({query:e6,fetchPolicy:"cache-first",variables:{resource:n}}),o=a.data?.authenticationToken?.token??"";return d?.mark(i6.le.telemetry.markers.filebrowser_prewarm_auth_token_end),Promise.resolve(o)},v=(0,Ko._)(o,s);let f=null;if(p&&v){if(d?.mark("Hidden Window created"),!r?.id)return c.log("Failed to create hidden window, userId absent"),void d?.fail({errorMessage:"Failed to create hidden window as UserId absent"});const e="width=0,height=0,left=-9999,top=-9999,toolbar=no,menubar=no,location=no,status=no,titlebar=no",t=`about:blank?usercontextid=${r?.id}&show=false`;if(h=a.open(t,`preWarmAppWindow_${r?.id}`,e),!h)return c.log("Failed to create hidden Window"),void d?.fail({errorMessage:"Failed to create hidden Window"});h.blur(),f=h}else d?.mark("Hidden Iframe created"),f=d6(a);const S=async e=>{const i=n.newLogger("fileBrowserPreWarm","components-file-browser-pre-warm"),o=t.findScenario(H.RG.FileBrowserPreWarm)||t.findScenario(H.RG.FileBrowserPreWarmOnIdle);if(!e)try{l?.set("FileAppPreWarmTimeStamp",Date.now().toString(),"Files")}catch(e){i.log("Writing PreWarm date to local storage has failed")}n6(g,f,a,!0),h?(h.close(),i.log("Removed Hidden Window"),o?.mark(i6.le.telemetry.markers.filebrowser_prewarm_partition_window_removed,void 0,e?"timeout":"success")):(a.document.getElementById("filesAppIframe")?.remove(),i.log("Removed Hidden Iframe"),o?.mark(i6.le.telemetry.markers.filebrowser_prewarm_window_removed,void 0,e?"timeout":"success")),o?.stop(),Promise.resolve()};f||(d?.mark(i6.le.telemetry.markers.filebrowser_prewarm_window_creation_failed),d?.fail({errorMessage:"Failed to create iframe"}),Promise.resolve()),c.log("Created Hidden Iframe"),d?.mark(i6.le.telemetry.markers.filebrowser_prewarm_window_creation_successful);const{localeCode:k}=o.get(b.J.Platform),C=m6(e,a,g,k??void 0,m??!1);await t6(f,C,y,d),u6(u,a,S);const w=await n6(g,f,a,!1),T=a6(y,S,c,d);c6(w,T,c)})(t,a,i,o,s,l,n,d,r)):e.incomplete({errorMessage:"Personal SiteInfo fetch failed"})}catch(t){const n=t?.errorCode||t?.code,i=`Failed filesAppPreWarmJob with errorCode ${n}`;return u.errorToTelemetry?.(i,"files_app_pre_warm_job"),void e.fail({errorCode:n,message:t?.message,errors:t?.name,errorMessage:i})}}}}const g6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesJoinedTeamsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsOrder"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"JoinedTeamsOrderInput"}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isSortingEnforced"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"excludeHiddenAndArchivedTeams"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"joinedTeamsAndChannels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsOrder"},value:{kind:"Variable",name:{kind:"Name",value:"teamsOrder"}}},{kind:"Argument",name:{kind:"Name",value:"isSortingEnforced"},value:{kind:"Variable",name:{kind:"Name",value:"isSortingEnforced"}}},{kind:"Argument",name:{kind:"Name",value:"activitiesFromWorker"},value:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}}},{kind:"Argument",name:{kind:"Name",value:"excludeHiddenAndArchivedTeams"},value:{kind:"Variable",name:{kind:"Name",value:"excludeHiddenAndArchivedTeams"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"joinedTeams"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"channelOnlyMember"}},{kind:"Field",name:{kind:"Name",value:"isDeleted"}},{kind:"Field",name:{kind:"Name",value:"memberRole"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}}]}},{kind:"Field",name:{kind:"Name",value:"isArchived"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"isFavorite"}},{kind:"Field",name:{kind:"Name",value:"membershipSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"memberCount"}},{kind:"Field",name:{kind:"Name",value:"botCount"}}]}},{kind:"Field",name:{kind:"Name",value:"visibility"}},{kind:"Field",name:{kind:"Name",value:"pictureETag"}},{kind:"Field",name:{kind:"Name",value:"teamGuestSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}}]}},{kind:"Field",name:{kind:"Name",value:"dynamicMembership"}},{kind:"Field",name:{kind:"Name",value:"isTenantWide"}},{kind:"Field",name:{kind:"Name",value:"teamType"}},{kind:"Field",name:{kind:"Name",value:"teamLockState"}},{kind:"Field",name:{kind:"Name",value:"teamSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createAndUpdateChannel"}}]}}]}}]}}]}}]};var h6=n(430641),y6=n(298433);const v6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesChannelsInfoByGroupIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"groupId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activitiesFromWorker"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}},defaultValue:{kind:"BooleanValue",value:!1}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamByGroupId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"groupId"},value:{kind:"Variable",name:{kind:"Name",value:"groupId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChannelListTeamFragment"}},{kind:"Field",name:{kind:"Name",value:"channels"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonChannelListChannelFragment"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"hostTenantId"}},{kind:"Field",name:{kind:"Name",value:"isShownByDefault"}},{kind:"Field",name:{kind:"Name",value:"substrateGroupId"}},{kind:"Field",name:{kind:"Name",value:"lastMessageArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"defaultFileSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"filesRelativePath"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"teamSiteInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"groupId"}},{kind:"Field",name:{kind:"Name",value:"sharepointSiteUrl"}}]}}]}}]}},...h6.K.definitions,...y6.y.definitions]},f6=(e,t,n,i,a,o,r)=>{const s=new URL(e).pathname;return`${e}/_layouts/15/${r?"prewarm.ashx":"filebrowser.aspx"}?fileBrowser={"sdk":"8.0","messaging":{"origin":"${t?.location?.origin??void 0}"},"entry":{"sharePoint":{"byPath":{"web":"${s}","folder":"${a}"}}}}&app=teamsfile&teamId=${i}&channelId=${n}&scenario=ChannelFiles&auth=none&locale=${o}&hostName=TeamsModern&preWarmFB=true`};function S6(e,t){const{loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,coreSettings:s,networkState:l,authenticationUser:c,platformService:d}=e;return{id:"files-app-pre-warm-cft-job",job:async()=>{const e=i.newScenario("Idle"===t?H.RG.FileBrowserPreWarmForCFTOnIdle:H.RG.FileBrowserPreWarmForCFT);n.newLogger("FilesAppPreWarmForCFTJob","apps-files").log("files_app_pre_warm_cft_job triggered");try{let t=0;if(!l.isOnline())return void e.incomplete({errorMessage:"No network, Terminating the Job"});const u=await a.query({query:g6,fetchPolicy:"cache-first",variables:{teamsOrder:[],isSortingEnforced:!1,activitiesFromWorker:!1,excludeHiddenAndArchivedTeams:!0}});if(!u?.data?.joinedTeamsAndChannels?.joinedTeams)return void e.incomplete({errorMessage:"JoinedTeamsAndChannels query does not joinedTeams data, joinedTeams could be null or undefined"});if(t=u?.data?.joinedTeamsAndChannels?.joinedTeams?.findIndex((e=>null!=e?.teamSiteInformation?.groupId)),u?.data?.joinedTeamsAndChannels?.joinedTeams?.[t]?.teamSiteInformation?.groupId){const l=await a.query({query:v6,fetchPolicy:"cache-first",variables:{groupId:u.data.joinedTeamsAndChannels.joinedTeams[t].teamSiteInformation.groupId}}),m=l.data.teamByGroupId?.channels?.[0]?.defaultFileSettings?.filesRelativePath,p=l.data.teamByGroupId?.teamSiteInformation?.sharepointSiteUrl,g=l.data.teamByGroupId?.channels?.[0]?.id,h=l.data.teamByGroupId?.id;if(p&&h&&g&&m)await(async(e,t,n,i,a,o,r,s,l,c,d,u)=>{const m=o.newLogger("fileBrowserPreWarmForCFT","components-file-browser-pre-warm"),p=a.findScenario(H.RG.FileBrowserPreWarmForCFT)||a.findScenario(H.RG.FileBrowserPreWarmForCFTOnIdle),{fileBrowserHiddenIframeCloseInterval:g,enableDedicatedPrewarm:h,enablePrewarmInStoragePartition:y}=l.get(b.J.Files);let v=null;const f=async e=>{const{resource:t}=e,n=new URL(t).origin;m.log(`getAuthToken triggered for resource: ${t}`),p?.mark(i6.le.telemetry.markers.filebrowser_prewarm_auth_token_start);const i=await r.query({query:e6,fetchPolicy:"cache-first",variables:{resource:n}}),a=i.data?.authenticationToken?.token??"";return p?.mark(i6.le.telemetry.markers.filebrowser_prewarm_auth_token_end),Promise.resolve(a)},S=(0,Ko._)(l,d);let k=null;if(y&&S){if(!c?.id)return m.log("Failed to create hidden window as userId absent"),void p?.fail({errorMessage:"Failed to create hidden window as UserId absent"});const e="width=0,height=0,left=-9999,top=-9999,toolbar=no,menubar=no,location=no,status=no,titlebar=no",t=`about:blank?usercontextid=${c?.id}&show=false`;if(v=s.open(t,`preWarmAppWindow_${c?.id}`,e),!v)return m.log("Failed to create hidden window"),void p?.fail({errorMessage:"Failed to create hidden wiindow"});v.blur(),k=v}else k=d6(s);const C=async e=>{const t=o.newLogger("fileBrowserPreWarmForCFT","components-file-browser-pre-warm"),i=a.findScenario(H.RG.FileBrowserPreWarmForCFT)||a.findScenario(H.RG.FileBrowserPreWarmForCFTOnIdle);e||u?.set("ChannelFilesTabPreWarmTimeStamp",Date.now().toString(),"Files"),await n6(n,k,s,!0),v?(v.close(),t.log("Removed Hidden Window"),i?.mark(i6.le.telemetry.markers.filebrowser_prewarm_partition_window_removed,void 0,e?"timeout":"success")):(s.document.getElementById("filesAppIframe")?.remove(),t.log("Removed Hidden Iframe"),i?.mark(i6.le.telemetry.markers.filebrowser_prewarm_window_removed,void 0,e?"timeout":"success")),i?.stop(),Promise.resolve()};k||(p?.mark(i6.le.telemetry.markers.filebrowser_prewarm_window_creation_failed),p?.fail({errorMessage:"Failed to create iframe"}),Promise.resolve()),m.log("Created Hidden Iframe"),p?.mark(i6.le.telemetry.markers.filebrowser_prewarm_window_creation_successful);const{localeCode:w}=l.get(b.J.Platform),T=f6(e,s,n,t,i,w??void 0,h??!1);await t6(k,T,f,p),u6(g,s,C);const I=await n6(n,k,s,!1),N=a6(f,C,m,p);c6(I,N,m)})(p,h,g,m,i,n,a,r,s,c,d,o);else{const t=`Required information is missing ${p?"":"siteUrl"} ${h?"":"teamId"} ${g?"":"channelId"} ${m?"":"folderRelativePath"}`;e.incomplete({errorMessage:t})}}else e.incomplete({errorMessage:"JoinedTeamsAndChannels query does not return any team/site, possibly teamId or siteInformation is not available"})}catch(t){const n=t?.errorCode||t?.code,i=`Failed filesAppPreWarmForCFTJob with errorCode ${n}`;return void e.fail({errorCode:n,message:t?.message||i,errors:t?.name})}}}}const k6=864e5,C6=({context:{authenticationUser:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:c,entityCommanding:d,config:u,clientState:m,rebootService:p,userTrackingService:g}})=>{const h=[],{preWarmFileBrowser:y,fileBrowserRelaunchHiddenIframeInterval:v,preWarmFileBrowserForCFT:f}=t.get(b.J.Files),{environment:S}=t.get(b.J.Metadata),k=S===pt.s.life,C=i.newLogger("FilesAppPreWarmJob","apps-files");if(y&&!k){const y=a?.newScenario(H.RG.FileBrowserPreWarmIdleStateTrigger);C?.log("Entered Idle Experience path");const f=r?.get("FileAppPreWarmTimeStamp");let S=!0;if(f){const e=v??k6,t=+f;S=Date.now()-t>e}S?(C?.log("Push the Files App pre Warm Job"),y?.stop({reason:"Job-pushed"}),h.push(p6({authenticationUser:e,coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:c,entityCommanding:d,config:u,clientState:m,rebootService:p,userTrackingService:g},"LongIdle"))):(C?.log("Skip the Files App pre Warm Job"),y?.stop({reason:"Job-Skipped"}))}if(f){const e=a?.newScenario(H.RG.FileBrowserForCFTPreWarmIdleStateTrigger);C?.log("Entered Idle Experience path for Iframe CFT");const y=r?.get("ChannelFilesTabPreWarmTimeStamp");let f=!0;if(y){const e=v??k6,t=+y;f=Date.now()-t>e}f?(C?.log("Push the Channel Files Tab pre Warm Job"),e?.stop({reason:"Job-pushed"}),h.push(S6({coreSettings:t,hostCommunicationService:n,loggerFactory:i,scenarioFactory:a,client:o,localStorage:r,windowProvider:s,platformService:l,networkState:c,entityCommanding:d,config:u,clientState:m,rebootService:p,userTrackingService:g},"LongIdle"))):(C?.log("Skip the Channel Files Tab pre Warm Job"),e?.stop({reason:"Job-Skipped"}))}return h},b6=864e5,w6=({context:{coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,platformService:s,networkState:l,entityCommanding:c,config:d,clientState:u,rebootService:m,userTrackingService:p,authenticationUser:g}})=>{const h=[],{preWarmFileBrowserOnIdle:y,fileBrowserRelaunchHiddenIframeInterval:v,preWarmFileBrowserForCFTOnIdle:f}=e.get(b.J.Files),{environment:S}=e.get(b.J.Metadata),k=S===pt.s.life,C=n.newLogger("FilesAppPreWarmJobOnIdle","apps-files");if(y&&!k){const y=i?.newScenario(H.RG.FileBrowserPreWarmOnIdleStateTrigger);C?.log("Entered Idle Experience path");const f=o?.get("FileAppPreWarmTimeStamp");let S=!0;if(f){const e=v??b6,t=+f;S=Date.now()-t>e}S?(C?.log("Push the Files App pre Warm Job"),y?.stop({reason:"Job-pushed"}),h.push(p6({coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,platformService:s,networkState:l,entityCommanding:c,config:d,clientState:u,rebootService:m,userTrackingService:p,authenticationUser:g},"Idle"))):(C?.log("Skip the Files App pre Warm Job"),y?.stop({reason:"Job-Skipped"}))}if(f){const y=i?.newScenario(H.RG.FileBrowserForCFTPreWarmOnIdleStateTrigger);C?.log("Entered Idle Experience path for Iframe CFT");const f=o?.get("ChannelFilesTabPreWarmTimeStamp");let S=!0;if(f){const e=v??b6,t=+f;S=Date.now()-t>e}S?(C?.log("Push the Channel Files Tab pre Warm Job"),y?.stop({reason:"Job-pushed"}),h.push(S6({coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,platformService:s,networkState:l,entityCommanding:c,config:d,clientState:u,rebootService:m,userTrackingService:p,authenticationUser:g},"Idle"))):(C?.log("Skip the Channel Files Tab pre Warm Job"),y?.stop({reason:"Job-Skipped"}))}return h},T6={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}},I6={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsFilesChannelInfoQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"owningTeam"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]};var N6=n(684211),E6=n(573436),A6=n(610597);var _6;!function(e){e.DeepLinkNotEnabled="deeplink-not-enabled-error",e.MissingFileId="missing-fileId-error",e.MissingApolloClient="missing-apollo-client-error",e.CouldNotResolveViewer="could-not-resolve-viewer-error"}(_6||(_6={}));const F6=(e,t)=>({entity:{type:Se.py.extensions,action:Se.uk.view,id:JSON.stringify({appId:e,fileId:t.fileId.toLowerCase()}),linkedEntity:{id:JSON.stringify({subEntityId:JSON.stringify(t)}),type:Se.py.extensions}},command:{visibilityState:ke.fe.show,stateTransition:t.shouldOpenInMultiWindow?ke.su.new:ke.su.flush},entityOptions:{entryPoint:"personalApp"}}),D6=e=>({entity:{type:Se.py.filesoneupviewer,action:Se.uk.view,id:e.fileId},command:{visibilityState:ke.fe.show,stateTransition:e.shouldOpenInMultiWindow?ke.su.new:ke.su.flush},entityOptions:e}),P6=[{filter:"/l/file",execute:async({deeplinkUrl:e,context:{coreSettings:t,getUserContexts:n,scenarioFactory:i,loggerFactory:a}})=>{if(!M6(t))return Promise.reject({message:_6.DeepLinkNotEnabled});const o=a.newLogger("FileViewDeeplink","apps-files");let r=(e=>{const{pathname:t,searchParams:n}=e,i=t.split("/l/file/");return{fileId:i[i.length-1]??void 0,fileType:n.get("fileType")??"",tenantId:n.get("tenantId")??void 0,threadId:n.get("threadId")??void 0,objectUrl:n.get("objectUrl")??"",serviceName:n.get("serviceName")??"",shareUrl:n.get("shareUrl")||n.get("emailHtmlLink")||void 0,siteUrl:n.get("baseUrl")??void 0,context:"rwc"}})(e);if(!r.fileId)return Promise.reject({message:_6.MissingFileId});const s=await n(),l=s&&s.length>0?s[s.length-1]:void 0,c=l?.context?.client;if(!c)return Promise.reject({message:_6.MissingApolloClient});const d=(0,N6.m)(r.fileType);let u;if(r.threadId)try{const{data:e}=await c.query({query:I6,fetchPolicy:"cache-first",variables:{conversationId:r.threadId}});u=e}catch{u=void 0}r.tenantId=u?.channelByID.owningTeam?.tenantId||r.tenantId,t.get(b.J.Extensibility).enablePopOutFileChicletInMultiWindow&&!t.get(b.J.Core).isPrimaryWindow&&(r={...r,shouldOpenInMultiWindow:!0});const m=await(0,E6.I4)(c,r.fileType,!!t.get(b.J.Files).enableAppBasedFileHandlingForWXPTMP,!!t.get(b.J.Files).enableFilesAppBasedFileHandlingForPDFTMP,!!t.get(b.J.Files).enableFilesAAACheckForPDFAppTMP,t.get(b.J.Files).enableFilesPDFAppIdForViewTMP,t.get(b.J.Files).allowedInstallerAzureADAppIdsForPDFApp,!!t.get(b.J.Files).enableFilesAdminPreinstallCheckForPDFAppTMP,!!t.get(b.J.Files).enableAppBasedFileHandlingForOneNoteTMP,!!t.get(b.J.Files).enableAppBasedFileHandlingForVisioTMP,!!t.get(b.J.Extensibility).enableAppsQueryOptimization,!!t.get(b.J.Extensibility).enableInstalledAppQueryOptimization,o,i);return m?((0,A6.ui)(i,m,"personalApp",o,r.shouldOpenInMultiWindow,!0),Promise.resolve({entityCommand:F6(m,r),metadata:{allowAnonymous:!1}})):d===N6.xw.OneUpViewer?Promise.resolve({entityCommand:D6(r),metadata:{allowAnonymous:!1}}):Promise.reject({message:_6.CouldNotResolveViewer})}}],M6=e=>!!e.get(b.J.Files).enableFileOpenDeeplink,x6=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(666384),n.e(553486),n.e(255279),n.e(317069),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(41459),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(48523),n.e(830648),n.e(206887),n.e(300552),n.e(959139)]).then(n.bind(n,107453)),R6=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(666384),n.e(553486),n.e(255279),n.e(317069),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(41459),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(48523),n.e(830648),n.e(206887),n.e(300552),n.e(959139)]).then(n.bind(n,450812));function j6(){const e=()=>null,t="apps-files",n={chunkName:t};return{eventHandlers:T6,getAppPhases:U2,getAppViewEntities:W2,getCommandScenarioName:B2,manifest:$2,render:async({appRenderMode:i,coreSettings:a,onRenderEvent:o,scenarioFactory:r,entity:s})=>{if(s.type===Se.py.file&&(s.action===Se.uk.list||s.action===Se.uk.update)){o("ChunkLoadStarted",n);const{enableEntityMoreInfo:e}=a.get(b.J.Core),s=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),{P2PFilesListViewsRenderer:l}=await(0,ac.mT)(x6,t,r),{LPC:c}=e?{LPC:s}:await(0,ac.mT)(R6,t,r),d=e?s:rJ.p3;return o("ChunkLoadSucceeded",n),(0,gO.t)(c,{children:(0,gO.t)(d,{children:(0,gO.t)(l,{appRenderMode:i})})})}return(0,gO.t)(e,{})},onPreWarm:Z2,onExperienceLongIdle:C6,onIdle:w6,onBeforeDeeplinkParsed:P6}}const L6={id:"com.microsoft.teams.filesoneupviewer",name:"FilesoneupviewerApp",supportedEntities:[Se.py.filesoneupviewer],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main]},O6=e=>{if($6(e))return U6(e)?{subNavEntity:B6(e),headerEntity:W6(e),startEntity:H6(e),mainEntity:V6(e),endEntity:G6(e)}:null},$6=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.filesoneupviewer].includes(i),r=[Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},U6=()=>!0,B6=({entity:e,layoutMode:t})=>t===ke.lO.focus?null:e,W6=({entity:e})=>e,H6=()=>null,V6=({entity:e})=>e,G6=({contextEntity:e})=>e?.type===Se.py.chats?e:null,z6=e=>{const{entity:t,command:n}=e;return(n.stateTransition===ke.su.flush||n.stateTransition===ke.su.new)&&t.type===Se.py.filesoneupviewer&&t.action===Se.uk.view&&n.visibilityState===ke.fe.show?H.RG.FileOneUpViewer:void 0},q6=({appRenderMode:e})=>{const t=new MV.H,n=[];switch(e){case Mt.S.HorizontalBar:n.push(xV.G.ONEUP_HEADER_RENDERED);break;case Mt.S.Main:n.push(xV.G.ONEUP_RENDERED)}return t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:12e4}),t.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:[],timeout:1e4}),t.appPhases},J6=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(457628),n.e(909020),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(553486),n.e(156079),n.e(928362),n.e(652421),n.e(371898),n.e(702573),n.e(940495),n.e(795037)]).then(n.bind(n,207442));const Q6={id:"com.microsoft.teams.floating-ufd",name:"FloatingUfdApp",supportedEntities:[Se.py.floatingufd],supportedRenderModes:[Mt.S.Main],getDefaultCommand:()=>({action:Se.uk.default,type:Se.py.floatingufd}),windowFeatures:{width:300,height:200,top:0,left:0,additionalFeatures:{alwaysOnTop:"true",closable:"false",fullscreenable:"false",maximizable:"false",minimizable:"false",resizable:"false",movable:"false",hideWindowControl:"true",frame:"false",closeoverride:"true",transparent:"true",show:"false",excludeWindowFromScreenSharing:"true",contentprotection:"true",visibleOnAllWorkspaces:"true"}}},K6=e=>{if(Y6(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:X6(e),endEntity:null}},Y6=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===Se.py.floatingufd,a=t===Se.uk.view;return Boolean(i&&a)},X6=({entity:e})=>e,Z6=()=>({mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0,disableBorderInHighContrast:!0}}}),e8=()=>Promise.all([n.e(187946),n.e(193180),n.e(112403),n.e(909020),n.e(729265),n.e(373318),n.e(149115),n.e(635276),n.e(928362),n.e(474133),n.e(782721),n.e(404742),n.e(90653),n.e(738789),n.e(149776),n.e(782407)]).then(n.bind(n,943215)),t8=({coreServices:e})=>{const t=!!e?.coreSettings.get(b.J.Calling).disableContentprotection,n=(!t).toString(),i={...Q6.windowFeatures};return t&&i?.additionalFeatures&&(i.additionalFeatures.excludeWindowFromScreenSharing=n,i.additionalFeatures.contentprotection=n),i};function n8(){const e=()=>null;return{getAppViewEntities:K6,getAppViewEntitiesProps:Z6,getAppWindowFeatures:t8,manifest:Q6,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===Mt.S.Main&&n===Se.py.floatingufd){const{FloatingUfd:e}=await(0,ac.mT)(e8,"floating-ufd-app",i);return(0,gO.t)(e,{})}return(0,gO.t)(e,{})}}}const i8={id:"com.microsoft.teams.flyout",name:"FlyoutApp",supportedEntities:[Se.py.flyout,Se.py.flyoutphonelink,Se.py.flyoutwhatsnew],supportedRenderModes:[Mt.S.Main],getDefaultCommand:()=>({action:Se.uk.default,type:Se.py.flyout}),windowFeatures:{minWidth:378,maxWidth:378,width:378,minHeight:688,maxHeight:688,height:688,resizable:"false"}},a8=e=>{if(o8(e))return r8(e)?{subNavEntity:s8(e),headerEntity:l8(e),startEntity:c8(e),mainEntity:d8(e),endEntity:u8(e)}:null},o8=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.flyout].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},r8=()=>!0,s8=()=>null,l8=()=>null,c8=()=>null,d8=({entity:e})=>e,u8=()=>null,m8=()=>({mainEntity:{[Mt.S.Main]:{forceDisableTitleBar:!0,isBackgroundTransparent:!0}}}),p8=({type:e,action:t,appRenderMode:n,coreSettings:i})=>{const a=new MV.H,{flyoutAppPhaseTimeouts:o}=i.get(b.J.Core),r=[],s=[];if(n===Mt.S.Main)g8({type:e,action:t,criticalSignals:r,postCriticalSignals:s,featureFlags:{}});return a.registerAppPhase({phase:yt.nh.CRITICAL,signals:r,timeout:o?.critical||6e4}),a.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:s,timeout:o?.postCritical||1e4}),a.appPhases},g8=({type:e,action:t,criticalSignals:n})=>{e===Se.py.flyout&&t===Se.uk.update?n.push(xV.G.CONNECT_WITH_ANYONE_SHOWN):n.push(xV.G.CHAT_LIST_ITEMS_RENDERED)},h8=({context:{coreSettings:e,entityCommanding:t,loggerFactory:n}})=>{const i=n.newLogger("FlyoutPrewarmJob","apps-flyout"),{deviceInfo:a}=e.get(b.J.Platform);if(!a||!(0,Lx.E)(a))return i.debug("FlyoutPreWarmJobDisabledOnNonWin11"),[];const{enableFlyoutPrewarm:o,enableFlyoutOnExperienceWarm:r,enableMinimodePrewarm:s,enableMinimodeWindow:l}=e.get(b.J.Core);return i.infoToTelemetry?.(`enableFlyoutPrewarm ${o}, enableFlyoutOnExperienceWarm ${r}, enableMinimodePrewarm ${s}, enableMinimodeWindow ${l}`,"tfl_app_pre_warm"),l&&s?(i.log("MinimodePreWarmJobEnabled"),[{id:"flyout-prewarm-job",runOncePerId:!0,job:()=>(i.log("MinimodePrewarmJobInvoked"),t.deepLink.prewarmMinimode(C.D.MinimodePrewarmJob))}]):l||s?(i.log(`skipping flyout prewarm enableMinimodeWindow ${l} enableMinimodePrewarm ${s}`),[]):!o||r?(i.log("FlyoutPreWarmJobDisabled"),[]):(i.log("FlyoutPreWarmJobEnabled"),[{id:"flyout-prewarm-job",runOncePerId:!0,job:()=>(i.log("FlyoutPrewarmJobInvoked"),t.deepLink.prewarmFlyout(C.D.FlyoutPrewarmJob))}])},y8=({context:{coreSettings:e,entityCommanding:t,loggerFactory:n}})=>{const i=n.newLogger("FlyoutOnExperienceJob","apps-flyout"),{deviceInfo:a}=e.get(b.J.Platform);if(!a||!(0,Lx.E)(a))return i.debug("FlyoutExperienceWarmJobDisabledOnNonWin11"),[];const{enableFlyoutOnExperienceWarm:o,enableMinimodeWindow:r}=e.get(b.J.Core);return r?(i.debug("enableMinimodeWindow - skipping flyout prewarm"),[]):o?(i.debug("FlyoutOnExperienceWarmJobEnabled"),[{id:"flyout-on-experience-warm-job",runOncePerId:!0,job:()=>(i.debug("FlyoutOnExperienceWarmJobInvoked"),t.deepLink.prewarmFlyout(C.D.FlyoutOnExperienceWarmJob))}]):(i.debug("FlyoutOnExperienceWarmJobDisabled"),[])},v8=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(84274),n.e(393890),n.e(75298),n.e(152739),n.e(361845),n.e(253400),n.e(314991),n.e(128770),n.e(649800),n.e(714650),n.e(832961),n.e(649162),n.e(44025),n.e(732691),n.e(81),n.e(438152),n.e(448808),n.e(290718),n.e(875351),n.e(565168),n.e(826792),n.e(6605),n.e(630169),n.e(420266),n.e(91),n.e(896817),n.e(928362),n.e(652421),n.e(213629),n.e(796594),n.e(68021),n.e(600213),n.e(84215),n.e(57605),n.e(222020),n.e(540873),n.e(375387),n.e(947338),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(360134),n.e(357903),n.e(949636),n.e(281467),n.e(678342),n.e(412523),n.e(209674),n.e(126541),n.e(638108),n.e(270954),n.e(347076),n.e(931506),n.e(1626),n.e(923207),n.e(519889),n.e(183587),n.e(893197),n.e(592714),n.e(544706),n.e(119126),n.e(989903)]).then(n.bind(n,323709)),f8=()=>i8.windowFeatures||{},S8=()=>H.RG.FlyoutLaunch;const k8={id:"com.microsoft.teams.gallery",name:"GalleryApp",supportedEntities:[Se.py.gallery],supportedRenderModes:[Mt.S.Main],getDefaultCommand:()=>({type:Se.py.gallery,action:Se.uk.view}),windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},C8=e=>{if(b8(e))return w8(e)?{subNavEntity:T8(e),headerEntity:I8(e),startEntity:N8(e),mainEntity:E8(e),endEntity:A8(e)}:null},b8=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.gallery].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},w8=()=>!0,T8=()=>null,I8=()=>null,N8=()=>null,E8=({entity:e})=>e,A8=()=>null,_8=()=>Promise.all([n.e(933161),n.e(890962),n.e(830648),n.e(38965),n.e(450773),n.e(19753)]).then(n.bind(n,725377));function F8(){const e=()=>null;return{getAppViewEntities:C8,manifest:k8,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main){const e="gallery-app";n("ChunkLoadStarted",{chunkName:e});const{Gallery:t}=await(0,ac.mT)(_8,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(t,{})}return(0,gO.t)(e,{})}}}const D8=e=>{if(P8(e))return M8(e)?{subNavEntity:x8(e),headerEntity:R8(e),startEntity:j8(e),mainEntity:L8(e),endEntity:O8(e)}:null},P8=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=Boolean(Se.py.help===i),r=[Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},M8=()=>!0,x8=()=>null,R8=()=>null,j8=()=>null,L8=()=>null,O8=()=>null,$8="help",U8="viewHelpPersonalApp",B8="viewHelpComponent",W8={id:"com.microsoft.teams.help",name:"HelpApp",actors:[$8],supportedEntities:[Se.py.help,Se.py.whatsnewdialog],supportedRenderModes:[Mt.S.Modal,Mt.S.Main],windowFeatures:{minWidth:800,minHeight:600,width:800,height:600,offset:20,top:0,left:0}},H8=async({commandInput:e,requestContext:{executionContext:t,loggerFactory:n}})=>{const{command:{action:i,data:a}}=e,o=n.newLogger("HelpApp onCommandReceived","apps-help");if(e.command.actor!==$8)return void o.errorToTelemetry?.(`Command for actor '${e.command.actor}' cannot be handled by HelpApp.`,"help_on_command_received",void 0,!0);const{popOut:r,appId:s,tabEntityId:l,subEntityId:c}=a||{},d=r?ke.su.new:ke.su.flush;switch(i){case U8:let e;return e=c&&l?JSON.stringify({appId:s,tabEntityId:l,subEntityId:c}):l?JSON.stringify({appId:s,tabEntityId:l}):JSON.stringify({appId:s}),{entity:{id:e,action:Se.uk.view,type:Se.py.extensions,linkedEntity:{id:e,type:Se.py.extensions}},command:{visibilityState:ke.fe.show,stateTransition:d,correlation:{source:C.D.Nova}}};case B8:return{entity:{action:Se.uk.default,type:Se.py.help},command:{visibilityState:ke.fe.show,stateTransition:d,correlation:{source:C.D.Nova}},entityOptions:{contextType:t?.viewEntities?.mainEntity?.type,helpId:l,helpSubId:c}};default:o.errorToTelemetry?.(`Command action '${i}' is not supported at HelpApp.`,"help_on_command_received",void 0,!0)}},V8=({appRenderMode:e})=>{const t=new MV.H,n=[];if(e===Mt.S.Main)n.push(xV.G.HELP_APP_RENDERED);return t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:25e3}),t.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:[],timeout:1e4}),t.appPhases},G8=()=>Promise.all([n.e(613224),n.e(976612),n.e(730980)]).then(n.bind(n,715510)),z8=()=>n.e(524090).then(n.bind(n,26565)),q8=()=>W8.windowFeatures||{},J8=()=>H.RG.HelpAppLoaded;function Q8(){const e=()=>null;return{manifest:W8,onCommandReceived:H8,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{if(t===Mt.S.Modal){const e="whats-new-modal",o=a.newLogger(e,"apps-help");try{n("ChunkLoadStarted",{chunkName:e});const{WhatsNewViewsRenderer:a}=await(0,ac.mT)(G8,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(a,{appRenderMode:t})}catch(e){o.error(`chunk load failed with ${e}`)}}if(t===Mt.S.Main){const e="help-app",o=a.newLogger(e,"apps-help");try{n("ChunkLoadStarted",{chunkName:e});const{HelpViewRenderer:a}=await(0,ac.mT)(z8,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(a,{appRenderMode:t})}catch(e){o.error(`chunk load failed with ${e}`)}}return(0,gO.t)(e,{})},getAppPhases:V8,getAppViewEntities:D8,getAppWindowFeatures:q8,getCommandScenarioName:J8}}const K8={shouldAddEntitiesToWindowHistory:e=>e?.mainEntity?.type!==Se.py.identity,shouldRestoreClientToEntities:e=>e?.mainEntity?.type!==Se.py.identity},Y8=e=>{if(Z8(e))return e9(e)?{subNavEntity:t9(e),headerEntity:n9(e),startEntity:i9(e),mainEntity:a9(e),endEntity:o9(e)}:null},X8=({entity:e})=>({mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:"minimal"===e?.id&&e?.action===Se.uk.signin}}}),Z8=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.chats,Se.py.authrefreshdialog,Se.py.authaccounttransfer,Se.py.accountselectiondialog,Se.py.signoutNoDialog].includes(i),r=[Se.uk.default,Se.uk.view,Se.uk.update],s=n&&r.includes(n);return!!(a&&o&&s)},e9=()=>!0,t9=()=>null,n9=()=>null,i9=()=>null,a9=({entity:e})=>e,o9=()=>null,r9={id:"com.microsoft.teams.integrated-auth",name:"IntegratedAuthApp",actors:["identity"],supportedEntities:[Se.py.identity,Se.py.oauthcode,Se.py.authrefreshdialog,Se.py.accountselectiondialog,Se.py.authaccounttransfer,Se.py.signoutNoDialog],supportedRenderModes:[Mt.S.Main,Mt.S.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},s9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"resolveThirdPartyOauthCode"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"code"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"state"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolveThirdPartyOauthCode"},arguments:[{kind:"Argument",name:{kind:"Name",value:"code"},value:{kind:"Variable",name:{kind:"Name",value:"code"}}},{kind:"Argument",name:{kind:"Name",value:"state"},value:{kind:"Variable",name:{kind:"Name",value:"state"}}}]}]}}]},l9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsIntegratedAuthGetActiveCallsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hasActiveCalls"}}]}}]},c9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsIntegratedAuthGetAccountsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"homeAccountId"}}]}}]}}]},d9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthAccountTransferMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"launchAccountTransfer"}}]}}]},u9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthRemoveAuthenticatedUserMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"reason"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeAuthenticatedUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"reason"},value:{kind:"Variable",name:{kind:"Name",value:"reason"}}},{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}]}]}}]},m9=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},entityOptions:a},requestContext:{client:o}}=e;if(n===Se.py.oauthcode&&i===Se.uk.update)try{return await o.mutate({mutation:s9,variables:{code:a?.code||null,state:a?.state||null}}),{entity:{type:Se.py.default,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:t.command.correlation}}}catch{return}else if(n===Se.py.authaccounttransfer&&i===Se.uk.view){const e={entity:{type:Se.py.authaccounttransfer,action:Se.uk.error},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:t.command.correlation}},n={id:(0,vl.pW)(),scenarioName:H.RG.AuthWebAccountTransfer,source:"apps_integrated_auth"},[i,a]=(0,yl.OU)({options:{correlation:n},source:"apps_integrated_auth",scenarioName:H.RG.AuthWebAccountTransfer,subContext:"launchAccountTransferInteractively",eventData:["launch_account_transfer_interactively"],startWithoutScenario:!0});try{const{data:t}=await o.query({query:l9,fetchPolicy:"network-only",nextFetchPolicy:"cache-first"});if(i.addScenarioMark(H.ck.AuthAccountTransferGetActiveCalls),t.hasActiveCalls)return i.addScenarioMark(H.ck.AuthAccountTransferUserHasActiveCall),a(),{...e,entityOptions:{hasActiveCalls:!0}}}catch(t){return a({error:t}),e}try{return await o.mutate({mutation:d9,context:{correlation:n}}),void a()}catch{return a(),e}}else if(n===Se.py.signoutNoDialog&&i===Se.uk.update){const e={id:(0,vl.pW)(),scenarioName:H.RG.AuthWebDeeplinkSignout,source:"apps_integrated_auth"},[t,n]=(0,yl.OU)({options:{correlation:e},source:"apps_integrated_auth",scenarioName:H.RG.AuthWebDeeplinkSignout,subContext:"signoutViaDeeplink",eventData:["signout_no_dialog_deeplink"]});try{const e=await async function(e,t){const n=await g9(e,!1),i=n?.data?.authenticationUsers;return i?.length>0?(t.addEventData([`nonPrimaryUserAccounts: ${i.length}`]),i):(t.addEventData(["nonPrimaryUserAccounts: 0"]),[])}(o,t),i=await g9(o,!0);t.addEventData(["primaryUser:Fetched"]);const a=i?.data?.authenticationUsers;return a?.length>0&&t.addEventData([`primaryUserAccounts:${a?.length}`]),async function(e,t,n,i){i.addEventData(["signoutStart"]);for(const n of t)p9(e,n,i);for(const t of n)p9(e,t,i)}(o,e,a,t),void n()}catch(e){return void n({error:e})}}return t};async function p9(e,t,n){n.addEventData(["signoutMutationStart"]),t.id===t.homeAccountId?(n.addEventData([`HomeUser:${t.id}.Signout`]),await e.mutate({mutation:u9,variables:{reason:"SignoutDeeplink",userContextId:t.id}})):n.addEventData(["GuestUser:SkippedSignout"])}async function g9(e,t){return e.query({query:c9,fetchPolicy:"network-only",nextFetchPolicy:"cache-first",variables:{filter:{isPrimaryUser:t}}})}var h9;!function(e){e.GoogleAuthDisabled="google-auth-disabled",e.SignoutDeeplinkDisabled="signout-auth-deeplink-disabled"}(h9||(h9={}));const y9=[{filter:"/l/auth/google",execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{const{enableDesktopExternalBrowserGoogleAuth:n}=t.get(b.J.Auth);if(!n)return Promise.reject({message:h9.GoogleAuthDisabled});const{state:i,code:a}=function(e){const t=e.search,n=new URLSearchParams(t),i=n.get("state");return{code:n.get("code"),state:i}}(e);return Promise.resolve({entityCommand:{entity:{type:Se.py.oauthcode,action:Se.uk.update,id:(0,Re.v4)()},command:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{id:(0,Re.v4)(),startTimestamp:Date.now(),source:C.D.GoogleAuthOnBeforeDeepLinkParsed}},entityOptions:{code:a,state:i}},metadata:{allowAnonymous:!1}})}},{filter:"/l/auth/signout",execute:({context:{coreSettings:e}})=>{const{enableSignoutDeeplink:t}=e.get(b.J.Auth);return t?Promise.resolve({entityCommand:{entity:{type:Se.py.signoutNoDialog,action:Se.uk.update,id:(0,Re.v4)()},command:{visibilityState:ke.fe.show,stateTransition:ke.su.none,correlation:{id:(0,Re.v4)(),startTimestamp:Date.now(),source:C.D.SignoutOnBeforeDeepLinkParsed}}},metadata:{allowAnonymous:!1}}):Promise.reject({message:h9.SignoutDeeplinkDisabled})}}],v9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"initializeAccounts"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"initializeAccounts"}}]}}]},f9=({context:{authenticationService:e,client:t,coreSettings:n,entityCommanding:i}})=>{const a={scenarioName:H.RG.AuthWebInitializeAccounts,source:"integrated-auth-app",id:(0,vl.pW)()},[o,r]=(0,yl.OU)({scenarioName:H.RG.AuthWebInitializeAccounts,subContext:"onExperienceWarm",source:"integrated-auth-app",options:{correlation:a}}),{enableLazyInitializeAccounts:s,enableCrossTabLogout:l}=n.get(b.J.Auth);if(!s)return r({message:"LazyInitializeAccountsJobDisabled"}),[];if(l&&e){const t=e.getCrossTabCallbacks?.();t&&t.contextChangeSubscribe(i)}return o.addScenarioMark(H.ck.AuthWebInitializeAccountsJobQueued),[{id:"lazy-initialize-accounts-job",runOncePerId:!0,job:async()=>{o.addScenarioMark(H.ck.AuthWebInitializeAccountsJobStart);try{t.mutate({mutation:v9,context:{correlation:a}})}catch(e){r({error:e})}}}]},S9=(e,t)=>({overrideType:GE.OverrideIntent,intent:{...t,entityCommand:{...t.entityCommand,entity:{id:`${t.entityCommand.command.layoutMode}`,type:Se.py.identity,action:Se.uk.error},entityOptions:{error:e}}}}),k9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthAuthenticateOrGetUserMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"allowAnon"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"loginHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tenantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}},type:{kind:"NamedType",name:{kind:"Name",value:"CrossCloudMeetingAuthDetails"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplink"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticateOrGetUser"},arguments:[{kind:"Argument",name:{kind:"Name",value:"allowAnon"},value:{kind:"Variable",name:{kind:"Name",value:"allowAnon"}}},{kind:"Argument",name:{kind:"Name",value:"loginHint"},value:{kind:"Variable",name:{kind:"Name",value:"loginHint"}}},{kind:"Argument",name:{kind:"Name",value:"tenantId"},value:{kind:"Variable",name:{kind:"Name",value:"tenantId"}}},{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"meetingDetails"},value:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}}},{kind:"Argument",name:{kind:"Name",value:"deeplink"},value:{kind:"Variable",name:{kind:"Name",value:"deeplink"}}},{kind:"Argument",name:{kind:"Name",value:"prioritizeUserContextId"},value:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]},C9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthAuthenticateOrGetUserForMeetingMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"allowAnon"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"loginHint"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"tenantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}},type:{kind:"NamedType",name:{kind:"Name",value:"CrossCloudMeetingAuthDetails"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"deeplink"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticateOrGetUserForMeeting"},arguments:[{kind:"Argument",name:{kind:"Name",value:"loginHint"},value:{kind:"Variable",name:{kind:"Name",value:"loginHint"}}},{kind:"Argument",name:{kind:"Name",value:"tenantId"},value:{kind:"Variable",name:{kind:"Name",value:"tenantId"}}},{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"meetingDetails"},value:{kind:"Variable",name:{kind:"Name",value:"meetingDetails"}}},{kind:"Argument",name:{kind:"Name",value:"deeplink"},value:{kind:"Variable",name:{kind:"Name",value:"deeplink"}}},{kind:"Argument",name:{kind:"Name",value:"prioritizeUserContextId"},value:{kind:"Variable",name:{kind:"Name",value:"prioritizeUserContextId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"cloud"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]},b9={filter:"*",execute:async({intent:e,context:{client:t,coreSettings:n,scenarioFactory:i}})=>{const{authTelemetry:a,closeTelemetry:o}=((e,t)=>{const{scenarioCorrelation:{correlation:n,clientLaunchId:i}}=t;let a,o,r;t.shouldRenderContent&&(a=t.entityCommand.command.layoutMode,o=t.entityCommand.entity.type,r=t.entityCommand.entity.action);const s={id:n?.id??(0,Re.v4)(),source:n?.source??"onBeforeIntentAuth",scenarioName:n?.scenarioName??H.RG.AuthWebUser},l=s.scenarioName&&i&&e.findScenarioByNameAndId(s.scenarioName,i)||void 0,[c,d]=(0,yl.F9)({correlation:s,subContext:"onBeforeIntentAuthenticated",scenario:l,eventData:[`layoutMode:${a}`,`entityType:${o}`,`action:${r}`,`isNRC:${t.shouldRenderContent}`,`intentMetadata:[anon:${+t.metadata.allowAnonymous},allowXTenantAccess:${t.metadata.allowXTenantAccess??void 0},  tid: ${+!!t.metadata.tenantId}, uid: ${+!!t.metadata.userContextId}, loginHint:${+!!t.metadata.loginHint}]`]});return c.appendScenarioEventData({targetedUser:t.metadata.userContextId,target:t.metadata.tenantId,allowAnon:t.metadata.allowAnonymous,allowXTenantAccess:t.metadata.allowXTenantAccess}),c.addScenarioMark("auth_web_app_on_before_intent_auth_start"),{authTelemetry:c,closeTelemetry:d}})(i,e);if(!n.get(b.J.Auth).enableIntegratedAuthApp)return a.addScenarioMark("auth_web_app_on_before_intent_auth_stop",{message:"enableIntegratedAuthApp is disabled"}),o({reason:"enableIntegratedAuthApp is disabled"}),{overrideType:GE.NoOverride};const{enableAuthenticateOrGetUserForMeeting:r,enableMAIntentHandling:s,enableCCM:l,isWebClientType:c,enableTenantSwitchQsp:d,enableAccountSelectionOnPreMeetingJoin:u,disableAllowXTenantAccessQSP:m}=n.get(b.J.Auth);let p;l&&(p=(e=>{if(e.shouldRenderContent&&"callingdeeplink"===e.entityCommand.entity.type){const t=e.entityCommand.entityOptions;return(0,xe.KH)(t)}})(e));const g=c||u,h=function(e,t,n,i){if(!e||!t)return;const a=new URLSearchParams;if(!i)return a;try{const e=Object.entries(i);for(const[t,n]of e)a.append(t.toLowerCase(),n)}catch{return n.addEventData([`fail to getQsParamFromUrl:${i}`]),new URLSearchParams}return a}(!!c,!!d,a,t.ctx?.platformService?.queryStringParameters),y=h?.get("tenantid"),v=h?.get("loginhint")||h?.get("login_hint"),f=e.metadata.allowXTenantAccess&&!m?void 0:e.metadata.tenantId||y,S=e.metadata.loginHint||v,k=g?e.metadata.deepLink:void 0;let C;a.addEventData(["enableCCM:"+ +!!l,"meetingDetails:"+ +!!p,`allowXTenantAccess:${e.metadata.allowXTenantAccess}`,`tenantIdQsp:${y}`,"loginHintQsp:"+ +!!v]);const w={allowAnon:e.metadata.allowAnonymous,allowXTenantAccess:e.metadata.allowXTenantAccess,tenantId:f,loginHint:S,userContextId:e.metadata.userContextId,meetingDetails:p,deeplink:k,prioritizeUserContextId:e.metadata.prioritizeUserContextId},T={correlation:e.scenarioCorrelation.correlation};try{let i;if(r&&(e=>e.shouldRenderContent&&("callingdeeplink"===e.entityCommand.entity.type||"meetings"===e.entityCommand.entity.type))(e)){const{data:{authenticateOrGetUserForMeeting:e}}=await t.mutate({mutation:C9,variables:w,context:T});i=e}else{const{data:{authenticateOrGetUser:e}}=await t.mutate({mutation:k9,variables:w,context:T});i=e}if(i?.isAuthenticated)return((e,t,n,i,a,o)=>{e.addEventData([`user:1,role:${a}`]),e.addScenarioMark("auth_web_app_on_before_intent_auth_stop",{targetedUser:t.metadata.userContextId,accountId:i,target:t.metadata.tenantId,tenantId:n,allowAnon:t.metadata.allowAnonymous,allowXTenantAccess:t.metadata.allowXTenantAccess,message:`user:${i},role:${a},type:${o}`}),a===ys.w4.Anonymous&&e.recordAuthUserBiTelemetry(i,{scenario:uc.dX.authAnonLaunch})})(a,e,i.profile.tenantId,i.id,i.role,i.type),((e,t)=>{const{enableAccountSelectionOnPreMeetingJoin:n,buildCloud:i}=t.get(b.J.Auth);return!!n&&i!==e})(i.cloud,n)?{overrideType:GE.OverrideCloud,cloud:i.cloud}:{overrideType:GE.OverrideUserContext,userContextId:i.id}}catch(e){C=e.graphQLErrors?.[0]?.originalError,function(e,t,n,i){i.addScenarioMark("auth_web_app_user_query_fails",{error:{...e,correlationId:i.correlation.id,errorCode:e?.code||t||"NoErrorCodeFoundInOnBeforeIntentAuthentication",message:e?.message||n}})}(C,e.code,e.message,a)}return a.addEventData([`user:0,operationType:cold,isMAIntentHandlingEnabled:${s}`]),((e,t,n,i)=>{if(i.addScenarioMark("auth_web_app_on_before_intent_auth_new_intent"),!e.shouldRenderContent)return{overrideType:GE.NoOverride};if(t&&!0===t.redirectToEndPage)return S9(t,e);let a,o=t,r=e.entityCommand.command,s=e.entityCommand.command.layoutMode===ke.lO.minimal?Se.uk.signin:Se.uk.default;if(n&&e.metadata.tenantId){const n='Unexpected error value: { message: "Multiple users found in cache with same tenantId", errorCode: "MultipleUsersPresentWithSpecifiedIdentifier" }'===t?.message;a=n?e.metadata.tenantId:"",o=n?void 0:t,i.addEventData(["showAccountPicker:1","tenantIdFromOptions:"+ +!!a]),i.addScenarioMark("auth_web_app_on_before_intent_auth_show_account_picker",{tenantId:a}),r={...r,visibilityState:ke.fe.show,stateTransition:ke.su.new,layoutMode:ke.lO.focus},s=Se.uk.list}i.addScenarioMark("auth_web_app_on_before_intent_auth_stop");const l=e?.entityCommand?.entity?.type;return{overrideType:GE.OverrideIntent,intent:{...e,entityCommand:{...e.entityCommand,command:r,entity:{id:`${e.entityCommand.command.layoutMode}`,type:Se.py.identity,action:s,linkedEntity:e.entityCommand.command.layoutMode===ke.lO.focus?{type:e.entityCommand.entity.type,action:e.entityCommand.entity.action,id:e.entityCommand.entity.id??e.entityCommand.command.correlation.id}:void 0},entityOptions:{error:o,tenantId:a,hideTitleAndOptions:l===Se.py.meetings||l===Se.py.callingdeeplink||l===Se.py.channels}}}}})(e,C,s,a)}};const w9=e=>{const{entity:t}=e;return t.type!==Se.py.identity?H.RG.EntityCommand:H.RG.AuthLaunch},T9="identity",I9="signOut",N9="addNewAccount",E9="switchAccount",A9="switchTenants",_9="manageTenant",F9="openMeControl",D9=()=>({actor:T9,action:I9}),P9=e=>({actor:T9,action:E9,data:{targetAccountId:e}}),M9=e=>({actor:T9,action:A9,data:{targetTenantId:e}}),x9=()=>({actor:T9,action:F9}),R9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsIntegratedAuthSwitchAccountMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"switchAccount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}}]}]}}]},j9=async({commandInput:e,requestContext:{client:t,coreSettings:n}})=>{const{command:i}=e,a={scenarioName:H.RG.AuthCommandReceived,source:i.data?.commandSource??C.D.AuthApp,id:(0,vl.pW)()},o=i.data?.targetAccountId||i.data?.targetTenantId,[r,s]=(0,yl.OU)({scenarioName:H.RG.AuthCommandReceived,subContext:"auth-command",source:"integrated-auth-app",options:{correlation:a},eventData:[`command: ${i.action}`],scenarioEventData:{targetedUser:o}});let l;if(!r9.actors.includes(i.actor)){return void s({error:{name:"unsupported_target",message:"target is unsupport",correlationId:a.id,context:"on_command_received",subContext:"integrated_auth",errorCode:"unsupported_target"}})}const{enableModalForAddAccount:c,disableAddAccount:d}=n.get(b.J.Auth),u=c||d?Se.py.identitydialog:Se.py.identity,m=c||d?ke.su.extend:ke.su.new;switch(i.action){case E9:if(r.addScenarioMark("auth_switch_account_mutation"),!o){s({error:{name:"missing_parameter",message:"Account Id missing in switch account command",correlationId:a.id,context:"on_command_received",subContext:"integrated_auth",errorCode:"missing_parameter"}});break}return s(),void t.mutate({mutation:R9,variables:{userContextId:o},context:{correlation:a}});case A9:if(r.addScenarioMark("auth_switch_tenant_mutation"),!o){s({error:{name:"missing_parameter",message:"Account Id missing in switch tenant command",correlationId:a.id,context:"on_command_received",subContext:"integrated_auth",errorCode:"missing_parameter"}});break}return s(),void t.mutate({mutation:R9,variables:{userContextId:o},context:{correlation:a}});case _9:{r.addScenarioMark("auth_manage_org_mutation");const e={source:C.D.AuthApp};return l={entity:{id:RJ.Y.Accounts,type:Se.py.settingsstore,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:e},entityOptions:{correlation:e}},s(),l}case N9:{r.addScenarioMark("auth_add_new_account_command");const e={source:i.data?.commandSource??C.D.AuthApp};return l={entity:{type:u,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:m,layoutMode:ke.lO.focus,correlation:e},entityOptions:{correlation:e}},s(),l}case I9:return r.addScenarioMark("auth_sign_out_dialog_command"),l={entity:{type:Se.py.signoutdialog,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.AuthApp}}},s(),l;case F9:return(0,yl.OU)({scenarioName:H.RG.AuthWebMeControlRender,subContext:"auth-command",source:"integrated-auth-app",options:{correlation:{scenarioName:H.RG.AuthWebMeControlRender,source:"integrated-auth-app",id:(0,vl.pW)()}}}),r.addScenarioMark("auth_open_mecontrol_command"),void s();default:s({error:{name:"invalid_command",message:`command is invalid ${i.action}`,correlationId:a.id,context:"on_command_recieved",subContext:"integrated_auth",errorCode:"invalid_command"}})}},L9=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(84274),n.e(393890),n.e(75298),n.e(152739),n.e(361845),n.e(253400),n.e(314991),n.e(128770),n.e(649800),n.e(714650),n.e(832961),n.e(649162),n.e(44025),n.e(732691),n.e(81),n.e(438152),n.e(448808),n.e(290718),n.e(129462),n.e(875351),n.e(565168),n.e(826792),n.e(6605),n.e(630169),n.e(420266),n.e(91),n.e(896817),n.e(785695),n.e(928362),n.e(652421),n.e(213629),n.e(796594),n.e(68021),n.e(600213),n.e(84215),n.e(57605),n.e(222020),n.e(540873),n.e(375387),n.e(947338),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(360134),n.e(357903),n.e(949636),n.e(281467),n.e(678342),n.e(412523),n.e(209674),n.e(126541),n.e(638108),n.e(270954),n.e(347076),n.e(931506),n.e(1626),n.e(923207),n.e(519889),n.e(183587),n.e(893197),n.e(592714),n.e(544706),n.e(119126),n.e(883971),n.e(469794),n.e(696021)]).then(n.bind(n,363212));const O9={id:"com.microsoft.teams.meet",name:"MeetApp",getLocalizedName:async e=>(await e.waitForNamespace("meetForWork"),e.stringTranslate("meetForWork","meet_app_name")),actors:[h$],supportedEntities:[Se.py.meet],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar]},$9=e=>{if(U9(e))return B9(e)?{subNavEntity:W9(e),headerEntity:H9(e),startEntity:V9(e),mainEntity:G9(e),endEntity:z9(e)}:null},U9=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.meet].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},B9=()=>!0,W9=()=>null,H9=({entity:e,coreSettings:t})=>{const{enableHeaderSlotInMeet:n}=t?.get(b.J.Meet)||{};return n?e:null},V9=()=>null,G9=({entity:e})=>e,z9=({contextEntity:e})=>e&&e.action&&e.type===Se.py.meetingcollaboration?e:null,q9=()=>({mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!0}}}),J9={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}},Q9=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("MeetApp onCommandReceived","apps-meet");if(e.command.actor===h$)return n===y$?{entity:{type:Se.py.meet,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}}:void i.error(`Command action '${n}' is not supported at MeetApp.`);i.error(`Command for actor '${e.command.actor}' cannot be handled by MeetApp.`)},K9=({appRenderMode:e})=>{const t=new MV.H;return e!==Mt.S.Main||t.registerAppPhase({phase:yt.nh.CRITICAL,signals:[xV.G.MEET_APP_RENDERED],timeout:1e4}),t.appPhases},Y9="a63f7012-8cc9-42d5-99c3-e35f526fab17",X9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMeetPinM365ApplicationMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"input"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PinM365ApplicationInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"pinM365Application"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"Variable",name:{kind:"Name",value:"input"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsMeetPinM365ApplicationFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsMeetPinM365ApplicationFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationPinStatusUpdateResult"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"M365ApplicationPinStatusUpdateResult"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"updatedM365Applications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"platformType"}},{kind:"Field",name:{kind:"Name",value:"pinnedIndex"}}]}}]}}]}}]}.definitions]},Z9={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMeetTriggerFetchBeforeEnterMeetAppMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerFetchBeforeEnterMeetApp"}}]}}]},e5=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i}},requestContext:a,requestContext:{client:o,userBiService:r,coreSettings:s}}=e,l=a.loggerFactory.newLogger("CallingOnBeforeCommandHandled","apps-meet");if(t5(n,i)&&((e,t)=>{const{enableFetchBeforeEnterMeetApp:n}=t.get(b.J.Meet);n&&e.mutate({mutation:Z9})})(o,s),n5(n,i))try{const e=await(o?.mutate({mutation:X9,variables:{...t,input:{applicationID:Y9}},fetchPolicy:"no-cache"}));if(e){const t=e.data?.pinM365Application?.updatedM365Applications?.[0],{id:n,pinnedIndex:i=null}=t||{};n===Y9&&null!==i&&i>=0&&i5(r,l)}}catch(e){return l?.errorToTelemetry?.("[MeetPinM365ApplicationMutation] failed","calling_deeplink_navigation",e?.code),Promise.resolve(t)}return Promise.resolve(t)},t5=(e,t)=>e===Se.py.meet&&(t===Se.uk.list||t===Se.uk.default),n5=(e,t)=>e===Se.py.meet&&t===Se.uk.pin,i5=(e,t)=>{if(!e?.recordPanelAction)return;const n={appName:"MeetApp",panelType:dA.wh.pinMeet,panelRegion:dA.Ai.popover,moduleName:dA.rA.pinMeetCoachmarkCTA,moduleType:dA.PO.button,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenarioType:dA.Yu.pinMeet};e.recordPanelAction(n,t)},a5=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(120894),n.e(666384),n.e(253400),n.e(397833),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(255279),n.e(869026),n.e(30577),n.e(704043),n.e(729265),n.e(65923),n.e(577767),n.e(908285),n.e(801870),n.e(32705),n.e(101614),n.e(69599),n.e(141377),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(241070),n.e(600213),n.e(916297),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(799855),n.e(269518),n.e(48523),n.e(206887),n.e(613899),n.e(656436),n.e(749666),n.e(198610),n.e(266004),n.e(158529),n.e(868123)]).then(n.bind(n,977114)),o5=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(120894),n.e(666384),n.e(253400),n.e(397833),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(255279),n.e(869026),n.e(30577),n.e(704043),n.e(729265),n.e(65923),n.e(577767),n.e(908285),n.e(801870),n.e(32705),n.e(101614),n.e(69599),n.e(141377),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(241070),n.e(600213),n.e(916297),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(799855),n.e(269518),n.e(48523),n.e(206887),n.e(613899),n.e(656436),n.e(749666),n.e(198610),n.e(266004),n.e(158529),n.e(868123)]).then(n.bind(n,450812));function r5(){const e=()=>null;return{eventHandlers:J9,getAppPhases:K9,getAppViewEntities:$9,getAppViewEntitiesProps:q9,getPlatformAppIdForEntity:e=>e.type===Se.py.meet?Y9:void 0,manifest:O9,onCommandReceived:Q9,render:async({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a})=>{if(t===Mt.S.Main||t===Mt.S.HorizontalBar){const e="meet-app";i("ChunkLoadStarted",{chunkName:e});const{enableEntityMoreInfo:o}=n.get(b.J.Core),r=({children:e})=>(0,gO.t)(hO.Fragment,{children:e});t===Mt.S.Main&&(a.newScenario(H.RG.MeetAppRender),a.newScenario(H.RG.MeetAppUpcomingRender),a.newScenario(H.RG.MeetAppRecentRender));const{Meet:s}=await(0,ac.mT)(a5,e,a),{LPC:l}=o?{LPC:r}:await(0,ac.mT)(o5,e,a),c=o?r:rJ.p3;return i("ChunkLoadSucceeded",{chunkName:e}),t===Mt.S.Main&&(a.markStep(H.RG.MeetAppRender,H.ck.MeetAppRenderWebpackLoaded),a.markStep(H.RG.MeetAppUpcomingRender,H.ck.MeetAppUpcomingRenderWebpackLoaded),a.markStep(H.RG.MeetAppRecentRender,H.ck.MeetAppRecentRenderWebpackLoaded)),(0,gO.t)(l,{children:(0,gO.t)(c,{children:(0,gO.t)(s,{appRenderMode:t})})})}return(0,gO.t)(e,{})},getCommandScenarioName:s5,onBeforeCommandHandled:e5}}const s5=()=>H.RG.MeetAppLaunch,l5=e=>{if(c5(e))return d5(e)?{subNavEntity:u5(e),headerEntity:m5(e),startEntity:p5(e),mainEntity:g5(e),endEntity:h5(e)}:null},c5=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.attendancereport,Se.py.meetinganalytics].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},d5=()=>!0,u5=()=>null,m5=({entity:e})=>e,p5=()=>null,g5=({entity:e})=>e,h5=()=>null,y5={id:"com.microsoft.teams.meetinganalytics",name:"MeetingAnalytics",supportedEntities:[Se.py.attendancereport,Se.py.meetinganalytics],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar],getDefaultCommand:()=>({type:Se.py.meetinganalytics,action:Se.uk.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}},v5=()=>Promise.all([n.e(193180),n.e(463781),n.e(681896),n.e(65537),n.e(120894),n.e(457535),n.e(564223),n.e(39729),n.e(518456),n.e(418904),n.e(213629),n.e(796594),n.e(893829),n.e(125136),n.e(359584),n.e(298368)]).then(n.bind(n,893080)),f5=()=>y5.windowFeatures||{};function S5(){const e=()=>null;return{getAppViewEntities:l5,getAppWindowFeatures:f5,manifest:y5,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main||t===Mt.S.HorizontalBar){const e="meeting-analytics-app";n("ChunkLoadStarted",{chunkName:e});const{MeetingAnalyticsRenderer:a}=await(0,ac.mT)(v5,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(ez.f,{namespaces:["meetingAnalytics"],loaderRenderer:null,children:(0,gO.t)(a,{appRenderMode:t})})}return(0,gO.t)(e,{})}}}const k5=e=>{if(C5(e))return b5(e)?{subNavEntity:w5(e),headerEntity:T5(e),startEntity:I5(e),mainEntity:N5(e),endEntity:E5(e)}:null},C5=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.meetingrecap].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},b5=()=>!0,w5=()=>null,T5=()=>null,I5=()=>null,N5=({entity:e})=>e,E5=()=>null,A5={id:"com.microsoft.teams.meeting-recap-chiclet",name:"MeetingRecapChiclet",supportedEntities:[Se.py.meetingrecapchiclet],supportedRenderModes:[Mt.S.Main],getDefaultCommand:()=>({type:Se.py.meetingrecapchiclet,action:Se.uk.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}},_5=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(253400),n.e(553486),n.e(933161),n.e(540003),n.e(663276),n.e(869026),n.e(30577),n.e(752798),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(850967),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(34671),n.e(230050),n.e(799855),n.e(269518),n.e(311896),n.e(133963),n.e(294226)]).then(n.bind(n,768193)),F5=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(253400),n.e(553486),n.e(933161),n.e(540003),n.e(663276),n.e(869026),n.e(30577),n.e(752798),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(850967),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(34671),n.e(230050),n.e(799855),n.e(269518),n.e(311896),n.e(133963),n.e(294226)]).then(n.bind(n,450812)),D5=()=>A5.windowFeatures||{};function P5(){const e=()=>null;return{getAppViewEntities:k5,getAppWindowFeatures:D5,manifest:A5,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,coreSettings:a})=>{if(t===Mt.S.Main){const{MeetingRecapChicletRenderer:e}=await(async(e,t)=>{const n="meeting-recap-chiclet-app";t("ChunkLoadStarted",{chunkName:n});const[{MeetingRecapChicletRenderer:i},{LPC:a}]=await Promise.all([(0,ac.mT)(_5,n,e),(0,ac.mT)(F5,n,e)]);return t("ChunkLoadSucceeded",{chunkName:n}),{MeetingRecapChicletRenderer:i,LPC:a}})(i,n),{enableEntityMoreInfo:t}=a.get(b.J.Core),o=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),{LPC:r}=t?{LPC:o}:await(0,ac.mT)(F5,"meeting-recap-chiclet-app",i),s=t?o:rJ.p3;return(0,gO.t)(ez.f,{namespaces:["meetingRecap"],loaderRenderer:null,children:(0,gO.t)(r,{children:(0,gO.t)(s,{children:(0,gO.t)(e,{})})})})}return(0,gO.t)(e,{})}}}const M5=e=>{if(x5(e))return R5(e)?{subNavEntity:j5(e),headerEntity:L5(e),startEntity:O5(e),mainEntity:$5(e),endEntity:U5(e)}:null},x5=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.meetingrecap].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},R5=()=>!0,j5=()=>null,L5=({entity:e})=>e,O5=()=>null,$5=({entity:e})=>e,U5=({contextEntity:e})=>e&&e.action&&e.type===Se.py.meetingcollaboration?e:null,B5={id:"com.microsoft.teams.meeting-recap",name:"MeetingRecap",supportedEntities:[Se.py.meetingrecap,Se.py.meetingrecaptab],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar],getDefaultCommand:()=>({type:Se.py.meetingrecap,action:Se.uk.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}},W5="deep-link";var H5,V5,G5,z5;!function(e){e.recapMeeting="/l/meetingrecap"}(H5||(H5={})),function(e){e.FeatureNotEnabled="recap_on_before_deep_link_parsed_feature_not_enabled_error",e.InvalidContext="recap_on_before_deep_link_parsed_invalid_context_error"}(V5||(V5={})),function(e){e.FeatureNotEnabled="Feature for parsing recap deep links in T2.1 is not enabled",e.InvalidContext="Parsed recap deep link does not contain valid context query param"}(G5||(G5={})),function(e){e.ICalUid="iCalUid",e.ThreadId="threadId",e.timestamp="timestamp",e.defaultRightTab="defaultRightTab",e.organizerId="organizerId",e.tenantId="tenantId",e.meetingType="meetingType",e.recordingId="recordingId",e.subType="subType",e.defaultFocusArea="defaultFocusArea",e.disablePopout="disablePopout"}(z5||(z5={}));const q5=({deeplinkUrl:e,parsedDeeplinkHash:t,preferredCommandInput:n,context:{loggerFactory:i}})=>{const a=i.newLogger("MeetingRecapApp onBeforeDeeplinkParsed","apps-meeting-recap");if(t?.search){const{pathname:e}=t,n=e.split("/")[2];return Promise.resolve({entityCommand:{entity:{type:Se.py.meetingrecap,action:Se.uk.view,id:n},command:{stateTransition:ke.su.new,visibilityState:ke.fe.show},entityOptions:{subType:W5,threadId:n}},metadata:{allowAnonymous:!1}})}const{searchParams:o}=e,r=o.get(z5.ThreadId)||"",s=o.get(z5.ICalUid)||"",l=o.get(z5.timestamp),c=o.get(z5.defaultRightTab),d=o.get(z5.organizerId),u=o.get(z5.tenantId),m=o.get(z5.meetingType),p=o.get(z5.recordingId),g=o.get(z5.subType)||"",h=o.get(z5.defaultFocusArea),y="true"===o.get(z5.disablePopout);if(!Boolean(r&&s))throw a.errorToTelemetry?.(G5.InvalidContext,V5.InvalidContext),Error(G5.InvalidContext);return Promise.resolve({entityCommand:{entity:{type:Se.py.meetingrecap,action:Se.uk.view,id:r},command:{stateTransition:y?ke.su.forceFlush:n?.stateTransition??ke.su.new,visibilityState:n?.visibilityState??ke.fe.show},entityOptions:{subType:g?`${W5}-${g}`:W5,externalEntityKey:s,threadId:r,timestamp:l,defaultRightTab:c,organizerId:d,tenantId:u,meetingType:m,recordingId:p,defaultFocusArea:h}},metadata:{allowAnonymous:!1}})},J5=[{filter:H5.recapMeeting,execute:q5},{filter:(e,t)=>Boolean(e.hash)&&(t?.pathname||"").startsWith("/meetingrecap/"),execute:q5}],Q5="meeting-recap-app",K5=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(84274),n.e(393890),n.e(65537),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(361845),n.e(120894),n.e(253400),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(869026),n.e(30577),n.e(669491),n.e(760818),n.e(434874),n.e(138830),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(958163),n.e(241070),n.e(625402),n.e(274),n.e(758354),n.e(236239),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(34671),n.e(799855),n.e(269518),n.e(311896),n.e(414720),n.e(656436),n.e(749666),n.e(198610),n.e(450440),n.e(957960)]).then(n.bind(n,462074)),Y5=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(84274),n.e(393890),n.e(65537),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(361845),n.e(120894),n.e(253400),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(869026),n.e(30577),n.e(669491),n.e(760818),n.e(434874),n.e(138830),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(958163),n.e(241070),n.e(625402),n.e(274),n.e(758354),n.e(236239),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(34671),n.e(799855),n.e(269518),n.e(311896),n.e(414720),n.e(656436),n.e(749666),n.e(198610),n.e(450440),n.e(957960)]).then(n.bind(n,238359)),X5=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(84274),n.e(393890),n.e(65537),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(361845),n.e(120894),n.e(253400),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(869026),n.e(30577),n.e(669491),n.e(760818),n.e(434874),n.e(138830),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(958163),n.e(241070),n.e(625402),n.e(274),n.e(758354),n.e(236239),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(34671),n.e(799855),n.e(269518),n.e(311896),n.e(414720),n.e(656436),n.e(749666),n.e(198610),n.e(450440),n.e(957960)]).then(n.bind(n,450812)),Z5=()=>B5.windowFeatures||{};function e7(){const e=()=>null;return{getAppViewEntities:M5,getAppWindowFeatures:Z5,manifest:B5,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,coreSettings:a,entity:o})=>{i.cancelExistingAndCreateScenario(H.RG.MrNavigateSkeleton,"abandon",1e4);const{enableEntityMoreInfo:r}=a.get(b.J.Core),s=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),l=r?s:rJ.p3,c=e=>e?{LPC:s}:(0,ac.mT)(X5,Q5,i),{isRecapInPopout:d}=a.get(b.J.MeetingRecap);if(Se.uk.default===o.action){if(t===Mt.S.Main){const{enableEntityMoreInfo:e}=a.get(b.J.Core);n("ChunkLoadStarted",{chunkName:Q5});const[{IntelligentRecap:t},{LPC:o}]=await Promise.all([(0,ac.mT)(K5,Q5,i),c(!!e)]);return n("ChunkLoadSucceeded",{chunkName:Q5}),(0,gO.t)(ez.f,{namespaces:["meetingAnalytics","meetingRecap","premiumBenefits"],loaderRenderer:null,children:(0,gO.t)(o,{children:(0,gO.t)(l,{children:(0,gO.t)(t,{})})})})}return(0,gO.t)(e,{})}if(t===Mt.S.Main||!d&&t===Mt.S.HorizontalBar){n("ChunkLoadStarted",{chunkName:Q5});const[{MeetingRecapRenderer:e},{LPC:a}]=await Promise.all([(0,ac.mT)(Y5,Q5,i),c(!!r)]);return n("ChunkLoadSucceeded",{chunkName:Q5}),(0,gO.t)(ez.f,{namespaces:["meetingAnalytics","meetingRecap","premiumBenefits"],loaderRenderer:null,children:(0,gO.t)(a,{children:(0,gO.t)(l,{children:(0,gO.t)(e,{appRenderMode:t})})})})}return(0,gO.t)(e,{})},onBeforeDeeplinkParsed:J5}}const t7=e=>{if(n7(e))return i7(e)?{subNavEntity:a7(e),headerEntity:o7(e),startEntity:r7(e),mainEntity:s7(e),endEntity:l7(e)}:null},n7=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.transcriptcontent].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},i7=()=>!0,a7=()=>null,o7=()=>null,r7=()=>null,s7=({entity:e})=>e,l7=()=>null,c7={id:"com.microsoft.teams.transcript-content",name:"TranscriptContentApp",supportedEntities:[Se.py.transcriptcontent],supportedRenderModes:[Mt.S.Main],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},d7="transcript-content-app",u7=()=>Promise.all([n.e(187946),n.e(586535),n.e(39729),n.e(464003),n.e(921164),n.e(928362),n.e(625402),n.e(274),n.e(758354),n.e(414720),n.e(617758),n.e(403275)]).then(n.bind(n,335453)),m7=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,967117));function p7(){const e=()=>null;return{getAppViewEntities:t7,manifest:c7,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===Mt.S.Main){const[{TranscriptContentViews:e},{CallsTabContextProvider:t}]=await Promise.all([(0,ac.mT)(u7,d7,n),(0,ac.mT)(m7,d7,n)]);return(0,gO.t)(ez.f,{namespaces:["calling","meetingRecap"],loaderRenderer:null,children:(0,gO.t)(t,{children:(0,gO.t)(e,{})})})}return(0,gO.t)(e,{})}}}var g7=n(720335),h7=n(133753);const y7="switchToPeople",v7=()=>n.e(559567).then(n.bind(n,251274)),f7={onEventReceived:async({eventInput:{event:e,source:t},requestContext:{coreSettings:n,scenarioFactory:i,client:a}})=>{if(e.type===y7)return Promise.resolve({command:DW(),source:t});if(((0,g7.z)(e)||(0,h7.w)(e))&&"pxNovaTelemetryEvent"===e.type){const o="px-nova-telemetry-service",{PXNovaTelemetryService:r}=await(0,ac.mT)(v7,o,i);return r.logEvent({event:e,coreSettings:n,sessionStartGesture:t.inputType,client:a}),Promise.resolve(void 0)}if((0,n1.Pu)(e))return Promise.resolve({command:EW(e.data())});if((0,n1.O0)(e))return Promise.resolve(void 0);if((0,g7.z)(e))switch(e.type){case"onDismiss":return Promise.resolve({command:AW()});case"onRenderComplete":{const t=e.data();return i.findScenario(H.RG.LoadLivePersonaEditor)?.stop({overrideTimestamp:t}),Promise.resolve(void 0)}case"onSaveContactSuccess":return Promise.resolve({command:Y0({title:e.data().successMessage,intent:"Success",dismissOnAction:!0,duration:3e3})});case"onSaveContactFailure":if(["DuplicateFound","UnprocessableEntity"].includes(e.data().errorCode))return Promise.resolve({command:Y0({title:e.data().errorMessage,intent:"Error",dismissOnAction:!0,duration:3e3})});default:return Promise.resolve(void 0)}if((0,h7.w)(e))switch(e.type){case"onEditContact":{const{personNodeID:t,placement:n}=e.data();return Promise.resolve({command:EW({mri:"",personNodeID:t,isInSpeedDialMode:!1,isFederatedUser:!1,placement:n})})}case"onStartChat":{const{hostAppPersonaId:t}=e.data();return Promise.resolve({command:s$({mri:t,correlationSource:C.D.PeopleApp})})}case"onStartAudioCall":{const{hostAppPersonaId:t}=e.data();return Promise.resolve({command:XO({mri:t,correlationSource:C.D.PeopleApp})})}case"onComposeEmail":{const{emailUrl:t}=e.data();return(0,L.J)().open(t,"_blank"),Promise.resolve(void 0)}case"onPhoneCall":{const{phoneUrl:t}=e.data();return(0,L.J)().open(t,"_blank"),Promise.resolve(void 0)}case"onNewContactClicked":return Promise.resolve({command:PW(),source:t});case"onNavigationRequest":return Promise.resolve({command:_W(e.data())});case"onSubscriptionRequest":return Promise.resolve({command:FW(e.data())});case"showProfile":{const{personNodeId:n}=e.data(),i={eventType:"click",userId:"",personNodeId:n,left:0,top:0};return Promise.resolve({command:nG(i),source:t})}case"showActionResult":{const{message:t,status:n}=e.data();return Promise.resolve({command:Y0({title:t,dismissOnAction:!0,duration:3e3,intent:"success"===n?"Success":"Error"})})}case"onRenderComplete":{const t=e.data();return i.findScenario(H.RG.PeopleAppSwitch)?.stop({overrideTimestamp:t}),Promise.resolve(void 0)}}return Promise.resolve(void 0)}},S7={id:"com.microsoft.teams.people",name:"PeopleApp",getLocalizedName:async e=>(await e.waitForNamespace("jana"),e.stringTranslate("jana","jana_app_name")),actors:Object.keys(kW),supportedEntities:[Se.py.livepersonaeditor,Se.py.peopleapp,Se.py.addcontactdialog],supportedRenderModes:[Mt.S.Modal,Mt.S.Main,Mt.S.Rail],windowFeatures:{minWidth:565,width:1241,minHeight:720,height:720},getDefaultCommand:e=>{const{enablePeopleApp:t}=e.get(b.J.People);if(t)return{action:Se.uk.default,type:Se.py.peopleapp}}},k7=async({commandInput:{command:e},requestContext:{loggerFactory:t,scenarioFactory:n}})=>{const i=t.newLogger("PeopleApp onCommandReceived","apps-people");return e.action===CW?(i.infoToTelemetry?.("View People App command received","people_apps_people_command"),{entity:{type:Se.py.peopleapp,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Nova}}}):(e=>e.action===wW)(e)?(i.infoToTelemetry?.("Switch to contact tag command received","people_apps_people_command"),{entity:{type:Se.py.peopleapp,action:Se.uk.view,id:(0,Re.v4)()},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Nova}},entityOptions:e.data}):(e=>e.action===bW)(e)?(i.infoToTelemetry?.("Change contacts for presence subscription","people_apps_people_command"),{entity:{type:Se.py.peopleapp,action:Se.uk.view,id:(0,Re.v4)()},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Nova}},entityOptions:e.data}):(e=>e.action===NW)(e)?(i.infoToTelemetry?.("Open Add Contact command received","people_apps_people_command"),{entity:{type:Se.py.addcontactdialog,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.Nova}}}):(e=>e.action===TW)(e)?(n.newScenario(H.RG.LoadLivePersonaEditor),i.infoToTelemetry?.("Open LPE command received","people_apps_people_command"),C7(Se.py.livepersonaeditor,Se.uk.view,e.data,ke.fe.show)):(e=>e.action===IW)(e)?(i.infoToTelemetry?.("Close LPE command received","people_apps_people_command"),C7(Se.py.livepersonaeditor,Se.uk.view,{mri:"",personNodeID:void 0,isInSpeedDialMode:!1,isFederatedUser:!1,placement:"center"},ke.fe.hide)):void i.errorToTelemetry?.(`Command action '${e.action}' is not supported by PeopleApp`,"people_apps_people_command")},C7=(e,t,n,i)=>({entity:{type:e,action:t},command:{visibilityState:i,stateTransition:ke.su.extend,correlation:{source:C.D.Nova}},entityOptions:n}),b7=(e,t)=>{const i=hO.useCallback((async()=>{const{LivePersonaEditorEntry:i}=await(async(e,t)=>{const i="live-persona-editor";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ac.mT)((()=>Promise.all([n.e(193180),n.e(586535),n.e(84274),n.e(361845),n.e(919583),n.e(604994),n.e(39729),n.e(757033),n.e(84215),n.e(918999),n.e(73598),n.e(829988),n.e(282037),n.e(538997)]).then(n.bind(n,792140))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return e.findScenario(H.RG.LoadLivePersonaEditor)?.mark(H.ck.LoadedLivePersonaEditorChunk),{default:i}}),[e,t]),a=hO.useCallback((async()=>{const{PeoplePickerDialog:i}=await(async(e,t)=>{const i="speed-dial-nova";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ac.mT)((()=>Promise.all([n.e(377348),n.e(463781),n.e(681896),n.e(457628),n.e(346992),n.e(586535),n.e(532863),n.e(64168),n.e(34607),n.e(685827),n.e(609660),n.e(357903),n.e(837458),n.e(284523),n.e(18723)]).then(n.bind(n,175974))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return{default:i}}),[e,t]),o=hO.useCallback((async()=>{const{PeopleAppMainViewEntry:i}=await(async(e,t)=>{const i="people-app-main-view";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ac.mT)((()=>Promise.all([n.e(586535),n.e(457535),n.e(896201),n.e(240446),n.e(95719),n.e(547521),n.e(896963),n.e(954305),n.e(128916),n.e(282526),n.e(213629),n.e(918999),n.e(73598),n.e(217442),n.e(423804)]).then(n.bind(n,163043))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return e.findScenario(H.RG.PeopleAppSwitch)?.mark(H.ck.LoadedPeopleAppMainViewChunk),{default:i}}),[e,t]),r=hO.useCallback((async()=>{const{PeopleAppLeftNavEntry:i}=await(async(e,t)=>{const i="people-app-nova";t("ChunkLoadStarted",{chunkName:i});const a=await(0,ac.mT)((()=>Promise.all([n.e(73598),n.e(124636)]).then(n.bind(n,710161))),i,e);return t("ChunkLoadSucceeded",{chunkName:i}),a})(e,t);return e.findScenario(H.RG.PeopleAppSwitch)?.mark(H.ck.LoadedPeopleAppLeftNavChunk),{default:i}}),[e,t]);return{LivePersonaEditor:i,PeopleAppMainView:o,PeopleAppLeftNav:r,AddContactPickerDialog:a}};var w7=n(620870),T7=n(53246),I7=n(848205),N7=n(679612),E7=n(823748),A7=n(712952),_7=n(39954),F7=n(140560),D7=n(136588);const P7=({appRenderMode:e,onRenderEvent:t,scenarioFactory:n,entity:i})=>{const{coreSettings:a}=(0,dY.SE)(),o=(0,uY.dL)();hO.useEffect((()=>{(e=>{const t=(0,w7.O)(e);if(t){const e=(0,I7.r)(t);T7.W.associateIngestionKeyWithAppNameIfNecessary(e,N7.i,[_7.pL])}})(a),(e=>{const t=(0,w7.O)(e);if(t){const e=(0,E7.r)(t);T7.W.associateIngestionKeyWithAppNameIfNecessary(e,A7.i,[_7.pL])}})(a)}),[a]);const{LivePersonaEditor:r,PeopleAppLeftNav:s,PeopleAppMainView:l,AddContactPickerDialog:c}=b7(n,t);if(e===Mt.S.Modal&&i.type===Se.py.livepersonaeditor)return(0,gO.t)(DG.o,{factory:r,props:{},fallback:!1});if(e===Mt.S.Main&&i.type===Se.py.peopleapp)return(0,gO.t)(DG.o,{factory:l,props:{},fallback:!1});if(e===Mt.S.Rail&&i.type===Se.py.peopleapp)return(0,gO.t)(DG.o,{factory:s,props:{},fallback:!1});if(e===Mt.S.Modal&&i.type===Se.py.addcontactdialog){const e=F7.a.fromName(D7.TS.addContacts),t=o.stringTranslate("jana","add_to_contacts"),n={moduleNameOnSelection:dA.rA.peopleAppAddContactPeoplePickerAdd,moduleNameOnInitiation:dA.rA.peopleAppAddContactPeoplePicker,panelType:dA.wh.SpeedDial,pickerUsageArea:"AddContactPeoplePickerDialog",moduleName:dA.rA.peopleAppAddContactDialog,subWorkLoad:dA.eD.addContact};return(0,gO.t)(DG.o,{factory:c,props:{dialogTitle:t,isSpeedDialScenario:!1,peoplePickerFilters:e,openPickerDialog:!0,userBiTelemetryInfo:n,userActionLocation:hR.x9.PeopleApp}})}return null},M7=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(128770),n.e(812934),n.e(649800),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(553940),n.e(136462),n.e(732691),n.e(809416),n.e(857282),n.e(677361),n.e(384701),n.e(253385),n.e(729265),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(374968),n.e(479236),n.e(278841),n.e(64047),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(68021),n.e(600213),n.e(634446),n.e(461991),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(230050),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(482266),n.e(424584),n.e(456476),n.e(7090),n.e(456904)]).then(n.bind(n,450812)),x7=e=>{const{enableEntityMoreInfo:t,children:n}=e,[i,a]=hO.useState();return hO.useEffect((()=>{t||async function(){const{LPC:e}=await(0,ac.mT)(M7,"people-app-lpc");a((()=>e))}()}),[t,a]),!t&&i?(0,gO.t)(i,{appName:"PeopleApp",children:(0,gO.t)(rJ.p3,{children:n})}):(0,gO.t)(hO.Fragment,{children:n})},R7=({appRenderMode:e,children:t,scenarioFactory:n})=>(n.findScenario(H.RG.PeopleAppSwitch)||n.newScenario(H.RG.PeopleAppSwitch),hO.useEffect((()=>()=>{e===Mt.S.Main&&n.findScenario(H.RG.PeopleAppSwitch)?.cancel({reason:"people_render_unmounted"})}),[e,n]),(0,gO.t)(hO.Fragment,{children:t})),j7=hO.memo((function(e){return(0,gO.t)(ez.f,{namespaces:["livePersonaEditor","jana"],loaderRenderer:null,children:(0,gO.t)(P7,{...e})})})),L7=async({onRenderEvent:e,scenarioFactory:t,appRenderMode:n,entity:i,coreSettings:a})=>{const{enableEntityMoreInfo:o}=a.get(b.J.Core);return(0,gO.t)(R7,{appRenderMode:n,scenarioFactory:t,children:(0,gO.t)(x7,{enableEntityMoreInfo:!!o,children:(0,gO.t)(j7,{onRenderEvent:e,scenarioFactory:t,appRenderMode:n,entity:i})})})},O7=({appRenderMode:e})=>{const t=new MV.H,n=[],i=[];switch(e){case Mt.S.Main:$7({criticalSignals:n,postCriticalSignals:i,featureFlags:{}});case Mt.S.Rail:}return t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:6e4}),t.appPhases},$7=({criticalSignals:e})=>{e.push(xV.G.PEOPLE_APP_RENDERED)},U7=e=>{if(B7(e))return{subNavEntity:W7(e),headerEntity:H7(e),startEntity:V7(e),mainEntity:G7(e),endEntity:z7(e)}},B7=({entity:e,layoutMode:t})=>{const{action:n=null,type:i}={...e},a=[ke.lO.focus,ke.lO.standard].includes(t),o=[Se.py.peopleapp].includes(i),r=[Se.uk.list,Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},W7=({entity:e,layoutMode:t})=>{if(t===ke.lO.focus)return null;const{type:n,id:i,options:a,windowOptions:o}=e;return{action:Se.uk.list,entityState:{flushableByLinkedEntity:!0},id:i,linkedEntity:null,type:n,windowOptions:o,options:a}},H7=()=>null,V7=()=>null,G7=({entity:e,contextEntity:t})=>{let n=Se.uk.view;const{action:i=null}={...e},a=[Se.uk.view,Se.uk.default];return i&&a.includes(i)&&(n=i),t||{...e,action:n}},z7=()=>null,q7=({areEmptySlotsTransparent:e,coreSettings:t})=>{const{isFlyoutChat:n}=t?.get(b.J.Flyout)??{};return{subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e}},mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!!n}}}},J7=(e,t,n)=>{const{userPreferences:i,coreSettings:a,layoutMode:o}=t,r=e.mainEntity;if(r.action===Se.uk.view)return U7({contextEntity:null,coreSettings:a,entity:{id:(0,Re.v4)(),type:Se.py.peopleapp,action:Se.uk.list,options:r.options},layoutMode:o,userPreferences:i})},Q7={id:"com.microsoft.teams.store.notifications.app",name:"TeamsStoreNotificationsApp",supportedEntities:[Se.py.lobnotifications,Se.py.onboardingnotifications,Se.py.discoverappsnotifications,Se.py.autoinstallnotification],supportedRenderModes:[Mt.S.Main,Mt.S.Rail]},K7="/l/autoinstallnotification",Y7=(e,t)=>{const n=new RegExp(`${K7}/([a-zA-Z0-9,-]+)$`),i=e.pathname.match(n);if(i){const[,e]=i;if(!e.split(",").includes(""))return Promise.resolve({entityCommand:{entity:{type:Se.py.autoinstallnotification,action:Se.uk.view,id:e},entityOptions:{autoInstallAppIds:e.split(",")},command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}})}return t.warnNoPii?.(`invalid path name ${e.pathname}`),Promise.reject("Auto install notification deeplink is invalid")},X7=e=>{if(Z7(e))return eee(e)?{subNavEntity:tee(e),headerEntity:nee(e),startEntity:iee(e),mainEntity:aee(e),endEntity:oee(e)}:null},Z7=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.lobnotifications,Se.py.onboardingnotifications,Se.py.discoverappsnotifications,Se.py.autoinstallnotification].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},eee=()=>!0,tee=({entity:e})=>e,nee=()=>null,iee=()=>null,aee=({entity:e})=>e,oee=()=>null,ree=({appRenderMode:e})=>{const t=new MV.H,n=[];if(e===Mt.S.Main)n.push(xV.G.LOB_NOTIFICATIONS_RENDERED);return t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:3e4}),t.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:[],timeout:1e4}),t.appPhases},see="/l/lobnotifications",lee=(e,t,n)=>{const i=new RegExp(`${see}/([a-zA-Z0-9,-]+)$`),a=e.pathname.match(i);if(a){const[,e]=a;if(!e.split(",").includes(""))return Promise.resolve({entityCommand:{entity:{type:Se.py.lobnotifications,action:Se.uk.view,id:e},entityOptions:{headItem:e.split(",")[0],bodyItems:e.split(",").slice(1)},command:{stateTransition:n?.stateTransition||ke.su.flow,visibilityState:n?.visibilityState||ke.fe.show}},metadata:{allowAnonymous:!1}})}return t.warnNoPii?.(`invalid path name ${e.pathname}`),Promise.reject("Lob notification deeplink is invalid")},cee=()=>Promise.all([n.e(392718),n.e(837458),n.e(704171)]).then(n.bind(n,403612)),dee=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(729251),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(44499),n.e(242213),n.e(424772),n.e(814315),n.e(593837),n.e(157477),n.e(233171),n.e(852144),n.e(289814),n.e(672822),n.e(83395),n.e(727035),n.e(851290),n.e(904986),n.e(364592),n.e(316808),n.e(532863),n.e(833851),n.e(618412),n.e(115829),n.e(577037),n.e(227290),n.e(24994),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(14415),n.e(625402),n.e(484885),n.e(797394),n.e(723572),n.e(274),n.e(758354),n.e(308918),n.e(864654),n.e(891248),n.e(29311),n.e(909663),n.e(34607),n.e(289458),n.e(718542),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(403062),n.e(284523),n.e(861153),n.e(617758),n.e(299585),n.e(792751),n.e(737885),n.e(469858),n.e(557964),n.e(973647),n.e(568740)]).then(n.bind(n,967117));function uee(){const e=()=>null;return{getAppViewEntities:X7,manifest:Q7,onBeforeDeeplinkParsed:[{filter:e=>!!e.pathname.startsWith("/l/lobnotifications"),execute:({deeplinkUrl:e,preferredCommandInput:t,context:n})=>{const i=n.loggerFactory.newLogger("ActivityApp","apps-activity");return i.log("Executing deep link for lob notifications"),((e,t,n,i)=>{const{pathname:a}=n;return a.startsWith(see)?lee(n,t,i):Promise.reject("No DeeplinkPrefixType found for the specified deeplinkUrl")})(n.coreSettings,i,e,t)}},{filter:e=>!!e.pathname.startsWith("/l/autoinstallnotification"),execute:({deeplinkUrl:e,context:t})=>{const n=t.loggerFactory.newLogger("ActivityApp","apps-activity");return n.log("Executing deep link for Auto Install notifications"),((e,t,n)=>{const{pathname:i}=n,{enableSendAutoInstallNotification:a}=e.get(b.J.Extensibility);if(i.startsWith(K7)){const e="Send auto install notification is disabled for this experience";return a?Y7(n,t):(t.errorToTelemetry?.(e,"auto_install_notification_feature_not_enabled"),Promise.reject("Send auto install notification is disabled for this experience"))}const o="No DeeplinkPrefixType found for the specified deeplinkUrl";return t.errorToTelemetry?.(o,"auto_install_notification_deep_link_prefix_type_not_found"),Promise.reject(o)})(t.coreSettings,n,e)}}],render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main){const e="teamsStoreNotifications";n("ChunkLoadStarted",{chunkName:e});const[{NotificationsEntry:t},{CallsTabContextProvider:a}]=await Promise.all([(0,ac.mT)(cee,e,i),(0,ac.mT)(dee,e,i)]);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(a,{children:(0,gO.t)(t,{})})})}return(0,gO.t)(e,{})},getAppPhases:ree}}var mee=n(357863);const pee=new Set([Se.py.chats,Se.py.calls,Se.py.taskmodule,Se.py.hwctaskmodule,Se.py.extensions]);var gee=n(722874),hee=n(435205);const yee="/l/stage",vee="No DeeplinkPrefixType found for the specified deeplinkUrl",fee=e=>{const{pathname:t,search:n}=e,i=new URLSearchParams(n).get("context"),a=i&&JSON.parse(i),o=t.split(/[/?&]/),r=o.indexOf("stage");return{appId:o[r+1],deeplinkContext:a}},See={filter:e=>{if(!e.pathname.startsWith(yee))return!1;try{const{appId:t,deeplinkContext:n}=fee(e),{contentUrl:i}=n;return!!(t&&n&&i)}catch{return!1}},execute:async({deeplinkUrl:e,context:{loggerFactory:t,scenarioFactory:n,coreSettings:i,getUserContexts:a},sourceViewEntity:o})=>{const r=t.newLogger("PlatformApp_parseStageDeeplink","apps-platform-app"),{enableReactStageModal:s,disablePlatformEntityIdDecoding:l}=i.get(b.J.Extensibility);if(!s)return Promise.reject("Stage modal feature flag is disabled");if(!e.pathname.startsWith(yee))return r.log(vee),Promise.reject(vee);if(!o){const e="No sourceViewEntity found";return r.log(e),Promise.reject(e)}const{chatId:c,parentMessageId:d,channelMeetingMessageId:u,replyChainId:m,channelId:p}=(0,hee.g)(o,r,!!l),{appId:g,deeplinkContext:h}=fee(e),{contentUrl:y,websiteUrl:v,title:f,sourceChatId:S,sourceChannelId:k,messageId:C,threadId:w,openMode:T}=h;let I=c,N=p,E=u||d;(S||k)&&(E=C),S&&(I=S),h.replyChainId&&(N=k);const A={appId:g,tabInfo:JSON.stringify({tabInfo:{contentUrl:y,websiteUrl:v,name:f}}),entryPoint:Xi.mQ.deepLinkStageView,openMode:T,messageId:E,replyChainId:h.replyChainId??m,convId:N??(I||""),channelId:N},_=await a();if(!_||0===_.length)return Promise.reject("No user context found");const F=_.find((e=>e.userContextAccountType===zE.MainWindow));if(!F)return Promise.reject("No main window account found");const D=F.context.client;return(0,gee.A)(A,i,D,n,r,w).then((e=>Promise.resolve(e))).catch((e=>Promise.reject(e)))}},kee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsHostedWebContentSendExternalAuthDeeplinkMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"authId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"result"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"sendExternalAuthDeeplink"},arguments:[{kind:"Argument",name:{kind:"Name",value:"authId"},value:{kind:"Variable",name:{kind:"Name",value:"authId"}}},{kind:"Argument",name:{kind:"Name",value:"result"},value:{kind:"Variable",name:{kind:"Name",value:"result"}}}]}]}}]},Cee={reloadTrigger:!1},bee={id:""},wee="/l/entity",Tee="/l/task",Iee="No DeeplinkPrefixType found for the specified deeplinkUrl",Nee={[wee]:sa.DL.PlatformExtension},Eee=e=>{const{pathname:t,search:n}=e,i=new URLSearchParams(n),a=i.get("context"),o=i.get("tenantId");let r;try{r=a&&JSON.parse(a)}catch(e){}const s=r?.channelId,l=r?.chatId,c=t?.split(/[/?&]/),d=c?.indexOf("entity"),u=c?.[d+1];return{tenantId:o,appId:u,entityId:decodeURIComponent(c?.[d+2]||""),channelId:s,chatId:l,deeplinkContext:r,pathname:t}},Aee=new Set([wee]),_ee=(e,t,n,i,a,o,r,s,l,c)=>{l?.mark("create_deeplink_command"),a.log(`create_deeplink_command with appId: ${t} tabEntityId:${n} context: ${i}`);const d=JSON.stringify({appId:t,tabEntityId:n,subEntityId:i?.subEntityId});o&&bee.id===d?Cee.reloadTrigger=!Cee.reloadTrigger:Cee.reloadTrigger=!1,bee.id=d;const u={entityCommand:{...i?.channelId||i?.chatId?(0,l0.PO)(e,t,i.channelId||"",i.chatId||"",r,l,n,s,i?.subEntityId):(0,l0.Pq)(t,!1,Cee.reloadTrigger,o,C.D.PlatformPersonalAppDeepLink,n,s,i?.subEntityId,void 0,e,!0)},metadata:{allowAnonymous:!1,tenantId:c??void 0}};return l?.mark("return_deeplink_command"),l?.appendEventData({"PlatformTabDeeplink.generatedCommand":u.toString()}),Promise.resolve(u)},Fee=()=>n.e(22463).then(n.bind(n,904479)),Dee=async e=>{const{deeplinkUrl:t,preferredCommandInput:n,context:{coreSettings:i,loggerFactory:a,scenarioFactory:o}}=e,r=a.newLogger("platform-app","apps-platform-app"),{enablePlatformDeepLinkRouting:s,appIdList:l,disabledTabAppIds:c,isAllowedAppList:d}=i.get(b.J.Extensibility),u=l&&JSON.parse(l),{appId:m}=Eee(t),p=(0,mee.fk)(r,m,!1,c||[],u,d);if(s&&p)return Promise.reject(`App ${m} is not supported for deeplink navigation in T2.1`);const g=new URLSearchParams(t.search).get("context");let h;try{h=g&&JSON.parse(g)}catch(e){r.errorToTelemetry?.("[parseAndExecuteDeeplink] could not parse deeplink context","platform_deeplink_context_parse_error")}return!s&&h?.channelId&&h?.chatId?Promise.reject("Feature for parsing teams and channels deep links in T2.1 is not enabled"):((e,t,n,i,a)=>{const{appId:o,entityId:r,deeplinkContext:s,pathname:l,tenantId:c}=Eee(e);t.log(`Parsing deepLink for platform app - appId: ${o}, pathname: ${l}`);const d=a?.correlation?.source,u=[C.D.ActivityFeed,C.D.ActivityFeedBellClick],m=!!d&&u.includes(d);let p,g;n&&(g=m?Xi.mQ.activityFeed:s?.channelId||s?.chatId?s.channelId?Xi.mQ.channelTab:s.chatId?Xi.mQ.chatTab:"Unknown":Xi.mQ.personalApp,i?.findScenario(H.RG.PlatformTabDeeplinkHandling)?.cancel(),p=i?.newScenario(H.RG.PlatformTabDeeplinkHandling),p&&i?.hoistScenarioToCore?.(p),p?.appendEventData({"PlatformTabDeeplink.pathname":e.pathname,"PlatformTabDeeplink.search":e.search}));for(const n of Array.from(Aee))if(l?.startsWith(n))return void 0===Nee[n]?(t.errorToTelemetry?.(Iee,"platform_deeplink_prefix_type"),Promise.reject(Iee)):((0,A6.ui)(i,o,`${g}Deeplink`,t,!1),_ee(e,o,r,s,t,m,i,a,p,c));return t.errorToTelemetry?.(Iee,"platform_deeplink_prefix_type"),Promise.reject(Iee)})(t,r,!!s,o,n)},Pee={filter:Tee,execute:({deeplinkUrl:e,context:{loggerFactory:t,scenarioFactory:n,coreSettings:i},sourceViewEntity:a})=>{const o=t.newLogger("PlatformApp_parseTaskModuleDeeplink","apps-platform-app");return Mee(e,i,o,n,a)}},Mee=(e,t,n,i,a)=>{if(e.pathname.startsWith(Tee)){const o=i.newScenario(H.RG.ExtDeeplinkToTaskModule),{enableDeepLinkToTaskModule:r}=t.get(b.J.Extensibility);if(!r)return o.stop({reason:H.ck.ExtDeeplinkToTaskModuleFeatureFlagDisabled}),n.log("ext_deeplink_to_task_module_featureflag_disabled"),Promise.reject("Deeplink to task module feature flag is disabled");if(!a)return o.stop({reason:H.ck.ExtDeeplinkToTaskModuleNotSupported}),n.log("ext_deeplink_to_task_module_not_supported"),Promise.reject("Deeplink to task module is not supported");const s=(0,Re.v4)();return Promise.resolve({entityCommand:{entity:{type:Se.py.taskmodule,action:Se.uk.create,id:s},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.TaskModuleDeeplink}},entityOptions:{deeplinkSourceEntityInput:a,deeplinkUrl:e}},metadata:{allowAnonymous:!1,shouldTargetSourceWindow:!0}})}return n.log(Iee),Promise.reject(Iee)},xee={filter:"/l/auth-callback",execute:async e=>{const{context:{coreSettings:t}}=e,{enablePlatformExternalAuth:n}=t.get(b.J.Extensibility);if(!n)return Promise.reject("External auth feature is not enabled");{const{search:t}=e.deeplinkUrl,n=new URLSearchParams(t),i=n.get("authId"),a=n.get("result"),o=await e.context.getUserContexts();o?.[0]?.context?.client?.mutate({mutation:kee,variables:{authId:i,result:a}})}return Promise.resolve(void 0)}},Ree=[{filter:e=>{if(!e.pathname.startsWith(wee))return!1;const{appId:t,chatId:n,entityId:i,deeplinkContext:a}=Eee(e);return!(!(t&&n&&i&&a)||"chat"!==a.contextType&&"meeting"!==a.contextType)},execute:async e=>{const{context:{coreSettings:t}}=e,{enablePlatformDeepLinkRouting:n}=t.get(b.J.Extensibility);if(!(({deeplinkUrl:e,sourceViewEntity:t,context:{coreSettings:n}})=>{if("false"===e.searchParams.get("openInMeeting")?.toLowerCase()||!n.get(b.J.Extensibility).handleDeepLinkToMeetingSidePanel||!t)return!1;const{type:i,action:a,linkedEntity:o}=t,r=t;return i===Se.py.calls||!!r.options&&(i===Se.py.extensions&&a===Se.uk.view&&o?.type===Se.py.calls?!!o.id:pee.has(i)&&r.options.includes("teamsCallId"))})(e)){if(n)return Dee(e);throw new Error("Groupchat/team scope tab deeplink disabled")}const{executeDeepLinkToGroupChatOrTeamTab:i}=await(0,ac.mT)(Fee,"platform-app-execute-group-chat-or-team-scope-tab-deeplink");try{return await i(e)}catch(t){if(n)return Dee(e);throw t}}},{filter:e=>{try{const{appId:t}=Eee(e);return!!t}catch{return!1}},execute:Dee},Pee,See,xee],jee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DataClientPlatformAppButtonMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"action"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateAppButtonSettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"action"},value:{kind:"Variable",name:{kind:"Name",value:"action"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]},{getIsFirstFlyoutClickAfterAppLoad:Lee,setIsFirstFlyoutClickAfterAppLoad:Oee}=(()=>{let e=!0;return{getIsFirstFlyoutClickAfterAppLoad:()=>e,setIsFirstFlyoutClickAfterAppLoad:t=>{e=t}}})();var $ee=n(462512);const Uee={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ComponentsAppsPlatformQueriesBlockUnblockBotChatForAppMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"blockUnblockBotChatForApp"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}}]}]}}]},Bee=()=>Promise.all([n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(393890),n.e(75298),n.e(152739),n.e(664625),n.e(933161),n.e(682492),n.e(891369),n.e(440413),n.e(732691),n.e(809416),n.e(981041),n.e(479236),n.e(180830),n.e(345213),n.e(609787),n.e(232410),n.e(689835),n.e(225062),n.e(928362),n.e(652421),n.e(841342),n.e(324415),n.e(730056),n.e(400685),n.e(685827),n.e(474133),n.e(609660),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(258544),n.e(6348),n.e(782721),n.e(376960),n.e(146244),n.e(931930),n.e(109515),n.e(187591),n.e(38878),n.e(701227),n.e(657060),n.e(420137),n.e(623025),n.e(559067)]).then(n.bind(n,195575)),Wee=async({commandInput:e,requestContext:t})=>{const{loggerFactory:n,scenarioFactory:i,client:a,coreSettings:o}=t,r=e.command,s=r.action,l=n.newLogger("PlatformApp onCommandReceived","apps-platform-app");if(e.command.actor===_B)switch(s){case FB:return Hee(r,t,l);case DB:const{enablePrewarmPlatformChunk:e}=o.get(b.J.Extensibility);return void(e&&Lee()&&(l.log("enablePrewarmPlatformChunk is enabled."),(0,ac.mT)(Bee,"platform-app",i),Oee(!1)));case PB:return Vee(r);case MB:const{appId:n}=r.data;return{entityOptions:{appId:n,entryPoint:uM.RE.PersonalAppAbout},entity:{id:n,type:Se.py.platformapp,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.ExtensionCommanding}}};case xB:{const{appId:e}=r.data,n=await(0,$ee.yx)(a,e),s=n.staticTabs?.some((e=>e.scopes?.some((e=>e?.toLowerCase()==="Personal".toLowerCase()))));if(s){const{enableAppsQueryOptimization:n}=o.get(b.J.Extensibility);return await(0,$ee.eI)(a,i,H.RG.PlatformAppFlyoutJITInstallApp,e,"Personal",l,!!n),Hee(r,t,l)}return Vee(r)}case RB:{const{appId:e,appName:t,isInUse:n}=r.data;return{entityOptions:{appId:e,appName:t,scope:"Personal",navigateToDefaultAppOnUninstall:n},entity:{id:e,type:Se.py.manageapps,action:Se.uk.delete},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.ExtensionCommanding}}}}case jB:const c=r,d=c.data?.appId;return d?void await a.mutate({mutation:Uee,variables:{appId:d}}):void l.error("app id for block unblock was undefined.");case LB:return Gee(r);default:l.error(`Command action '${s}' is not supported at PlatformApp.`)}else l.error(`Command for actor '${e.command.actor}' cannot be handled by PlatformApp.`)},Hee=(e,t,n)=>{const{scenarioFactory:i,executionContext:a,client:o}=t,{viewEntities:{mainEntity:r}}=a;if("object"!=typeof(s=e.data)||null===s||!("appId"in s))return void n.error(`Command for action '${e.action}' requires an appId.`);var s;const l=zee(r?.id,r?.type,e.data.appId,n);return l?(async(e,t,n,i)=>{if(!t)return;const a={appId:t,action:n};await e.mutate({mutation:jee,variables:a}).catch((()=>i.errorToTelemetry?.(`[AppId: ${t}] Failed to register app button to cache`,"platform_personal_app_app_button_api",void 0,!0)))})(o,e.data.appId,e.action,n):(0,A6.ui)(i,e.data.appId,Xi.mQ.personalApp,n,e.data.isMultiWindow),(0,l0.Pq)(e.data.appId,e.data.isMultiWindow||!1,!1,!1,C.D.AppBar,void 0,void 0,void 0,l)},Vee=e=>{const t=e.data?.appId??"",n=e.data?.scrollToSection;return{entityOptions:{appId:t,entryPoint:uM.RE.PersonalFlyoutAppSuggestions,viewOptions:{scrollToSection:n}},entity:{id:t,type:Se.py.platformapp,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.ExtensionCommanding}}}},Gee=e=>{const t=e.data?.tileId;if(!t)return;const n=JSON.parse(t),i={id:n.isChannel?JSON.stringify({channelId:n.threadId}):n.threadId,type:n.isChannel?Se.py.channels:Se.py.chats,action:Se.uk.view};delete n.isChannel;return{entity:{id:JSON.stringify(n),type:Se.py.extensions,action:Se.uk.view,linkedEntity:i},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{id:(0,Re.v4)(),source:C.D.ExtensionCommanding,startTimestamp:Date.now()}},entityOptions:{source:C.D.PlatformTabDeepLink,...!n.isChannel&&{focusOnLoad:ri.t.DoNotMove}}}},zee=(e,t,n,i)=>{try{if(t===Se.py.extensions&&e){return JSON.parse(e).appId===n}return!1}catch(t){return i.errorToTelemetry?.(`failed to parse main entity id ${e}`,"platform_personal_app_main_entity_parse",void 0,!0),!1}};var qee=n(113600);const Jee={onEventReceived:async({eventInput:e})=>{switch(e.event.type){case vO.uS.expandTab:{const t=e.event.data?.();return Promise.resolve({command:Nt.CN.expandTab(t)})}case vO.uS.resetLayoutOverrides:return Promise.resolve({command:Nt.CN.resetLayoutOverrides()});case vO.uS.maximizeTab:return Promise.resolve({command:Nt.CN.maximizeTab()});case YV.uS.requestPersonMoreInfo:const t=e.event.data?.();return Promise.resolve({command:nG(t)});case qee.dX.launchDefaultPersonalApp:return Promise.resolve({command:Nt.CN.defaultCommand({forceTransition:!0})})}return Promise.resolve(void 0)}},Qee=e=>{if(Kee(e))return Yee(e)?{subNavEntity:Xee(e),headerEntity:Zee(e),startEntity:ete(e),mainEntity:tte(e),endEntity:nte(e)}:null},Kee=({contextEntity:e,entity:t,coreSettings:n,layoutMode:i})=>{const{action:a=null,type:o}={...t};if(ite(t,e,n))return!1;const r=[ke.lO.focus,ke.lO.standard].includes(i),s=[Se.py.platformapp,Se.py.platformappdetails,Se.py.incontextstore,Se.py.platformapps,Se.py.extensions,Se.py.enableappdialog].includes(o),l=[Se.uk.create,Se.uk.default,Se.uk.list,Se.uk.view,Se.uk.update,Se.uk.manage],c=a&&l.includes(a),d=e&&e.action;return!(!r||!s||!c&&!d)},Yee=()=>!0,Xee=()=>null,Zee=({contextEntity:e,entity:t,coreSettings:n})=>{const i=n?.get(b.J.Extensibility).enablePlatformHeaderEntry;if(e&&e.action){if(e.type===Se.py.chats)return t;if(e.type===Se.py.extensions&&i)return e}return i?t:null},ete=()=>null,tte=({entity:e,contextEntity:t})=>t&&t.action&&(t.type===Se.py.chats||t.type===Se.py.extensions)?t:e,nte=()=>null,ite=(e,t,n)=>{const i=n?.get(b.J.Extensibility).enablePlatformHeaderEntry;return e.type===Se.py.extensions&&t?.type===Se.py.extensions&&!i},ate=({coreSettings:e})=>({headerEntity:{[Mt.S.HorizontalBar]:{slotHeightOverrides:e?.get(b.J.Extensibility)?.enablePlatformPersonalAppHeaderLayout?"auto":void 0}}}),ote={id:"com.microsoft.teams.platform-app",name:"Platform App",actors:[_B],supportedEntities:[Se.py.extensions,Se.py.taskmodule,Se.py.hwctaskmodule,Se.py.platformapp,Se.py.platformappdetails,Se.py.platformappconsent,Se.py.platformapps,Se.py.platformsubscriptionplans,Se.py.customapp,Se.py.platformauthconsentdialog,Se.py.workflows,Se.py.selectMediaApi,Se.py.viewImagesApi,Se.py.platformtab,Se.py.locationapi,Se.py.selectpeoplepicker,Se.py.platformappratingcoachmark,Se.py.stagedapps,Se.py.platformTabGallery,Se.py.manageapps,Se.py.manageappswebhook,Se.py.incontextstore,Se.py.platformappdevicepermissions,Se.py.settingsdialog,Se.py.platformstagemodal,Se.py.enableappdialog],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Modal,Mt.S.Rail],windowFeatures:{width:800,height:600,minWidth:800,minHeight:600,offset:20}},rte=({appRenderMode:e,coreSettings:t})=>{const n=new MV.H,{platformAppCriticalPhaseTimeout:i}=t.get(b.J.Extensibility);return"Main"===e&&n.registerAppPhase({phase:yt.nh.CRITICAL,signals:[xV.G.PLATFORM_APP_CONTAINER_RENDERED,xV.G.PLATFORM_APP_FRAME_RENDERED,xV.G.PLATFORM_APP_FRAME_CONTENT_RENDERED],timeout:i||35e3}),n.appPhases},ste=({context:{coreSettings:e,scenarioFactory:t}})=>[{id:"prewarm-platform-app",runOncePerId:!0,job:async()=>{const{enablePostALTPrewarmPlatformChunk:i}=e.get(b.J.Extensibility);i&&await(0,ac.mT)((()=>Promise.all([n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(393890),n.e(75298),n.e(152739),n.e(664625),n.e(933161),n.e(682492),n.e(891369),n.e(440413),n.e(732691),n.e(809416),n.e(981041),n.e(479236),n.e(180830),n.e(345213),n.e(609787),n.e(232410),n.e(689835),n.e(225062),n.e(928362),n.e(652421),n.e(841342),n.e(324415),n.e(730056),n.e(400685),n.e(685827),n.e(474133),n.e(609660),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(258544),n.e(6348),n.e(782721),n.e(376960),n.e(146244),n.e(931930),n.e(109515),n.e(187591),n.e(38878),n.e(701227),n.e(657060),n.e(420137),n.e(623025),n.e(559067)]).then(n.bind(n,195575))),"platform-app",t)}}],lte={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoBrowserAppPreWarmAuthenticationTokenQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"resource"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}},type:{kind:"NamedType",name:{kind:"Name",value:"AcquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationToken"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resource"},value:{kind:"Variable",name:{kind:"Name",value:"resource"}}},{kind:"Argument",name:{kind:"Name",value:"acquireTokenOptions"},value:{kind:"Variable",name:{kind:"Name",value:"acquireTokenOptions"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"token"}}]}}]}}]};const cte={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoBrowserAppPreWarmAppDefinitionQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"scope"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppInstallScope"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NamedType",name:{kind:"Name",value:"AppsFilterOptionsInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appDefinition"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"scope"},value:{kind:"Variable",name:{kind:"Name",value:"scope"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"appDefinition"}}]}}]}},...n(793563).E.definitions]};var dte;!function(e){e.GroupChat="GroupChat",e.Personal="Personal",e.Team="Team"}(dte||(dte={}));const ute={markers:{app_prewarm_start:"app_prewarm_start",app_prewarm_end:"app_prewarm_end",app_prewarm_auth_token_start:"app_prewarm_auth_token_start",app_prewarm_auth_token_end:"app_prewarm_auth_token_end",app_prewarm_auth_token_failed:"app_prewarm_auth_token_failed",app_prewarm_window_removed:"app_prewarm_window_removed",app_prewarm_window_creation_failed:"app_prewarm_window_creation_failed",app_prewarm_window_creation_successful:"app_prewarm_window_creation_successful",app_prewarm_app_definition_received:"app_prewarm_app_definition_received",app_prewarm_content_url_received:"app_prewarm_content_url_received",app_prewarm_close_post_message:"app_prewarm_close_post_message",app_prewarm_auth_post_message:"app_prewarm_auth_post_message"}},mte=()=>({result:"success"}),pte=(e,t)=>(t.error("Error executing command in filebrowser pre warm: ".concat(e.message)),{result:"error",error:{code:e.code||"unknown",message:e.message}}),gte=e=>({result:"error",error:{code:"unsupportedCommand",message:e.command}}),hte=e=>t=>{e(t.data)},yte=(e,t,n)=>{const{close:i,authenticate:a}=t,o=(({sendAck:e,sendCommandResult:t,close:n,authenticate:i,logger:a})=>async o=>{if("command"===o.type){e(o);const r=o.data;switch(r.command){case"close":n(r).then((()=>{t(o,mte())}),(e=>{t(o,pte(e,a))}));break;case"authenticate":i(r).then((e=>{t(o,e)}),(e=>{t(o,pte(e,a))}));break;default:t(o,gte(r))}}})({sendAck:t=>{e&&e.postMessage({type:"acknowledge",id:t.id})},sendCommandResult:(t,n)=>{e&&e.postMessage({type:"result",id:t.id,data:n})},close:i,authenticate:a,logger:n});((e,t)=>{const n=hte(t);e&&(e.addEventListener("message",n),e.start(),e.postMessage({type:"activate"}))})(e,o)},vte=async(e,t,n,i,a,o,r)=>{const s=n.findScenario(H.RG.AppPreWarm);s?.mark(`AppPreWarm_${e}_Start`);const l=async t=>{const a=o.document.getElementById(`${e}Iframe`),r=n.findScenario(H.RG.AppPreWarm);a?a.remove():o.document.getElementById("prewarmAppIframe")?.remove(),i.log("Removed Hidden Iframe"),r?.mark(ute.markers.app_prewarm_window_removed,void 0,t?"timeout":"success"),r?.stop(),Promise.resolve()},c=async e=>{const{resource:t}=e,n=new URL(t).origin;i.log(`getAuthToken triggered for resource: ${t}`),s?.mark(ute.markers.app_prewarm_auth_token_start);const o=await a.query({query:lte,fetchPolicy:"cache-first",variables:{resource:n}}),r=o.data?.authenticationToken?.token??"";return s?.mark(ute.markers.app_prewarm_auth_token_end),Promise.resolve(r)};try{const{data:n}=await a.query({query:cte,variables:{scope:dte.Personal,appId:t},context:{callerInfo:`${e}PreWarmStrategy`}}),{appDefinition:r}=n;s?.mark(ute.markers.app_prewarm_app_definition_received);const d=r?.staticTabs&&r?.staticTabs[0]?.contentUrl||"";s?.mark(ute.markers.app_prewarm_content_url_received);const u=d.split("hosted/").join(""),m=((e,t)=>{const n=e.document.createElement("iframe");return n&&(n.setAttribute("id",t?`${t}Iframe`:"prewarmAppIframe"),n.style.display="none",n.setAttribute("target","_self"),e.document.body.appendChild(n)),n&&n.contentWindow||null})(o,e);m||(s?.mark(ute.markers.app_prewarm_window_creation_failed),s?.fail({errorMessage:"Failed to create iframe"}),s?.incomplete({reason:"Failed to create iframe"}),Promise.resolve()),s?.mark(ute.markers.app_prewarm_window_creation_successful),await(async(e,t,n,i)=>{const a=new URL(t).origin,o=await n({resource:a});if(o&&e){const n=e.document.createElement("input");n.setAttribute("type","hidden"),n.setAttribute("name","access_token"),n.setAttribute("value",o);const a=e.document.createElement("form");a.appendChild(n),a.setAttribute("action",t),a.setAttribute("method","POST"),e.document.body.appendChild(a),a.submit(),i?.mark("Form Created and submitted")}else i?.fail({errorMessage:"Token fetch failed"})})(m,u,c,s),((e,t,n)=>{let i,a=12e3;e&&e>0&&(a=e),i=void 0,i=t.setTimeout((()=>{n(!0),t.clearTimeout(i)}),a)})(18e3,o,l);const p=`${Math.random().toFixed(8)}`,g=await((e,t,n)=>{let i;return new Promise(((a,o)=>{let r;const s=e=>{if(e.source&&t&&e.source===t&&"initialize"===e.data.type){r&&(clearInterval(r),r=void 0);const t=e.ports&&e.ports[0];if(t)return i=t,void a(i);o(i)}};t?(r=setInterval((()=>{i?(clearInterval(r),r=void 0):t.postMessage({type:"identify-parent",channelId:e},n.document.location?.origin)}),100),n.addEventListener("message",s)):a(i)}))})(p,m,o),h=((e,t,n,i)=>({close:async()=>{n?.log("Close post meessage received"),i?.mark(ute.markers.app_prewarm_close_post_message),await t(!1)},authenticate:async t=>{n?.log(`Authenticate post meessage received for ${t.resource}`),i?.mark(ute.markers.app_prewarm_auth_post_message);const a=await e({resource:t.resource});return a?{result:"token",scheme:"bearer",token:a}:(n?.log("Not able to PreWarm the App"),i?.mark(ute.markers.app_prewarm_auth_token_failed),{result:"error",error:{code:"NoTokenObtained",message:"Could not obtain a token for resource."}})}}))(c,l,i,s);yte(g,h,i)}catch(t){const n=`Failed ${e} PreWarmStrategy with errorCode ${t?.errorCode||t?.code}`;i.error?.(n),s?.fail({reason:n})}},fte=e=>{const{client:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,windowProvider:o}=e,r=a.findScenario(H.RG.AppPreWarm),{enablePreWarmAppsJob:s}=n.get(b.J.Core);return s?[{id:"app-pre-load-job",runOncePerId:!0,job:async()=>{r?.mark("preWarmApps job pushed"),r?.mark("Job Pushed",{reason:"Job Pushed"}),await(async(e,t,n,i,a)=>{const o=t.newLogger("AppPreWarmStrategy","apps-pre-warm"),r=a.get(b.J.Core).appConfigForPreWarm;r?.forEach((t=>{const{appName:r,appId:s}=t;vte(r,s,e,o,n,i,a)}))})(a,i,t,o,n)}}]:[]},Ste=({context:e})=>{const t=e.scenarioFactory.newScenario(H.RG.AppPreWarm);t.mark("OnIdle triggered for app pre-warm jobs"),t.mark("Job triggered",{reason:"Job Triggered"});return fte(e).map((e=>({...e,id:e.id})))},kte={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsPlatformAppAppsLastSyncTimeEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appsLastSyncTimeEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}},{kind:"Field",name:{kind:"Name",value:"reason"}}]}}]}}]},Cte=e=>({id:"apps-sync-subscription",runOncePerId:!0,job:()=>{const{client:t,coreSettings:n,loggerFactory:i}=e,{enableAppsDynamicCacheEviction:a,enableNewAdminPreinstalledAppCoachmark:o,appsDynamicCacheEvictionConfig:r}=n.get(b.J.Extensibility);if(!a||!r)return;const s=i.newLogger("createAppsSyncSubscriptionJob","apps-platform-app"),l=t.subscribe({query:kte}).subscribe((({data:n})=>{if(n?.appsLastSyncTimeEvent&&r[n.appsLastSyncTimeEvent.type])try{const{broadcast:i,fieldNames:a,validSyncReasons:l}=r[n.appsLastSyncTimeEvent.type];if(l&&!l.includes(n.appsLastSyncTimeEvent.reason??""))return;a.forEach((e=>{t.cache.evict({fieldName:e,broadcast:i})})),s.infoToTelemetry?.(`${n.appsLastSyncTimeEvent.type} cache got evicted for the following reason ${n.appsLastSyncTimeEvent.reason}`,"platform_apps_sync_subscription_job",void 0,!0),o&&"InstalledApp"===n.appsLastSyncTimeEvent.type&&e.entityCommanding.esp.displaySurface("newAdminPreinstalledAppCoachmark")}catch(e){s.errorToTelemetry?.(`${n.appsLastSyncTimeEvent.type} cache failed to evict: ${e}`,"platform_apps_sync_subscription_job",void 0,!0)}}));return()=>l.unsubscribe()}}),bte=({context:e})=>[Cte(e)],wte=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(591878),n.e(986797),n.e(393890),n.e(865804),n.e(152739),n.e(120894),n.e(664625),n.e(714650),n.e(440413),n.e(232410),n.e(807365),n.e(928362),n.e(652421),n.e(324415),n.e(241070),n.e(730056),n.e(400685),n.e(437414),n.e(685827),n.e(474133),n.e(609660),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(6348),n.e(931930),n.e(608462),n.e(187591),n.e(420137),n.e(360941)]).then(n.bind(n,576618)),Tte=()=>Promise.all([n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(393890),n.e(75298),n.e(152739),n.e(664625),n.e(933161),n.e(682492),n.e(891369),n.e(440413),n.e(732691),n.e(809416),n.e(981041),n.e(479236),n.e(180830),n.e(345213),n.e(609787),n.e(232410),n.e(689835),n.e(225062),n.e(928362),n.e(652421),n.e(841342),n.e(324415),n.e(730056),n.e(400685),n.e(685827),n.e(474133),n.e(609660),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(258544),n.e(6348),n.e(782721),n.e(376960),n.e(146244),n.e(931930),n.e(109515),n.e(187591),n.e(38878),n.e(701227),n.e(657060),n.e(420137),n.e(623025),n.e(559067)]).then(n.bind(n,195575)),Ite=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(84274),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(152739),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(397833),n.e(314991),n.e(933161),n.e(540003),n.e(812934),n.e(51724),n.e(564211),n.e(392718),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(635026),n.e(732691),n.e(809416),n.e(788241),n.e(438152),n.e(729265),n.e(157477),n.e(130631),n.e(228737),n.e(981041),n.e(233171),n.e(672822),n.e(462698),n.e(83395),n.e(479236),n.e(180830),n.e(345213),n.e(92103),n.e(588134),n.e(232410),n.e(845807),n.e(659070),n.e(646036),n.e(947488),n.e(619140),n.e(940986),n.e(193775),n.e(971924),n.e(928362),n.e(652421),n.e(213629),n.e(796594),n.e(68021),n.e(475063),n.e(958163),n.e(324415),n.e(730056),n.e(585815),n.e(400685),n.e(161143),n.e(175953),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(6348),n.e(65722),n.e(376960),n.e(146244),n.e(931930),n.e(550701),n.e(109515),n.e(187591),n.e(482266),n.e(439571),n.e(701227),n.e(657060),n.e(420137),n.e(576911),n.e(468573),n.e(429812),n.e(401816),n.e(119288),n.e(79957),n.e(572474),n.e(588919)]).then(n.bind(n,358153)),Nte=({coreServices:e,host:t,screenState:n})=>{const{disablePlatformAppWindowFeatures:i,enablePlatformAppLargePopout:a}=e?.coreSettings.get(b.J.Extensibility)||{},o=t?.screen;if(i||!o)return null;const{minHeight:r,minWidth:s,offset:l=1,height:c=0,width:d=0}=ote.windowFeatures||{};let u,m,p,g;const h=((n?.numOpenWindows||1)-1)*l;if(a){const t=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=ote.windowFeatures||{};let{width:a=i,height:o=n}=ote.windowFeatures||{};if(!t)return{height:o,width:a};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:c}=t.coreSettings.get(b.J.Calling);if(s&&l&&c)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=c*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/c*a}return{height:o,width:a}})(o,e),n=((e,t,n)=>{const i=ote.windowFeatures.offset||0,a="availLeft"in e&&e.availLeft||0,o="availTop"in e&&e.availTop||0,r=a+e.availWidth/2-t/2;let s;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":s=o+i;break;default:s=o+e.availHeight/2-n/2}return{left:r,top:s}})(o,t.width,t.height);u=t.height,m=t.width,p=n.left,g=n.top}else{const e={left:t?.screenX||0,top:t?.screenY||0};u=c,m=d,p=e.left,g=e.top}return{additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},left:p+h,top:g+h,minHeight:r,minWidth:s,height:u,width:m}};function Ete(){const e=()=>null;return{getAppPhases:rte,getAppViewEntities:Qee,getAppWindowFeatures:Nte,getPlatformAppIdForEntity:e=>{if(e.type===Se.py.extensions){const{appId:t}=e.id&&JSON.parse(e.id);return t}},getAppViewEntitiesProps:ate,onBeforeDeeplinkParsed:Ree,manifest:ote,onCommandReceived:Wee,onRegister:e=>{e.registerTask(new ul)},render:async({appRenderMode:t,scenarioFactory:n,onRenderEvent:i})=>{switch(t){case Mt.S.Modal:{const e="platform-modal",{Modal:t}=await(0,ac.mT)(Ite,e,n);return(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(t,{})})}case Mt.S.HorizontalBar:case Mt.S.Main:{const e="platform-app",a=n?.findScenario(H.RG.PlatformTabFrameLoading);a?.currentStep!==H.ck.PlatformTabRenderAfterChunkLoad&&(a?.mark(H.ck.PlatformTabRenderBeforeChunkLoad),a?.startStep(H.ck.PlatformTabRenderAfterChunkLoad)),i("ChunkLoadStarted",{chunkName:e});const{PlatformAppViewsEntryRenderer:o}=await(0,ac.mT)(Tte,e,n);return i("ChunkLoadSucceeded",{chunkName:e}),a?.currentStep===H.ck.PlatformTabRenderAfterChunkLoad&&a?.mark(H.ck.PlatformTabRenderAfterChunkLoad),(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(o,{appRenderMode:t})})}case Mt.S.Rail:{const e="platform-app-rail",{PlatformTabPanel:t}=await(0,ac.mT)(wte,e,n);return(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(t,{})})}default:return(0,gO.t)(e,{})}},eventHandlers:Jee,onPreWarm:ste,onUserWindowPreWarm:bte,onIdle:Ste}}const Ate={id:"com.microsoft.teams.presenter-toolbar",name:"PresenterToolbarApp",supportedEntities:[Se.py.presentertoolbar],supportedRenderModes:[Mt.S.Main],windowFeatures:{height:59,width:480,offset:-2}},_te=e=>{if(Fte(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:Dte(e),endEntity:null}},Fte=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===Se.py.presentertoolbar,a=t===Se.uk.view;return Boolean(i&&a)},Dte=({entity:e})=>e,Pte=()=>({mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0,disableBorderInHighContrast:!0}}}),Mte=()=>Promise.all([n.e(474133),n.e(450367),n.e(782721),n.e(471521)]).then(n.bind(n,121354)),xte=({host:e,coreServices:t})=>{const n=e?.screen;if(!n)return null;const i=Ate.windowFeatures.width||480,a=Ate.windowFeatures.height||60,o=Ate.windowFeatures.offset||10,r=("availLeft"in n?n.availLeft:0)+n.availWidth/2-i/2,s=t?.coreSettings.get(b.J.Calling).disableContentprotection,l=(!s).toString();return{additionalFeatures:{alwaysOnTop:"true",closable:"false",excludeWindowFromScreenSharing:l,fullscreenable:"false",maximizable:"false",minimizable:"false",resizable:"false",movable:"false",hideWindowControl:"true",frame:"false",closeoverride:"true",contentprotection:l,transparent:"true",show:"false",visibleOnAllWorkspaces:"true"},top:o,left:r,width:i,height:a}};function Rte(){const e=()=>null;return{getAppViewEntities:_te,getAppViewEntitiesProps:Pte,getAppWindowFeatures:xte,manifest:Ate,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===Mt.S.Main&&n===Se.py.presentertoolbar){const{PresenterToolbar:e}=await(0,ac.mT)(Mte,"presenter-toolbar-app",i);return(0,gO.t)(e,{})}return(0,gO.t)(e,{})}}}const jte=({action:e,appRenderMode:t,coreSettings:n})=>{const i=new MV.H,{queuesAppPhaseTimeouts:a}=n.get(b.J.Queues),o=[],r=[];switch(t){case Mt.S.Rail:Ote({action:e,criticalSignals:o,postCriticalSignals:r,featureFlags:{}});break;case Mt.S.Main:$te({action:e,criticalSignals:o,postCriticalSignals:r,featureFlags:{}});break;case Mt.S.HorizontalBar:Lte({action:e,criticalSignals:o,postCriticalSignals:r,featureFlags:{}})}return i.registerAppPhase({phase:yt.nh.CRITICAL,signals:o,timeout:a?.critical||6e4}),i.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:r,timeout:a?.postCritical||1e4}),i.appPhases},Lte=({criticalSignals:e})=>{e.push(xV.G.QUEUES_APP_HEADER_STARTED),e.push(xV.G.QUEUES_APP_HEADER_RENDERED)},Ote=({action:e,criticalSignals:t})=>{e===Se.uk.view&&(t.push(xV.G.QUEUES_APP_LEFT_STARTED),t.push(xV.G.QUEUES_APP_LEFT_RENDERED))},$te=({criticalSignals:e})=>{e.push(xV.G.QUEUES_APP_CENTER_STARTED),e.push(xV.G.QUEUES_APP_CENTER_RENDERED)},Ute=e=>{if(Wte(e))return Hte(e)?{subNavEntity:Vte(e),headerEntity:Gte(e),startEntity:zte(e),mainEntity:qte(e),endEntity:Jte(e)}:null},Bte=()=>{const e=new Map([[wH.Rd.IS_AT_LEAST_947,"33rem"],[wH.Rd.IS_AT_LEAST_1350,"37rem"],[wH.Rd.IS_AT_LEAST_1500,"41rem"]]);return{startEntity:{[Mt.S.Rail]:{slotWidthOverrides:e}}}},Wte=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.queuesanalyticsheadertab,Se.py.queuesanalyticsrealtimenavigationitem,Se.py.queuesanalyticshistoricalnavigationitem,Se.py.queues,Se.py.queueuser,Se.py.callhistoryrow].includes(i),r=[Se.uk.info,Se.uk.default,Se.uk.list,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},Hte=()=>!0,Vte=()=>null,Gte=({entity:e})=>e,zte=({entity:e})=>e,qte=({entity:e})=>e,Jte=()=>null,Qte={id:"com.microsoft.teams.queues",name:"Queues",actors:[zB],supportedEntities:[Se.py.queues,Se.py.queueuser,Se.py.queuesanalyticsheadertab,Se.py.queuesanalyticsrealtimenavigationitem,Se.py.queuesanalyticshistoricalnavigationitem,Se.py.callhistoryrow],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Rail,Mt.S.Main],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600},getDefaultCommand:()=>({type:Se.py.queues,action:Se.uk.default})};var Kte=n(58565);const Yte=(e,t)=>{const n={visibilityState:ke.fe.show,stateTransition:ke.su.flush},i=t.newLogger("QueuesApp onCommandReceived","apps-queues");if(!Xte(e))return a=`Command '${iW}' requires 'callQueueId' in data`,void i.errorToTelemetry?.(a,"cmd_queues_on_command_received",void 0,!0);var a;const o=e;return o.isSupervisorAndNotAgent?{entity:{type:Se.py.settingsstorecallqueue,action:Se.uk.view,id:o.callQueueId},entityOptions:{callSettingsTabParams:{category:"callQueue",authorizedSettings:{id:o.callQueueId}}},command:{...n,correlation:{source:C.D.QueuesAnalyticsMain}}}:{entity:{type:Se.py.settingsstorecallqueue,action:Se.uk.view,id:o.callQueueId},entityOptions:{callSettingsTabParams:{category:"callQueue",agentCallQueueSetting:{id:o.callQueueId}}},command:{...n,correlation:{source:C.D.QueuesAnalyticsMain}}}},Xte=e=>{const{callQueueId:t}=e;return!!t},Zte=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n,data:i}}=e,a=t.newLogger("QueuesApp onCommandReceived","apps-queues"),o=e=>{a.errorToTelemetry?.(e,"cmd_queues_on_command_received",void 0,!0)};if(e.command.actor===zB)switch(n){case qB:return{entity:{type:Se.py.queues,action:Se.uk.default},command:{...ene,correlation:{source:C.D.Unknown}}};case JB:return{entity:{type:Se.py.queues,action:Se.uk.view},command:{...ene,correlation:{source:C.D.Unknown}}};case QB:if(!tne(i))return void o(`Command '${QB}' requires 'callQueueId' in data`);const e=i;return{entity:{type:Se.py.queues,action:Se.uk.view,id:JSON.stringify({callQueueId:e.callQueueId,itemType:Kte.qG.Queue,isSupervisor:e.isSupervisor,isSupervisorAndAgent:e.isSupervisorAndAgent,channelId:e.channelId})},command:{...ene,correlation:{source:C.D.QueuesAppHeader}}};case XB:return{entity:{type:Se.py.queuesanalyticsheadertab,action:Se.uk.view},command:{...ene,correlation:{source:C.D.QueuesAppHeader}}};case ZB:return i&&i.realTimeAnalyticsSelectedItemId?{entity:{type:Se.py.queuesanalyticsrealtimenavigationitem,action:Se.uk.view,id:i.realTimeAnalyticsSelectedItemId},command:{...ene,correlation:{source:C.D.QueuesAnalyticsLeftNavigation}}}:void o(`Command '${ZB}' requires 'realTimeAnalyticsSelectedItemId' in data`);case eW:return i&&i.historicalAnalyticsSelectedItemId?{entity:{type:Se.py.queuesanalyticshistoricalnavigationitem,action:Se.uk.view,id:i.historicalAnalyticsSelectedItemId},command:{...ene,correlation:{source:C.D.QueuesAnalyticsLeftNavigation}}}:void o(`Command '${eW}' requires 'historicalAnalyticsSelectedItemId' in data`);case KB:if(!nne(i))return void o(`Command '${KB}' requires 'userId' and 'callQueueId' in data`);const a=i;return{entity:{type:Se.py.queueuser,action:Se.uk.view,id:JSON.stringify({callQueueId:a.callQueueId,userId:a.userId,isSupervisor:a.isSupervisor,showAnalyticsData:a.showAnalyticsData,itemType:a.itemType,showMonitorButton:a.showMonitorButton,monitorSessionTargetUserId:a.monitorSessionTargetUserId})},command:{...ene,correlation:{source:C.D.QueuesPeopleManagement}}};case YB:if(!i||!i.callQueueId||!i.row)return void o(`Command '${YB}' requires 'row' and 'callQueueId' in data`);const r=i;return{entity:{type:Se.py.callhistoryrow,action:Se.uk.view,id:JSON.stringify({callQueueId:r.callQueueId,messageId:r.row?.messageId})},entityOptions:r,command:{...ene,correlation:{source:C.D.CallHistory}}};case tW:if(!ine(i))return void o(`Command '${tW}' requires 'callQueueId' and 'itemType' in data`);const s=i;return{entity:{type:Se.py.queues,action:Se.uk.view,id:JSON.stringify({callQueueId:s.callQueueId,itemType:s.itemType,isSupervisor:s.isSupervisor,isSupervisorAndAgent:s.isSupervisorAndAgent,channelId:s.channelId})},command:{...ene,correlation:{source:C.D.QueuesAppQuickAccess}}};case nW:if(!ane(i))return void o(`Command '${nW}' requires 'callQueueId' and 'channelId' in data`);const l=i;return{entity:{type:Se.py.callablechannels,action:Se.uk.list,id:l.callQueueId,linkedEntity:{id:l.channelId,type:Se.py.channels}},command:{...ene,correlation:{source:C.D.QueuesAnalyticsMain}}};case iW:return Yte(i,t);default:o(`Command action '${n}' is not supported by QueuesApp`)}else o(`Command for actor '${e.command.actor}' cannot be handled by QueuesApp`)},ene={visibilityState:ke.fe.show,stateTransition:ke.su.flush},tne=e=>{const{callQueueId:t}=e||{};return!!t},nne=e=>{const{userId:t,callQueueId:n}=e||{};return!!t&&!!n},ine=e=>{const{callQueueId:t,itemType:n}=e||{};return!!t&&!!n},ane=e=>{const{channelId:t,callQueueId:n}=e||{};return!!t&&!!n},one=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(242213),n.e(438152),n.e(593837),n.e(309799),n.e(233171),n.e(289814),n.e(672822),n.e(727035),n.e(364592),n.e(532863),n.e(618412),n.e(115829),n.e(577037),n.e(442606),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(625402),n.e(893829),n.e(274),n.e(758354),n.e(776677),n.e(34607),n.e(431543),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(284523),n.e(617758),n.e(792751),n.e(737885),n.e(800866)]).then(n.bind(n,100111)),rne=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(65537),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(933161),n.e(128770),n.e(649800),n.e(663276),n.e(553940),n.e(857282),n.e(310307),n.e(242213),n.e(438152),n.e(593837),n.e(309799),n.e(233171),n.e(289814),n.e(672822),n.e(727035),n.e(364592),n.e(532863),n.e(618412),n.e(115829),n.e(577037),n.e(442606),n.e(928362),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(625402),n.e(893829),n.e(274),n.e(758354),n.e(776677),n.e(34607),n.e(431543),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(968147),n.e(34671),n.e(230050),n.e(700818),n.e(986305),n.e(458629),n.e(414720),n.e(837458),n.e(284523),n.e(617758),n.e(792751),n.e(737885),n.e(800866)]).then(n.bind(n,450812)),sne={onEventReceived:({eventInput:{event:e},requestContext:{loggerFactory:t}})=>{const n=t.newLogger("QueuesApp eventHandlers","apps-queues"),{data:i}=e,a="function"==typeof i?i():{};if((0,Kte.xt)(e)){const e=a;return!!e.callQueueId?Promise.resolve({command:lW(e)}):(n.error("No callQueueId in event data"),Promise.resolve(void 0))}if((0,Kte.E3)(e)){const e=a;return!(!e.userId||!e.callQueueId)?Promise.resolve({command:cW(e)}):(n.error("No userId or callQueueId in event data"),Promise.resolve(void 0))}if((0,Kte.gz)(e))return Promise.resolve({command:oW()});if((0,Kte.zB)(e)){const e=a;return e.realTimeAnalyticsSelectedItemId?Promise.resolve({command:rW(e)}):(n.error("No queues app analytics tab left rail real time select item id"),Promise.resolve(void 0))}if((0,Kte.iX)(e)){const e=a;return e.historicalAnalyticsSelectedItemId?Promise.resolve({command:sW(e)}):(n.error("No queues app analytics tab left rail real time select item id"),Promise.resolve(void 0))}if((0,Kte.O8)(e)){const e=a;return!(!e.row||!e.callQueueId)?Promise.resolve({command:dW(e)}):(n.error("No call history row or callQueueId in event data"),Promise.resolve(void 0))}if((0,Kte.xV)(e)){const e=a;return e.callQueueId?e.itemType?Promise.resolve({command:uW(e)}):(n.error("No itemType in event data"),Promise.resolve(void 0)):(n.error("No callQueueId in event data"),Promise.resolve(void 0))}if((0,Kte.ix)(e)){const e=a;return e.callQueueId&&e.channelId?Promise.resolve({command:mW(e)}):(n.error("No callQueueId or channelId in event data"),Promise.resolve(void 0))}if((0,Kte._K)(e)){const e=a;return e.callQueueId?Promise.resolve({command:pW(e)}):(n.error("No callQueueId in event data"),Promise.resolve(void 0))}return Promise.resolve(void 0)}},lne={shouldAddEntitiesToWindowHistory:()=>!0,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:e=>e.type!==Se.py.callhistoryrow},cne=()=>Qte.windowFeatures||{},dne=()=>H.RG.QueuesAppSwitch;function une(){return{eventHandlers:sne,getAppPhases:jte,getAppViewEntities:Ute,getAppViewEntitiesProps:Bte,getAppWindowFeatures:cne,getCommandScenarioName:dne,getPlatformAppIdForEntity:e=>Qte.supportedEntities.includes(e.type)?"a02e4d17-af86-4ceb-9c97-4c2626eb3587":void 0,manifest:Qte,onCommandReceived:Zte,onBeforeAddToNavigation:lne,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const{QueuesAppViewsRenderer:i,LPC:a}=await(async(e,t)=>{const n="queues-app";t("ChunkLoadStarted",{chunkName:n});const[{QueuesAppViewsRenderer:i},{LPC:a}]=await Promise.all([(0,ac.mT)(one,n,e),(0,ac.mT)(rne,n,e)]);return t("ChunkLoadSucceeded",{chunkName:n}),{QueuesAppViewsRenderer:i,LPC:a}})(n,t);return(0,gO.t)(ez.f,{namespaces:["queues"],loaderRenderer:null,children:(0,gO.t)(a,{children:(0,gO.t)(rJ.p3,{children:(0,gO.t)(i,{appRenderMode:e})})})})}}}const mne={id:"com.microsoft.teams.public-preview",name:"PublicPreviewApp",supportedEntities:void 0,supportedRenderModes:[Mt.S.Main]};function pne(e,t){const{coreSettings:n}=t,{publicPreviewOfficeChannels:i}=n.get(b.J.Core,["publicPreviewOfficeChannels"]);return i?.includes(e)}const gne=({context:{coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,platformService:s,networkState:l,entityCommanding:c,config:d,clientState:u,rebootService:m,userTrackingService:p}})=>{const g=[],{enablePublicPreviewTACSettings:h}=e.get(b.J.Core),{ring:y}=e.get(b.J.Metadata,["ring"]);return"ring3_6"===y?.id&&s.ecsOverrides.isAssignedRing||h&&g.push(function(e){const{coreSettings:t,hostCommunicationService:n,scenarioFactory:i}=e;return{id:"public-preview-policy-job",runOncePerId:!0,job:async()=>{const a=i.newScenario(H.RG.PublicPreviewPolicyJob);a.mark(H.RG.PublicPreviewPolicyJob);const o=await n.loadModule("publicpreview");if(!o)return void a.fail({reason:"Could not get hostComms"});const{allowPublicPreview:r}=t.get(b.J.Core,["allowPublicPreview"]),{ring:s}=t.get(b.J.Metadata,["ring"]);switch(a.appendEventData({publicPreviewPolicy:r?.toString(),ring:s?.id?.toString()}),r){case"Forced":if("general"===s?.id){if(await(o.setNextLaunchIsPublicPreview?.(!0)))return void a.stop({result:"public_preview set to true",reason:"Policy is Forced and ring is general"});a.fail({reason:"No result from setNextLaunchIsPublicPreview"})}else a.stop({result:"public_preview not modified",reason:"Policy is Forced, but ring is not general"});break;case"FollowOfficePreview":if("general"===s?.id){const t=await(o.getOfficePreviewChannel?.());return a.appendEventData({officePreviewChannel:t}),t?pne(t,e)?await(o.setNextLaunchIsPublicPreview?.(!0))?void a.stop({result:"public_preview set to true",reason:"Policy is FollowOfficePreview and officeChannel is a preview channel"}):void a.fail({reason:"No result from setNextLaunchIsPublicPreview"}):void a.stop({result:"public_preview not modified",reason:"Policy is FollowOfficePreview, ring is general, but officeChannel is not a preview channel"}):void a.fail({reason:"No result from getOfficePreviewChannel"})}if("ring3_6"===s?.id){const t=await(o.getOfficePreviewChannel?.());return a.appendEventData({officePreviewChannel:t}),t?pne(t,e)?void a.stop({result:"public_preview not modified",reason:"Policy is FollowOfficePreview and officeChannel is a preview channel, but ring is already ring3_6"}):await(o.setNextLaunchIsPublicPreview?.(!1))?void a.stop({result:"public_preview set to false",reason:"Policy is FollowOfficePreview and officeChannel is not a preview channel"}):void a.fail({reason:"No result from setNextLaunchIsPublicPreview"}):void a.fail({reason:"No result from getOfficePreviewChannel"})}a.stop({result:"public_preview not modified",reason:"Policy is FollowOfficePreview, but ring is not ring3_6 or general"});break;case"Enabled":a.stop({result:"public_preview not modified",reason:"Policy is Enabled, so public_preview can be set by the user via the UI element"});break;case"Disabled":if("ring3_6"===s?.id){if(await(o.setNextLaunchIsPublicPreview?.(!1)))return void a.stop({result:"public_preview set to false",reason:"Policy is Disabled, and user is in ring3_6"});a.fail({reason:"No result from setNextLaunchIsPublicPreview"})}else a.stop({result:"public_preview not modified",reason:"Policy is Disabled, but user is not in ring3_6"});break;default:a.stop({result:"public_preview not modified",reason:`allowPublicPreview value is an unknown value: ${r}`})}}}}({coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,platformService:s,networkState:l,entityCommanding:c,config:d,clientState:u,rebootService:m,userTrackingService:p})),g};const hne=()=>null,yne={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}},vne=()=>Promise.all([n.e(154943),n.e(46725),n.e(729788),n.e(341117),n.e(537703),n.e(586060)]).then(n.bind(n,137060)),fne=e=>({id:"search-data-load",runOncePerId:!0,job:async()=>{const t=e.newLogger("dataResolverSearchJob","apps-search");t.log("[dataResolversSearchJob] Initializing calling service");try{await(0,ac.mT)(vne,"search-data-resolvers")}catch(e){t.error("[dataResolversSearch] Error initializing bundle")}t.log("[dataResolversSearch] Calling service initialized")}}),Sne=({context:{loggerFactory:e}})=>[fne(e)];var kne=n(680864),Cne=n(749476);const bne=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(128770),n.e(812934),n.e(649800),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(553940),n.e(136462),n.e(732691),n.e(809416),n.e(857282),n.e(677361),n.e(384701),n.e(253385),n.e(729265),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(374968),n.e(479236),n.e(278841),n.e(64047),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(68021),n.e(600213),n.e(634446),n.e(461991),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(230050),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(482266),n.e(424584),n.e(456476),n.e(7090),n.e(456904)]).then(n.bind(n,928276)),wne=()=>Promise.all([n.e(341117),n.e(79506)]).then(n.bind(n,37919)),Tne="backButton",Ine="search-app",Nne=async e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i},command:{stateTransition:a}},requestContext:o}=e,{client:r,coreSettings:s}=o,{enablePretriggerImprovement:l,enableAnswersV2:c}=s?.get(b.J.Serp),d=t.entityOptions||{},u=d.loadBundle,m=d.substrateSearchWarmUpInExpRenderer;if(n===Se.py.search&&i===Se.uk.view&&u)return await async function(e,t){t?(0,ac.mT)(Cne.KL,"search-answer-v2"):(0,ac.mT)(kne.tY,"search-answer");Ene(e)}(o,!!c),Promise.resolve(void 0);if(n===Se.py.search&&i===Se.uk.view&&m){const{enableSerpServiceWarmupOnPowerBarClick:e}=s?.get(b.J.Serp);if(e)await Ene(o);else{const{searchWarmup:e}=await(0,ac.mT)(bne,Ine);await r.query({query:e,variables:{scenario:"powerbar",cvid:d.conversationId}})}return Promise.resolve(void 0)}if(l&&n===Se.py.search&&i===Se.uk.view&&"flush"===a&&"TabSwitch"!==d.entrySource){const{searchQuery:e,logicalId:t,conversationId:n,entrySource:i,navLocationContext:a,currentTab:o,filterSet:l}=d,{enableNavLocationContext:c}=s?.get(b.J.Serp),u=i===Tne,{searchServiceCache:m,Tabs:p}=await(0,ac.mT)(wne,"services-io-search");m.clearAll(),c&&a&&m.setNavLocationContext(a);const g=(0,Re.v4)(),h=(0,Re.v4)();m.setUpstreamTelmetryIds(g,h);const{searchPreTriggerQuery:y,numberOfAllPageResults:v}=await(0,ac.mT)(bne,Ine);await r.query({query:y,variables:{searchTerm:e,noOfResults:v,pageNumber:0,correlationId:g,allFilters:l?l[p.All]:{},messageFilters:l?l[p.Messages]:{},searchStartCorrelationId:h,currentTab:o,isBackButton:u,conversationId:n,logicalId:t}})}return Promise.resolve(t)};async function Ene(e){const{client:t,coreSettings:n}=e,{enableSerpServiceToPrewarm:i}=n?.get(b.J.Serp),{pingSearch:a}=await(0,ac.mT)(bne,Ine);i&&await t.mutate({mutation:a,variables:{correlationId:(0,Re.v4)()}})}const Ane=({appRenderMode:e})=>{const t=new MV.H,n=[],i=[];if(e===Mt.S.Main)_ne({featureFlags:{},criticalSignals:n,postCriticalSignals:i});return t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:1e4}),t.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:i,timeout:1e4}),t.appPhases},_ne=({criticalSignals:e})=>{e.push(xV.G.SEARCH_RESULTS_RENDERED)},Fne=e=>{if(Dne(e))return Pne(e)?{subNavEntity:Mne(e),headerEntity:xne(e),startEntity:Rne(e),mainEntity:jne(e),endEntity:Lne(e)}:null},Dne=({contextEntity:e,entity:t,layoutMode:n})=>{const{action:i=null,type:a}={...t},o=[ke.lO.focus,ke.lO.standard].includes(n),r=[Se.py.search,Se.py.openfeedbackdialog].includes(a),s=[Se.uk.default,Se.uk.view],l=i&&s.includes(i),c=e&&e.action&&e.type===Se.py.chats;return!(!o||!r||!l&&!c)},Pne=()=>!0,Mne=()=>null,xne=({contextEntity:e})=>e&&e.action&&e.type===Se.py.chats?e:null,Rne=()=>null,jne=({entity:e,contextEntity:t})=>t&&t.action&&t.type===Se.py.chats?t:e,Lne=()=>null,One={id:"com.microsoft.teams.search",name:"Search",getLocalizedName:async e=>(await e.waitForNamespace("search"),e.stringTranslate("search","search_app_name")),supportedEntities:[Se.py.search,Se.py.openfeedbackdialog],supportedRenderModes:[Mt.S.Main,Mt.S.Modal],windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3}},$ne={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSearchFloodgateLogActivityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activityName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"increment"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floodgateLogActivity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"activityName"},value:{kind:"Variable",name:{kind:"Name",value:"activityName"}}},{kind:"Argument",name:{kind:"Name",value:"increment"},value:{kind:"Variable",name:{kind:"Name",value:"increment"}}}]}]}}]};class Une extends _e{constructor(){super(h.Yg.LogActivityTask,["client","hostCommunicationService","coreSettings","loggerFactory"])}async execute(e){const{client:t,hostCommunicationService:n,coreSettings:i,loggerFactory:a}=e,o=i?.get(b.J.Serp).enableAutosuggestFps||!1,r=i?.get(b.J.SurveyForm).enableCsatTaskRegistration;if(o&&!r){const e=await(n?.loadModule("search")),i=a.newLogger("LogActivityTaskRegistered","apps-search");e?.registerForLogActivity?.((e=>{i.log(`activity ${e.activityName} and increment ${e.incrementValue}`),"teamsSearchFps"===e.activityName&&(e=>{e.mutate({mutation:$ne,variables:{activityName:"teamsSearchFps",increment:1}})})(t)}))}}}var Bne=n(963594);const Wne=(e,t,n)=>{const{userPreferences:i,coreSettings:a,layoutMode:o}=t,r=e.mainEntity,s=a?.get(b.J.Serp)?.enableBackButtonFixForTabSwitch;if(!s||!r)return;Bne.P.clear();const l=JSON.stringify({...JSON.parse(r.options||"{}"),entrySource:Tne});return Fne({contextEntity:null,coreSettings:a,entity:{...r,options:l},layoutMode:o,userPreferences:i})},Hne=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(128770),n.e(812934),n.e(649800),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(553940),n.e(136462),n.e(732691),n.e(809416),n.e(857282),n.e(677361),n.e(384701),n.e(253385),n.e(729265),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(374968),n.e(479236),n.e(278841),n.e(64047),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(68021),n.e(600213),n.e(634446),n.e(461991),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(230050),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(482266),n.e(424584),n.e(456476),n.e(7090),n.e(456904)]).then(n.bind(n,928276)),Vne=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(766254),n.e(666384),n.e(664625),n.e(253400),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(128770),n.e(812934),n.e(649800),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(553940),n.e(136462),n.e(732691),n.e(809416),n.e(857282),n.e(677361),n.e(384701),n.e(253385),n.e(729265),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(374968),n.e(479236),n.e(278841),n.e(64047),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(68021),n.e(600213),n.e(634446),n.e(461991),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(230050),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(830648),n.e(198863),n.e(482266),n.e(424584),n.e(456476),n.e(7090),n.e(456904)]).then(n.bind(n,450812)),Gne=()=>Promise.all([n.e(919583),n.e(769415)]).then(n.bind(n,948090)),zne=()=>One.windowFeatures||{};function qne(){const e=()=>null;return{eventHandlers:yne,getAppPhases:Ane,onRegister:e=>{e.registerTask(new ul),e.registerTask(new Une)},getAppViewEntities:Fne,getAppWindowFeatures:zne,manifest:One,render:async({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a,loggerFactory:o})=>{if(t===Mt.S.Main){const e="search-app";i("ChunkLoadStarted",{chunkName:e});const{SearchViewsRenderer:t}=await(0,ac.mT)(Hne,e),{enableEntityMoreInfo:a}=n.get(b.J.Core),o=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),{LPC:r}=a?{LPC:o}:await(0,ac.mT)(Vne,e),s=a?o:rJ.p3;i("ChunkLoadSucceeded",{chunkName:e});const l="search";return(0,gO.t)(ez.f,{namespace:"messaging",loaderRenderer:null,children:(0,gO.t)(r,{appName:l,children:(0,gO.t)(s,{children:(0,gO.t)(t,{})})})})}if(t===Mt.S.Modal){const e="feedback-renderer",t=o.newLogger(e,"apps-search");try{i("ChunkLoadStarted",{chunkName:e});const{FeedbackDialog:t}=await(0,ac.mT)(Gne,e,a);return i("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(t,{})}catch(e){t.error(`chunk load failed with ${e}`)}}return(0,gO.t)(e,{})},onPreWarm:Sne,onBeforeCommandHandled:Nne,onBeforeNavigationFromHistory:Wne}}const Jne=e=>{if(Qne(e))return Kne(e)?{subNavEntity:Yne(e),headerEntity:Xne(e),startEntity:Zne(e),mainEntity:eie(e),endEntity:tie(e)}:null},Qne=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.settingsstore,Se.py.settingsstorecallqueue,Se.py.settingsstoredelegator].includes(i),r=[Se.uk.create,Se.uk.default,Se.uk.list,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},Kne=()=>!0,Yne=({entity:e})=>e,Xne=({entity:e})=>e,Zne=()=>null,eie=({entity:e})=>e,tie=()=>null,nie=({areEmptySlotsTransparent:e,coreSettings:t})=>{const{enableMercuryDesign:n}=t?.get(b.J.MercuryDesign)||{};return!!t?.get(b.J.Core).enableTransparentLeftRail||e||!(e=>{const{leftRailDefaultBackgroundMicaDisabled:t}=e?.get(b.J.Core)??{},{deviceInfo:n}=e?.get(b.J.Platform)??{},i=n&&(0,Lx.Y)(n);return!!t||!!i})(t)&&!!n},iie=({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:nie({areEmptySlotsTransparent:e,coreSettings:t}),isColorSchemeDefaultBackground3:!e,isWideSubNav:!!t?.get(b.J.MercuryDesign).enableMercuryDesign}}}),aie={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"connectedAccountStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"connectedAccountStateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorState"}},{kind:"Field",name:{kind:"Name",value:"source"}}]}}]}}]};const oie="settings",rie="openScheduleOOF",sie="setStatusMessage",lie={id:"com.microsoft.teams.settings",name:"Settings",actors:[oie],supportedEntities:[Se.py.settingsstore,Se.py.settingsstorecallqueue,Se.py.settingsstoredelegator],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Rail],getDefaultCommand:()=>({action:Se.uk.default,type:Se.py.settingsstore})};var cie=n(331155),die=n(823203),uie=n(100744),mie=n(652515),pie=n(64476),gie=n(676210);const hie="APPS_SETTINGS_ERROR_CLEANUP",yie=async e=>{const{client:t,coreSettings:n,scenarioFactory:i,loggerFactory:a}=e,{enableContactsSync:o}=n.get(b.J.People),r=i.newScenario(H.RG.ConnectedCalendarCleanup),s=a.newLogger("[ConnectedCalendar-Cleanup]","apps-settings"),l=await vie(t,s,r),c=l?.find((e=>e.isSyncAllowed));if(c){const e=await fie(t,!!o,s,r),{accountAddress:n,accountId:i,source:a}=c,l=await kie(t,n,s,r);let d=!1;if(e){const n=[],i=e.find((e=>"Google"===e.source));if(i){const e={...i,isSyncAllowed:!1};n.push(e),d=await Cie(t,n,s,r)}}const u=await Sie(t,i,n,a,s,r);return r.stop(),u&&l&&d}return r.fail({errors:`${hie} connected calendar information is not found `}),!1},vie=async(e,t,n)=>{try{const{data:t}=await e.query({query:gie.M,fetchPolicy:"network-only",variables:{callerInfo:hie}});return t.syncConnectedCalendarSettings}catch(e){t.log(`${hie} Sync Connected Calendar Settings: ${e}`),n.fail({errors:`${hie} Sync Connected Calendar Settings Failed! `})}},fie=async(e,t,n,i)=>{try{const{data:n}=await e.query({query:die.u,fetchPolicy:"network-only",variables:{isContactsSyncEnabled:t,callerInfo:hie},notifyOnNetworkStatusChange:!0});return n.contactsSyncSettings}catch(e){return n.log(`${hie} Get Contacts Sync Settings: ${e}`),void i.fail({errors:`${hie} Get Contacts Sync Settings Failed! `})}},Sie=async(e,t,n,i,a,o)=>{try{await e.mutate({mutation:uie.P,fetchPolicy:"no-cache",variables:{accountId:t,callerInfo:hie,accountAddress:n,provider:i}})}catch(e){return a.log(`${hie} Hard Delete External Account: ${e}`),o.fail({errors:`${hie} Hard Delete External Account Failed! `}),!1}return!0},kie=async(e,t,n,i)=>{try{e.mutate({mutation:mie.i,fetchPolicy:"no-cache",variables:{mailboxAddress:t}})}catch(e){return n.log(`${hie} Delete Calendar Events Cache: ${e}`),i.fail({errors:`${hie} Delete Calendar Events Cache Failed! `}),!1}return!0},Cie=async(e,t,n,i)=>{try{e.mutate({mutation:pie._,fetchPolicy:"no-cache",variables:{callerInfo:hie,syncSettings:t}})}catch(e){return n.log(`${hie} Publish Contacts Sync Settings: ${e}`),i.fail({errors:`${hie} Publish Contacts Sync Settings Failed! `}),!1}return!0},bie=async e=>{const{entityCommand:t,entityCommand:{entity:{id:n,type:i,action:a},command:{correlation:{source:o}}},requestContext:r}=e;if(o===C.D.CalendarSyncBanner&&n===RJ.Y.Calendar&&i===Se.py.settingsstore&&a===Se.uk.view){const{client:e,coreSettings:n,scenarioFactory:i,loggerFactory:a}=r,o={client:e,coreSettings:n,scenarioFactory:i,loggerFactory:a};try{await yie(o)}catch(e){}const s=t.entityOptions||{};return s.callerInfo="CalendarSyncBanner",s.callerParam={isCalendarConnected:!1,source:cie.H$.Google,accountId:"",accountAddress:""},t.entityOptions=s,Promise.resolve(t)}return Promise.resolve(t)},wie={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"calendarSyncStateUpdates"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"eventNames"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CalendarSyncStatusEnum"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"calendarSyncStateUpdates"},arguments:[{kind:"Argument",name:{kind:"Name",value:"eventNames"},value:{kind:"Variable",name:{kind:"Name",value:"eventNames"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"eventName"}},{kind:"Field",name:{kind:"Name",value:"payload"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"CalendarSyncPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startDate"}},{kind:"Field",name:{kind:"Name",value:"endDate"}},{kind:"Field",name:{kind:"Name",value:"mailboxAddress"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ConnectedCalendarSyncPayload"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startDate"}},{kind:"Field",name:{kind:"Name",value:"endDate"}},{kind:"Field",name:{kind:"Name",value:"mailboxAddress"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}},{kind:"Field",name:{kind:"Name",value:"message"}}]}}]}}]}}]}}]}}]},Tie=["CONNECTED_CALENDAR_SYNCING","CONNECTED_CALENDAR_SYNC_FAILED","CONNECTED_CALENDAR_UPTO_DATE"];var Iie=n(603885);const Nie={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsSettingsSyncUnifiedCalendarSyncStateSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syncUnifiedCalendarSyncState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"syncState"}},{kind:"Field",name:{kind:"Name",value:"payload"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"startDate"}},{kind:"Field",name:{kind:"Name",value:"endDate"}},{kind:"Field",name:{kind:"Name",value:"error"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"code"}}]}}]}}]}}]}}]};const Eie={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}};var Aie=n(56716);const _ie="settings_on_command_received",Fie=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("SettingsApp[onCommandReceived]","apps-settings");if(e.command.actor===oie)return n===rie?{entity:{type:Se.py.settingsstore,action:Se.uk.view,id:Aie.l.OOFSettingsPage},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.ScheduleOOFFromMeMenu}}}:void i.errorToTelemetry?.(`Command action '${n}' is not supported by SettingsApp.`,_ie);i.errorToTelemetry?.(`Command for actor '${e.command.actor}' cannot be handled by SettingsApp.`,_ie)};function Die(e){const{coreSettings:t,hostCommunicationService:n,loggerFactory:i}=e;return{id:"m365-links-set-policy-value-job",job:async()=>{const e=i.newLogger("M365LinksPolicyJob","apps-settings"),a=await n.loadModule("m365link");if(!a)return void e.errorToTelemetry?.("Could not get hostComms","settings_m365_links_policy_job");const o=t.getObservable(b.J.Files,["teamsLinkBrowserPreferencePolicy"]).subscribe((async({teamsLinkBrowserPreferencePolicy:t})=>{switch(t){case 0:e.log("Setting M365 links policy to default browser"),await(a.setM365LinksPolicy?.(0));break;case 1:e.log("Setting M365 links policy to Microsoft Edge"),await(a.setM365LinksPolicy?.(1));break;default:return e.log("No M365 links policy value. Setting M365 links policy to undefined"),void await(a.setM365LinksPolicy?.(void 0))}}));return()=>o.unsubscribe()}}}const Pie=()=>Promise.all([n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(986797),n.e(84274),n.e(393890),n.e(65537),n.e(459868),n.e(152739),n.e(766254),n.e(666384),n.e(664625),n.e(314991),n.e(128770),n.e(649800),n.e(457535),n.e(51724),n.e(392718),n.e(123977),n.e(891369),n.e(591395),n.e(255279),n.e(44025),n.e(497372),n.e(788241),n.e(95719),n.e(149115),n.e(251843),n.e(157477),n.e(309799),n.e(462698),n.e(83395),n.e(572001),n.e(180830),n.e(875351),n.e(565168),n.e(364592),n.e(826792),n.e(669491),n.e(980585),n.e(929542),n.e(619140),n.e(390466),n.e(885503),n.e(656224),n.e(184892),n.e(928362),n.e(652421),n.e(68021),n.e(375387),n.e(917217),n.e(995293),n.e(714257),n.e(685827),n.e(474133),n.e(609660),n.e(702573),n.e(360134),n.e(357903),n.e(949636),n.e(281467),n.e(678342),n.e(450367),n.e(782721),n.e(90653),n.e(608462),n.e(270954),n.e(193651),n.e(103338),n.e(347076),n.e(398164),n.e(894153),n.e(148076),n.e(1626),n.e(334926),n.e(844014),n.e(942009),n.e(544565),n.e(684888),n.e(699725),n.e(518723),n.e(196623),n.e(772819),n.e(973647),n.e(586617),n.e(862690)]).then(n.bind(n,447566)),Mie=()=>Promise.all([n.e(187946),n.e(182149),n.e(865804),n.e(88373),n.e(612377),n.e(313284),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(34671),n.e(285883)]).then(n.bind(n,450812)),xie=({children:e})=>(0,gO.t)(hO.Fragment,{children:e});function Rie(){return{eventHandlers:Eie,getAppViewEntities:Jne,getAppViewEntitiesProps:iie,onBeforeCommandHandled:bie,manifest:lie,onCommandReceived:Fie,onPreWarm:e=>{const{context:t}=e,n=t.coreSettings,{enableSyncStateBanner:i}=n.get(b.J.People),{enableCalendarSyncStateBanner:a,enableUnifiedCalendarEvents:o}=n.get(b.J.Calendar),r=[];if(i&&r.push(function(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o,coreSettings:r}=e,s=o.newLogger("connected-account-state-subscription-job","apps-settings"),l=n,{enableGoogleContactSyncNotification:c}=r.get(b.J.Growth);let d;return{id:"connected-account-state-subscription",job:()=>{try{d=l.subscribe({query:aie}).filter((e=>!!e?.data?.connectedAccountStateEvent?.errorState)).subscribe((async e=>{const n=e.data.connectedAccountStateEvent;"ConnectedAccountsSyncError"===n.errorState?i.shell.showBanner({id:"connected-account-state-banner",source:C.D.ContactsSyncBanner,cause:"ConnectedAccountError",intentLevel:"Neutral",text:a.stringTranslate("people","google_sign_in_required"),action:{text:a.stringTranslate("people","go_to_settings"),command:{entity:{type:"settingsstore",action:"view",id:"privacy_manage_contacts_sync"},command:{stateTransition:"flush",visibilityState:"show",correlation:{source:C.D.ContactsSyncBanner}}},dismissOnAction:!0},dismissable:!0,duration:0,bannerScenario:"connected_account_sync_error"}):c&&"None"===n.errorState&&"Google"===n.source&&i.esp.displaySurface("contactSyncConfirmationNotification"),t?.()}))}catch(e){const t=`Failed connectedAccountStateEventJob with error: ${e&&e.message}, errorCode ${e&&e.code}`;d.unsubscribe(),s.error(t)}}}}(t)),a){const e=o?function(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o}=e,r=o.newLogger("unified-calendar-sync-state-job","apps-settings");let s;return{id:"unified-calendar-sync-state-job",job:()=>{try{s=n.subscribe({query:Nie,fetchPolicy:"no-cache"}).subscribe((async n=>{const o=n?.data?.syncUnifiedCalendarSyncState?.syncState,r=n?.data?.syncUnifiedCalendarSyncState?.payload;if(o===Iie.N.UNIFIED_CALENDAR_SYNC_FAILED){const t=r?.error?.code;switch(t){case h.jK.ConnectedAccountNotFound:case h.jK.ShadowMailboxDeleted:await yie(e);break;case h.jK.Unauthorized:case h.jK.UnauthorizedAccess:case h.jK.ShadowTokenRevoked:case h.jK.ShadowTokenExpired:case h.jK.ShadowRefreshTokenExpired:i.shell.showBanner({id:"unified-calendar-sync-state-banner",source:C.D.CalendarSyncBanner,cause:"ConnectedAccountError",intentLevel:"Severe",text:a.stringTranslate("calendar","tfl_cc_connect_external_account_banner_error",{provider:"Google"}),action:{text:a.stringTranslate("calendar","tfl_cc_banner_go_to_settings_button_text"),command:{entity:{type:"settingsstore",action:"view",id:RJ.Y.Calendar},command:{stateTransition:"flush",visibilityState:"show",correlation:{source:C.D.CalendarSyncBanner}}},dismissOnAction:!0},dismissable:!0,duration:0,bannerScenario:"unified_calendar_sync_error"})}}t?.()}))}catch(e){const t=`Failed createUnifiedCalendarSyncStateJob with error: ${e?.message}, errorCode ${e?.code}`;s.unsubscribe(),r.error(t)}}}}(t):function(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o}=e,r=o.newLogger("connected-calendar-sync-state-job","apps-settings"),s=n;let l;return{id:"connected-calendar-sync-state-job",job:()=>{try{l=s.subscribe({query:wie,fetchPolicy:"no-cache",variables:{eventNames:Tie}}).subscribe((async n=>{const o=n?.data?.calendarSyncStateUpdates?.eventName,r=n?.data?.calendarSyncStateUpdates?.payload?.error?.code;if("CONNECTED_CALENDAR_SYNC_FAILED"===o)switch(r){case h.jK.ConnectedAccountNotFound:case h.jK.ShadowMailboxDeleted:await yie(e);break;case h.jK.Unauthorized:case h.jK.UnauthorizedAccess:case h.jK.ShadowTokenRevoked:case h.jK.ShadowTokenExpired:case h.jK.ShadowRefreshTokenExpired:i.shell.showBanner({id:"connected-calendar-sync-state-banner",source:C.D.CalendarSyncBanner,cause:"ConnectedAccountError",intentLevel:"Severe",text:a.stringTranslate("calendar","tfl_cc_connect_external_account_banner_error",{provider:"Google"}),action:{text:a.stringTranslate("calendar","tfl_cc_banner_go_to_settings_button_text"),command:{entity:{type:"settingsstore",action:"view",id:RJ.Y.Calendar},command:{stateTransition:"flush",visibilityState:"show",correlation:{source:C.D.CalendarSyncBanner}}},dismissOnAction:!0},dismissable:!0,duration:0,bannerScenario:"connected_calendar_sync_error"})}t?.()}))}catch(e){const t=`Failed createConnectedCalendarSyncStateJob with error: ${e?.message}, errorCode ${e?.code}`;l.unsubscribe(),r.error(t)}}}}(t);r.push(e)}return r},onUserWindowPreWarm:e=>{const{context:t}=e;return[Die(t)]},render:async({appRenderMode:e,coreSettings:t,onRenderEvent:n,scenarioFactory:i})=>{const a="settings-app";n("ChunkLoadStarted",{chunkName:a});const{SettingsViewsRenderer:o}=await(0,ac.mT)(Pie,a,i),{enableEntityMoreInfo:r}=t.get(b.J.Core),{LPC:s}=r?{LPC:xie}:await(0,ac.mT)(Mie,a,i),l=r?xie:rJ.p3;return n("ChunkLoadSucceeded",{chunkName:a}),(0,gO.t)(s,{children:(0,gO.t)(l,{children:(0,gO.t)(o,{appRenderMode:e})})})}}}const jie={getDefaultCommand:()=>({type:Se.py.email,action:Se.uk.create}),id:"com.microsoft.teams.share-email",name:"ShareEmailApp",supportedEntities:[Se.py.email],supportedRenderModes:[Mt.S.Main],windowFeatures:{minWidth:530,width:748,minHeight:490,height:691}},Lie=e=>{if(Oie(e))return $ie(e)?{subNavEntity:Uie(e),headerEntity:Bie(e),startEntity:Wie(e),mainEntity:Hie(e),endEntity:Vie(e)}:null},Oie=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.email].includes(i),r=[Se.uk.default,Se.uk.create],s=n&&r.includes(n);return!!(a&&o&&s)},$ie=()=>!0,Uie=()=>null,Bie=()=>null,Wie=()=>null,Hie=({entity:e})=>e,Vie=()=>null,Gie=({appRenderMode:e})=>{const t=new MV.H,n=[];return e===Mt.S.Main&&n.push(xV.G.SHARE_PAGE_RENDERED),t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:2e4}),t.appPhases},zie={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShareEmailSttoInstallMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"shareToTeamsInstall"}}]}}]},qie="share_to_teams_installed",Jie=({context:{coreSettings:e,localStorage:t,authenticationUser:n,client:i,loggerFactory:a,scenarioFactory:o}})=>{const{enableSttoInstall:r}=e.get(b.J.Outlook),s={id:"share-to-teams-outlook-install",runOncePerId:!0,job:async()=>{if(r){const r=function(e){return e.cancelExistingAndCreateScenario(H.RG.STTOInstall,"Share to teams Install")}(o),{isOnCloud:s,isMailboxDiscoverable:l}=e.get(b.J.Messaging),c=a.newLogger("ShareToTeamsApp Install","apps-share-email"),d=i,u=t?.get(qie)||!1,m=n?.role===ys.w4.Guest;if(s&&l&&!m&&!u)try{const{data:e}=await d.mutate({mutation:zie});e?.shareToTeamsInstall?(c.log("ShareToTeams install successful"),t?.trySet(qie,"true","Messaging"),r.stop()):(c.log("ShareToTeams install not successful"),r.fail({errors:"ShareToTeams install not successful"}))}catch{c.log("ShareToTeams install mutation unexpectedly failed"),r.fail({errors:"ShareToTeams install mutation unexpectedly failed"})}else c.log("Skipping ShareToTeams install"),r.cancel({reason:"Skipping ShareToTeams install"})}}};return[s]};const Qie=({context:{coreSettings:e,localStorage:t,loggerFactory:n}})=>{const{enableChannelLocalCache:i,enableClearTeamsListLocalStorage:a}=e.get(b.J.Search);return[{id:"share-to-teams-clear-teams-list-localstorage",runOncePerId:!0,job:async()=>{if(!i&&a){const e=n.newLogger("ShareToTeamsApp ClearTeamsListLocalStorage","apps-share-email");try{t?.remove("teams-list")}catch{e.warn("Failed to clear teams list localstorage")}}}}]};var Kie;!function(e){e.DeepLinkNotEnabled="deeplink-not-enabled-error",e.MissingEmailRestId="missing-emailRestId-error"}(Kie||(Kie={}));const Yie=e=>{try{return JSON.parse(`[${e}]`)}catch{return[]}},Xie=(e,t,n)=>{const{emailRestId:i,attachmentSize:a,attachmentCount:o,fileTypes:r,from:s,toRecipients:l,ccRecipients:c,cloudAttachments:d,outlookTid:u,outlookUid:m,outlookSmtpAddress:p}=e;return Promise.resolve({entityCommand:{entity:{type:Se.py.email,id:i,action:n},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new,correlation:{id:t,startTimestamp:Date.now(),source:C.D.ShareEmail}},entityOptions:{emailRestId:i,correlationId:t,attachmentSize:a,attachmentCount:o,fileTypes:r,from:s,toRecipients:l,ccRecipients:c,cloudAttachments:d,outlookTid:u,outlookUid:m,outlookSmtpAddress:p}},metadata:{allowAnonymous:!1}})},Zie=[{filter:"/l/share-email",execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{if(!eae(t))return Promise.reject({message:Kie.DeepLinkNotEnabled});const{entityOptions:n,correlationId:i}=(e=>{const{pathname:t,searchParams:n}=e,i=t.split("/"),a=i[i.length-1],o=Number(n.get("attachmentSize"))||0,r=Number(n.get("attachmentCount"))||0,s=n.get("fileTypes")?.split(",")??[],l=n.get("from")??"",c=n.get("toRecipients")?.split(",")??[],d=n.get("ccRecipients")?.split(",")??[],u=n.get("cloudAttachments")??"";return{entityOptions:{emailRestId:a,attachmentSize:o,attachmentCount:r,fileTypes:s,from:l,toRecipients:c,ccRecipients:d,cloudAttachments:Yie(u),outlookTid:n.get("tid")??"",outlookUid:n.get("uid")??"",outlookSmtpAddress:n.get("userEmail")??""},correlationId:n.get("correlationId")??""}})(e);return n.emailRestId?Xie(n,i,Se.uk.create):Promise.reject({message:Kie.MissingEmailRestId})}}],eae=e=>!!e?.get(b.J.Outlook).enableDeepLinkShareEmail,tae=()=>Promise.all([n.e(377348),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(591878),n.e(84274),n.e(773923),n.e(361845),n.e(664625),n.e(891369),n.e(503847),n.e(302494),n.e(251843),n.e(384648),n.e(908688),n.e(956566),n.e(379371),n.e(429986),n.e(103554),n.e(943246),n.e(685827),n.e(609660),n.e(210338),n.e(442948),n.e(357903),n.e(253408),n.e(554897),n.e(467533),n.e(153803),n.e(463686)]).then(n.bind(n,544084)),nae=e=>{e.registerTask(new ul)},iae=({windowOptions:e})=>e?{height:e.height,left:e.left,top:e.top,width:e.width}:{minHeight:jie.windowFeatures.height,minWidth:jie.windowFeatures.width,height:jie.windowFeatures.height,width:jie.windowFeatures.width};function aae(){const e=()=>null;return{getAppPhases:Gie,getAppViewEntities:Lie,getAppWindowFeatures:iae,manifest:jie,onBeforeDeeplinkParsed:Zie,onRegister:nae,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===Mt.S.Main){const{ShareFormEmail:e}=await(0,ac.mT)(tae,"share-form-email-entry",n);return(0,gO.t)(e,{})}return(0,gO.t)(e,{})},onPreWarm:Jie,onExperienceLongIdle:Qie}}const oae="/l/fileshare";const rae=[{filter:oae,execute:({deeplinkUrl:e,context:{coreSettings:t}})=>{if(!sae(t)){const e="share to files is not enabled";return Promise.reject(e)}const{pathname:n,search:i}=e;if(n.startsWith(oae)){const e=i.split(/[/?&=]/);if(e.length>0){const t=e[e.length-1];return Promise.resolve(function(e){return{entityCommand:{entity:{type:Se.py.chats,action:Se.uk.share,id:IX.FX},command:{stateTransition:ke.su.new,visibilityState:ke.fe.show,correlation:{id:(0,Re.v4)(),startTimestamp:Date.now(),source:C.D.OSFileShareEvent}},entityOptions:{inviteLinkType:sa.DL.FileShare,filesUrl:e}},metadata:{allowAnonymous:!1}}}(t))}}return Promise.reject("No deeplink type found for the specified prefixType")}}],sae=e=>!!e?.get(b.J.WindowsSignatureExperiences).enableShareFilesToTeams,lae={id:"com.microsoft.teams.share-to-chat",name:"ShareToChatApp",supportedRenderModes:[Mt.S.Main]};function cae(){const e=()=>null;return{manifest:lae,render:async()=>(0,gO.t)(e,{}),onBeforeDeeplinkParsed:rae}}const dae=e=>{if(uae(e))return mae(e)?{subNavEntity:pae(e),headerEntity:gae(e),startEntity:hae(e),mainEntity:yae(e),endEntity:vae(e)}:null},uae=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.standard].includes(e),o={[Se.py.brbfeedbackdialog]:[Se.uk.default,Se.uk.view],[Se.py.tpndialog]:[Se.uk.default,Se.uk.view],[Se.py.appswitcherdesktopactivecalldialog]:[Se.uk.default,Se.uk.view],[Se.py.appswitchert1downloaddialog]:[Se.uk.default,Se.uk.view],[Se.py.appswitcherwebactivecalldialog]:[Se.uk.default,Se.uk.view],[Se.py.appswitcherwebmultipletabsdialog]:[Se.uk.default,Se.uk.view],[Se.py.signoutdialog]:[Se.uk.default,Se.uk.view],[Se.py.identitydialog]:[Se.uk.create],[Se.py.joinlinkdialog]:[Se.uk.default,Se.uk.view],[Se.py.premiumtrialdialog]:[Se.uk.default,Se.uk.view],[Se.py.bannerNotification]:[Se.uk.create,Se.uk.delete],[Se.py.hybridplaceholder]:[Se.uk.default,Se.uk.view],[Se.py.updatemsaprofileavatardialog]:[Se.uk.default,Se.uk.view],[Se.py.updatemsaprofilenamedialog]:[Se.uk.default,Se.uk.view],[Se.py.autobrbconfirmationdialog]:[Se.uk.default,Se.uk.view],[Se.py.autobrbflowdialog]:[Se.uk.default,Se.uk.view],[Se.py.pearnotdefaultapp]:[Se.uk.view],[Se.py.invitecoworkers]:[Se.uk.view],[Se.py.licenserequestdialog]:[Se.uk.view],[Se.py.vdirestartworkflow]:[Se.uk.default,Se.uk.view]},r=n&&(o[i]||[]).includes(n);return!(!a||!r)},mae=()=>!0,pae=({entity:e})=>e.type===Se.py.pearnotdefaultapp?null:e,gae=({entity:e})=>e.type===Se.py.pearnotdefaultapp?null:e,hae=({entity:e})=>e.type===Se.py.pearnotdefaultapp?null:e,yae=({entity:e})=>e,vae=({entity:e})=>e.type===Se.py.pearnotdefaultapp?null:e,fae=({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[Mt.e.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:e,isColorSchemeDefaultBackground6:!e},[Mt.e.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e}},headerEntity:{[Mt.e.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:e,isColorSchemeDefaultBackground6:!e}},startEntity:{[Mt.e.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:e,isColorSchemeDefaultBackground6:!e}},mainEntity:{[Mt.e.ThinHorizontalBar]:{isBackgroundTransparent:e},[Mt.e.TitleBar]:{isBackgroundTransparent:!0},[Mt.e.VerticalBar]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentAppBar||e,displayNavBorder:!!t?.get(b.J.MercuryDesign).enableMercuryDesign,isColorSchemeDefaultBackground6:!e}},endEntity:{[Mt.e.Rail]:{isBackgroundTransparent:e}}});var Sae=n(219166);const kae=({coreSettings:e,userPreferences:t})=>{if(!e?.get(b.J.TeamsAndChannels)?.enableTeamLayoutSetting&&!e?.get(b.J.TeamsAndChannels)?.enableTeamLayoutSettingOverride)return!1;if(e?.get(b.J.Edu)?.enableDogfoodingInEduGridLayout)return!0;switch(t?.teamLayout?.currentLayout){case"grid":return!0;case"list":return!1;default:return e?.get(b.J.TeamsAndChannels)?.defaultTeamLayoutSettingIsGrid}},Cae=(e,t,n)=>{const i=C.D.AppBar;switch(e.tileID){case MW:return{scenarioName:t?.get(b.J.Activity).enableActivitySlices??!1?H.RG.SliceSwitch:H.RG.ActivitySwitch,source:i};case RW:return{scenarioName:H.RG.CalendarSurfaceLoad,source:i};case jW:return kae({coreSettings:t,userPreferences:n?.getAllPreferences()})?{scenarioName:H.RG.TeamsGridLoad,source:i}:{scenarioName:H.RG.ChannelSwitchL1,source:i};case xW:return{scenarioName:H.RG.ChatSwitch,source:i};case LW:return{scenarioName:H.RG.SimpleCollabSwitch,source:i};case OW:return{scenarioName:H.RG.CallsAppSwitch,source:i};case zW:return{scenarioName:H.RG.HomepageAppLoad,source:i};case qW:return{scenarioName:H.RG.QueuesAppSwitch,source:i};default:return{scenarioName:H.RG.EntityCommand,source:i}}},bae=(e,t,n,i)=>{const a=e.event;switch(a.originator){case Sae.DQ:case Sae.Ol:return((e,t,n,i)=>{const a=e.data?.();switch(e.type){case Sae.iC.launch:case Sae.iC.install:case Sae.iC.description:return e.data?Cae(a,n,i):void t.error("Received a launch event without data!");case Sae.iC.appTileHover:return;default:return void t.warn(`Received an unhandled Launch tile event, type: ${e.type}`)}})(a,t,n,i)}},wae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellGetBannerNotificationQueueQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bannerNotificationQueue"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bannerId"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"bannerScenario"}},{kind:"Field",name:{kind:"Name",value:"intentLevel"}},{kind:"Field",name:{kind:"Name",value:"cause"}},{kind:"Field",name:{kind:"Name",value:"debugInfo"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"props"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"action"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"command"}},{kind:"Field",name:{kind:"Name",value:"dismissOnAction"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"behavior"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"dismissable"}},{kind:"Field",name:{kind:"Name",value:"dismissActionCommand"}},{kind:"Field",name:{kind:"Name",value:"duration"}}]}}]}}]}}]},Tae={MostSevere:0,Live:1,Severe:2,Positive:3,Neutral:4},Iae=e=>{const{bannerId:t,source:n,bannerScenario:i,intentLevel:a,cause:o,props:{text:r,action:s},behavior:l,debugInfo:c,correlationId:d}=e;return{__typename:"BannerNotification",bannerId:t,source:n,bannerScenario:i??null,intentLevel:a,cause:o??null,debugInfo:c??null,correlationId:d??null,props:{__typename:"BannerNotificationProperties",text:r??null,action:s?{__typename:"NotificationAction",command:s.command,text:s.text??null,dismissOnAction:s.dismissOnAction}:null},behavior:{__typename:"BannerNotificationBehavior",dismissable:l?.dismissable??!1,dismissActionCommand:l?.dismissActionCommand??null,duration:l?.duration??0}}},Nae=(e,t)=>{let n=[];try{n=t.readQuery({query:wae})?.bannerNotificationQueue??[]}catch(t){e.error("Failed to read banner queue from data client cache. ",t)}return n.map(Iae)},Eae=(e,t,n)=>{const i={bannerNotificationQueue:n.map(Iae)};try{t.writeQuery({query:wae,data:i})}catch(t){e.error("Failed to write banner queue to data client cache. ",t)}},Aae=(e,t,n)=>{let i=Nae(e,t);i=i.filter((e=>e.bannerId!==n)),Eae(e,t,i)},_ae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsShellReauthenticateMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reauthenticateUser"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"success"}}]}}]}}]},Fae=(e,t)=>t.mutate({mutation:_ae})?.then((e=>e.data?.reauthenticateUser?.success)).catch((t=>(e.error("Failed to perform reauthentication. ",t),Promise.resolve(void 0)))),Dae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellGetToastNotificationQueueQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastNotificationQueue"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"intent"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"body"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"action"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"command"}},{kind:"Field",name:{kind:"Name",value:"dismissOnAction"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"duration"}},{kind:"Field",name:{kind:"Name",value:"source"}}]}}]}}]},Pae=e=>{return e?{__typename:"ConfirmationToastProperties",action:(t=e.action,t?{__typename:"NotificationAction",command:t.command,text:t.text??null,dismissOnAction:t.dismissOnAction}:null)}:null;var t},Mae=e=>{const{id:t,source:n,intent:i,title:a,body:o,duration:r}=e;return{__typename:"ToastNotification",id:t,intent:i,title:a,body:Pae(o??void 0),duration:r??0,source:n}},xae=(e,t)=>{let n=[];try{n=t.readQuery({query:Dae})?.toastNotificationQueue??[]}catch(t){e.error("Failed to read toasts queue from data client cache. ",t)}return n.map(Mae)},Rae=(e,t,n)=>{const i={toastNotificationQueue:n.map(Mae)};try{t.writeQuery({query:Dae,data:i})}catch(t){e.error("Failed to write toast notifications queue to data client cache. ",t)}},jae=(e,t)=>{if(!e)return;const n=e.toLowerCase();return n.includes("x86")?t.x86:n.includes("x64")||n.includes("amd64")||n.includes("intel64")?t.x64:n.includes("arm64")?t.arm64:void 0},Lae="exploratory_banner_last_dismissed_at";function Oae(e,t){return(t.getTime()-e.getTime())/864e5}function $ae(e,t){const n=t.toISOString();e.localStorage.setItem(Lae,n)}const Uae={[Se.uk.create]:(e,t)=>{const{command:{correlation:{source:n}},entityOptions:i,entity:{id:a}}=t,{client:o,loggerFactory:r}=e,s=r.newLogger("addBannerNotificationToQueue","apps-shell"),l=i;if(l){const{text:e,action:t,dismissable:i,dismissActionCommand:r,duration:c,...d}=l;let u;t&&(u={...t,command:JSON.stringify(t.command)}),((e,t,n)=>{let i=Nae(e,t);i=i.filter((e=>e.bannerId!==n.bannerId)),i.unshift(n),i=i.sort(((e,t)=>Tae[e.intentLevel]-Tae[t.intentLevel])),Eae(e,t,i)})(s,o,{...d,bannerId:a||"no-id",source:n,props:{text:e,action:u},behavior:{dismissable:i,dismissActionCommand:r?JSON.stringify(r):void 0,duration:c}})}else s.error("entityOptions is missing IBannerNotificationOptions fields. ",i);return Promise.resolve(void 0)},[Se.uk.delete]:(e,t)=>{const{entity:{id:n}}=t,{client:i,loggerFactory:a}=e,o=a.newLogger("removeBannerNotificationFromQueue","apps-shell");return n&&Aae(o,i,n),Promise.resolve(void 0)},[Se.uk.signin]:async(e,t)=>{const{entityOptions:n}=t,{client:i,loggerFactory:a}=e,o=a.newLogger("handleSignInBannerActionCommand","apps-shell"),r=n;return await Fae(o,i)&&r?.bannerId&&Aae(o,i,r.bannerId),Promise.resolve(void 0)}},Bae={[Se.uk.create]:(e,t)=>{const{command:{correlation:{source:n}},entityOptions:i,entity:{id:a}}=t,{client:o,loggerFactory:r}=e,s=r.newLogger("addToastNotificationToQueue","apps-shell"),l=i;if(a&&l){const{body:e,...t}=l;let i;e?.action&&(i={...e?.action,command:JSON.stringify(e?.action.command)}),((e,t,n)=>{let i=xae(e,t);i=i.filter((e=>e.id!==n.id)),i.push(n),Rae(e,t,i)})(s,o,{...t,id:a,source:n,body:{action:i}})}else s.error("entityOptions is missing IToastNotificationParams fields. ",i);return Promise.resolve(void 0)},[Se.uk.delete]:(e,t)=>{const{entity:{id:n}}=t,{client:i,loggerFactory:a}=e,o=a.newLogger("removeToastNotificationFromQueue","apps-shell");return n&&((e,t,n)=>{let i=xae(e,t);i=i.filter((e=>e.id!==n)),Rae(e,t,i)})(o,i,n),Promise.resolve(void 0)},[Se.uk.update]:(e,t)=>{const{command:{correlation:{source:n}},entityOptions:i,entity:{id:a}}=t,{client:o,loggerFactory:r}=e,s=r.newLogger("addToastNotificationToQueue","apps-shell"),l=i;if(a&&l){const{body:e,...t}=l;let i;e?.action&&(i={...e?.action,command:JSON.stringify(e?.action.command)}),((e,t,n)=>{const i=xae(e,t);let a=!1;for(let e=0;e<i.length;e++)if(i[e].id===n.id){i[e]=n,a=!0;break}a||i.push(n),Rae(e,t,i)})(s,o,{...t,id:a,source:n,body:{action:i}})}else s.error("entityOptions is missing IToastNotificationParams fields. ",i);return Promise.resolve(void 0)}},Wae={[Se.uk.view]:async(e,t)=>{throw new Error("Method not implemented yet")}},Hae={[Se.uk.info]:async(e,t)=>{const{exploratoryExpiryBannerLearnMoreUrl:n}=e.coreSettings.get(b.J.Growth),i=(0,L.J)();return i.open(n,"_blank"),$ae(i,new Date),Promise.resolve(void 0)},[Se.uk.delete]:async(e,t)=>($ae((0,L.J)(),new Date),Promise.resolve(void 0))},Vae=e=>{const{entityCommand:t,entityCommand:{entity:{type:n,action:i}},requestContext:a,windowProvider:o}=e;if(n===Se.py.bannerNotification){const e=Uae[i];if(e)return e(a,t)}else if(n===Se.py.inAppToast){const e=Bae[i];if(e)return e(a,t)}else if(n===Se.py.memenu){const e=Wae[i];if(e)return e(a,t)}else{if(n===Se.py.updatedesktopapp&&i===Se.uk.confirm)return(async(e,t,n)=>{const{coreSettings:i,loggerFactory:a,scenarioFactory:o}=e,r=a.newLogger("downloadAppInstaller","apps-shell"),{enableDesktopMinimumVersionBanner:s}=i.get(b.J.Core);if(!s)return r.log("Sedimentation banner disabled by feature flag"),Promise.resolve(t);const{desktopAppInstallerLinks:l}=i.get(b.J.Core),{deviceInfo:c}=i.get(b.J.Platform),d=c?.cpuArchitecture||void 0,u=jae(d,l),m=o?.newScenario(H.RG.MinimumVersionBannerClicked);if(u)try{r.log(`Downloading the msix file for ${d}`);const e=n?.document.createElement("a");return e.setAttribute("href",u),e.setAttribute("download",""),e.click(),e.remove(),m?.mark("minimum_version_banner_clicked"),m?.stop(),Promise.resolve(void 0)}catch(e){const n=`Failed to download msix file, where setup values is enableDesktopMinimumVersionBanner: \n    ${s}, cpuarch: ${d}, desktopAppInstallerLink: ${u}; \n    ${e.message}`;return r.errorToTelemetry?.(n,"unsupported-version-banner-job",{errorCode:e.name},!0),m?.fail({errorCode:e.name,reason:"download-msix-file-error"}),Promise.resolve(t)}return r.log("Failed to download msix file - desktopAppInstallerLink not defined."),m?.cancel({reason:"undefined-desktop-app-installer-link-event"}),Promise.resolve(t)})(a,t,o);if(n===Se.py.exploratorylicensenotificationbanner){const e=Hae[i];if(e)return e(a,t)}}return Promise.resolve(t)},Gae=[{filter:"/notdefaultapp",execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableAppSwitcher:n}=e.get(b.J.Core),i=t.newLogger("Shell:BeforeDeeplinkParsedCondition","apps-shell");return n?(i.log("execute command onBeforeDeeplinkParsed"),Promise.resolve({entityCommand:{entity:{type:Se.py.pearnotdefaultapp,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,layoutMode:ke.lO.standard}},metadata:{allowAnonymous:!0}})):(i.log(`app switcher is not enabled, enableAppSwitcher value is ${n}`),Promise.reject({message:"app-switcher-not-enabled"}))}},{filter:e=>e.search.includes("officeWaffle"),execute:async()=>({entityCommand:{command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush},entity:{type:Se.py.default,action:Se.uk.default}},metadata:{allowAnonymous:!0}})},{filter:"/l/teamsInsider",execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableJoinInsidersTab:n}=e.get(b.J.Core),i=t.newLogger("Shell:BeforeDeeplinkParsedTeamsInsiderCondition","apps-shell");return n?(i.log("execute command onBeforeDeeplinkParsedTeamsInsiderCondition"),Promise.resolve({entityCommand:{entity:{type:Se.py.settingsstore,action:Se.uk.default,id:RJ.Y.Insiders},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,layoutMode:ke.lO.standard}},metadata:{allowAnonymous:!1}})):(i.log(`teams insider is not enabled, enableJoinInsidersTab value is ${n}`),Promise.reject({message:"teams-insider-not-enabled"}))}}],zae={filter:new Set([Se.py.pearnotdefaultapp]),execute:async({intent:e})=>({overrideType:GE.OverrideIntent,intent:e})};const qae=({context:{coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,platformService:s,networkState:l,entityCommanding:c,config:d,clientState:u,rebootService:m,userTrackingService:p}})=>{const g=[],{enableDiskProfileMeasurement:h}=e.get(b.J.Core);return h&&g.push(function(e){const{loggerFactory:t,hostCommunicationService:n}=e;return{id:"disk-footprint-job",runOncePerId:!1,job:async()=>{const e=t.newLogger("DiskFootprintStrategy","apps-shell");try{const e=await n.loadModule("osutils");e?.sendDiskProfileInfo?.()}catch(t){const n=`Failed Disk Footprint with errorCode ${t?.errorCode||t?.code}`;e.error?.(n)}}}}({coreSettings:e,hostCommunicationService:t,loggerFactory:n,scenarioFactory:i,client:a,localStorage:o,windowProvider:r,platformService:s,networkState:l,entityCommanding:c,config:d,clientState:u,rebootService:m,userTrackingService:p})),g};var Jae=n(409971);const Qae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"OnAuthenticationStateChanged"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationStateChanged"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"state"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"errorCode"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"isExpected"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"subContext"}}]}}]}}]}}]}}]},Kae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"authenticationUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]},Yae={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellAuthEndPagesDataQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userContextId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMRU"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEndPageData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userContextId"},value:{kind:"Variable",name:{kind:"Name",value:"userContextId"}}},{kind:"Argument",name:{kind:"Name",value:"isMRU"},value:{kind:"Variable",name:{kind:"Name",value:"isMRU"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"pictureBlob"}},{kind:"Field",name:{kind:"Name",value:"customError"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"context"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"message"}},{kind:"Field",name:{kind:"Name",value:"subContext"}}]}}]}}]}}]},Xae=({errorCode:e,message:t,isExpected:n,context:i,subContext:a})=>`errorCode: [${e}], message: [${t}], isExpected: [${+!!n}], context: [${i}::${a}]`;function Zae(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o,authenticationUser:r,coreSettings:s}=e,l=o.newLogger("auth-state-job","apps-shell"),c=n,d="auth-banner";let u=!0;return{id:"auth-state-subscription",job:()=>{c.subscribe({query:Qae}).filter((e=>!!e?.data?.authenticationStateChanged?.authenticationState)).subscribe((async e=>{const n=await c.query({query:Kae});if(0===n?.data?.authenticationUsers?.length)return void l.warn("No authenticated user found, not displaying auth-banner.");const o=e?.data?.authenticationStateChanged?.authenticationState;switch(o?.state){case"AADReconnecting":case"SkypeReconnecting":!function(e,t,n,i){let a="",o="";"AADReconnecting"===t.state?(a=n.stringTranslate("auth","aad_reconnecting_text"),o="auth_aad_reconnecting"):"SkypeReconnecting"===t.state&&(a=n.stringTranslate("auth","skype_reconnecting_text"),o="auth_skype_reconnecting");i.shell.showBanner({id:e,source:C.D.ShellAuthState,intentLevel:"AADReconnecting"===t.state?"Positive":"Neutral",text:a,dismissable:!0,duration:0,bannerScenario:o,correlationId:t.customError?.correlationId||"",debugInfo:Xae(t.customError||{})})}(d,o,a,i);break;case"InteractionRequired":!function(e,t,n,i){n.shell.showBanner({id:e,source:C.D.ShellAuthState,bannerScenario:"auth_sign_in_required",intentLevel:"MostSevere",cause:"AuthError",text:t.stringTranslate("auth","sign_in_required_text"),action:{text:t.stringTranslate("auth","sign_in_required_cta_text"),command:{entity:{type:"bannerNotification",action:"signin"}},dismissOnAction:!1},dismissable:!1,duration:0,correlationId:i.customError?.correlationId||"",debugInfo:Xae(i.customError||{})})}(d,a,i,o),function(e,t,n,i,a){const{enableInteractionRequiredToast:o}=a.get(b.J.Auth);if(!o)return void t.log("AlertToasts: Flag is disabled. Not showing interaction required toast.");const r={conversationId:"",quickReply:!1,time:new Date,title:n.stringTranslate("auth","auth_alert_toast_interaction_required_title"),text:n.stringTranslate("auth","auth_alert_toast_interaction_required_text"),mainImage:{alt:"",src:Jae.RQ.Alert}};i.toasts.showInteractionRequiredToast(`dma-toast-for-${e?.id||"unknown-user"}`,r)}(r,l,a,i,s);break;case"LicenseError":case"SignInRestriction":await async function(e,t,n,i,a){if(!function(e,t,n){const{enableAuthEndPagesLicenseWarm:i,disableAuthEndPagesSigninRestrictionWarm:a}=t?.get(b.J.Auth)||{};if(!e)return!1;switch(n){case"LicenseError":return i;case"SignInRestriction":return!a;default:return!1}}(n,i,a))return;const o=n?.id||"",r=await t.query({query:Yae,variables:{userContextId:o,isMRU:!0}});if(!r.data.userEndPageData)return;const s=r.data.userEndPageData;e.authentication.showAuthEndPage(C.D.ShellAuthState,{error:(0,hi.fj)(s,a,o)})}(i,c,r,s,o.state);break;default:!u&&i.shell.dismissBanner(d,C.D.ShellAuthState)}t&&t(),u=!1}))}}}const eoe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsShellCdlServicesStateSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appServiceStateChanged"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appService"}},{kind:"Field",name:{kind:"Name",value:"previousState"}},{kind:"Field",name:{kind:"Name",value:"currentStateChangeTimestamp"}},{kind:"Field",name:{kind:"Name",value:"currentStateChangeReason"}},{kind:"Field",name:{kind:"Name",value:"currentStateChangeCode"}},{kind:"Field",name:{kind:"Name",value:"currentState"}}]}}]}}]};function toe(e,t){const{client:n,entityCommanding:i,i18n:a,loggerFactory:o,coreSettings:r,networkState:s}=e,l=n,c="cdl-services-state-banner",d=o.newLogger("cdl-services-state-job","apps-shell");let u=!1,m=0,p=0,g=!0;return{id:"cdl-services-state-subscription",job:()=>{const e=r.get(b.J.CdlWorker).disableTrouterDisconnectedBannerT2,n=!!r.get(b.J.CdlWorker).enableCdlAppStateService;if(e||!n)return void d.logNoPii?.("disableTrouterDisconnectedBanner killswitch is enabled or enableCdlAppStateService is disabled; not listening to app service state change events");const o=l.subscribe({query:eoe}).subscribe((e=>{if(!e?.data)return void(t&&t());const n=e?.data?.appServiceStateChanged,{appService:o,currentState:r}=n,l=s.getState();if("ChatSync"===o)u||"OFFLINE"!==r||l!==Os.G.Online?!g&&m>0&&"ONLINE"===r&&((e,t,n,i,a,o)=>{u=!1,p++,n.infoToTelemetry&&n.infoToTelemetry("ChatSync app service is back up; dismissing existing disconnected banner "+(void 0!==o?`(networkState=${o.toString()})`:""),"cdl_app_state_chatsync_disconnected_banner_dismiss",noe(t,m,p),!0),i.shell.dismissBanner(e,C.D.ShellCDLServicesState),a&&a(!1)})(c,n,d,i,t,l):((e,t,n,i,a,o)=>{u=!0,m++,i.infoToTelemetry&&i.infoToTelemetry("ChatSync app service is OFFLINE; displaying new disconnected banner","cdl_app_state_chatsync_disconnected_banner_show",noe(t,m,p),!0),a.shell.showBanner({id:e,source:C.D.ShellCDLServicesState,intentLevel:"Neutral",text:n.stringTranslate("errors","chatsync_app_service_disconnected"),dismissable:!0,duration:0,bannerScenario:"cdl-service-state-disconnected-banner"}),o&&o(!0)})(c,n,a,d,i,t),g=!1}));return()=>{o.unsubscribe()}}}}function noe(e,t,n){const{appService:i,currentState:a,currentStateChangeReason:o,currentStateChangeCode:r,previousState:s}=e;return{appService:i,currentState:a.toString(),currentStateChangeReason:o,currentStateChangeCode:r,previousState:s?.toString(),bannerShownCount:t,bannerDismissCount:n}}const ioe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellIsApplianceModeQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isApplianceMode"}}]}}]},aoe="offline banner",ooe="offline branch survivability banner";function roe(e){const{coreSettings:t,entityCommanding:n,i18n:i,loggerFactory:a,networkState:o,client:r}=e,s=a.newLogger("network-state-subscription-logger","apps-shell"),l=r;let c=!0,d=!1;return{id:"network-state-subscription",job:()=>{if(!t.get(b.J.Core).enableNetworkStateBannerSubscription)return void s.log("network state banner subscription is disabled");const e=t.get(b.J.Calling).enableSurvivabilityT21,a=o.observe().subscribe((async t=>{const a=await l.query({query:ioe,fetchPolicy:"no-cache"});t===Os.G.Offline?e&&a.data?.isApplianceMode?(s.debug("showing branch survivability banner"),d=!0,n.shell.showBanner({id:ooe,source:C.D.ShellNetworkState,bannerScenario:"framework_branch_survivability_offline_banner",intentLevel:"Severe",cause:"Offline",text:i.stringTranslate("calling","offline_banner_message_branch_survivability_v2"),dismissable:!1,duration:0})):(s.debug("showing offline banner"),n.shell.showBanner({id:aoe,source:C.D.ShellNetworkState,bannerScenario:"framework_offline_banner",intentLevel:"Severe",cause:"Offline",text:i.stringTranslate("framework","offline_banner_message"),dismissable:!1,duration:0})):c||(s.debug("dismissing offline banner"),n.shell.dismissBanner(d?ooe:aoe,C.D.ShellNetworkState),d=!1),c=!1}));return()=>{a.unsubscribe()}}}}const soe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"notifyWorkerSyncCanStart"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notifyWorkerSyncCanStart"}}]}}]};const loe={id:"com.microsoft.teams.shell",name:"Shell",actors:[z0],supportedEntities:[Se.py.appswitcherdesktopactivecalldialog,Se.py.appswitchert1downloaddialog,Se.py.appswitcherwebactivecalldialog,Se.py.appswitcherwebmultipletabsdialog,Se.py.bannerNotification,Se.py.brbfeedbackdialog,Se.py.hybridplaceholder,Se.py.identitydialog,Se.py.pearnotdefaultapp,Se.py.signoutdialog,Se.py.inAppToast,Se.py.tpndialog,Se.py.unsupporteddeeplinkdialog,Se.py.updatemsaprofileavatardialog,Se.py.updatemsaprofilenamedialog,Se.py.joinlinkdialog,Se.py.autobrbconfirmationdialog,Se.py.autobrbflowdialog,Se.py.framework,Se.py.officeintegrationfredialog,Se.py.memenu,Se.py.premiumtrialdialog,Se.py.updatedesktopapp,Se.py.invitecoworkers,Se.py.licenserequestdialog,Se.py.switchaccountdialog,Se.py.exploratorylicensenotificationbanner,Se.py.vdirestartworkflow,Se.py.addphonelinkdialog],supportedRenderModes:[Mt.e.Main,Mt.e.Modal,Mt.e.Rail,Mt.e.ThinHorizontalBar,Mt.e.TitleBar,Mt.e.VerticalBar],windowFeatures:{minWidth:602,width:602,minHeight:520,height:520,offset:20}};var coe=n(993704);const doe=(e,t,n,i)=>{if(e.data)switch(e.type){case Sae.iC.launch:const a=e.data(),o=(e=>QW(e.tileID,e))(a),r=(e=>{switch(e.tileID){case jW:return dA.wh.teams;case xW:return dA.wh.chat;case RW:return dA.wh.calendar;case OW:return dA.wh.calls;case $W:return dA.wh.files;default:return dA.wh.AppBar}})(a);o?.focusOnLeftRailItem&&i?.();const s=a.tileID,l=o?.appName,c=n.createDatabag?.();return c&&(c.launchTileId=s,c.launchTilePosition=a.tilePosition,c.launchTileEventType=a.reactEvent?.type,c.launchTileAppName=l,c.launchOut=a.launchOut,c.tileHostContext=a.tileHostContext),n.recordPanelAction({actionScenario:dA.Tk.openApp,actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenarioType:dA.Yu.nav,moduleType:dA.PO.nav,moduleName:dA.rA.appBarItem,panelType:r,panelRegion:dA.Ai.main,dataBag:c,extensibilityData:{id:s,name:l,scenarioCapability:dM.Ky.na,scope:dM.Mv.personal}},t),c?.dispose(),o?.appViewCommand;case coe.St.PlatformEvents.markAllAsRead:{const i=((e,t)=>{if(e===OW)return{appName:"callsmain",markAsReadCommand:{command:YO()}};t.error(`Received an unknown or unsupported core app id. Cannot use markAllAsRead command on app with id ${e}.`)})(e.data(),t);return n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.markAllAsRead,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left},t),i?.markAsReadCommand}case Sae.iC.uninstall:const d=e.data();return n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.uninstallAppOnAppBarAndPersonalAppsFlyout,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left},t),{command:WB(d.tileID,d.appName,d.isInUse)};case coe.St.PlatformEvents.about:{const i=e.data();return n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.personalAppAbout,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left},t),{command:HB(i)}}case coe.St.PlatformEvents.blockUnblockBotChat:{const i=e.data();return n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.blockUnblockBotChatInPersonalAppsFlyout,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left},t),{command:VB(i)}}case coe.St.PlatformEvents.newChat:return n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.newChatCreation,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left},t),{command:l$()};case coe.St.PlatformEvents.popNewChat:return n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.newChatCreation,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left},t),{command:c$()};case Sae.iC.appTileHover:return;default:return void t.warn(`Received an unhandled tile event, type: ${e.type}`)}else t.error(`Received an event without data! Event type: ${e.type}`)};var uoe=n(946425);const moe=({userBiService:e,actionScenario:t,actionOutcome:n,moduleName:i,moduleType:a,actionScenarioType:o,logger:r,actionGesture:s=dA.uS.click,panelType:l=dA.wh.meControl,panelRegion:c=dA.Ai.main,dataBag:d})=>{e.recordPanelAction({actionOutcome:n,actionGesture:s,actionScenarioType:o,panelRegion:c,panelType:l,actionScenario:t,moduleName:i,moduleType:a,dataBag:d},r),d?.dispose()},poe={OneHour:"settings_note_expiry_hour",HalfHour:"settings_expiry_status_half_hour",TwoHours:"settings_note_expiry_hours_two",FourHours:"settings_note_expiry_hours_four",Today:"settings_note_expiry_today",ThisWeek:"settings_note_expiry_this_week",Custom:"settings_note_expiry_custom",Never:"settings_note_expiry_never"},goe={Home:"Remote",Remote:"Remote",Office:"Office",TimeOff:"TimeOff",Unknown:null},hoe=(e,t,n)=>{switch(e.type){case uoe.BR.updateDisplayName:return{command:Z0()};case uoe.BR.updateProfilePicture:return{command:X0()};case uoe.BR.scheduleOOF:return moe({userBiService:t,actionScenario:dA.Tk.oofSettingsOpen,actionOutcome:dA.$K.navigateToPanel,moduleName:dA.rA.oofSettingsOpenLink,moduleType:dA.PO.link,actionScenarioType:dA.Yu.oofSettings,logger:n}),{command:{actor:oie,action:rie}};case uoe.BR.openProfileCard:const{presenceIdMRI:i,eventType:a,position:o}=e.data?.();return function(e,t,n){if(!e)return;switch(t){case"mouseenter":case"mouseleave":case"click":case"keydown":return{command:nG({eventType:t,userId:e,left:n.left,top:n.top,width:n.width,height:n.height,useNewEventObserver:!0})};default:return}}(i,a,o);case uoe.BR.setStatusMessageSubmitted:{const i=e.data?.(),a=t.createDatabag?.();if(i&&a){const{pinStatusToChat:e,isOutOfOffice:t,expiry:n}=i.statusNoteRequest;a.pinnedStatusMessage=e,a.oof=t,a.expiryDate=n?.preDefined?poe[i.statusNoteRequest.expiry.preDefined]:null}return moe({userBiService:t,actionScenario:dA.Tk.setStatusMessage,actionOutcome:dA.$K.submit,moduleName:dA.rA.statusMessageForm,moduleType:dA.PO.button,actionScenarioType:dA.Yu.statusMessage,logger:n,dataBag:a}),{command:{actor:oie,action:sie}}}case uoe.BR.setAvailabilitySubmitted:{const i=e.data?.(),a=t.createDatabag?.();if(i&&a){const{category:e,presetDuration:t,customExpiry:n}=i;a.expiryStatusOverridden=!(!t&&!n),a.expiryDate=t?poe[t]:void 0,a.selectedStatus=e}return void moe({userBiService:t,actionScenario:dA.Tk.setPresence,actionOutcome:dA.$K.select,moduleName:dA.rA.availabilityDropdown,moduleType:dA.PO.dropdown,actionScenarioType:dA.Yu.availability,logger:n,dataBag:a})}case uoe.BR.setWorkLocationSubmitted:{const i=e.data?.(),a=t.createDatabag?.();if(i&&a){const{workLocationId:e}=i;a.workLocation=goe[e||"Unknown"]}return void moe({userBiService:t,actionScenario:dA.Tk.setWorkLocation,actionOutcome:dA.$K.select,moduleName:dA.rA.workLocationDropdown,moduleType:dA.PO.dropdown,actionScenarioType:dA.Yu.hybridPresence,logger:n,dataBag:a})}default:return}};var yoe=n(898067);var voe=n(630213);var foe=n(822582);const Soe={onEventReceived:async e=>{const t=e.requestContext.loggerFactory.newLogger("apps-shell-event-handler","apps-shell"),n=e.requestContext.userBiService,i=e.requestContext.scenarioFactory,a=e.eventInput.event;switch(a.originator){case voe.k:if(a.type===voe.u.openContextualSearch){const e=a.data?.();return{command:F0(e)}}break;case Sae.DQ:return doe(a,t,n,(()=>{const t=e.requestContext.client?.ctx;t&&e.requestContext.shortcutExecutionService.executeCommand(t.windowId,"FocusOnLeftRailItem")}));case Sae.ib:return((e,t,n)=>{e.type!==Sae.iC.userSearch?t.warn(`Received an unhandled Launch tile event, type: ${e.type}`):n.recordPanelAction({actionGesture:dA.uS.keypress,actionOutcome:dA.$K.show,actionScenario:dA.Tk.userSearchFromPersonalFlyout,actionScenarioType:dA.Yu.appBar,moduleName:dA.rA.novaAppBar,panelRegion:dA.Ai.left},t)})(a,t,n);case Sae.Ol:return((e,t,n)=>{if(!e.data)return void t.error("Received a launch event without data!");const i=n.createDatabag?.(),a=(0,L.J)(),o=dM.Mv.personal.toString(),r=dM.Ky.na.toString();switch(e.type){case Sae.iC.install:{const a=e.data();return i&&(i.launchTileId=a.tileID),n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.clickAddFromPersonalFlyoutSuggestions,actionScenarioType:dA.Yu.appBar,moduleName:dA.rA.novaAppBar,panelRegion:dA.Ai.left,dataBag:i},t),i?.dispose(),{command:BB(a.tileID)}}case Sae.iC.description:{const a=e.data();return i&&(i.launchTileId=a.tileID),n.recordPanelAction({appId:a.tileID,appScenarioCapability:r,appScope:o,actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.flyoutAppItemClicked,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.nav,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left,dataBag:i},t),i?.dispose(),{command:UB(a.tileID)}}case Sae.iC.privacy:{const s=e.data();return i&&(i.launchTileId=s.tileID),n.recordPanelAction({appId:s.tileID,appScenarioCapability:r,appScope:o,actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.personalFlyoutPrivacyLink,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left,dataBag:i},t),i?.dispose(),void a.open(s.privacyUrl)}case Sae.iC.termsOfUse:{const s=e.data();return i&&(i.launchTileId=s.tileID),n.recordPanelAction({appId:s.tileID,appScenarioCapability:r,appScope:o,actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.personalFlyoutTermsOfUseLink,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left,dataBag:i},t),i?.dispose(),void a.open(s.termsOfUseUrl)}case Sae.iC.permissions:{const a=e.data();return i&&(i.launchTileId=a.tileID),n.recordPanelAction({appId:a.tileID,appScenarioCapability:r,appScope:o,actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.personalFlyoutItemPermissions,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.AppBar,panelRegion:dA.Ai.left,dataBag:i},t),i?.dispose(),{command:UB(a.tileID,"permissions")}}default:return void t.warn(`Received an unhandled Launch tile event, type: ${e.type}`)}})(a,t,n);case Sae.Av:return((e,t,n)=>{if(e.data){if(e.type===Sae.iC.suggestedLinkClick){const i=e.data(),{appId:a,isChannel:o}=JSON.parse(i.tileID);return n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.quickAccessLinkClicked,actionScenarioType:dA.Yu.appBar,moduleName:dA.rA.novaAppBar,panelRegion:dA.Ai.left,appId:a,threadType:o?"Channel":"GroupChat"},t),{command:GB(i.tileID)}}t.warn(`Received an unhandled suggested link tile launch event, type: ${e.type}`)}else t.error("Received a suggested link tile launch event without data!")})(a,t,n);case Sae.A$:return((e,t,n)=>{e.type!==Sae.iC.seeAllButtonClick?t.warn(`Received an unhandled see all button click event, type: ${e.type}`):n.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.show,actionScenario:dA.Tk.flyoutSeeAllClicked,actionScenarioType:dA.Yu.appBar,moduleName:dA.rA.novaAppBar,panelRegion:dA.Ai.left},t)})(a,t,n);case yoe.s.SimpleCollabSwitcher:return((e,t)=>{let n;switch(e.data?n=e.data():t.warn("No data in event",e),e.type){case yoe.$.SwitchOnSimpleCollab:return{command:$U()};case yoe.$.SwitchOffSimpleCollab:return n?.simpleCollabAppSplitViewEnabled?{command:OU({commandSource:n?.commandSource})}:{command:r$()};case yoe.$.SwitchOnSplitView:default:return{command:r$()}}})(a,t);case Sae.tL:return{command:yW()};case Sae.Ug:return((e,t,n,i)=>{switch(e.type){case Sae.iC.appBarImpression:return void n.stopScenarioIfActive(H.RG.AppBarLoad);case Sae.iC.renderError:{let i;e.data&&(i=e.data()),t.errorToTelemetry&&t.errorToTelemetry("AppBar render failed!","webclient_framework_shell_appbar_render_failure_event"),t.error("AppBar Render Error:",i?.error),t.error("AppBar React Error Info:",i?.errorInfo);const a=n.findScenario(H.RG.AppBarLoad);return void(a&&a.fail())}case Sae.iC.flyoutOpened:return i.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.show,actionScenario:dA.Tk.launchPersonalFlyout,actionScenarioType:dA.Yu.appMgmt,moduleType:dA.PO.nav,moduleName:dA.rA.novaAppBar,panelType:dA.wh.appsFlyoutPopover,panelRegion:dA.Ai.popover},t),{command:$B()};case Sae.iC.flyoutRendered:{if(!e.data)return void t.error("Received a launch event without data!");const n=e.data(),a=i.createDatabag?.();return a&&(a.overflowCount=n.overflowCount),i.recordPanelAction({actionGesture:dA.uS.click,actionOutcome:dA.$K.show,actionScenario:dA.Tk.appsFlyoutOpen,actionScenarioType:dA.Yu.appBar,moduleType:dA.PO.button,moduleName:dA.rA.novaAppBar,panelType:dA.wh.appsFlyoutPopover,panelRegion:dA.Ai.popover,dataBag:a},t),void a?.dispose()}case Sae.iC.flyoutButtonHover:return;default:return void t.warn(`Received an unhandled Launch tile event, type: ${e.type}`)}})(a,t,i,n)}return a.type===foe.uS.openPhonelinkDialog?{command:e1()}:a.originator===uoe.CB?((e,t)=>{switch(e.type){case uoe.BR.addNewAccount:return{command:{actor:T9,action:N9,data:{commandSource:C.D.AddAccountFromMeMenu}}};case uoe.BR.switchTenant:const n=e.data?e.data().tenantId:void 0;return n?{command:M9(n)}:void(t.errorToTelemetry&&t.errorToTelemetry("Me Control Switch Tenant called without tenant id.","webclient_framework_shell_event_handler_error"));case uoe.BR.switchAccount:const i=e.data?e.data().accountId:void 0;return i?{command:P9(i)}:void(t.errorToTelemetry&&t.errorToTelemetry("Me Control Switch account called without account id.","webclient_framework_shell_event_handler_error"));default:return}})(a,t):a.originator===uoe.D_?(e=>{switch(e.type){case uoe.BR.openMeControl:return{command:x9()};case uoe.BR.signOut:return{command:D9()};default:return}})(a):a.originator===uoe.ls?hoe(a,n,t):Promise.resolve(void 0)}},koe=async({commandInput:{command:e},requestContext:{loggerFactory:t}})=>{const n=e.action,i=t.newLogger("ShellApp onCommandReceived","apps-shell");return n===q0?"object"==typeof(a=e.data)&&null!==a&&"title"in a&&"intent"in a&&"dismissOnAction"in a?{command:{correlation:{source:C.D.Nova},stateTransition:ke.su.none,visibilityState:ke.fe.show},entity:{type:Se.py.inAppToast,action:Se.uk.create,id:(0,Re.v4)()},entityOptions:e.data}:void i.errorNoPii?.(`Command for action '${e.action}' requires title, intent and dismissOnAction.`):n===J0?{command:{correlation:{source:C.D.Nova},stateTransition:ke.su.extend,visibilityState:ke.fe.show},entity:{type:Se.py.updatemsaprofileavatardialog,action:Se.uk.view}}:n===K0?{entity:{type:Se.py.addphonelinkdialog,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.Nova}}}:n===Q0?{command:{correlation:{source:C.D.Nova},stateTransition:ke.su.extend,visibilityState:ke.fe.show},entity:{type:Se.py.updatemsaprofilenamedialog,action:Se.uk.view}}:void 0;var a},Coe=({type:e,appRenderMode:t})=>{const n=new MV.H,i=[];return e===Se.py.pearnotdefaultapp&&t===Mt.S.Main&&i.push(xV.G.APP_SWITCHER_CONFIRMATION_RENDERED),n.registerAppPhase({phase:yt.nh.CRITICAL,signals:i,timeout:5e3}),n.appPhases},boe=(e,t)=>-1===e.localeCompare(t,void 0,{numeric:!0,sensitivity:"base"});function woe(e){const{coreSettings:t,i18n:n,entityCommanding:i,loggerFactory:a,scenarioFactory:o}=e,r=a.newLogger("DesktopUnsupportedVersionCheckJob","apps-shell"),{enableDesktopMinimumVersionBanner:s}=t.get(b.J.Core),l=o.newScenario(H.RG.MinimumVersionBannerShown);return s?{id:"desktop-minimum-version-check-job",runOncePerId:!0,job:async()=>{r.log("Checking unsupported desktop client versions...");const e=function(e,t){const{minimumDesktopVersion:n}=t.get(b.J.Core),{desktopVersion:i}=t.get(b.J.Host),{deviceInfo:a}=t.get(b.J.Platform),o=a?.cpuArchitecture||void 0,r=a?.osName||void 0,s=function(e,t,n,i){if(t&&e){if(e.includes("macos"))return n.macOS;if(e.includes("windows"))switch(!0){case t.includes("x64")||t.includes("amd64")||t.includes("intel64"):return n.x64;case t.includes("x86"):return n.x86;case t.includes("arm64"):return n.arm64;default:i.errorToTelemetry?.(`Unknown cpuarch: ${t}`,"unsupported-version-banner-job",{},!0)}}}(r?.toLowerCase(),o?.toLowerCase(),n,e);if(e.log(`Desktop client version is ${i}, minimum supported version is ${s}`),s&&i)return!!boe(i,s)&&(e.log("Unsupported desktop version detected."),!0);e.log("Desktop client versions not found. Desktop version check skipped.")}(r,t);e&&(!function(e,t,n,i,a,o){t.shell.showBanner({id:e,source:C.D.ShellVersionCheck,bannerScenario:a,intentLevel:"Severe",cause:"UnsupportedAppVersionDetected",text:n.stringTranslate("framework",a),action:{text:n.stringTranslate("framework",o),command:{entity:{type:Se.py.updatedesktopapp,action:Se.uk.confirm,id:RJ.Y.Notifications}},dismissOnAction:!0},dismissable:!0,duration:0}),i.log("Desktop sedimentation banner displayed")}("DesktopSedimentationBanner",i,n,r,"desktopapp_version_unsupported_generic_banner","more_options_menu_initiate_update"),l?.mark("minimum_version_banner_shown")),l?.stop()}}:(r.log("Sedimentation banner disabled by feature flag"),void l.stop({reason:"enableDesktopMinimumVersionBanner disabled"}))}var Toe=n(996478),Ioe=n(867840),Noe=n(875399);const Eoe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellMeQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"me"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}}]}}]}}]};var Aoe=n(130480);const _oe="presence-donotdisturb-banner",Foe="presence-statusmessage-banner",Doe="Unknown";function Poe(e){const{i18n:t,entityCommanding:n,loggerFactory:i,authenticationUser:a,client:o,coreSettings:r,userBiService:s}=e,l=i.newLogger("presence-state-subscription-logger","apps-shell"),c=o;return{id:"presence-prewarm-job",job:async()=>{const{enablePresenceTopBanner:e}=r.get(b.J.Presence);if(!e)return void l.log("presence state banner subscription is disabled");const i=await c.query({query:Eoe});let o;const d=c.subscribe({query:Ioe.z,variables:{userId:i.data.me?.mri,source:"ups"}}).subscribe((({data:e})=>{const{presenceUpdateEvent:i}=e||{};var r,c;i?.availability!==o?.availability&&(i?.availability===Toe.a.DoNotDisturb?function(e,t){const n=e.stringTranslate("presence","dnd_info_banner_message"),i=e.stringTranslate("presence","presence_info_banner_change_settings"),a={source:C.D.ShellPresenceState},o="privacy_manage_priority_access",r={text:i,command:{entity:{type:Se.py.settingsstore,action:Se.uk.view,id:RJ.Y.Privacy,linkedEntity:{id:o,action:Se.uk.view,type:Se.py.settingsstore}},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,targetWindow:ke.PH.main,correlation:a},entityOptions:{correlation:a}},dismissOnAction:!1};Roe(_oe,t,"PresenceDoNotDisturb",n,r)}(t,n):xoe(_oe,n)),r=i?.statusNote,c=o?.statusNote,(r?.message!==c?.message||r?.expiry!==c?.expiry)&&(i?.statusNote&&Moe(i.statusNote)?function(e,t,n){let i;i=new Date(n??Aoe.f1).getFullYear()>=Aoe.cO||!n?e.stringTranslate("presence","status_note_expirynever_info_banner_message"):e.stringTranslate("presence","status_note_info_banner_message",{expiryTime:e.formatDateTime(new Date(n),Noe.uF)});Roe(Foe,t,"PresencePinnedStatusNote",i)}(t,n,i?.statusNote?.expiry):xoe(Foe,n));const d=i?.workLocation?.location!==o?.workLocation?.location||i?.workLocation?.locationSource!==o?.workLocation?.locationSource,u=i?.workLocation?.approximateDetails?.id!==o?.workLocation?.approximateDetails?.id||i?.workLocation?.approximateDetails?.idType!==o?.workLocation?.approximateDetails?.idType;if(i?.workLocation?.location&&s){const e=s.createDatabag?.();if(e&&(d&&(e.workLocation=i.workLocation.location??Doe,e.locationSource=i.workLocation.locationSource??Doe),u)){const t=!!o?.workLocation?.approximateDetails?.id,n=!!i?.workLocation?.approximateDetails?.id,a=!n&&t;e.workLocationDetails=n?"Set":a?"Cleared":"Empty"}moe({userBiService:s,actionScenario:dA.Tk.readWorkLocation,actionOutcome:dA.$K.read,moduleName:dA.rA.presenceUpdateEventRead,moduleType:dA.PO.event,actionScenarioType:dA.Yu.hybridPresence,actionGesture:dA.uS.asyncStateChange,logger:l,dataBag:e})}o=i,l.log(`[Presence State Subscription] ID: ${a?.id}`)}));return()=>{d.unsubscribe(),l.log("[Presence] unsubscribing ...")}}}}const Moe=e=>e.message?.includes("<pinnednote></pinnednote>");function xoe(e,t){t.shell.dismissBanner(e,C.D.ShellPresenceState)}function Roe(e,t,n,i,a,o){t.shell.showBanner({id:e,source:C.D.ShellPresenceState,intentLevel:"Neutral",cause:n,text:i,action:a,dismissable:!0,duration:0,dismissActionCommand:o})}const joe="downloading_weblogs";function Loe(e){const{coreSettings:t,entityCommanding:n,i18n:i,loggerFactory:a,logsCollectorService:o}=e,r=a.newLogger("download-log-subscription-logger","apps-shell");return{id:"download-log-subscription",job:()=>{if(!o)return void r.log("logsCollectorService is invalid");if(t.get(b.J.Core).disableDownloadLogStatusSubscription)return void r.log("download log banner subscription is disabled");const e=o.observeDownloadLogStatus().subscribe((e=>{e?(r.debug("showing download log banner"),n.shell.showBanner({id:joe,source:C.D.LogsDownloading,bannerScenario:"downloading_Weblogs",intentLevel:"Neutral",duration:0,text:i.stringTranslate("framework","downloading_weblogs")})):(r.debug("dismissing download log banner"),n.shell.dismissBanner(joe,C.D.LogsDownloading))}));return()=>{e.unsubscribe()}}}}const Ooe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsShellUserLicenseDetailsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userLicenseDetails"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isTrial"}},{kind:"Field",name:{kind:"Name",value:"exploratoryTrialLicenseEndDate"}}]}}]}}]};function $oe(e){const{client:t,entityCommanding:n,loggerFactory:i,coreSettings:a,i18n:o}=e,r=i.newLogger("exploratory-upgrade-banner-job","apps-shell"),s=t,l="smb_web_and_desktop_growth_exploratory_upgrade_banner";return{id:"exploratory-upgrade-banner-job",job:async()=>{const{enableExploratoryExpiryBanner:t,exploratoryExpirySevereBannerDaysBeforeExpiryThreshold:i}=a.get(b.J.Growth);if(!t)return;const c=performance.now();try{let t;try{t=await s.query({query:Ooe})}catch{return void r.errorToTelemetry?.("Failed to get user license details",l)}const{isTrial:d,exploratoryTrialLicenseEndDate:u}=t?.data?.userLicenseDetails||{};if(!d)return void r.infoToTelemetry?.("Skip because user is not trial",l);if(!u)return void r.errorToTelemetry?.("exploratoryTrialLicenseEndDate is not present in the trial user's license details",l);const m=function(e){const t=e.localStorage.getItem(Lae);if(!t)return null;const n=new Date(t);return isNaN(n.getTime())?null:n}(e.windowProvider),p=function(e){return Oae(new Date,e)}(u);if(!function(e,t,n){const{exploratoryExpiryBannerDaysBeforeExpiryThreshold:i,exploratoryExpiryBannerNoCooldownThreshold:a,exploratoryExpiryBannerCooldownInDays:o}=n.get(b.J.Growth),r=o||0;return e<(i||0)&&(e<(a||0)||null===t||Oae(t,new Date)>r)}(p,m,a)){const e=performance.now()-c;return void r.infoToTelemetry?.("Trial user not eligible for banner",l,{totalRequestTime:e})}const g=p<(i||0)?"Severe":"Neutral",h=o.formatDateTime(u,Noe.WG),y=o.stringTranslate("growth","exploratory_expiry_banner_text",{expiryDate:h}),v=o.stringTranslate("growth","exploratory_expiry_banner_action");n.shell.showBanner({id:"exploratoryExpirationBanner",source:C.D.ExploratoryUpgradeBannerJob,intentLevel:g,dismissable:!0,text:y,action:{dismissOnAction:!0,text:v,command:{entity:{type:Se.py.exploratorylicensenotificationbanner,action:Se.uk.info},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.ExploratoryUpgradeBannerJob}}}},dismissActionCommand:{entity:{type:Se.py.exploratorylicensenotificationbanner,action:Se.uk.delete}},duration:0,bannerScenario:"exploratory_expiration_banner"});const f=performance.now()-c;r.infoToTelemetry?.(`Queued banner with severity ${g}`,l,{totalRequestTime:f})}catch(e){const t=performance.now()-c;r.errorToTelemetry?.("Failed to show exploratory product banner",l,{totalRequestTime:t})}}}}const Uoe=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(986797),n.e(84274),n.e(393890),n.e(773923),n.e(65537),n.e(505990),n.e(865804),n.e(152739),n.e(361845),n.e(766254),n.e(664625),n.e(457535),n.e(896201),n.e(255279),n.e(44025),n.e(551124),n.e(129609),n.e(788241),n.e(240446),n.e(95719),n.e(448808),n.e(547521),n.e(896963),n.e(604994),n.e(129462),n.e(100385),n.e(954305),n.e(565168),n.e(418198),n.e(6605),n.e(669491),n.e(128916),n.e(917359),n.e(979549),n.e(630169),n.e(390466),n.e(785695),n.e(68816),n.e(720930),n.e(928362),n.e(652421),n.e(841342),n.e(68021),n.e(429986),n.e(103554),n.e(375387),n.e(10531),n.e(73598),n.e(336048),n.e(262775),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(360134),n.e(357903),n.e(949636),n.e(281467),n.e(678342),n.e(126541),n.e(258544),n.e(253408),n.e(347076),n.e(1626),n.e(592714),n.e(408654),n.e(883971),n.e(247982),n.e(469794),n.e(196623),n.e(931153),n.e(305271)]).then(n.bind(n,499425)),Boe=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(909020),n.e(773923),n.e(766254),n.e(664625),n.e(397833),n.e(551124),n.e(788241),n.e(418198),n.e(598736),n.e(413154),n.e(345598),n.e(928362),n.e(10531),n.e(336048),n.e(424092),n.e(371898),n.e(126541),n.e(408654),n.e(247982),n.e(897526)]).then(n.bind(n,570108)),Woe=({host:e,screenState:t,isResize:n})=>{if(n){if(!loe.windowFeatures)return null;const{offset:e,...t}=loe.windowFeatures;return t}const{height:i,minHeight:a,minWidth:o,offset:r,width:s}=loe.windowFeatures||{},l=e?.screenX||0,c=e?.screenY||0,d=(t?.numOpenWindows||1)*(r||1);return{additionalFeatures:{minHeight:`${a}`,minWidth:`${o}`},height:i,left:l+d,minHeight:a,minWidth:o,top:c+d,width:s}};function Hoe(e){const t=e?.isMainWindow;t&&(loe.supportedRenderModes?.push(Mt.e.PartialOverlay),loe.supportedRenderModes?.push(Mt.e.OverlayThinHorizontalBar));return{getAppPhases:Coe,getAppViewEntities:dae,getAppViewEntitiesProps:fae,getAppWindowFeatures:Woe,getEventScenarioData:bae,manifest:loe,render:async({appRenderMode:e,onRenderEvent:n,scenarioFactory:i})=>{let a;if(t){const e="shell-app";n("ChunkLoadStarted",{chunkName:e}),a=(await(0,ac.mT)(Uoe,e,i)).T2ShellViewsRenderer,n("ChunkLoadSucceeded",{chunkName:e})}else{const e="mw-shell-app";n("ChunkLoadStarted",{chunkName:e}),a=(await(0,ac.mT)(Boe,e,i)).T1ShellViewsRenderer,n("ChunkLoadSucceeded",{chunkName:e})}return(0,gO.t)(a,{appRenderMode:e})},onPreWarm:e=>{const{context:t}=e,n=[Zae(t),toe(t),roe(t),Poe(t),Loe(t),$oe(t)],i=function(e){const{client:t,coreSettings:n}=e,i=t;if(n.get(b.J.CdlWorker).enableStartupDeferral)return{id:"worker-start-sync",runOncePerId:!0,job:()=>{i.mutate({mutation:soe,fetchPolicy:"no-cache",variables:{}})}}}(t);i&&n.push(i);const a=woe(t);return a&&n.push(a),n},onBeforeDeeplinkParsed:Gae,eventHandlers:Soe,onBeforeIntentAuthenticated:zae,onBeforeCommandHandled:Vae,onCommandReceived:koe,onExperienceLongIdle:qae}}const Voe={StoreDevices:"StoreDevices",StoreCartCheckout:"StoreCartCheckout",StoreCart:"StoreCart"},Goe="viewStoreCartCheckout",zoe="viewDeviceDetails",qoe="viewStoreCart",Joe="closeStoreCartCheckout",Qoe=e=>({actor:Voe.StoreDevices,action:zoe,data:e}),Koe=()=>({actor:Voe.StoreCart,action:qoe}),Yoe=e=>({actor:Voe.StoreCartCheckout,action:Goe,data:e}),Xoe=()=>({actor:Voe.StoreCartCheckout,action:Joe}),Zoe=async({commandInput:e,requestContext:{loggerFactory:t}})=>{const{command:{action:n}}=e,i=t.newLogger("StoreApp onCommandReceived","apps-store");if(e.command.actor===gW||e.command.actor===Voe.StoreDevices||e.command.actor===Voe.StoreCartCheckout||e.command.actor===Voe.StoreCart)switch(n){case hW:return{entity:{type:Se.py.store,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}};case zoe:return{entity:{type:Se.py.devicedetails,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.Store}},entityOptions:e.command.data};case qoe:return{entity:{type:Se.py.storecart,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.Store}}};case Goe:return{entity:{type:Se.py.storecartcheckout,action:Se.uk.view},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.Store}},entityOptions:e.command.data};case Joe:return{entity:{type:Se.py.storecartcheckout,action:Se.uk.view},command:{visibilityState:ke.fe.hide,stateTransition:ke.su.flush,correlation:{source:C.D.Store}}};default:i.error(`Command action '${n}' is not supported by StoreApp.`)}else i.error(`Command for actor '${e.command.actor}' cannot be handled by StoreApp.`)},ere=e=>{if(tre(e))return nre(e)?{subNavEntity:ire(e),headerEntity:are(e),startEntity:ore(e),mainEntity:rre(e),endEntity:sre(e)}:null},tre=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.store].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},nre=()=>!0,ire=()=>null,are=()=>null,ore=()=>null,rre=({entity:e})=>e,sre=()=>null,lre={id:"com.microsoft.teams.store",name:"StoreApp",actors:[gW,...Object.keys(Voe)],getLocalizedName:async e=>(await e.waitForNamespace("extensibility"),e.stringTranslate("extensibility","extensibility_apps_label")),supportedEntities:[Se.py.store,Se.py.storefre,Se.py.devicedetails,Se.py.storecart,Se.py.storecartcheckout],supportedRenderModes:[Mt.S.Main,Mt.S.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},cre={filter:e=>e.pathname?.startsWith("/l/store"),execute:async({deeplinkUrl:e})=>{const t=e.searchParams.get("id")??"";return Promise.resolve({entityCommand:{entity:{id:t,type:Se.py.store,action:Se.uk.view},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}})}},dre={filter:e=>e.pathname?.startsWith("/l/manageApps"),execute:async({deeplinkUrl:e})=>{const t=e.searchParams.get("id")??"",n=e.searchParams.get("scope")??"",i="Team"===n;return Promise.resolve({entityCommand:{entity:{type:i?Se.py.teammanageapps:Se.py.chatManageApps,action:i?Se.uk.view:Se.uk.manage,id:t,linkedEntity:{type:i?Se.py.channels:Se.py.chats,id:t}},command:{stateTransition:ke.su.forceFlush,visibilityState:ke.fe.show,targetWindow:ke.PH.main},entityOptions:{id:t,scope:n}},metadata:{allowAnonymous:!1}})}},ure=[{filter:(e,t)=>Boolean(e.hash)&&(t?.pathname||"").startsWith("/subscriptionmanagement"),execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableSubscriptionManagementInStore:n}=e.get(b.J.Extensibility),i=t.newLogger("Store:BeforeDeeplinkParsedCondition","apps-store");return n?(i.log("execute command handleSubscriptionManagementDeeplink"),Promise.resolve({entityCommand:{entity:{type:Se.py.store,action:Se.uk.manage},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,layoutMode:ke.lO.standard},entityOptions:{tabType:"Subscriptions"}},metadata:{allowAnonymous:!1}})):(i.log(`Teams app subscription management is not enabled, enableSubscriptionManagementInStore value is ${n}`),Promise.reject({message:"teams-app-subscription-management-not-enabled"}))}},cre,dre,{filter:e=>{if(!e.pathname.startsWith("/l/app"))return!1;const{pathname:t}=e,n=t?.split(/[/?&]/),i=n?.indexOf("app"),a=n?.[i+1];return!!a},execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("Store_handleAppInstallDeeplink","apps-store"),{pathname:i,search:a}=e,o=new URLSearchParams(a),r=o.get("source"),s=o.get("sharedAppResource"),l=o.get("viewState"),c=o.get("templateInstanceId"),d=o.get("environment"),u=o.get("installAppPackage"),m=o.get("appTenantId"),p=o.get("tenantId"),g=i?.split(/[/?&]/),h=g?.indexOf("app"),y=g?.[h+1];let v;try{if("string"!=typeof l||l!==uM.v0.PostReview&&l!==uM.v0.ViewReviews){const e=l&&JSON.parse(l);"object"==typeof e&&"name"in e&&e.name in uM.v0&&(v=e)}else v={name:l}}catch{}const f=!!u&&!c,S="TaosSharedApp"===s??void 0;let k=uM.RE.DeepLink;f?k=uM.RE.DeepLinkSideLoad:c&&(k=uM.RE.DeepLinkTrustedSideLoad);const b={appId:y,deepLinkSource:r||"unknown",templateInstanceId:c||void 0,environment:d||void 0,installAppPackage:!!u,appTenantId:m||void 0,entryPoint:k,viewOptions:{defaultViewState:v},isDebugging:f,isTaosSharedApp:S};return n.log("execute command handleAppInstallDeeplink"),Promise.resolve({entityCommand:{entityOptions:b,entity:{id:y,type:Se.py.platformapp,action:Se.uk.create},command:{visibilityState:ke.fe.show,stateTransition:ke.su.extend,correlation:{source:C.D.StageViewDeeplink}}},metadata:{allowAnonymous:!1,tenantId:p||void 0}})}}];var mre=n(899032);const pre={onEventReceived:async({eventInput:{event:e,source:t}})=>(0,mre.Q0)(e)?Promise.resolve({command:Qoe(e.data()),source:t}):(0,mre.m3)(e)?Promise.resolve({command:Koe(),source:t}):(0,mre.Is)(e)?Promise.resolve({command:Yoe(e.data()),source:t}):(0,mre.Bz)(e)?Promise.resolve({command:Xoe(),source:t}):Promise.resolve(void 0)},gre=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(865804),n.e(459868),n.e(152739),n.e(120894),n.e(664625),n.e(397833),n.e(933161),n.e(128770),n.e(540003),n.e(812934),n.e(649800),n.e(51724),n.e(392718),n.e(123977),n.e(553940),n.e(635026),n.e(788241),n.e(384701),n.e(438152),n.e(654936),n.e(130631),n.e(228737),n.e(233171),n.e(532863),n.e(646036),n.e(947488),n.e(410595),n.e(130351),n.e(193775),n.e(928362),n.e(652421),n.e(213629),n.e(796594),n.e(68021),n.e(475063),n.e(958163),n.e(324415),n.e(730056),n.e(585815),n.e(175953),n.e(214821),n.e(374655),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(6348),n.e(638108),n.e(931930),n.e(187591),n.e(657060),n.e(576911),n.e(468573),n.e(467602),n.e(119288),n.e(115477),n.e(497130)]).then(n.bind(n,511572)),hre=()=>Promise.all([n.e(187946),n.e(463781),n.e(681896),n.e(457628),n.e(346992),n.e(586535),n.e(986797),n.e(393890),n.e(65537),n.e(152739),n.e(664625),n.e(457535),n.e(129609),n.e(240446),n.e(95719),n.e(130351),n.e(980258),n.e(928362),n.e(652421),n.e(324415),n.e(730056),n.e(175953),n.e(214821),n.e(685827),n.e(474133),n.e(609660),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(6348),n.e(931930),n.e(187591),n.e(976612),n.e(115477),n.e(822099)]).then(n.bind(n,434914)),yre=()=>Promise.all([n.e(421278),n.e(425270)]).then(n.bind(n,33200)),vre=()=>Promise.all([n.e(617672),n.e(59490),n.e(364649),n.e(960102),n.e(659098)]).then(n.bind(n,566739));function fre(){const e=()=>null;return{getPlatformAppIdForEntity:e=>e.type===Se.py.store?"ac40aa4a-fef1-4896-aea2-46d1c14dbfd5":void 0,onCommandReceived:Zoe,getAppViewEntities:ere,manifest:lre,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main){const e="store-app";n("ChunkLoadStarted",{chunkName:e});const[{StoreEntryRenderer:t}]=await Promise.all([(0,ac.mT)(gre,e,i),(0,ac.mT)(yre,e,i),(0,ac.mT)(vre,e,i)]);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(t,{})})}if(t===Mt.S.Modal){const e="store-fre-modal";n("ChunkLoadStarted",{chunkName:e});const{Modal:t}=await(0,ac.mT)(hre,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(t,{})})}return(0,gO.t)(e,{})},onBeforeDeeplinkParsed:ure,eventHandlers:pre}}const Sre={id:"com.microsoft.teams.survey-form",name:"SurveyFormApp",supportedEntities:[Se.py.survey,Se.py.givefeedbackchoices],supportedRenderModes:[Mt.S.Main,Mt.S.Modal],windowFeatures:{[Se.py.survey]:{minWidth:600,width:800,minHeight:400,height:640,offset:20},[Se.py.givefeedbackchoices]:{minWidth:602,width:602,minHeight:500,height:500,offset:20}}},kre=e=>{if(Cre(e))return bre(e)?{subNavEntity:wre(e),headerEntity:Tre(e),startEntity:Ire(e),mainEntity:Nre(e),endEntity:Ere(e)}:null},Cre=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o={[Se.py.givefeedbackchoices]:[Se.uk.default,Se.uk.view],[Se.py.survey]:[Se.uk.default,Se.uk.view]},r=n&&(o[i]||[]).includes(n);return!(!a||!r)},bre=()=>!0,wre=()=>null,Tre=()=>null,Ire=()=>null,Nre=({entity:e})=>e,Ere=()=>null,Are={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"bootstrapFloodgate"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"firstLoginInformation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"bootstrapFloodgate"},arguments:[{kind:"Argument",name:{kind:"Name",value:"firstLoginInformation"},value:{kind:"Variable",name:{kind:"Name",value:"firstLoginInformation"}}},{kind:"Argument",name:{kind:"Name",value:"userSurveyNotificationEnabled"},value:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}}}]}]}}]},_re={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"onSurveySend"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"onSurveySend"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"coachmarkId"}}]}}]}}]},Fre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesForCategorySubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesChangedEventForCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEnableSurveysNotification"}}]}}]}}]},Dre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSurveyFormFloodgateUpdateUserSurveyNotificationEnabledMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floodgateUpdateUserSurveyNotificationEnabled"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userSurveyNotificationEnabled"},value:{kind:"Variable",name:{kind:"Name",value:"userSurveyNotificationEnabled"}}}]}]}}]},Pre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferences"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"firstLoginInfo"}}]}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"firstLoginInfo"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Web"}}]}}]}.definitions]},Mre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesForCategoryQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"category"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPreferencesCategory"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesForCategory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"Variable",name:{kind:"Name",value:"category"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformationValue"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"firstLoginInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesForCategoryFragment"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"UserEnableSurveysNotificationValue"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userEnableSurveysNotification"}}]}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsSurveyFormGetUserPreferencesForCategoryFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FirstLoginInformation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Web"}},{kind:"Field",name:{kind:"Name",value:"WebNorthStar"}},{kind:"Field",name:{kind:"Name",value:"maglev"}},{kind:"Field",name:{kind:"Name",value:"electron"}}]}}]}.definitions]},xre={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsSurveyFormGetTeamsMeetingPoliciesQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"teamsMeetingConfiguration"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"enableQoS"}},{kind:"Field",name:{kind:"Name",value:"clientAudioPort"}},{kind:"Field",name:{kind:"Name",value:"clientAudioPortRange"}},{kind:"Field",name:{kind:"Name",value:"clientVideoPort"}},{kind:"Field",name:{kind:"Name",value:"clientVideoPortRange"}},{kind:"Field",name:{kind:"Name",value:"clientAppSharingPort"}},{kind:"Field",name:{kind:"Name",value:"clientAppSharingPortRange"}},{kind:"Field",name:{kind:"Name",value:"disableAnonymousJoin"}},{kind:"Field",name:{kind:"Name",value:"feedbackSurveyForAnonymousUsers"}}]}}]}}]},Rre=async e=>{const t=await e.query({query:Mre,variables:{category:"firstLoginInformation"}});return"FirstLoginInformationValue"===t.data?.userPreferencesForCategory.__typename?t.data?.userPreferencesForCategory.firstLoginInformation:null},jre="telemetry_instrumentation_feedback_platform_app_job_setup_floodgate",Lre=async(e,t,n,i,a)=>{let o=null,r=null;if(i){const t=await Rre(e),n=a?[t?.maglev,t?.WebNorthStar]:[t?.electron,t?.Web];o=n.every((e=>!e||isNaN(Date.parse(e)))),r=n.map((e=>e&&!isNaN(Date.parse(e))?new Date(e):new Date)).reduce(((e,t)=>e<t?e:t),new Date).toISOString()}else{let t=null;t=n?await Rre(e):await(async e=>{const t=await e.query({query:Pre});return t.data?.userPreferences?.firstLoginInformation})(e),r=t?.Web||"",o=!r}return o&&t.errorToTelemetry?.(`First login information is not available! with enableUserPreferencesForCategoryQuery : ${n?"enabled":"disabled"} enableClientBasedFirstLoginInformation : ${i?"enabled":"disabled"} isReactWebClient : ${a?"yes":"no"}`,jre),r},Ore=(e,t,n,i,a,o)=>({id:"bootstrap-floodgate",runOncePerId:!0,job:async()=>{const{enableUserPreferencesForCategoryQuery:r,enableClientBasedFirstLoginInformation:s}=a.get(b.J.Feedback),{isReactWebClient:l}=a.get(b.J.Extensibility),{enableEnforcingFeedbackTeamsPolicyForAnonUsers:c}=a.get(b.J.Calling),d=n.newLogger("getBootstrapFloodgateJob","apps-suvey-form");d.log(`[getBootstrapFloodgateJob] Initializing floodgate [isAnonymousUser=${o}]`);try{if(o&&c){const t=await e.query({query:xre});if(t.error)return void d.errorToTelemetry?.("[getBootstrapFloodgateJob] Failed to query teams meeting configuration.",jre);if(!t.data||t.loading)return void d.errorToTelemetry?.("[getBootstrapFloodgateJob] Failed to get data from the query for teams meeting configuration.",jre);if(t.data&&"Disabled"===t.data?.teamsMeetingConfiguration?.feedbackSurveyForAnonymousUsers)return void d.log("[getBootstrapFloodgateJob] TeamsMeetingConfiguration policy has disabled surveys for anonymous users.")}const n=(new Date).toISOString(),a=o?n:await Lre(e,d,r,s,l),u=o?null:await(async e=>{const t=await e.query({query:Mre,variables:{category:"userEnableSurveysNotification"}});return"UserEnableSurveysNotificationValue"===t.data?.userPreferencesForCategory.__typename?t.data?.userPreferencesForCategory.userEnableSurveysNotification:null})(e),m=await e.subscribe({query:_re,fetchPolicy:"no-cache"}).subscribe((async({data:e,errors:n})=>{if(n){d.errorToTelemetry?.("[getBootstrapFloodgateJob] Error subscribing to floodgate. Stopping the subscription",jre);try{m.unsubscribe()}catch(e){d.errorToTelemetry?.("[getBootstrapFloodgateJob] Error stopping floodgate",jre)}}d.log?.(`Activated survey: ${e?.onSurveySend.id} with coachmark ${e?.onSurveySend.coachmarkId}`,jre),e?.onSurveySend.coachmarkId&&(await t.esp.displaySurface(e.onSurveySend.coachmarkId),i.newScenario(H.RG.FloodgateSurvey).stop({context:JSON.stringify({surveyId:e?.onSurveySend.id,coachmarkId:e?.onSurveySend.coachmarkId})}))}));await e.mutate({mutation:Are,variables:{firstLoginInformation:a,userSurveyNotificationEnabled:u}});const p=await e.subscribe({query:Fre,variables:{category:"userEnableSurveysNotification"},fetchPolicy:"no-cache"}).subscribe((async({data:t,errors:n})=>{if(n){d.errorToTelemetry?.("[getBootstrapFloodgateJob] Error subscribing to userSettings. Stopping the subscription",jre);try{p.unsubscribe()}catch(e){d.errorToTelemetry?.("[getBootstrapFloodgateJob] Error stopping userSurveyNotificationEnabledSubscription",jre)}}const i=t?.userPreferencesChangedEventForCategory?.userEnableSurveysNotification;null!=i&&await e.mutate({mutation:Dre,variables:{userSurveyNotificationEnabled:i}})}))}catch(e){d.errorToTelemetry?.(`[getBootstrapFloodgateJob] Error initializing floodgate [error.name=${e?.name}] [isAnonymousUser=${o}]`,jre)}d.log("[getBootstrapFloodgateJob] Floodgate initialized")}}),$re=({context:{client:e,coreSettings:t,loggerFactory:n,entityCommanding:i,scenarioFactory:a,authenticationUser:o}})=>{const{enableFloodgateService:r,enableFloodgateServiceOnExperienceIdle:s,enableAnonMeetingEndNpsSurvey:l}=t.get(b.J.Feedback),c=[],d=e,u=o?.type===ys.Ch.Anonymous;return!r||s&&!(u&&l)||c.push(Ore(d,i,n,a,t,u)),c},Ure={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsSurveyFormFloodgateLogActivityMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"activityName"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"increment"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"floodgateLogActivity"},arguments:[{kind:"Argument",name:{kind:"Name",value:"activityName"},value:{kind:"Variable",name:{kind:"Name",value:"activityName"}}},{kind:"Argument",name:{kind:"Name",value:"increment"},value:{kind:"Variable",name:{kind:"Name",value:"increment"}}}]}]}}]};class Bre extends _e{constructor(){super(h.Yg.GeneralizedLogActivityTask,["client","hostCommunicationService","coreSettings","loggerFactory"])}async execute(e){const{client:t,hostCommunicationService:n,coreSettings:i,loggerFactory:a}=e,o=a.newLogger("generalizedLogActivityTask","apps-suvey-form"),r=i?.get(b.J.SurveyForm).enableCsatTaskRegistration;if(r){if(!n)return;try{const e=await n.loadModule("surveyform"),i=e?.registerForLogActivity?.((e=>{((e,t,n)=>{e.mutate({mutation:Ure,variables:{activityName:t,increment:n}})})(t.client,e.activityName,e.incrementValue)}));return()=>{i&&i()}}catch(e){return void o.errorToTelemetry?.(`Loading module surveyform failed with errorCode: ${e.errorCode}`,"generalized_log_activity_task")}}}}const Wre=({context:{client:e,coreSettings:t,loggerFactory:n,entityCommanding:i,scenarioFactory:a}})=>{const{enableFloodgateService:o,enableFloodgateServiceOnExperienceIdle:r}=t.get(b.J.Feedback),s=[],l=e;return o&&r&&s.push(Ore(l,i,n,a,t,false)),s},Hre=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(773923),n.e(869026),n.e(551124),n.e(788241),n.e(664032),n.e(418198),n.e(598723),n.e(798162),n.e(928362),n.e(10531),n.e(336048),n.e(90356),n.e(126541),n.e(408654),n.e(211286)]).then(n.bind(n,616306)),Vre=({host:e,entityType:t})=>{if(!e)return null;const{windowFeatures:n}=Sre,i=t&&n&&n[t]?n[t]:n??void 0,{height:a=1,width:o=1,minHeight:r,minWidth:s}=i||{},l={left:e.screenX,top:e.screenY};if(e.screen){return{left:Math.max((e.screen.availWidth-o)/2,0),top:Math.max((e.screen.availHeight-a)/2,0),additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},minHeight:r,minWidth:s,height:Math.min(a,e.screen.availHeight),width:Math.min(o,e.screen.availWidth)}}return{left:Math.max(l.left,0),top:Math.max(l.top,0),additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},minHeight:r,minWidth:s,height:a,width:o}};var Gre=n(560169);const zre=e=>{if(qre(e))return{subNavEntity:Jre(e),headerEntity:Kre(e),startEntity:Yre(e),mainEntity:Xre(e),endEntity:Zre(e)}},qre=({entity:e,layoutMode:t})=>{const{action:n=null,type:i}={...e},a=["focus","standard"].includes(t),o=[Se.py.simplecollab,Se.py.simplecollabchats,Se.py.simplecollabchannels,Se.py.simplecollabcreateconversationfolder,Se.py.simplecollabremoveconversationfolder,Se.py.teamseeallchannels,Se.py.simplecollabrenameconversationfolder,Se.py.simplecollabswitchbackconfirmationdialog].includes(i),r=[Se.uk.create,Se.uk.default,Se.uk.info,Se.uk.list,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},Jre=({entity:e,layoutMode:t})=>{if("focus"===t)return null;const{type:n,options:i,windowOptions:a}=e;return{action:Se.uk.list,entityState:{flushableByLinkedEntity:!0},linkedEntity:null,type:n,windowOptions:a,options:i}},Qre=e=>{let t=e.type;if(t===Se.py.simplecollabchats)return Se.py.chats;if(t===Se.py.simplecollabchannels)return Se.py.channels;if(e.id){t=Se.py.chats;try{const n=JSON.parse(e.id);n?.channelId?t=Se.py.channels:n?.teamId&&(t=Se.py.teamseeallchannels)}catch{}}return t},Kre=({entity:e,contextEntity:t})=>{if(t&&t.action===Se.uk.view)switch(t.type){case Se.py.channels:case Se.py.teamseeallchannels:case Se.py.channelmanage:case Se.py.channelmembers:case Se.py.teammanage:case Se.py.teamchannels:case Se.py.extensions:return t}return{...e,type:Qre(e)}},Yre=()=>null,Xre=({entity:e,contextEntity:t})=>{let n=Se.uk.view;const{action:i=null}={...e},a=[Se.uk.view,Se.uk.default,Se.uk.create];return i&&a.includes(i)&&(n=i),t||{...e,action:n,type:Qre(e)}},Zre=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const o=t?.id||e.id,r=t?.type||e.type,s=t?.options??e.options,l=JSON.parse(s??"{}"),c=a?.infoPane?.channels?"closed"===a.infoPane.channels:!!n?.get(b.J.Channels)?.disableChannelInfoPaneOpenByDefault;if(!ise(o,r,t,n,i,c,l.source)&&!l.channelCopilotOpen)return null;const{enableChannelInfoPaneSearch:d}=n?.get(b.J.Channels)??{};if(l.source===C.D.ChannelContextualSearch)return{id:o,action:Se.uk.info,type:Se.py.channelcontextualsearch};if(t?.type===Se.py.channelcopilot||l.channelCopilotOpen)return{id:o,action:Se.uk.info,type:Se.py.channelcopilot};const{replyChainId:u}=(e=>{if(!e)return{replyChainId:void 0};try{const{replyChainId:t}=JSON.parse(e);return{replyChainId:t}}catch{return{replyChainId:void 0}}})(o??"");if(u&&(!d||t?.type!==Se.py.channelcontextualsearch))return null;if(t){const{action:e,type:n}=t;if(e===Se.uk.info&&ase(n,!!d))return t;if(n!==Se.py.channels)return null}const{channelId:m}=(0,Q1.jd)(o??"");return{id:(0,$.u4)({channelId:m}),action:Se.uk.info,type:Se.py.channels}},ese=({areEmptySlotsTransparent:e,coreSettings:t})=>({mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:e}},headerEntity:{[Mt.S.HorizontalBar]:{isBackgroundTransparent:e}},subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e}}}),tse=[Se.py.channels,Se.py.channelcopilot,Se.py.channelcontextualsearch,Se.py.channelsPinnedPost,Se.py.channelsSystemMessage],nse=["standard","focus"],ise=(e,t,n,i,a,o,r)=>{const{enableChannelInfoPaneSearch:s,enableChannelInfoPane:l=!1,enableChannelCopilotInL2Header:c=!1}=i?.get(b.J.Channels)??{},{enableInfoPaneAsResponsiveMenu:d=!1}=i?.get(b.J.Core)??{};return!!(e&&nse.includes(a)&&tse.includes(t))&&(!(!s||r!==C.D.ChannelContextualSearch&&n?.type!==Se.py.channelcontextualsearch)||(!(!c||n?.type!==Se.py.channelcopilot)||!(o||!l||!d)))},ase=(e,t)=>{switch(e){case Se.py.channelsPinnedPost:case Se.py.channelsSystemMessage:return!0;case Se.py.channelcontextualsearch:return t;default:return!1}};var ose=n(262548);const rse={id:ose.Bh,actors:[q$],name:"SimpleCollabApp",getLocalizedName:async e=>(await e.waitForNamespace("simpleCollab"),e.stringTranslate("simpleCollab","simple_collab_app_name")),supportedEntities:[Se.py.simplecollab,Se.py.simplecollabchats,Se.py.simplecollabchannels,Se.py.simplecollabcreateconversationfolder,Se.py.simplecollabremoveconversationfolder,Se.py.teamseeallchannels,Se.py.simplecollabrenameconversationfolder,Se.py.simplecollabswitchbackconfirmationdialog],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Rail,Mt.S.Modal],getDefaultCommand:()=>({type:Se.py.simplecollab,action:Se.uk.default}),windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125}};var sse=n(245831);const lse={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsSimpleCollabDefaultChatIdQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"defaultChatId"}}]}}]};var cse=n(850242);const dse=JSON.stringify({hostSettings:{enableDeeplinks:"true",focusOnLoad:ri.t.Compose}}),use=async({commandInput:e,requestContext:t})=>{const{command:{action:n,data:i}}=e,{client:a,coreSettings:o,loggerFactory:r}=t;if(e.command.actor===q$)switch(n){case J$:return async function(e,t,n){let i={type:Se.py.simplecollab,action:Se.uk.default};const a=cse.simpleCollabStore.get(cse.selectedConversationIdAtom),o=cse.simpleCollabStore.get(cse.selectedTeamIdAtom);let r={};const s={id:a,type:Se.py.simplecollab,action:Se.uk.default};if(a&&!o){const{bizChatMetaOSAppId:e}=n.get(b.J.ChatList);a===e?(i={id:JSON.stringify({appId:a,subEntityId:dse}),type:Se.py.extensions,action:Se.uk.view,linkedEntity:s},r={subEntityId:dse}):(i={action:Se.uk.view,id:a,type:Se.py.chats,linkedEntity:s},r={isViewFromSimpleCollab:!0})}else if(a){const e=JSON.stringify({channelId:a,teamId:o});i={action:Se.uk.view,id:e,type:Se.py.channels,linkedEntity:s},r={isViewFromSimpleCollab:!0},s.id=e}else{const n=await async function(e,t){let n=null;try{const{data:t}=await e.query({query:lse});n=t.defaultChatId}catch{t.newLogger("SimpleCollabApp defaultChatId","app-on-command-received").error("Failed to get defaultChatId for simple collab app")}return n}(e,t);n&&(s.id=n,r={isViewFromSimpleCollab:!0},i={action:Se.uk.view,id:n,type:Se.py.chats,linkedEntity:s})}return{entity:i,entityOptions:r,command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush,correlation:{source:C.D.Unknown}}}}(a,r,o);case Q$:return function(e){const{commandSource:t}=e,n={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:t||C.D.MainWindowHeader}},i={action:Se.uk.view,type:Se.py.simplecollabswitchbackconfirmationdialog};return{command:n,entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case K$:return function(e){const{id:t,openInPopout:n,correlationId:i,commandSource:a}=e,o={action:Se.uk.view,id:t,type:Se.py.chats};return{command:{stateTransition:n?ke.su.new:ke.su.flow,visibilityState:ke.fe.show,correlation:{id:i,source:a||C.D.SimpleCollabChatListItem,startTimestamp:Date.now()}},entity:o,entityOptions:{isViewFromSimpleCollab:!0,focusOnLoad:ri.t.Compose}}}(i);case RU:return function(e){const{id:t,openInPopout:n}=e,i={id:JSON.stringify({appId:t,subEntityId:dse}),type:Se.py.extensions,action:Se.uk.view};return{command:{stateTransition:n?ke.su.new:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabBizChatMetaOSListItem,startTimestamp:Date.now()}},entity:i,entityOptions:{subEntityId:dse,entryPoint:"SimpleCollabMetaOSEntryPoint"}}}(i);case Y$:return function(e){const{channelId:t,teamId:n,replyChainId:i,deepLinkId:a,correlationId:o,commandSource:r,back:s,stateTransition:l,linkedEntity:c}=e,d=JSON.stringify({channelId:t,teamId:n,replyChainId:i}),u={action:Se.uk.view,id:d,type:Se.py.channels,linkedEntity:c};return{command:{stateTransition:l??ke.su.flow,visibilityState:ke.fe.show,correlation:{id:o,source:r||C.D.SimpleCollabChannelListItem}},entity:u,entityOptions:{isViewFromSimpleCollab:!0,deepLinkId:a,back:!!s}}}(i);case X$:return function(e){const{channelId:t,channelName:n,teamName:i,commandSource:a}=e,o={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:a||C.D.ChannelActions}},r={id:t,action:Se.uk.view,type:Se.py.channelnotificationsettings},s={isViewFromSimpleCollab:!0,commandSource:a||C.D.ChannelActions,teamName:i,channelName:n};return{command:o,entity:r,entityOptions:s}}(i);case Z$:return function(e){const{teamId:t,channelId:n,teamName:i,channelName:a,correlationIdOverride:o,commandSource:r}=e,s={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:r||C.D.SimpleCollabChannelListItem,id:o||(0,Re.v4)()}},l={id:n,action:Se.uk.view,type:Se.py.channelworkflows},c={isViewFromSimpleCollab:!0,commandSource:r||C.D.SimpleCollabChannelListItem,teamName:i,channelName:a,teamId:t,conversationId:n};return{command:s,entity:l,entityOptions:c}}(i);case eU:return function(e){const{teamId:t,channelId:n,channelDisplayName:i,channelType:a}=e,o={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.TeamChannels}},r={action:Se.uk.view,type:Se.py.archivechannel};return{command:o,entity:r,entityOptions:{isViewFromSimpleCollab:!0,teamId:t,channelId:n,channelDisplayName:i,channelType:a}}}(i);case tU:return function(e){const{channelId:t,channelName:n,channelType:i,filesUrl:a,teamId:o,teamName:r,channelSubstrateGroupId:s,channelOnlyMember:l,isGeneral:c,isShown:d,groupId:u,teamTenantId:m}=e,p={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.TeamChannels}},g={action:Se.uk.view,type:Se.py.deletechannelreactdialog};return{command:p,entity:g,entityOptions:{isViewFromSimpleCollab:!0,channelName:n,teamName:r,channelType:i,filesUrl:a,channelId:t,teamId:o,channelSubstrateGroupId:s,channelOnlyMember:l,isGeneral:c,isShown:d,groupId:u,teamTenantId:m}}}(i);case nU:return function(e){const{teamId:t,channelId:n}=e,i={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}},a={action:Se.uk.view,type:Se.py.createchanneldialog},o={isViewFromSimpleCollab:!0,channelId:n,teamId:t,entryPoint:sse.y.TrinityLeftRail,channelType:t===n?sse.N.Default:sse.N.Regular};return{command:i,entity:a,entityOptions:o}}(i);case iU:return function(e){const{teamId:t,channelId:n,channelName:i,displayName:a,groupId:o,teamName:r,channelResourceTenantId:s,commandSource:l}=e,c={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:l||C.D.GetLinkToChannelMenuButton}},d={action:Se.uk.view,type:Se.py.getlinktoteamorchanneldialog};return{command:c,entity:d,entityOptions:{isViewFromSimpleCollab:!0,selectedChannelId:n,linkType:"Channel",teamId:t,groupId:o,displayName:a,teamName:r,channelName:i,channelResourceTenantId:s}}}(i);case oU:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:i||C.D.SimpleCollabChannelListItem}},o={id:t,action:Se.uk.view,type:Se.py.channelmanage,linkedEntity:{id:t,type:Se.py.simplecollab,action:Se.uk.list}};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:n}}}(i);case sU:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:i||C.D.SimpleCollabChannelListItem}},o={id:t,action:Se.uk.view,type:Se.py.channelmembers,linkedEntity:{id:t,type:Se.py.channels,action:Se.uk.list}};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:n}}}(i);case aU:return function(e){const{commandSource:t}=e,n={type:Se.py.stalechannelsadhocdialog,action:Se.uk.view};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:t||C.D.ChannelActions}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case rU:return function(e){const{channelId:t,teamId:n,tagId:i,commandSource:a}=e,o={stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:a||C.D.SimpleCollabChannelListItem}},r={id:t,action:Se.uk.view,type:Se.py.channeltags,linkedEntity:{id:t,type:Se.py.channels,action:Se.uk.list}};return{command:o,entity:r,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:n,tagId:i}}}(i);case lU:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:n||C.D.ChannelEmail}},a={id:t,action:Se.uk.view,type:Se.py.channelemailv2};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0,channelId:t}}}(i);case yU:return function(e){const{teamId:t,channelId:n,commandSource:i}=e,a={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i||C.D.ChannelActions}},o={id:n,action:Se.uk.view,type:Se.py.addmembertoprivatechanneldialog};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,parentTeamId:t}}}(i);case vU:return function(e){const{teamId:t,channelId:n,teamName:i,channelName:a,isLastOwner:o,groupId:r,channelOnlyMember:s,commandSource:l}=e,c=o?Se.py.leavechannellastownerdialog:Se.py.leavechanneldialog,d={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:l||C.D.ChannelLeaveContextMenuButton}},u={action:Se.uk.view,type:c};return{command:d,entity:u,entityOptions:{isViewFromSimpleCollab:!0,channelName:a,channelId:n,teamId:t,teamName:i,isLastOwner:o,groupId:r,channelOnlyMember:s}}}(i);case fU:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:n||C.D.ChannelActions}},a={id:t,action:Se.uk.view,type:Se.py.sharechannelwithuserdialog};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case SU:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i||C.D.ChannelActions}},o={id:t,action:Se.uk.view,type:Se.py.sharedchannelcreateinvitationsdialog,linkedEntity:{id:t,type:Se.py.channels,action:Se.uk.list}};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,channelId:t,teamId:n}}}(i);case kU:return function(e){const{channelId:t,teamId:n}=e,i={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}},a={id:t,action:Se.uk.view,type:Se.py.sharewithteamyouowndialog};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0,channelId:t,teamId:n}}}(i);case cU:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:Se.uk.view,type:Se.py.teammanage,linkedEntity:{id:t||"",type:Se.py.channels,action:Se.uk.list}};return{command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:n||C.D.SimpleCollabChannelListItem}},entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case MU:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:Se.uk.view,type:Se.py.teamchannels,linkedEntity:{id:t||"",type:Se.py.channels,action:Se.uk.list}};return{command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:n||C.D.ChannelActions}},entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case dU:return function(e){const{teamId:t,commandSource:n}=e,i={stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:n||C.D.SimpleCollabChannelListItem}},a={id:t,action:Se.uk.view,type:Se.py.teammanagetags};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case uU:return function(e){const{teamId:t,displayName:n,groupId:i,teamName:a,channelResourceTenantId:o}=e,r={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.GetLinkToTeamMenuButton}},s={action:Se.uk.view,type:Se.py.getlinktoteamorchanneldialog};return{command:r,entity:s,entityOptions:{isViewFromSimpleCollab:!0,selectedChannelId:t,linkType:"Team",teamId:t,groupId:i,displayName:n,teamName:a,channelResourceTenantId:o}}}(i);case mU:return function(e){const{teamId:t,groupId:n,teamName:i}=e,a={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabChannelListItem}},o={id:t,action:Se.uk.view,type:Se.py.leaveteam};return{command:a,entity:o,entityOptions:{isViewFromSimpleCollab:!0,teamName:i,groupId:n,teamThreadId:t}}}(i);case pU:return function(e){const{teamId:t}=e,n={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}},i={id:t,action:Se.uk.view,type:Se.py.addmembertoteamdialog};return{command:n,entity:i,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case gU:return function(e){const{teamId:t,groupId:n}=e,i={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.ExtensionCommanding}},a={action:Se.uk.view,type:Se.py.createchanneldialog};return{command:i,entity:a,entityOptions:{isViewFromSimpleCollab:!0,teamId:t,groupId:n,entryPoint:"TeamContextMenu"}}}(i);case hU:return function(e){const{teamId:t,teamName:n,groupId:i}=e,a={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabChannelListItem}},o={id:t,action:Se.uk.view,type:Se.py.deleteteam};return{command:a,entity:o,entityOptions:{teamName:n,groupId:i,threadId:t,isViewFromSimpleCollab:!0}}}(i);case IU:return function(e){const{id:t}=e,n={id:t,action:Se.uk.manage,type:Se.py.chatManageApps,linkedEntity:{id:t,type:Se.py.chats}};return{command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabChatListItem}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case NU:return function(e){const{id:t,isGuardianChat:n}=e,i={id:t,action:Se.uk.delete,type:Se.py.leavechat};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabChatListItem}},entity:i,entityOptions:{isViewFromSimpleCollab:!0,convId:t,isGuardianChat:n}}}(i);case EU:return function(e){const{id:t,title:n,isGroupChat:i,isOneOnOneChat:a}=e,o={id:t,action:Se.uk.delete,type:Se.py.deletechat};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabChatListItem}},entity:o,entityOptions:{isViewFromSimpleCollab:!0,title:n,isGroupChat:i,isOneOnOneChat:a,convId:t}}}(i);case bU:return function(e){const{conversationId:t}=e,n={action:Se.uk.view,type:Se.py.simplecollabcreateconversationfolder};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabConversationFolder}},entity:n,entityOptions:{isViewFromSimpleCollab:!0,conversationId:t}}}(i);case wU:return function(e){const{conversationFolderName:t,folderId:n,conversationFoldersConnectionId:i,commandSource:a,folderType:o,isLegacyFavoritesFolder:r,hasConversations:s}=e,l={action:Se.uk.view,type:Se.py.simplecollabremoveconversationfolder};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:a||C.D.SimpleCollabConversationFolder}},entity:l,entityOptions:{isViewFromSimpleCollab:!0,conversationFolderName:t,folderId:n,conversationFoldersConnectionId:i,folderType:o,isLegacyFavoritesFolder:r,hasConversations:s}}}(i);case TU:return function(e){const{conversationFolderName:t,folderId:n,folderType:i,isLegacyFavoritesFolder:a}=e,o={action:Se.uk.view,type:Se.py.simplecollabrenameconversationfolder};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.SimpleCollabConversationFolder}},entity:o,entityOptions:{isViewFromSimpleCollab:!0,conversationFolderName:t,folderId:n,folderType:i,isLegacyFavoritesFolder:a}}}(i);case CU:return function(){const e={type:Se.py.discoversurface,action:Se.uk.view};return{command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:C.D.DiscoverSurfaceEntry}},entity:e,entityOptions:{isViewFromSimpleCollab:!0}}}();case AU:return function(e){const{teamId:t,commandSource:n,hideSlotHeader:i}=e,a={stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:n||C.D.UserOnboardingTeam}},o={id:t,action:Se.uk.view,type:Se.py.teamseeallchannels,linkedEntity:{id:t,action:Se.uk.view,type:Se.py.teamseeallchannels}};return{command:a,entity:o,entityOptions:{hideSlotHeader:i,isViewFromSimpleCollab:!0}}}(i);case _U:return function(e){const{commandSource:t}=e,n={type:Se.py.teamsgallery,action:Se.uk.view};return{command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:t||C.D.TeamsGallery}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case FU:return function(e){const{commandSource:t}=e,n={type:Se.py.createchannelleftraildialog,action:Se.uk.view};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:t||C.D.ExtensionCommanding}},entity:n,entityOptions:{isViewFromSimpleCollab:!0,entryPoint:"ChannelListHeaderContextMenu"}}}(i);case DU:return function(e){const{commandSource:t}=e,n={type:Se.py.teamcreatedialog,action:Se.uk.view};return{command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:t||C.D.ExtensionCommanding}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case PU:return function(e){const{commandSource:t}=e,n={type:Se.py.teamslist,action:Se.uk.view};return{command:{stateTransition:ke.su.flow,visibilityState:ke.fe.show,correlation:{source:t||C.D.SimpleCollabChannelListItem}},entity:n,entityOptions:{isViewFromSimpleCollab:!0}}}(i);case LU:return function(e){const{commandSource:t,canUserCreateTeam:n}=e,i={id:sa.IC.template,type:Se.py.teams,action:Se.uk.create};return{command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:t||C.D.SimpleCollabChannelListItem}},entity:i,entityOptions:{isViewFromSimpleCollab:!0,canUserCreateTeam:n}}}(i);default:return}};const mse={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsSimpleCollabSimpleCollabSettingsSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userPreferencesChangedEventForSimpleCollab"},arguments:[{kind:"Argument",name:{kind:"Name",value:"category"},value:{kind:"EnumValue",value:"simpleCollabUserSettings"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"simpleCollabUserSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledAdaptiveRailForDesktop"}},{kind:"Field",name:{kind:"Name",value:"hasUserEnabledUnifiedAppForDesktop"}}]}}]}}]}}]},pse=({context:{client:e}})=>[{id:"app-simple-collab-user-preference-subscription",runOncePerId:!0,job:async()=>{const t=e.subscribe({query:mse}).subscribe();return()=>{t?.unsubscribe()}}}];var gse=n(293929);function hse(e,t){const{commitLocalUpdate:i,ConnectionHandler:a}=n(704012);i(e,(e=>{const n=e.get(t),i=e.getRoot()?.getLinkedRecord("conversationFolders",{filter:{tags:["SHOWN_AND_HOISTED"]}})?.getLinkedRecords("edges")?.find((e=>"HIDDEN_CHANNELS"===e.getLinkedRecord("node").getValue("folderType")))?.getLinkedRecord("node");if(n&&i){const o=a.getConnection(i,"SimpleCollabLeftRailConversationFolder_conversations",{filter:{tags:["SHOWN_AND_HOISTED"]}});if(o){const i=o.getLinkedRecords("edges")[0]?.getLinkedRecord("node");if(i?.getDataID()===t)return;const r=a.createEdge(e,o,n,"OneGQL_ConversationsEdge");o.setLinkedRecords([r],"edges")}}}))}function yse(e){const{commitLocalUpdate:t,ConnectionHandler:i}=n(704012);t(e,(e=>{const t=e.getRoot()?.getLinkedRecord("conversationFolders",{filter:{tags:["SHOWN_AND_HOISTED"]}})?.getLinkedRecords("edges")?.find((e=>"HIDDEN_CHANNELS"===e.getLinkedRecord("node").getValue("folderType")))?.getLinkedRecord("node");if(t){const e=i.getConnection(t,"SimpleCollabLeftRailConversationFolder_conversations",{filter:{tags:["SHOWN_AND_HOISTED"]}});e&&e.getLinkedRecords("edges").length&&e.setLinkedRecords([],"edges")}}))}const vse=()=>({appName:"simpleCollab",appId:LW}),fse={panelRegion:dA.Ai.main,panelType:dA.wh.ChatList},Sse=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("SimpleCollabChatContextMenuEvent","simple-collab-context-menu");switch(a){case gse._H.chatManageApps:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`chatManageApps: chatId: ${e.id}`,"simple_collab_chat_context_menu_chat_manage_apps"),((e,t,n,i)=>{const a=n?.();t({...vse(),moduleName:dA.rA.chatActions,moduleType:dA.PO.button,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.chatListManageAppsChatMoreMenuOptions,actionScenarioType:dA.Yu.chatListManageApps,tabOrdinal:1,threadId:i,...fse,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:pB(e)})}case gse._H.leaveChat:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChat: chatId: ${e.id}, isGuardianChat: ${e.isGuardianChat}`,"simple_collab_chat_context_menu_leave_chat"),((e,t,n,i)=>{const a=n?.();t({...vse(),moduleName:dA.rA.chatActions,moduleType:dA.PO.button,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.chatListLeaveChat,actionScenarioType:dA.Yu.chatListLeaveChat,tabOrdinal:1,threadId:i,...fse,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:gB(e)})}case gse._H.deleteChat:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`deleteChat: chatId: ${e.id}, title: ${e.title}, isGroupChat: ${e.isGroupChat}, isOneOnOneChat: ${e.isOneOnOneChat}`,"simple_collab_chat_context_menu_delete_chat"),((e,t,n,i)=>{const a=n?.();t({...vse(),moduleName:dA.rA.chatActions,moduleType:dA.PO.button,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.chatListDeleteChat,actionScenarioType:dA.Yu.chatListDeleteChat,tabOrdinal:1,threadId:i,...fse,dataBag:a},e),a?.dispose()})(s,o,r,e.id),Promise.resolve({command:hB(e)})}default:return}},kse={actionGesture:dA.uS.click,actionOutcome:dA.$K.select,actionOutcomeNew:dA.$K.nav},Cse={panelRegion:dA.Ai.left,panelRegionNew:dA.Ai.left,panelType:dA.wh.teamChannelList,panelTypeNew:dA.wh.teamChannelList,panelUri:"app.conversation"},bse={actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenario:dA.Tk.channelAction,actionScenarioType:dA.Yu.manageChannel,actionSubworkload:dA.eD.channelManagement,actionWorkload:dA.sz.teamChannelManagement};var wse;!function(e){e.Regular="Regular",e.Private="Private",e.Shared="Shared",e.Standalone="Standalone"}(wse||(wse={}));const Tse=(e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.addMembers,i.channelType="Shared"),t({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.submit,actionScenario:dA.Tk.chnlSetSaved,actionScenarioType:dA.Yu.chnlSet,actionSubworkload:dA.eD.channelNotification,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.popoverMenuService_channelOverflowMenu_click_chnlSetSaved,moduleName:dA.rA.popoverMenuService,moduleNameNew:dA.rA.popoverMenuService,moduleType:dA.PO.channelOverflowMenu,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:i},e),i?.dispose()},Ise=(e,t,n,i)=>{const a=n?.();a&&(a.isChannelsV2=!0,a.channelAction=BP.zP.deleteChannel,a.channelType=(e=>{switch(e){case wse.Regular:case wse.Private:case wse.Shared:case wse.Standalone:return e;default:return wse.Regular}})(i)),t({...vse(),...bse,actionSubworkload:dA.eD.deleteChannel,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleNameNew:dA.rA.deleteChannel,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:a},e),a?.dispose()},Nse=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("SimpleCollabChannelContextMenuEvent","simple-collab-context-menu");switch(a){case gse._H.channelNotificationSettings:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelNotificationSettings: channelId: ${e.channelId}`,"simple_collab_channel_context_menu_channel_notification"),Promise.resolve({command:HU(e)})}case gse._H.channelWorkflows:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelWorkflows: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_channel_workflow"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.editChannelWorkflows),t({...vse(),...bse,actionScenario:dA.Tk.channelWorkflowsDialog,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleNameNew:dA.rA.workflows,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:VU(e)})}case gse._H.editChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`editChannel: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_edit_channel"),Promise.resolve({command:qU(e)})}case gse._H.archiveChannel:{const e="function"==typeof i?i():{};return Promise.resolve({command:GU(e)})}case gse._H.toastMessageChannelEvent:return Fse({data:i});case gse._H.deleteChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`deleteChannel: channelId: ${e.channelId}, channelType: ${e.channelType}, filesUrl: ${e.filesUrl}, teamId: ${e.teamId}, channelSubstrateGroupId: ${e.channelSubstrateGroupId}, channelOnlyMember: ${e.channelOnlyMember}, isGeneral: ${e.isGeneral}, isShown: ${e.isShown}, groupId: ${e.groupId}, teamTenantId: ${e.teamTenantId}`,"simple_collab_channel_context_menu_delete_channel"),Ise(s,o,r,e.channelType),Promise.resolve({command:zU(e)})}case gse._H.getLinkToChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`getLinkToChannel: channelId: ${e.channelId}, groupId: ${e.groupId}, teamId: ${e.teamId}, channelResourceTenantId: ${e.channelResourceTenantId}`,"simple_collab_channel_context_menu_get_link_to_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.getChannelLink),t({...vse(),...bse,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleNameNew:dA.rA.getChannelLink,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:JU(e)})}case gse._H.manageChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannel: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_manage_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.manageChannel),t({...vse(),...bse,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleNameNew:dA.rA.manageChannelMenuItem,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(s,o,r),cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),Promise.resolve({command:KU(e)})}case gse._H.manageChannelTags:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannelTags: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_manage_channel_tags"),Promise.resolve({command:XU(e)})}case gse._H.viewChannelEmail:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`viewChannelEmail: channelId: ${e.channelId}`,"simple_collab_channel_context_menu_view_channel_email"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.getChannelEmail),t({...vse(),...bse,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleNameNew:dA.rA.getChannelEmailAddress,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:ZU(e)})}case gse._H.channelAddMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelAddMembers: channelId: ${e.channelId}, teamId: ${e.teamId}`,"simple_collab_channel_context_menu_add_members"),Promise.resolve({command:eB(e)})}case gse._H.leaveChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, isLastOwner: ${e.isLastOwner}, groupId: ${e.groupId}, channelOnlyMember: ${e.channelOnlyMember}`,"simple_collab_channel_context_menu_leave_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.leaveChannel),t({...vse(),...bse,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleNameNew:dA.rA.leaveChannel,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:tB(e)})}case gse._H.shareChannelWithUser:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithUser: channelId: ${e.channelId}`,"simple_collab_channel_context_menu_share_channel_with_user"),Tse(s,o,r),Promise.resolve({command:nB(e)})}case gse._H.shareChannelWithTeam:return Ese({data:i,logger:s,recordPanelAction:o,createDatabag:r});case gse._H.shareChannelWithTeamYouOwn:return Ase({data:i,logger:s,recordPanelAction:o,createDatabag:r});case gse._H.showHideChannel:return void((e,t,n,i)=>{const a=n?.();a&&(a.isChannelsV2=!0,a.channelAction=i?.lastChannelHide?BP.zP.lastChannelHide:BP.zP.favoriteChannel,a.channelState=i?.isShown?BP.Dz.shown:BP.Dz.hidden,a.isGeneralChannel=i?.isGeneral?BP.UE.General:BP.UE.NotGeneral),t({...vse(),...bse,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:a},e),a?.dispose()})(s,o,r,"function"==typeof i?i():{});case gse._H.manageTeamChannels:return _se({data:i,logger:s,recordPanelAction:o,createDatabag:r});case gse._H.channelContextMenuClick:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...bse,actionScenario:dA.Tk.channelOpenMenu,actionScenarioType:dA.Yu.admin,actionSubworkload:dA.eD.teamManagement,actionWorkload:dA.sz.teamChannelManagement,moduleName:dA.rA.menuButton,moduleNameNew:dA.rA.teamOverflowMenu,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(s,o,r);default:return}},Ese=({data:e,logger:t,recordPanelAction:n,createDatabag:i})=>{const a="function"==typeof e?e():{};return t.infoToTelemetry?.(`shareChannelWithTeam: channelId: ${a.channelId}, teamId: ${a.teamId}`,"simple_collab_channel_context_menu_share_channel_with_team"),Tse(t,n,i),Promise.resolve({command:iB(a)})},Ase=({data:e,logger:t,recordPanelAction:n,createDatabag:i})=>{const a="function"==typeof e?e():{};return t.infoToTelemetry?.(`shareChannelWithTeamYouOwn: channelId: ${a.channelId}, teamId: ${a.teamId}`,"simple_collab_channel_context_menu_share_channel_with_team_you_own"),Tse(t,n,i),Promise.resolve({command:aB(a)})},_se=({data:e,logger:t,recordPanelAction:n,createDatabag:i})=>{const a="function"==typeof e?e():{};return t.infoToTelemetry?.(`manageTeamChannels: channelId: ${a.channelId}, teamId: ${a.teamId}`,"simple_collab_channel_context_menu_manage_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.manageTeam),t({...vse(),...bse,eventIdentifier:dA.b6.channelActionMenu_menuItem_click_channelAction,moduleName:dA.rA.channelActionMenu,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.channelOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(t,n,i),cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:a.channelId,teamId:a.teamId})),Promise.resolve({command:rB(a)})},Fse=({data:e})=>{const t="function"==typeof e?e():{},n=t.success?"Success":"Error",i=t.title;return Promise.resolve({command:Y0({intent:n,title:i,dismissOnAction:!0})})},Dse=async(e,t,n,i)=>{const{data:a,type:o}=e,r=t.newLogger("SimpleCollabTeamContextMenuEvent","simple-collab-context-menu"),{recordPanelAction:s,createDatabag:l}=n;switch(o){case gse._H.manageTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`manageTeam: teamId: ${e.teamId}`,"simple_collab_team_context_menu_manage_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.teamNav,actionScenarioType:dA.Yu.openteam,actionSubworkload:dA.eD.teamManagement,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.listItem_menuItem_click_teamNav,moduleName:dA.rA.listItem,moduleNameNew:dA.rA.manageTeamMenuItem,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:oB(e)})}case gse._H.manageTags:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`manageTags: teamId: ${e.teamId}`,"simple_collab_team_context_menu_manage_tags"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.openManageTagsDialog,actionScenarioType:dA.Yu.openDialog,actionSubworkload:dA.eD.tagManagement,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.button_click_openManageTagsDialog,moduleNameNew:dA.rA.manageTeamTags,moduleType:dA.PO.button,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:sB(e)})}case gse._H.getLinkToTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`getLinkToTeam: teamId: ${e.teamId}, groupId: ${e.groupId}`,"simple_collab_team_context_menu_get_link_to_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.getTeamDeeplink,actionScenarioType:dA.Yu.openDialog,actionSubworkload:dA.eD.teamManagement,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.listItem_menuItem_click_getTeamDeeplink,moduleName:dA.rA.listItem,moduleNameNew:dA.rA.getTeamLinkMenuItem,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:lB(e)})}case gse._H.leaveTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`getLinkToTeam: teamId: ${e.teamId}, groupId: ${e.groupId}`,"simple_collab_team_context_menu_leave_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.leaveTeam,actionScenarioType:dA.Yu.admin,actionSubworkload:dA.eD.leaveTeam,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.listItem_menuItem_click_leaveTeam,moduleName:dA.rA.listItem,moduleNameNew:dA.rA.leaveTeamMenuItem,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:cB(e)})}case gse._H.teamAddMember:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`teamAddMember: teamId: ${e.teamId}`,"simple_collab_team_context_menu_team_add_member"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.addMember,actionScenarioType:dA.Yu.openDialog,actionSubworkload:dA.eD.addMember,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.addMember_menuItem_click_addMember,moduleName:dA.rA.addMember,moduleNameNew:dA.rA.addMemberMenuItem,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:dB(e)})}case gse._H.teamAddChannel:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`teamAddChannel: teamId: ${e.teamId}`,"simple_collab_team_context_menu_team_add_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.addChannel,actionScenarioType:dA.Yu.openDialog,actionSubworkload:dA.eD.addChannel,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.addChannel_teamActionMenu_click_addChannel,moduleName:dA.rA.addChannel,moduleNameNew:dA.rA.addChannelMenuItem,moduleType:dA.PO.teamActionMenu,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:uB(e)})}case gse._H.deleteTeam:{const e="function"==typeof a?a():{};return r.infoToTelemetry?.(`deleteTeam: teamId: ${e.teamId}, groupId: ${e.groupId}`,"simple_collab_team_context_menu_delete_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.deleteTeam,actionScenarioType:dA.Yu.openDialog,actionSubworkload:dA.eD.teamManagement,actionWorkload:dA.sz.teamChannelManagement,eventIdentifier:dA.b6.manageTagsDialog_teamActionMenu_click_deleteTeam,moduleName:dA.rA.manageTagsDialog,moduleNameNew:dA.rA.deleteTeamMenuItem,moduleType:dA.PO.teamActionMenu,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l),Promise.resolve({command:mB(e)})}case gse._H.forceHideTeam:{const e="function"==typeof a?a():{},{teamName:t}=e;return Promise.resolve({command:Y0({intent:"Success",title:i.stringTranslate("teamsAndChannels","hide_team_toast_details",{teamName:t}),dismissOnAction:!0})})}case gse._H.teamContextMenuClick:return void((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...kse,actionScenario:dA.Tk.teamOpenMenu,actionScenarioType:dA.Yu.admin,actionSubworkload:dA.eD.teamManagement,actionWorkload:dA.sz.teamChannelManagement,moduleName:dA.rA.menuButton,moduleNameNew:dA.rA.teamOverflowMenu,moduleType:dA.PO.menuItem,moduleTypeNew:dA.PO.teamListOverflowMenu,...Cse,dataBag:i},e),i?.dispose()})(r,s,l);default:return}},Pse={actionGesture:dA.uS.click,actionOutcome:dA.$K.nav},Mse={panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList},xse={actionGesture:dA.uS.click,actionOutcome:dA.$K.openChatListFilter},Rse=async(e,t,n)=>{const{data:i,type:a}=e,o=t.newLogger("SimpleCollabLeftRailHeaderContextMenuEvent","simple-collab-left-rail-header-context-menu"),{recordPanelAction:r,createDatabag:s}=n;switch(a){case gse._H.joinTeam:{o.infoToTelemetry?.("Join Team","simple_collab_left_rail_header_context_menu_join_team");const e="function"==typeof i?i():{};return Promise.resolve({command:CB(e)})}case gse._H.createChannel:{o.infoToTelemetry?.("Create Channel","simple_collab_left_rail_header_context_menu_create_channel");const e="function"==typeof i?i():{};return Promise.resolve({command:bB(e)})}case gse._H.createTeam:{o.infoToTelemetry?.("Create Team","simple_collab_left_rail_header_context_menu_create_team");const e="function"==typeof i?i():{};return Promise.resolve({command:wB(e)})}case gse._H.manageTeams:{o.infoToTelemetry?.("Manage Teams","simple_collab_left_rail_header_context_menu_manage_teams");const e="function"==typeof i?i():{};return Promise.resolve({command:TB(e)})}case gse._H.leftRailHeaderPlusMenuOpen:{o.infoToTelemetry?.("Header plus menu","simple_collab_left_rail_header_plus_menu");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...Pse,...vse(),...Mse,actionScenario:dA.Tk.openSimpleCollabListMoreMenu,actionScenarioType:dA.Yu.headerNavSimpleCollab,moduleType:dA.PO.button,moduleName:dA.rA.listMoreMenuHeader,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:IB(e)})}case gse._H.openFilterLeftRail:{o.infoToTelemetry?.("Filter menu","simple_collab_open_filter_left_rail_menu");const e="function"==typeof i?i():{};return((e,t,n)=>{const i=n?.();t({...xse,...vse(),...Mse,actionScenario:dA.Tk.openChatListFilter,actionScenarioType:dA.Yu.headerNavSimpleCollab,moduleType:dA.PO.button,moduleName:dA.rA.chatList,entityType:Se.py.chats,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:NB(e)})}case gse._H.openManageTeams:return o.infoToTelemetry?.("Header more menu","simple_collab_left_rail_header_more_menu"),((e,t,n)=>{const i=n?.();t({...Pse,...vse(),...Mse,actionScenario:dA.Tk.teamsMoreButtonClick,actionScenarioType:dA.Yu.headerNavSimpleCollab,moduleType:dA.PO.button,moduleName:dA.rA.teamsNavigateBarMoreButton,entityType:Se.py.channels,dataBag:i},e),i?.dispose()})(o,r,s),Promise.resolve({command:EB()});case gse._H.createTeamOnMainView:{const e="function"==typeof i?i():{};return Promise.resolve({command:AB(e)})}default:return}},jse={actionGesture:dA.uS.click,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList},Lse=async(e,t,n,i,a)=>{const{data:o,type:r}=e,s=t.newLogger("SimpleCollabFolderActionCompletionEvents","folder-action-completion"),{createDatabag:l,recordPanelAction:c}=i;switch(r){case gse.xs.staleChannelsAdhocDialog:const e="function"==typeof o?o():{};return(({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r="recentChannels"===i.folderType?"recentChannels":"teamsAndChannels",s=a?.();s&&(s.sectionType=r),o({...vse(),...jse,actionOutcome:dA.$K.openDialog,actionScenario:dA.Tk.inactiveTeamsAndChannelsCleanUpProcess,actionScenarioType:dA.Yu.inactiveTeamsAndChannelsContextMenuUserAction,moduleName:dA.rA.inactiveTeamsAndChannelsContextMenuUserAction,dataBag:s},t),s?.dispose()})({data:o,logger:s,userBiService:i}),Promise.resolve({command:QU(e)});case gse.xs.createConversationFolderCancelAction:return Ose({logger:s,recordPanelAction:c});case gse.xs.createConversationFolderConfirmAction:return $se({logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.createConversationFolderSucceeded:return Use({i18n:n,logger:s,scenarioFactory:a});case gse.xs.createConversationFolderFailed:return Bse({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.renameConversationFolderCancelAction:return Wse({createDatabag:l,data:o,logger:s,recordPanelAction:c});case gse.xs.renameConversationFolderConfirmAction:return Hse({createDatabag:l,data:o,logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.renameConversationFolderSucceeded:return Vse({i18n:n,logger:s,scenarioFactory:a});case gse.xs.renameConversationFolderFailed:return Gse({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.removeConversationFolderCancelAction:return zse({createDatabag:l,data:o,logger:s,recordPanelAction:c});case gse.xs.removeConversationFolderConfirmAction:return qse({createDatabag:l,data:o,logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.removeConversationFolderSucceeded:return Jse({i18n:n,logger:s,scenarioFactory:a});case gse.xs.removeConversationFolderFailed:return Qse({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.removeFromFolderAction:return Kse({createDatabag:l,data:o,logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.removeFromFolderSucceeded:return Yse({logger:s,i18n:n,scenarioFactory:a});case gse.xs.removeFromFolderFailed:return Xse({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.moveConversationToFolderAction:return Zse({createDatabag:l,data:o,logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.moveConversationToFolderSucceeded:return ele({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.moveConversationToFolderFailed:return tle({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.setConversationFolderExpandedStateAction:return nle({createDatabag:l,data:o,logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.setConversationFolderExpandedStateSucceeded:return ile({logger:s,scenarioFactory:a});case gse.xs.setConversationFolderExpandedStateFailed:return ale({data:o,logger:s,scenarioFactory:a});case gse.xs.reorderConversationFoldersAction:return ole({logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.reorderConversationFoldersSucceeded:return rle({logger:s,scenarioFactory:a});case gse.xs.reorderConversationFoldersFailed:return sle({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.reorderConversationFolderItemsAction:return lle({createDatabag:l,data:o,logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.reorderConversationFolderItemsSucceeded:return cle({logger:s,scenarioFactory:a});case gse.xs.reorderConversationFolderItemsFailed:return dle({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.dndItemToConversationFolderAction:return ule({createDatabag:l,data:o,logger:s,recordPanelAction:c,scenarioFactory:a});case gse.xs.dndItemToConversationFolderSucceeded:return mle({logger:s,scenarioFactory:a});case gse.xs.dndItemToConversationFolderFailed:return ple({data:o,i18n:n,logger:s,scenarioFactory:a});case gse.xs.setChannelsViewType:return gle({createDatabag:l,data:o,logger:s,recordPanelAction:c});default:return}},Ose=({logger:e,recordPanelAction:t})=>{t({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.cancel,actionScenario:dA.Tk.createCustomSectionCancelButton,actionScenarioType:dA.Yu.createCustomSection,moduleName:dA.rA.createCustomSectionCancelButton,moduleType:dA.PO.cancelButton,panelRegion:dA.Ai.modal,panelType:dA.wh.createCustomSectionDialog},e)},$se=({logger:e,recordPanelAction:t,scenarioFactory:n})=>{n.newScenario(H.RG.SimpleCollabCreateConversationFolder),t({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.createCustomSectionConfirmButton,actionScenarioType:dA.Yu.createCustomSection,moduleName:dA.rA.createCustomSectionConfirmButton,moduleType:dA.PO.confirmButton,panelRegion:dA.Ai.modal,panelType:dA.wh.createCustomSectionDialog},e)},Use=({i18n:e,logger:t,scenarioFactory:n})=>(t.infoToTelemetry?.("Create conversation folder succeeded.","simple_collab_create_conversation_folder",void 0,!0),n.stopScenarioIfActive(H.RG.SimpleCollabCreateConversationFolder),Promise.resolve({command:Y0({intent:"Success",title:e.stringTranslate("simpleCollab","simple_collab_toast_create_folder_success"),dismissOnAction:!0})})),Bse=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};return n.errorToTelemetry?.(`Create conversation folder failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_create_conversation_folder",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabCreateConversationFolder,{errorCode:a.errorCode},"failure"),Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("simpleCollab","simple_collab_toast_create_folder_failed"),dismissOnAction:!0})})},Wse=({createDatabag:e,data:t,logger:n,recordPanelAction:i})=>{const a=("function"==typeof t?t():{}).isLegacyFavoritesFolder?"favorites":"customSection",o=e?.();o&&(o.sectionType=a),i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.cancel,actionScenario:dA.Tk.renameCustomSectionCancelButton,actionScenarioType:dA.Yu.renameCustomSection,moduleName:dA.rA.renameCustomSectionCancelButton,moduleType:dA.PO.cancelButton,panelRegion:dA.Ai.modal,panelType:dA.wh.renameCustomSectionDialog,dataBag:o},n),o?.dispose()},Hse=({createDatabag:e,data:t,logger:n,recordPanelAction:i,scenarioFactory:a})=>{const o="function"==typeof t?t():{};a.newScenario(H.RG.SimpleCollabRenameConversationFolder);const r=o.isLegacyFavoritesFolder?"favorites":"customSection",s=e?.();s&&(s.sectionType=r),i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.renameCustomSectionSaveButton,actionScenarioType:dA.Yu.renameCustomSection,moduleName:dA.rA.renameCustomSectionSaveButton,moduleType:dA.PO.saveButton,panelRegion:dA.Ai.modal,panelType:dA.wh.renameCustomSectionDialog,dataBag:s},n),s?.dispose()},Vse=({i18n:e,logger:t,scenarioFactory:n})=>(t.infoToTelemetry?.("Rename conversation folder succeeded.","simple_collab_rename_conversation_folder",void 0,!0),n.stopScenarioIfActive(H.RG.SimpleCollabRenameConversationFolder),Promise.resolve({command:Y0({intent:"Success",title:e.stringTranslate("simpleCollab","simple_collab_toast_rename_folder_success"),dismissOnAction:!0})})),Gse=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};n.errorToTelemetry?.(`Rename conversation folder failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_rename_conversation_folder",void 0,!0);const{errorCode:o,folderName:r}=a;return i.stopScenarioIfActive(H.RG.SimpleCollabRenameConversationFolder,{errorCode:o},"failure"),Promise.resolve({command:Y0({intent:"Error",title:o===h.jK.DuplicateFolderNamesNotAllowed?t.stringTranslate("simpleCollab","simple_collab_toast_rename_folder_failed_duplicate_name",{folderName:r}):t.stringTranslate("simpleCollab","simple_collab_toast_rename_folder_failed"),dismissOnAction:!0})})},zse=({createDatabag:e,data:t,logger:n,recordPanelAction:i})=>{const a=("function"==typeof t?t():{}).isLegacyFavoritesFolder?"favorites":"customSection",o=e?.();o&&(o.sectionType=a),i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.cancel,actionScenario:dA.Tk.removeCustomSectionCancelButton,actionScenarioType:dA.Yu.removeCustomSection,moduleName:dA.rA.removeCustomSectionCancelButton,moduleType:dA.PO.cancelButton,panelRegion:dA.Ai.dialog,panelType:dA.wh.removeCustomSectionDialog,dataBag:o},n),o?.dispose()},qse=({createDatabag:e,data:t,logger:n,recordPanelAction:i,scenarioFactory:a})=>{const o="function"==typeof t?t():{};a.newScenario(H.RG.SimpleCollabRemoveConversationFolder);const r=o.isLegacyFavoritesFolder?"favorites":"customSection",s=e?.();s&&(s.sectionType=r),i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.confirm,actionScenario:dA.Tk.removeCustomSectionRemoveButton,actionScenarioType:dA.Yu.removeCustomSection,moduleName:dA.rA.removeCustomSectionRemoveButton,moduleType:dA.PO.confirmDeleteButton,panelRegion:dA.Ai.dialog,panelType:dA.wh.removeCustomSectionDialog,dataBag:s},n),s?.dispose()},Jse=({i18n:e,logger:t,scenarioFactory:n})=>(t.infoToTelemetry?.("Remove conversation folder succeeded.","simple_collab_remove_conversation_folder",void 0,!0),n.stopScenarioIfActive(H.RG.SimpleCollabRemoveConversationFolder),Promise.resolve({command:Y0({intent:"Success",title:e.stringTranslate("simpleCollab","simple_collab_toast_remove_folder_success"),dismissOnAction:!0})})),Qse=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};return n.errorToTelemetry?.(`Remove conversation folder failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_remove_conversation_folder",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabRemoveConversationFolder,{errorCode:a.errorCode},"failure"),Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("simpleCollab","simple_collab_toast_remove_folder_failed"),dismissOnAction:!0})})},Kse=({createDatabag:e,data:t,logger:n,recordPanelAction:i,scenarioFactory:a})=>{const o="function"==typeof t?t():{},{isLegacyFavoritesFolder:r}=o;a.newScenario(H.RG.SimpleCollabRemoveFromConversationFolder);const s=r?"favorites":"customSection",l=e?.();l&&(l.sectionType=s),i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.remove,actionScenario:dA.Tk.removeFromCustomSectionButton,actionScenarioType:dA.Yu.removeFromCustomSection,moduleName:dA.rA.removeFromCustomSectionButton,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList,dataBag:l},n),l?.dispose()},Yse=({i18n:e,logger:t,scenarioFactory:n})=>(t.infoToTelemetry?.("Remove conversation from folder succeeded.","simple_collab_remove_from_folder",void 0,!0),n.stopScenarioIfActive(H.RG.SimpleCollabRemoveFromConversationFolder),Promise.resolve({command:Y0({intent:"Success",title:e.stringTranslate("simpleCollab","simple_collab_toast_remove_conv_from_folder_success"),dismissOnAction:!0})})),Xse=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};return n.errorToTelemetry?.(`Remove from folder failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_remove_from_folder",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabRemoveFromConversationFolder,{errorCode:a.errorCode},"failure"),Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("simpleCollab","simple_collab_toast_remove_conv_from_folder_failed"),dismissOnAction:!0})})},Zse=({createDatabag:e,data:t,logger:n,recordPanelAction:i,scenarioFactory:a})=>{const o="function"==typeof t?t():{},{isLoadedFromTeamsHierarchy:r,fromFolderType:s,toFolderType:l,isFromLegacyFavoritesFolder:c,isToLegacyFavoritesFolder:d,itemType:u}=o,m=r?"teamsAndChannels":hle(s,c),p=hle(l,d),g=e?.();g&&(g.sectionType=m,g.targetSectionType=p,g.itemType=u),a.newScenario(H.RG.SimpleCollabMoveItemToConversationFolder),i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.move,actionScenario:dA.Tk.moveItemToCustomSectionButton,actionScenarioType:dA.Yu.moveItemToCustomSection,moduleName:dA.rA.moveItemToCustomSectionButton,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList,dataBag:g},n),g?.dispose()},ele=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};n.infoToTelemetry?.("Move conversation to folder succeeded.","simple_collab_move_conversation_to_folder",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabMoveItemToConversationFolder);const{isChannel:o,isLoadedFromTeamsHierarchy:r,toFolderName:s}=a,l=r?"simple_collab_toast_show_in_folder_success":o?"simple_collab_toast_move_channel_to_folder_success":"simple_collab_toast_move_chat_to_folder_success";return Promise.resolve({command:Y0({intent:"Success",title:t.stringTranslate("simpleCollab",l,{folderName:s}),dismissOnAction:!0})})},tle=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};n.errorToTelemetry?.(`Move conversation to folder failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_move_conversation_to_folder",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabMoveItemToConversationFolder,{errorCode:a.errorCode},"failure");const{isChannel:o,isLoadedFromTeamsHierarchy:r,toFolderName:s}=a,l=r?"simple_collab_toast_show_in_folder_failed":o?"simple_collab_toast_move_channel_to_folder_failed":"simple_collab_toast_move_chat_to_folder_failed";return Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("simpleCollab",l,{folderName:s}),dismissOnAction:!0})})},nle=({createDatabag:e,data:t,logger:n,recordPanelAction:i,scenarioFactory:a})=>{const o="function"==typeof t?t():{},{isExpanded:r,isLegacyFavoritesFolder:s,folderType:l}=o;a.newScenario(H.RG.SimpleCollabSetConversationFolderExpandedState);const c=hle(l,s),d=e?.();d&&(d.sectionType=c),i({...vse(),actionGesture:dA.uS.click,actionOutcome:r?dA.$K.expanded:dA.$K.collapsed,actionScenario:dA.Tk.setSectionExpandedState,actionScenarioType:dA.Yu.setSectionExpandedState,moduleName:dA.rA.sectionTreeItem,moduleType:dA.PO.chevron,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList,dataBag:d},n),d?.dispose()},ile=({logger:e,scenarioFactory:t})=>{e.infoToTelemetry?.("Set conversation folder expanded state succeeded.","simple_collab_set_conversation_expanded_state",void 0,!0),t.stopScenarioIfActive(H.RG.SimpleCollabSetConversationFolderExpandedState)},ale=({data:e,logger:t,scenarioFactory:n})=>{const i="function"==typeof e?e():{};i.errorCode!==h.jK.FeatureNotSupported?(t.errorToTelemetry?.(`Set conversation folder expanded state failed. errorCode: ${i.errorCode}, errorDetail: ${i.errorDetail}`,"simple_collab_set_conversation_expanded_state",void 0,!0),n.stopScenarioIfActive(H.RG.SimpleCollabSetConversationFolderExpandedState,{errorCode:i.errorCode},"failure")):n.stopScenarioIfActive(H.RG.SimpleCollabSetConversationFolderExpandedState,{reason:"Known unsupported action"},"abandoned")},ole=({logger:e,recordPanelAction:t,scenarioFactory:n})=>{n.newScenario(H.RG.SimpleCollabReorderConversationFolders),t({...vse(),actionGesture:dA.uS.dragAndDrop,actionOutcome:dA.$K.reorder,actionScenario:dA.Tk.dragAndDropReorderCustomSections,actionScenarioType:dA.Yu.reorderCustomSections,moduleName:dA.rA.sectionTreeItem,moduleType:dA.PO.treeItem,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList},e)},rle=({logger:e,scenarioFactory:t})=>{e.infoToTelemetry?.("Reorder conversation folders succeeded.","simple_collab_reorder_conversation_folders",void 0,!0),t.stopScenarioIfActive(H.RG.SimpleCollabReorderConversationFolders)},sle=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};return n.errorToTelemetry?.(`Reorder conversation folders failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_reorder_conversation_folders",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabReorderConversationFolders,{errorCode:a.errorCode},"failure"),Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("simpleCollab","simple_collab_toast_reorder_folders_failed"),dismissOnAction:!0})})},lle=({createDatabag:e,data:t,logger:n,recordPanelAction:i,scenarioFactory:a})=>{const o="function"==typeof t?t():{},{folderType:r,isLegacyFavoritesFolder:s,itemType:l}=o;a.newScenario(H.RG.SimpleCollabReorderConversationFolderListItems);const c=hle(r,s),d=e?.();d&&(d.sectionType=c,d.itemType=l),i({...vse(),actionGesture:dA.uS.dragAndDrop,actionOutcome:dA.$K.reorder,actionScenario:dA.Tk.dragAndDropReorderWithinCustomSection,actionScenarioType:dA.Yu.reorderCustomSectionItems,moduleName:dA.rA.sectionListItem,moduleType:dA.PO.treeItem,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList,dataBag:d},n),d?.dispose()},cle=({logger:e,scenarioFactory:t})=>{e.infoToTelemetry?.("Reorder conversation folder items succeeded.","simple_collab_reorder_conversation_folder_items",void 0,!0),t.stopScenarioIfActive(H.RG.SimpleCollabReorderConversationFolderListItems)},dle=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};return n.errorToTelemetry?.(`Reorder conversation folder items failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_reorder_conversation_folder_items",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabReorderConversationFolderListItems,{errorCode:a.errorCode},"failure"),Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("simpleCollab","simple_collab_toast_reorder_item_in_folder_failed"),dismissOnAction:!0})})},ule=({createDatabag:e,data:t,logger:n,recordPanelAction:i,scenarioFactory:a})=>{const o="function"==typeof t?t():{},{fromFolderType:r,toFolderType:s,isFromLegacyFavoritesFolder:l,isToLegacyFavoritesFolder:c,itemType:d}=o;a.newScenario(H.RG.SimpleCollabDnDItemToConversationFolder);const u=hle(r,l),m=hle(s,c),p=e?.();p&&(p.sectionType=u,p.targetSectionType=m,p.itemType=d),i({...vse(),actionGesture:dA.uS.dragAndDrop,actionOutcome:dA.$K.reorder,actionScenario:dA.Tk.dragAndDropReorderBetweenCustomSections,actionScenarioType:dA.Yu.reorderCustomSectionItems,moduleName:dA.rA.sectionListItem,moduleType:dA.PO.treeItem,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList,dataBag:p},n),p?.dispose()},mle=({logger:e,scenarioFactory:t})=>{e.infoToTelemetry?.("Drag and drop item to conversation folder succeeded.","simple_collab_dnd_item_to_conversation_folder",void 0,!0),t.stopScenarioIfActive(H.RG.SimpleCollabDnDItemToConversationFolder)},ple=({data:e,i18n:t,logger:n,scenarioFactory:i})=>{const a="function"==typeof e?e():{};return n.errorToTelemetry?.(`Drag and drop item to conversation folder failed. errorCode: ${a.errorCode}, errorDetail: ${a.errorDetail}`,"simple_collab_dnd_item_to_conversation_folder",void 0,!0),i.stopScenarioIfActive(H.RG.SimpleCollabDnDItemToConversationFolder,{errorCode:a.errorCode},"failure"),Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("simpleCollab","simple_collab_toast_reorder_item_in_folder_failed"),dismissOnAction:!0})})},gle=({createDatabag:e,data:t,logger:n,recordPanelAction:i})=>{const a="function"==typeof t?t():{},{viewType:o}=a,r=yle(o),s=e?.();s&&(s.viewType=r),i({...vse(),actionGesture:dA.uS.click,actionOutcome:"CHANNELS_ONLY"===o?dA.$K.setRecentChannelsView:dA.$K.setTeamsAndChannelsView,actionScenario:"CHANNELS_ONLY"===o?dA.Tk.setRecentChannelsViewType:dA.Tk.setTeamsAndChannelsView,actionScenarioType:dA.Yu.setChannelsViewType,moduleName:dA.rA.listOptions,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.SimpleCollabAppList,dataBag:s},n),s?.dispose()},hle=(e,t)=>{switch(e){case"HIDDEN_CHANNELS":return"hiddenChannels";case"RECENT_CHATS":return"recentChats";case"RECENT_CHANNELS":return"recentChannels";case"TEAMS_AND_CHANNELS":return"teamsAndChannels";case"APPS":return"apps";default:return t?"favorites":"customSection"}},yle=e=>{switch(e){case"CHANNELS_ONLY":return"recentChannels";case"TEAMS_AND_CHANNELS":return"teamsAndChannels";default:throw new Error(`Unsupported viewType: ${e}`)}};var vle=n(265593);const fle={actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.channelAction,actionSubworkload:dA.eD.channelCardQuickActions,actionWorkload:dA.sz.teamChannelManagement,panelRegion:dA.Ai.popover,panelType:dA.wh.ChannelCard,panelUri:"app.conversation"},Sle=vle.Bx.ChannelCard,kle=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("SimpleCollabChannelCardEvent","simple-collab-channel-card");switch(a){case vle.nJ.manageTeam:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeam: teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...fle,actionScenario:dA.Tk.teamNav,actionScenarioType:dA.Yu.openteam,eventIdentifier:dA.b6.channelCard_manageTeamLink_click_teamNav,moduleName:dA.rA.channelCardManageTeam,moduleType:dA.PO.manageTeamLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:oB(e)})}case vle.nJ.manageTeamChannels:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeamChannels: teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_team_channels"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...fle,actionScenario:dA.Tk.teamNav,actionScenarioType:dA.Yu.openteam,eventIdentifier:dA.b6.channelCard_manageTeamChannelsLink_click_teamNav,moduleName:dA.rA.channelCardManageTeamChannels,moduleType:dA.PO.manageTeamChannelsLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:rB(e)})}case vle.nJ.manageChannelMembers:{const e="function"==typeof i?i():{};return cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),s.infoToTelemetry?.(`manageChannelMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_channel_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...vse(),...fle,actionScenario:dA.Tk.channelNav,actionScenarioType:dA.Yu.openchannel,eventIdentifier:dA.b6.channelCard_manageChannelMembersLink_click_channelNav,moduleName:dA.rA.channelCardManageChannelMembers,moduleType:dA.PO.manageChannelMembersLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:YU(e)})}case vle.nJ.getLinkToChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`getLinkToChannel: channelId: ${e.channelId}, groupId: ${e.groupId}, teamId: ${e.teamId}, channelResourceTenantId: ${e.channelResourceTenantId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_get_link_to_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.getChannelLink),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_getChannelLinkButton_click_channelAction,actionScenarioType:dA.Yu.getChannelLink,moduleName:dA.rA.channelCardGetChannelLink,moduleType:dA.PO.getChannelLinkButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:JU(e)})}case vle.nJ.viewChannelEmail:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`viewChannelEmail: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_view_channel_email"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.getChannelEmail),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_getChannelEmailButton_click_channelAction,actionScenarioType:dA.Yu.getChannelEmail,moduleName:dA.rA.channelCardGetChannelEmail,moduleType:dA.PO.getChannelEmailButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:ZU(e)})}case vle.nJ.leaveChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, isLastOwner: ${e.isLastOwner}, groupId: ${e.groupId}, channelOnlyMember: ${e.channelOnlyMember}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_leave_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.leaveChannel),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_leaveChannelButton_click_channelAction,actionScenarioType:dA.Yu.leaveChannel,moduleName:dA.rA.channelCardLeaveChannel,moduleType:dA.PO.leaveChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:tB(e)})}case vle.nJ.manageChannel:{const e="function"==typeof i?i():{};return cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),s.infoToTelemetry?.(`manageChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_manage_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.manageChannel),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_manageChannelButton_click_channelAction,actionScenarioType:dA.Yu.manageChannel,moduleName:dA.rA.channelCardManageChannel,moduleType:dA.PO.manageChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:KU(e)})}case vle.nJ.channelAddMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelAddMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_channel_add_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.addMembers),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_channelAddMembersButton_click_channelAction,actionScenarioType:dA.Yu.channelAddMembers,moduleName:dA.rA.channelCardAddMembers,moduleType:dA.PO.channelAddMembersButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:eB(e)})}case vle.nJ.shareChannelWithUser:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithUser: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_share_channel_with_user"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.addMembers,i.channelType="Shared"),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_shareChannelWithUserButton_click_channelAction,actionScenarioType:dA.Yu.shareChannelWithUser,moduleName:dA.rA.channelCardShareChannelWithUser,moduleType:dA.PO.shareChannelWithUserButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:nB(e)})}case vle.nJ.shareChannelWithTeam:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithTeam: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_share_channel_with_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.addMembers,i.channelType="Shared"),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_shareChannelWithTeamButton_click_channelAction,actionScenarioType:dA.Yu.shareChannelWithTeam,moduleName:dA.rA.channelCardShareChannelWithTeam,moduleType:dA.PO.shareChannelWithTeamButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:iB(e)})}case vle.nJ.channelNotificationSettings:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelNotificationSettings: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"simple_collab_channel_card_channel_notification_settings"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.channelNotificationSettings),t({...vse(),...fle,eventIdentifier:dA.b6.channelCard_channelNotificationSettingsButton_click_channelAction,actionScenarioType:dA.Yu.channelNotificationSettings,moduleName:dA.rA.channelCardChannelNotificationSettings,moduleType:dA.PO.channelNotificationSettingsButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:HU(e)})}default:return}};var Cle=n(146367);const ble=Cle.kn,wle=({eventData:e,type:t,logger:n,userBiService:i,scenarioFactory:a})=>{const o=Tle[t];if(!o)return;const{channelAction:r,channelState:s,scenarioName:l,...c}=o,d=e?.actionWorkload||c.actionWorkload;a.newScenario(l);const u=i.createDatabag?.();u&&(u.isChannelsV2=!0,u.channelAction=r,u.channelState=s,u.isGeneralChannel=e?.generalChannelType),i.recordPanelAction({...c,...vse(),actionWorkload:d,dataBag:u},n),u?.dispose()},Tle={[Cle.pd.seeAllChannelsAction]:{scenarioName:H.RG.UserOnboardingToTeamSeeAllChannels,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenarioType:dA.Yu.onboardingPage,moduleName:dA.rA.seeAllButton,moduleType:dA.PO.button,panelRegion:dA.Ai.left,panelType:dA.wh.teamChannelList},[Cle.pd.seeAllChannelsOnLoadAction]:{scenarioName:H.RG.UserOnboardingToTeamSeeAllChannels,actionScenario:dA.Tk.leftRail,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.channelPreviewAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelPreview,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenario:dA.Tk.channelPreview,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.channelListItem,moduleType:dA.PO.listItem,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.channelBackAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelBack,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenario:dA.Tk.channelPreview,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.channelMessagePane,moduleName:dA.rA.backButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.openContextMenuAction]:{scenarioName:H.RG.UserOnboardingToTeamOpenContextMenu,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.channelContextMenu,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.menuButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.goToTeamAction]:{scenarioName:H.RG.UserOnboardingToTeamGoToTeam,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.goToTeamButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.activityFeed},[Cle.pd.activityFeedOnLoadAction]:{scenarioName:H.RG.UserOnboardingToTeamActivityFeed,actionScenario:dA.Tk.activityFeed,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.showChannelAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelItem,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.channelAction,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.channelManagement,channelAction:BP.zP.favoriteChannel,channelState:BP.Dz.shown,moduleName:dA.rA.channelActionMenu,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.hideChannelAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelItem,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.channelAction,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.channelManagement,channelAction:BP.zP.favoriteChannel,channelState:BP.Dz.hidden,moduleName:dA.rA.channelActionMenu,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.allPillAction]:{scenarioName:H.RG.UserOnboardingToTeamAllPill,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectAllChannelFilter,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.allChannelButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.shownPillAction]:{scenarioName:H.RG.UserOnboardingToTeamShownPill,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectShownChannelFilter,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.shownChannelButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.hiddenPillAction]:{scenarioName:H.RG.UserOnboardingToTeamHiddenPill,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectHiddenChannelFilter,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.hiddenChannelButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.sortByAction]:{scenarioName:H.RG.UserOnboardingToTeamSortBy,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectSort,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.sortSelection,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.searchAction]:{scenarioName:H.RG.UserOnboardingToTeamSearch,actionGesture:dA.uS.click,actionScenario:dA.Tk.search,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.searchButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.searchResultsAction]:{scenarioName:H.RG.UserOnboardingToTeamSearch,actionScenario:dA.Tk.search,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.searchResults,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.searchNoResultsAction]:{scenarioName:H.RG.UserOnboardingToTeamSearch,actionScenario:dA.Tk.search,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.noSearchResults,panelRegion:dA.Ai.main,panelType:dA.wh.Channel}},Ile={onEventReceived:async({eventInput:e,requestContext:t})=>{const{event:n}=e,{type:i,originator:a}=n,{coreSettings:o,i18n:r,loggerFactory:s,phaseStateMachine:l,scenarioFactory:c,userBiService:d}=t,u=t.client.relayEnvironment;if(a===Sle)return kle(n,s,d);if(a===ble)return(async(e,t,n,i,a)=>{const{type:o,data:r}=e,s=t.newLogger("simpleCollabApp UserOnboardingToTeamEvents","apps-teams-and-channels");switch(o){case Cle.pd.seeAllChannelsLoadMoreRenderStart:return void i.newScenario(H.RG.UserOnboardingToTeamLoadNext);case Cle.pd.seeAllChannelsLoadMoreRenderFail:{const e=H.RG.UserOnboardingToTeamLoadNext,t=i.findScenario(e);return void(t&&t.fail())}case Cle.pd.seeAllChannelsLoadMoreRenderComplete:{const e=H.RG.UserOnboardingToTeamLoadNext;return void(i.findScenario(e)&&(i.startStep(e,H.ck.UserOnboardingToTeamLoadNextComplete),i.stopScenarioIfActive(e)))}case Cle.pd.useronboardingFilterSortLoadStart:{const e="function"==typeof r?r():{};return void i.newScenario(H.RG.UserOnboardingToTeamFilterSortLoad).appendEventData({dataSource:e.actionWorkload})}case Cle.pd.useronboardingFilterSortLoadFail:{const e=H.RG.UserOnboardingToTeamFilterSortLoad,t=i.findScenario(e);return void(t&&t.fail())}case Cle.pd.useronboardingFilterSortLoadComplete:{const e=H.RG.UserOnboardingToTeamFilterSortLoad;return void(i.findScenario(e)&&(i.startStep(e,H.ck.UserOnboardingToTeamFilterSortLoadComplete),i.stopScenarioIfActive(e)))}case Cle.pd.switchToChannel:{const e="function"==typeof r?r():{};return cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),e.isHidden?hse(a,e.id):yse(a),Promise.resolve({command:WU(e)})}case Cle.pd.seeAllChannelsAction:case Cle.pd.seeAllChannelsOnLoadAction:case Cle.pd.channelPreviewAction:case Cle.pd.channelBackAction:case Cle.pd.openContextMenuAction:case Cle.pd.goToTeamAction:case Cle.pd.activityFeedOnLoadAction:case Cle.pd.showChannelAction:case Cle.pd.hideChannelAction:case Cle.pd.allPillAction:case Cle.pd.shownPillAction:case Cle.pd.hiddenPillAction:case Cle.pd.sortByAction:case Cle.pd.searchAction:case Cle.pd.searchResultsAction:case Cle.pd.searchNoResultsAction:{const e="function"==typeof r?r():void 0;return wle({eventData:e,type:o,logger:s,userBiService:n,scenarioFactory:i})}default:return}})(n,s,d,c,u);const m=Ble(i);return m===Ule.ChatContextMenuEvent?Sse(n,s,d):m===Ule.ChannelContextMenuEvent?Nse(n,s,d):m===Ule.TeamContextMenuEvent?Dse(n,s,d,r):m===Ule.LeftRailHeaderContextMenuEvent?Rse(n,s,d):m===Ule.FolderActionCompletionEvent?Lse(n,s,r,d,c):function(e,t,n,i,a,o,r,s){const{data:l,type:c}=e,d=i.newLogger("SimpleCollabEvents","simple-collab-event-action-handlers");switch(c){case gse._H.switchToChat:{const e="function"==typeof l?l():{},t=e.internalId;return cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:t})),cse.simpleCollabStore.set(cse.selectedHiddenChannelIdAtom,void 0),yse(o),Promise.resolve({command:UU({id:t,openInPopout:e.openInPopout,commandSource:e.commandSource,correlationId:e.correlationId})})}case gse._H.switchToChannel:{const e="function"==typeof l?l():{};return cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:e.channelId,teamId:e.teamId})),cse.simpleCollabStore.set(cse.selectedHiddenChannelIdAtom,e.isHidden?e.channelId:void 0),e.isHidden?hse(o,e.id):yse(o),Promise.resolve({command:WU(e)})}case gse._H.openFilterLeftRail:return void Ple({logger:d,userBiService:a});case gse._H.filterLeftRail:return Rle(t),void Mle({data:l,logger:d,userBiService:a});case gse._H.filterLeftRailComplete:return void Dle(t);case gse._H.filterLeftRailFail:return void xle(t);case gse.cn.createConversationFolder:{const e="function"==typeof l?l():{};return(({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{recordPanelAction:a}=n,o=!i.conversationId;a({...vse(),...jse,actionOutcome:dA.$K.openDialog,actionScenario:dA.Tk.openCreateCustomSectionDialog,actionScenarioType:dA.Yu.createCustomSection,moduleName:o?dA.rA.createCustomSectionFromHeader:dA.rA.createCustomSectionFromMoveToMenu},t)})({data:l,logger:d,userBiService:a}),Promise.resolve({command:vB(e)})}case gse.cn.removeConversationFolder:{const e="function"==typeof l?l():{};return(({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r=i.isLegacyFavoritesFolder?"favorites":"customSection",s=a?.();s&&(s.sectionType=r),o({...vse(),...jse,actionOutcome:dA.$K.openDialog,actionScenario:dA.Tk.openRemoveCustomSectionDialog,actionScenarioType:dA.Yu.removeCustomSection,dataBag:s},t),s?.dispose()})({data:l,logger:d,userBiService:a}),Promise.resolve({command:fB(e)})}case gse.cn.renameConversationFolder:{const e="function"==typeof l?l():{};return(({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r=i?.isLegacyFavoritesFolder?"favorites":"customSection",s=a?.();s&&(s.sectionType=r),o({...vse(),...jse,actionOutcome:dA.$K.openDialog,actionScenario:dA.Tk.openRenameCustomSectionDialog,actionScenarioType:dA.Yu.renameCustomSection,dataBag:s},t),s?.dispose()})({data:l,logger:d,userBiService:a}),Promise.resolve({command:SB(e)})}case gse._H.viewDiscover:return cse.simpleCollabStore.set(cse.isDiscoverSurfaceSelectedAtom,!0),Ole({logger:d,userBiService:a});case gse._H.leftRailRenderStart:{const e=t.newScenario(H.RG.SimpleCollabRenderLeftRail),n=t.findScenario(H.RG.ApplicationLaunchTime);return void e.appendEventData({isFirstLoad:!!n})}case gse._H.leftRailRenderComplete:{const e=H.RG.SimpleCollabRenderLeftRail;return t.findScenario(e)&&(t.startStep(e,H.ck.SimpleCollabLeftRailRenderComplete),t.stopScenarioIfActive(e)),void n?.fireSignals({signals:[xV.G.SIMPLE_COLLAB_ADAPTIVE_LEFT_RAIL_LOADED]})}case gse._H.simpleCollabNavigation:return void Ale({data:l,logger:d,userBiService:a});case gse._H.simpleCollabConversationFolderNavigation:return void Ele({data:l,userBiService:a});case gse._H.seeMoreRenderStart:return void t.newScenario(H.RG.SimpleCollabLeftRailSeeMore);case gse._H.seeMoreRenderComplete:return void jle(t);case gse._H.seeMoreRenderFail:return void Lle(t);case gse._H.viewTeamSeeAllChannels:{const e="function"==typeof l?l():{};return Promise.resolve({command:kB(e)})}case gse._H.switchToBizChatMetaOS:{const e="function"==typeof l?l():{},{bizChatMetaOSAppId:n}=r.get(b.J.ChatList),i=n??"";return cse.simpleCollabStore.set(cse.selectedConversationIdAtom,JSON.stringify({id:i})),_le(t,d,a,e,i),Promise.resolve({command:BU({id:i,openInPopout:e.openInPopout})})}case gse._H.stopBizChatMetaOSE2EScenarioIfActive:{const{bizChatMetaOSAppId:e}=r.get(b.J.ChatList);return void Fle(t,d,e??"")}case gse._H.reorderTeamsFailed:return Nle(l,s);case gse._H.teamsAndChannelsFolderViewTypeChangeFailed:return $le(l,s);default:return}}(n,c,l,s,d,u,o,r)}};const Nle=(e,t)=>{const n="function"==typeof e?e():{},{teamName:i}=n;return Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("teamsAndChannels","simpleCollab_list_teams_reorder_error_message",{teamName:i}),dismissOnAction:!0})})},Ele=({data:e,userBiService:t})=>{const{createDatabag:n,appendBiData:i}=t,a="function"==typeof e?e():{},o=n?.();o&&(0!==a.totalTeams&&(o.totalTeams=a.totalTeams),0!==a.totalFavoriteItems&&(o.totalFavoriteItems=a.totalFavoriteItems),i(dA.sz.simpleCollab,{dataBag:o})),o?.dispose()},Ale=({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o,appendBiData:r}=n,s=a?.();s&&(s.atMentionCount=i.atMentionCount,s.totalSections=i.totalSections),r(dA.sz.simpleCollab,{dataBag:s}),o({...vse(),actionGesture:dA.uS.auto,actionOutcome:dA.$K.nav,actionWorkload:dA.sz.simpleCollab,actionScenario:dA.Tk.openAdaptiveRail,actionScenarioType:dA.Yu.nav,moduleType:dA.PO.nav,moduleName:dA.rA.openAdaptiveRailNav,panelRegion:dA.Ai.left,panelType:dA.wh.teamChannelList,dataBag:s},t,[dA.sz.simpleCollab]),s?.dispose()},_le=(e,t,n,i,a)=>{(0,A6.ui)(e,a,"SimpleCollabMetaOSEntryPoint",t,i.openInPopout);const{createDatabag:o,recordPanelAction:r}=n,s=o?.();s&&(s.appId=a,s.isPopOutBizChat=i.openInPopout),r({actionScenarioType:dA.Yu.botCopilotInteraction,actionScenario:dA.Tk.bizChatCopilotMetaOSSimpleCollab,actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,moduleType:dA.PO.list,moduleName:dA.rA.bizChatCopilotMetaOSSimpleCollab,dataBag:s},t),s?.dispose()},Fle=(e,t,n)=>{const i=e.findScenario(H.RG.PlatformTabLaunch);i&&i.eventData?.["App.Id"]===n&&"SimpleCollabMetaOSEntryPoint"===i.eventData?.["App.EntryPoint"]&&(t.log("Abandon BizChat MetaOS scenario due to app/chat switch or reopen."),i.stop({reason:"Abandon BizChat MetaOS scenario due to app/chat switch or reopen."},"abandoned"))},Dle=e=>{const t=H.RG.SimpleCollabLeftRailFilter;e.findScenario(t)&&(e.startStep(t,H.ck.SimpleCollabLeftRailFilterComplete),e.stopScenarioIfActive(t))},Ple=({logger:e,userBiService:t})=>{const{createDatabag:n,recordPanelAction:i}=t,a=n?.();i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.show,actionScenario:dA.Tk.showCombinedListFilter,actionScenarioType:dA.Yu.combinedListFilter,moduleType:dA.PO.button,moduleName:dA.rA.combinedListFilterButton,panelRegion:dA.Ai.left,panelType:dA.wh.combinedList,dataBag:a},e),a?.dispose()},Mle=({data:e,logger:t,userBiService:n})=>{const i="function"==typeof e?e():{},{createDatabag:a,recordPanelAction:o}=n,r=a?.();i&&(i.text||i.tags)?o({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.typeCombinedListFilter,actionScenarioType:dA.Yu.combinedListFilter,moduleType:dA.PO.textbox,moduleName:dA.rA.combinedListFilterTypeTextBox,panelRegion:dA.Ai.left,panelType:dA.wh.combinedList,dataBag:r},t):o({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.cancel,actionScenario:dA.Tk.cancelCombinedListFilter,actionScenarioType:dA.Yu.combinedListFilter,moduleType:dA.PO.button,moduleName:dA.rA.combinedListFilterCancelButton,panelRegion:dA.Ai.left,panelType:dA.wh.combinedList,dataBag:r},t),r?.dispose()},xle=e=>{const t=H.RG.SimpleCollabLeftRailFilter,n=e.findScenario(t);n&&n.fail()},Rle=e=>{e.cancelExistingAndCreateScenario(H.RG.SimpleCollabLeftRailFilter,"abandon")},jle=e=>{const t=H.RG.SimpleCollabLeftRailSeeMore;e.findScenario(t)&&(e.startStep(t,H.ck.SimpleCollabSeeMoreRenderComplete),e.stopScenarioIfActive(t))},Lle=e=>{const t=H.RG.SimpleCollabLeftRailSeeMore,n=e.findScenario(t);n&&n.fail()},Ole=({logger:e,userBiService:t})=>{const{createDatabag:n,recordPanelAction:i}=t,a=n?.();return i({...vse(),actionGesture:dA.uS.click,actionOutcome:dA.$K.select,actionScenario:dA.Tk.discoverSurfaceNav,actionScenarioType:dA.Yu.headerNavSimpleCollab,moduleType:dA.PO.menuItem,moduleName:dA.rA.menuButton,panelRegion:dA.Ai.left,panelType:dA.wh.SimpleCollabAppList,dataBag:a},e),a?.dispose(),Promise.resolve({command:yB()})},$le=(e,t)=>{const n="function"==typeof e?e():{},{name:i}=n;return Promise.resolve({command:Y0({intent:"Error",title:t.stringTranslate("teamsAndChannels","simpleCollab_list_teams_and_channels_folder_view_type_change_error_message",{name:i}),dismissOnAction:!0})})};var Ule;!function(e){e[e.ChatContextMenuEvent=0]="ChatContextMenuEvent",e[e.ChannelContextMenuEvent=1]="ChannelContextMenuEvent",e[e.TeamContextMenuEvent=2]="TeamContextMenuEvent",e[e.Default=3]="Default",e[e.FolderActionCompletionEvent=4]="FolderActionCompletionEvent",e[e.LeftRailHeaderContextMenuEvent=5]="LeftRailHeaderContextMenuEvent",e[e.LettRailHeaderButtonsEvent=6]="LettRailHeaderButtonsEvent"}(Ule||(Ule={}));const Ble=e=>{switch(e){case gse._H.chatManageApps:case gse._H.leaveChat:case gse._H.deleteChat:return Ule.ChatContextMenuEvent;case gse._H.channelNotificationSettings:case gse._H.channelWorkflows:case gse._H.editChannel:case gse._H.toastMessageChannelEvent:case gse._H.archiveChannel:case gse._H.deleteChannel:case gse._H.getLinkToChannel:case gse._H.manageChannel:case gse._H.manageChannelTags:case gse._H.viewChannelEmail:case gse._H.channelAddMembers:case gse._H.leaveChannel:case gse._H.shareChannelWithUser:case gse._H.shareChannelWithTeam:case gse._H.shareChannelWithTeamYouOwn:case gse._H.showHideChannel:case gse._H.manageTeamChannels:case gse._H.channelContextMenuClick:return Ule.ChannelContextMenuEvent;case gse._H.manageTeam:case gse._H.manageTags:case gse._H.getLinkToTeam:case gse._H.leaveTeam:case gse._H.teamAddMember:case gse._H.teamAddChannel:case gse._H.deleteTeam:case gse._H.forceHideTeam:case gse._H.teamContextMenuClick:return Ule.TeamContextMenuEvent;case gse._H.joinTeam:case gse._H.createChannel:case gse._H.createTeam:case gse._H.manageTeams:case gse._H.leftRailHeaderPlusMenuOpen:case gse._H.openManageTeams:case gse._H.createTeamOnMainView:return Ule.LeftRailHeaderContextMenuEvent;case gse._H.openFilterLeftRail:return Ule.LettRailHeaderButtonsEvent;case gse.xs.staleChannelsAdhocDialog:case gse.xs.createConversationFolderCancelAction:case gse.xs.createConversationFolderConfirmAction:case gse.xs.createConversationFolderSucceeded:case gse.xs.createConversationFolderFailed:case gse.xs.renameConversationFolderCancelAction:case gse.xs.renameConversationFolderConfirmAction:case gse.xs.renameConversationFolderSucceeded:case gse.xs.renameConversationFolderFailed:case gse.xs.removeConversationFolderCancelAction:case gse.xs.removeConversationFolderConfirmAction:case gse.xs.removeConversationFolderSucceeded:case gse.xs.removeConversationFolderFailed:case gse.xs.removeFromFolderAction:case gse.xs.removeFromFolderSucceeded:case gse.xs.removeFromFolderFailed:case gse.xs.moveConversationToFolderAction:case gse.xs.moveConversationToFolderSucceeded:case gse.xs.moveConversationToFolderFailed:case gse.xs.setConversationFolderExpandedStateAction:case gse.xs.setConversationFolderExpandedStateSucceeded:case gse.xs.setConversationFolderExpandedStateFailed:case gse.xs.reorderConversationFoldersAction:case gse.xs.reorderConversationFoldersSucceeded:case gse.xs.reorderConversationFoldersFailed:case gse.xs.reorderConversationFolderItemsAction:case gse.xs.reorderConversationFolderItemsSucceeded:case gse.xs.reorderConversationFolderItemsFailed:case gse.xs.dndItemToConversationFolderAction:case gse.xs.dndItemToConversationFolderSucceeded:case gse.xs.dndItemToConversationFolderFailed:case gse.xs.setChannelsViewType:return Ule.FolderActionCompletionEvent;case gse._H.reorderTeamsFailed:default:return Ule.Default}},Wle=({appRenderMode:e,type:t})=>{const n=new MV.H,i=[],a=[];switch(e){case Mt.S.HorizontalBar:Gle({type:t,criticalSignals:i,featureFlags:{},postCriticalSignals:a});break;case Mt.S.Main:Hle({type:t,criticalSignals:i,featureFlags:{},postCriticalSignals:a});break;case Mt.S.Rail:Vle({type:t,criticalSignals:i,featureFlags:{},postCriticalSignals:a})}return n.registerAppPhase({phase:yt.nh.CRITICAL,signals:i,timeout:25e3}),n.appPhases},Hle=({criticalSignals:e,type:t})=>{t===Se.py.teamseeallchannels?e.push(xV.G.USER_ONBOARDING_TO_TEAM_VIEW_RENDERED):(e.push(xV.G.MESSAGES_RENDERED),e.push(xV.G.COMPOSE_LOADED))},Vle=({criticalSignals:e})=>{e.push(xV.G.SIMPLE_COLLAB_ADAPTIVE_LEFT_RAIL_LOADED)},Gle=({criticalSignals:e,type:t})=>{t===Se.py.teamseeallchannels&&e.push(xV.G.USER_ONBOARDING_HEADER_RENDERED)},zle=()=>Promise.all([n.e(193180),n.e(586535),n.e(84274),n.e(361845),n.e(438152),n.e(232463),n.e(995006),n.e(68021),n.e(558390),n.e(474133),n.e(371898),n.e(886226),n.e(682321),n.e(369829),n.e(931290)]).then(n.bind(n,127871)),qle=({coreServices:e,host:t,screenState:n,windowOptions:i})=>{const{height:a,minHeight:o,minWidth:r,offset:s,width:l}=rse.windowFeatures||{},c=t?.screenX||0,d=t?.screenY||0,u=(n?.numOpenWindows||1)*(s||1);return{additionalFeatures:{minHeight:`${o}`,minWidth:`${r}`},height:a,left:c+u,minHeight:o,minWidth:r,top:d+u,width:l,...rse.windowFeatures,...e?.coreSettings.get(b.J.Core).enableRatioToScreenBasedSizing&&Jle(t,rse.windowFeatures),...i}};function Jle(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}function Qle(e=cse){return{eventHandlers:Ile,getAppPhases:Wle,getAppViewEntities:zre,getAppViewEntitiesProps:ese,getAppWindowFeatures:qle,manifest:rse,onCommandReceived:use,onPreWarm:pse,getPlatformAppIdForEntity(t){switch(e.simpleCollabStore.set(e.selectedAppIdAtom,t.type),t.type){case Se.py.simplecollab:return"3b64df9d-7e97-4d9c-ac5c-2e0a5d8e6f40";case Se.py.simplecollabchannels:return"2a84919f-59d8-4441-a975-2a8c2643b741";case Se.py.simplecollabchats:return"86fcd49b-61a2-4701-b771-54728cd291fb";default:return}},async render({appRenderMode:t,coreSettings:n,onRenderEvent:i,scenarioFactory:a}){const o="simple-collab-app";i("ChunkLoadStarted",{chunkName:o});const{SimpleCollabEntry:r}=await(0,ac.mT)(zle,o,a);return i("ChunkLoadSucceeded",{chunkName:o}),(0,gO.t)(ez.f,{namespaces:["simpleCollab"],loaderRenderer:null,children:(0,gO.t)(Gre.zt,{store:e.simpleCollabStore,children:(0,gO.t)(r,{appRenderMode:t,coreSettings:n,appState:e})})})},async onViewUpdateCommandResolved({availableEntities:t}){const n=t.mainEntity;if(n?.action===Se.uk.view&&n.id)if(n.type===Se.py.chats)e.simpleCollabStore.set(e.selectedConversationIdAtom,JSON.stringify({id:n.id}));else if(n.type===Se.py.channels){let t;try{t=JSON.parse(n.id)}catch{t={}}"object"==typeof t&&t.channelId&&t.teamId&&e.simpleCollabStore.set(e.selectedConversationIdAtom,JSON.stringify({id:t.channelId,teamId:t.teamId}))}},getEventScenarioData(e){let t;const{data:n}=e.event,i="function"==typeof n?n():{};switch(e.event.type){case"switchToChat":case"switchToChannel":let e;e=i.internalId===IX.FX?H.RG.SimpleCollabNewChat:H.RG.SimpleCollabSwitch,t={scenarioName:e,source:i.commandSource};break;case"viewTeamSeeAllChannels":t={scenarioName:H.RG.SimpleCollabSeeAllChannelsSwitch,source:i.commandSource};break;case"viewDiscover":t={scenarioName:H.RG.DiscoverSurfaceSwitchV2,source:i.commandSource};break;case"switchToBizChatMetaOS":t={scenarioName:H.RG.NavigateToBizChatMetaOSFromSimpleCollab,isPopOut:i.openInPopout}}return t}}}const Kle={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}},{kind:"Field",name:{kind:"Name",value:"substrateGroupId"}}]}}]}}]},Yle={actionGesture:dA.uS.click,actionOutcome:dA.$K.nav,actionScenario:dA.Tk.channelAction,actionSubworkload:dA.eD.channelCardQuickActions,actionWorkload:dA.sz.teamChannelManagement,panelRegion:dA.Ai.popover,panelType:dA.wh.ChannelCard,panelUri:"app.conversation"},Xle=vle.Bx.ChannelCard,Zle=async(e,t,n)=>{const{data:i,type:a}=e,{recordPanelAction:o,createDatabag:r}=n,s=t.newLogger("TeamsAndChannelsAppChannelCardEvent","apps-teams-and-channels-channel-card");switch(a){case vle.nJ.manageTeam:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeam: teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...Yle,actionScenario:dA.Tk.teamNav,actionScenarioType:dA.Yu.openteam,eventIdentifier:dA.b6.channelCard_manageTeamLink_click_teamNav,moduleName:dA.rA.channelCardManageTeam,moduleType:dA.PO.manageTeamLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:$$(e)})}case vle.nJ.manageChannelMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannelMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_channel_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...Yle,actionScenario:dA.Tk.channelNav,actionScenarioType:dA.Yu.openchannel,eventIdentifier:dA.b6.channelCard_manageChannelMembersLink_click_channelNav,moduleName:dA.rA.channelCardManageChannelMembers,moduleType:dA.PO.manageChannelMembersLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:O$(e)})}case vle.nJ.getLinkToChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`getLinkToChannel: channelId: ${e.channelId}, groupId: ${e.groupId}, teamId: ${e.teamId}, channelResourceTenantId: ${e.channelResourceTenantId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_get_link_to_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.getChannelLink),t({...Yle,eventIdentifier:dA.b6.channelCard_getChannelLinkButton_click_channelAction,actionScenarioType:dA.Yu.getChannelLink,moduleName:dA.rA.channelCardGetChannelLink,moduleType:dA.PO.getChannelLinkButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:j$(e)})}case vle.nJ.viewChannelEmail:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`viewChannelEmail: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_view_channel_email"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.getChannelEmail),t({...Yle,eventIdentifier:dA.b6.channelCard_getChannelEmailButton_click_channelAction,actionScenarioType:dA.Yu.getChannelEmail,moduleName:dA.rA.channelCardGetChannelEmail,moduleType:dA.PO.getChannelEmailButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:L$(e)})}case vle.nJ.leaveChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`leaveChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, isLastOwner: ${e.isLastOwner}, groupId: ${e.groupId}, channelOnlyMember: ${e.channelOnlyMember}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_leave_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.leaveChannel),t({...Yle,eventIdentifier:dA.b6.channelCard_leaveChannelButton_click_channelAction,actionScenarioType:dA.Yu.leaveChannel,moduleName:dA.rA.channelCardLeaveChannel,moduleType:dA.PO.leaveChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:B$(e)})}case vle.nJ.manageChannel:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageChannel: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_channel"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.manageChannel),t({...Yle,eventIdentifier:dA.b6.channelCard_manageChannelButton_click_channelAction,actionScenarioType:dA.Yu.manageChannel,moduleName:dA.rA.channelCardManageChannel,moduleType:dA.PO.manageChannelButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:W$(e)})}case vle.nJ.manageTeamChannels:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`manageTeamChannels: teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_manage_team_channels"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0),t({...Yle,actionScenario:dA.Tk.teamNav,actionScenarioType:dA.Yu.openteam,eventIdentifier:dA.b6.channelCard_manageTeamChannelsLink_click_teamNav,moduleName:dA.rA.channelCardManageTeamChannels,moduleType:dA.PO.manageTeamChannelsLink,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:U$(e)})}case vle.nJ.channelAddMembers:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelAddMembers: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_channel_add_members"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.addMembers),t({...Yle,eventIdentifier:dA.b6.channelCard_channelAddMembersButton_click_channelAction,actionScenarioType:dA.Yu.channelAddMembers,moduleName:dA.rA.channelCardAddMembers,moduleType:dA.PO.channelAddMembersButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:H$(e)})}case vle.nJ.shareChannelWithUser:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithUser: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_share_channel_with_user"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.addMembers,i.channelType="Shared"),t({...Yle,eventIdentifier:dA.b6.channelCard_shareChannelWithUserButton_click_channelAction,actionScenarioType:dA.Yu.shareChannelWithUser,moduleName:dA.rA.channelCardShareChannelWithUser,moduleType:dA.PO.shareChannelWithUserButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:V$(e)})}case vle.nJ.shareChannelWithTeam:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`shareChannelWithTeam: channelId: ${e.channelId}, teamId: ${e.teamId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_share_channel_with_team"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.addMembers,i.channelType="Shared"),t({...Yle,eventIdentifier:dA.b6.channelCard_shareChannelWithTeamButton_click_channelAction,actionScenarioType:dA.Yu.shareChannelWithTeam,moduleName:dA.rA.channelCardShareChannelWithTeam,moduleType:dA.PO.shareChannelWithTeamButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:G$(e)})}case vle.nJ.channelNotificationSettings:{const e="function"==typeof i?i():{};return s.infoToTelemetry?.(`channelNotificationSettings: channelId: ${e.channelId}, commandSource: ${e.commandSource}`,"apps_teams_and_channels_channel_card_channel_notification_settings"),((e,t,n)=>{const i=n?.();i&&(i.isChannelsV2=!0,i.channelAction=BP.zP.channelNotificationSettings),t({...Yle,eventIdentifier:dA.b6.channelCard_channelNotificationSettingsButton_click_channelAction,actionScenarioType:dA.Yu.channelNotificationSettings,moduleName:dA.rA.channelCardChannelNotificationSettings,moduleType:dA.PO.channelNotificationSettingsButton,dataBag:i},e),i?.dispose()})(s,o,r),Promise.resolve({command:z$(e)})}default:return}},ece=Cle.kn,tce=({eventData:e,type:t,logger:n,userBiService:i,scenarioFactory:a})=>{const{channelAction:o,channelState:r,scenarioName:s,...l}=nce[t],c=e?.actionWorkload||l.actionWorkload;a.newScenario(s);const d=i.createDatabag?.();d&&(d.isChannelsV2=!0,d.channelAction=o,d.channelState=r,d.isGeneralChannel=e?.generalChannelType),i.recordPanelAction({...l,actionWorkload:c,appName:"TeamsApp",dataBag:d},n),d?.dispose()},nce={[Cle.pd.seeAllChannelsAction]:{scenarioName:H.RG.UserOnboardingToTeamSeeAllChannels,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenarioType:dA.Yu.onboardingPage,moduleName:dA.rA.seeAllButton,moduleType:dA.PO.button,panelRegion:dA.Ai.left,panelType:dA.wh.teamChannelList},[Cle.pd.seeAllChannelsOnLoadAction]:{scenarioName:H.RG.UserOnboardingToTeamSeeAllChannels,actionScenario:dA.Tk.leftRail,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.channelPreviewAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelPreview,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenario:dA.Tk.channelPreview,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.channelListItem,moduleType:dA.PO.listItem,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.channelBackAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelBack,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenario:dA.Tk.channelPreview,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.channelMessagePane,moduleName:dA.rA.backButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.openContextMenuAction]:{scenarioName:H.RG.UserOnboardingToTeamOpenContextMenu,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.channelContextMenu,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.menuButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.goToTeamAction]:{scenarioName:H.RG.UserOnboardingToTeamGoToTeam,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionOutcomeNew:dA.$K.nav,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.goToTeamButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.activityFeed},[Cle.pd.activityFeedOnLoadAction]:{scenarioName:H.RG.UserOnboardingToTeamActivityFeed,actionScenario:dA.Tk.activityFeed,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.showChannelAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelItem,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.channelAction,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.channelManagement,channelAction:BP.zP.favoriteChannel,channelState:BP.Dz.shown,moduleName:dA.rA.channelActionMenu,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.hideChannelAction]:{scenarioName:H.RG.UserOnboardingToTeamChannelItem,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.channelAction,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.channelManagement,channelAction:BP.zP.favoriteChannel,channelState:BP.Dz.hidden,moduleName:dA.rA.channelActionMenu,moduleType:dA.PO.menuItem,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.allPillAction]:{scenarioName:H.RG.UserOnboardingToTeamAllPill,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectAllChannelFilter,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.allChannelButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.shownPillAction]:{scenarioName:H.RG.UserOnboardingToTeamShownPill,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectShownChannelFilter,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.shownChannelButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.hiddenPillAction]:{scenarioName:H.RG.UserOnboardingToTeamHiddenPill,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectHiddenChannelFilter,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.hiddenChannelButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.sortByAction]:{scenarioName:H.RG.UserOnboardingToTeamSortBy,actionGesture:dA.uS.click,actionOutcome:dA.$K.submit,actionScenario:dA.Tk.selectSort,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.sortSelection,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.searchAction]:{scenarioName:H.RG.UserOnboardingToTeamSearch,actionGesture:dA.uS.click,actionScenario:dA.Tk.search,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,moduleName:dA.rA.searchButton,moduleType:dA.PO.button,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.searchResultsAction]:{scenarioName:H.RG.UserOnboardingToTeamSearch,actionScenario:dA.Tk.search,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.searchResults,panelRegion:dA.Ai.main,panelType:dA.wh.Channel},[Cle.pd.searchNoResultsAction]:{scenarioName:H.RG.UserOnboardingToTeamSearch,actionScenario:dA.Tk.search,actionScenarioType:dA.Yu.onboardingPage,actionWorkload:dA.sz.allChannelsViewSortByAToZ,actionSubworkload:dA.eD.noSearchResults,panelRegion:dA.Ai.main,panelType:dA.wh.Channel}},ice={onEventReceived:async({eventInput:e,requestContext:{client:t,loggerFactory:n,scenarioFactory:i,userBiService:a,viewEntity:o}})=>{if(e.event.originator===Xle)return Zle(e.event,n,a);if(e.event.originator===ece)return(async(e,t,n,i)=>{const{type:a,data:o}=e,r=t.newLogger("TeamsAndChannelsApp UserOnboardingToTeamEvents","apps-teams-and-channels");switch(a){case Cle.pd.switchToChannel:{const e="function"==typeof o?o():{};return Promise.resolve({command:x$(e)})}case Cle.pd.loadUserOnboardingToTeamPage:{const e="function"==typeof o?o():{};return Promise.resolve({command:R$(e)})}case Cle.pd.seeAllChannelsLoadMoreRenderStart:return void i.newScenario(H.RG.UserOnboardingToTeamLoadNext);case Cle.pd.seeAllChannelsLoadMoreRenderFail:{const e=H.RG.UserOnboardingToTeamLoadNext,t=i.findScenario(e);return void(t&&t.fail())}case Cle.pd.seeAllChannelsLoadMoreRenderComplete:{const e=H.RG.UserOnboardingToTeamLoadNext;return void(i.findScenario(e)&&(i.startStep(e,H.ck.UserOnboardingToTeamLoadNextComplete),i.stopScenarioIfActive(e)))}case Cle.pd.useronboardingFilterSortLoadStart:{const e="function"==typeof o?o():{};return void i.newScenario(H.RG.UserOnboardingToTeamFilterSortLoad).appendEventData({dataSource:e.actionWorkload})}case Cle.pd.useronboardingFilterSortLoadFail:{const e=H.RG.UserOnboardingToTeamFilterSortLoad,t=i.findScenario(e);return void(t&&t.fail())}case Cle.pd.useronboardingFilterSortLoadComplete:{const e=H.RG.UserOnboardingToTeamFilterSortLoad;return void(i.findScenario(e)&&(i.startStep(e,H.ck.UserOnboardingToTeamFilterSortLoadComplete),i.stopScenarioIfActive(e)))}case Cle.pd.seeAllChannelsAction:case Cle.pd.seeAllChannelsOnLoadAction:case Cle.pd.channelPreviewAction:case Cle.pd.channelBackAction:case Cle.pd.openContextMenuAction:case Cle.pd.goToTeamAction:case Cle.pd.activityFeedOnLoadAction:case Cle.pd.showChannelAction:case Cle.pd.hideChannelAction:case Cle.pd.allPillAction:case Cle.pd.shownPillAction:case Cle.pd.hiddenPillAction:case Cle.pd.sortByAction:case Cle.pd.searchAction:case Cle.pd.searchResultsAction:case Cle.pd.searchNoResultsAction:{const e="function"==typeof o?o():void 0;return tce({eventData:e,type:a,logger:r,userBiService:n,scenarioFactory:i})}}})(e.event,n,a,i);switch(e.event.type){case vO.uS.expandTab:{const t=e.event.data?.();return Promise.resolve({command:Nt.CN.expandTab(t)})}case vO.uS.resetLayoutOverrides:return Promise.resolve({command:Nt.CN.resetLayoutOverrides()});case YV.uS.requestPersonMoreInfo:{const n=e.event.data?.();let i=!1,a="";if(o?.id){const{data:{chat:e}}=await t.query({query:Kle,variables:{convId:o?.id},context:{callerInfo:"apps-teams-and-channels-event-handler"}});i=!!e?.substrateGroupId,a=e?.tenantId||""}const r=nG({...n,...a&&{tenantId:a},...o?.id&&{conversationId:o?.id},isSharedChannel:i});return Promise.resolve({command:r})}case YV.uS.requestTopicMoreInfo:{const t=e.event.data?.();return Promise.resolve({command:aG({...t})})}}return Promise.resolve(void 0)}};var ace,oce,rce,sce,lce,cce=n(233909);!function(e){e.teamDashboard="/l/team-dashboard",e.channelDashboard="/l/channel-dashboard",e.pendingInvites="/l/manage-teams/myinvites",e.channel="/l/channel",e.replyChain="/l/message",e.team="/l/team",e.teamsPremiumTrial="/l/trial/teamsPremiumTrial",e.teamsPremiumLicenseRequest="/l/trial/teamsPremiumLicenseRequest"}(ace||(ace={})),function(e){e.FeatureNotEnabled="Feature for parsing T1 teams and channels deep links in T2.1 is not enabled",e.NoChannelId="Parsed teams and channels deep link does not contain the channel id",e.NoThreadId="Parsed teams and channels deep link does not contain the thread id",e.InvalidDeeplinkType="Parsed teams and channels deep link does not contain a valid deeplink type",e.NoTabId="Parsed teams and channels deep link does not contain the tab id",e.MalformedContext="Parsed teams and channels deep link contains malformed search context"}(oce||(oce={})),function(e){e.FeatureNotEnabled="channel_on_before_deep_link_parsed_feature_not_enabled_error",e.NoChannelId="channel_on_before_deep_link_parsed_no_channel_id_error",e.NoThreadId="channel_on_before_deep_link_parsed_no_thread_id_error",e.InvalidDeeplinkType="channel_on_before_deep_link_parsed_invalid_deeplink_type_error",e.NoTabId="channel_on_before_deep_link_parsed_no_tab_id_error",e.MalformedContext="channel_on_before_deep_link_parsed_malformed_search_context_error"}(rce||(rce={})),function(e){e.TeamDashboard="team-dashboard",e.ChannelDashboard="channel-dashboard",e.TeamsDashboard="manage-teams"}(sce||(sce={})),function(e){e.MembersId="td.members",e.SettingsId="td.settings",e.AppsId="td.apps",e.PendingRequestsId="td.joinRequests",e.ChannelsId="td.channels",e.AnalyticsId="td.analytics",e.SharedChannelPendingRequestsId="sharedChannelPendingRequests",e.TagsId="td.tags"}(lce||(lce={}));const dce=({deeplinkUrl:e,parsedDeeplinkHash:t,preferredCommandInput:n,context:{coreSettings:i,loggerFactory:a,scenarioFactory:o}})=>{const r=a.newLogger("TeamsAndChannelsApp onBeforeDeeplinkParsed","apps-teams-and-channels"),{enablePlatformDeepLinkRouting:s}=i.get(b.J.Extensibility),{enableParseT1TeamsAndChannelsDeeplinks:l}=i.get(b.J.Channels);if(!l)throw r.errorToTelemetry?.(oce.FeatureNotEnabled,rce.FeatureNotEnabled),Error(oce.FeatureNotEnabled);let c,d,u,m,p,g,h,y,v,f={};if(t?.search){const{search:e}=t;r.log(`Parsing parsedDeeplinkHash - channelId: ${e.threadId}, replyChainId: ${e.replyChainId}, messageId: ${e.messageId}, tenantId: ${e.tenantId}, allowXTenantAccess: ${e.allowXTenantAccess}, nextGenerationChannel: ${e.nextGenerationChannel}`),c=e.threadId,d=e.replyChainId,u=e.messageId,m=e.tenantId,g=e.groupId,y=e.channelName,v=uce(e.nextGenerationChannel),h=uce(e.allowXTenantAccess)}else{const{pathname:t,search:n}=e;r.log(`Parsing deeplinkUrl - pathname: ${t}, search: ${n}`);const i=decodeURIComponent(t),a=i.split("/"),o=i?.split(/[/?&]/),s=o?.indexOf("channel");p=o?.[s+l0.ei];const l=a.findIndex((e=>e.startsWith(RX.at.SkypeSpacesThread)));c=a[l];const S=new URLSearchParams(n),k=S.get("context");f=pce(r,k),d=S.get("parentMessageId")||void 0,u=l+1<a.length&&(0,vy.kz)(a[l+1])?a[l+1]:void 0,m=S.get("tenantId")||void 0,g=S.get("groupId")||void 0,h=uce(S.get("allowXTenantAccess")||void 0),v=uce(S.get("ngc")||void 0),y=S.get("channelName")||mce(t,a,l+1)}return c?s&&p?.includes(l0.pQ)?(r.log(`toPlatformTabNavigationIntent - tabId: ${p} channelId: ${c}, deeplinkContext: ${f}, tenantId: ${m}`),(0,l0.Jj)(c,"",e,m,f,p,o)):(r.log(`toNavigationIntent - channelId: ${c}, replyChainId: ${d}, messageId: ${u}, tenantId: ${m}`),hce(c,d,u,m,g,h,y,v,n)):(r.errorToTelemetry?.(oce.NoChannelId,rce.NoChannelId),Promise.resolve(void 0))},uce=e=>"true"===e?.toLowerCase(),mce=(e,t,n)=>{if(e.startsWith(ace.channel)&&!(n>=t.length))return t[n]},pce=(e,t)=>{try{return t&&JSON.parse(t)}catch(t){return e.errorToTelemetry?.("[handleTeamsAndChannelsDeeplink] could not parse deeplink context","platform_deeplink_context_parse_error"),{}}},gce=({deeplinkUrl:e,preferredCommandInput:t,context:{loggerFactory:n}})=>{const i=n.newLogger("TeamsAndChannelsApp onBeforeDeeplinkParsed","apps-teams-and-channels"),{pathname:a}=e;i.log(`Parsing deeplinkUrl - pathname: ${a}`);const o=a.split("/"),r=o[2];let s;switch(r){case sce.TeamsDashboard:return i.log(`toNavigationTeamsDashboard - deeplinkType: ${r}`),Sce(t);case sce.TeamDashboard:case sce.ChannelDashboard:const n=o.findIndex((e=>e.startsWith(RX.at.SkypeSpacesThread))),a=o[n];if(!a)return i.errorToTelemetry?.(oce.NoThreadId,rce.NoThreadId),Promise.resolve(void 0);if(s=o[4],!s)return i.errorToTelemetry?.(oce.NoTabId,rce.NoTabId),Promise.resolve(void 0);let l;if(s===lce.TagsId){const t=e?.searchParams?.get("context");try{l=t?JSON.parse(t)?.tagId:void 0}catch(e){i.errorToTelemetry?.(oce.MalformedContext,rce.MalformedContext)}}return i.log(`toNavigationThreadDashboard - deeplinkType: ${r}, threadId: ${a}, tab: ${s}`),yce(r,a,s,t,l);default:return i.errorToTelemetry?.(oce.InvalidDeeplinkType,rce.InvalidDeeplinkType),Promise.resolve(void 0)}},hce=(e,t,n,i,a,o,r,s,l)=>Promise.resolve({entityCommand:{entity:{type:Se.py.channels,action:Se.uk.view,id:JSON.stringify({channelId:e,replyChainId:t})},command:{stateTransition:l?.stateTransition??ke.su.flush,visibilityState:l?.visibilityState??ke.fe.show},entityOptions:{deepLinkId:n,groupId:a,nextGenerationChannel:s,channelName:r}},metadata:{allowAnonymous:!1,allowXTenantAccess:o,tenantId:i}}),yce=(e,t,n,i,a)=>{const o=e===sce.TeamDashboard?vce(n):fce(n);return Promise.resolve({entityCommand:{entity:{type:o,action:Se.uk.view,id:t},command:{stateTransition:i?.stateTransition??ke.su.flush,visibilityState:i?.visibilityState??ke.fe.show},entityOptions:{tagId:a}},metadata:{allowAnonymous:!1}})},vce=e=>{switch(e){case lce.AnalyticsId:return Se.py.teamanalytics;case lce.ChannelsId:return Se.py.teamchannels;case lce.SettingsId:return Se.py.teamsettings;case lce.AppsId:return Se.py.teammanageapps;case lce.PendingRequestsId:return Se.py.teampendingrequests;case lce.TagsId:return Se.py.teammanagetags;default:return Se.py.teammanage}},fce=e=>{switch(e){case lce.AnalyticsId:return Se.py.channelanalytics;case lce.SettingsId:return Se.py.channelsettings;case lce.SharedChannelPendingRequestsId:return Se.py.channelinvitations;case lce.MembersId:return Se.py.channelmembers;case lce.TagsId:return Se.py.channeltags;default:return Se.py.channelmanage}},Sce=e=>Promise.resolve({entityCommand:{entity:{type:Se.py.sharedchannelspendinginvites,action:Se.uk.view},command:{stateTransition:e?.stateTransition??ke.su.flush,visibilityState:e?.visibilityState??ke.fe.show},entityOptions:{uniqueId:e?.correlation?.startTimestamp}},metadata:{allowAnonymous:!1}}),kce=[{filter:ace.teamDashboard,execute:gce},{filter:ace.channelDashboard,execute:gce},{filter:ace.pendingInvites,execute:gce},{filter:ace.channel,execute:dce},{filter:ace.replyChain,execute:dce},{filter:ace.team,execute:dce},{filter:(e,t)=>!!e.hash&&"channel"===t?.search?.ctx,execute:dce},{filter:ace.teamsPremiumTrial,execute:({deeplinkUrl:e,context:{coreSettings:t,loggerFactory:n}})=>{const{enableTeamsPremiumTrialDeeplink:i}=t.get(b.J.Premium),a=n.newLogger("TeamsAndChannelsApp:BeforeDeeplinkParsedCondition:teamsPremiumTrial","apps-teams-and-channels");if(!i)return a.log(`Teams Premium Trial Deeplink is not enabled, enableTeamsPremiumTrialDeeplink value is ${i}`),Promise.reject({message:"teams-premium-trial-deeplink-not-enabled"});a.log("execute command executeTeamsPremiumTrialDialogDeeplinkUrl");const o=(new URLSearchParams(e.search).get("source")??"").toLocaleLowerCase();return Promise.resolve({entityCommand:{entity:{type:Se.py.premiumtrialdialog,action:Se.uk.view},entityOptions:{entryPoint:o},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}})}},{filter:ace.teamsPremiumLicenseRequest,execute:({context:{coreSettings:e,loggerFactory:t}})=>{const{enableTeamsPremiumLicenseRequestDeeplink:n}=e.get(b.J.Premium),i=t.newLogger("TeamsAndChannelsApp:BeforeDeeplinkParsedCondition:teamsPremiumLicenseRequest","apps-teams-and-channels");return n?(i.log("execute command executeTeamsPremiumLicenseRequestDialogDeeplinkUrl"),Promise.resolve({entityCommand:{entity:{type:Se.py.licenserequestdialog,action:Se.uk.view},entityOptions:{licenseType:cce.X.TeamsPremium},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show}},metadata:{allowAnonymous:!1}})):(i.log(`Teams Premium License Request Deeplink is not enabled, enableTeamsPremiumLicenseRequestDeeplink value is ${n}`),Promise.reject({message:"teams-premium-license-request-deeplink-not-enabled"}))}}],Cce={shouldAddEntitiesToWindowHistory:()=>!0,shouldRestoreClientToEntities:()=>!0,shouldStoreLastVisitedInAppHistory:e=>{if(e?.type===Se.py.schoolteams)return!0;if(e?.type===Se.py.discoversurface)return!0;if(e?.type!==Se.py.channels)return!1;const{replyChainId:t}=(0,Q1.jd)(e?.id||"");return!t}},bce={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsChannelAccessByIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelAccessByID"},arguments:[{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"canAccess"}},{kind:"Field",name:{kind:"Name",value:"errorType"}}]}}]}}]},wce={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsChannelInfoByIdQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"groupId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"channelThreadId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelJoinInfo"},arguments:[{kind:"Argument",name:{kind:"Name",value:"groupId"},value:{kind:"Variable",name:{kind:"Name",value:"groupId"}}},{kind:"Argument",name:{kind:"Name",value:"channelThreadId"},value:{kind:"Variable",name:{kind:"Name",value:"channelThreadId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"team"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"Field",name:{kind:"Name",value:"membershipSummary"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"memberCount"}}]}},{kind:"Field",name:{kind:"Name",value:"channelType"}},{kind:"Field",name:{kind:"Name",value:"description"}}]}}]}}]},Tce=async e=>{const{entityCommand:t,entityCommand:{entity:n,entityOptions:i},requestContext:{client:a,coreSettings:o,loggerFactory:r}}=e,{enableTeamJoinDialog:s}=o.get(b.J.TeamsAndChannels),l=r.newLogger("TeamsAndChannels CallingOnBeforeCommandHandled","apps-teams-and-channels");if(s&&Mce(t.command.correlation.source)){let e;try{e=JSON.parse(n?.id||"{}")}catch{e={}}const{channelId:r,replyChainId:s}=e,c=i,d=c?.groupId,u=c?.nextGenerationChannel||!1,m=c?.channelName,p=Pce(t?.metadata?.deepLink);if(r)try{const{data:e,error:n}=await a.query({query:bce,fetchPolicy:"network-only",nextFetchPolicy:"cache-first",variables:{conversationId:r}});if(n)return Dce(l,`Error getting channel join information for ${r}`),Promise.resolve(Ace(t,d,r,s,void 0,!0));if(e&&"ChannelDeleted"===e.channelAccessByID.errorType)return Dce(l,`Channel ${r} has been deleted.`),Promise.resolve(Fce(t,sa.pm.ChannelDeleted,m));if(e&&!e.channelAccessByID.canAccess){const{enableChannelJoinDialog:e}=o.get(b.J.TeamsAndChannels);return Ece(a,l,!!e,u,t,d,r,s,p,m)}}catch(e){return Dce(l,`Error getting channel join information for ${r}`),Promise.resolve(Ace(t,d,r,s,p,!0))}}if(!(t.entityOptions&&t.entityOptions.isViewFromSimpleCollab||!1)){const e=await FX(a,o),n=e!==AX.JP.none,{enablePopoutAction:i}=o.get(b.J.ChatList);if(Ice(t,n)){return{...t,entity:{...t.entity,linkedEntity:{...t.entity.linkedEntity,id:t.entity.linkedEntity?.id||"",type:e===AX.JP.split?Se.py.simplecollabchannels:Se.py.simplecollab}}}}if(Nce(t,n,i)){return{...t,entity:{...t.entity,type:e===AX.JP.split?Se.py.simplecollabchannels:Se.py.simplecollab}}}}return t},Ice=(e,t)=>{if(!t||!e.entity.linkedEntity)return!1;const n=[Se.py.channelmanage,Se.py.channelmembers,Se.py.teammanage,Se.py.teamchannels];return["flush"].includes(e.command.stateTransition)&&n.includes(e.entity.type)&&e.entity.linkedEntity.type===Se.py.channels&&e.entity.linkedEntity.action===Se.uk.list},Nce=(e,t,n)=>{const i=["flow","none","extend"];return n&&i.push("new"),!(e.entity.type===Se.py.simplecollab||!t||i.includes(e.command.stateTransition)||e.entity.linkedEntity&&e.entity.linkedEntity?.type===Se.py.simplecollab)},Ece=async(e,t,n,i,a,o,r,s,l,c)=>{if(i){if(n)try{const{data:t}=await e.query({query:wce,fetchPolicy:"network-only",variables:{groupId:o,channelThreadId:r}});if(o&&r&&t&&"Shared"===t.channelJoinInfo?.channelType){const e=t.channelJoinInfo;return _ce(a,o,r,e.displayName,e?.team?.displayName,e.description||void 0,e.channelType||void 0,e?.membershipSummary?.memberCount,l)}}catch(e){Dce(t,`Error getting channel info for ${r}`)}return Fce(a,sa.pm.NoAccessToChannel,c)}return Ace(a,o,r,s,l,!1)},Ace=(e,t,n,i,a,o)=>({...e,entity:{type:Se.py.teamjoindialog,action:Se.uk.view},command:{stateTransition:"extend",visibilityState:ke.fe.show,correlation:e.command.correlation},entityOptions:{groupId:t,channelId:n,messageId:i,linkType:a,isError:o}}),_ce=(e,t,n,i,a,o,r,s,l)=>({...e,entity:{type:Se.py.channeljoindialog,action:Se.uk.view},command:{stateTransition:"extend",visibilityState:ke.fe.show,correlation:e.command.correlation},entityOptions:{groupId:t,channelId:n,channelName:i,teamName:a,channelDescription:o,channelType:r,memberCount:s,linkType:l}}),Fce=(e,t,n)=>({...e,entity:{type:Se.py.defaultchannelnavdialog,action:Se.uk.view},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:e.command.correlation},entityOptions:{error:t,channelName:n}}),Dce=(e,t)=>{e?.errorToTelemetry&&e.errorToTelemetry(t,"teams_and_channels_on_before_command_handled_error",void 0,!0)},Pce=e=>{const t=e?.match(/\/(team|channel|message)\//i);return t&&t.length>1?t[1]:void 0},Mce=e=>{switch(e){case C.D.AuthApp:case C.D.ExternalCommand:case C.D.InternalDeeplink:return!0;default:return!1}},xce=e=>{if(Rce(e))return jce(e)?{subNavEntity:Oce(e),headerEntity:Hce(e),startEntity:Vce(e),mainEntity:Gce(e),endEntity:Jce(e)}:null},Rce=({layoutMode:e,contextEntity:t,entity:n})=>{const{action:i=null,type:a}={...n},{type:o,action:r}=t||{},s=[ke.lO.standard,ke.lO.focus].includes(e),l=[Se.py.acceptsharedchannelinvitationdialog,Se.py.archiveteam,Se.py.archivechannel,Se.py.callablechannels,Se.py.channelapps,Se.py.channelanalytics,Se.py.channelcalendar,Se.py.channelconnectors,Se.py.channelcopilot,Se.py.channelworkflows,Se.py.channelemailerror,Se.py.channelemailv2,Se.py.channeljoindialog,Se.py.channelmanage,Se.py.channelmembers,Se.py.channels,Se.py.channelsPinnedPost,Se.py.channelsSystemMessage,Se.py.channelsettings,Se.py.channelinvitations,Se.py.channeltags,Se.py.channelcontextualsearch,Se.py.createchanneldialog,Se.py.crosspostchannelselectiondialog,Se.py.crosspostchannelselectiondialogV2,Se.py.deleteteam,Se.py.filesoneupviewer,Se.py.removechannelemail,Se.py.restoreteam,Se.py.schoolteams,Se.py.sharedchanneldenyinvitation,Se.py.sharedchanneldeclinejoinrequestdialog,Se.py.sharewithteamyouowndialog,Se.py.sharedchannelcreateinvitationsdialog,Se.py.sharedchannelspendinginvites,Se.py.showformemberdialogv2,Se.py.staleteamsdialog,Se.py.staleteamsdismiss,Se.py.leaveteam,Se.py.crossteamanalytics,Se.py.teamslist,Se.py.teamanalytics,Se.py.teamchannels,Se.py.teamjoindialog,Se.py.teamdiscover,Se.py.teammanage,Se.py.teammanageapps,Se.py.teammanagetags,Se.py.teampendingrequests,Se.py.teamserrordialog,Se.py.teamsettings,Se.py.useronboardingteam,Se.py.changeteampicture,Se.py.wiki,Se.py.channelextensibilityapppickersidepanel,Se.py.appenabledialog].includes(a),c=[Se.uk.create,Se.uk.default,Se.uk.info,Se.uk.list,Se.uk.view],d=i&&c.includes(i),u=[Se.py.extensions,Se.py.guardians,Se.py.channelcalendar,Se.py.callablechannels,Se.py.filesoneupviewer,Se.py.wiki],m=o&&u.includes(o),p=[Se.uk.view,Se.uk.list],g=r&&p.includes(r);return!(!s||!l||!d&&!(g&&m))},jce=()=>!0,Lce=e=>({action:Se.uk.list,type:Se.py.schoolteams,entityState:{flushableByLinkedEntity:!0},id:null,linkedEntity:null,options:e.options,windowOptions:null}),Oce=({layoutMode:e,entity:t,coreSettings:n,userPreferences:i,contextEntity:a})=>{if(e===ke.lO.focus)return null;if(t.type===Se.py.teams&&t.action===Se.uk.create)return t;if(t.type===Se.py.schoolteams&&(t.action===Se.uk.list||t.action===Se.uk.join))return null;if(!n?.get(b.J.Host)?.msgEnableChannelsV2)return null;const o=$ce(t,a);if(kae({coreSettings:n,userPreferences:i})||n?.get(b.J.Host)?.isGridNavigationLayoutActive){if(t.action===Se.uk.default)return null;const e=[Se.py.teamslist,Se.py.sharedchannelspendinginvites,Se.py.crossteamanalytics];if(a&&e.includes(a.type)&&a.action===Se.uk.view)return null;const n=Wce(a)??Wce(t)??o,i=Bce(a)??Bce(t),r=i&&i!==n?(0,$.u4)({teamId:i,channelId:n}):n;return{action:Se.uk.view,type:Se.py.schoolteams,entityState:{flushableByLinkedEntity:!0},id:r,linkedEntity:null,options:t.options,windowOptions:null}}return{action:Se.uk.list,entityState:{flushableByLinkedEntity:!0},id:o,linkedEntity:null,options:t.options,type:Se.py.channels,windowOptions:null}},$ce=(e,t)=>{if(t&&t.action===Se.uk.view)switch(t.type){case Se.py.channelmanage:case Se.py.teammanage:case Se.py.teammanageapps:case Se.py.teamsettings:case Se.py.teamanalytics:case Se.py.teampendingrequests:case Se.py.teamchannels:case Se.py.channelapps:case Se.py.channelmembers:case Se.py.channelsettings:case Se.py.channelanalytics:case Se.py.channeltags:case Se.py.teamslist:case Se.py.crossteamanalytics:case Se.py.sharedchannelspendinginvites:case Se.py.extensions:return e.id;case Se.py.teammanagetags:return e.id?.trim()?e.id:sessionStorage.manageTagsTargetThreadId}const n=e.type===Se.py.channels&&e.action===Se.uk.view?e.id:null;if(!n)return null;const{channelId:i}=(0,Q1.jd)(n);return i},Uce=[Se.py.teamanalytics,Se.py.teammanage,Se.py.teammanagetags,Se.py.teammanageapps,Se.py.teampendingrequests,Se.py.teamsettings,Se.py.teamchannels],Bce=e=>{if(!e)return;if(Uce.includes(e.type))return e.id;if(e.hasOwnProperty("options")&&null!==e.options){return JSON.parse(e.options).parentTeamId}},Wce=e=>{if(e&&e.id)try{const{channelId:t}=(0,Q1.jd)(e.id);return t}catch{return}},Hce=({contextEntity:e,entity:t,coreSettings:n,userPreferences:i})=>{if(e&&e.action===Se.uk.view)switch(e.type){case Se.py.channelmanage:case Se.py.teammanage:case Se.py.teammanagetags:case Se.py.teammanageapps:case Se.py.teamsettings:case Se.py.teamanalytics:case Se.py.teampendingrequests:case Se.py.teamchannels:case Se.py.channelapps:case Se.py.channelmembers:case Se.py.channelsettings:case Se.py.channelanalytics:case Se.py.channeltags:case Se.py.teamslist:case Se.py.crossteamanalytics:case Se.py.sharedchannelspendinginvites:case Se.py.useronboardingteam:return e}if(e&&t.type===Se.py.schoolteams){const t=[Se.py.guardians];return e.type&&t.includes(e.type)?{...e,action:Se.uk.view,type:Se.py.extensions}:e}const a=e?.options&&(0,am.D)(e.options);if(e?.type===Se.py.extensions&&e.action===Se.uk.view&&a?.source===C.D.PlatformTabDeepLink&&a?.isAppTeamLevelApp&&kae({coreSettings:n,userPreferences:i}))return e;if(t.type===Se.py.channels&&t.action===Se.uk.default&&kae({coreSettings:n,userPreferences:i}))return Lce(t);if(t.type===Se.py.useronboardingteam){if((e=>e.hasOwnProperty("options"))(t)&&null!==t.options){if((t?.options&&(0,am.D)(t.options)).hideSlotHeader)return null}}return t},Vce=()=>null,Gce=({contextEntity:e,entity:t,coreSettings:n,userPreferences:i})=>{const a=[Se.py.archiveteam,Se.py.archivechannel,Se.py.deleteteam,Se.py.leaveteam,Se.py.restoreteam,Se.py.extensions,Se.py.guardians,Se.py.callablechannels,Se.py.channelcalendar,Se.py.channelconnectors,Se.py.channelworkflows,Se.py.filesoneupviewer,Se.py.wiki,Se.py.teammanage,Se.py.teammanagetags,Se.py.teammanageapps,Se.py.teamsettings,Se.py.teamanalytics,Se.py.teampendingrequests,Se.py.teamchannels,Se.py.channelemailv2,Se.py.sharewithteamyouowndialog,Se.py.changeteampicture,Se.py.channelapps,Se.py.channelmembers,Se.py.channelmanage,Se.py.channelsettings,Se.py.channeltags,Se.py.channelanalytics,Se.py.removechannelemail,Se.py.teamslist,Se.py.teamserrordialog,Se.py.crossteamanalytics,Se.py.sharedchannelspendinginvites,Se.py.unarchivechannel,Se.py.useronboardingteam];return e?.type&&a.includes(e.type)?e:t.type===Se.py.channels&&t.action===Se.uk.view?n?.get(b.J.Host)?.msgEnableChannelsV2?t:null:t.type===Se.py.channels&&t.action===Se.uk.default&&kae({coreSettings:n,userPreferences:i})?Lce(t):t},zce=[Se.py.channels,Se.py.channelcopilot,Se.py.channelcontextualsearch,Se.py.channelsPinnedPost,Se.py.channelsSystemMessage,Se.py.channelextensibilityapppickersidepanel],qce=["standard","focus"],Jce=({entity:e,contextEntity:t,coreSettings:n,layoutMode:i,userPreferences:a})=>{const o=t?.id||e.id,{channelId:r,replyChainId:s}=(0,Q1.Mt)(o??""),l=t?.type||e.type,c=t?.options??e.options,d=JSON.parse(c??"{}"),u=a?.infoPane?.channels?"closed"===a.infoPane.channels:!!n?.get(b.J.Channels)?.disableChannelInfoPaneOpenByDefault;if(!((e,t,n,i,a,o,r)=>{const{enableChannelInfoPaneSearch:s,enableChannelInfoPane:l=!1,enableChannelCopilotInL2Header:c=!1}=i?.get(b.J.Channels)??{},{enableInfoPaneAsResponsiveMenu:d=!1}=i?.get(b.J.Core)??{},{enableExtensibilityAppPicker:u}=i?.get(b.J.Extensibility)||{};return!(!(e&&qce.includes(a)&&zce.includes(t))||(!s||r!==C.D.ChannelContextualSearch&&n?.type!==Se.py.channelcontextualsearch)&&(!c||n?.type!==Se.py.channelcopilot)&&(!u||n?.type!==Se.py.channelextensibilityapppickersidepanel)&&(o||!l||!d))})(o,l,t,n,i,u,d.source)&&!d.channelCopilotOpen)return null;const{enableChannelInfoPaneSearch:m}=n?.get(b.J.Channels)??{};if(d.source===C.D.ChannelContextualSearch)return{id:o,action:Se.uk.info,type:Se.py.channelcontextualsearch};if(t?.type===Se.py.channelcopilot||d.channelCopilotOpen)return{id:o,action:Se.uk.info,type:Se.py.channelcopilot};if(t?.type===Se.py.channelextensibilityapppickersidepanel)return{id:o,action:Se.uk.info,type:Se.py.channelextensibilityapppickersidepanel};if(s&&(!m||t?.type!==Se.py.channelcontextualsearch))return null;if(t){const{action:e,type:n}=t;if(e===Se.uk.info&&Qce(n,!!m))return t;if(n!==Se.py.channels)return null}return{id:(0,$.u4)({channelId:r}),action:Se.uk.info,type:Se.py.channels}},Qce=(e,t)=>{switch(e){case Se.py.channelsPinnedPost:case Se.py.channelsSystemMessage:return!0;case Se.py.channelcontextualsearch:return t;default:return!1}},Kce=({areEmptySlotsTransparent:e,coreSettings:t,entity:n})=>({endEntity:{[Mt.S.Rail]:{isHideInfoPaneDisabled:n?.type===Se.py.channelcontextualsearch}},mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!!t?.get(b.J.Channels).enableMicaBackgroundForChannelPane||e}},headerEntity:{[Mt.S.HorizontalBar]:{isBackgroundTransparent:!!t?.get(b.J.Channels).enableMicaBackgroundForChannelPane||e,isColorSchemeDefaultBackground4:!e}},subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e}}}),Yce=(e,t,n)=>{const{userPreferences:i,coreSettings:a,layoutMode:o}=t;if(!n)return;const r=n.mainEntity;if(r&&"options"in r&&r.options&&r.id)try{const e=JSON.parse(r.options),{channelId:t,replyChainId:n}=(0,Q1.jd)(r.id);if(e&&n&&t&&e.source===C.D.ChannelPostMessage)return xce({contextEntity:null,coreSettings:a,entity:{id:t,type:Se.py.channels,action:Se.uk.view,options:JSON.stringify({deepLinkId:n,source:C.D.ChannelL2NavigateViaHistory})},layoutMode:o,userPreferences:i})}catch{return}},Xce=[Se.py.teammanage,Se.py.teamchannels,Se.py.teampendingrequests,Se.py.teammanagetags],Zce=[Se.py.channelapps,Se.py.channelmanage,Se.py.channelmembers,Se.py.channelinvitations],ede=[Se.py.sharedchannelspendinginvites],tde=({action:e,appRenderMode:t,coreSettings:n,type:i,logger:a})=>{const o=new MV.H,{enableComposeCriticalPhaseLoad:r=!1,enableComposeCriticalPhaseLoadForPopout:s=!1,enableComposeCriticalPhaseLoadSecondaryViewport:l=!1,enableComposeCriticalPhaseLoadSecondaryViewportGate:c=!1}=n.get(b.J.Messaging),{enableHybridChannelList:d=!1,msgEnableChannelsV2:u=!1,msgEnableChannelsV2Header:m=!1}=n.get(b.J.Host),{channelPhaseTimeoutSettings:p}=n.get(b.J.TeamsAndChannels),g=[],h=[];switch(t){case Mt.S.HorizontalBar:nde({action:e,type:i,logger:a,criticalSignals:g,featureFlags:{msgEnableChannelsV2Header:m,msgEnableChannelsV2:u},postCriticalSignals:h});break;case Mt.S.Main:ide({action:e,type:i,logger:a,criticalSignals:g,featureFlags:{enableComposeCriticalPhaseLoad:r,enableComposeCriticalPhaseLoadForPopout:s,enableComposeCriticalPhaseLoadSecondaryViewport:l,enableComposeCriticalPhaseLoadSecondaryViewportGate:c,msgEnableChannelsV2:u},postCriticalSignals:h});break;case Mt.S.Rail:ade({action:e,criticalSignals:g,featureFlags:{enableHybridChannelList:d},postCriticalSignals:h,type:i})}return o.registerAppPhase({phase:yt.nh.CRITICAL,signals:g,timeout:p?.critical||25e3}),o.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:h,timeout:p?.postCritical||1e4}),o.appPhases},nde=({action:e,criticalSignals:t,featureFlags:{msgEnableChannelsV2Header:n,msgEnableChannelsV2:i},type:a,logger:o})=>{a===Se.py.schoolteams&&e===Se.uk.list?t.push(xV.G.TEAMS_GRID_VIEW_HEADER_RENDERED):i&&n&&a===Se.py.channels&&(e===Se.uk.default||e===Se.uk.view)?t.push(xV.G.CHANNEL_HEADER_RENDERED):a&&Xce.includes(a)?t.push(xV.G.TEAM_DASHBOARD_HEADER_RENDERED):a&&Zce.includes(a)?t.push(xV.G.CHANNEL_DASHBOARD_HEADER_RENDERED):a&&ede.includes(a)?t.push(xV.G.TEAMS_DASHBOARD_HEADER_RENDERED):a===Se.py.useronboardingteam?t.push(xV.G.USER_ONBOARDING_HEADER_RENDERED):o?.log(`Not adding header slot phase signals for action: ${e}, type: ${a}, msgEnableChannelsV2: ${i}, msgEnableChannelsV2Header: ${n}`)},ide=({action:e,criticalSignals:t,featureFlags:{enableComposeCriticalPhaseLoad:n,enableComposeCriticalPhaseLoadForPopout:i,enableComposeCriticalPhaseLoadSecondaryViewport:a,enableComposeCriticalPhaseLoadSecondaryViewportGate:o,msgEnableChannelsV2:r},postCriticalSignals:s,type:l,logger:c})=>{if(l===Se.py.schoolteams&&e===Se.uk.list)t.push(xV.G.TEAMS_GRID_VIEW_RENDERED);else if(!r||l!==Se.py.channels||e!==Se.uk.default&&e!==Se.uk.view)l&&Xce.includes(l)?t.push(xV.G.TEAM_DASHBOARD_VIEW_RENDERED):l&&Zce.includes(l)?t.push(xV.G.CHANNEL_DASHBOARD_VIEW_RENDERED):l&&ede.includes(l)?t.push(xV.G.TEAMS_DASHBOARD_VIEW_RENDERED):l===Se.py.useronboardingteam?t.push(xV.G.USER_ONBOARDING_TO_TEAM_VIEW_RENDERED):c?.log(`Not adding main slot phase signals for action: ${e}, type: ${l}, msgEnableChannelsV2: ${r}`);else{t.push(xV.G.MESSAGES_RENDERED);n||i&&o&&a?t.push(xV.G.COMPOSE_LOADED):s.push(xV.G.COMPOSE_LOADED),s.push(xV.G.MESSAGE_REACTIONS_RENDERED,xV.G.PRESENCES_RENDERED,xV.G.VIRTUAL_LIST_RENDER_BUFFER_FILLED)}},ade=({action:e,criticalSignals:t,featureFlags:{enableHybridChannelList:n},type:i})=>{i===Se.py.channels&&e===Se.uk.list?n&&t.push(xV.G.CHANNEL_LIST_ITEMS_RENDERED):i===Se.py.schoolteams&&e===Se.uk.view&&t.push(xV.G.SINGLE_TEAM_VIEW_LEFT_RAIL_LOADED)},ode={id:ose.Hm,name:"TeamsAndChannelsApp",getLocalizedName:async e=>(await e.waitForNamespace("teamsAndChannels"),e.stringTranslate("teamsAndChannels","teams_and_channels_app_name")),actors:[f$],supportedEntities:[Se.py.acceptsharedchannelinvitationdialog,Se.py.addmembertoprivatechanneldialog,Se.py.addmembertoteamdialog,Se.py.archiveteam,Se.py.archivechannel,Se.py.channelapps,Se.py.channelanalytics,Se.py.channelconnectors,Se.py.channelcopilot,Se.py.channelworkflows,Se.py.channelemailerror,Se.py.channelemailv2,Se.py.channelmanage,Se.py.channelmembers,Se.py.channels,Se.py.channelsPinnedPost,Se.py.channelsSystemMessage,Se.py.channelcontextualsearch,Se.py.channelsettings,Se.py.channelinvitations,Se.py.channeltags,Se.py.channeljoindialog,Se.py.connectorinstanceconfiguration,Se.py.createchanneldialog,Se.py.createchannelleftraildialog,Se.py.crosspostchannelselectiondialog,Se.py.crosspostchannelselectiondialogV2,Se.py.crosspostdeletedialog,Se.py.defaultchannelnavdialog,Se.py.deletechannelreactdialog,Se.py.deleteteam,Se.py.leaveteam,Se.py.showhidegeneralchannelwarningdialog,Se.py.restoreteam,Se.py.leavechanneldialog,Se.py.leavechannellastownerdialog,Se.py.pinunpinpost,Se.py.getlinktoteamorchanneldialog,Se.py.removechannelemail,Se.py.restorechannelreactdialog,Se.py.schoolteams,Se.py.sharedchanneldenyinvitation,Se.py.sharedchanneldeclinejoinrequestdialog,Se.py.sharewithteamyouowndialog,Se.py.sharedchannelcreateinvitationsdialog,Se.py.sharedchannelspendinginvites,Se.py.sharechannelwithuserdialog,Se.py.showformemberdialogv2,Se.py.stopsharingchannelwithteamreactdialog,Se.py.showchannelownersreactdialog,Se.py.crossteamanalytics,Se.py.teamchannels,Se.py.teamcreatedialog,Se.py.teamdiscover,Se.py.teamjoindialog,Se.py.teammanage,Se.py.teammanageapps,Se.py.teammanagetags,Se.py.teampendingrequests,Se.py.teamserrordialog,Se.py.teamsettings,Se.py.changeteampicture,Se.py.teamanalytics,Se.py.teamslist,Se.py.channelnotificationsettings,Se.py.stalechannelsadhocdialog,Se.py.staleteamsdialog,Se.py.staleteamsdismiss,Se.py.unarchivechannel,Se.py.useronboardingteam,Se.py.channelextensibilityapppickersidepanel,Se.py.appenabledialog],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Rail,Mt.S.Modal],getDefaultCommand:e=>{const{enableHybridChannelList:t,msgEnableChannelsV2:n}=e.get(b.J.Host);if(t&&n)return{type:Se.py.channels,action:Se.uk.default}},windowFeatures:{minWidth:602,width:602,minHeight:500,height:500,offset:20,widthToScreenWidthRatio:.3,heightToWidthRatio:1.125},infoPaneStateMapping:{[Se.py.channelsSystemMessage]:Se.py.channels,[Se.py.channelsPinnedPost]:Se.py.channels},getAllowUserWindowingPreference:({coreSettings:e})=>!!e.get(b.J.Channels).enableChannelDeeplinkWindowUserPreference},rde={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"channelToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attributionText"}},{kind:"Field",name:{kind:"Name",value:"channelName"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"discardDuringMeetingsAndCalls"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"reaction"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderGivenName"}},{kind:"Field",name:{kind:"Name",value:"senderMri"}},{kind:"Field",name:{kind:"Name",value:"subtype"}},{kind:"Field",name:{kind:"Name",value:"teamName"}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"replyChainId"}},{kind:"Field",name:{kind:"Name",value:"tagName"}}]}}]}}]};var sde,lde;!function(e){e.Follow="Follow",e.Mention="Mention",e.Reaction="Reaction",e.Reply="Reply",e.ReplyToReply="ReplyToReply",e.TeamMembershipChange="TeamMembershipChange",e.DLP="DLP"}(sde||(sde={})),function(e){e.Person="Person",e.Team="Team",e.AddedToSharedChannel="AddedToSharedChannel",e.TeamShareTeamOwnerNotify="TeamShareTeamOwnerNotify",e.PromotedToSharedChannelOwner="PromotedToSharedChannelOwner",e.ChannelOwnerUnshareTeamOwnerNotify="ChannelOwnerUnshareTeamOwnerNotify",e.TeamOwnerUnshareChannelOwnerNotify="TeamOwnerUnshareChannelOwnerNotify",e.NotifySender="NotifySender",e.Tag="Tag",e.ChannelNewMessage="ChannelNewMessage",e.ChannelReplyMessage="ChannelReplyMessage"}(lde||(lde={}));const cde="toastNotifications",dde={channelPost:"new_channel_post_toast_header",channelNewMessage:"channel_new_message_toast_header",channelReplyMessage:"channel_reply_message_toast_header",reaction:"channel_reaction_toast_header",reply:"channel_reply_toast_header",replyToReply:"channel_reply_to_reply_toast_header",mentionTeam:"channel_mention_team_toast_header",mentionPerson:"channel_mention_person_toast_header",mentionTag:"channel_mention_tag_toast_header",addedToSharedChannel:"shared_channel_shared_with_a_user_header",channelOwnerUnshareTeamOwnerNotify:"shared_channel_sharing_stopped_by_owner_header",teamShareTeamOwnerNotify:"shared_channel_shared_with_a_team_header",teamOwnerUnshareChannelOwnerNotify:"shared_channel_sharing_stopped_by_team_owner_header",promotedToSharedChannelOwner:"shared_channel_role_promotion_header",dlpNotifySender:"dlp_notify_sender_header"},ude={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsMsaUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]},mde={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}}]}]}}]};async function pde(e,t,n,i){try{const a=await async function(e,t,n){const{data:i}=await e.query({query:ude,variables:{userId:t,displayName:n,profilePictureSize:U3.$D.Small}});return i.msaUserProfilePicture}(e,n,i);if(!a)return void t.error(li.f.ImageUrlGenerationFailed);const o=await e.query({query:mde,variables:{url:a}});return o?.data.toastImageAsDataUri||void 0}catch(e){return void t.error(li.f.ImageFetchFailed)}}const gde={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"categoryId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"searchEmoticons"},arguments:[{kind:"Argument",name:{kind:"Name",value:"searchFilter"},value:{kind:"Variable",name:{kind:"Name",value:"searchFilter"}}},{kind:"Argument",name:{kind:"Name",value:"exactMatch"},value:{kind:"Variable",name:{kind:"Name",value:"exactMatch"}}},{kind:"Argument",name:{kind:"Name",value:"includeShortCuts"},value:{kind:"Variable",name:{kind:"Name",value:"includeShortCuts"}}},{kind:"Argument",name:{kind:"Name",value:"includeKeywords"},value:{kind:"Variable",name:{kind:"Name",value:"includeKeywords"}}},{kind:"Argument",name:{kind:"Name",value:"maxResultCount"},value:{kind:"Variable",name:{kind:"Name",value:"maxResultCount"}}},{kind:"Argument",name:{kind:"Name",value:"categoryId"},value:{kind:"Variable",name:{kind:"Name",value:"categoryId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Emoticon"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"description"}},{kind:"Field",name:{kind:"Name",value:"unicode"}},{kind:"Field",name:{kind:"Name",value:"animation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment_animation"}}]}},{kind:"Field",name:{kind:"Name",value:"etag"}},{kind:"Field",name:{kind:"Name",value:"diverse"}},{kind:"Field",name:{kind:"Name",value:"shortcuts"}},{kind:"Field",name:{kind:"Name",value:"searchMatch"}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"AppsTeamsAndChannelsToastEmoticonFragment_animation"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"EmoticonAnimation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fps"}},{kind:"Field",name:{kind:"Name",value:"framesCount"}},{kind:"Field",name:{kind:"Name",value:"firstFrame"}}]}}]}.definitions]}.definitions]};async function hde({reaction:e,channelName:t,teamName:n,type:i,subtype:a,senderDisplayName:o,senderGivenName:r,tagName:s},l,c,d){const u=o||r;if(!u&&i!==sde.DLP)return"";if(i===sde.Mention&&!a)return"";if(i===sde.Reaction&&!e)return"";const m={channelName:t,senderDisplayName:u,teamName:n,tagName:s};switch(i){case sde.Follow:return a===lde.ChannelNewMessage?yde(dde.channelNewMessage,m,l):a===lde.ChannelReplyMessage?yde(dde.channelReplyMessage,m,l):yde(dde.channelPost,m,l);case sde.Reply:return yde(dde.reply,m,l);case sde.ReplyToReply:return yde(dde.replyToReply,m,l);case sde.Mention:return a===lde.Tag?yde(dde.mentionTag,m,l):a===lde.Person?yde(dde.mentionPerson,m,l):yde(dde.mentionTeam,m,l);case sde.Reaction:const t=await async function(e,t,n){try{const{id:t}=(0,gZ.Mc)(n?.toLocaleLowerCase().trim());if(!t)return;const{data:i}=await e.query({query:gde,variables:{searchFilter:t,exactMatch:!0}});return(i?.searchEmoticons||[])[0]}catch(e){return void t.error(li.f.ChannelToastEmoticonsQueryFailed)}}(c,d,e),n=t?.unicode||void 0;return yde(dde.reaction,{...m,emoji:n},l);case sde.TeamMembershipChange:return function(e,t,n){switch(e){case lde.AddedToSharedChannel:return yde(dde.addedToSharedChannel,t,n);case lde.ChannelOwnerUnshareTeamOwnerNotify:return yde(dde.channelOwnerUnshareTeamOwnerNotify,t,n);case lde.PromotedToSharedChannelOwner:return yde(dde.promotedToSharedChannelOwner,t,n);case lde.TeamOwnerUnshareChannelOwnerNotify:return yde(dde.teamOwnerUnshareChannelOwnerNotify,t,n);case lde.TeamShareTeamOwnerNotify:return yde(dde.teamShareTeamOwnerNotify,t,n);default:return""}}(a,m,l);case sde.DLP:return yde(dde.dlpNotifySender,m,l);default:return""}}function yde(e,{emoji:t,channelName:n,teamName:i,senderDisplayName:a,tagName:o},r){return r.stringTranslate(cde,e,{channelName:n,emoji:t,senderDisplayName:a,teamName:i,tagName:o})}async function vde(e,t,n,i){const{conversationId:a,messageId:o,startTimestamp:r,replyChainId:s,teamName:l,channelName:c,senderMri:d,senderDisplayName:u,text:m}=e,p=e.type===sde.DLP?pZ.Uw:await pde(n,i,d,u||""),g=await hde(e,t,n,i),h=m||function(e,t,n,i){switch(e.subtype){case lde.ChannelOwnerUnshareTeamOwnerNotify:return i.stringTranslate("toastNotifications","shared_channel_owner_unshare_team_owner_notify_text",{teamName:t});case lde.TeamOwnerUnshareChannelOwnerNotify:return i.stringTranslate("toastNotifications","shared_channel_team_owner_unshare_channel_owner_notify_text",{channelName:n});case lde.NotifySender:return i.stringTranslate("toastNotifications","dlp_notification_notify_sender_text",{teamName:t,channelName:n});default:return i.stringTranslate("toastNotifications","channel_toasts_text",{teamName:t,channelName:n})}}(e,l,c,t);return{conversationId:a,quickReply:!1,discardDuringMeetingsAndCalls:!!e.discardDuringMeetingsAndCalls,messageId:o,time:new Date(+r),replyChainId:s||"",text:h,title:g,mainImage:p?{alt:"",src:p}:void 0}}function fde(e,t){const n=e.newScenario(H.RG.CrossClientToastView);n.appendEventData({mainEntityType:Se.py.channels}),n.fail(t)}function Sde(e,t,n,i,a,o,r,s){const{enableCommandToHostCommService:l}=t.get(b.J.Core,["enableCommandToHostCommService"]),{enableChannelsNotifications:c,enableBrowserToasts:d,enableInAppNotifications:u,enableInAppNotificationsForChatsAndChannels:m}=t.get(b.J.Notifications,["enableChannelsNotifications","enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"channel-toast-event-subscription",runOncePerId:!0,job:async()=>{const p=i.newLogger("ChannelToastEventSubscription","apps-teams-and-channels");l||d||u&&m?c?(p.log(`${li.f.Subscribing}: subscribing to channel toasts resolver`),n.subscribe({query:rde,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a,o,r,s){const{enableToastCollections:l}=t.get(b.J.Notifications);return async t=>{if(t.errors){const e=(0,$.u4)(t.errors.map((e=>e.message)).join());return n.error(`${li.f.SubscriptionFailed} ${e}`),void fde(i,{errorCode:li.f.SubscriptionFailed,errors:e})}const c=t.data?.channelToastEvent;if(!c)return n.error(li.f.EmptyEvent),void fde(i,{errorCode:li.f.EmptyEvent});const d=i.newScenario(H.RG.CrossClientToastView,{startTime:+c.startTimestamp});d.clientId=c.correlationId,d.appendEventData({mainEntityType:Se.py.channels,mainEntitySubtype:c.type});const u=await vde(c,a,r,n);if(!u.title)return n.error(`${li.f.UnhandledType}: Dropping channel toast with type ${c.type}`),void d.incomplete({reason:li.f.UnhandledType});l&&(u.collectionId=HJ(e,s,n)),i.hoistScenarioToCore?.(d),o.toasts.showChannelsNotification(c.correlationId,u),d.mark(H.ck.CrossClientEntityCommandTriggered),n.log(`${li.f.ToastCommandSent} type:${c.type} correlationId:${c.correlationId}`)}}(e,t,p,a,o,r,n,s))):p.log(`${li.f.NotEnabled}: channel notifications are off`):p.log(li.f.NotEnabled)}}}const kde=({context:{authenticationUser:e,client:t,coreSettings:n,loggerFactory:i,scenarioFactory:a,i18n:o,entityCommanding:r,userTrackingService:s}})=>[Sde(e,n,t,i,a,o,r,s)],Cde=async({commandInput:e,requestContext:{clientPreferences:t,coreSettings:n,executionContext:i,loggerFactory:a}})=>{const{command:{action:o,data:r}}=e,s=a.newLogger("TeamsAndChannelsApp onCommandReceived","apps-teams-and-channels");if(e.command.actor===f$)switch(o){case S$:return i.isHandlingAppActiveApp&&kae({coreSettings:n,userPreferences:t})?{entity:{type:Se.py.schoolteams,action:Se.uk.list},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.SchoolTeams}}}:{entity:{type:Se.py.channels,action:Se.uk.default},command:{visibilityState:ke.fe.show,stateTransition:ke.su.flush,correlation:{source:C.D.Unknown}}};case k$:{const{channelId:e,teamId:t,commandSource:n,back:i,isHidden:a}=r;return{command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:n||C.D.UserOnboardingTeam}},entity:{id:JSON.stringify({channelId:e,teamId:t}),action:Se.uk.view,type:Se.py.channels},entityOptions:{back:!!i,hiddenChannel:a,parentTeamId:t}}}case C$:{const{teamId:e,commandSource:t,selectedItemId:n,hideSlotHeader:i,pinned:a}=r;return{command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:t||C.D.UserOnboardingTeam}},entity:{id:JSON.stringify({teamId:e}),action:Se.uk.view,type:Se.py.useronboardingteam},entityOptions:{selectedItemId:n,parentTeamId:e?.endsWith("#")?e.slice(0,-1):e,hideSlotHeader:i,pinned:a}}}case b$:return function(e){const{teamId:t,channelId:n,channelName:i,displayName:a,groupId:o,teamName:r,channelResourceTenantId:s,commandSource:l}=e,c={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:l||C.D.ChannelActions}},d={action:Se.uk.view,type:Se.py.getlinktoteamorchanneldialog};return{command:c,entity:d,entityOptions:{selectedChannelId:n,linkType:"Channel",teamId:t,groupId:o,displayName:a,teamName:r,channelName:i,channelResourceTenantId:s}}}(r);case w$:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:n||C.D.ChannelActions}},a={id:t,action:Se.uk.view,type:Se.py.channelemailv2};return{command:i,entity:a,entityOptions:{isEventingCall:!0,channelId:t}}}(r);case T$:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:i||C.D.ChannelActions}},o={id:t,action:Se.uk.view,type:Se.py.channelmembers,linkedEntity:{id:t,type:Se.py.channels,action:Se.uk.list}};return{command:a,entity:o,entityOptions:{parentTeamId:n}}}(r);case I$:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:Se.uk.view,type:Se.py.teammanage,linkedEntity:{id:t||"",type:Se.py.channels,action:Se.uk.list}};return{command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:n||C.D.ChannelActions}},entity:i,entityOptions:{parentTeamId:t}}}(r);case N$:return function(e){const{teamId:t,channelId:n,teamName:i,channelName:a,isLastOwner:o,groupId:r,channelOnlyMember:s,commandSource:l}=e,c=o?Se.py.leavechannellastownerdialog:Se.py.leavechanneldialog,d={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:l||C.D.ChannelActions}},u={action:Se.uk.view,type:c};return{command:d,entity:u,entityOptions:{isEventingCall:!0,channelName:a,channelId:n,teamId:t,teamName:i,isLastOwner:o,groupId:r,channelOnlyMember:s}}}(r);case E$:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:i||C.D.ChannelActions}},o={id:t,action:Se.uk.view,type:Se.py.channelmanage,linkedEntity:{id:t,type:Se.py.channels,action:Se.uk.list}};return{command:a,entity:o,entityOptions:{parentTeamId:n}}}(r);case A$:return function(e){const{teamId:t,channelId:n,commandSource:i}=e,a={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i||C.D.ChannelActions}},o={id:n,action:Se.uk.view,type:Se.py.addmembertoprivatechanneldialog};return{command:a,entity:o,entityOptions:{parentTeamId:t}}}(r);case _$:return function(e){const{channelId:t,commandSource:n}=e,i={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:n||C.D.ChannelActions}},a={id:t,action:Se.uk.view,type:Se.py.sharechannelwithuserdialog};return{command:i,entity:a}}(r);case F$:return function(e){const{channelId:t,teamId:n,commandSource:i}=e,a={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:i||C.D.ChannelActions}},o={id:t,action:Se.uk.view,type:Se.py.sharedchannelcreateinvitationsdialog,linkedEntity:{id:t,type:Se.py.channels,action:Se.uk.list}};return{command:a,entity:o,entityOptions:{channelId:t,teamId:n}}}(r);case D$:return function(e){const{channelId:t,channelName:n,teamName:i,commandSource:a}=e,o={stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:a||C.D.ChannelActions}},r={id:t,action:Se.uk.view,type:Se.py.channelnotificationsettings},s={commandSource:a||C.D.ChannelActions,teamName:i,channelName:n};return{command:o,entity:r,entityOptions:s}}(r);case P$:return function(e){const{teamId:t,commandSource:n}=e,i={id:t,action:Se.uk.view,type:Se.py.teamchannels,linkedEntity:{id:t||"",type:Se.py.channels,action:Se.uk.list}};return{command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:n||C.D.ChannelActions}},entity:i}}(r);default:s.error(`Command action '${o}' is not supported at TeamsAndChannelsApp.`)}else s.error(`Command for actor '${e.command.actor}' cannot be handled by TeamsAndChannelsApp.`)};const bde=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(540003),n.e(812934),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(649162),n.e(553940),n.e(635026),n.e(136462),n.e(732691),n.e(551124),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(373318),n.e(593837),n.e(526824),n.e(875436),n.e(374968),n.e(302494),n.e(251843),n.e(547642),n.e(384648),n.e(513251),n.e(981041),n.e(710814),n.e(289814),n.e(557370),n.e(479236),n.e(180830),n.e(345213),n.e(92103),n.e(908688),n.e(352779),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(890962),n.e(707238),n.e(666369),n.e(57605),n.e(209252),n.e(433129),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(6348),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(638108),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(198863),n.e(342293),n.e(182115),n.e(776577),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(986305),n.e(270954),n.e(52047),n.e(554897),n.e(467533),n.e(109515),n.e(666181),n.e(992290),n.e(482266),n.e(38878),n.e(784669),n.e(148076),n.e(548435),n.e(106311),n.e(290987),n.e(701227),n.e(259682),n.e(532951),n.e(863213),n.e(312659),n.e(164471),n.e(184787),n.e(771686),n.e(531521),n.e(803407),n.e(462030)]).then(n.bind(n,507978)),wde=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(393890),n.e(773923),n.e(75298),n.e(505990),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(666384),n.e(664625),n.e(397833),n.e(553486),n.e(314991),n.e(933161),n.e(540003),n.e(812934),n.e(564211),n.e(714650),n.e(123977),n.e(682492),n.e(891369),n.e(440413),n.e(832961),n.e(649162),n.e(553940),n.e(635026),n.e(136462),n.e(732691),n.e(551124),n.e(497372),n.e(809416),n.e(857282),n.e(90885),n.e(720708),n.e(651510),n.e(677361),n.e(384701),n.e(253385),n.e(242213),n.e(55956),n.e(424772),n.e(435815),n.e(503847),n.e(373318),n.e(593837),n.e(526824),n.e(875436),n.e(374968),n.e(302494),n.e(251843),n.e(547642),n.e(384648),n.e(513251),n.e(981041),n.e(710814),n.e(289814),n.e(557370),n.e(479236),n.e(180830),n.e(345213),n.e(92103),n.e(908688),n.e(352779),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(796594),n.e(841342),n.e(68021),n.e(890962),n.e(707238),n.e(666369),n.e(57605),n.e(209252),n.e(433129),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(357903),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(412523),n.e(209674),n.e(126541),n.e(258544),n.e(963461),n.e(206237),n.e(968147),n.e(34671),n.e(450367),n.e(230050),n.e(6348),n.e(65722),n.e(376960),n.e(146244),n.e(404742),n.e(638108),n.e(548638),n.e(362509),n.e(886226),n.e(908906),n.e(198863),n.e(342293),n.e(182115),n.e(776577),n.e(550701),n.e(621979),n.e(778022),n.e(551663),n.e(929804),n.e(986305),n.e(270954),n.e(52047),n.e(554897),n.e(467533),n.e(109515),n.e(666181),n.e(992290),n.e(482266),n.e(38878),n.e(784669),n.e(148076),n.e(548435),n.e(106311),n.e(290987),n.e(701227),n.e(259682),n.e(532951),n.e(863213),n.e(312659),n.e(164471),n.e(184787),n.e(771686),n.e(531521),n.e(803407),n.e(462030)]).then(n.bind(n,450812)),Tde=({coreServices:e,host:t,screenState:n,windowOptions:i})=>{const{height:a,minHeight:o,minWidth:r,offset:s,width:l}=ode.windowFeatures||{},c=t?.screenX||0,d=t?.screenY||0,u=(n?.numOpenWindows||1)*(s||1);return{additionalFeatures:{minHeight:`${o}`,minWidth:`${r}`},height:a,left:c+u,minHeight:o,minWidth:r,top:d+u,width:l,...ode.windowFeatures,...e?.coreSettings.get(b.J.Core).enableRatioToScreenBasedSizing&&Ide(t,ode.windowFeatures),...i}};function Ide(e,t){const{widthToScreenWidthRatio:n,heightToWidthRatio:i}=t||{};if(!e||!i||!n)return{};const a=n*e.screen.availWidth;return{height:a*i,width:a}}function Nde(){return{eventHandlers:ice,getAppPhases:tde,getAppViewEntities:xce,getAppViewEntitiesProps:Kce,getAppWindowFeatures:Tde,getCommandScenarioName:(e,t,n,i)=>{const{entity:a,command:o}=e,r=kae({coreSettings:n,userPreferences:i?.getAllPreferences()});if(a.type===Se.py.channels&&(a.action===Se.uk.view||a.action===Se.uk.default)&&o.visibilityState===ke.fe.show&&(e=>e.stateTransition===ke.su.flush||e.stateTransition===ke.su.forceFlush||e.stateTransition===ke.su.new)(o)){const e=a.id?(0,Q1.jd)(a.id,t):void 0;if(e)return o.stateTransition===ke.su.new?e.replyChainId?r?H.RG.SingleTeamViewChannelSwitchL2Popout:H.RG.ChannelSwitchL2Popout:void 0:r?e.replyChainId?H.RG.SingleTeamViewChannelSwitchL2:H.RG.SingleTeamViewChannelSwitchL1:e.replyChainId?H.RG.ChannelSwitchL2:H.RG.ChannelSwitchL1;if(a.action===Se.uk.default)return r?H.RG.TeamsGridLoad:H.RG.ChannelSwitchL1}return a.type===Se.py.schoolteams&&a.action===Se.uk.list?H.RG.TeamsGridLoad:a.type===Se.py.channelcontextualsearch&&a.action===Se.uk.info&&o.visibilityState!==ke.fe.hide?H.RG.ContextualSearchStart:a.type===Se.py.useronboardingteam&&a.action===Se.uk.view?H.RG.TeamsSeeAllChannelsSwitch:void 0},getPlatformAppIdForEntity:e=>e.type===Se.py.channels||e.type===Se.py.schoolteams?"2a84919f-59d8-4441-a975-2a8c2643b741":void 0,onBeforeAddToNavigation:Cce,onBeforeCommandHandled:Tce,onBeforeNavigationFromHistory:Yce,manifest:ode,onBeforeDeeplinkParsed:kce,render:async({appRenderMode:e,coreSettings:t,onRenderEvent:n,scenarioFactory:i})=>{const a="teams-and-channels-app";n("ChunkLoadStarted",{chunkName:a});const{enableEntityMoreInfo:o}=t.get(b.J.Core),r=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),s=o?r:rJ.p3,{TeamsAndChannelsViewsRenderer:l}=await(0,ac.mT)(bde,a,i),{LPC:c}=o?{LPC:r}:await(0,ac.mT)(wde,a,i);return n("ChunkLoadSucceeded",{chunkName:a}),(0,gO.t)(c,{children:(0,gO.t)(s,{children:(0,gO.t)(x4.l8,{children:(0,gO.t)(l,{appRenderMode:e,coreSettings:t})})})})},onCommandReceived:Cde,onPreWarm:kde}}const Ede={id:"com.microsoft.teams.tfl-consent",name:"TFLConsentApp",supportedEntities:[Se.py.tflfre],supportedRenderModes:[Mt.S.Main],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}};var Ade=n(886400);const _de={shouldAddEntitiesToWindowHistory:e=>e?.mainEntity?.type!==Se.py.tflfre,shouldRestoreClientToEntities:e=>e?.mainEntity?.type!==Se.py.tflfre},Fde=e=>{if(Dde(e))return Pde(e)?{subNavEntity:Mde(e),headerEntity:xde(e),startEntity:Rde(e),mainEntity:jde(e),endEntity:Lde(e)}:null},Dde=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.tflfre].includes(i),r=[Se.uk.default,Se.uk.view,Se.uk.update],s=n&&r.includes(n);return!!(a&&o&&s)},Pde=()=>!0,Mde=()=>null,xde=()=>null,Rde=()=>null,jde=({entity:e})=>e,Lde=()=>null,Ode=({entity:e})=>({mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:"minimal"===e?.id}}}),$de={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsTflConsentSetTflUserMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setCurrentUserIsTFLUser"}}]}}]},Ude=()=>Promise.all([n.e(187946),n.e(714650),n.e(143899),n.e(928362),n.e(600213),n.e(893197),n.e(96473)]).then(n.bind(n,85098)),Bde=()=>null,Wde="TflSignInFlyoutDisplayed",Hde=()=>H.RG.TFLConsentLaunch,Vde=(e,t,n)=>({overrideType:GE.OverrideIntent,intent:{...e,entityCommand:{...e.entityCommand,entity:{id:e.entityCommand.command.layoutMode,type:t,action:n}}}});function Gde(){return{getCommandScenarioName:Hde,manifest:Ede,onAfterIntentAuthenticated:{filter:"*",execute:async({intent:e,context:{client:t,authenticatedUser:n,localStorage:i,coreSettings:a,experienceChangeReportingService:o}})=>{const{enableIsTflUserApiCall:r}=a.get(b.J.Growth),{enableDelayedConsent:s}=a.get(b.J.Flyout);return r&&(0,tL.$l)(n)&&n.type===ys.Ch.MsaLife&&t.mutate({mutation:$de}),e.shouldRenderContent?(0,tL.N2)(n,a,i)?(o.report({correlationId:e.entityCommand.command.correlation.id,type:gt.yU.UserConsentedToConsumeResources,userContextId:(0,xe.b4)(n),context:{target:"core-tasks-signal-core-lifecycle-changes-task"}}),{overrideType:GE.NoOverride}):((e,t)=>"true"!==e.get(Wde)&&t.entityCommand.command.layoutMode===ke.lO.minimal)(i,e)?Vde(e,Se.py.identity,Se.uk.signin):((e=>{e.set(Wde,"true","Growth")})(i),s&&(e.entityCommand.command.layoutMode===ke.lO.minimal||e.entityCommand.command.layoutMode===ke.lO.minimode)?Vde(e,Se.py.flyout,Se.uk.update):Vde(e,Se.py.tflfre,Se.uk.default)):{overrideType:GE.NoOverride}}},onBeforeAddToNavigation:_de,render:async({appRenderMode:e,loggerFactory:t,onRenderEvent:n,scenarioFactory:i,entity:a,coreSettings:o})=>{if(e===Mt.S.Main){const e=t.newLogger("TflConsentApp","apps-tfl-consent"),r="tfl-consent-app",{id:s,action:l,type:c}=a,d=a.type===Se.py.flyout||"minimal"===s||"minimode"===s||false,u=l===Se.uk.update||!d;e.log(`entitiy action:${l} id:${s} type:${c}`),e.log("coreSettings type "+typeof o),n("ChunkLoadStarted",{chunkName:r});const{TflFreUserProfile:m}=await(0,ac.mT)(Ude,r,i);return n("ChunkLoadSucceeded",{chunkName:r}),e.log("render: loading tfl consent app"),(0,gO.t)(Ade.f,{namespace:"tflOnboarding",children:(0,gO.t)(m,{isFlyout:d,coreSettings:o,scenarioFactory:i,allowEdit:u})})}return(0,gO.t)(Bde,{})},getAppViewEntities:Fde,getAppViewEntitiesProps:Ode}}const zde={id:"com.microsoft.teams.virtual-events",name:"VirtualEventsApp",supportedEntities:[Se.py.virtualevents],supportedRenderModes:[Mt.S.Main,Mt.S.Modal,Mt.S.HorizontalBar],windowFeatures:{minWidth:1241,width:1241,minHeight:720,height:720}},qde=e=>{if(Jde(e))return Qde(e)?{subNavEntity:Kde(e),headerEntity:Yde(e),startEntity:Xde(e),mainEntity:Zde(e),endEntity:eue(e)}:null},Jde=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.virtualevents].includes(i),r=[Se.uk.default,Se.uk.view,Se.uk.create,Se.uk.list],s=n&&r.includes(n);return!!(a&&o&&s)},Qde=()=>!0,Kde=()=>null,Yde=({entity:e})=>e,Xde=()=>null,Zde=({entity:e})=>e,eue=()=>null,tue=()=>({headerEntity:{[Mt.S.HorizontalBar]:{slotHeightOverrides:"6.1rem"}}});var nue;!function(e){e.Webinar="Webinar",e.Townhall="Townhall",e.Conference="Conference"}(nue||(nue={}));var iue;!function(e){e.virtualEventCreate="/l/virtualevent/new",e.virtualEvent="/l/virtualevent"}(iue||(iue={}));const aue={Conference:nue.Conference,Townhall:nue.Townhall,Webinar:nue.Webinar},oue=[{filter:iue.virtualEventCreate,execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("VirtualEventsApp onBeforeDeeplinkParsed","apps-virtual-events"),{pathname:i,search:a}=e;n.log(`Parsing deeplinkUrl - pathname: ${i}, search: ${a}`);const o=new URLSearchParams(a),r=o.get("eventType"),s=o.get("source"),l=o.get("startTime"),c=o.get("endTime");return r&&aue[r]?Promise.resolve({entityCommand:{entity:{type:Se.py.virtualevents,action:Se.uk.create},command:{stateTransition:ke.su.new,visibilityState:ke.fe.show,correlation:{source:C.D.VirtualEventsOnBeforeDeeplinkParsed}},entityOptions:{eventType:aue[r],source:s??"Teams",startTime:l,endTime:c}},metadata:{allowAnonymous:!1}}):Promise.resolve(void 0)}},{filter:iue.virtualEvent,execute:({deeplinkUrl:e,context:{loggerFactory:t}})=>{const n=t.newLogger("VirtualEventsApp onBeforeDeeplinkParsed","apps-virtual-events"),{pathname:i}=e;n.log(`Parsing deeplinkUrl - pathname: ${i}`);const a=i.split("/")[3];return Promise.resolve({entityCommand:{entity:{type:Se.py.virtualevents,action:Se.uk.view,id:a},command:{visibilityState:ke.fe.show,stateTransition:ke.su.new,correlation:{source:C.D.VirtualEventsOnBeforeDeeplinkParsed}}},metadata:{allowAnonymous:!1}})}}],rue=({prevEntityType:e})=>e===Se.py.virtualevents?null:zde.windowFeatures,sue=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(773923),n.e(65537),n.e(75298),n.e(865804),n.e(459868),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(664625),n.e(397833),n.e(933161),n.e(128770),n.e(540003),n.e(812934),n.e(649800),n.e(457535),n.e(51724),n.e(714650),n.e(392718),n.e(891369),n.e(440413),n.e(129609),n.e(90885),n.e(81),n.e(788241),n.e(862824),n.e(654936),n.e(664032),n.e(625001),n.e(10292),n.e(257298),n.e(462698),n.e(332282),n.e(100385),n.e(179809),n.e(908688),n.e(659070),n.e(646036),n.e(929542),n.e(587628),n.e(598736),n.e(518456),n.e(643372),n.e(130651),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(796594),n.e(429986),n.e(103554),n.e(893829),n.e(126867),n.e(424092),n.e(187436),n.e(685827),n.e(474133),n.e(609660),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(357903),n.e(125136),n.e(700818),n.e(253408),n.e(942964),n.e(189684),n.e(572689),n.e(13800),n.e(552396),n.e(468573),n.e(297881),n.e(359584),n.e(905108)]).then(n.bind(n,790902));const lue={id:"com.microsoft.teams.virtual-consumer-events",name:"VirtualConsumerEventsApp",actors:[DO],supportedEntities:[Se.py.virtualconsumerevents],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Rail,Mt.S.Main,Mt.S.Modal]},cue={onEventReceived:async({requestContext:{loggerFactory:e},eventInput:{event:{originator:t,type:n,data:i},source:a}})=>{const o=e.newLogger("onEventReceived","apps-communities-on-event-received");if(t===q1.kn)switch(n){case q1.uS.createVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.RB)(e)?{command:$O(e),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.deleteVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.nW)(e)?{command:UO(e),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.editVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.HY)(e)?{command:BO(e),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.joinVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.Lz)(e)?{command:WO(e),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.shareVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.gM)(e)?{command:HO(e),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}case q1.uS.viewVirtualConsumerEvent:{if(!i)return void o.error(`Event data is missing for event type '${n}'.`);const e=i();return(0,q1.t5)(e)?{command:VO(e),source:a}:void o.error(`Event data is invalid for event type '${n}'.`)}default:return void o.error(`Event type '${n}' is not supported by VirtualConsumerEventsApp.`)}o.error(`Event from originator '${t}' cannot be handled by VirtualConsumerEventsApp.`)}},due=({entity:e})=>"view"===e.action?e:null,uue=({entity:e})=>"list"===e.action?e:null,mue=({entity:e})=>e,pue=({entity:e})=>"view"===e.action?e:null,gue={eventHandlers:cue,getCommandScenarioName:e=>{const{entity:t}=e;if(t.type===Se.py.virtualconsumerevents)switch(t.action){case Se.uk.create:return H.RG.VirtualConsumerEventsCreateEvent;case Se.uk.update:return H.RG.VirtualConsumerEventsEditEvent;case Se.uk.share:return H.RG.VirtualConsumerEventsShareEvent;case Se.uk.delete:return H.RG.VirtualConsumerEventsDeleteEvent;default:return}},onCommandReceived:async({requestContext:{loggerFactory:e},commandInput:{command:{actor:t,action:n,data:i}}})=>{const a=e.newLogger("onCommandReceived","apps-virtual-consumer-events-on-command-received");if(t===DO)switch(n){case PO:return(e=>"object"==typeof e&&!!e&&"communityId"in e)(i)?{entity:{type:Se.py.virtualconsumerevents,action:Se.uk.create,id:i.communityId},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.VirtualConsumerEvents}},entityOptions:{communityId:i.communityId}}:void a.error(`Command data is invalid for command '${n}'.`);case MO:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:Se.py.virtualconsumerevents,action:Se.uk.delete,id:i.eventId},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case xO:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:Se.py.virtualconsumerevents,action:Se.uk.update,id:i.eventId},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case RO:return(e=>"object"==typeof e&&!!e&&"joinLink"in e&&"title"in e)(i)?{entity:{type:Se.py.meetings,action:Se.uk.join,id:i.joinLink},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.VirtualConsumerEvents}},entityOptions:{callingIntent:{type:"Meeting",joinOptions:{meeting:{showPrejoin:!0,title:i.title,isPSTN:!1},context:"VirtualConsumerEvents"},coordinates:{meetingData:{meetingUrl:i.joinLink}}}}}:void a.error(`Command data is invalid for command '${n}'.`);case jO:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:Se.py.virtualconsumerevents,action:Se.uk.share,id:i.eventId},command:{stateTransition:ke.su.extend,visibilityState:ke.fe.show,correlation:{source:C.D.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case LO:return(e=>"object"==typeof e&&!!e&&"eventId"in e)(i)?{entity:{type:Se.py.virtualconsumerevents,action:Se.uk.view,id:i.eventId},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.VirtualConsumerEvents}},entityOptions:{eventId:i.eventId}}:void a.error(`Command data is invalid for command '${n}'.`);case OO:return{entity:{type:Se.py.virtualconsumerevents,action:Se.uk.list},command:{visibilityState:ke.fe.show,stateTransition:ke.su.forceFlush,correlation:{source:C.D.Unknown}}};default:return void a.error(`Command action '${n}' is not supported by VirtualConsumerEventsApp.`)}a.error(`Command for actor '${t}' cannot be handled by VirtualConsumerEventsApp.`)},getPlatformAppIdForEntity:e=>[Se.py.virtualconsumerevents].includes(e.type)?r3.n.virtualConsumerEvents:void 0,getAppViewEntities:e=>({headerEntity:due(e),subNavEntity:uue(e),mainEntity:mue(e),endEntity:pue(e)}),getAppViewEntitiesProps:({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:!1,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e,isWideSubNav:!!t?.get(b.J.MercuryDesign).enableMercuryDesign}},mainEntity:{[Mt.S.Main]:{isColorSchemeDefaultBackground2:!0}}})},hue=()=>Promise.all([n.e(586535),n.e(848625),n.e(920899),n.e(830648),n.e(53163)]).then(n.bind(n,338683));const yue=e=>{if(vue(e))return fue(e)?{subNavEntity:Sue(e),headerEntity:kue(e),startEntity:Cue(e),mainEntity:bue(e),endEntity:wue(e)}:null},vue=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.registration].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},fue=()=>!0,Sue=()=>null,kue=()=>null,Cue=()=>null,bue=({entity:e})=>e,wue=()=>null,Tue={getDefaultCommand:()=>({type:Se.py.registration,action:Se.uk.view}),id:"com.microsoft.teams.webinar-registration",name:"WebinarRegistrationApp",supportedRenderModes:[Mt.S.Main],supportedEntities:[Se.py.registration],windowFeatures:{minWidth:1140,width:1140,minHeight:720,height:720}},Iue=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(591878),n.e(773923),n.e(75298),n.e(865804),n.e(88373),n.e(612377),n.e(120894),n.e(766254),n.e(397833),n.e(51724),n.e(714650),n.e(392718),n.e(635026),n.e(129609),n.e(90885),n.e(788241),n.e(862824),n.e(654936),n.e(664032),n.e(157477),n.e(625001),n.e(130631),n.e(228737),n.e(10292),n.e(257298),n.e(65923),n.e(995297),n.e(908688),n.e(95019),n.e(587628),n.e(189981),n.e(993304),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(429986),n.e(103554),n.e(585815),n.e(986456),n.e(474133),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(125136),n.e(253408),n.e(854937)]).then(n.bind(n,700100)),Nue=()=>Tue.windowFeatures||{};function Eue(){const e=()=>null;return{getAppViewEntities:yue,getAppWindowFeatures:Nue,manifest:Tue,render:async({appRenderMode:t})=>{if(t===Mt.S.Main){const e="webinar-registration-app",{WebinarRegistrationViewsRenderer:t}=await(0,ac.mT)(Iue,e);return(0,gO.t)(ez.f,{namespaces:["compose","webinar"],loaderRenderer:null,children:(0,gO.t)(t,{})})}return(0,gO.t)(e,{})}}}const Aue={id:"com.microsoft.teams.guardians",name:"GuardiansApp",supportedEntities:[Se.py.guardians,Se.py.guardiansapprovalrequest,Se.py.guardianssendapprovalsuccess,Se.py.guardianssendapprovalerror],supportedRenderModes:[Mt.S.HorizontalBar,Mt.S.Main,Mt.S.Rail,Mt.S.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},_ue=e=>{if(Fue(e))return Due(e)?{subNavEntity:Pue(e),headerEntity:Mue(e),startEntity:xue(e),mainEntity:Rue(e),endEntity:jue(e)}:null},Fue=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.guardians].includes(i),r=[Se.uk.list],s=n&&r.includes(n);return!!(a&&o&&s)},Due=()=>!0,Pue=({entity:e,layoutMode:t})=>t===ke.lO.focus?null:e,Mue=({entity:e})=>e,xue=()=>null,Rue=({entity:e})=>e,jue=()=>null,Lue={onEventReceived:({eventInput:e})=>{if(e.event.type===YV.uS.requestPersonMoreInfo){const t=e.event.data?.();return Promise.resolve({command:nG(t)})}return Promise.resolve(void 0)}},Oue=({appRenderMode:e})=>{const t=new MV.H,n=[],i=[];switch(e){case Mt.S.Main:$ue({criticalSignals:n,postCriticalSignals:i,featureFlags:{}});case Mt.S.HorizontalBar:case Mt.S.Rail:}return t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:3e4}),t.appPhases},$ue=({criticalSignals:e})=>{e.push(xV.G.GUARDIANS_APP_RENDERED)};var Uue=n(878146),Bue=n(217120);const Wue=(0,BG.s)({guardiansApprovalRequestDialogSurface:{Bbmb7ep:["f1erghxr","f1ehz9de"],Beyfa6y:["f1ehz9de","f1erghxr"],B7oj6ja:["f1spoy8","fmb70yw"],Btl43ni:["fmb70yw","f1spoy8"],a9b677:"f177j64f"},showDialogBody:{Bqenvij:"f1j8dsdc"},showGuardiansApprovalRequestFormLabel:{jrapky:"f1jlhsmd",Be2twd7:"fses1vf"},showGuardiansApprovalRequestFormInput:{B6of3ja:"fvjh0tl"},showAddNewParentButton:{sj55zd:"f16muhyy",uwmqm3:["f1asdtw4","fifp7yv"],B6of3ja:"f1xdg43u",Dyrjrp:"f1cqwcg4"},rightActionButton:{B6of3ja:"f1xdg43u"},showGuardiansAvatarAndArrowIcon:{uwmqm3:["f1asdtw4","fifp7yv"],z189sj:["fifp7yv","f1asdtw4"],B6of3ja:"f1xdg43u",jrapky:"f1jlhsmd"},isParentAvatar:{Bf4jedk:"ff9fk16",Frg6f3:["f9yszdx","fibjyge"]},showArrowIcon:{z189sj:["fifp7yv","f1asdtw4"]},showParentDisplayName:{Bf4jedk:"ff9fk16",sj55zd:"fkfq4zb",Be2twd7:"fses1vf",B80ckks:"fmd4ok8",Bhrd7zp:"f71fsbu",Bg96gwp:"f1n95isl"},alignAvatarAndArrowIcon:{a9b677:"fly5x3f"},showDialogDivider:{B6of3ja:"f2zxqi",jrapky:"febqm8h"},parentInputFieldError:{B4j52fo:"f118ihkj",Bekrc4i:["fb4i99f","fgvdrvz"],Bn0qgzm:"f3bv7ky",ibv6hh:["fgvdrvz","fb4i99f"],icvyot:"fzkkow9",vrafjx:["fcdblym","fjik90z"],oivjwe:"fg706s2",wvpqe5:["fjik90z","fcdblym"],g2u3we:"f8scegn",h3c5rm:["f14c50la","f909gkl"],B9xav0g:"f171s0d9",zhjwy3:["f909gkl","f14c50la"]},showErrorMsg:{B6of3ja:"f4gg0ds",sj55zd:"f1hcrxcs"},showFormView:{B6of3ja:"f18og1rn"},spinner:{B6of3ja:"f1uinfot"},disableGridItem:{sj55zd:"f1s2aq7o",Bkecrkj:"f1aehjj5"},showDialogSubHeader:{B6of3ja:"f2zxqi",jrapky:"febqm8h",Bhrd7zp:"f71fsbu",Be2twd7:"fses1vf"}},{d:[".f1erghxr{border-bottom-right-radius:8px;}",".f1ehz9de{border-bottom-left-radius:8px;}",".f1spoy8{border-top-right-radius:8px;}",".fmb70yw{border-top-left-radius:8px;}",".f177j64f{width:600px;}",".f1j8dsdc{height:403px;}",".f1jlhsmd{margin-bottom:12px;}",".fses1vf{font-size:14px;}",".fvjh0tl{margin-top:4px;}",".f16muhyy{color:var(--colorBrandForeground1);}",".f1asdtw4{padding-left:0px;}",".fifp7yv{padding-right:0px;}",".f1xdg43u{margin-top:12px;}",".f1cqwcg4:disabled{color:var(--colorNeutralForegroundDisabled);}",".ff9fk16{min-width:3.2rem;}",".f9yszdx{margin-left:0px;}",".fibjyge{margin-right:0px;}",".fkfq4zb{color:var(--colorNeutralForeground2);}",".fmd4ok8{font-style:normal;}",".f71fsbu{font-weight:400;}",".f1n95isl{line-height:20px;}",".fly5x3f{width:100%;}",".f2zxqi{margin-top:8px;}",".febqm8h{margin-bottom:8px;}",".f118ihkj{border-top-width:0.1rem;}",".fb4i99f{border-right-width:0.1rem;}",".fgvdrvz{border-left-width:0.1rem;}",".f3bv7ky{border-bottom-width:0.1rem;}",".fzkkow9{border-top-style:solid;}",".fcdblym{border-right-style:solid;}",".fjik90z{border-left-style:solid;}",".fg706s2{border-bottom-style:solid;}",".f8scegn{border-top-color:var(--colorPaletteRedForeground1);}",".f14c50la{border-right-color:var(--colorPaletteRedForeground1);}",".f909gkl{border-left-color:var(--colorPaletteRedForeground1);}",".f171s0d9{border-bottom-color:var(--colorPaletteRedForeground1);}",".f4gg0ds{margin-top:3px;}",".f1hcrxcs{color:var(--colorPaletteRedForeground1);}",".f18og1rn{margin-top:15px;}",".f1uinfot{margin-top:16px;}",".f1s2aq7o{color:var(--colorNeutralForegroundDisabled);}",".f1aehjj5{pointer-events:none;}"]}),Hue=({errorCode:e})=>{const[t,n]=hO.useState(!0),i=(0,uY.Cq)(),a=e===h.jK.GatewayTimeout?i.stringTranslate("guardians","guardians_approval_request_timeout_error_dialog_title"):i.stringTranslate("guardians","guardians_approval_request_generic_error_dialog_title"),o=e===h.jK.GatewayTimeout?i.stringTranslate("guardians","guardians_approval_request_timeout_error_dialog_content"):i.stringTranslate("guardians","guardians_approval_request_generic_error_dialog_content"),r=Wue(),s=hO.useCallback((()=>{n(!1)}),[n]),l=hO.useCallback((e=>{"Escape"!==e.key&&"Esc"!==e.key||s()}),[s]);return(0,gO.t)(MG.V,{open:t,"data-tid":"guardians-send-approval-error-dialog-renderer",children:(0,gO.t)(xG.c,{onKeyDown:l,className:r.guardiansApprovalRequestDialogSurface,"data-tid":"guardians-send-approval-error-dialog-renderer-surface",children:(0,gO.t)(RG.a,{children:[(0,gO.t)(jG.$,{children:a}),(0,gO.t)(LG.c,{children:(0,gO.t)(Bue.q,{children:o})}),(0,gO.t)(OG.k,{position:"end",children:(0,gO.t)(Uue.h,{children:(0,gO.t)(sY.z,{appearance:"outline","data-tid":"guardians-approval-request-error-dialog-close-button",className:r.rightActionButton,onClick:s,children:i.stringTranslate("guardians","guardians_approval_request_dialog_close_button")})})})]})})})};var Vue=n(825848),Gue=n(52996),zue=n(647170),que=n(895007),Jue=n(229780),Que=n(789181),Kue=n(763121);const Yue=({relatedContacts:e,onClickSaveButtonHandler:t,onClickBackButtonHandler:n,isSaveButtonEnabled:i})=>{const a=(0,uY.Cq)();return(0,gO.t)(hO.Fragment,{children:[e.length>0&&(0,gO.t)(OG.k,{position:"start",children:(0,gO.t)(Uue.h,{children:(0,gO.t)(sY.z,{appearance:"subtle",icon:(0,gO.t)(qK.s$$,{filled:!0,fontSize:Que.l.large}),onClick:n,"data-tid":"guardians-approval-request-dialog-back-button",children:a.stringTranslate("guardians","guardians_approval_request_dialog_back_button")})})}),(0,gO.t)(OG.k,{position:"end",children:(0,gO.t)(Uue.h,{children:(0,gO.t)(sY.z,{appearance:"primary",size:"medium",onClick:t,disabled:!i,"data-tid":"guardians-approval-request-dialog-save-button",children:a.stringTranslate("guardians","guardians_approval_request_dialog_save_button")})})})]})};var Xue=n(46650),Zue=n(691854);const eme=/[@#$%^&*()_:"=<>[\]{};?\/|~\\]/,tme=async(e,t,n)=>{const{displayNameErr:i}=((e,t)=>{let n;return Boolean(""!==e?.trim())?e.length>256?n=t.stringTranslate("guardians","guardians_name_max_length_field_error"):eme.test(e)&&(n=t.stringTranslate("guardians","guardians_name_special_characters_error")):n=t.stringTranslate("guardians","guardians_name_required_field_error"),{displayNameErr:n}})(t.displayName,n),a=e.emailAddress?.trim()===t.emailAddress?.trim(),{emailAddressErr:o}=((e,t,n)=>{let i;const a=Boolean(""!==e?.trim());if(a||(i=n.stringTranslate("guardians","guardians_email_required_field_error")),!t){const t=(0,Zue.v)(e);a&&!t&&(i=n.stringTranslate("guardians","guardians_email_format_field_error"))}return{emailAddressErr:i}})(t.emailAddress,a,n),r=e.mobilePhone?.trim()===t.mobilePhone?.trim(),{mobilePhoneErr:s}=await(async(e,t,n)=>{let i;if(!t){const t=Boolean(""!==e?.trim()),a=await Xue.o.tryParse(e),o=a&&e===a.toString();t&&!o&&(i=n.stringTranslate("guardians","guardians_phone_format_field_error"))}return{mobilePhoneErr:i}})(t.mobilePhone,r,n);return{displayNameErr:i,emailAddressErr:o,mobilePhoneErr:s}},nme={displayName:"",emailAddress:"",mobilePhone:""},ime=({relatedContacts:e,parentRowSelected:t,setDialogViewMode:n,setRelatedContacts:i})=>{const a=(0,uY.Cq)(),o=Wue(),[r,s]=hO.useState(nme),[l,c]=hO.useState({displayNameErr:void 0,emailAddressErr:void 0,mobilePhoneErr:void 0}),d=-1!==t?e[t]:nme,u=((e,t)=>Object.keys(t).some((n=>{const i=e?.[n],a=t?.[n];return"string"==typeof i&&"string"==typeof a&&i.trim()!==a.trim()})))(d,r),{handleParentInputChange:m}=((e,t)=>({handleParentInputChange:hO.useCallback((n=>{const{name:i,value:a}=n.target;e((e=>({...e,[i]:a}))),t((e=>({...e,[`${i}Err`]:void 0})))}),[t,e])}))(s,c),p=hO.useCallback((()=>{n(Kue.h.List)}),[n]),g=hO.useCallback((async()=>{const{displayNameErr:e,emailAddressErr:o,mobilePhoneErr:s}=await tme(d,r,a);c((t=>({...t,displayNameErr:e,emailAddressErr:o,mobilePhoneErr:s})));!e&&!o&&!s&&(n(Kue.h.List),i((e=>{const n=[...e||[]];return-1!==t?n[t]=r:n.push(r),n})))}),[n,i,t,r,d,a]);return hO.useEffect((()=>{-1!==t&&s({...e[t]})}),[t,e]),(0,gO.t)(hO.Fragment,{children:[(0,gO.t)(LG.c,{children:[(0,gO.t)(Vue.i,{className:o.showDialogDivider}),(0,gO.t)(UK.k,{column:!0,className:o.showFormView,children:[(0,gO.t)(UK.k,{column:!0,className:o.showGuardiansApprovalRequestFormLabel,children:[(0,gO.t)(Gue._,{id:"nameLabel",required:!0,children:a.stringTranslate("guardians","guardians_approval_request_dialog_parent_name_label")}),(0,gO.t)(zue.I,{type:"text",name:"displayName",value:r.displayName||"",onChange:m,className:o.showGuardiansApprovalRequestFormInput,"aria-labelledby":"nameLabel","aria-required":"true"}),(0,gO.t)(Bue.q,{size:"small",className:o.showErrorMsg,"aria-live":"polite","aria-atomic":"true","aria-relevant":"all",error:!0,children:l.displayNameErr&&(0,gO.t)(UK.k,{vAlign:"center",children:[(0,gO.t)(qK.JeE,{filled:!0,fontSize:Que.l.medium}),l.displayNameErr]})})]}),(0,gO.t)(UK.k,{column:!0,className:o.showGuardiansApprovalRequestFormLabel,children:[(0,gO.t)(Gue._,{id:"emailLabel",required:!0,children:a.stringTranslate("guardians","guardians_approval_request_dialog_parent_email_label")}),(0,gO.t)(zue.I,{type:"text",name:"emailAddress",value:r.emailAddress||"",onChange:m,className:(0,que.z)(o.showGuardiansApprovalRequestFormInput,l.emailAddressErr&&o.parentInputFieldError),"aria-labelledby":"emailLabel","aria-required":"true"}),(0,gO.t)(Bue.q,{size:"small",className:o.showErrorMsg,"aria-live":"polite","aria-atomic":"true","aria-relevant":"all",error:!0,children:l.emailAddressErr&&(0,gO.t)(UK.k,{vAlign:"center",children:[(0,gO.t)(qK.JeE,{filled:!0,fontSize:Que.l.medium}),l.emailAddressErr]})})]}),(0,gO.t)(UK.k,{column:!0,className:o.showGuardiansApprovalRequestFormLabel,children:[(0,gO.t)(UK.k,{vAlign:"center",children:[(0,gO.t)(Gue._,{id:"phoneLabel",children:a.stringTranslate("guardians","guardians_approval_request_dialog_parent_phone_label")}),(0,gO.t)(Jue.u,{relationship:"label",positioning:"below-start",withArrow:!0,content:{children:a.stringTranslate("guardians","guardians_approval_request_dialog_phone_tooltip")},children:(0,gO.t)(sY.z,{icon:(0,gO.t)(qK.kIV,{fontSize:Que.l.medium}),appearance:"transparent","data-tid":"guardians-approval-request-dialog-parent-phone-tooltip",role:"tooltip"})})]}),(0,gO.t)(zue.I,{type:"text",name:"mobilePhone",value:r.mobilePhone||"",onChange:m,className:(0,que.z)(o.showGuardiansApprovalRequestFormInput,l.mobilePhoneErr&&o.parentInputFieldError),"aria-labelledby":"phoneLabel"}),(0,gO.t)(Bue.q,{size:"small",className:o.showErrorMsg,"aria-live":"polite","aria-atomic":"true","aria-relevant":"all",error:!0,children:l.mobilePhoneErr&&(0,gO.t)(UK.k,{vAlign:"center",children:[(0,gO.t)(qK.JeE,{filled:!0,fontSize:Que.l.medium}),l.mobilePhoneErr]})})]})]})]}),(0,gO.t)(Yue,{relatedContacts:e,onClickBackButtonHandler:p,onClickSaveButtonHandler:g,isSaveButtonEnabled:u})]})};var ame=n(262686),ome=n(254021),rme=n(941325),sme=n(509759),lme=n(148443),cme=n(918382),dme=n(444156),ume=n(372076);const mme=({onClickAddParentButtonHandler:e,isSendApprovalButtonEnabled:t,onClickSendForApprovalButtonHandler:n,isRequestInProgress:i,relatedContacts:a})=>{const o=(0,uY.Cq)(),r=Wue(),s=(0,ume.Yx)(),l=hO.useCallback((()=>{n(a)}),[n,a]),c=o.stringTranslate("guardians","guardians_approval_request_loader_label"),d=o.stringTranslate("guardians","guardians_approval_request_loader_icon_label"),u={"data-track-action-gesture":dA.uS.click,"data-track-module-type":dA.PO.button,"data-track-module-name":dA.rA.sendApprovalButton,"data-track-panel-region":dA.Ai.modal,"data-track-action-outcome":dA.$K.submit,"data-track-panel-type":dA.wh.GuardiansApprovalRequestDialog},m={"data-track-action-gesture":dA.uS.click,"data-track-module-type":dA.PO.button,"data-track-module-name":dA.rA.addNewParentButton,"data-track-panel-region":dA.Ai.modal,"data-track-action-outcome":dA.$K.open,"data-track-panel-type":dA.wh.GuardiansApprovalRequestDialog};return hO.useEffect((()=>{i&&s.announce(c,!0)}),[i,c,s]),(0,gO.t)(hO.Fragment,{children:[(0,gO.t)(OG.k,{position:"start",children:(0,gO.t)(Uue.h,{children:(0,gO.t)(sY.z,{appearance:"subtle",icon:(0,gO.t)(qK.mm_,{}),onClick:e,disabled:i,"data-tid":"guardians-approval-request-dialog-add-new-parent-button",className:r.showAddNewParentButton,...m,children:o.stringTranslate("guardians","guardians_approval_request_dialog_add_new_parent_button")})})}),(0,gO.t)(OG.k,{position:"end",children:i?(0,gO.t)(dme.$,{size:"extra-small","aria-label":d,label:c,className:r.spinner}):(0,gO.t)(Uue.h,{children:(0,gO.t)(sY.z,{appearance:"primary","data-tid":"guardians-approval-request-dialog-send-approval-button",disabled:t,className:r.rightActionButton,onClick:l,...u,children:o.stringTranslate("guardians","guardians_approval_request_dialog_send_approval_button")})})})]})};var pme=n(436328);const gme=[(0,ome.p)({columnId:"",renderCell:e=>{const t=Wue(),{vars:n}=(0,pme.L)(),i=(0,uY.Cq)().stringTranslate("guardians","guardians_approval_request_dialog_arrow_icon");return(0,gO.t)(ame.K,{content:{className:t.alignAvatarAndArrowIcon},className:t.showGuardiansAvatarAndArrowIcon,children:(0,gO.t)(UK.k,{vAlign:"center",space:"between",children:[(0,gO.t)(UK.k,{gap:"gap.medium",vAlign:"center",children:[(0,gO.t)(lY.mw,{variables:n("guardians",["isParentAvatar"]),v9ClassName:t.isParentAvatar,users:[{displayName:e.displayName,email:e.emailAddress,id:""}],isFocusable:!1,isPresencePrefetched:!1,showPresence:!1,hidePersonaCard:!0,narrateProfilePicture:!1,callerInfo:"guardians-approval-request-dialog-list",isSharedChannel:!1}),(0,gO.t)(Bue.q,{className:(0,que.z)(t.showParentDisplayName,e.disableGridRow&&t.disableGridItem),children:e.displayName})]}),(0,gO.t)(UK.k,{children:(0,gO.t)(qK._Qn,{fontSize:Que.l.large,"aria-label":i,"data-tid":"guardians-approval-request-dialog-arrow-icon",className:(0,que.z)(t.showArrowIcon,e.disableGridRow&&t.disableGridItem)})})]})})}})],hme=({relatedContacts:e,setActionType:t,setDialogViewMode:n,setParentRowSelected:i,memberAndRelatedContacts:a,onClickSendForApprovalButtonHandler:o,isRequestInProgress:r})=>{const s=(0,uY.Cq)().stringTranslate("guardians","guardians_grid_info_text",{student:a.displayName||""}),l=Wue();e.map((e=>e.disableGridRow=r));const[c,d]=hO.useState(!1),u=hO.useCallback((e=>{r||(n(Kue.h.Form),t(Kue.V.Edit),i(e))}),[t,n,i,r]),m=hO.useCallback((e=>{u(Number(e.currentTarget.id))}),[u]),p=hO.useCallback((e=>{"Enter"===e.key&&u(Number(e.currentTarget.id))}),[u]),g=hO.useCallback((()=>{n(Kue.h.Form),t(Kue.V.Add),i(-1)}),[t,n,i]);return hO.useEffect((()=>{const t=(0,W.isEqual)(e,a.guardiansInfo);d(t)}),[a.guardiansInfo,e]),(0,gO.t)(hO.Fragment,{children:[(0,gO.t)(LG.c,{children:[(0,gO.t)(Vue.i,{className:l.showDialogDivider}),(0,gO.t)(rme._,{items:e,columns:gme,"data-tid":"guardians-approval-request-dialog-list","aria-label":s,children:(0,gO.t)(sme.s,{children:({item:e,rowId:t})=>(0,gO.t)(lme.m,{id:t.toString(),onClick:m,onKeyDown:p,children:({renderCell:t})=>(0,gO.t)(cme.a,{children:t(e)})},t)})})]}),(0,gO.t)(mme,{onClickAddParentButtonHandler:g,isSendApprovalButtonEnabled:c,onClickSendForApprovalButtonHandler:o,isRequestInProgress:r,relatedContacts:e})]})};var yme=n(151495);const vme=({memberAndRelatedContacts:e,onCloseDialogHandler:t,onClickSendForApprovalButtonHandler:n,isDialogOpen:i,initialAction:a,initialViewMode:o,isRequestInProgress:r})=>{const s=(0,uY.Cq)(),l=Wue(),[c,d]=hO.useState(a),[u,m]=hO.useState(o),[p,g]=hO.useState(-1),[h,y]=hO.useState(e.guardiansInfo),v=hO.useCallback((e=>{"Escape"!==e.key&&"Esc"!==e.key||t()}),[t]);return(0,gO.t)(MG.V,{open:i,"data-tid":"guardians-approval-request-dialog-renderer",children:(0,gO.t)(xG.c,{onKeyDown:v,className:l.guardiansApprovalRequestDialogSurface,"data-tid":"guardians-approval-request-dialog-renderer-surface",children:(0,gO.t)(RG.a,{className:l.showDialogBody,children:[(0,gO.t)(jG.$,{action:(0,gO.t)(Uue.h,{children:(0,gO.t)(sY.z,{appearance:"subtle",disabled:r,icon:(0,gO.t)(qK.tEX,{}),onClick:t,"data-tid":"guardians-approval-request-dialog-close-button","aria-label":s.stringTranslate("guardians","guardians_approval_request_dialog_close_button")})}),children:(0,gO.t)(UK.k,{column:!0,children:[(0,gO.t)(XK.W,{children:s.stringTranslate("guardians","guardians_approval_request_dialog_renderer_title",{actionType:c})}),(0,gO.t)(Bue.q,{className:l.showDialogSubHeader,children:s.stringTranslate("guardians","guardians_approval_request_dialog_sub_header")}),(0,gO.t)(yme.Mx,{member:e,isParentsEndSlot:!1,isGuardiansApprovalRequestDialog:!0})]})}),u===Kue.h.Form?(0,gO.t)(ime,{relatedContacts:h,setRelatedContacts:y,parentRowSelected:p,setDialogViewMode:m}):(0,gO.t)(hme,{relatedContacts:h,setActionType:d,setParentRowSelected:g,memberAndRelatedContacts:e,setDialogViewMode:m,onClickSendForApprovalButtonHandler:n,isRequestInProgress:r})]})})})};var fme=n(756303),Sme=n(944504);const kme=(e,t,n,i,a,o,r)=>{const{message:s}=e,{code:l,context:c,reason:d}=e?.graphQLErrors?.[0]?.extensions?.prevError??{},u=`ErrorMessage: ${s}`;o.fail({context:c,reason:d,errorCode:l,errors:u,statusCode:d?.status});let m=h.jK.Unknown;((e,t)=>e===h.jK.GatewayTimeout||e===h.jK.FailedToCreateGuardiansApproval||t?.status===Hs.qb.GATEWAY_TIMEOUT||t?.status===Hs.qb.SERVER_ERROR)(l,d)&&((0,fme.WK)(n,i,a),m=h.jK.GatewayTimeout),t(),r(m)},Cme=({initialAction:e,initialViewMode:t,isDialogOpen:n,setIsDialogOpen:i,memberAndRelatedContacts:a})=>{const o=(0,uY.Cq)(),r=(0,Y4.x)(),{loggerFactory:{newLogger:s},scenarioFactory:l}=(0,dY.SE)(),c=a.objectId||"",d=a.groupId||"",u=o.stringTranslate("guardians","guardians_approval_request_title",{studentName:a.displayName||""}),m=hO.useCallback((()=>{i(!1)}),[i]),p=(0,Sme.RQ)(),g=(0,Sme.WN)(),{createGuardiansApproval:y,loading:v}=(0,fme.CH)(d,c,u,r),f=hO.useCallback((async e=>{const t=l.newScenario(H.RG.CreateGuardiansApproval);t.appendEventData({studentId:c,groupId:d});try{const n=e.map((e=>({displayName:e.displayName,emailAddress:e.emailAddress,mobilePhone:e.mobilePhone,relationship:"parent"}))),i=await y(n);m();const a=i.data?.createGuardiansApproval?.approvalId;a?(t.stop({approvalId:a}),p()):(t.cancel({errorCode:h.jK.Unknown,errors:"Missing approval id on the create guardians approval request."}),g())}catch(e){kme(e,m,r,c,d,t,g)}}),[y,m,p,g,c,d,r,l]);return(0,gO.t)(pY.q,{panelRegion:dA.Ai.modal,panelType:dA.wh.GuardiansApprovalRequestDialog,newLogger:s,children:(0,gO.t)(vme,{memberAndRelatedContacts:a,onCloseDialogHandler:m,onClickSendForApprovalButtonHandler:f,initialAction:e,initialViewMode:t,isDialogOpen:n,isRequestInProgress:v})})};Cme.displayName="GuardiansApprovalRequestDialogContainer";const bme=()=>{const[e,t]=hO.useState(!0),n=(0,uY.Cq)(),i=Wue(),a=hO.useCallback((()=>{t(!1)}),[t]),o=hO.useCallback((e=>{"Escape"!==e.key&&"Esc"!==e.key||a()}),[a]);return(0,gO.t)(MG.V,{open:e,"data-tid":"guardians-send-approval-success-dialog-renderer",children:(0,gO.t)(xG.c,{onKeyDown:o,className:i.guardiansApprovalRequestDialogSurface,"data-tid":"guardians-send-approval-success-dialog-renderer-surface",children:(0,gO.t)(RG.a,{children:[(0,gO.t)(jG.$,{children:n.stringTranslate("guardians","guardians_approval_request_success_dialog_title")}),(0,gO.t)(LG.c,{children:(0,gO.t)(Bue.q,{children:n.stringTranslate("guardians","guardians_approval_request_success_dialog_content")})}),(0,gO.t)(OG.k,{position:"end",children:(0,gO.t)(Uue.h,{children:(0,gO.t)(sY.z,{appearance:"outline","data-tid":"guardians-approval-request-success-dialog-close-button",className:i.rightActionButton,onClick:a,children:n.stringTranslate("guardians","guardians_approval_request_dialog_close_button")})})})]})})})},wme=()=>null,Tme=()=>{const{getEntityOptions:e}=(0,GK.sV)(),{errorCode:t}=e(Se.py.guardianssendapprovalerror,Se.uk.create);return(0,gO.t)(Hue,{errorCode:t})},Ime=()=>{const{getEntityOptions:e}=(0,GK.sV)(),{memberAndRelatedContacts:t,initialAction:n,initialViewMode:i}=e(Se.py.guardiansapprovalrequest,Se.uk.create),[a,o]=hO.useState(!0);return(0,gO.t)(Cme,{initialAction:n,initialViewMode:i,memberAndRelatedContacts:t,isDialogOpen:a,setIsDialogOpen:o})},Nme=()=>Promise.all([n.e(187946),n.e(112403),n.e(182149),n.e(909020),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(714650),n.e(577767),n.e(845976),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(34671),n.e(259331),n.e(829861)]).then(n.bind(n,26410)),Eme=()=>Promise.all([n.e(187946),n.e(112403),n.e(182149),n.e(909020),n.e(865804),n.e(88373),n.e(612377),n.e(766254),n.e(714650),n.e(577767),n.e(845976),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(34671),n.e(259331),n.e(829861)]).then(n.bind(n,450812)),Ame=()=>null;function _me(){return{eventHandlers:Lue,getAppPhases:Oue,getAppViewEntities:_ue,getCommandScenarioName:()=>H.RG.GuardiansAppLoad,manifest:Aue,render:async({appRenderMode:e,coreSettings:t,onRenderEvent:n,entity:i})=>{if(e===Mt.S.Modal)return(async e=>{switch(e.type){case Se.py.guardiansapprovalrequest:return(0,gO.t)(Ime,{});case Se.py.guardianssendapprovalsuccess:return(0,gO.t)(bme,{});case Se.py.guardianssendapprovalerror:return(0,gO.t)(Tme,{});default:return(0,gO.t)(wme,{})}})(i);if(e===Mt.S.Main){const i="guardians-app";n("ChunkLoadStarted",{chunkName:i});const{enableEntityMoreInfo:a}=t.get(b.J.Core),o=({children:e})=>(0,gO.t)(hO.Fragment,{children:e}),{GuardiansAppViews:r}=await(0,ac.mT)(Nme,i),{LPC:s}=a?{LPC:o}:await(0,ac.mT)(Eme,i),l=a?o:rJ.p3;return n("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(s,{children:(0,gO.t)(l,{children:(0,gO.t)(r,{appRenderMode:e})})})}return(0,gO.t)(Ame,{})}}}const Fme=screen.availHeight-250-10,Dme=screen.availWidth-400-10,Pme={id:"com.microsoft.teams.notifications",name:"NotificationsApp",supportedEntities:[Se.py.externalnavigation,Se.py.toasts],supportedRenderModes:[Mt.S.Main,Mt.S.PartialOverlay],windowFeatures:{top:Fme,left:Dme,width:0,height:0,minWidth:0,minHeight:0,offset:0,toolbar:"no",titlebar:"no",menubar:"no",location:"no",scrollbars:"no",resizable:"no",status:"no"}},Mme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsMeQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"me"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"tenantName"}}]}}]}}]},xme="ModuleLoaded",Rme="createCollection not available on module.",jme="removeCollection not available on module.",Lme="HostComms is unable to load toast collection module. Bailing out.";class Ome{constructor(e,t){this.hostCommunicationService=t,this.logger=e.newLogger("ToastCollectionService","services-io-toast-collection")}async createCollection(e){const t=await this.hostCommunicationService.loadModule("toasts");if(t){if(t.createCollection)return this.logger.log(xme),t.createCollection(e);this.logger.error(Rme)}else this.logger.error(Lme)}async removeCollection(e){const t=await this.hostCommunicationService.loadModule("toasts");if(t){if(t.removeCollection)return this.logger.log(xme),t.removeCollection(e);this.logger.error(jme)}else this.logger.error(Lme)}}function $me(e,t){const n=`${e} - ${t}`;if(n.length<=36)return n;const i=18-t.length,a=i>0?18+i:18;if(e.length<=a)return n;return`${e.slice(0,a-3)}... - ${t}`}function Ume(e,t,n,i,a){const{enableToastCollections:o}=a.get(b.J.Notifications);return{id:"create-toast-collection",runOncePerId:!0,job:async()=>{const a=n.newLogger("ToastCollectionCreation","apps-notifications");if(!o)return void a.log("not enabled by feature flag");if(!e||!e.loginUserName)return void a.error("AuthenticationUserContext is not found");const r=await t.query({query:Mme});if(!r.data.me||!r.data.me.tenantName)return void a.error("User data not available");const s=new Ome(n,i),l=(0,xe.b4)(e);return s.createCollection({collectionId:l,name:$me(e.loginUserName,r.data.me.tenantName)}),async e=>{if("signout"===e)await s.removeCollection(l)}}}}const Bme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsMePresenceQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"me"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"presence"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},Wme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsPresenceUpdateEventSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presenceUpdateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]};var Hme,Vme;!function(e){e.Presenting="Presenting",e.DoNotDisturb="DoNotDisturb",e.OSdoNotDisturb="OSdoNotDisturb"}(Hme||(Hme={})),function(e){e.Default="default",e.Presence="presence",e.MeetingOrCall="meetingOrCall",e.GeneralMute="generalMute",e.GeneralMuteIncludingUrgentAndPriority="generalMuteIncludingUrgentAndPriority"}(Vme||(Vme={}));class Gme{constructor(){this.notificationsBlockingCaches={}}blockUserNotifications(e,t,n){let i=this.notificationsBlockingCaches[e];i||(i={}),i={...i,...t},n.log(`NotificationsBlockingCache: set new blocking cache for userId ${e}`),this.notificationsBlockingCaches[e]=i}unblockUserNotifications(e,t,n){n.log(`NotificationsBlockingCache unblockUserNotifications ${e}`);const i=this.notificationsBlockingCaches[e];i?(Object.keys(t).forEach((e=>{Reflect.deleteProperty(i,e)})),Object.keys(i).length||(n.log(`NotificationsBlockingCache, unblockUserNotifications: blocking cache is empty, deleting the entry for the user ${e}`),Reflect.deleteProperty(this.notificationsBlockingCaches,e))):n.warnToTelemetry?.("No blocking cache found for the user id","notifications-blocking-cache",void 0,!0)}unblockUserNotificationsByBlockingType(e,t,n){n.log(`NotificationsBlockingCache unblockUserNotificationsByBlockingType ${e}`);const i=this.notificationsBlockingCaches[e];if(i){for(const e in i)i[e]===t&&Reflect.deleteProperty(i,e);Object.keys(i).length||(n.log(`NotificationsBlockingCache, unblockUserNotificationsByBlockingType: blocking cache is empty, deleting the entry for the user ${e}`),Reflect.deleteProperty(this.notificationsBlockingCaches,e))}else n.warnToTelemetry?.("No blocking cache found for the user id","notifications-blocking-cache",void 0,!0)}getBlockedState(e){e.log("NotificationsBlockingCache, getBlockedState: reading blocked state");const t=Object.keys(this.notificationsBlockingCaches),n=[];for(const i of t)e.log(`NotificationsBlockingCache, getBlockedState: reading cache for userId ${i}`),n.push({userId:i,blockingReasons:this.notificationsBlockingCaches[i]});if(n.length)return e.log("NotificationsBlockingCache, getBlockedState: returning blocked state"),{state:"blocked",blocks:n};e.log("NotificationsBlockingCache, getBlockedState: blocks not found")}getUserBlockedState(e,t,n){e.log(`NotificationsBlockingCache, getUserBlockedState: getting blocked state for userId ${t}`);const i=Object.keys(this.notificationsBlockingCaches).find((e=>{const i=n?e:e.replace(/-/g,""),a=n?t:t.replace(/-/g,"");return i.includes(a)}));if(i)return{userId:i,blockingReasons:this.notificationsBlockingCaches[i]};e.warnToTelemetry?.("No blocking cache for the user id","notifications-blocking-cache",void 0,!0)}isUserBlockedBySpecificTypes(e,t,n,i){const a=this.getUserBlockedState(e,t,n);if(!a)return!1;let o=!1;return Object.keys(a?.blockingReasons).forEach((e=>{i.includes(a?.blockingReasons[e])&&(o=!0)})),e.log(`NotificationsBlockingCache, userId ${t} is blocked for types:, ${i.join(",")} , result: ${o}`),o}}const zme=new RegExp(`^(${Object.values(Lu.V).join("|")})`);function qme(e){return e?function(e){return e.replace(zme,"")}(e.replace(/-/g,"")):""}function Jme(e,t,n,i,a){return{id:"presence-blocking-signal-subscription",runOncePerId:!0,job:async()=>{const o=n.newLogger("PresenceBlockingSignalSubscription","apps-notifications"),{enableNotificationsFiltering:r,enableUserIdMismatchFix:s}=a.get(b.J.Notifications);if(!r)return void o.log(li.f.NotEnabled);const l=await t.query({query:Bme});if(!l.data.me||!l.data.me.presence?.availability)return void o.log("user presence missing");if(!e?.id)return void o.log("user id missing");const c=s?qme(e.id):e.id;Qme(c,i,l.data.me.presence?.availability,o,l.data.me.presence?.activity);const d=t.subscribe({query:Wme,fetchPolicy:"no-cache",variables:{userId:l.data.me.mri,source:"ups"}}).subscribe((e=>{const t=e.data?.presenceUpdateEvent?.availability,n=e.data?.presenceUpdateEvent?.activity;t&&Qme(c,i,t,o,n)}));return()=>{d?.unsubscribe()}}}}function Qme(e,t,n,i,a){t.unblockUserNotificationsByBlockingType(e,Vme.Presence,i),"DoNotDisturb"!==n&&"Busy"!==n||t.blockUserNotifications(e,{[a]:Vme.Presence},i)}const Kme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsGraphItemToastEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"graphItemToastEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"correlationId"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"customIconUrl"}},{kind:"Field",name:{kind:"Name",value:"senderDisplayName"}},{kind:"Field",name:{kind:"Name",value:"senderMri"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"teamsAppId"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"isSquareImage"}}]}}]}}]},Yme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsGraphItemToastImageAsDataUriQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"url"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"credentials"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"toastImageAsDataUri"},arguments:[{kind:"Argument",name:{kind:"Name",value:"url"},value:{kind:"Variable",name:{kind:"Name",value:"url"}}},{kind:"Argument",name:{kind:"Name",value:"credentials"},value:{kind:"Variable",name:{kind:"Name",value:"credentials"}}}]}]}}]},Xme={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsGraphItemMsaUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]};var Zme;!function(e){e.MsGraph="MsGraph"}(Zme||(Zme={}));const epe="msgraph_toast_event_subscription_job";async function tpe(e,t,n,i,a,o){try{const r=o===rG.x4.taco?await async function(e,t,n){const{data:i}=await e.query({query:Xme,variables:{userId:t,displayName:n,profilePictureSize:U3.$D.Small}});return i.msaUserProfilePicture}(e,n,i):a;if(!r)return void t.errorToTelemetry?.(`${li.f.ImageFetchFailed}`,epe,void 0,!0);const s=await e.query({query:Yme,variables:{url:r,credentials:"omit"}});return s?.data.toastImageAsDataUri||void 0}catch(e){return void t.errorToTelemetry?.(`${li.f.ImageFetchFailed} ${e}`,epe,void 0,!0)}}function npe(e,t,n,i,a,o,r){const{enableToastCollections:s}=t.get(b.J.Notifications);return async t=>{if(t.errors){const e=(0,$.u4)(t.errors.map((e=>e.message)).join());return void n.errorToTelemetry?.(`${li.f.SubscriptionFailed} ${e}`,epe,void 0,!0)}const l=t?.data?.graphItemToastEvent;if(!l)return void n.errorToTelemetry?.(`${li.f.EmptyEvent}`,epe,void 0,!0);const c=i.newScenario(H.RG.CrossClientToastView,{startTime:+l.startTimestamp});c.clientId=l.correlationId,c.appendEventData({mainEntityType:Se.py.channels});const d=await async function(e,t,n){const{teamsAppId:i,content:a,senderMri:o,senderDisplayName:r,startTimestamp:s,title:l,customIconUrl:c,isSquareImage:d}=e,u=await tpe(t,n,o,r||"",c,i);return{conversationId:"",quickReply:!1,time:new Date(+s),title:l,text:a,mainImage:u?{alt:"",src:u}:void 0,isSquareImage:d||!1}}(l,o,n);return"MsGraph"===l.type&&d?.title?(s&&(d.collectionId=HJ(e,r,n)),i.hoistScenarioToCore?.(c),a.toasts.showGraphItemNotification(l.correlationId,d)):(n.errorToTelemetry?.(`${li.f.GraphItemToastUnhandledType} ${l.type}`,epe,void 0,!0),void c.stop({reason:li.f.GraphItemToastUnhandledType}))}}function ipe(e,t,n,i,a,o,r){const{enableCommandToHostCommService:s}=t.get(b.J.Core),{enableGraphItemToastNotifications:l,enableBrowserToasts:c,enableInAppNotifications:d,enableInAppNotificationsForChatsAndChannels:u}=t.get(b.J.Notifications,["enableGraphItemToastNotifications","enableBrowserToasts","enableInAppNotifications","enableInAppNotificationsForChatsAndChannels"]);return{id:"graph-item-toast-event-subscription",runOncePerId:!0,job:async()=>{const m=i.newLogger("graphItemToastEventSubscription","apps-notifications");if(!(s||c||d&&u))return void m.log(li.f.NotEnabled);if(!l)return void m.log(`The enableGraphItemToastNotifications flag is not enabled ${li.f.NotEnabled}`);const p=n.subscribe({query:Kme,fetchPolicy:"no-cache"}).subscribe(npe(e,t,m,a,o,n,r));return()=>{p?.unsubscribe()}}}}const ape={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsNotificationsEngineEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notificationsEngineUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"data"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"__typename"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NotificationXDaysOfInactiveStatus"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"lastUserActivityTimestamp"}},{kind:"Field",name:{kind:"Name",value:"timesToBeShown"}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NotificationTflMeetingLinks"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"lastUserActivityTimestamp"}},{kind:"Field",name:{kind:"Name",value:"timesToBeShown"}},{kind:"Field",name:{kind:"Name",value:"meetingLinkPrejoinData"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deeplinkUrl"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"deepLinkId"}}]}}]}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"NotificationConversationsReminder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"paramType"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"lastMessageId"}},{kind:"Field",name:{kind:"Name",value:"lastMessageComposeTime"}},{kind:"Field",name:{kind:"Name",value:"lastMessageAuthor"}},{kind:"Field",name:{kind:"Name",value:"missedThreadsCount"}},{kind:"Field",name:{kind:"Name",value:"userNames"}},{kind:"Field",name:{kind:"Name",value:"timestamp"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"correlationId"}}]}}]}}]};function ope(e){return e.stringTranslate("toastNotifications","toast_messaging_sent_a_remind_message")}function rpe(e){return e.stringTranslate("toastNotifications","toast_messaging_sent_a_meet_now_links_reminder_message")}var spe,lpe,cpe;!function(e){e.NotificationXDaysOfInactiveStatus="NotificationXDaysOfInactiveStatus",e.NotificationTflMeetingLinks="NotificationTflMeetingLinks",e.NotificationConversationsReminder="NotificationConversationsReminder"}(spe||(spe={})),function(e){e.notifications_x_days_of_inactive_status="notifications_x_days_of_inactive_status",e.notifications_tfl_meeting_links="notifications_tfl_meeting_links",e.notifications_conversations_reminder="notifications_conversations_reminder"}(lpe||(lpe={})),function(e){e.asc="asc",e.desc="desc"}(cpe||(cpe={}));const dpe={MAX_BANNER_VIEW_COUNT:3,BANNER_VIEW_COUNT_LOCAL_STORAGE_KEY:"NotificationBannerViewCount",BANNER_ID_WINDOWS_NOTIFICATION:"WindowsNotificationBanner",BANNER_ID_BROWSER_NOTIFICATION:"BrowserNotificationBanner",BANNER_ID_TEAMS_NOTIFICATION:"TeamsNotificationBanner",BANNER_ID_WINDOWS_DND:"WindowsDoNotDisturbBanner"},upe={topic:"topic",text:"text",buttonText:"buttonText"},mpe=1,ppe=0,gpe="CN:",hpe=Object.freeze({FIVE_SECONDS:5e3,TWENTY_SECONDS:2e4,THIRTY_SECONDS:3e4,SIXTY_TWO_SECONDS:62e3}),ype=e=>({id:(0,Re.v4)(),source:C.D.NotificationsActivation,scenarioName:H.RG.ToastActivation,startTimestamp:e??Date.now()}),vpe=(e,t)=>({correlation:t,stateTransition:e?ke.su.flush:ke.su.new,visibilityState:ke.fe.show}),fpe=e=>({correlation:e,stateTransition:ke.su.flush,visibilityState:ke.fe.show}),Spe=e=>({id:e.id,action:e.action,type:e.type}),kpe=e=>e.isIncomingCall?"AcceptIncomingCallThroughPrejoin"===e.targetEntity.dataOptions.actionType?Jae.pC.MeetingNudge:Jae.pC.Calling:"calls"===e.targetEntity?.type?Jae.pC.MSN:Jae.pC.Standard,Cpe=(e,t)=>{const{targetEntity:n,isOnWeb:i,startTimestamp:a}=e,o=n.dataOptions;t||(t=ype(a));return{command:vpe(i,t),entity:Spe(n),entityOptions:{messageId:o.messageId,focusOnLoad:void 0,userContextId:o.userContextId},dataOptions:{...o}}};function bpe(e,t){const{i18n:n,missedConversationsNumber:i,sender:a,otherSenders:o}=t;switch(e){case upe.topic:switch(o){case ppe:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_topic",{sender:a});case mpe:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_two_senders_group_topic",{sender:a});default:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_more_than_two_senders_group_topic",{sender:a,otherSenders:o})}case upe.buttonText:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_button_text");case upe.text:default:return n.stringTranslate("toastNotifications","toast_messaging_conversations_reminder_text",{number:i})}}function wpe(e,t,n,i,a){return{id:"notifications-engine-event-subscription",runOncePerId:!0,job:async()=>{const o=e.watchQuery({query:ape,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i){const a=n.newLogger("notificationsEngineUpdatedEvent","apps-notifications");return async o=>{const r=o.data?.notificationsEngineUpdatedEvent,{data:s,correlationId:l=""}=r||{},{__typename:c}=s||{},d=i.newScenario(H.RG.NotificationsEngineEventSubscriptionJob);if(d.appendEventData({correlationId:l}),!c||!s){const e=`Received a NE event with missed event type or data. Type "${c}"`;return a?.errorToTelemetry&&a.errorToTelemetry(e,"life_web_and_desktop_growth_notification_engine_error",void 0,!0),d.fail({reason:e}),Promise.resolve()}const u=`Received a NE event of type "${c}"`;switch(a?.infoToTelemetry&&a.infoToTelemetry(u,"life_web_and_desktop_growth_notification_engine_info",void 0,!0),d.appendEventData({notificationEngineEventType:c}),d.stop({reason:u}),c){case spe.NotificationXDaysOfInactiveStatus:return e.toasts.showReEngageNudge(l,{conversationId:IX.Rx,title:ope(t),time:new Date,quickReply:!1,messageId:void 0,type:spe.NotificationXDaysOfInactiveStatus});case spe.NotificationTflMeetingLinks:const{meetingLinkPrejoinData:i}=s;Tpe(l,i,e,t,n,c);break;case spe.NotificationConversationsReminder:const a=function(e,{threadId:t,lastMessageAuthor:n,lastMessageId:i,lastMessageComposeTime:a,userNames:o,missedThreadsCount:r,type:s}){const l={i18n:e,missedConversationsNumber:r,sender:n,otherSenders:o.length-1};return{text:bpe(upe.text,l),title:bpe(upe.topic,l),buttonText:bpe(upe.buttonText,l),mainImage:{alt:n,src:pZ.dA},conversationId:t,messageId:i,time:new Date(a),quickReply:!1,type:s}}(t,{...s,type:spe.NotificationConversationsReminder});return e.toasts.showReminder(l,a);default:return Promise.resolve()}}}(t,n,i,a));return()=>{o.unsubscribe()}}}}const Tpe=(e,t,n,i,a,o)=>{const r=a.newLogger("notificationsEngineUpdatedEvent","apps-activity");if(!t)return r?.infoToTelemetry&&r.infoToTelemetry(`Received empty data in "notificationsEngineUpdatedEvent". "meetingLinkPrejoinData" of type "${o}" is not defined correctly: ${t}. CorrelationId: ${e}.`,"life_web_and_desktop_growth_notification_engine_info",void 0,!0),Promise.resolve();const{deeplinkUrl:s,conversationId:l,deepLinkId:c}=t||{};return s&&l&&c?n.toasts.showMeetNowNudge(e,{conversationId:l,title:rpe(i),time:new Date,quickReply:!1,messageId:void 0,deeplinkUrl:s,deepLinkId:c,type:spe.NotificationTflMeetingLinks}):(r?.infoToTelemetry&&r.infoToTelemetry(`Some data is missing in ${t} of type "${o}". CorrelationId: ${e}.`,"life_web_and_desktop_growth_notification_engine_info",void 0,!0),Promise.resolve())},Ipe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsTaskbarBadgeUpdatedEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"taskbarBadgeUpdatedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"badgeCount"}}]}}]}}]},Npe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsTaskbarBadgeUpdatedMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"badgeCount"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"updateTaskbarMTMABadgeCount"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}},{kind:"Argument",name:{kind:"Name",value:"badgeCount"},value:{kind:"Variable",name:{kind:"Name",value:"badgeCount"}}}]}]}}]},Epe=2;function Ape(e,t,n,i,a,o){return{id:"taskbar-badge-event-subscription",runOncePerId:!0,job:async()=>{const r=t.newLogger("TaskbarBadgeEventSubscription","apps-notifications");if(i.config.clientType!==An.Bh.Maglev)return void r.log(uE.vc.NotEnabled);const s=e.subscribe({query:Ipe,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a){let o=0;const{enableIconFlashingTaskbar:r}=i.get(b.J.Notifications);return async i=>{if(i.errors){const t=i.errors.map((e=>e.message)).join();return void e.error(`${uE.vc.SubscriptionFailed} ${(0,$.u4)(t)}`)}if(!i.data?.taskbarBadgeUpdatedEvent)return void e.log(uE.vc.EmptyEvent);const{taskbarBadgeUpdatedEvent:s}=i.data,{badgeCount:l}=s;e.log(`${uE.Bd.UpdatedEvent} badgeCount: ${l}`);try{const{data:i}=await n.mutate({mutation:Npe,variables:{accountId:a,badgeCount:l}}),s=i?.updateTaskbarMTMABadgeCount;if(e.log(`New badge count: ${l} last badgeCount: ${o} update result: ${s}`),r&&l>o&&s){const i=await(t?.loadModule("windowcontrols")),a=await(i?.getWindowByTag?.(ni.px.Main));await async function(e,t,n,i){t.log("Flash Frame event");const a=await n.query({query:Bme,fetchPolicy:"no-cache"});if(!a.data.me||!a.data.me.presence?.availability)return void t.log("User presence missing");const o=a.data.me.presence?.availability;if(i&&"DoNotDisturb"!==o){const t=await(e?.loadModule("windowcontrols"));await(t?.flashFrame?.(i,Epe))}else t.log(`User state is ${o}`)}(t,e,n,a)}o=l}catch(t){e.log(`Error on setting badge ${t}`)}}}(r,n,e,a,o?.id));return async t=>{switch(s.unsubscribe(),t){case"quit":case"signout":case"switch_user":try{await e.mutate({mutation:Npe,variables:{accountId:o?.id,badgeCount:0}})}catch(e){r.log(`Error on badge update mutation ${e}`)}}}}}}const _pe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsActivitySettingsSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activitySettingsChangedEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"subCategoryPageId"},value:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"settings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"error"}},{kind:"Field",name:{kind:"Name",value:"settingsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]}}]},Fpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsActivitySettingsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activitySettings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}},{kind:"Argument",name:{kind:"Name",value:"subCategoryPageId"},value:{kind:"Variable",name:{kind:"Name",value:"subCategoryPageId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"error"}},{kind:"Field",name:{kind:"Name",value:"settingsList"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"key"}},{kind:"Field",name:{kind:"Name",value:"value"}}]}}]}}]}}]};function Dpe(e,t,n,i,a,o){return{id:"user-settings-signal-subscription",runOncePerId:!0,job:async()=>{const r=a.newLogger("UserSettingsSignalSubscription","apps-notifications"),{showGenericNotificationsSoundSetting:s,showNotificationsCallsSoundSetting:l,enableOSDnDSupportForCustomToasts:c,enableUserIdMismatchFix:d}=o.get(b.J.Notifications);if(!s||!l)return void r.log(li.f.NotEnabled);if(!e?.id)return void r.log("user id missing");const u=d?qme(e.id):e.id,m=await t.query({query:Fpe,variables:{appId:"notifications"},fetchPolicy:"no-cache"}).catch((()=>(r.error("Failed to fetch initial user settings"),{data:void 0})));n.updateUserActivitySettingsCache(u,m.data?.activitySettings.settingsList,!!c,i,r);const p=t.subscribe({query:_pe,variables:{appId:"notifications"},fetchPolicy:"no-cache"}).subscribe((e=>{n.updateUserActivitySettingsCache(u,e.data?.activitySettingsChangedEvent?.settings?.settingsList,!!c,i,r)}));return()=>{p?.unsubscribe()}}}}var Ppe=n(426185);const Mpe=2;function xpe(e,t,n,i,a){return{id:"taskbar-legacy-badge-event-subscription",runOncePerId:!0,job:async()=>{const o=t.newLogger("TaskbarLegacyBadgeEventSubscription","apps-notifications");if(i.config.clientType!==An.Bh.Maglev)return void o.log(uE.vc.NotEnabled);const r=new Ppe.a(t,a,n),s=e.subscribe({query:Ipe,fetchPolicy:"no-cache"}).subscribe(function(e,t,n,i,a){let o=0;const{enableIconFlashingTaskbar:r}=a.get(b.J.Notifications);return async a=>{if(a.errors){const t=a.errors.map((e=>e.message)).join();return void e.log(`${uE.vc.SubscriptionFailed} ${(0,$.u4)(t)}`)}if(!a.data?.taskbarBadgeUpdatedEvent)return void e.log(uE.vc.EmptyEvent);const{taskbarBadgeUpdatedEvent:s}=a.data,{badgeCount:l}=s;if(e.log(`${uE.Bd.UpdatedEvent} badgeCount: ${l}`),r&&l>o){const t=await(n?.loadModule("windowcontrols")),a=await(t?.getWindowByTag?.(ni.px.Main));await async function(e,t,n,i){t.log("Flash Frame event");const a=await n.query({query:Bme,fetchPolicy:"no-cache"});if(!a.data.me||!a.data.me.presence?.availability)return void t.log("User presence missing");const o=a.data.me.presence?.availability;if(i&&"DoNotDisturb"!==o){const t=await(e?.loadModule("windowcontrols"));await(t?.flashFrame?.(i,Mpe))}else t.log(`User state is ${o}`)}(n,e,i,a)}return o=l,t.showBadgeCount(l)}}(o,r,n,e,a));return async e=>{switch(s.unsubscribe(),e){case"quit":case"signout":await r.resetBadge()}}}}}var Rpe=n(174057);function jpe(){return Notification.permission}var Lpe=n(668712);async function Ope(e,t,n,i,a,o,r){const s=t.newLogger("WarnUserNoticeJob","apps-notifications"),{disableWarnUserNotificationBanner:l,enableWarnUserNotificationDialog:c,enableBrowserWarnUserBanner:d}=o.get(b.J.Notifications),{enableCustomNotificationsForCalls:u,enableCustomNotificationsOnDesktop:m}=o.get(b.J.Core);if(!a)return void s.errorToTelemetry?.("AuthenticationUserContext is not found for warn user notice job","app_notifications_warn_user_notice");const p=Number(function(e,t){const n=t?.get(e);return n||void 0}(dpe.BANNER_VIEW_COUNT_LOCAL_STORAGE_KEY,r));if(p&&p>=dpe.MAX_BANNER_VIEW_COUNT)return void s.log("Warn user banner was not displayed due to the maximum view count reached");const g=new Rpe.b(t,i),h=await async function(e){const t=await e.getGlobalNotificationSettingsAsync();if(t)return t.global===Lpe.mG.Enabled}(g);let y=0;if(!1===h){if(c&&(u&&m?e.esp.displaySurface("customNotificationsWarning"):e.esp.displaySurface("notificationsWarning")),!l){!function(e,t,n){e.shell.showBanner({id:dpe.BANNER_ID_WINDOWS_NOTIFICATION,source:C.D.NotificationSettings,bannerScenario:n,intentLevel:"Neutral",cause:"SettingsWarnUser",text:t.stringTranslate("toastNotifications",n),action:{text:t.stringTranslate("toastNotifications","toast_warn_user_button"),command:{entity:{type:Se.py.externalnavigation,action:Se.uk.empty,id:RJ.Y.Notifications}},dismissOnAction:!0},dismissable:!0,duration:0})}(e,n,u&&m?"toast_global_windows_custom_notifications_banner":"toast_global_windows_notifications_banner"),y=p?p+1:1}y&&function(e,t,n,i){i?.trySet(e,t,"Desktop"),n.log(`Notification banner view count ${t} saved to local storage.`)}(dpe.BANNER_VIEW_COUNT_LOCAL_STORAGE_KEY,y.toString(),s,r)}d&&"granted"!==jpe()&&"denied"!==jpe()&&function(e,t){e.shell.showBanner({id:dpe.BANNER_ID_BROWSER_NOTIFICATION,source:C.D.NotificationSettings,bannerScenario:"toast_browser_user_notice_banner",intentLevel:"Neutral",cause:"SettingsWarnUser",text:t.stringTranslate("toastNotifications","toast_browser_user_notice_banner"),action:{text:t.stringTranslate("toastNotifications","toast_browser_notification_button"),command:{entity:{type:Se.py.externalnavigation,action:Se.uk.manage,id:RJ.Y.Notifications}},dismissOnAction:!0},dismissable:!0,duration:0})}(e,n)}async function $pe(e,t,n,i){const a=i.newLogger("subscribeAndCacheDnDData","apps-notifications"),o=function(e,t,n){return i=>{e.setOsDoNotDistubState(i,t,n)}}(t,n,a);await async function(e,t,n){const i=await Upe(e,t,1);if(t.log(`${li.f.UpdateBlockingCacheWithOSDnD} Fetched the initial OS 'Do not disturb' state: ${i}`),i){const e=function(e,t){switch(e){case Lpe.lX.AlarmsOnly:return Lpe.ZD.AlarmsOnly;case Lpe.lX.PriorityOnly:return Lpe.ZD.PriorityOnly;case Lpe.lX.Off:return Lpe.ZD.Unrestricted;default:return t.warn(`${li.f.UpdateBlockingCacheWithOSDnD} Focus assist state '${e}' was not recognised. Converting to '${Lpe.ZD.Unrestricted}'`),Lpe.ZD.Unrestricted}}(i,t);n(e)}}(e,a,o),e.registerForNotificationModeChanged(o)}async function Upe(e,t,n){if(n>2)return void t.error(`${li.f.UpdateBlockingCacheWithOSDnD} Could not fetch the initial state of OS Do not Disturb on the second attempt, skipping`);let i;try{i=await e.getFocusAssistStateAsync()}catch{return t.warn(`${li.f.UpdateBlockingCacheWithOSDnD} Could not fetch the initial state of OS Do not Disturb, trying again`),void Upe(e,t,n+1)}return i}function Bpe(e,t){e.shell.showBanner({id:dpe.BANNER_ID_WINDOWS_DND,source:C.D.NotificationSettings,bannerScenario:"toast_focus_assist_banner",intentLevel:"Neutral",cause:"SettingsWarnUser",text:t.stringTranslate("toastNotifications","toast_focus_assist_banner"),action:{text:t.stringTranslate("toastNotifications","toast_focus_assist_button"),command:{entity:{type:Se.py.settingsstore,action:Se.uk.view,id:RJ.Y.Notifications},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:{source:C.D.BannerNotification}}},dismissOnAction:!0},dismissable:!0,duration:0})}function Wpe(e,t,n,i,a,o,r,s,l){const{enableWarnUserNotificationSettings:c,enableOSDnDSupportForCustomToasts:d}=i.get(b.J.Notifications);return{id:"warn-notifications-settings-banner-job",runOncePerId:!0,job:async()=>{c&&Ope(e,t,n,a,o,i,l),d&&await async function(e,t,n,i,a,o,r){const s=t.newLogger("setupHonorDnDEvents","apps-notifications");if(!o?.id)return void s.log("user id missing");const{enableUserIdMismatchFix:l}=r.get(b.J.Notifications),c=l?qme(o.id):o.id;(async function(e,t,n,i,a){const o=e.newLogger("warn-notifications-settings-banner-job","apps-notifications");if(!a)return void o.log(`${li.f.OSDnDBannerJobUserFetchFailed} User ID is empty, skipping OS DND banner job`);i.registerOnCacheUpdatedCallback(a,(function(e){e?Bpe(t,n):t.shell.dismissBanner(dpe.BANNER_ID_WINDOWS_DND,C.D.NotificationSettings)})),i.shouldDropToastBasedOnDnD(a,o)&&Bpe(t,n)})(t,e,n,i,c),$pe(a,i,c,t)}(e,t,n,r,s,o,i)}}}const Hpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsConnectedCallsSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"connectedCallsChangedEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"state"}}]}}]}}]},Vpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsNotificationsMuteNotificationsDuringMeetingEventSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"muteNotificationsDuringMeetingEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isNotificationMuted"}},{kind:"Field",name:{kind:"Name",value:"teamsCallId"}}]}}]}}]},Gpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsNotificationsMuteNotificationsDuringMeetingsGlobalQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"muteNotificationsDuringMeetings"},arguments:[{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isNotificationMuted"}},{kind:"Field",name:{kind:"Name",value:"teamsCallId"}}]}}]}}]},zpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsMuteNotificationsDuringMeetingMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isNotificationMuted"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"muteNotificationsDuringMeeting"},arguments:[{kind:"Argument",name:{kind:"Name",value:"isNotificationMuted"},value:{kind:"Variable",name:{kind:"Name",value:"isNotificationMuted"}}},{kind:"Argument",name:{kind:"Name",value:"teamsCallId"},value:{kind:"Variable",name:{kind:"Name",value:"teamsCallId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isNotificationMuted"}}]}}]}}]};var qpe,Jpe=n(979242);function Qpe(e,t,n,i,a){return{id:"meetings-blocking-signal-subscription",runOncePerId:!0,job:async()=>{const o=n.newLogger("SettingsAndMeetingsBlockingSignalSubscription","apps-notifications"),{enableNotificationsFilteringInMeetingsAndCalls:r,enableMuteAllNotificationsSetting:s,enableUserIdMismatchFix:l}=a.get(b.J.Notifications);if(!r&&!s)return void o.log(li.f.NotEnabled);const c=new Ype(t);if(!e?.id)return void o.error("User data not available");const d=l?qme(e.id):e.id,u=r?function(e,t,n,i,a){const o=async e=>{const{isNotificationMuted:n,teamsCallId:o}=e.data?.muteNotificationsDuringMeetingEvent||{};n?(a.log("CN: -> SeetingsAndMeetingsSubscription: adding blocking cache because user entered a meeting"),t.blockUserNotifications(i,{[o]:Vme.MeetingOrCall},a)):(a.log("CN: -> SeetingsAndMeetingsSubscription: removing blocking cache because user left from a meeting"),t.unblockUserNotifications(i,{[o]:Vme.MeetingOrCall},a))},r=e.subscribe({query:Hpe,fetchPolicy:"no-cache"}).subscribe((async r=>{const s=r.data?.connectedCallsChangedEvent;if(s?.state===qpe.Connected){n.register(s?.id,o);(await e.query({query:Gpe,variables:{teamsCallId:s?.id}})).data.muteNotificationsDuringMeetings.isNotificationMuted&&t.blockUserNotifications(i,{[s?.id]:Vme.MeetingOrCall},a)}else s?.id&&n.unregister(s.id),t.unblockUserNotifications(i,{[s?.id]:Vme.MeetingOrCall},a)}));return r}(t,i,c,d,o):void 0,m=await t.query({query:Fpe,variables:{appId:qG.NN.Notifications},fetchPolicy:"no-cache"}).catch((()=>(o.error("Failed to fetch initial user settings"),{data:void 0})));let p=m.data?.activitySettings.settingsList.find((e=>"HideNotificationDuringCallsAndMeetings"===e?.key))?.value===Jpe.H.On;s&&Kpe(i,d,o,m.data?.activitySettings.settingsList);const g=t.subscribe({query:_pe,variables:{appId:qG.NN.Notifications},fetchPolicy:"no-cache"}).subscribe((async e=>{const n=e.data?.activitySettingsChangedEvent;if(!n)return;s&&Kpe(i,d,o,n?.settings?.settingsList);const a=n?.settings?.settingsList.find((e=>"HideNotificationDuringCallsAndMeetings"===e?.key))?.value===Jpe.H.On;p!==a&&(p=a,await c.triggerIndividualMuteNotificationDuringMeetings(t,p))}));return()=>{u?.unsubscribe(),g?.unsubscribe()}}}}function Kpe(e,t,n,i){const a=i?.find((e=>"muteGenericNotifications"===e?.key))?.value===Jpe.H.On;a?e.blockUserNotifications(t,{[Vme.GeneralMute]:Vme.GeneralMute},n):e.unblockUserNotifications(t,{[Vme.GeneralMute]:Vme.GeneralMute},n);const o=i?.find((e=>"allowUrgentNotifications"===e?.key))?.value===Jpe.H.Off;a&&o?e.blockUserNotifications(t,{[Vme.GeneralMuteIncludingUrgentAndPriority]:Vme.GeneralMuteIncludingUrgentAndPriority},n):e.unblockUserNotifications(t,{[Vme.GeneralMuteIncludingUrgentAndPriority]:Vme.GeneralMuteIncludingUrgentAndPriority},n)}!function(e){e[e.Connected=3]="Connected",e[e.Disconnected=7]="Disconnected"}(qpe||(qpe={}));class Ype{constructor(e){this.dataClient=e,this.subscriptions=new Map}register(e,t){const n=this.dataClient.subscribe({query:Vpe,variables:{teamsCallId:e},fetchPolicy:"no-cache"}).subscribe(t);this.subscriptions.set(e,(()=>{n.unsubscribe(),this.subscriptions.delete(e)}))}unregister(e){const t=this.subscriptions.get(e);t?.()}async triggerIndividualMuteNotificationDuringMeetings(e,t){const n=[];return[...this.subscriptions.keys()].forEach((i=>{n.push(e.mutate({mutation:zpe,variables:{teamsCallId:i,isNotificationMuted:t}}))})),Promise.all(n)}}function Xpe(e,t,n,i){return({context:{authenticationUser:a,client:o,coreSettings:r,entityCommanding:s,hostCommunicationService:l,i18n:c,scenarioFactory:d,userTrackingService:u,localStorage:m,loggerFactory:p,platformService:g,notificationsHandler:h}})=>{i.initialize(h,c);const y=new Rpe.b(p,l),v=o,{enableCoherenceBadgeForWindows:f,enableCoherenceBadgeForMac:S}=r.get(b.J.Notifications),k=[Dpe(a,v,n,t,p,r),Jme(a,v,p,e,r),Qpe(a,v,p,e,r),Ume(a,v,p,l,r),ipe(a,r,v,p,d,s,u),Wpe(s,p,c,r,l,a,t,y,m)];return r.get(b.J.CdlWorker)?.enableNotificationsEngine&&k.push(wpe(v,s,c,p,d)),f||S?k.push(Ape(v,p,l,g,r,a)):k.push(xpe(v,p,l,g,r)),k}}const Zpe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsResetTaskbarBadgeOnAccountSwitchMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"accountId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resetTaskbarBadgeOnAccountSwitch"},arguments:[{kind:"Argument",name:{kind:"Name",value:"accountId"},value:{kind:"Variable",name:{kind:"Name",value:"accountId"}}}]}]}}]};function ege(){return({context:{client:e,authenticationUser:t,hostCommunicationService:n,loggerFactory:i,platformService:a,isMainWindow:o,coreSettings:r}})=>{const{enableCoherenceBadgeForWindows:s,enableRequestNotificationAuthorizationJob:l}=r.get(b.J.Notifications),c=[];if(s){const n=e;c.push(function(e,t,n,i,a){return{id:"reset-taskbar-badge-on-account-switch",runOncePerId:!0,job:async()=>{const o=t.newLogger("ResetTaskbarBadgeOnAccountSwitch","apps-notifications");n.config.clientType===An.Bh.Maglev?a&&await e.mutate({mutation:Zpe,variables:{accountId:i?.id}}):o.log(uE.vc.NotEnabled)}}}(n,i,a,t,o))}return l&&c.push(function(e,t){return{id:"request-notification-authorization",runOncePerId:!0,job:async()=>{const n=e.newLogger("RequestNotificationAuthorizationJob","apps-notifications"),i=await t.loadModule("toasts");i?.requestNotificationAuthorization?(i.requestNotificationAuthorization(),n.log("Notification authorization requested.")):n.warn("API not available.")}}}(i,n)),c}}var tge;!function(e){e.alertSound="alertSound",e.incomingCallsAndMeetingStartSound="IncomingCallsAndMeetingStartSound",e.PlayNotificationSoundsWhenBusyOrInMeetings="PlayNotificationSoundsWhenBusyOrInMeetings",e.respectOsDnDForCustomToasts="respectOsDnDForCustomToasts",e.useTeamsChimeForToasts="useTeamsChimeForToasts",e.notificationStyleList="notificationStyleList",e.alertSoundType="alertSoundType"}(tge||(tge={}));const nge={[tge.alertSound]:"On",[tge.incomingCallsAndMeetingStartSound]:"On",[tge.respectOsDnDForCustomToasts]:"Off",[tge.notificationStyleList]:"Purple",[tge.PlayNotificationSoundsWhenBusyOrInMeetings]:"On",[tge.useTeamsChimeForToasts]:"On",[tge.alertSoundType]:"Default"};const ige={[y.dt.activity]:dA.wh.activityToast,[y.dt.calls]:dA.wh.callingToast,[y.dt.campaignnotifications]:dA.wh.campaignnotificationsToast,[y.dt.channels]:dA.wh.channelsToast,[y.dt.chats]:dA.wh.chatToast,[y.dt.extensions]:dA.wh.extensionsToast,[y.dt.reminders]:dA.wh.remindersToast,[y.dt.communities]:dA.wh.communitiesToast,[y.dt.communitiesevents]:dA.wh.communitiesEventsToast,[y.dt.callingdeeplink]:dA.wh.callingToast,[y.dt.settingsstore]:dA.wh.activityToast,[y.dt.communitiesjoinrequest]:dA.wh.communitiesToast,[y.dt.communitiesmembers]:dA.wh.communitiesToast,[y.dt.alerts]:dA.wh.alertsToast},age=e=>{const{targetEntity:t}=e.entityOptions;switch(t.type){case y.dt.communities:case y.dt.communitiesjoinrequest:case y.dt.communitiesmembers:const e=t?.dataOptions?.teamId;return e;default:return}},oge=(e,t,n)=>{if(!t.createDatabag)return;const i=t.createDatabag(),{targetEntity:a}=e.entityOptions;switch(a.type){case y.dt.calls:i.callingToastType=(a?.dataOptions).toastType;break;case y.dt.communities:case y.dt.communitiesjoinrequest:i.communitiesToastType=a?.dataOptions?.toastType;break;case y.dt.reminders:case y.dt.chats:case y.dt.callingdeeplink:i.chatToastType=a?.dataOptions?.toastType}return n&&(i.isCustomNotification=n),i};const rge=(e,t)=>{const n=e.collectionId||e.targetEntity.dataOptions?.userContextId;return t?qme(n):n},sge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsTriggerCallingToastActionMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"notificationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"actionType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"triggerCallingToastAction"},arguments:[{kind:"Argument",name:{kind:"Name",value:"notificationId"},value:{kind:"Variable",name:{kind:"Name",value:"notificationId"}}},{kind:"Argument",name:{kind:"Name",value:"actionType"},value:{kind:"Variable",name:{kind:"Name",value:"actionType"}}}]}]}}]};var lge,cge;!function(e){e.DND="DND",e.Presenting="Presenting",e.MeetingOrCall="MeetingOrCall",e.OSDnD="OSDnd",e.SuppressedDueToSilentLaunch="SuppressedDueToSilentLaunch",e.SuppressedByGeneralMute="SuppressedByGeneralMute",e.SuppressedByGeneralMuteIncludingUrgentAndPriority="SuppressedByGeneralMuteIncludingUrgentAndPriority"}(lge||(lge={})),function(e){e.UrgentToast="UrgentToast",e.IncomingCall="IncomingCall",e.SingleAccount="SingleAccount",e.AllowedByPresence="AllowedByPresence",e.AllowedInMeetingOrCall="AllowedInMeetingOrCall"}(cge||(cge={}));const dge=(e,t,n,i,a,o,r,s,l)=>{const{enableNotificationsFiltering:c}=e.get(b.J.Notifications),{enableHonoringPresenceForNotification:d}=e.get(b.J.Calling);if(!c)return t.log(li.f.NotEnabled),n;const u=n.entityOptions,{dropNotification:m,reason:p}=mge(o,r,u,e,t,l);return t.log(`Is toast dropped: ${m} because "reason: ${p}"`),!m&&u?.isUrgent&&a.recordPanelAction({panelRegion:dA.Ai.notificationsApp,actionScenario:dA.Tk.priorityToastIssued}),m?(function(e,t,n,i){const a=e.entityOptions,o=[{scenarioName:H.RG.CrossClientToastView,scenarioId:e.command.correlation.id},{scenarioName:a.crossClientScenarioName,scenarioId:a.callId||e.command.correlation.id},{scenarioName:H.RG.WebToastShow,scenarioId:e.command.correlation.id}];o.forEach((({scenarioName:e,scenarioId:a})=>{if(e&&a){const o=n.findScenarioByNameAndId(e,a);o?o.incomplete({reason:t}):i.errorToTelemetry?.(`AppsNotifications: Could not find scenario with name: ${e} and id: ${a}`,"app_notifications_scenario_not_found",void 0,!0)}}))}(n,p,i,t),void uge(a,p)):(d&&u.isIncomingCall&&function(e,t,n){n.infoToTelemetry?.("[sendDroppedCallStatus] Notification was not dropped by Presenting/DND; Sending canNotifyForCallingNotification action","app_notifications");try{e.mutate({mutation:sge,variables:{notificationId:t.entity.id,actionType:"canNotifyForCallingNotification"}})}catch(e){n.errorToTelemetry?.("[sendDroppedCallStatus] Could not send call dropped state mutation","app_notifications",{errors:`${e.message}`},!0)}}(s,n,t),n)},uge=(e,t)=>{const n={[lge.DND]:dA.Yu.toastDiscardedByDND,[lge.MeetingOrCall]:dA.Yu.toastDiscardedByMeetingOrCall,[lge.Presenting]:dA.Yu.toastDiscardedByPresenting,[lge.OSDnD]:dA.Yu.toastDiscardedByOSDND,[lge.SuppressedDueToSilentLaunch]:dA.Yu.toastDiscardedBySilentLaunch,[lge.SuppressedByGeneralMute]:dA.Yu.toastDiscardedByTeamsMuteNotifications,[lge.SuppressedByGeneralMuteIncludingUrgentAndPriority]:dA.Yu.toastDiscardedByTeamsMuteUrgentAndPriorityNotifications};e.recordPanelAction({panelRegion:dA.Ai.notificationsApp,actionScenario:dA.Tk.toastDiscarded,actionScenarioType:n[t]})},mge=(e,t,n,i,a,o)=>{const{disableNotificationsForSilentLaunch:r,enableUserIdMismatchFix:s}=i.get(b.J.Notifications),{launchIntent:l}=i.get(b.J.HostCapabilities);if(r&&"LaunchCoreNoSystemTray"===l)return{dropNotification:!0,reason:lge.SuppressedDueToSilentLaunch};const c=function(e,t,n,i){if(n.isIncomingCall)return;const a=e.getBlockedState(i),o=a?.blocks?.find((e=>e.blockingReasons[Vme.GeneralMute]&&e.userId===t)),r=a?.blocks?.find((e=>e.blockingReasons[Vme.GeneralMuteIncludingUrgentAndPriority]));if(i.log(`isBlockedByGeneralMuteSetting: ${o}, any blocks present: ${!!a?.blocks}`),i.log(`isUrgentOrPriorityNotificationBlockedByGeneralSetting: ${r}, any blocks present: ${!!a?.blocks}`),o&&!n.isUrgent)return{dropNotification:!0,reason:lge.SuppressedByGeneralMute};if(o&&r&&n.isUrgent)return{dropNotification:!0,reason:lge.SuppressedByGeneralMuteIncludingUrgentAndPriority};return}(e,o,n,a);if(c)return c;const d=n?.isUrgent;if(d)return{dropNotification:!1,reason:cge.UrgentToast};const u=function(e,t){const n=e.getBlockedState(t),i=n?.blocks?.find((e=>e.blockingReasons.Presenting));return t.log(`isNotificationBlockedByPresenting: presentingBlockedState: ${i}, any blocks present: ${!!n?.blocks}`),!!i}(e,a);if(u)return{dropNotification:!0,reason:lge.Presenting};if(n.isIncomingCall&&!i.get(b.J.Notifications)?.onlyPriorityCallsInDnD)return{dropNotification:!1,reason:cge.IncomingCall};if(function(e,t,n){const i=kpe(t);if(i!==Jae.pC.Standard)return!1;const a=e.getBlockedState(n),o=a?.blocks?.find((({blockingReasons:e})=>Object.keys(e).find((t=>e[t]===Vme.MeetingOrCall))));return!!o}(e,n,a))return{dropNotification:!0,reason:lge.MeetingOrCall};const m=function(e,t,n,i){const a=rge(t,i);if(!a)return!1;const o=e.getUserBlockedState(n,a,i);return!!o?.blockingReasons.DoNotDisturb}(e,n,a,Boolean(s));return m?{dropNotification:!0,reason:lge.DND}:i.get(b.J.Notifications)?.enableOSDnDSupportForCustomToasts&&function(e,t,n,i){if(!i)return void n.log("User id is missing, isNotificationBlockedByOsDnD returns false");const a=e.shouldDropToastBasedOnDnD(i,n),o=t?.targetEntity.type===y.dt.calls;if(o)return!1;return a}(t,n,a,o)?{dropNotification:!0,reason:lge.OSDnD}:{dropNotification:!1,reason:cge.AllowedByPresence}};class pge{constructor(e,t,n){this.setTimeout=e,this.clearTimeout=t,this.timer=0,this.remainingTimeOnScreen=0,this.startTimeInMS=0,this.toast=n.toast,this.callback=n.callback,this.remainingTimeOnScreen=this.toast.displayDuration||hpe.FIVE_SECONDS}cancelTimer(){this.clearTimeout(this.timer)}resetTimer(){this.remainingTimeOnScreen=this.toast.displayDuration||hpe.FIVE_SECONDS,this.cancelTimer(),this.startTimer()}pauseTimer(){const e=Date.now()-this.startTimeInMS;this.remainingTimeOnScreen-=e,this.cancelTimer()}startTimer(e){this.startTimeInMS=Date.now(),e&&(this.remainingTimeOnScreen=e),this.timer=this.setTimeout((()=>{this.callback()}),this.remainingTimeOnScreen)}}class gge{constructor(){this.registeredCallbacks=[],this.dismissCallbacks=[],this.priorityMap={[Jae.gP.Call]:new Map,[Jae.gP.High]:new Map,[Jae.gP.Normal]:new Map},this.timers=new Map,this.prevActiveToasts=[],this.defaultTimerForStandardNotifications=hpe.FIVE_SECONDS,this.window=(0,L.J)()}overrideDefaultTimerForStandardNotifications(e){this.defaultTimerForStandardNotifications=e||hpe.FIVE_SECONDS}registerTelemetryServices(e,t){this.logger=e,this.scenarioFactory=t}registerOnStateChangedCallback(e){this.registeredCallbacks.push(e),this.generateUpdatedActiveState()}registerOnDismissCallback(e){this.dismissCallbacks.push(e)}pinToast(e){const t=this.prevActiveToasts.find((({id:t})=>t===e));t&&(t.pinned=!0,this.timers.get(e)?.pauseTimer())}unpinToast(e){const t=this.prevActiveToasts.find((({id:t})=>t===e));t&&(t.pinned=!1,this.timers.get(e)?.startTimer(),this.generateUpdatedActiveState())}addIncomingToast(e){const t=this.getPriority(e);e.displayDuration=this.getDisplayDuration(e);const n=this.priorityMap[t].get(e.id);if(n?.pinned)return this.findAssociatedScenarios(e,(e=>e.incomplete({reason:"updateToPinnedToast"}))),void this.log(`Discarding ${e.id} toastType: ${e.type} as it is an update to a pinned toast`);const i=e.type===Jae.pC.Calling?void 0:hpe.THIRTY_SECONDS;this.resetTimer(e,i),this.priorityMap[t].set(e.id,e),this.generateUpdatedActiveState(e),this.log(`Adding ${e.id} toastType: ${e.type} to Notification queue`)}dismissToast(e,t=!0,n=!1){const i=this.getPriority(e);this.priorityMap[i].delete(e.id);const a=this.prevActiveToasts.findIndex((({id:t})=>t===e.id));this.prevActiveToasts.splice(a,1),this.cancelTimer(e),this.dismissCallbacks.forEach((t=>{t(e,n?"timeout":"unknown")})),t&&(this.generateUpdatedActiveState(),n&&!e.shown&&this.findAssociatedScenarios(e,(e=>{e.incomplete({reason:"noSlotAvailable"})})),this.log(`${e.id}: Dismiss ${n?"by timer":""}`))}log(e){if(!this.logger)return;let t=0;for(const e of Object.keys(this.priorityMap)){t+=this.priorityMap[e].size}this.logger.log(`CN:${e} activeToasts: ${this.prevActiveToasts.length} totalToasts: ${t}`)}generateUpdatedActiveState(e){let t=[];for(const e of Object.keys(this.priorityMap)){const n=this.priorityMap[e];t=t.concat(Array.from(n.values()))}let n=-1;for(let e=this.prevActiveToasts.length-1;e>=0;e--)if(this.prevActiveToasts[e].pinned){n=e;break}const i=-1===n?[]:this.prevActiveToasts.slice(0,n+1),a={};i.map((e=>a[e.id]=e)),t=t.filter((e=>!a[e.id])),t=t.slice(0,3-i.length);const o=i.concat(t);this.replaceActiveToasts(o,e),o.forEach((e=>e.shown=!0));for(const e of this.registeredCallbacks)e({activeToasts:[...o].reverse()})}replaceActiveToasts(e,t){const n={};e.map((e=>n[e.id]=e));const i={};this.prevActiveToasts.map((e=>i[e.id]=e));for(const e of Object.keys(i)){const t=i[e];n[e]||(this.dismissToast(t,!1),delete i[e])}for(const e of Object.keys(n)){const t=n[e];t.type===Jae.pC.Calling||i[e]||this.resetTimer(t)}t&&n[t.id]&&t.type!==Jae.pC.Calling&&this.resetTimer(t),this.prevActiveToasts=e}resetTimer(e,t){const n=this.timers.get(e.id);if(n)return void n.resetTimer();const i=new pge(this.window.setTimeout,this.window.clearTimeout,{toast:e,callback:()=>{this.dismissToast(e,!0,!0)}});this.timers.set(e.id,i),i.startTimer(t)}cancelTimer(e){this.timers.get(e.id)?.cancelTimer(),this.timers.delete(e.id)}getPriority(e){switch(e.type){case Jae.pC.Calling:case Jae.pC.MeetingNudge:return Jae.gP.Call;case Jae.pC.MSN:return Jae.gP.High;default:return Jae.gP.Normal}}getDisplayDuration(e){if(e.displayDuration)return e.displayDuration;switch(e.type){case Jae.pC.Calling:case Jae.pC.MeetingNudge:return hpe.SIXTY_TWO_SECONDS;case Jae.pC.MSN:return hpe.TWENTY_SECONDS;default:return this.defaultTimerForStandardNotifications}}findAssociatedScenarios(e,t){const n=[H.RG.CrossClientToastView,H.RG.WebToastShow];e.type===Jae.pC.Calling&&e.telemetry.callingScenarioName&&n.push(e.telemetry.callingScenarioName),n.forEach((n=>{const i=this.scenarioFactory?.findScenarioByNameAndId(n,e.telemetry.toastScenarioClientId);i&&t(i)}))}}const hge=(e,t)=>{const n=kpe(t);return{id:t.targetEntity.id||e,mainImageSrc:t.mainImage?.src||"",title:t.title,composedTitle:t.composedTitle,text:t.text,composedText:t.composedText,type:n,isIncomingCall:Boolean(t.isIncomingCall),isUrgent:Boolean(t.isUrgent),actions:t.buttons?.map((e=>({text:e.text,style:e.style,img:e.image?.src,targetEntity:e.targetEntity}))),headerTitle:t.headerTitle,headerSubTitle:t.headerSubtitle,headerImageSrc:t.headerImage?.src||"",ringtone:t.ringtone,deviceLabel:t.deviceLabel,deviceId:t.deviceId,applicationDeviceId:t.applicationDeviceId,deviceLabelSecondary:t.deviceLabelSecondary,deviceIdSecondary:t.deviceIdSecondary,applicationDeviceIdSecondary:t.applicationDeviceIdSecondary,targetEntity:t.targetEntity,isSilent:t.isSilent,textInput:t.textInput,telemetry:{callingScenarioName:t.crossClientScenarioName,callId:t.callId,toastType:t.targetEntity.dataOptions.toastType,toastScenarioClientId:e},mtmaHeader:t.mtmaHeader,displayDuration:t.displayDuration,externalAppIconType:t.externalAppIconType,isSquareImage:Boolean(t.isSquareImage)}},yge=async(e,t,n,i)=>{if(!e)return i.errorToTelemetry?.("Toast activated with notificationsHandler unset","app_notifications_activation_handler_not_found"),n;const a=n.entityOptions,o=a?.targetEntity?.id;if(!o||!a)return i.errorToTelemetry?.("Toast activated with toast id unset","app_notifications"),n;const r=hge(o,a);e&&a.targetEntity.id&&t?.dismissToast(r,"ActivatedByUser");const s=((e,t)=>{switch(e.type){case y.dt.chats:case y.dt.channels:return Cpe({isOnWeb:!0,targetEntity:e,startTimestamp:t.startTimestamp?+t.startTimestamp:Date.now()},t);case y.dt.calls:default:return}})(a.targetEntity,n.command.correlation);s&&await e.activateNotification(s)};class vge{constructor(e,t,n){this.entityCommand=e,this.isRtl=t,this.scenario=n,this.shown=!1}getWebToastOptions(){return this.entityCommand.entityOptions}getNotificationOptionsPayload(){const e=this.entityCommand.entityOptions;return{notificationTitle:e.title,notificationOptions:{body:e.text,icon:e.mainImage?.src,timestamp:new Date(e.time).getTime(),tag:void 0,requireInteraction:!0,dir:this.isRtl?Jae.uP.Rtl:Jae.uP.Auto}}}registerGetNotificationCallback(e){this.getNotificationCallback=e}getNotification(){return this.getNotificationCallback?.()}addCloseNotificationListener(e){this.closeNotificationCallback=e,this.getNotification()?.addEventListener("close",e)}closeNotification(){const e=this.getNotification();this.closeNotificationCallback&&(e?.removeEventListener("close",this.closeNotificationCallback),this.closeNotificationCallback=void 0),e?.close()}}const fge=(e,t)=>{t.registerOnDismissCallback((t=>{e?.dismissToast(t,"DismissedWithInAppToast")}))},Sge=e=>{e.registerOnDismissCallback(((t,n)=>{if("timeout"===n){const n=e.getNotification(t.id);n&&(n.closeNotification(),n.scenario.stop({reason:"Timeout"}),e.deleteNotification(t.id))}}))},kge=e=>{e.registerOnStateChangedCallback((async({activeToasts:t})=>{Cge(t,e),bge(t,e),await wge(t,e)}))},Cge=(e,t)=>{for(const n of t.getToastIds()){const i=t.getNotification(n);!e.find((e=>e.id===n))&&i&&(i.closeNotification?.(),i.scenario.stop(),t.deleteNotification(n))}},bge=(e,t)=>{e.length&&e.forEach((n=>{const i=n.id,a=t.getNotification(i);a&&a.shown&&n.id!==e[e.length-1].id&&(a.closeNotification(),a.scenario.stop({reason:"DismissedByHigherPriorityNotification"}),t.deleteNotification(i))}))},wge=async(e,t)=>{if(e.length){const n=e[e.length-1];if(t.isExistingToast(n.id)){const e=t.getNotification(n.id);if(e&&!e.shown&&t.notificationsHandler){e.shown=!0;switch(await t.notificationsHandler.tryShowBrowserNotification(e)){case"queued":e.scenario.mark(H.ck.BrowserToastStepRequested),e.addCloseNotificationListener((()=>{t.dismissToast(n,"DismissedByUser")}));break;case"skippedNoPermissions":t.dismissToast(n,"SkippedNoPermissions");break;case"skippedAppInFocus":t.dismissToast(n,"SkippedAppInFocus");break;default:t.dismissToast(n,"SkippedReasonUnknown")}}}}},Tge=!0;function Ige(e,t,n,i,a,o){if(!function(e,t,n,i){if(!t||!i)return!0;const{enableNotificationsAdvancedSoundSettings:a}=e.get(b.J.Notifications),o=Nge(t[tge.PlayNotificationSoundsWhenBusyOrInMeetings],n);if(a&&!o)return!1;return!0}(i,t,n,o))return!1;if(!function(e,t){const{showGenericNotificationsSoundSetting:n,showNotificationsCallsSoundSetting:i}=t.get(b.J.Notifications);if(e&&i)return!0;if(!e&&n)return!0;return!1}(e,i))return n.log("Allowing to play toast sounds as the sound check feature is disabled"),Tge;if(!t)return n.warn("Returning default value. SettingsCache is undefined"),Tge;if(e){const e=Nge(t[tge.incomingCallsAndMeetingStartSound],n);return void 0!==a&&!1!==e?!a:e}return Nge(t[tge.alertSound],n)}function Nge(e,t){const n=function(e,t){switch(e){case"On":return!0;case"Off":return!1;default:return t.warn(`Fall back to play toast sounds as the setting is ${e}`),Tge}}(e,t);return t.log(`Allowed to play sound: ${n}`),n}var Ege=n(138633);const Age={Default:"msteams-asset://teams_notification.mp3",MeetingStarted:"msteams-asset://teams_meet_up_reminder.mp3"};var _ge;function Fge(e,t,n,i){if(!n)return e;if(function(e,t){if(!e.entityOptions)return t.error("Invalid command, no entity options. Skip adding ringtone"),!0;if(e.entityOptions?.ringtone)return t.log("Ringtone already exists on the command"),!0;return!1}(e,i))return e;const a=e.entityOptions;if(!a.isIncomingCall){const e=(a?.targetEntity?.dataOptions).toastType||"";a.ringtone=function(e,t,n){const i=e===_ge.MeetingStarted||e===_ge.HuddleMeetingStart||e===_ge.MeetingStartFromLobby;if(i)return Age.MeetingStarted;const{enableNotificationSoundPicker:a}=n.get(b.J.Notifications);if(!a)return Age.Default;return(0,Ege.so)(t).soundFile}(e,n.alertSoundType,t),i.log(`Added ringtone "${a.ringtone?.split("//")[1]}" to toast`)}return e}!function(e){e.HuddleMeetingStart="HuddleMeetingStart",e.MeetingStarted="MeetingStart",e.MeetingStartFromLobby="MeetingStartFromLobby"}(_ge||(_ge={}));const Dge=36;async function Pge(e,t,n,i,a,o,r){const s=function(e,t,n,i,a){const o=e.entityOptions;if(!o)return n.error("Trying to apply ringtone data to toast command: entity options are missing"),e;const{enableUserIdMismatchFix:r,enableNotificationsAdvancedSoundSettings:s}=t.get(b.J.Notifications),l=rge(o,!!r);if(!l)return n.error("Trying to apply ringtone data to toast command: userId not found"),e;const c=i.getUserActivitySettings(l,Boolean(r)),d=s&&a.isUserBlockedBySpecificTypes(n,l,!!r,[Vme.Presence,Vme.MeetingOrCall]),u=Ige(o.callId,c,n,t,o.isSilent,!!d);o.isSilent=!u;const{enableUseTeamsChimeForToasts:m}=t.get(b.J.Notifications);return o.useTeamsChime=!!m&&function(e){return!(!e||"On"!==e.useTeamsChimeForToasts)}(c),n.log(`isSilent: ${o.isSilent} useTeamsChime: ${o.useTeamsChime} (enableUseTeamsChimeForToasts: ${m})`),e.entityOptions=o,Fge(e,t,c,n)}(e,t,n,i,a);if(!s.entityOptions)return s;const l=s.entityOptions;l.mainImage?.src===Jae.RQ.Alert&&(l.mainImage={alt:"",src:pZ.Md});try{l.mtmaHeader=await async function(e,t,n,i){i||n.warn("User tracking service is undefined, the system cannot determine MTMA context but the header will be created");if(i&&i.getAccountMode()!==OE.b.MultipleAccounts)return void n.log("User is logged in to one account, skipping MTMA header");const{enableMtmaHeaderForCustomToasts:a}=t.get(b.J.Notifications);if(!a)return void n.log("MTMA Header feature is disabled");const{email:o,tenantName:r}=await async function(e,t){const n=await e.query({query:Mme});if(!n||!n.data||!n.data.me||!n.data.me.email&&!n.data.me.tenantName)return t.errorToTelemetry?.("User data not available","app_notifications_enrich_command",void 0,!0),{email:void 0,tenantName:void 0};return{email:n.data.me.email,tenantName:n.data.me.tenantName}}(e,n);if(!o)return void n.warnToTelemetry?.("Email is undefined, skipping creation of MTMA header","app_notifications_enrich_command",void 0,!0);if(!r)return n.warnToTelemetry?.("Tenant name is undefined, MTMA header will be created without tenant name for TFL","app_notifications_enrich_command",void 0,!0),Mge(o,"",Dge);const s=Mge(o,r,Dge);return n.log(`Created formatted header. Length: ${s.length}, args intial length: {email: ${o.length}, tenant name length: ${r.length}}`),s}(o,t,n,r)}catch(e){n.warnToTelemetry?.("Error getting MTMA header:","app_notifications_enrich_command",e,!0)}return s}function Mge(e,t,n){const i=Math.floor(.6*n)-1;let a=e.length<i?e.length:i;const o=n-a-2-1;return t.length<o&&(a=n-t.length-2-1),e.length>i&&(e=`${e.slice(0,a-3).trim()}...`),t.length>o&&(t=`${t.slice(0,o-3).trim()}...`),t?`${e} - ${t}`:`${e}`}const xge=(e,t,n,i,a)=>{((e,t)=>{fge(e,t),Sge(e),kge(e)})(a,i);return o=>{const{entityCommand:r,entityCommand:{entityOptions:s,entity:{type:l,action:c}},notificationsHandler:d,requestContext:{scenarioFactory:u,loggerFactory:m,coreSettings:p,userBiService:g,client:h,userTrackingService:y},windowProvider:v}=o,f=m.newLogger("NotificationsOnBeforeCommandHandled","apps-notifications");if(l===Se.py.externalnavigation&&c===Se.uk.empty)return Rge(p,f,r,v);if(l===Se.py.externalnavigation&&c===Se.uk.manage)return(async(e,t)=>(Notification.requestPermission().then((n=>{e.log(`Permision notification ${n}`),"granted"===n&&t?.showPermissionConfirmationBrowserNotification()})),Promise.resolve(void 0)))(f,d);const{enableCustomNotificationsForCalls:S}=p.get(b.J.Core,["enableCustomNotificationsForCalls"]),{enableInAppNotificationsForCalls:k}=p.get(b.J.Notifications,["enableInAppNotificationsForCalls"]),{enableBrowserToasts:C}=p.get(b.J.Notifications),w=S||k||C;return l===Se.py.toasts?r.entity.action===Se.uk.confirm?yge(d,a,r,f):r.command.visibilityState===ke.fe.hide?w?Oge(i,a,r,!!k,p,d):Promise.resolve(r):r.command.visibilityState===ke.fe.show?jge(p,f,r,u,g,e,t,n,a,h,d,y,s):(f.warn(`Unsupported combination of action ${r.entity.action} and visibilityState ${r.command.visibilityState} for EntityType.toasts`),Promise.resolve(r)):(f.warn(`Entity type is not of EntityType.toasts or EntityType.externalnavigation, received one is: ${r.entity.type}`),Promise.resolve(r))}},Rge=async(e,t,n,i)=>{const{enableWarnUserNotificationSettings:a}=e.get(b.J.Notifications);return a?(i?.open("ms-settings:notifications","_blank"),t.log("Go to OS settings event command triggered"),Promise.resolve(void 0)):(t.log("Warn user before command disabled by flag"),Promise.resolve(n))},jge=async(e,t,n,i,a,o,r,s,l,c,d,u,m)=>{let p;$ge(i,n,d);const{enableBrowserToasts:g,enableUserIdMismatchFix:h}=e.get(b.J.Notifications,["enableBrowserToasts","enableUserIdMismatchFix"]);g&&(p={browserToastScenario:Uge(i,n)});const y=i.findScenarioByNameAndId(H.RG.CrossClientToastView,n.command.correlation.id),v=d?.isCustomNotificationsEnabled(n.entityOptions);y&&y.appendEventData({isCustomNotification:v});const f=m?.targetEntity.dataOptions.userContextId||"",S=h?qme(f):f;let k=dge(e,t,n,i,a,o,r,c,S);return k?(k=await Pge(k,e,t,s,o,c,u),((e,t,n)=>{const{entityOptions:i}=e,a=i?.targetEntity.type;if(a){const i=oge(e,t,n);t.recordPanelView({panelLaunchMethod:BP.$g.notification,panelRegion:dA.Ai.toast,dataBag:i,appName:"apps-notifications",panelType:ige[a],teamId:age(e)}),i?.dispose()}})(k,a,v),function(e,t,n,i,a,o){if(!e)return void a.warn("Entity options are not found, skipping creating OS DnD coachmark");const r=n.getSettingStateForUser(o,tge.notificationStyleList)===Jpe.H.Native,s=e.targetEntity.type,l=ige[s];l!==dA.wh.callingToast&&!t.isHonoringDnDEnabled(o,a)&&t.isOSDnDEnabled(a)&&r&&i.recordPanelAction({panelRegion:dA.Ai.toast,panelType:l,actionScenario:dA.Tk.toastIssuedDuringOsDndOn,actionScenarioType:dA.Yu.issueToastDuringDnDOnForExNativeToastsUsers})}(k.entityOptions,r,s,a,t,S),p&&Lge(d,l,n,p.browserToastScenario),Promise.resolve(k)):(p?.browserToastScenario.stop({reason:"SkippedByFilters"}),Promise.resolve(k))},Lge=(e,t,n,i)=>{if(!e)return void i.stop({reason:"ErrorMissingNotificationsHandler"});const a=n.entityOptions,o=a.targetEntity.id;if(!o)return void i.stop({reason:"ErrorMissingToastId"});const r=new vge(n,t.isRtl,i),s=hge(o,a);if(t.isExistingToast(o)){const e=t.getNotification(o);e?.scenario.stop({reason:"DismissedToUpdateContent"}),e?.getNotification()?.close()}i.mark(H.ck.BrowserToastStepAddedToStateContainer),t.addIncomingToast(s,r)},Oge=async(e,t,n,i,a,o)=>{const{enableBrowserToasts:r}=a.get(b.J.Notifications),s=n.entity.id,l=n.entityOptions;if(!s||!l)return Promise.resolve(void 0);const c=hge(s,l);return r&&o&&l.targetEntity.id&&t?.dismissToast(c,"DismissedByApplication"),e.dismissToast(c),Promise.resolve(i?n:void 0)},$ge=(e,t,n)=>{const i=e.newScenario(H.RG.WebToastShow);i.clientId=t.command.correlation.id;const a=t.entityOptions;return i.appendEventData({mainEntityType:a?.targetEntity?.type,isCustomNotification:n?.isCustomNotificationsEnabled(a)||n?.isInAppNotificationsEnabled(a)}),e.hoistScenarioToCore?.(i),i},Uge=(e,t)=>{const n=e.newScenario(H.RG.BrowserToast);return n.appendEventData({mainEntityType:t.entityOptions?.targetEntity?.type}),e.hoistScenarioToCore?.(n),n};var Bge=n(774514);const Wge={eventHandlers:{onEventReceived:async e=>{const{eventInput:t,notificationsHandler:n,requestContext:{coreSettings:i,loggerFactory:a,hostCommunicationService:o}}=e,r=t.event,s=a.newLogger("NotificationsEventHandlers","apps-notifications"),{enableInAppNotifications:l}=i.get(b.J.Notifications,["enableInAppNotifications"]);if(r.originator!==Bge.kn)return s.errorToTelemetry?.(`Unhandled event ${t.event.type} is not a notification event`,"app_notifications_unhandled_event"),Promise.resolve(void 0);let c,d;switch(r.type){case Bge.uS.activateChatToast:c=r.data?.(),d=Cpe({...c,isOnWeb:!!l});break;case Bge.uS.activateCallToast:c=r.data?.(),d=(e=>{const{targetEntity:t,isOnWeb:n,startTimestamp:i}=e,a=t.dataOptions,o=ype(i);return{command:vpe(n,o),entity:Spe(t),dataOptions:{...a},entityOptions:{...a}}})({...c,isOnWeb:!!l});break;case Bge.uS.activateGraphItemToast:c=r.data?.(),d=(e=>{const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions,a=ype(n);return{command:fpe(a),entity:Spe(t),dataOptions:{...i}}})({...c,isOnWeb:!!l});break;case Bge.uS.activateCommunitiesToast:c=r.data?.(),d=(e=>{const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions;return{command:{correlation:ype(n),stateTransition:ke.su.flush,visibilityState:ke.fe.show},entity:Spe(t),entityOptions:{...i},dataOptions:i}})({...c,isOnWeb:!!l});break;case Bge.uS.activateRemindersToast:c=r.data?.(),d=(e=>{const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions,a=ype(n);return{command:vpe(!0,a),entity:{...Spe(t),type:Se.py.chats},entityOptions:{messageId:i.messageId,focusOnLoad:void 0,...i},dataOptions:{...i}}})({...c,isOnWeb:!!l});break;case Bge.uS.activateAlerts:c=r.data?.(),d=function(e){const{targetEntity:t,startTimestamp:n}=e;return{command:{correlation:ype(n),stateTransition:ke.su.forceFlush,visibilityState:ke.fe.show,targetWindow:ke.PH.main},entity:{type:Se.py.default,action:Se.uk.default},dataOptions:{...t.dataOptions}}}({...c,isOnWeb:!!l});break;case Bge.uS.files:(async(e,t)=>{try{const t=await e.loadModule("files");if(!t?.openLocalRecordingFolder)throw Error("filesModule is not available.");await t.openLocalRecordingFolder()}catch(e){t.errorToTelemetry?.("Open local recording folder failed.","cmd_recordings_open_local_recording_folder_failed")}})(o,s);break;case Bge.uS.resizeWindow:c=r.data?.(),n.resizeNotificationsWindow(c);break;case Bge.uS.focusWindow:n.focusNotificationsWindow();break;case Bge.uS.sendTelemetry:c=r.data?.(),n.sendTelemetry(c);break;case Bge.uS.sendDismissToastTelemetry:c=r.data?.(),n.sendDismissToastTelemetry(c);break;case Bge.uS.settingsstore:c=r.data?.(),d=function(e){const{targetEntity:t,startTimestamp:n}=e,i=t.dataOptions,a=i?.subMenu;return{entity:{type:Se.py.settingsstore,action:Se.uk.default,...a?{id:a}:{}},command:{stateTransition:ke.su.flush,visibilityState:ke.fe.show,correlation:ype(n)},dataOptions:{...i}}}({...c,isOnWeb:!!l});break;case Bge.uS.offsetNotificationsWindow:c=r.data?.(),n.offsetNotificationsWindow(c.offset);break;default:s.errorToTelemetry?.(`Unhandled event ${t.event.type}`,"app_notifications_unhandled_event")}return d&&n.activateNotification(d),Promise.resolve(void 0)}}},Hge=({coreSettings:e,stateContainer:t,NotificationsRenderer:n,loggerFactory:i,scenarioFactory:a,host:o})=>{const{entity:{id:r},getEntityOptions:s}=(0,GK.sV)(),l=(0,BK.useNovaEventing)(),c=hO.useRef(!1),d=hO.useMemo((()=>{const e=i.newLogger("NotificationsApp","apps-notifications");return t.registerTelemetryServices(e,a),e}),[i,a,t]);d.log(`${gpe}Parsing notification details`);const u=s(Se.py.toasts,Se.uk.view);let m;if(r){c.current||(!function(e,t){const{delayCustomNotificationsWindowCreation:n,enableCustomNotificationWindowOffset:i,customNotificationWindowOffset:a}=e.get(b.J.Notifications,["delayCustomNotificationsWindowCreation","enableCustomNotificationWindowOffset","customNotificationWindowOffset"]);n&&i&&t.generateEvent({event:Bge.U3.offsetNotificationsWindow({offset:a})})}(e,l),c.current=!0),m=hge(u.telemetryClientId||"",u);const{id:t,telemetry:{callingScenarioName:n,callId:i,toastType:a,toastScenarioClientId:o}}=m;l.generateEvent({event:Bge.U3.sendTelemetry({toastScenarioClientId:o,stepName:H.ck.RootNotificationRenderBegin,callId:i,callingScenarioName:n,toastType:a})}),d.log(`${gpe}${t}:Beginning to render notification. correlationId=${o} callId=${i} type=${m.type} toastType=${a} scenario=${n}`)}else d.errorToTelemetry?.(`${gpe}: Missing entityId in Toast Command of type ${u.targetEntity.type}`,"app_notifications",void 0,!0);return(0,gO.t)(n,{host:o,logger:d,scenarioFactory:a,stateContainer:t,uiToast:m})};const Vge=e=>{if(Gge(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:zge(e),endEntity:null}},Gge=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=e===ke.lO.minimal,o=i===Se.py.toasts,r=[Se.uk.delete,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},zge=({entity:e})=>e,qge=()=>({mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0}}}),Jge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsNewWindowMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"createNotificationsWindow"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]};const Qge={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsNotificationsRestoreTaskbarBadgeOnMainWindowOpenMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"restoreTaskbarBadgeOnMainWindowOpen"}}]}}]};const Kge=({context:{hostCommunicationService:e,coreSettings:t,client:n,loggerFactory:i}})=>{const a=i.newLogger("NotificationsOnExperienceJob","apps-notifications"),o=n,{enableCustomNotificationsForCalls:r,enableCustomNotificationsForChats:s,enableCustomNotificationsOnDesktop:l}=t.get(b.J.Core),{enableRestoreTaskbarBadgeOnWindowOpen:c}=t.get(b.J.Notifications),{allowPrivateCallingPolicy:d}=t.get(b.J.Calling),u=[];if(c&&u.push(function(e,t,n){return{id:"restore-taskbar-badge-on-main-window-open",runOncePerId:!0,job:async()=>{const i=t.newLogger("RestoreTaskbarBadgeOnMainWindowOpenJob","apps-notifications"),a=await n.loadModule("windowcontrols");let o=!0;const r=a?.registerForWindowVisibilityChanged?.((async({visible:t,windowId:n})=>{if(n===await(a?.getWindowByTag?.(ni.px.Main)))return t&&!1===o?(o=!0,i.log("Main Window is visible again. Restoring taskbar badge"),void await e.mutate({mutation:Qge})):void(o=t);i.debug(`windowId: ${n} is not the main window. Ignoring this event.`)}));return()=>{r&&r()}}}}(n,i,e)),!l||!r&&!s)return a.debug(`${gpe}CreateNotificationsWindowOnExperienceWarmDisabled`),u;if(!d)return a.debug(`${gpe}CreateNotificationsWindowSkippedAsCallingNotEnabledByPolicy`),u;const{delayCustomNotificationsWindowCreation:m,enableCustomNotificationWindowOffset:p,customNotificationWindowOffset:g}=t.get(b.J.Notifications,["delayCustomNotificationsWindowCreation","enableCustomNotificationWindowOffset","customNotificationWindowOffset"]);return m?(a.log(`${gpe}Creation of notifications window is delayed until 1st notification arrives.`),u):(a.log(`${gpe}Attempting to create notifications window on experience warm.`),u.push(function(e,t){return{id:"create-notifications-window-on-experience-warm-job",runOncePerId:!0,job:()=>(t.newLogger("NotificationsWindowCreation","apps-notifications").log("CN:Issuing mutation to create notifications window."),e.mutate({mutation:Jge,fetchPolicy:"no-cache"}),()=>{})}}(o,i)),p&&u.push(function(e,t,n){return{id:"reposition-notifications-window-on-experience-warm-job",runOncePerId:!0,job:async()=>{const i=t.newLogger("NotificationsWindowReposition","apps-notifications");i.log("Calling pie api to reposition notification window at the bottom");const a=await e.loadModule("toasts");if(a){if(a.offsetNotificationsPanel)return a.offsetNotificationsPanel(n||0);i.error("toasts.offsetNotificationsPanel method not available")}else i.error("cannot load toasts module")}}}(e,i,g)),u)};class Yge{constructor(){this.notificationSettingsCache={}}updateUserActivitySettingsCache(e,t,n,i,a){if(!t)return void a.error("Empty activity settings, update failed");const o=function(e,t){const n={...nge},i=new Map;for(const t of e)t&&i.set(t.key.toLowerCase(),t.value);for(const[e,a]of Object.entries(n)){const o=i.get(e.toLowerCase());o?(n[e]=o,t.debug(`Assigned ${e} setting value ${a}`)):t.debug(`Setting ${e} not found in user settings, fallback to ${a}`)}return n}(t,a);if(a.log(`Settings successfully updated for id ${e}. Generic toasts sound value: ${o[tge.alertSound]}, calling toasts: ${o[tge.incomingCallsAndMeetingStartSound]}`),this.notificationSettingsCache[e]=o,n){const t=this.getSettingStateForUser(e,tge.respectOsDnDForCustomToasts);i.setHonorDnDSettingState(t,a,e)}}getUserActivitySettings(e,t){const n=Object.entries(this.notificationSettingsCache),[i,a]=n.find((([n])=>{const i=t?n:n.replace(/-/g,""),a=t?e:e.replace(/-/g,"");return i.includes(a)}))||[];return a}getSettingStateForUser(e,t){return this.notificationSettingsCache[e]?.[t]}}class Xge{constructor(){this.browserNotificationStateContainer=new gge,this.toastIdToNotification=new Map}initialize(e,t){this.notificationsHandler=e,this.i18n=t}get isRtl(){return!!this.i18n?.isRtl}isExistingToast(e){return!!this.toastIdToNotification.has(e)}getToastIds(){return this.toastIdToNotification.keys()}getNotification(e){return this.toastIdToNotification.get(e)}setNotification(e,t){this.toastIdToNotification.set(e,t)}deleteNotification(e){this.toastIdToNotification.delete(e)}registerOnStateChangedCallback(e){this.browserNotificationStateContainer.registerOnStateChangedCallback(e)}registerOnDismissCallback(e){this.browserNotificationStateContainer.registerOnDismissCallback(e)}addIncomingToast(e,t){this.setNotification(e.id,t),this.browserNotificationStateContainer.addIncomingToast(e)}dismissToast(e,t){t&&this.toastIdToNotification.get(e.id)?.scenario.appendEventData({reason:t}),this.browserNotificationStateContainer.dismissToast(e)}}class Zge{constructor(){this.doNotDisturbState=Lpe.ZD.Unrestricted,this.honorOsDoNotDisturbSetting={},this.cacheUpdatedCallbacks={}}registerOnCacheUpdatedCallback(e,t){this.cacheUpdatedCallbacks[e]?this.cacheUpdatedCallbacks[e].push(t):this.cacheUpdatedCallbacks[e]=[t]}setOsDoNotDistubState(e,t,n){n.log(`New OS 'Do not Disturb' state set to ${e}`),this.doNotDisturbState=e,this.cacheUpdatedCallbacks[t]&&this.cacheUpdatedCallbacks[t].forEach((e=>e(this.shouldDropToastBasedOnDnD(t,n))))}setHonorDnDSettingState(e,t,n){t.log(`Setting new state of OS DnD ${e}`),this.honorOsDoNotDisturbSetting[n]=e,this.cacheUpdatedCallbacks[n]&&this.cacheUpdatedCallbacks[n].forEach((e=>e(this.shouldDropToastBasedOnDnD(n,t))))}isHonoringDnDEnabled(e,t){const n=this.honorOsDoNotDisturbSetting[e];switch(t.log(`Current 'Honor DnD' setting state: ${n}`),n){case Jpe.H.On:return!0;case Jpe.H.Off:return!1;default:return t.log("Current setting state is undefined, returning isHonoringDnDEnabled: false"),!1}}isOSDnDEnabled(e){switch(this.doNotDisturbState){case Lpe.ZD.AlarmsOnly:case Lpe.ZD.PriorityOnly:return e.log("isOSDnDEnabled: true"),!0;case Lpe.ZD.Unrestricted:return!1;default:return e.log("Current OS DnD state is unrecognised, returning isOSDnDEnabled: false"),!1}}shouldDropToastBasedOnDnD(e,t){return t.log(`[shouldDropToastBasedOnDnD] Honor OS DnD: ${this.honorOsDoNotDisturbSetting[e]}, OS DnD state: ${this.doNotDisturbState}. Checking for userId ${e}`),this.isHonoringDnDEnabled(e,t)&&this.isOSDnDEnabled(t)}}const ehe=()=>Promise.all([n.e(586535),n.e(309799),n.e(290718),n.e(751060),n.e(474133),n.e(853863)]).then(n.bind(n,418356));function the(){const e=new Gme,t=new Zge,n=new Yge,i=new gge,a=new Xge,o=()=>null;return{...Wge,getAppViewEntities:Vge,getAppViewEntitiesProps:qge,getAppWindowFeatures:()=>Pme.windowFeatures||{},onUserWindowPreWarm:ege(),onBeforeCommandHandled:xge(e,t,n,i,a),onPreWarm:Xpe(e,t,n,a),manifest:Pme,render:async({loggerFactory:e,scenarioFactory:t,host:n,coreSettings:a})=>{try{const{NotificationsRenderer:o}=await(0,ac.mT)(ehe,"notifications-app",t),{standardNotificationDuration:r}=a.get(b.J.Notifications);return r&&!isNaN(r)&&Number(r)>0&&i.overrideDefaultTimerForStandardNotifications(Number(r)),(0,gO.t)(Hge,{coreSettings:a,loggerFactory:e,stateContainer:i,NotificationsRenderer:o,scenarioFactory:t,host:n})}catch(t){return e.newLogger("NotificationsApp","apps-notifications").errorToTelemetry?.(`CN:Error in notification app render method: ${t.message}`,"app_notifications",void 0,!0),(0,gO.t)(o,{})}},onExperienceWarm:Kge}}const nhe={id:ose.x8,name:"TeamsGalleryApp",supportedEntities:[Se.py.teamsgallery,Se.py.teams],supportedRenderModes:[Mt.S.Main,Mt.S.Rail],getDefaultCommand:()=>({action:Se.uk.view,type:Se.py.teamsgallery})},ihe=e=>{if(ahe(e))return ohe(e)?{subNavEntity:rhe(e),headerEntity:she(e),startEntity:lhe(e),mainEntity:che(e),endEntity:dhe(e)}:null},ahe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.teamsgallery,Se.py.teams].includes(i),r=[Se.uk.create,Se.uk.default,Se.uk.list,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},ohe=()=>!0,rhe=({entity:e})=>e,she=()=>null,lhe=()=>null,che=({entity:e})=>e,dhe=()=>null,uhe=({areEmptySlotsTransparent:e,coreSettings:t})=>({subNavEntity:{[Mt.S.Rail]:{areSlotShadowsDisabled:e,isBackgroundTransparent:!!t?.get(b.J.Core).enableTransparentLeftRail||e,isColorSchemeDefaultBackground3:!e}}}),mhe=()=>Promise.all([n.e(986797),n.e(392718),n.e(585604),n.e(355611),n.e(715369)]).then(n.bind(n,77869));const phe={id:"com.microsoft.teams.entitymoreinfo",actors:["entitymoreinfo"],name:"EntityMoreInfoApp",supportedRenderModes:[Mt.S.Configurations]},ghe={gqlTypeName:"EntityMoreInfoAppViewState",queryFieldName:"entityMoreInfoAppViewState",navigationalFieldDefaultValues:{},nonNavigationalFieldDefaultValues:{readyToBootstrapLPC:!1},computedValues:void 0},hhe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEntityMoreInfoUsersForConversationQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mriArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"conversationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isShortProfileRequested"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"peoplePickerFilters"}},type:{kind:"NamedType",name:{kind:"Name",value:"PeoplePickerFiltersInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isSharedChannel"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"hostTenantId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getUsersForConversation"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mriArray"},value:{kind:"Variable",name:{kind:"Name",value:"mriArray"}}},{kind:"Argument",name:{kind:"Name",value:"conversationId"},value:{kind:"Variable",name:{kind:"Name",value:"conversationId"}}},{kind:"Argument",name:{kind:"Name",value:"isShortProfileRequested"},value:{kind:"Variable",name:{kind:"Name",value:"isShortProfileRequested"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}},{kind:"Argument",name:{kind:"Name",value:"peoplePickerFilters"},value:{kind:"Variable",name:{kind:"Name",value:"peoplePickerFilters"}}},{kind:"Argument",name:{kind:"Name",value:"isSharedChannel"},value:{kind:"Variable",name:{kind:"Name",value:"isSharedChannel"}}},{kind:"Argument",name:{kind:"Name",value:"hostTenantId"},value:{kind:"Variable",name:{kind:"Name",value:"hostTenantId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"companyName"}},{kind:"Field",name:{kind:"Name",value:"tenantName"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"userType"}},{kind:"Field",name:{kind:"Name",value:"isFederated"}},{kind:"Field",name:{kind:"Name",value:"xtapUser"}}]}}]}}]},yhe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEntityMoreInfoLpcStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"lpcState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"isLivePersonaCardInitialized"}}]}}]}}]},vhe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsEntityMoreInfoAuthenticationUsersQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"AuthenticationUserFilter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"authenticationUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"tenantId"}}]}}]}}]}}]};var fhe=n(845123);const She=e=>{switch(e){case"Card":return"Card";case"Expanded":return"ExpandedView";default:return}},khe=e=>{const{ariaLabel:t,coreSettings:n,eventType:i,externalAppSessionCorrelationId:a,host:o,hostConversationId:r,hostTenantId:s,isSharedChannel:l,locationToOpen:c,logger:d,personNodeId:u,tabIndex:m,userBiService:p,smtp:g,upn:h,aadObjectId:y,displayName:v,personaType:f,userId:S}=e;let k,C="Card";switch(i){case"mouseout":case"mousedown":default:k="MouseHover";break;case"click":case"dblclick":k="MouseClick",C=c??"ExpandedView";break;case"keydown":k="KeyboardPress",C=c??"ExpandedView";break;case"app-request":k="AppRequest",C=c??"ExpandedView"}const w=()=>{o?.document.dispatchEvent(new MouseEvent("mousemove"))},T=!!n.get(b.J.People).isInIframe;return{cardParameters:{personaInfo:{identifiers:{PersonaType:f||"NotResolved",HostAppPersonaId:(0,fhe.Bg)({userId:S,isSharedChannel:!!l,hostTenantId:s,hostConversationId:r,personNodeId:u}),TeamsMri:S,Smtp:g,Upn:h,AadObjectId:y},displayName:v},behavior:{cardPlacementMode:"AnchorSide",locationToOpen:C,onCardOpen:()=>{o?.document.addEventListener("mouseleave",w);const e={panelRegion:dA.Ai.popover,panelType:dA.wh.LivePersonaCard};p?.recordPanelView(e,d)},onCardClose:()=>{o?.document.removeEventListener("mouseleave",w);const e={actionGesture:dA.uS.mouseleave,actionOutcome:dA.$K.closePanel,actionScenarioType:dA.Yu.people,actionScenario:dA.Tk.closePanel,moduleName:dA.rA.lpcClose,panelRegion:dA.Ai.popover,panelType:dA.wh.LivePersonaCard};p?.recordPanelAction(e,d)},shouldDeferCardOpenToParentWindow:T},externalAppSessionCorrelationId:a,ariaLabel:t,clientScenario:"MicrosoftTeams_MultiWindow",openCardTriggerType:k,cardOpenTime:Date.now()},tabIndex:m}},Che=async({commandData:{isSharedChannel:e,conversationId:t,smtp:n,upn:i,aadObjectId:a,userId:o,personNodeId:r},tenantId:s,coreSettings:l,client:c,logger:d,host:u})=>{const m=await(async(e,t,n,i,a,o,r,s)=>{const{enableTflSms:l}=o.get(b.J.Messaging),{showPersonCardForSMSUser:c,showPersonCardForXTapUser:d}=o.get(b.J.People),{isCallingScreenInteractive:u,disablePstnPersonaCard:m}=o.get(b.J.Calling),{enableFlyoutInlineChat:p,enableSimplifiedFeaturesInFlyoutChat:g}=o.get(b.J.Flyout);if(!u||p&&g)return!1;if(i)return!0;if(e&&iZ.eo.isTFLSmsMri(e))return!!l&&!!c;if(e&&iZ.eo.isTFLOffNetworkUser(e))return!1;if(m&&(0,AQ.EG)(e))return!1;if(t&&!d){const t=(0,fhe.we)(e,n,a,"lpc-persona-container",s);if(!t)return s.warn("xTap profile Query variables are not defined for a shared channel"),!1;const{data:i}=await r.query({query:hhe,variables:t});if(!i||!i.getUsersForConversation)return s.warn("xTap profile Query returned null data"),!1;const o=i.getUsersForConversation,l=!!(o.length>0&&o[0]&&iZ.eo.isFederatedUser(o[0])&&o[0].xtapUser);return!l||!!d&&l}return!0})(o,!!e,t,r,s,l,c,d),{data:{lpcState:p}}=await c.query({query:yhe}),g=!!(o||r||a||n||i);return!!(g&&m&&p?.isLivePersonaCardInitialized&&u?.LPC)||(d.warn(`Lpc is not ready, \n          isIdentifierProvided: ${g},\n          isLpcAllowed: ${!m},\n          isLivePersonaCardInitialized: ${p?.isLivePersonaCardInitialized}, \n          host.LPC:${!u?.LPC}\n        `),!1)},bhe=async e=>{const{data:{authenticationUsers:t}}=await e.query({query:vhe,variables:{filter:{isAuthenticated:!0}}});return t[0]?.profile?.tenantId},whe=(e,t,n)=>n?.LPC.openCard(new n.DOMRect(e.left,e.top,e.width,e.height),t);var The=n(749321),Ihe=n(611741);const Nhe={onCommandReceived:async e=>{const{appViewState:t,commandInput:n,host:i,requestContext:{client:a,coreSettings:o,loggerFactory:r},userBiService:s}=e,{command:{action:l,actor:c,data:d}}=n,u=r.newLogger("EntityMoreInfo onCommandReceived","apps-entity-more-info"),{enableEntityMoreInfo:m}=o.get(b.J.Core);if(u.log(`Command {action:${n.command.action}} received.`),!phe.actors.includes(c))return void u.error(`Command {action:${n.command.action}, actor:${n.command.actor}} is sent to the wrong App.`);const p=t;if(m&&!p.readyToBootstrapLPC?.read())return u.error(`Command failed, LPC is not bootstrapped for command: {action:${n.command.action}}}.`),void p.readyToBootstrapLPC?.update(!0);const g=async(e,t)=>!!await Che({client:a,commandData:e,coreSettings:o,host:i,logger:u,tenantId:t})||(u.error(`Command failed, LPC is not ready for command: {action:${n.command.action}}}.`),!1);switch(l){case ZV:{const e=d,t=e.tenantId||await bhe(a);if(!await g(e,t))return;const n=khe({...e,locationToOpen:She(e.modality),...t&&{tenantId:t},coreSettings:o,externalAppSessionCorrelationId:(0,Re.v4)(),host:i,logger:u,userBiService:s});return void(e.useNewEventObserver&&(e=>!!e?.LPC.eventObserver)(i)?((e,t,n)=>{if(!n)return;const{eventType:i,top:a,left:o,width:r,height:s}=e;let l;switch(i){case"click":l="HoverTargetClick";break;case"mouseenter":l="HoverTargetEnter";break;case"keydown":l="HoverTargetKeyPress";break;case"mouseleave":l="HoverTargetLeave";break;default:return}const c={kind:l,params:{personaInfo:{identifiers:{personaType:t.personaInfo.identifiers.PersonaType,hostAppPersonaId:t.personaInfo.identifiers.HostAppPersonaId,teamsMri:t.personaInfo.identifiers.TeamsMri},displayName:t.personaInfo.displayName},behavior:{cardPlacementMode:["bottom","top","overlap"],onCardOpen:t.behavior.onCardOpen,onCardClose:t.behavior.onCardClose},clientScenario:"MicrosoftTeams_MultiWindow",cardOpenTime:t.cardOpenTime,externalAppSessionCorrelationId:t.externalAppSessionCorrelationId},targetLocation:new n.DOMRect(o,a,r,s)};n.LPC.eventObserver?.next(c)})(e,n.cardParameters,i):whe(e,n.cardParameters,i))}case eG:{const e=d,t=e.tenantId||await bhe(a);if(!await g(e,t))return;const n=khe({...e,...t&&{tenantId:t},locationToOpen:"ExpandedViewOrganizationSection",coreSettings:o,externalAppSessionCorrelationId:(0,Re.v4)(),host:i,logger:u,userBiService:s});return void whe(e,n.cardParameters,i)}case tG:{const e=d,t=e.tenantId||await bhe(a);if(!await g(e,t))return;const n=(({ariaLabel:e,contextId:t,conversationId:n,coreSettings:i,eventType:a,externalAppSessionCorrelationId:o,highlightedText:r,host:s,isSharedChannel:l,logger:c,tenantId:d,topicId:u,userBiService:m,userId:p,clientRequestId:g})=>{const h=khe({ariaLabel:e,coreSettings:i,eventType:a,externalAppSessionCorrelationId:o,host:s,hostConversationId:n,hostTenantId:d,isSharedChannel:l,logger:c,userBiService:m,userId:p}),y={contextId:t,highlightedText:r,hideEntityAndContextQuestion:!0,clientRequestId:g};return{...h,cardParameters:{...h.cardParameters,personaInfo:{...h.cardParameters.personaInfo,identifiers:{...h.cardParameters.personaInfo.identifiers,PersonaType:"Topic",TeamsMri:void 0,TopicId:u},topicMetadata:y},behavior:{...h.cardParameters.behavior,onCardOpen:()=>{if(h.cardParameters.behavior.onCardOpen?.(),u){const e=(0,The.I6)({userAadObjectId:p,tenantAadObjectId:d});e?.logEvent(Ihe.z.TopicCardOpen,{topicId:u})}}}}}})({...e,...t&&{tenantId:t},coreSettings:o,externalAppSessionCorrelationId:(0,Re.v4)(),host:i,logger:u,userBiService:s});return void whe(e,n.cardParameters,i)}default:u.error(`Command action ${l} is not supported at EntityMoreInfoApp.`)}},viewStateRegistration:ghe};var Ehe=n(30416),Ahe=n(470453);const{useRef:_he,useEffect:Fhe}=hO,Dhe=()=>Promise.all([n.e(187946),n.e(182149),n.e(865804),n.e(88373),n.e(612377),n.e(313284),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(371898),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(123513),n.e(998264),n.e(735313),n.e(258544),n.e(963461),n.e(34671),n.e(285883)]).then(n.bind(n,450812)),Phe=({logger:e,onRenderEvent:t,scenarioFactory:i})=>{const a=(0,Ehe.I)("readyToBootstrapLPC");e.log(`LpcLazyLoader: shouldBootstrapLPC=${a}`);const[o,r]=(0,hO.useState)(null);return(e=>{const t=_he(),i=_he(),a=(0,Ahe.WD)(yt.nh.COMPLETE),{host:o,scenarioFactory:r}=(0,dY.SE)();Fhe((()=>{e&&a&&(async()=>{const e=()=>n.e(739823).then(n.t.bind(n,809824,23));try{const{freeBootstrapperMemory:n}=await(0,ac.mT)(e,"lpc-teams-bootstrapper",r);t.current=n,i.current=o.__lpcWindowProxy}catch(e){}})()}),[o,a,r,e]),Fhe((()=>()=>t.current&&i.current&&t.current(i.current)),[])})(!!a),(0,hO.useEffect)((()=>{if(a){const e="entity-more-info-app";t("ChunkLoadStarted",{chunkName:e}),(0,ac.mT)(Dhe,e,i).then((e=>r((()=>e.LPC)))),t("ChunkLoadSucceeded",{chunkName:e})}}),[t,i,a]),o&&(0,gO.t)(o,{})};const Mhe={getDefaultCommand:()=>({type:Se.py.meetings,action:Se.uk.view}),id:"com.microsoft.teams.meeting-options",name:"MeetingOptionsApp",supportedRenderModes:[Mt.S.Main,Mt.S.Modal],supportedEntities:[Se.py.meetings,Se.py.meetingsettings,Se.py.licenses,Se.py.meetingoptionscreatedialog],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}},xhe=e=>{if(Rhe(e))return jhe(e)?{subNavEntity:Lhe(e),headerEntity:Ohe(e),startEntity:$he(e),mainEntity:Uhe(e),endEntity:Bhe(e)}:null},Rhe=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.meetings,Se.py.meetingsettings,Se.py.licenses,Se.py.meetingoptionscreatedialog].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},jhe=()=>!0,Lhe=()=>null,Ohe=()=>null,$he=()=>null,Uhe=({entity:e})=>e,Bhe=()=>null,Whe=()=>({mainEntity:{[Mt.S.Main]:{isBackgroundTransparent:!0}}}),Hhe=()=>Promise.all([n.e(463781),n.e(681896),n.e(586535),n.e(65537),n.e(120894),n.e(766254),n.e(10495),n.e(39729),n.e(681238),n.e(96840),n.e(652421),n.e(241070),n.e(942964),n.e(13800),n.e(361648),n.e(885673),n.e(375558)]).then(n.bind(n,852879));const Vhe=({scenarioFactory:e,children:t})=>(Ghe(e),(0,gO.t)(hO.Fragment,{children:t})),Ghe=e=>{const t=hO.useRef(e.findScenario(H.RG.MeetingOptionsStart));hO.useEffect((()=>{t.current||(t.current=e.cancelExistingAndCreateScenario(H.RG.MeetingOptionsStart,"remount"))}),[e])},zhe={id:"com.microsoft.teams.unified-consent",name:"UnifiedConsentApp",supportedEntities:[Se.py.unifiedconsentdialog],supportedRenderModes:[Mt.S.Modal]},qhe={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsUnifiedConsentDialogGetConsentStateQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"consentSurface"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"consentState"},arguments:[{kind:"Argument",name:{kind:"Name",value:"consentSurface"},value:{kind:"Variable",name:{kind:"Name",value:"consentSurface"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelType"}},{kind:"Field",name:{kind:"Name",value:"platform"}},{kind:"Field",name:{kind:"Name",value:"osVersion"}},{kind:"Field",name:{kind:"Name",value:"deviceId"}}]}}]}}]};async function Jhe(e,t){const{coreSettings:n,entityCommanding:i,client:a,loggerFactory:o}=t,{enableUnifiedConsent:r}=n.get(b.J.WindowsSignatureExperiences);if(!r||"main_window_rendered"!==e.type)return;const s=o.newLogger("UCWindowRenderTrigger","apps-unified-consent"),{data:l,error:c}=await a.query({query:qhe,fetchPolicy:"no-cache",variables:{consentSurface:"AppStart"}});c&&s.error(`Failed to query unified consent state: ${c.message}`);const d=l?.consentState;d&&d.modelType&&i.unifiedConsent.launchUnifiedConsent(d)}const Qhe=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(586535),n.e(591878),n.e(607784),n.e(393890),n.e(75298),n.e(505990),n.e(865804),n.e(88373),n.e(612377),n.e(120894),n.e(666384),n.e(253400),n.e(397833),n.e(553486),n.e(540003),n.e(663276),n.e(591395),n.e(255279),n.e(869026),n.e(30577),n.e(704043),n.e(729265),n.e(65923),n.e(577767),n.e(908285),n.e(801870),n.e(32705),n.e(101614),n.e(69599),n.e(141377),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(213629),n.e(27729),n.e(371104),n.e(379371),n.e(841342),n.e(241070),n.e(600213),n.e(916297),n.e(474133),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(406628),n.e(566118),n.e(940495),n.e(123513),n.e(98223),n.e(350959),n.e(998264),n.e(735313),n.e(125136),n.e(258544),n.e(963461),n.e(206237),n.e(34671),n.e(799855),n.e(269518),n.e(48523),n.e(206887),n.e(613899),n.e(656436),n.e(749666),n.e(198610),n.e(266004),n.e(158529),n.e(868123)]).then(n.bind(n,461710));function Khe(){const e=()=>null;return{manifest:zhe,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i,loggerFactory:a})=>{const o=a.newLogger("UnifiedConsentApp","apps-unified-consent");if(t===Mt.S.Modal){const e="unified-consent-app";o.debug("chunk load start"),n("ChunkLoadStarted",{chunkName:e}),o.debug("experimental import start");const{UnifiedConsentDialog:t}=await(0,ac.mT)(Qhe,e,i);return o.debug("report chunk load success"),n("ChunkLoadSucceeded",{chunkName:e}),o.debug("Rendering unified consent dialog"),(0,gO.t)(t,{isFRE:!1})}return(0,gO.t)(e,{})},UNSAFE_onSignal:Jhe}}const Yhe=e=>Xhe(e)?{subNavEntity:Zhe(e),headerEntity:eye(e),startEntity:tye(e),mainEntity:nye(e),endEntity:iye(e)}:null,Xhe=({entity:e})=>{const{type:t}={...e};return t!==Se.py.platformstageinactivemeeting},Zhe=()=>null,eye=({entity:e})=>{try{const t=JSON.parse(e.options||"{}");if(e.type===Se.py.platformstagewithoutchat&&t.isFullScreenApp)return null}catch(t){return e}return e},tye=()=>null,nye=({entity:e})=>e,iye=({entity:e,contextEntity:t})=>{const n=e.linkedEntity,i=e.options;return n?e.type===Se.py.platformStage&&n.type===Se.py.chats?{...n,action:Se.uk.view,options:i}:e.type===Se.py.platformStage&&t?.type===Se.py.chats?{...t,action:Se.uk.view,options:i}:null:null},aye={id:"com.microsoft.teams.collab-stage-view",name:"CollabStageViewApp",supportedEntities:[Se.py.platformStage,Se.py.platformstageinactivemeeting,Se.py.platformstagewithoutchat,Se.py.unsupportedcollabstageerrordialog],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar,Mt.S.Modal],windowFeatures:{minWidth:800,width:800,minHeight:670,height:600,offset:20}},oye={shouldAddEntitiesToWindowHistory:e=>e.mainEntity?.type!==Se.py.platformStage,shouldRestoreClientToEntities:e=>e.mainEntity?.type!==Se.py.platformStage},rye=({appRenderMode:e,coreSettings:t})=>{const n=new MV.H,{platformAppCriticalPhaseTimeout:i}=t.get(b.J.Extensibility);if(e===Mt.S.Main)n.registerAppPhase({phase:yt.nh.CRITICAL,signals:[xV.G.PLATFORM_APP_FRAME_CONTENT_RENDERED],timeout:i||35e3});return n.appPhases},sye=()=>Promise.all([n.e(377348),n.e(187946),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(909020),n.e(346992),n.e(607784),n.e(986797),n.e(393890),n.e(75298),n.e(152739),n.e(664625),n.e(397833),n.e(314991),n.e(812934),n.e(564211),n.e(682492),n.e(440413),n.e(732691),n.e(157477),n.e(981041),n.e(462698),n.e(83395),n.e(479236),n.e(180830),n.e(345213),n.e(232410),n.e(619140),n.e(928362),n.e(652421),n.e(324415),n.e(730056),n.e(400685),n.e(888137),n.e(685827),n.e(474133),n.e(609660),n.e(702573),n.e(360134),n.e(566118),n.e(949636),n.e(281467),n.e(678342),n.e(6348),n.e(931930),n.e(187591),n.e(701227),n.e(420137),n.e(572474),n.e(982110)]).then(n.bind(n,571768)),lye=({coreServices:e,host:t,prevEntityType:n,entityType:i,screenState:a,isResize:o})=>{if((n===Se.py.platformStage||n===Se.py.calls)&&i===Se.py.platformStage)return null;const{minHeight:r,minWidth:s,offset:l=1}=aye.windowFeatures||{},c=t?.screen;if(o&&!c)return aye.windowFeatures||null;if(!c)return null;let{height:d=1,width:u=1}=((e,t)=>{const{minHeight:n=0,minWidth:i=0}=aye.windowFeatures||{};let{width:a,height:o}=aye.windowFeatures||{};if(!t)return{height:o,width:a,minHeight:n,minWidth:i};const{orientation:{type:r}}=e,{landscapeScreenRatio:s,portraitScreenRatio:l,widthHeightRatio:c}=t.coreSettings.get(b.J.Calling);if(s&&l&&c)switch(r){case"landscape-primary":case"landscape-secondary":const t=s*e.availHeight;o=t>n?t:n,a=c*o;break;case"portrait-primary":case"portrait-secondary":const r=l*e.availWidth;a=r>i?r:i,o=1/c*a}return{height:o,width:a}})(c,e);const m=c.availHeight-l,p=u>=c.availWidth||d>=m;p&&(d=c.availHeight,u=c.availWidth);const{left:g,top:h}=((e,t,n,i,a)=>{if(i)return{left:0,top:0};const o="availLeft"in e?e.availLeft:0,r="availTop"in e?e.availTop:0,s=o+e.availWidth/2-t/2;let l;switch(e.orientation.type){case"landscape-primary":case"landscape-secondary":l=r+a;break;default:l=r+e.availHeight/2-n/2}return{left:s,top:l}})(c,u,d,p,l),y=p?0:(a?.numOpenWindows||1)*l;return{additionalFeatures:{minHeight:`${r}`,minWidth:`${s}`},height:d,left:g+y,minHeight:r,minWidth:s,top:h+y,width:u}};const cye=e=>{const{entity:{type:t,action:n}}=e;return t===Se.py.platformStage&&n===Se.uk.create?H.RG.PlatformTabCollabStageFrameLoading:t===Se.py.platformstagewithoutchat&&n===Se.uk.view?H.RG.PlatformTabStageWithoutChatFrameLoading:void 0},dye={id:"com.microsoft.teams.mtma",name:"MtmaApp",supportedEntities:[],supportedRenderModes:[]},uye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaUserActivityUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mtmaUserActivityUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAccountId"}},{kind:"Field",name:{kind:"Name",value:"count"}},{kind:"Field",name:{kind:"Name",value:"lastUpdatedTimestamp"}},{kind:"Field",name:{kind:"Name",value:"notificationSignalsInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"notificationSignalsWithCount"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activityType"}},{kind:"Field",name:{kind:"Name",value:"count"}}]}},{kind:"Field",name:{kind:"Name",value:"mostRecentNotificationSignal"}},{kind:"Field",name:{kind:"Name",value:"mostRecentNotificationTimestamp"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"}}]}}]}}]},mye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaSetUserNotificationsMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mtmaUserNotificationsParam"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MTMAUserNotificationsDataInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setMTMAUserNotificationsData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mtmaUserNotificationsParam"},value:{kind:"Variable",name:{kind:"Name",value:"mtmaUserNotificationsParam"}}}]}]}}]};function pye(e){const{authenticationUser:t,client:n,loggerFactory:i}=e,a=n,o=i.newLogger("MTMAUserActivityUpdateEventSubscriptionJob","apps-mtma");return{id:"mtma-user-activity-update-event-subscription",runOncePerId:!0,job:()=>{const e=a.subscribe({query:uye,fetchPolicy:"no-cache"}).subscribe((async e=>{!async function(e,t,n,i){const a=t?.id;if(e.errors){const t=(0,$.u4)(e.errors.map((e=>e.message)).join());return void i.errorToTelemetry?.(`encountered error for user: ${a}, ${t}`,"mtma_user_activity_update_event_subscription_job",{context:"error_event",reason:t,userId:a},!0)}if(!e.data?.mtmaUserActivityUpdateEvent)return void i.warn(`received empty event for user: ${a}`);const{mtmaUserActivityUpdateEvent:o}=e.data,{userAccountId:r,count:s,lastUpdatedTimestamp:l,notificationSignalsInfo:c,consumptionHorizon:d}=o;i.log(`activity updated for user: ${a}, count: ${s}, signals: ${JSON.stringify(c.notificationSignalsWithCount)}`);const u=[];c.notificationSignalsWithCount.forEach((e=>{u.push({activityType:e.activityType,count:e.count})})),n.mutate({mutation:mye,variables:{mtmaUserNotificationsParam:{userAccountId:r,notifications:{count:s,lastUpdatedTimestamp:l,notificationSignalsInfo:{notificationSignalsWithCount:u,mostRecentNotificationSignal:c.mostRecentNotificationSignal,mostRecentNotificationTimestamp:c.mostRecentNotificationTimestamp},consumptionHorizon:d}}},fetchPolicy:"no-cache"})}(e,t,a,o)}));return()=>{e.unsubscribe()}}}}const gye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaUserPresenceUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mtmaUserPresenceUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAccountId"}},{kind:"Field",name:{kind:"Name",value:"presence"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userPresenceData"}}]}}]}}]}},...n(550214).O.definitions]},hye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaSetUserPresenceMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mtmaUserPresenceParam"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MTMAUserPresenceDataInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setMTMAUserPresenceData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mtmaUserPresenceParam"},value:{kind:"Variable",name:{kind:"Name",value:"mtmaUserPresenceParam"}}}]}]}}]};function yye(e){const{authenticationUser:t,client:n,loggerFactory:i}=e,a=n,o=i.newLogger("MTMAUserPresenceUpdateEventSubscriptionJob","apps-mtma");return{id:"mtma-user-presence-update-event-subscription",runOncePerId:!0,job:()=>{const e=a.subscribe({query:gye,fetchPolicy:"no-cache"}).subscribe((async e=>{!async function(e,t,n,i){const a=t?.id;if(e.errors){const t=(0,$.u4)(e.errors.map((e=>e.message)).join());return void i.errorToTelemetry?.(`encountered error for user: ${a}, ${t}`,"mtma_user_presence_update_event_subscription_job",{context:"error_event",reason:t,userId:a},!0)}if(!e.data?.mtmaUserPresenceUpdateEvent)return void i.warn(`received empty event for user: ${a}`);const{mtmaUserPresenceUpdateEvent:o}=e.data,{userAccountId:r,presence:s}=o,l=s.availability;i.log(`presence updated for user: ${a}, presence: ${s.availability}`),n.mutate({mutation:hye,variables:{mtmaUserPresenceParam:{userAccountId:r,presence:{availability:l}}},fetchPolicy:"no-cache"})}(e,t,a,o)}));return()=>{e.unsubscribe()}}}}const vye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaUserProfileUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mtmaUserProfileUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userAccountId"}},{kind:"Field",name:{kind:"Name",value:"profile"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userFields"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}}]}}]}}]}},...by.f.definitions]},fye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaSetUserProfileMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mtmaUserProfileParam"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MTMAUserProfileDataInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"setMTMAUserProfileData"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mtmaUserProfileParam"},value:{kind:"Variable",name:{kind:"Name",value:"mtmaUserProfileParam"}}}]}]}}]},Sye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsMtmaGetUserProfilePictureQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"displayName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"msaUserProfilePicture"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"displayName"},value:{kind:"Variable",name:{kind:"Name",value:"displayName"}}},{kind:"Argument",name:{kind:"Name",value:"profilePictureSize"},value:{kind:"Variable",name:{kind:"Name",value:"profilePictureSize"}}}]}]}}]};var kye=n(793669);function Cye(e){const{authenticationUser:t,client:n,loggerFactory:i,coreSettings:a}=e,o=n,r=i.newLogger("MTMAUserProfileUpdateEventSubscriptionJob","apps-mtma");return{id:"mtma-user-profile-update-event-subscription",runOncePerId:!0,job:()=>{const e=o.subscribe({query:vye,fetchPolicy:"no-cache"}).subscribe((async e=>{!async function(e,t,n,i,a){const o=t?.id;if(e.errors){const t=(0,$.u4)(e.errors.map((e=>e.message)).join());return void i.errorToTelemetry?.(`encountered error for user: ${o}, ${t}`,"mtma_user_profile_update_event_subscription_job",{context:"error_event",reason:t,userId:o},!0)}if(!e.data?.mtmaUserProfileUpdateEvent)return void i.warn(`received empty event for user: ${o}`);const{mtmaUserProfileUpdateEvent:r}=e.data,{userAccountId:s,profile:l}=r;i.log(`profile updated for user: ${o}`);let c="";a.get(b.J.CdlWorker).enableProfilePictureInMaglevStorage&&(c=await bye(n,i,r.profile.id,r.profile.displayName));n.mutate({mutation:fye,variables:{mtmaUserProfileParam:{userAccountId:s,profile:{avatarBlob:c,displayName:l.displayName||"",email:l.email||"",tenantName:l.tenantName||"",userPrincipalName:l.userPrincipalName||""}}},fetchPolicy:"no-cache"})}(e,t,o,r,a)}));return()=>{e.unsubscribe()}}}}const bye=async(e,t,n,i)=>{if(!i)return t.error(`failed to retrieve avatar blob for: ${n}. Missing required parameters`),"";try{const a=await e.query({query:Sye,variables:{userId:n,displayName:i,profilePictureSize:"HR96x96"}}),o=a.data?.msaUserProfilePicture;return o?await(async e=>{const t=await WA()(e,{credentials:"include"});if(!t.ok)throw new Error(`Failed to fetch avatar: ${e}`);const n=await t.blob();if(!n.type.includes("image"))throw new Error(`Invalid blob type for avatar: ${n.type}`);const i=await(0,kye.n)(n),a=i?.split("base64,");if(!a||0===a.length)throw new Error('Expected base64 data for avatar"');return a[1]})(o):(t.error(`failed to retrieve avatar blob for: ${n}. Missing msaProfilePicture on data`),"")}catch(e){return t.error(`failed to retrieve avatar blob for: ${n}`),""}},wye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"AppsMtmaGetHostMachineUsersQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"hostMachineUsers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"accountType"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"isAuthenticated"}}]}}]}}]};var Tye=n(802835);const Iye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsMtmaEspSurfaceShownSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"espSurfaceShownEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"surfaceIds"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"AddAccountsSuggestionCoachmark",block:!1}]}}]}]}}]};function Nye(){return({context:e})=>{const t=[];if(e.coreSettings.get(b.J.CdlWorker).enableMTMAUserDataInMaglevStorage){const n=Eye(e);t.push(...n)}const{enableAddAccountSuggestionCoachmark:n,addAccountSuggestionCoachmarkDays:i}=e.coreSettings.get(b.J.Auth);return e.authenticationUser?.id===e.authenticationUser?.homeAccountId&&n&&i&&t.push(function(e,t){const n=e.client,i=new Date(-1),a=n.subscribe({query:Iye,fetchPolicy:"no-cache"}).subscribe((async()=>{ml.Jt.put(pl.Jl.addAccountsSuggestionCoachMarkTimeStamp,i.toString())}));return{id:"mtma-add-accounts-suggestion",runOncePerId:!0,job:async()=>{const o={id:(0,vl.pW)(),scenarioName:H.RG.AuthAddAccountsSuggestion,source:"apps-mtma:app-pre-warm"},[r,s]=(0,yl.OU)({scenarioName:H.RG.AuthAddAccountsSuggestion,subContext:"appPrewarm",source:"mtma-add-accounts-suggestion:createMTMAAddAccountsSuggestionJob",options:{correlation:o}});try{const{entityCommanding:a}=e,l=ml.Jt.getValue(pl.Jl.addAccountsSuggestionCoachMarkTimeStamp)||"",c=new Date(l);if(c.getTime()<0)return void s();const d=(await n.query({query:wye,fetchPolicy:"no-cache",context:{correlation:o}})).data.hostMachineUsers,u=d.filter((e=>!e.isAuthenticated)),m=d.filter((e=>e.isAuthenticated));if(m.length>1)return r.addScenarioMark(H.ck.AuthAddAccountsSuggestionNotTriggered),ml.Jt.put(pl.Jl.addAccountsSuggestionCoachMarkTimeStamp,i.toString()),void s();if(!l&&m.length>0)return r.addScenarioMark(H.ck.AuthAddAccountsSuggestionNotTriggered),ml.Jt.put(pl.Jl.addAccountsSuggestionCoachMarkTimeStamp,(new Date).toString()),void s();if((0,Tye.RR)(new Date,(0,Tye.Xz)(c,t)))return r.addScenarioMark(H.ck.AuthAddAccountsSuggestionNotTriggered),void s();u.length>0&&(a.esp.displaySurface("AddAccountsSuggestionCoachmark"),r.addScenarioMark(H.ck.AuthAddAccountsSuggestionTriggered))}catch(e){r.addScenarioMark(H.ck.AuthAddAccountsSuggestionFailed)}return s(),()=>{a?.unsubscribe()}}}}(e,i||0)),t}}const Eye=e=>[pye(e),yye(e),Cye(e)],Aye={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AppsMtmaCleanupStaleUserDataMutation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"cleanupStaleMTMAUserData"}}]}}]};function _ye(){return({context:e})=>{const t=[],{coreSettings:n}=e;return n.get(b.J.CdlWorker).disableMTMACleanupStaleUserDataJob||t.push(function(e){const{client:t}=e,n=t;return{id:"mtma-cleanup-stale-user-data-job",runOncePerId:!0,job:()=>(n.mutate({mutation:Aye,fetchPolicy:"no-cache"}),()=>{})}}(e)),t}}function Fye(){const e=()=>null;return{onPreWarm:Nye(),onExperienceWarm:_ye(),manifest:dye,render:async()=>(0,gO.t)(e,{})}}const Dye={id:"com.microsoft.teams.biometric-enrollment",name:"BiometricEnrollmentApp",supportedRenderModes:[Mt.S.Main],supportedEntities:[Se.py.voiceenrollment,Se.py.faceenrollment],windowFeatures:{minWidth:900,width:900,minHeight:950,height:950}},Pye=e=>{if(Mye(e))return xye(e)?{subNavEntity:Rye(e),headerEntity:jye(e),startEntity:Lye(e),mainEntity:Oye(e),endEntity:$ye(e)}:null},Mye=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.faceenrollment,Se.py.voiceenrollment].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},xye=()=>!0,Rye=()=>null,jye=()=>null,Lye=()=>null,Oye=({entity:e})=>e,$ye=()=>null,Uye=()=>Promise.all([n.e(463781),n.e(681896),n.e(591878),n.e(459868),n.e(766254),n.e(133630),n.e(262541),n.e(69423),n.e(67676),n.e(880414)]).then(n.bind(n,181921)),Bye=()=>Dye.windowFeatures||{};function Wye(){const e=()=>null;return{getAppViewEntities:Pye,getAppWindowFeatures:Bye,manifest:Dye,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===Mt.S.Main){const e="biometric-enrollment-entry",{BiometricEnrollmentEntry:t}=await(0,ac.mT)(Uye,e,n);return(0,gO.t)(t,{})}return(0,gO.t)(e,{})}}}const Hye=e=>{if(Vye(e))return Gye(e)?{subNavEntity:zye(e),headerEntity:qye(e),startEntity:Jye(e),mainEntity:Qye(e),endEntity:Kye(e)}:null},Vye=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.coachreport].includes(i),r=[Se.uk.default,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},Gye=()=>!0,zye=()=>null,qye=()=>null,Jye=()=>null,Qye=({entity:e})=>e,Kye=()=>null,Yye={id:"com.microsoft.teams.coachreport",name:"CoachReport",supportedEntities:[Se.py.coachreport],supportedRenderModes:[Mt.S.Main],getDefaultCommand:()=>({type:Se.py.coachreport,action:Se.uk.view}),windowFeatures:{minWidth:1600,width:1600,minHeight:1e3,height:1e3,offset:20}},Xye=({appRenderMode:e,coreSettings:t})=>{const n=new MV.H,{speakerCoachCriticalPhaseTimeout:i,speakerCoachPostCriticalPhaseTimeout:a}=t.get(b.J.Coach),o=[];if(e===Mt.S.Main)o.push(xV.G.COACH_REPORT_VIEW_RENDERED);return n.registerAppPhase({phase:yt.nh.CRITICAL,signals:o,timeout:i||3e4}),n.registerAppPhase({phase:yt.nh.POST_CRITICAL,signals:[],timeout:a||1e4}),n.appPhases},Zye=()=>Promise.all([n.e(463781),n.e(681896),n.e(865804),n.e(392718),n.e(869026),n.e(10495),n.e(448808),n.e(727035),n.e(77742),n.e(62761),n.e(471154)]).then(n.bind(n,673160)),eve=()=>Yye.windowFeatures||{};function tve(){const e=()=>null;return{getAppViewEntities:Hye,getAppWindowFeatures:eve,getAppPhases:Xye,manifest:Yye,render:async({appRenderMode:t,onRenderEvent:n,scenarioFactory:i})=>{if(t===Mt.S.Main){const e="coach-report-app";n("ChunkLoadStarted",{chunkName:e});const{CoachReportRenderer:t}=await(0,ac.mT)(Zye,e,i);return n("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(ez.f,{namespaces:["calling","messaging","meetingAnalytics","coachReport"],loaderRenderer:null,children:(0,gO.t)(t,{})})}return(0,gO.t)(e,{})}}}const nve={id:"com.microsoft.teams.peoplecore",name:"PeopleCore",supportedEntities:[],supportedRenderModes:[]},ive={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"AppsPeopleCoreProfilesUpdateEventSubscription"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"profilesUpdateEvent"},selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"avatarUrl"}}]}}]}}]}}]};function ave(){return({context:{client:e,loggerFactory:t,coreSettings:n}})=>{const i=[],{enableProfilesUpdateToApolloCache:a}=n.get(b.J.People);return a&&i.push(function(e,t,n){return{id:"profiles-update-event-subscription-job",runOncePerId:!0,job:async()=>{const{enableProfilesUpdateToApolloCache:i}=n.get(b.J.People);if(!i)return;const a=t.newLogger("ProfilesUpdateSubscriptionJob","apps-people-core"),o=e.subscribe({query:ive}).subscribe((e=>{a.log(`profilesUpdateEvent received ${e?.data?.profilesUpdateEvent?.length} profiles`)}));return()=>{o?.unsubscribe()}}}}(e,t,n)),i}}function ove(){const e=()=>null;return{onUserWindowPreWarm:ave(),manifest:nve,render:async()=>(0,gO.t)(e,{})}}var rve=n(184101);const sve=e=>{if(lve(e))return cve(e)?{subNavEntity:dve(e),headerEntity:uve(e),startEntity:mve(e),mainEntity:pve(e),endEntity:gve(e)}:null},lve=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.attendeeview].includes(i),r=[Se.uk.default,Se.uk.create,Se.uk.view],s=n&&r.includes(n);return!!(a&&o&&s)},cve=()=>!0,dve=()=>null,uve=({entity:e})=>e,mve=()=>null,pve=({entity:e})=>e,gve=()=>null,hve=({coreSettings:e,themeOptions:t})=>{const{enableLightThemeSupport:n=!1}=e?.get(b.J.Calling)??{};return{mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,forceDisableTitleBar:!0,isBackgroundTransparent:!0,isThemePinnedToDarkOrHighContrast:!n||t?.isCallingWindowDarkTheme}},headerEntity:{[Mt.S.HorizontalBar]:{doesHeaderOverlapMain:!1,isBackgroundTransparent:!0}}}},yve={id:"com.microsoft.teams.attendee-view",name:"AteendeeViewApp",supportedEntities:[Se.py.attendeeview],supportedRenderModes:[Mt.S.Main,Mt.S.HorizontalBar],windowFeatures:{height:360,width:640,minHeight:360,minWidth:640,offset:20}},vve=()=>Promise.all([n.e(591395),n.e(111367),n.e(464003),n.e(754104),n.e(474133),n.e(450367),n.e(782721),n.e(90653),n.e(608462),n.e(193651),n.e(103338),n.e(894153),n.e(273375),n.e(985351),n.e(117530)]).then(n.bind(n,265264)),fve=()=>Promise.all([n.e(591395),n.e(111367),n.e(464003),n.e(754104),n.e(474133),n.e(450367),n.e(782721),n.e(90653),n.e(608462),n.e(193651),n.e(103338),n.e(894153),n.e(273375),n.e(985351),n.e(117530)]).then(n.bind(n,738193)),Sve="attendee-view-app",kve=(e,t,n,i)=>{const a=(e=>{const t=e?.coreSettings.get(b.J.Host).disableOldDesktopCallMonitor,n=e?.coreSettings.get(b.J.Calling).enableModernCallMonitor;return n||t?{width:304,height:247,cornerMargin:100}:{width:280,height:160,cornerMargin:16}})(i),o=a.cornerMargin,r=a.height+a.cornerMargin+16,s="availLeft"in e?e.availLeft:0,l=("availTop"in e?e.availTop:0)+e.availHeight-n-r,c=s+e.availWidth-t-o,d=l<0||c<0;return{top:d?0:l,left:d?0:c}},Cve=({coreServices:e,host:t})=>{const n=t?.screen;if(!n)return null;const i=e?.coreSettings.get(b.J.Calling).disableContentprotection,a=(!i).toString(),o=e?.coreSettings.get(b.J.Calling).enableCallMonitorGallery,r=!!o,s=yve.windowFeatures.width||640,l=(e=>e?360+(0,rve.fh)(e.windowProvider,6)+(0,rve.fh)(e.windowProvider,2.4):360)(e),{top:c,left:d}=kve(n,s,l,e);return{additionalFeatures:{alwaysOnTop:"true",closable:r.toString(),minimizable:(!r).toString(),excludeWindowFromScreenSharing:a,contentprotection:a,fullscreenable:"false",maximizable:"false",resizable:"false",hideWindowControl:(e?.platformService.config.osPlatform===An.NR.Windows).toString()},top:c,left:d,width:s,height:l,minWidth:s,minHeight:l}};function bve(){const e=()=>null;return{getAppViewEntities:sve,getAppViewEntitiesProps:hve,getAppWindowFeatures:Cve,manifest:yve,render:async({appRenderMode:t,scenarioFactory:n})=>{if(t===Mt.S.Main){const{AttendeeView:e}=await(0,ac.mT)(vve,Sve,n);return(0,gO.t)(wve,{children:(0,gO.t)(e,{})})}if(t===Mt.S.HorizontalBar){const{AttendeeToolbar:e}=await(0,ac.mT)(fve,Sve,n);return(0,gO.t)(wve,{children:(0,gO.t)(e,{})})}return(0,gO.t)(e,{})}}}const wve=({children:e})=>(0,gO.t)(ez.f,{namespace:"calling",loaderRenderer:null,children:e}),Tve={getDefaultCommand:()=>({type:Se.py.messages,action:Se.uk.create}),id:"com.microsoft.teams.share",name:"ShareApp",supportedEntities:[Se.py.messages,Se.py.shareformdialog],supportedRenderModes:[Mt.S.Main,Mt.S.Modal],windowFeatures:{top:0,left:0,width:800,height:600,minWidth:800,minHeight:600,offset:20}};var Ive=n(833189),Nve=n(263881);const Eve=({children:e})=>{const t=Ive.YM,{unblockOutlookDesktopIE11:n,unblockSafari:i}=(0,$K.NC)(b.J.Outlook,["unblockOutlookDesktopIE11","unblockSafari"]);if(n&&(t.ie=`>=${Ive.Zz}`),i&&(t.safari=`>=${Ive.hh}`),!((0,Nve.H$)(t)||(0,Nve.L5)()&&i))throw(0,de.Tr)("UnsupportedBrowserCheck",h.jK.FeatureNotSupported,"render",void 0,"Unsupported Browser");if(!i&&(0,Nve.Qh)())throw(0,de.Tr)("UnsupportedBrowserCheck",h.jK.FeatureNotSupported,"render",{itpError:!0},"Unsupported Browser (ITP Enabled)");return(0,gO.t)(hO.Fragment,{children:e})},Ave=e=>{if(_ve(e))return Fve(e)?{subNavEntity:Dve(e),headerEntity:Pve(e),startEntity:Mve(e),mainEntity:xve(e),endEntity:Rve(e)}:null},_ve=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.messages,Se.py.shareformdialog].includes(i),r=[Se.uk.default,Se.uk.view,Se.uk.create],s=n&&r.includes(n);return!!(a&&o&&s)},Fve=()=>!0,Dve=()=>null,Pve=()=>null,Mve=()=>null,xve=({entity:e})=>e,Rve=()=>null,jve=({appRenderMode:e})=>{const t=new MV.H,n=[];return e===Mt.S.Main&&n.push(xV.G.SHARE_PAGE_RENDERED),t.registerAppPhase({phase:yt.nh.CRITICAL,signals:n,timeout:2e4}),t.appPhases},Lve=()=>Promise.all([n.e(377348),n.e(187946),n.e(193180),n.e(112403),n.e(463781),n.e(681896),n.e(457628),n.e(182149),n.e(909020),n.e(346992),n.e(586535),n.e(591878),n.e(607784),n.e(986797),n.e(84274),n.e(393890),n.e(773923),n.e(505990),n.e(865804),n.e(88373),n.e(152739),n.e(612377),n.e(361845),n.e(664625),n.e(397833),n.e(314991),n.e(933161),n.e(812934),n.e(564211),n.e(123977),n.e(682492),n.e(891369),n.e(809416),n.e(503847),n.e(302494),n.e(251843),n.e(384648),n.e(956566),n.e(928362),n.e(652421),n.e(879608),n.e(43077),n.e(522359),n.e(845730),n.e(362148),n.e(642917),n.e(27729),n.e(371104),n.e(379371),n.e(429986),n.e(103554),n.e(943246),n.e(368361),n.e(685827),n.e(609660),n.e(371898),n.e(702573),n.e(210338),n.e(442948),n.e(360134),n.e(406628),n.e(566118),n.e(357903),n.e(949636),n.e(281467),n.e(678342),n.e(735313),n.e(65722),n.e(376960),n.e(146244),n.e(253408),n.e(554897),n.e(467533),n.e(413104),n.e(992458),n.e(153803),n.e(828729)]).then(n.bind(n,41438)),Ove=()=>null;const $ve={id:"com.microsoft.teams.minimode-meeting-scheduler",name:"MinimodeMeetingschedulerApp",supportedEntities:[Se.py.minimodeMeetingScheduler],supportedRenderModes:[Mt.S.Main],windowFeatures:{additionalFeatures:{closable:"true",hideWindowControl:"true",maximizable:"false"},top:50,left:50,minHeight:470,height:470,minWidth:400,width:400,offset:20}},Uve=e=>{if(Bve(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:Wve(e),endEntity:Hve(e)}},Bve=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===Se.py.minimodeMeetingScheduler,a=t===Se.uk.view;return Boolean(i&&a)},Wve=({entity:e})=>e,Hve=()=>null,Vve=()=>({mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0}}}),Gve=()=>Promise.all([n.e(193180),n.e(84274),n.e(459868),n.e(361845),n.e(714650),n.e(44025),n.e(81),n.e(10495),n.e(577767),n.e(129462),n.e(992112),n.e(652421),n.e(84215),n.e(222020),n.e(685827),n.e(412523),n.e(209674),n.e(575317)]).then(n.bind(n,623326)),zve=()=>$ve.windowFeatures||{};function qve(){const e=()=>null;return{getAppViewEntities:Uve,getAppViewEntitiesProps:Vve,getAppWindowFeatures:zve,manifest:$ve,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===Mt.S.Main&&n===Se.py.minimodeMeetingScheduler){const{MinimodeCreateMeetingForm:e}=await(0,ac.mT)(Gve,"minimode-meeting-scheduler",i);return(0,gO.t)(e,{})}return(0,gO.t)(e,{})}}}const Jve={id:"com.microsoft.teams.exploratory-license",name:"ExploratoryLicenseApp",supportedEntities:[Se.py.exploratorylicense],supportedRenderModes:[Mt.S.Main]},Qve=e=>{if(Kve(e))return Yve(e)?{subNavEntity:Xve(e),headerEntity:Zve(e),startEntity:efe(e),mainEntity:tfe(e),endEntity:nfe(e)}:null},Kve=({layoutMode:e,entity:t})=>{const{action:n=null,type:i}={...t},a=[ke.lO.focus,ke.lO.standard].includes(e),o=[Se.py.exploratorylicense].includes(i),r=[Se.uk.create],s=n&&r.includes(n);return!!(a&&o&&s)},Yve=()=>!0,Xve=()=>null,Zve=()=>null,efe=()=>null,tfe=({entity:e})=>e,nfe=()=>null,ife=()=>n.e(449406).then(n.bind(n,769017));const afe={id:"com.microsoft.teams.presenter-chat",name:"PresenterChatApp",supportedEntities:[Se.py.presenterchat],supportedRenderModes:[Mt.S.Main],windowFeatures:{height:631,width:304,offset:70}},ofe=e=>{if(rfe(e))return{subNavEntity:null,headerEntity:null,startEntity:null,mainEntity:sfe(e),endEntity:null}},rfe=({entity:e})=>{const{action:t=null,type:n}={...e},i=n===Se.py.presenterchat,a=t===Se.uk.view;return Boolean(i&&a)},sfe=({entity:e})=>e,lfe=()=>({mainEntity:{[Mt.S.Main]:{disableNotificationsBanners:!0,isBackgroundTransparent:!0,forceDisableTitleBar:!0}}}),cfe=()=>Promise.all([n.e(450367),n.e(796745)]).then(n.bind(n,626022)),dfe=({host:e,coreServices:t,windowOptions:n})=>{const i=e?.screen;if(!i)return null;const a=afe.windowFeatures.width||304,o=afe.windowFeatures.height||631,r=16+(n?.top||afe.windowFeatures.offset||70),s=n?.left||i.availWidth/2,l=t?.coreSettings.get(b.J.Calling).disableContentprotection,c=(!l).toString();return{additionalFeatures:{alwaysOnTop:"true",closable:"false",excludeWindowFromScreenSharing:c,fullscreenable:"false",maximizable:"false",minimizable:"false",resizable:"false",movable:"true",hideWindowControl:"true",contentprotection:c,transparent:"false"},top:r,left:s,width:a,height:o}};function ufe(){const e=()=>null;return{getAppViewEntities:ofe,getAppViewEntitiesProps:lfe,getAppWindowFeatures:dfe,manifest:afe,render:async({appRenderMode:t,entity:{type:n},scenarioFactory:i})=>{if(t===Mt.S.Main&&n===Se.py.presenterchat){const{PresenterChatContainer:e}=await(0,ac.mT)(cfe,"presenter-chat-app",i);return(0,gO.t)(e,{})}return(0,gO.t)(e,{})}}}const mfe=e=>{const t=e===pt.s.life?[{getAppPhases:p8,getAppViewEntities:a8,getAppViewEntitiesProps:m8,getAppWindowFeatures:f8,getCommandScenarioName:S8,manifest:i8,onExperienceWarm:y8,onPreWarm:h8,render:async({appRenderMode:e,scenarioFactory:t,onRenderEvent:n})=>{const i="flyout-app";n("ChunkLoadStarted",{chunkName:i});const{FlyoutViewsRenderer:a}=await(0,ac.mT)(v8,i,t);return n("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(a,{appRenderMode:e})}},Gde(),{manifest:d4,render:async({appRenderMode:e,onRenderEvent:t})=>{if(e===Mt.S.Main){const e="homepage-app";t("ChunkLoadStarted",{chunkName:e});const[{TflHomepage:n}]=await Promise.all([(0,ac.mT)(m4,e)]);return t("ChunkLoadSucceeded",{chunkName:e}),(0,gO.t)(ez.f,{namespaces:["tflHomepage","svFlyout"],loaderRenderer:null,children:(0,gO.t)(n,{})})}return(0,gO.t)(p4,{})},getPlatformAppIdForEntity:h4,onCommandReceived:u4,getCommandScenarioName:g4},cae(),{getAppPhases:e4,getAppViewEntitiesProps:a3,getAppWindowFeatures:r4,getPlatformAppIdForEntity:e=>[Se.py.communities,Se.py.communitiesonboarding,Se.py.communitiesevents,Se.py.communitiescreateevent,Se.py.communitiesmembers,Se.py.communitiesjoinrequest,Se.py.communitiesblockmembers,Se.py.communitiessettings,Se.py.communitiesgallery,Se.py.communitiesexplore].includes(e.type)?r3.n.communities:void 0,onBeforeAddToNavigation:D3,getAppViewEntities:K1,manifest:G1,onCommandReceived:z1,eventHandlers:J1,onBeforeDeeplinkParsed:F3,getCommandScenarioName:l4,render:async({appRenderMode:e,onRenderEvent:t})=>{const n="communities-app";t("ChunkLoadStarted",{chunkName:n});const[{CommunitiesAppViews:i},{LPC:a}]=await Promise.all([(0,ac.mT)(a4,n),(0,ac.mT)(o4,n)]);return t("ChunkLoadSucceeded",{chunkName:n}),(0,gO.t)(a,{children:(0,gO.t)(rJ.p3,{children:(0,gO.t)(ez.f,{namespaces:["communities","chatList","extensibility","channels","lightbox"],loaderRenderer:null,children:(0,gO.t)(s3.N,{children:(0,gO.t)(i,{appRenderMode:e})})})})})},onPreWarm:Z3},Khe(),qve(),{manifest:lue,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="virtual-consumer-events-app";t("ChunkLoadStarted",{chunkName:i});const{VirtualConsumerEventsViewsRenderer:a}=await(0,ac.mT)(hue,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(ez.f,{namespaces:["virtualConsumerEvents"],loaderRenderer:null,children:(0,gO.t)(a,{appRenderMode:e})})},...gue}]:[Nde(),Qle(),Yz(),{getAppPhases:O7,manifest:S7,render:L7,onCommandReceived:k7,eventHandlers:f7,getPlatformAppIdForEntity:e=>e.type===Se.py.peopleapp?r3.n.peopleApp:void 0,getAppViewEntities:U7,getAppViewEntitiesProps:q7,onBeforeNavigationFromHistory:J7},{getAppViewEntities:qde,getAppViewEntitiesProps:tue,getAppWindowFeatures:rue,manifest:zde,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="virtual-events-app";t("ChunkLoadStarted",{chunkName:i});const{VirtualEventsViewsRenderer:a}=await(0,ac.mT)(sue,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(ez.f,{namespaces:["virtualEvents","webinar","messaging","meetingAnalytics","compose","calendar","extensibility","meetingOptions"],loaderRenderer:null,children:(0,gO.t)(a,{appRenderMode:e})})},onRegister:e=>{e.registerTask(new ul)},onBeforeDeeplinkParsed:oue},Eue(),SJ(),aae(),Ez(),une(),Wye(),{manifest:L2,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="apps-add-cloud-storage",a={chunkName:i};if(e===Mt.S.Modal){t("ChunkLoadStarted",a);const{AddCloudStorageDialogRenderer:e}=await(0,ac.mT)(O2,i,n);return t("ChunkLoadSucceeded",a),(0,gO.t)(e,{})}return(0,gO.t)((()=>null),{})}},tve(),pz(),ove(),{getAppPhases:jve,getAppViewEntities:Ave,manifest:Tve,onRegister:e=>{e.registerTask(new ul)},render:async({appRenderMode:e,scenarioFactory:t})=>{if(e===Mt.S.Modal||e===Mt.S.Main){const e=await(0,ac.mT)(Lve,"share-form",t),{ShareForm:n}=e;return(0,gO.t)(Eve,{children:(0,gO.t)(n,{})})}return(0,gO.t)(Ove,{})}},{manifest:Jve,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="exploratory-license-app";t("ChunkLoadStarted",{chunkName:i});const{ExploratoryLicenseViewsRenderer:a}=await(0,ac.mT)(ife,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(a,{appRenderMode:e})},getAppViewEntities:Qve}];return[Hoe({isMainWindow:!0}),{getCommandScenarioName:w9,manifest:r9,onBeforeDeeplinkParsed:y9,onBeforeCommandHandled:m9,onBeforeAddToNavigation:K8,onBeforeIntentAuthenticated:b9,onExperienceWarm:f9,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="integrated-auth-app";t("ChunkLoadStarted",{chunkName:i});const{AuthViewsRenderer:a}=await(0,ac.mT)(L9,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(a,{appRenderMode:e})},getAppViewEntities:Y8,getAppViewEntitiesProps:X8,getAppWindowFeatures:()=>{const{height:e,minHeight:t,minWidth:n,width:i}=r9.windowFeatures||{};return{additionalFeatures:{minHeight:`${t}`,minWidth:`${n}`},height:e,minHeight:t,minWidth:n,width:i}},onCommandReceived:j9},{getAppViewEntities:B4,getAppViewEntitiesProps:J4,manifest:K4,render:async({appRenderMode:e,onRenderEvent:t})=>Z4(e,t)},G0(),...t,JY(),F1(),V1(),qne(),{getAppViewEntities:kre,getAppWindowFeatures:Vre,manifest:Sre,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="survey-form-entry";t("ChunkLoadStarted",{chunkName:i});const a=(await(0,ac.mT)(Hre,i,n)).SurveyAppViewsRenderer;return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(ez.f,{namespace:"survey",loaderRenderer:null,children:(0,gO.t)(a,{appRenderMode:e})})},onPreWarm:$re,onRegister:e=>{e.registerTask(new Bre)},onExperienceLongIdle:Wre},ZG(),r5(),S5(),e7(),P5(),Fye(),p7(),iJ(),Ete(),Rte(),iX(),ufe(),Rie(),b4(),j6(),j2(),TX(),{getAppViewEntities:O6,getCommandScenarioName:z6,getAppPhases:q6,manifest:L6,render:async({appRenderMode:e,onRenderEvent:t})=>{const n="files-viewer-oneup";t("ChunkLoadStarted",{chunkName:n});const[{FilesViewerOneupViewsRenderer:i}]=await Promise.all([(0,ac.mT)(J6,n)]);return t("ChunkLoadSucceeded",{chunkName:n}),(0,gO.t)(i,{appRenderMode:e})}},n8(),F8(),M2(),$4(),fre(),yX(),the(),{getAppViewEntities:ihe,getAppViewEntitiesProps:uhe,manifest:nhe,render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="teams-gallery-app";t("ChunkLoadStarted",{chunkName:i});const{TeamsGalleryEntry:a}=await(0,ac.mT)(mhe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(a,{appRenderMode:e})}},uee(),_me(),{...Nhe,manifest:phe,render:async({coreSettings:e,loggerFactory:t,onRenderEvent:n,scenarioFactory:i})=>{const a=t.newLogger("EntityMoreInfoApp","apps-entity-more-info"),{enableEntityMoreInfo:o}=e.get(b.J.Core);return a.log(`render: loading EntityMoreInfoApp with enableEntityMoreInfo=${o}`),o?(0,gO.t)(Phe,{logger:a,onRenderEvent:n,scenarioFactory:i}):(0,gO.t)(hO.Fragment,{})}},Q8(),{getAppViewEntities:xhe,getAppViewEntitiesProps:Whe,manifest:Mhe,onRegister:e=>{e.registerTask(new ul)},render:async({appRenderMode:e,onRenderEvent:t,scenarioFactory:n})=>{const i="meeting-options-app";t("ChunkLoadStarted",{chunkName:i});const{MeetingOptions:a}=await(0,ac.mT)(Hhe,i,n);return t("ChunkLoadSucceeded",{chunkName:i}),(0,gO.t)(Vhe,{scenarioFactory:n,children:(0,gO.t)(a,{appRenderMode:e})})}},{getCommandScenarioName:cye,getAppViewEntities:Yhe,getAppPhases:rye,getAppWindowFeatures:lye,manifest:aye,render:async({appRenderMode:e,scenarioFactory:t,onRenderEvent:n,entity:i})=>{const a="collab-stage-view-app";n("ChunkLoadStarted",{chunkName:a});const{StageViewEntry:o,StageViewWithoutChatEntry:r,UnsupportedCollabStageErrorDialog:s}=await(0,ac.mT)(sye,a,t);return i.type===Se.py.platformstagewithoutchat?(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(r,{appRenderMode:e})}):i.type===Se.py.unsupportedcollabstageerrordialog?(0,gO.t)(s,{}):(0,gO.t)(ez.f,{namespace:"extensibility",loaderRenderer:null,children:(0,gO.t)(o,{appRenderMode:e})})},onBeforeAddToNavigation:oye},{manifest:mne,onExperienceLongIdle:gne,render:async({appRenderMode:e})=>(0,gO.t)(hne,{appRenderMode:e})},bve()]},pfe={Application:{onExperienceWarm:["flyout-on-experience-warm-job","lazy-initialize-accounts-job","memory-feedback-service-start","init-diagnostics-idb-job","clear-t2-web-boot-attempts-counter","create-notifications-window-on-experience-warm-job","reposition-notifications-window-on-experience-warm-job","notify-desktop-experience-warm-job","mtma-cleanup-stale-user-data-job","detect-third-party-cookie-support-job","cleanup-t1-desktop-job","restore-taskbar-badge-on-main-window-open"],onPreWarm:["active-windows-history-job","app-simple-collab-user-preference-subscription","auth-state-subscription","cdl-services-state-subscription","bootstrap-floodgate","esp-time-based-trigger-job","esp-synthetic-notification-toast-subscription-job","files-register-resources","flyout-prewarm-job","graph-item-toast-event-subscription","start-esp","esp-signal-handler-job","download-log-subscription","network-state-subscription","presence-prewarm-job","setup-calling-app-events","settings-ecs-fetch","standup-calling","toast-event-subscription","channel-toast-event-subscription","communities-toast-event-subscription","taskbar-badge-event-subscription","taskbar-legacy-badge-event-subscription","worker-start-sync","connected-account-state-subscription","connected-calendar-sync-state-job","unified-calendar-sync-state-job","user-bi-initialize-smb-user-intent","notifications-engine-event-subscription","create-toast-collection","initialize-office-integration-service","start-local-migrated-settings-timer-job","presence-blocking-signal-subscription","user-settings-signal-subscription","warn-notifications-settings-banner-job","meetings-blocking-signal-subscription","connected-account-refresh-srt-job","desktop-minimum-version-check-job","share-to-teams-outlook-install","mtma-add-accounts-suggestion","mtma-user-activity-update-event-subscription","mtma-user-presence-update-event-subscription","mtma-user-profile-update-event-subscription","emergency-location-notification","maglev-provider-host-settings","prewarm-platform-app","exploratory-upgrade-banner-job","notify-desktop-experience-warm-for-user-job"],onUserWindowPreWarm:["apps-sync-subscription","m365-links-set-policy-value-job","profiles-update-event-subscription-job","request-notification-authorization","reset-taskbar-badge-on-account-switch","start-esp-app-ready-hander"],onExperienceLongIdle:["high-memory-restart-service","bootstrap-floodgate","files-app-pre-warm-job","public-preview-policy-job","bizchat-app-pre-warm","files-app-pre-warm-cft-job","share-to-teams-clear-teams-list-localstorage","disk-footprint-job"],onIdle:["app-pre-load-job","files-app-pre-warm-cft-job","files-app-pre-warm-job"]}},gfe=e=>{let t,n;return xn(e)&&(t=An.Bh.Maglev,n=Rn(e)),{clientType:t,platformId:n}},hfe=async()=>{const e=yfe();await(e.loader?.flushTelemetry()),e.loader?.signalCoreInitStarted();const t=Date.now(),i=n(759455),r=e.loader?.getProperties()?.environment||pt.s.prod,s=new gH({config:{...i,startTimeMS:t,lifeCycleJobPermissions:pfe},apps:mfe(r),criticalDynamicImports:CH,loadConfigs:kH,generateChildWindowTemplate:PV,getPlatformConfigurationOverrides:gfe});await s.init();const l=s.coreServices,{enableMercuryDesign:c}=l.coreSettings.get(b.J.MercuryDesign),d={config:i,getLayoutResponsiveTemplates:NV,uiVariables:{isMultiWindow:!0,disableExperienceSlotShadows:!!c}};await(0,a.o)(s.activeWindows,l,(0,o.c)(d)),l.scenarioFactory.findScenario(H.RG.ExperienceReady)?.stop()},yfe=()=>window;hfe().catch((e=>{(async e=>{yfe().loader?.onErrorHandler(e,"CoreInitFailure")})(e)}))},296963:(e,t,n)=>{"use strict";n.d(t,{rY:()=>o,Ok:()=>r});var i=n(109458);function a(e){if(e.definitions.length>1)return null;const t=e.definitions[0];return"FragmentDefinition"!==t.kind?null:t}function o(e){const t=(0,i.S)(e);if(!t?.name)throw new Error("Operation name must be set");return t.name.value}function r(e){let t=(0,i.S)(e);return t||(t=a(e)),t?.name?.value||null}},948281:(e,t,n)=>{"use strict";n.d(t,{$Z:()=>h,aw:()=>p,nl:()=>m});var i=n(337717),a=n(943380),o=n(773427),r=n(432564),s=n(543491);class l extends r.h{constructor(e,t){super(e),this.definitionOverflowLogged=new Set,this.isDuplicateWrite=e=>this.lastWrite&&this.lastDiff&&this.lastWrite===this.lastDiff.precedingWrite&&e.result===this.lastDiff.result;const{loggerFactory:n,scenarioFactory:i,graphqlStoreStatsReporterService:a,storeType:o,enableApolloDoubleWriteFix:r}=t;this.storeType=o,this.enableApolloDoubleWriteFix=r,n&&(this.logger=n.newLogger("InMemoryCacheWrapper","frameworks-apollo")),i&&(this.scenarioFactory=i),a&&(this.graphqlStoreStatsReporterService=a)}write(e){let t,n=0;try{if(this.lastWrite&&this.isDuplicateWrite(e)&&(this.graphqlStoreStatsReporterService?.markDuplicateWrite(this.storeType,e.query,this.lastWrite.elapsed??0),this.enableApolloDoubleWriteFix))return this.lastWrite.result;t=this.graphqlStoreStatsReporterService?.markWriteStart(this.storeType,e.query);const i=super.write(e);return t&&(n=this.graphqlStoreStatsReporterService?.markWriteEnd(t)??0),this.lastWrite={result:i,elapsed:n},i}catch(e){throw this.logger?.error(e.message),t&&this.graphqlStoreStatsReporterService?.markWriteError(t),e}}read(e){let t;try{t=this.graphqlStoreStatsReporterService?.markReadStart(this.storeType,e.query);const n=super.read(e);return t&&this.graphqlStoreStatsReporterService?.markReadEnd(t),n}finally{this.logResultCacheOverflowOnce("read",e.query)}}modify(e){let t;try{t=this.graphqlStoreStatsReporterService?.markWriteStart(this.storeType,`modify ${e.id||"ROOT_QUERY"}`);const n=super.modify(e);return t&&this.graphqlStoreStatsReporterService?.markWriteEnd(t),n}catch(e){throw this.logger?.error(e.message),t&&this.graphqlStoreStatsReporterService?.markWriteError(t),e}}diff(e){let t;try{t=this.graphqlStoreStatsReporterService?.markDiffStart(this.storeType,e.query);const n=super.diff(e);return t&&this.graphqlStoreStatsReporterService?.markDiffEnd(t),this.lastDiff={result:n.result,precedingWrite:this.lastWrite},n}finally{this.logResultCacheOverflowOnce("diff",e.query)}}logResultCacheOverflowOnce(e,t){const n=t.definitions[0],i=this.getLastResultCacheOverflow();if(!this.scenarioFactory||i<=0||"OperationDefinition"!==n.kind)return;let a;if(n.name||1!==n.selectionSet.selections.length||"FragmentSpread"!==n.selectionSet.selections[0].kind){a={definitionKind:"query",definitionName:n.name?.value??"(unnamed)",overflowSize:i,method:e}}else{a={definitionKind:"fragment",definitionName:n.selectionSet.selections[0]?.name?.value??"",overflowSize:i,method:e}}const o=`${a.definitionKind}-${a.definitionName}`;if(!this.definitionOverflowLogged.has(o)){this.scenarioFactory.createScenarioWithoutStarting(s.RG.ApolloResultCacheOverflow).stop(a),this.definitionOverflowLogged.add(o)}}getLastResultCacheOverflow(){return(((this.storeReader??{}).executeSelectionSet??{}).__DEBUG_ONLY_optimismCache??{}).__DEBUG_ONLY_lastOverflow||0}}const c=l;var d=n(666341);var u=n(933466);const m=(e={})=>{const{apolloLeakOptions:t,cache:n,loggerFactory:o,scenarioFactory:r,enableApolloDevtools:s,enableApolloDoubleWriteFix:l,storeType:c=a.t.other,graphqlStoreStatsReporterService:d,...u}=e,m=new i.f({...u,cache:n||p({apolloLeakOptions:t,loggerFactory:o,scenarioFactory:r,storeType:c,graphqlStoreStatsReporterService:d,enableApolloDoubleWriteFix:l}),assumeImmutableResults:!0,connectToDevTools:Boolean(s)});return g(m,t),m},p=({apolloLeakOptions:e,loggerFactory:t,scenarioFactory:n,graphqlStoreStatsReporterService:i,storeType:r,enableApolloDoubleWriteFix:s,enableGlobalObjectIdStoreKeys:l,...m}={})=>{const p=l?(e=>{return{...e,typePolicies:{...e.typePolicies,...u.A,Query:{fields:{...e.typePolicies?.Query?.fields,...u.A.Query.fields}}},dataIdFromObject:(t=e.dataIdFromObject,n=e.possibleTypes,(e,i)=>(e=>t=>{if(t.id&&t.__typename&&e&&e.Node.includes(t.__typename))return t.id})(n)(e,i)||(t?t(e,i):(0,d.uG)(e,i)))};var t,n})(m):m,h={loggerFactory:t,scenarioFactory:n,graphqlStoreStatsReporterService:i,storeType:r||a.t.other,enableApolloDoubleWriteFix:s},y=new c(p,h);return e?.leakDetector?.track(o.I.ApolloCache,y),g(y,e),y},g=(e,{userContextId:t,windowId:n,entityType:i,viewportContext:a}={})=>{e.apolloLeakInfo={apolloLeakInfoStartTime:(new Date).toISOString(),apolloLeakInfoEntityType:i,apolloLeakInfoUserContextId:t,apolloLeakInfoViewportContext:a,apolloLeakInfoWindowId:n}},h=e=>{e.apolloLeakInfo||(e.apolloLeakInfo={}),e.apolloLeakInfo.apolloLeakInfoEndTime=(new Date).toISOString()}},118423:(e,t,n)=>{"use strict";n.d(t,{T:()=>o});var i=n(391916),a=n.n(i);const o=e=>{const t=performance.now();return{cacheSize:a()({data:e.data.data,optimisticData:e.optimisticData.data}),measuringTime:performance.now()-t}}},716415:(e,t,n)=>{"use strict";n.d(t,{TP:()=>r,ad:()=>s,U:()=>c});var i=n(391916),a=n.n(i);function o(e){const t=e.storeReader,n=t?.executeSelectionSet?.__DEBUG_ONLY_optimismCache,i=t?.executeSubSelectedArray?.__DEBUG_ONLY_optimismCache;return{selectionSetCache:n,selectionSetArrayCache:i}}function r(e){const{selectionSetCache:t,selectionSetArrayCache:n}=o(e),i=performance.now(),r=[Array.from(t.map),Array.from(n.map)];return{cacheSize:a()(r),measuringTime:performance.now()-i}}function s(e){const{selectionSetCache:t,selectionSetArrayCache:n}=o(e);return{objectCount:t.map.size,arrayCount:n.map.size}}function l(e){if(0===e.length)return"[Dirty]";let t="";return e[0]&&e[0].result&&(t=e[0].result?.__typename??"[Query]"),e[1]&&(t+=` (Error: ${e[1]?.message??""})`),t}function c(e){const{selectionSetCache:t}=o(e),n=new Map;for(const e of t.map.values()){const t=l(e.value.value),i=n.get(t)??0;n.set(t,i+1)}return Array.from(n).sort(((e,t)=>t[1]-e[1]))}},474454:(e,t,n)=>{"use strict";n.d(t,{l:()=>r});var i=n(968687),a=n(410969);const o=["NoNetwork","RemoteOperationFailed"];class r extends i.G{constructor(e,t){super({type:"AuthError",code:s(e,t),prevError:"boolean"==typeof e?void 0:e})}getBoundaryProps(){switch(this.code){case"SIGN_IN_RESTRICTIONS":return{title:"default_signinrestrictions_title",description:"default_signinrestrictions_description",actions:["RESTART"]};case"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED":return{title:"default_error_getuser_when_anon_not_supported_title",description:"default_error_getuser_when_anon_not_supported_description"};case"OFFLINE":return{title:"default_auth_no_network_title",description:"default_auth_no_network_description",actions:["RESTART"]};default:return{title:"default_authentication_title",description:"default_authentication_description",actions:["RESTART","SIGN_OUT"]}}}static fromSerialized(e){if("AuthError"!==e?.type)return null;const t=new r(void 0,e.code);return t.deserialize(e),t}}function s(e,t){if(t)return t;if("boolean"==typeof e)return e?"SIGN_IN_RESTRICTIONS":"UNKNOWN";if((0,a.a)(e)){const t=e.code;switch(t){case"SignInRestrictions":return"SIGN_IN_RESTRICTIONS";case"ErrorGetUserWhenAnonNotSupported":return"ERROR_GETUSER_WHEN_ANON_NOT_SUPPORTED";default:return o.includes(t)?"OFFLINE":"UNKNOWN"}}return"UNKNOWN"}},396957:(e,t,n)=>{"use strict";n.d(t,{K:()=>a});var i=n(968687);class a extends i.G{constructor(e,t){super({type:"UnknownError",code:"NONE",message:e.message,prevError:e}),this.context=t}getExtensions(){return{...super.getExtensions(),...this.context}}toTelemetryCode(){return`[${this.type}]`}}},142009:(e,t,n)=>{"use strict";n.d(t,{m:()=>i});const i=async()=>n.e(644750).then(n.bind(n,644750))},390009:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createRelayEnvironment:()=>i.eM,addRelayStoreLeakInfoAtEnd:()=>i.O8,findInsertionIndex:()=>a.cQ,getValueAtKeyPath:()=>a.QA,insertEdgeSorted:()=>a.fM,sortConnection:()=>a.pK,sortConnectionEdgesWithDescriptors:()=>a.JC,sortEdges:()=>a.mj});var i=n(197490),a=n(578483)},578483:(e,t,n)=>{"use strict";n.d(t,{cQ:()=>o,fM:()=>r,mj:()=>s,pK:()=>l,JC:()=>c,QA:()=>m});var i=n(910125),a=n.n(i);function o(e,t){const n=e.getLinkedRecords("edges");if(!n)return-1;if(0===n.length)return 0;const i=u(d(e)),a=n.findIndex((e=>i(t,e)<0));return-1===a?n.length:a}function r(e,t){const n=o(e,t);if(-1===n)return;const i=e.getLinkedRecords("edges");i?.splice(n,0,t),e.setLinkedRecords(i,"edges")}function s(e,t){return c(t,d(e))}function l(e){const t=e.getLinkedRecords("edges");if(!t||0===t.length)return;const n=s(e,t);n&&e.setLinkedRecords(n,"edges")}function c(e,t){let n=!1;const i=u(t),a=e.slice().sort(((e,t)=>{const a=i(e,t);return 0!==a&&(n=!0),a}));return n?a:void 0}function d(e){const t=e.getLinkedRecords("sortInfo");return a()(t?.length>0,"Connection must have sortInfo"),t.map((e=>{const t=e.getValue("keyPath"),n=e.getValue("direction");return a()(t&&n,"Sort descriptor must have keyPath and direction"),{keyPath:t,direction:n}}))}function u(e){const t=e.map((e=>({direction:e.direction,keyPathComponents:e.keyPath.split(".")})));return(e,n)=>{let i=0;for(const{keyPathComponents:o,direction:r}of t){const t=p(e,o),s=p(n,o);if(a()(typeof t==typeof s,"Cannot sort on different types"),"string"==typeof t&&"string"==typeof s?i="ASC"===r?t.localeCompare(s):s.localeCompare(t):"number"==typeof t&&"number"==typeof s?i="ASC"===r?t-s:s-t:"boolean"==typeof t&&"boolean"==typeof s?i="ASC"===r?+t-+s:+s-+t:a()(!1,"Cannot sort on given types"),0!==i)return i}return i}}function m(e,t){return p(e,t.split("."))}function p(e,t){return t.reduce(((e,n,i)=>{const o=t.length-1===i?e?.getValue(n):e?.getLinkedRecord(n);return a()(void 0!==o,`Cannot get value at non-existent key-path: ${n}`),o}),e)}},197490:(e,t,n)=>{"use strict";n.d(t,{eM:()=>m,O8:()=>g});var i=n(943380),a=n(908340),o=n(773427),r=n(71),s=n(395041),l=n(978296),c=n(768591),d=n(186073),u=n(790702);const m=async({link:e,loggerFactory:t,userBiService:n,leakDetectorOptions:i,isLiveResolverEnabled:m,gcReleaseBufferSize:g,configName:h,graphqlStoreStatsReporterService:y,host:v})=>{const f=n.getWindowId?.(),S=t.newLogger("relay","data-client-core"),k=r;k.ENABLE_CLIENT_EDGES=!0,k.ENABLE_RELAY_RESOLVERS=k.ENABLE_RELAY_RESOLVERS||m,u.onUnhandledError(((e,t)=>{t?(S.errorToTelemetry&&S.errorToTelemetry("Relay: Uncaught thrown error","cdl_links_data_client_core",void 0,!0),S.error(`Relay: Uncaught thrown error: ${e}`)):S.error(`Relay: Unhandled emitted error: ${e}`)}));const C={gcReleaseBufferSize:g??10},b=m?new d(new l,C):new c(new l,C);!function(e,t){const{leakDetector:n,entityType:i}=t;if(!n)return;const a=e;a.relayStoreLeakInfo={relayStoreLeakInfoStartTime:(new Date).toISOString(),relayStoreLeakInfoEntityType:i},n.track(o.I.RelayStore,e)}(b,i);const w=new s({log:y?p(y):null,store:b,network:{execute:(t,n,i,o)=>function(e,t,n,i,o,r){const s=t.text;if(!s){const e=`Relay: Request text not available for operation: ${t.name}`;return o.error(e),u.create((t=>t.error(new Error(e))))}const l=u.from(a.i.execute(e,{query:s,variables:n,operationName:t.name,context:{windowId:i}}));return"subscription"===t.operationKind?l:function(e,t,n,i,a){return u.create((o=>{const r=e.subscribe(o),s=n.setTimeout((()=>{const e=`Relay: Timeout reached while executing operation: ${i}`;a.errorToTelemetry?.(e,"cdl_links_data_client_core",void 0,!0),o.error(new Error(e)),r.unsubscribe()}),t);return()=>{n.clearTimeout(s),r.unsubscribe()}}))}(l,25e3,r,t.name,o)}(e,t,n,f,S,v)},configName:h});return w};function p(e){const t=new Map,n=new Map;return a=>{switch(a.name){case"execute.start":t.set(a.executeId,a.params);break;case"execute.next":{const n=t.get(a.executeId);n&&e.markWrite(i.t.relay,n.name,a.duration);break}case"execute.error":case"execute.complete":t.delete(a.executeId);break;case"store.notify.start":{const t=a.sourceOperation?.request.identifier;t&&n.set(t,e.markDiffStart(i.t.relay,a.sourceOperation.request.node.operation.name));break}case"store.notify.complete":{const t=a.sourceOperation?.request.identifier;if(t){const i=n.get(t);i&&e.markDiffEnd(i),n.delete(t)}break}}}}function g(e){const t=e;t.relayStoreLeakInfo||(t.relayStoreLeakInfo={}),t.relayStoreLeakInfo.relayStoreLeakInfoEndTime=(new Date).toISOString()}},277572:(e,t,n)=>{"use strict";n.d(t,{b:()=>N});var i=n(505935),a=n(327204),o=n(193672),r=n(37718),s=n(945151),l=n(683184),c=n(689626),d=n(726175),u=n(316877),m=n(839779),p=n(242111),g=n(599134),h=n(826457),y=n(6842),v=n(823806),f=n(702135);const S=3e5;var k=n(771574),C=n(543491);const b="beta/imageauth/cookie",w="beta/users/{objectId}/cookiev2",T=1e3,I=new Map([[h.ej.SKYPE_KEY,["ams","amsV2"]],[h.ej.MT_KEY,["mtImageService"]]]);class N{constructor(e,t,n,c,d,u,p,h,k,C,I,N,E,A,_,F){var D;this._gtmRegistry=t,this._discover=n,this.coreSettings=d,this.scenarioFactory=u,this.windowProvider=p,this.platformService=h,this.localStorage=C,this._authenticationService=I,this.config=N,this.user=E,this.clientState=A,this.networkState=_,this.hostState=F,this._imageAuthCookieExpiryTsKey="ImageAuthCookieExpiryTime",this._activeAmsRequest={},this._baseImageUrlSubject=new m.X(null),this._isInitialized=!1,this._isImageAuthCookieValidSubject=new m.X(!1),this._imageCookieRetryInterval=2e4,this._imageCookieRetryMaxCount=5,this._isSetupImageCookieInProgress=!1,this.checkImageAuthCookie=()=>{let e=-1;const t=(new Date).getTime()/T,n=this.localStorage&&this.localStorage.get(this._imageAuthCookieExpiryTsKey,"Global")||"-1";e=parseInt(n,10);const i=e>t,a=i?`Image auth cookie has NOT expired. Expiry time stamp: ${e}`:`Image auth cookie has expired. Expiry time stamp: ${e}`;this._logger.log(a),this._isImageAuthCookieValidSubject.next(i),this.startImageAuthCookiePollingTimer(i,e)},this.getRequest=(e,{requestUrl:t,requestBody:n,headers:i,serviceName:a},o)=>this._gtmRegistry.bind(this._send,e)({url:t,headers:i,credentials:"include",method:"POST",body:n,serviceName:a,apiName:o}),this.setupImageAuthCookie=()=>Promise.resolve({constructRequest:()=>({url:this._isMTMAProfilePicturesEnabled&&this.user?.id?w.replace("{objectId}",this.user?.id):b,method:"POST",headers:{"x-ms-client-caller":"imageAuthCookieSetupEM","x-ms-client-type":(0,g.I)(this.platformService,this.config)},credentials:"include",apiName:"imageAuthCookie"}),allowedResponses:[r.qj.HTTP_2XX],retryPolicy:this.imageCookieRetryPolicy()}),this.setupImageAuthCookieEndpoints=({discover:e,authenticationResources:t})=>({baseUrlPromise:()=>e.regionGtm("middleTier"),serviceName:s.E.MiddleTier,authResource:t.mtAuthResource,models:{setupImageAuthCookie:this.setupImageAuthCookie()}}),this._logger=c.newLogger("Content Media Auth","services-io-browser-aync-media"),this._send=(0,i.r)((0,a.B)((0,o.S)(e),r.qb.NO_CONTENT,r.qb.OK),(D=this._logger,{shouldRetry:e=>(0,f.o7)(e)||[r.qb.THROTTLED,-1].indexOf(e)>-1,errorHandler:(e,t)=>{const{serverResponse:{status:n}}=e;if(!t.retriesTable[n])throw new Error(`AsyncMediaAuthServiceRetryPolicy: retry count for ${n} is empty`);return D.error(`asyncMediaAuthServiceRetryPolicy: retrying '[${t.retryCount}]' times due to response status - '[${n}]'`),(0,y._)(t.delay.next())},retryMaxTimeMs:S,maxRetryCount:6,createDelay:()=>new v.df(1e3,2,S)})),this._setupImageAuthCookieApi=k.createApi(this.setupImageAuthCookieEndpoints),this._imageCookieRetryInterval=d.get(l.J.People).imageCookieRetryInterval||2e4,this._imageCookieRetryMaxCount=d.get(l.J.People).imageCookieRetryMaxCount||5,this._isMTMAProfilePicturesEnabled=!!d.get(l.J.People).enableProfilePicturesWithObjectId,this._isDeleteImageAuthCookieEnabled=!!d.get(l.J.People).enableDeleteImageAuthCookie,this._isMTMAProfilePicturesEnabled&&(this._imageAuthCookieExpiryTsKey=`${this._imageAuthCookieExpiryTsKey}_${E?.id}`)}initAsyncMediaAuthService(){if(this._isInitialized)return;this.initBaseImageUrl().catch((()=>{this._logger.error("Error in initCookieImageAuth")}));const{enableAmsCookieValidation:e}=this.coreSettings.get(l.J.Core),{isImageAuthCookiePollingCheckEnabled:t}=this.coreSettings.get(l.J.People),{skipAmsAuthRequest:n,disableTokenCacheReadEvent:i}=this.coreSettings.get(l.J.Auth);e&&t?this.checkImageAuthCookie():n?this._isImageAuthCookieValidSubject.next(!0):(this._discover.validateSkypeToken().catch((()=>{})),this.subscribeToToken(h.ej.SKYPE_KEY),i?this.subscribeToMiddleTierToken():this.subscribeToToken(h.ej.MT_KEY),this.subscribeToClientAndMachineStates()),this._isInitialized=!0}async logout(){let e,t=s.E.Skype;const n=h.ej.MT_KEY,{mtResource:i}=await this.coreSettings.get(l.J.Auth);if(i&&this._isDeleteImageAuthCookieEnabled&&this.user?.id&&this._authenticationService?.acquireTokenV2){const{token:a}=await(this._authenticationService?.acquireTokenV2(i)),o=I.get(n)??[],r=this.getHeaders(a,n);e=this._isMTMAProfilePicturesEnabled?"beta/users/{objectId}/deletecookiev2".replace("{objectId}",this.user.id):"beta/imageauth/deletecookie",t=s.E.MiddleTier;const{requireSkypetokenForMT:c}=this.coreSettings.get(l.J.Auth);return c&&(r["x-skypetoken"]=await this._discover.validateSkypeToken()),this._logger.log("queueing request for deleting image auth cookie"),this.queueRequests(o,n,{requestUrl:e,headers:r,requestBody:undefined,serviceName:t},"deleteCookieOnLogout"),this._activeAmsRequest[n][0]}}startImageAuthCookiePollingTimer(e,t){this._imageAuthCookiePollingTimerId&&(this._logger.log(`Clearing image auth cookie polling. Timer ID: ${this._imageAuthCookiePollingTimerId}`),this.windowProvider.clearInterval(this._imageAuthCookiePollingTimerId));const n=Math.abs(t*T-(new Date).getTime()),i=e?n:5e3;this._imageAuthCookiePollingTimerId=this.windowProvider.setInterval((()=>this.checkImageAuthCookie()),i);const a=e?`Image auth cookie valid. expiry check timer started. Timer ID: ${this._imageAuthCookiePollingTimerId}`:`Image auth cookie NOT valid. polling validity timer started. Timer ID: ${this._imageAuthCookiePollingTimerId}`;e||this._logger.warn(a)}async initBaseImageUrl(){const e=I.get(h.ej.MT_KEY)??[],t=await this.getBaseUrl(e[0]);t&&this._baseImageUrlSubject.next(t)}async getBaseUrl(e){try{const t=await this._discover.regionGtm(e);return t||this._logger.error("baseImageUrl is undefined"),t}catch(t){const n=`Fetching baseImageUrl failed from regionGTM, passed gtm: ${e.length}, errorCode: ${t?.code}, errorContext: ${t?.context}, errorMessage: ${t?.message}`,i=(0,k.A)(n);return this._logger.errorToTelemetry?this._logger.errorToTelemetry(i,"async_media_auth_service",void 0,!0):this._logger.error(n),Promise.reject(t)}}subscribeToToken(e){e===h.ej.SKYPE_KEY&&this._discover.observeSkypeToken().subscribe((e=>this.persistTokenToAMS(e,h.ej.SKYPE_KEY))),e===h.ej.MT_KEY&&this._authenticationService?.observeMiddleTierToken().subscribe((e=>this.persistTokenToAMS(e,h.ej.MT_KEY)))}getHeaders(e,t){const n={},i=(0,u.v4)();return n.Authorization=`${t===h.ej.SKYPE_KEY?"skype_token":"Bearer"} ${e}`,n["Content-Type"]="application/x-www-form-urlencoded",n.RequestId=i,n.CorrelationId=i,n.TransactionId=i,n["x-ms-client-type"]=(0,g.I)(this.platformService,this.config),n}async persistTokenToAMS(e,t){let n,i,a,o,r=s.E.Skype;const d=I.get(t)??[],u=this.getHeaders(e,t);if(!e)return Promise.resolve(null);if(this._activeAmsRequest[t])return this._activeAmsRequest[t];switch(this._logger.log(`persistTokenToAMS: received new token for ${t}`),t){case h.ej.SKYPE_KEY:n=`skypetoken=${e}`,i="v1/skypetokenauth",r=s.E.Skype;break;case h.ej.MT_KEY:o=this.scenarioFactory.newScenario(C.RG.ImageAuthCookie),i=this._isMTMAProfilePicturesEnabled&&this.user?.id?w.replace("{objectId}",this.user.id):b,r=s.E.MiddleTier,a=await this.getBaseUrl(d[0]);const{requireSkypetokenForMT:t}=this.coreSettings.get(l.J.Auth),{disableSkypeTokenInCookieRequest:c}=this.coreSettings.get(l.J.People);t&&!c&&(u["x-skypetoken"]=await this._discover.validateSkypeToken())}return this._logger.log(`persistTokenToAMS: queueing request for ${t}`),this.queueRequests(d,t,{requestUrl:i,headers:u,requestBody:n,serviceName:r},"persistTokenToAMS"),Promise.all(this._activeAmsRequest[t]).then((()=>{this._activeAmsRequest[t]=void 0,this._logger.log(`persistTokenToAMS: persist token for ${t}`),t===h.ej.MT_KEY&&(this.setImageAuthCookieValidityAndExpiry(),o&&o.stop({reason:"Cookie_success"}),a?this._baseImageUrlSubject.next(a):this._logger.error("baseImageUrl is undefined"))})).catch((e=>{if(t===h.ej.MT_KEY){const{reason:t,code:n,context:i}=e,a=(0,f.Wc)(e)||(0,f.K3)(t,i),r={errors:(0,k.A)(e),errorCode:n,reason:(0,k.A)(t)};o&&(a?o.cancel(r):o.fail(r))}this._logger.error(`Unable to persist token: tokenType ${t} error ${e}`),this._activeAmsRequest[t]=void 0;const{enableRetryAuthCookieWithEM:n}=this.coreSettings.get(l.J.People);n&&e?.code===c.jK.RemoteOperationFailed&&t===h.ej.MT_KEY&&(this._logger.log("persistTokenToAMS: retry cookie set up with EM"),this.setupImageAuthCookieAndExpiry())})),this._activeAmsRequest[t]}queueRequests(e,t,n,i){this._activeAmsRequest[t]=[],e.map((e=>{this._activeAmsRequest[t].push(this.getRequest(e,n,i))}))}async checkAuthCookieValidity(){if(this.isImageCookieExpired()){this._logger.log(`image auth cookie expired for account ${this.user?.id}`),this._isImageAuthCookieValidSubject.next(!1);const e=this.networkState?.isOnline();if(e){const{mtResource:e}=await this.coreSettings.get(l.J.Auth);if(e&&this._authenticationService?.acquireTokenV2){const t=Math.round(Date.now()/T);this._logger.log(`force token refresh now ${t} for account ${this.user?.id}`);const n=await(this._authenticationService?.acquireTokenV2(e));this._logger.log(`refreshed token expiry ${n?.expires} for account ${this.user?.id}`)}}}}subscribeToClientAndMachineStates(){const{enableAuthCookieValidityCheck:e}=this.coreSettings.get(l.J.People);e&&(this.clientState?.observe().subscribe((async e=>{this._logger.log(`receive clientState ${e} for account ${this.user?.id}`);(e===d.pk.Active||e===d.pk.VeryActive)&&this.checkAuthCookieValidity()})),this.networkState?.observeIsOnline().subscribe((e=>{this._logger.log(`receive isOnline ${e} for account ${this.user?.id}`),e&&this.checkAuthCookieValidity()})),this.hostState?.observe().pipe((0,p.x)(((e,t)=>e.machineLockState===t.machineLockState))).subscribe((e=>{this._logger.log(`receive machineLockState ${e.machineLockState} for account ${this.user?.id}`),e.machineLockState===d.UV.Active&&this.checkAuthCookieValidity()})),this.hostState?.observe().pipe((0,p.x)(((e,t)=>e.machineIdleState===t.machineIdleState))).subscribe((e=>{this._logger.log(`receive machineIdleState ${e.machineIdleState} for account ${this.user?.id}`),e.machineIdleState===d.fI.Active&&this.checkAuthCookieValidity()})))}subscribeToMiddleTierToken(){this._authenticationService?.observeMiddleTierToken().subscribe((e=>{if(e||this.isImageCookieExpired()){const t=e?"token changed":"cookie expired";this._logger.log(`Set up image auth cookie due to: ${t}`),this.setupImageAuthCookieAndExpiry()}else this._isImageAuthCookieValidSubject.next(!0)}))}async setImageAuthCookieValidityAndExpiry(){this._isImageAuthCookieValidSubject.next(!0);const{mtResource:e}=await this.coreSettings.get(l.J.Auth)||{};if(e&&this._authenticationService?.acquireTokenV2){const t=await(this._authenticationService?.acquireTokenV2(e)),n=t?.expires;n&&this.localStorage?.set(this._imageAuthCookieExpiryTsKey,n.toString(),"Auth","Global"),this._logger.log(`Successfully set up image auth cookie expiry ${n}`)}}async setupImageAuthCookieAndExpiry(){if(!this._isSetupImageCookieInProgress){this._isSetupImageCookieInProgress=!0,this._logger.log("Setting up image auth cookie");try{await this._setupImageAuthCookieApi.setupImageAuthCookie(),this.setImageAuthCookieValidityAndExpiry()}catch(e){this._logger.error(`setupImageAuthCookieAndExpiry error ${e}`)}finally{this._isSetupImageCookieInProgress=!1}}}isImageCookieExpired(){const e=Math.round(Date.now()/T),t=this.localStorage?.get(this._imageAuthCookieExpiryTsKey,"Global")||"-1";return parseInt(t,10)<e}imageCookieRetryPolicy(){return{shouldRetry:(e,t,n)=>{if(t>=r.qb.OK&&t<=r.qb.NOT_MODIFIED)return!1;const i=e<this._imageCookieRetryMaxCount&&t!==r.qb.BAD_REQUEST&&t!==r.qb.NOT_AUTHORIZED&&t!==r.qb.FORBIDDEN;return this._logger.warn(`imageCookieRetryPolicy retry count ${e} responseCode ${t} canRetry ${i}`),i},nextDelay:e=>this._imageCookieRetryInterval*Math.pow(2,e)}}get baseImageUrlObservable(){return this._baseImageUrlSubject.asObservable()}get isImageAuthCookieValidObservable(){return this._isImageAuthCookieValidSubject.asObservable()}get baseImageUrl(){return this._baseImageUrlSubject.value}get isImageAuthCookieValid(){return this._isImageAuthCookieValidSubject.value}}},84539:(e,t,n)=>{"use strict";n.d(t,{D:()=>nt,fh:()=>Ze,Vf:()=>tt,bl:()=>et});var i=n(593697),a=n(803238),o=n(683184),r=n(543491),s=n(904986),l=n(876934),c=n(85883),d=n(205454),u=n(716626);const m=e=>{e&&d.N.DomUtils.hasAttrib(e,u.zj.type)&&delete e.attribs[u.zj.type]};var p=n(674716),g=n(131523),h=n(72742),y=n(557870);const v={fileDetailsPromiseResolved:"file_deatails_promise_resolved"};let f=class{constructor(){this._allowAsyncChicletCreation=!1,this._asyncLinkConversionDetailsByItemId=new Map,this._loggerCb=a.noop,this._timeout=0}async preTransform(e,t){if(!e||!t||!d.N.DomUtils.hasAttrib(e,"href"))return;this._setupConstants(t);const n=e.attribs[u.zj.itemid];if(!n)return;const i=!!d.N.DomUtils.hasAttrib(e,u.zj.dataProcessedUrl)&&"true"===e.attribs[u.zj.dataProcessedUrl];if(this._allowAsyncChicletCreation&&!i){const i=(0,a.unescape)(e.attribs.href),{fileReferenceService:o}=t,s=o.parseFileLabelFromUrl(i);if(!s)return void m(e);const c=this._scenarioFactory?.newScenario(r.RG.AsyncLinkToChiclet),d=this._asyncLinkConversionDetailsByItemId.get(n);if(d)return void F(d,i,c,(e=>this._asyncLinkConversionDetailsByItemId.set(n,e)));try{const e=(0,l.E)(o.getFileDetails(s,"chat",["fluid"]),this._timeout,"file details call timed out");this._asyncLinkConversionDetailsByItemId.set(n,{fileDetailsPromise:e,scenario:c,linkInfo:{href:i,count:1}})}catch(t){return _(e,c,t?.message||"")}}return e}async transform(e,t){if(!(e&&d.N.DomUtils.hasAttrib(e,"href")&&t&&t.files&&t.messageProperties&&t.existingLinks))return;const n=e.attribs[u.zj.itemid];if(!n)return;const i=this._asyncLinkConversionDetailsByItemId.get(n);if(i){const{scenario:n}=i;try{const a=await k(t,e,i);return n&&n.stop(),a}catch(t){return m(e),void(0,p.V)(t,this._loggerCb,n)}}if(!d.N.DomUtils.hasAttrib(e,u.zj.itemProps))return A(e,t);const{files:a}=t;try{const i=E(a,e);if(!i)return;const{shareUrl:o,title:r}=i;o&&(e.attribs.href=o),b(e,r,o),C(i,n,t)}catch(e){return}return e}_setupConstants({coreSettings:e,loggerFactory:t,scenarioFactory:n}){this._loggerCb=S(t.newLogger("SharepointLinkSerializer","services-io-files-compose-serializer-extensions")),this._scenarioFactory=n;const{enableFilesAsyncChicletCreationInMultiWindow:i,asyncChicletCreationTimeout:a}=e.get(o.J.Files);this._allowAsyncChicletCreation=!!i,this._timeout=a||3e3}};f=(0,i.__decorate)([(0,s.HR)({name:"SharepointLinkSerializer",filter:"a"})],f);const S=e=>t=>{e.error(t)},k=async(e,t,n)=>{const{fileDetailsPromise:i,scenario:a}=n,o=await i;return a&&a.mark(v.fileDetailsPromiseResolved),C(o,o.fileId,e),((e,t)=>{const{files:n}=t;return-1!==n.findIndex((t=>t.id===e.fileId))})(o,e)||N(e,(({objectUrl:e,shareUrl:t,type:n,fileId:i,title:a,baseUrl:o,shareId:r,fileSourceDetail:s})=>{const l=(0,y.gD)(e),{permissionScope:c}=s||{permissionScope:""};return{id:i,baseUrl:o,objectUrl:e,shareUrl:t,shareId:r,type:n,title:a,permissionScope:c,state:"reference",isReferencedFile:!0,serviceName:"p2p",previewUrl:"",chicletBreadcrumbs:{sourceChannelName:l?.sourceChannelName||null,sourceTeamName:l?.sourceTeamName||null},previewHeight:null,previewWidth:null,progressComplete:null,hasUploadFailed:!1}})(o)),m(t),t},C=(e,t,n)=>{const{objectUrl:i,shareUrl:a,title:o,type:r}=e,s=T({objectUrl:i,shareUrl:a,itemid:t,type:r,title:o});I(n,s)},b=(e,t,n)=>{e.children&&w(t,e,n)},w=(e,t,n)=>{const i=[t];for(;0!==i.length;){const o=i.pop();if(o&&o.children)for(const r of o.children){if("text"===r.type&&(0,a.startsWith)(r.data,"https"))return r.data=e,t.attribs&&(t.attribs.title=n),!0;i.push(r)}}return!1},T=({objectUrl:e,shareUrl:t,itemid:n,type:i,title:a})=>({title:a,objectUrl:e,description:"",fileShareUrlMeta:{id:n,objectUrl:e,type:i,shareUrl:t}}),I=(e,t)=>{e.messageProperties.embeddedLinks=[...e.messageProperties.embeddedLinks||[],t],e.telemetryDatabag["DataBag.links"]=(e.telemetryDatabag["DataBag.links"]||0)+1},N=(e,t)=>{e.files.push(t)},E=(e,t)=>{const n=t.attribs[u.zj.itemid],i=e.find((e=>e.id===n));if(i){const{shareUrl:e,title:t,objectUrl:n,type:a}=i;return{shareUrl:e||"",title:t||"",type:a||"",objectUrl:n||""}}if(t.attribs[u.zj.itemtype]===h.T.filesHyperlink){const e=t.attribs[u.zj.itemProps];if(e){const t=(0,a.unescape)((0,a.unescape)(e)),n=JSON.parse(t),{type:i,objectUrl:o,shareUrl:r,title:s}=n;return{shareUrl:r,title:s,objectUrl:o,type:i}}}},A=(e,t)=>{if(d.N.DomUtils.hasAttrib(e,"href")){const n=e.attribs.href||"",i=t.existingLinks.filter((e=>e.fileShareUrlMeta?.shareUrl===n));if(i&&i.length&&i[0].fileShareUrlMeta)return I(t,(0,c.i)(i[0],"__typename")),e}},_=(e,t,n)=>{m(e),t?.fail({errorCode:g.le.telemetry.errorCodes.asyncLinkConversionPretransformFailure,errors:JSON.stringify(n)})},F=(e,t,n,i)=>{const{linkInfo:a}=e;let o="";if(a&&t===a.href){const{count:n}=a;o=`Duplicate links: ${n}`,i({...e,linkInfo:{href:t,count:n+1}})}else o="Different href for same itemid";n?.incomplete({errorCode:g.le.telemetry.errorCodes.asyncLinkMultiplePretransform,errors:o})};var D=n(438792),P=n(789168),M=n(309501),x=n(811957);let R=class{constructor(){this._shouldGroupMentions=()=>this._enableComposeFrameworkV2&&this._enableGroupedMentions,this._unescapeMentionText=e=>this._enableComposeFrameworkV2?(0,a.unescape)(e).replace(/&nbsp;/g," "):e,this._removeExtraSpacesInMention=e=>{e.parent?.children.forEach((e=>{"text"!==e.type||" "!==e.data&&!this._isWhitespaceFromComposeV2(e.data)||d.N.DomUtils.removeElement(e)}))},this._getMentionKey=e=>{const t=e.children?.[0]?.data,n=e.attribs?.[u.zj.mri];return`${n}_${t}`},this._mergeMentions=(e,t)=>{if(!e.attribs)return;const n=e.attribs[u.zj.mri]||"";let i=this._getNextContigousMention(e,n);for(;e.children&&e.children.length>0&&i;){const a=i.children;if(a&&a.length>0&&a[0].data){const n=this._getMentionKey(i),o=t.get(n);o?t.set(n,o+1):t.set(n,1),e.children[0].data+=` ${a[0].data}`}i=this._getNextContigousMention(i,n)}},this._isWhitespaceFromComposeV2=e=>!("&nbsp;"!==e||!this._shouldGroupMentions()),this._getNextContigousMention=(e,t)=>{if(!e||!e.next)return null;const n=e.next,i=t===n?.attribs?.[u.zj.mri];return" "===n.data||this._isWhitespaceFromComposeV2(n.data)||i?n:null},this._enableComposeFrameworkV2=!1,this._enableGroupedMentions=!1}transform(e,t){const{enableComposeFrameworkV2:n}=t.coreSettings.get(o.J.Messaging),{enableGroupedMentions:i}=t.coreSettings.get(o.J.Compose);if(this._enableComposeFrameworkV2=!!n,this._enableGroupedMentions=!!i,!(e&&t&&t.messageProperties&&d.N.DomUtils.hasAttrib(e,u.zj.mri)))return;t.seenMentions||(t.seenMentions=new Map);const r=this._getMentionKey(e),s=t.seenMentions.get(r);if(s)return 1===s?t.seenMentions.delete(r):t.seenMentions.set(r,s-1),null;this._mergeMentions(e,t.seenMentions);const{messageProperties:l,telemetryDatabag:c}=t;l.mentions||(l.mentions=[]),l.onBehalfOf||(l.onBehalfOf=[]);const m=`${l.mentions.length+l.onBehalfOf.length}`,p=this._unescapeMentionText((0,P.Q)(e)),g=e?.attribs?.[u.zj.type]||(j(e)?"bot":"person");if("tag"===g){const t=e?.attribs?.[u.zj.mri]?.startsWith("s")?"PeopleTargeting.numScheduledTagMentions":"PeopleTargeting.numTeamTagMentions";c[t]=(c[t]||0)+1}else c["DataBag.atmentions"]=(c["DataBag.atmentions"]||0)+1;const y=(0,P.ln)(D.eK.span),v=(0,P.rw)((0,a.escape)(p)),f=d.N.DomUtils.hasAttrib(e,u.zj.stale),S=d.N.DomUtils.getAttributeValue(e,u.zj.mri)||"";return d.N.DomUtils.appendChild(y,v),f||("webhook"===g?(l.onBehalfOf.push({itemId:m,displayName:p,userId:S,mentionType:g}),l.mentions.push({itemId:`${Number(m)+1}`,displayName:p,userId:M.BB.InterceptorBotMris[0],mentionType:g})):l.mentions.push({itemId:m,displayName:p,userId:S,mentionType:g}),y.attribs[u.zj.itemtype]=h.T.mention,y.attribs[u.zj.itemscope]=e?.attribs?.[u.zj.itemscope]??"",y.attribs[u.zj.itemid]=m),this._removeExtraSpacesInMention(e),y}};R=(0,i.__decorate)([(0,s.wx)({name:"AtMentionSerializer",filter:"mention"}),(0,i.__metadata)("design:paramtypes",[])],R);const j=e=>(0,x.bl)(e?.attribs?.[u.zj.mri]||"");let L=class{transform(e,t){if(!e.attribs)return void t.logger.error("image attribs is missing");const n=d.N.DomUtils.getAttributeValue(e,u.zj.cacheKey);if(n&&n.length)return e.attribs["data-cke-saved-src"]=void 0,e.attribs.src=t.offlineCacheManager.getCachedUrlByKey(n),e;t.logger.error("image missing cache key")}};L=(0,i.__decorate)([(0,s.wx)({name:"CachedImageSerializer",filter:[{itemtype:h.T.cachedImage}]})],L);let O=class{preTransform(e){return null}};O=(0,i.__decorate)([(0,s.wx)({name:"RemoveHiddenSelectionSerializer",filter:["data-cke-hidden-sel"]})],O);var $=n(238572);let U=class{transform(e){if(e.data&&$.Eh.test(e.data))return e.data=e.data.replace(new RegExp($.Eh,"g"),""),e}};U=(0,i.__decorate)([(0,s.wx)({name:"RemoveZwsSerializer",filter:"text",transient:!0})],U);const B="data-only-whitespace",W=/^(\s|[\u200B-\u200D\uFEFF])*$/;let H=class{preTransform(e,t){return V(e)?void(t.whiteSpaceId&&t.whiteSpaceId++):(t.whiteSpaceId||(t.whiteSpaceId=1),e.attribs||(e.attribs={}),e.attribs[B]=`${t.whiteSpaceId+1}`,e)}};H=(0,i.__decorate)([(0,s.wx)({name:"WhiteSpacePreprocessor",filter:["div","p","br","span","text"],transient:!0})],H);const V=e=>!W.test((0,P.Q)(e))||!!d.N.DomUtils.findOne((e=>{if(e.attribs&&Object.keys(e.attribs).length||!e.name)return!0;switch(e.name.toLowerCase()){case"br":case"div":case"p":case"span":break;default:return!0}return!1}),[e]);let G=class{transform(e,t){const n=d.N.DomUtils.getAttributeValue(e,B);return!t.whiteSpaceId||!n||+n>t.whiteSpaceId?null:(e.attribs&&delete e.attribs[B],e)}};G=(0,i.__decorate)([(0,s.wx)({name:"TrailingWhiteSpaceSerializer",filter:[B],transient:!0})],G);var z=n(823805);const q={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataM365ChatSuggestionStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365ChatSuggestionState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"convId"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"experience"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]},J={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataM365ChatGeoLocationQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"m365GeoLocation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"latitude"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"longitude"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}}]};let Q=class{transform(e,t){const{messageProperties:n,coreSettings:i,conversationMembers:r,cache:s,convId:l,loggerFactory:c}=t,{m365ChatBotIds:m,copilotBotDataVersion:p}=i.get(o.J.Messaging);if(!(K(m,r,n,c,s,l,p,e)&&e&&t&&t.messageProperties&&d.N.DomUtils.hasAttrib(e,u.zj.itemtype)))return;const g=d.N.DomUtils.getAttributeValue(e,u.zj.itemtype);if(g!==h.T.editorCiqFile&&g!==h.T.editorCiqPeople&&g!==h.T.editorCiqMeeting&&g!==h.T.editorCiqEmail&&g!==h.T.editorCiqChat)return;const y=d.N.DomUtils.getAttributeValue(e,u.zj.itemProps);return y&&Y((0,a.unescape)(y),n,p??ie,g),e}};Q=(0,i.__decorate)([(0,s.wx)({name:"CopilotSerializer",filter:"*"})],Q);const K=(e,t,n,i,a,o,r,s)=>{const l=t?.filter((e=>e?.startsWith("28:")))??[];let c=!1;if(1===l?.length&&e){const t=e.indexOf(l[0]);void 0!==t&&(c=t>-1)}let d=n.mentions?.find((e=>e.mentionType===ne));if(c&&!d){const e=X(o,i,a,s);d={itemId:"0",userId:"3209c41b-0e5c-45cb-b72e-68dcecbaa23d",mentionType:ne,displayName:JSON.stringify({copilotBotDataVersion:r??"1.0",files:[],people:[],meetings:[],chats:[],emails:[],...e})},n.mentions=[d]}return c},Y=(e,t,n,i)=>{let a=t.mentions?.find((e=>e.mentionType===ne));a||(a={itemId:"0",userId:"3209c41b-0e5c-45cb-b72e-68dcecbaa23d",mentionType:ne,displayName:JSON.stringify({copilotBotDataVersion:"1.0",files:[],people:[],meetings:[],chats:[],emails:[]})});const o=JSON.parse(a.displayName),r=o.files,s=o.people,l=o.meetings,c=o.chats,d=o.emails,u=o.experienceType,m=o.locationInfo;let p;try{p=JSON.parse(te(te(e)))}catch(e){return}i===h.T.editorCiqFile&&r.push(p),i===h.T.editorCiqPeople&&s.push(p),i===h.T.editorCiqMeeting&&l.push(p),i===h.T.editorCiqChat&&c.push(p),i===h.T.editorCiqEmail&&d.push(p);const g={experienceType:u,locationInfo:m,copilotBotDataVersion:n||o.CopilotBotDataVersion,files:r,people:s,meetings:l,chats:c,emails:d};a.displayName=JSON.stringify(g),t.mentions=[a]},X=(e,t,n,i)=>{const a=t.newLogger("CopilotSerializer","services-io-browser-compose-serializer-extensions");return{experienceType:Z(e,a,n,i),locationInfo:ee(n,a)}},Z=(e,t,n,i)=>{const a="Default";if(!i)return a;const{experience:o,convId:r}=((e,t)=>{let n=null;try{n=e.readQuery({query:q})}catch(e){t?.error("Cannot read zero prompt state from the cache.")}const{convId:i,experience:a}=n?.m365ChatSuggestionState??{};return{convId:i,experience:a}})(n,t);return r===e&&o?o:a},ee=(e,t)=>{const{latitude:n,longitude:i}=((e,t)=>{let n=null;try{n=e.readQuery({query:J})}catch(e){t?.error("Cannot read zero prompt state from the cache.")}const{latitude:i,longitude:a}=n?.m365GeoLocation??{};return{latitude:i,longitude:a}})(e,t);return n&&i?{lat:n,long:i}:void 0},te=e=>e?e.replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g,"Â ").replace(/&amp;/g,"&"):"",ne="Copilot",ie="1.0";var ae=n(538523),oe=n(626340);let re=class{transform(e,t){const n=e.attribs["data-orig-src"],i=e.attribs.itemid;if(!n||!i)return;const a=t.superSizeEmoticons?"large":"small",o=(0,oe.cn)(a),r=e.attribs.alt;t.telemetryDatabag&&(t.telemetryDatabag["DataBag.emojiList"]=[...t.telemetryDatabag["DataBag.emojiList"]||[],"CustomEmojiId"]);const s=(0,P.ln)("img",{alt:r,itemid:i,itemtype:h.T.customEmoji,src:n,style:`width:${o}px;height:${o}px;`}),l=(0,P.ln)("span",{contenteditable:"false"});return d.N.DomUtils.appendChild(l,s),l}};re=(0,i.__decorate)([(0,s.wx)({name:"CustomEmojiSerializer",filter:{itemtype:h.T.customEmoji}})],re);var se=n(882898);let le=class{transform(e){return d.N.DomUtils.getAttributeValue(e,u.zj.itemProps)&&delete e.attribs[u.zj.itemProps],e}};le=(0,i.__decorate)([(0,s.wx)({name:"FluidEmbedSerializer",filter:{itemtype:h.T.fluidEmbedLink}})],le);var ce=n(491112),de=n(666921);let ue=class{transform(e,t){const n=d.N.DomUtils.getAttributeValue(e,"href");if(!n||!e.attribs)return;const i=n.replace(/&amp;/g,"&");d.N.DomUtils.getAttributeValue(e,u.zj.itemProps)&&delete e.attribs[u.zj.itemProps];const a={appId:"fluid-card",cardClientId:(0,ce.Z)(),contentType:de.p.Fluid,content:JSON.stringify({componentUrl:i})};return t.messageProperties.cards=[a],t.files=void 0,e}};ue=(0,i.__decorate)([(0,s.wx)({name:"FluidSerializer",filter:{itemtype:h.T.fluidLink}})],ue);var me=n(37718),pe=n(361899),ge=n(98666),he=n(56056),ye=n(584613),ve=n(498346),fe=n(655708),Se=n(52841),ke=n(347463);let Ce=class{constructor(){this.getImageBlobUrlFromCache=async(e,t)=>{const n=await e.offlineCacheManager.get(t),i=await n.blob();return URL.createObjectURL(i)},this.processCachedImage=async(e,t)=>{const n=d.N.DomUtils.getAttributeValue(e,u.zj.cacheKey);if(!n)return void this._logger.error("Cached image missing key attribute.");this._logger.log(`processing cached image: ${n}`);const i=this._scenarioFactory?.newScenario(r.RG.SerializeCachedImage);try{const a=d.N.DomUtils.getAttributeValue(e,"src"),o=!!a?.startsWith("blob");let s;try{const e=await t.offlineCacheManager.get(n);s=await(e?.blob())}catch(e){s=null,this._logger.warn(`processCachedImage: Could not find cached image with key=${n} in offlineCacheManager`)}if(!s&&o&&a&&(s=await(0,ve.Hk)(a)),null===s)throw Error("Could not get image Blob neither from cache nor from blob data");i?.mark(r.ck.SerializeCachedImageGotData);const l=await this.uploadImage(s,t);we(e,l,t),i?.mark(r.ck.SerializeCachedImageUploadedData),await this.markCachedImageForDeletionIfUploaded(l,e,n,t,i)}catch(e){throw this._logger.error(`processCachedImage: Failed to process cached image with key=${n}`),i?.fail(),e}finally{i?.stop()}return e}}transform(e,t){if(this._logger=t.loggerFactory.newLogger("InlineImageSerializer","services-io-browser-compose-serializer-extensions"),(0,ke.eD)(e.attribs.src))return Promise.resolve(e);if(e.attribs.itemtype===h.T.customEmoji)return Promise.resolve(e);if(!this.isConfigValid(t))return this._logger.error("invalid config"),Promise.resolve(void 0);this._scenarioFactory=t.scenarioFactory,this._settings=t.coreSettings;let n=d.N.DomUtils.getAttributeValue(e,"src");const i=d.N.DomUtils.getAttributeValue(e,fe.q2),{enableImprovedImageHandling:a,enableComposeFrameworkV2:r,enableImageBlobConversionForMessageEdit:s}=this._settings.get(o.J.Messaging);if(!n)return this._logger.errorToTelemetry?.("Image src is missing","compose_inline_image_error_tracking",void 0,!0),Promise.resolve(void 0);if(a&&i!==Se.R.SUCCESS&&e.attribs.itemtype===h.T.inlineImage&&this._logger.errorToTelemetry?.(`Inline image failed to load (imageLoadingState: ${i}, imageSrcEmpty: ${!!n}).`,"compose_inline_image_error_tracking",void 0,!0),(a||s)&&r){const t=d.N.DomUtils.getAttributeValue(e,"data-orig-src");n=t&&(0,he.KD)(t)?t:n}const l=(e.attribs.itemtype===h.T.amsImage||e.attribs.itemtype===h.T.cachedImage||e.attribs.itemtype===h.T.inlineImage?d.N.DomUtils.getAttributeValue(e,u.zj.itemid):void 0)??(0,he.KD)(n);if(l)return this.handleAmsSourceTag(l,e,t);const c=d.N.DomUtils.getAttributeValue(e,u.zj.itemtype)===h.T.cachedImage,m=d.N.DomUtils.getAttributeValue(e,u.zj.itemtype)===h.T.inlineImage&&n.startsWith("blob:");return c||m?this.processCachedImage(e,t):n.startsWith("http://")||n.startsWith("https://")?(0,ye.kf)(n)?this.processKnownImage(n,t.telemetryDatabag):this.handleKnownProtcolSourceTag(n,"HttpUrl",e,t):n.startsWith("blob:")?this.handleKnownProtcolSourceTag(n,"BlobUrl",e,t):(this._logger.error("Unsupported image! deleting it."),Promise.resolve(null))}async uploadPermissionsUpdateToCache(e,t){try{this._logger.log("uploadPermissionsUpdateToCache: uploading image permissions update to offline cache storage");const n={type:"PermissionsUpdate",amsId:e,convId:t.conversationId},i=JSON.stringify(n),[a,o]=await t.offlineCacheManager.saveDynamic(new Response(i,{headers:new Headers({"Content-Type":"application/json","Cache-Control":"max-age=259200, s-maxage=0, private","Content-Length":`${i.length}`,Date:(new Date).toUTCString()})}));return this._logger.log(`uploadPermissionsUpdateToCache: Uploaded image permissions update to offline cache, response URL: ${o} objectId: ${a}`),t.messageProperties.offlineAssets=[...t.messageProperties.offlineAssets||[],a],a}catch(e){throw this._logger.error("uploadPermissionsUpdateToCache: uploading image permissions update to offline cache store failed!"),e}}async handleAmsSourceTag(e,t,n){try{const i="AMS",a=d.N.DomUtils.getAttributeValue(t,"data-orig-src"),o=!!a&&a.endsWith(pe.Hl),r=await n.asyncMediaService.forwardContent(e,n.conversationId,o);return this._logger.log(`forwarded ams image ${e} to ${r.objectId}`),n.messageProperties.amsReferences=[...n.messageProperties.amsReferences||[],r.objectId],we(t,{...r,uploadType:i},n),t}catch(e){const{enableAutoEditV2:t}=this._settings.get(o.J.Messaging);if(!t)throw this._logger.error("handleAmsSourceTag: forward content failed!"),e;this._logger.warn("handleAmsSourceTag: initial forward content failed, attempting to upload image to cache")}try{return await this.uploadPermissionsUpdateToCache(e,n),be(n),t}catch(e){throw this._logger.error("handleAmsSourceTag: forward content failed! Fallback uploading to the cache also failed!"),e}}async handleKnownProtcolSourceTag(e,t,n,i){try{const a=await Te(e,t,i),o=await this.uploadImage(a,i);return we(n,o,i),n}catch(e){throw this._logger.error("handleKnownProtcolSourceTag: pasted from web image upload failed"),this.addDiagnosticCodeToError(e),e}}async uploadImage(e,t,n=!1){try{return await this.uploadImageToAms(e,t,this._logger)}catch(i){this._logger.error("uploadImage: image upload to AMS failed!");const{enableCacheStorageInSendMessageMW:a,msgEnableRestrictImagePasting:r}=this._settings.get(o.J.Messaging);if(!a||r||n)throw i;this._logger.debug("Trying to upload inline image to cache storage");return await this.uploadToCache(e,t,this._logger)}}async uploadImageToAms(e,t,n){const i=t.asyncMediaService.createAmsScenario(r.RG.AmsImageUpload);try{const a="AMS",o=await t.asyncMediaService.uploadItem(e,t.conversationId,"IMAGE","MicrosoftTeams-image.png",ge.r1.Inline);return n.log(`Uploaded image to ams, image: ${o.inlineSizeUrl} objectId: ${o.objectId}`),i.stop(),t.messageProperties.amsReferences=[...t.messageProperties.amsReferences||[],o.objectId],{...o,uploadType:a}}catch(e){throw i.fail({errors:e.message}),n.error("Ams image upload failed!"),e}}async uploadToCache(e,t,n){try{n.log("uploading inline image to offline cache storage");const[i,a]=await t.offlineCacheManager.saveDynamic(new Response(e,{headers:new Headers({"Content-Type":e.type,"Cache-Control":"max-age=259200, s-maxage=0, private","Content-Length":`${e.size}`,Date:(new Date).toUTCString()})}));n.log(`Uploaded image to offline cache, image: ${a} objectId: ${i}`);const o="OfflineCache";t.messageProperties.offlineAssets=[...t.messageProperties.offlineAssets||[],i];return{objectId:i,inlineSizeUrl:await this.getImageBlobUrlFromCache(t,i),uploadType:o}}catch(e){throw n.error("uploadToCache: uploading inline image to offline cache store failed!"),e}}async markCachedImageForDeletionIfUploaded(e,t,n,i,a){return"OfflineCache"!==e.uploadType&&(a?.mark(r.ck.SerializeCachedImageDeletedEntry,void 0),i.nonBlockingDeletableCacheKeys.push(n),t.attribs&&delete t.attribs[u.zj.cacheKey],!0)}isConfigValid(e){return!!(e&&e.asyncMediaService&&e.messageProperties&&e.imageProxyService&&e.conversationId&&e.telemetryDatabag&&e.offlineCacheManager)}processKnownImage(e,t){return e.endsWith(".gif")&&(t["DataBag.giphy"]=(t["DataBag.giphy"]||0)+1),Promise.resolve(void 0)}addDiagnosticCodeToError(e){if(e.serverResponse&&e.serverResponse.status){if(e.serverResponse.status===me.qb.UNSUPPORTED_MEDIA_TYPE)e.reason={...e.reason,errorCode:he.hA.IMAGE_SIZE_TOO_LARGE}}}};Ce=(0,i.__decorate)([(0,s.HR)({name:"InlineImageSerializer",filter:["img","image"]})],Ce);const be=e=>{e.telemetryDatabag["DataBag.inlineImages"]=(e.telemetryDatabag["DataBag.inlineImages"]||0)+1},we=(e,t,n)=>{e.attribs||(e.attribs={}),e.attribs.id=t.objectId,e.attribs.itemid=t.objectId,e.attribs.href=t.inlineSizeUrl,e.attribs["target-src"]=t.inlineSizeUrl,e.attribs.src=t.inlineSizeUrl,e.attribs[u.zj.itemtype]="AMS"===t.uploadType?h.T.amsImage:h.T.cachedImage,be(n)},Te=async(e,t,n)=>{let i=null;return"BlobUrl"===t?i=await(0,ve.Hk)(e):"HttpUrl"===t&&(i=await n.imageProxyService.getImageAsBlob(e)),i};var Ie=n(191366),Ne=n(980860),Ee=n(478716),Ae=n(404363),_e=n(766527),Fe=n(720477);let De=class{async transform(e,t){this._logger=t.loggerFactory.newLogger("InlineVideoSerializer","services-io-browser-compose-serializer-extensions");const{enableInlineVideoMessageClosedCaptionsMultiLanguageSupport:n}=t.coreSettings.get(o.J.Messaging),i=t.scenarioFactory.newScenario(r.RG.InlineVideoAsyncTransform),{conversationId:a,videoMessageLieUpdater:s}=t;if(!(e&&e.attribs&&0!==Object.keys(e.attribs).length&&t.asyncMediaService&&t.offlineCacheManager&&s))return i.fail({errorCode:"unexpected_precondition"}),void this._logger.errorToTelemetry?.(`unexpected precondition : element - ${e}`,"messaging_inline_video_serializer_error_tracking",void 0,!0);this._offlineCacheManager=t.offlineCacheManager,this._asyncMediaService=t.asyncMediaService;const l=Pe(e);if(!l)return i.fail({errorCode:"malformed_video_message"}),void this._logger.errorToTelemetry?.(`malformed video message: element - ${e}, additionalData - ${t}`,"messaging_inline_video_serializer_error_tracking",void 0,!0);i.appendEventData({correlationId:l.cacheKey});const c=await this.resolveAMSItem(i,a,s,l);if(n){const e=t.scenarioFactory.newScenario(r.RG.VideoMessageTranscriptMetadataUpload);e.appendEventData({correlationId:l.cacheKey}),await this.uploadTranscriptMetadata(e,c,t.i18n,l.cacheKey,s,l.transcriptUploadStatus),e.stop()}const d=t.scenarioFactory.newScenario(r.RG.VideoMessageThumbnailUpload);d.appendEventData({correlationId:l.cacheKey}),await this.bestEffortUploadAMSVideoThumbnail(d,c,s,l),d.stop(),await this.uploadAMSVideo(i,c,s,l),t.messageProperties.amsReferences=[...t.messageProperties.amsReferences||[],c];const u=this.createVideoMessageTag(e.attribs,l.src);return this.bestEffortCleanOfflineCacheManager(i,l.cacheKey,!!l.thumbnailUploadProgress),i.stop(),u}createVideoMessageTag(e,t){const n=(0,P.ln)("video",{src:t,itemscope:"",itemtype:h.T.amsVideo,"data-duration":e[u.zj.duration],width:e[u.zj.width],height:e[u.zj.height]});return n.children=[(0,P.rw)(Ae.R2)],n}async resolveAMSItem(e,t,n,i){try{const a=await this.createAMSObjectIfRequired(e,t,n,i.cacheKey,i.src);return i.src=a.src,a.objectId}catch(t){throw e.fail({errorCode:"create_ams_object_failed"}),new Error(`create ams object failed:${t.toString()}`)}}async createAMSObjectIfRequired(e,t,n,i,a){if(!a){e.mark(r.ck.ItemCreationStart);const a=await this._asyncMediaService.createVideoObject(t,i),o=(0,Ae.$N)(a.amsUrl,a.objectId);return this.bestEffortMessageLieUpdate(e,n,i,u.zj.src,o),e.mark(r.ck.ItemCreationStop),{...a,src:o}}e.mark(r.ck.UploadRetry);return{objectId:(0,he.KD)(a),amsUrl:(0,Ne.DW)(a),src:a}}async bestEffortUploadAMSVideoThumbnail(e,t,n,i){if(i.thumbnailUploadProgress&&i.thumbnailUploadProgress.progress!==i.thumbnailUploadProgress.total)try{const a=await this.uploadAMSVideoThumbnail(e,t,n,i.cacheKey);i.thumbnailUploadProgress=a}catch(t){this._logger.warn("video thumbnail upload failed",t),e.fail({errorCode:"thumbnail_upload_failed"})}}async uploadAMSVideoThumbnail(e,t,n,i){e.mark(r.ck.ThumbnailUploadStart);const a=await this._offlineCacheManager.get((0,_e.cQ)(i)),o=await a.blob();await this._asyncMediaService.uploadVideoThumbnail(t,o,i);const s={progress:o.size,total:o.size};return this.bestEffortMessageLieUpdate(e,n,i,u.zj.thumbnailUploadProgress,(0,Ae.tl)(s.progress,s.total)),e.mark(r.ck.ThumbnailUploadStop),s}async uploadTranscriptMetadata(e,t,n,i,a,o){if(o!==Ae.b3.success){const o=n.locale,s=n.osLocaleInfo?.regionalFormat,l=[...(0,Ie.J)()?.navigator.languages||[]],c=(0,Fe.r)(o,s,l);try{e.mark(r.ck.TranscriptMetadataUploadStart,{message:c}),await this._asyncMediaService.uploadTranscriptMetadata(t,c||"en-us",i),this.bestEffortMessageLieUpdate(e,a,i,u.zj.transcriptUploadStatus,Ae.b3.success),e.mark(r.ck.TranscriptMetadataUploadStop)}catch(t){e.fail({errorCode:"video_transcript_metadata_upload_failed"}),this.bestEffortMessageLieUpdate(e,a,i,u.zj.transcriptUploadStatus,Ae.b3.failure)}}}async uploadAMSVideo(e,t,n,i){try{e.mark(r.ck.VideoUploadStart);const a=await this._offlineCacheManager.get((0,_e.If)(i.cacheKey)),o=await a.blob();await this._asyncMediaService.uploadVideo(t,i.uploadProgress.progress,o,this.updateMessageLieVideoUploadProgress(e,n,i),i.cacheKey),e.mark(r.ck.VideoUploadStop)}catch(t){throw e.fail({errorCode:"video_upload_failed"}),new Error(`video upload failed:${t.toString()}`)}}async bestEffortCleanOfflineCacheManager(e,t,n){try{await this._offlineCacheManager.delete((0,_e.If)(t))}catch(t){this._logger.warn("video cache cleanup failed",t),e.mark(r.ck.VideoCacheCleanFailed)}try{n&&await this._offlineCacheManager.delete((0,_e.cQ)(t))}catch(t){this._logger.warn("thumbnail cache cleanup failed",t),e.mark(r.ck.ThumbnailCacheCleanFailed)}}updateMessageLieVideoUploadProgress(e,t,n){return i=>{const a=i+1;n.uploadProgress.progress=a,this.bestEffortMessageLieUpdate(e,t,n.cacheKey,u.zj.uploadProgress,(0,Ae.tl)(n.uploadProgress.progress,n.uploadProgress.total))}}bestEffortMessageLieUpdate(e,t,n,i,a){try{t(n,i,a)}catch(t){e.mark(r.ck.MessageLieUpdateFailed),this._logger.warn(t.toString())}}};De=(0,i.__decorate)([(0,s.HR)({name:"InlineVideo",filter:[{itemtype:h.T.amsVideo}]})],De);const Pe=e=>{const t=d.N.DomUtils.getAttributeValue,n=t(e,u.zj.itemtype),i=t(e,u.zj.cacheKey),a=t(e,u.zj.src),o=t(e,u.zj.transcriptUploadStatus),r=t(e,u.zj.uploadProgress),s=t(e,u.zj.thumbnailUploadProgress),l=t(e,u.zj.duration),c=t(e,u.zj.width),m=t(e,u.zj.height);if(!n||!i||!r||!c||!m||!l||Number.isNaN(c)||Number.isNaN(m)||!(0,Ae.cJ)(r))return;const p={itemType:n,cacheKey:i,uploadProgress:(0,Ae.VI)(r),width:+c,height:+m,duration:+(0,Ee.J)(l),transcriptUploadStatus:o||Ae.b3.pending};return a&&(p.src=a),s&&(p.thumbnailUploadProgress=(0,Ae.VI)(s)),p};let Me=class{async transform(e,t){if(!e||!t.messageProperties)return;const n=t.loggerFactory.newLogger("VideoMessageComposeSerializer","services-io-browser-video-message-compose-serializer"),i=t.scenarioFactory.newScenario(r.RG.VideoMessageComposeTransform);i.mark(r.ck.VideoMessageValidation);const o=(0,a.unescape)(d.N.DomUtils.getAttributeValue(e,$.Qq)),s=d.N.DomUtils.getAttributeValue(e,$.fK);if(!o||!s)return n.errorToTelemetry?.(`The props are invalid from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null;i.mark(r.ck.VideoMessageParsing);let l=null;try{l=JSON.parse(o)}catch(t){return n.errorToTelemetry?.(`Failed to parse props from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null}if(!l||!l.amsObjectUrl)return n.errorToTelemetry?.(`The amsObjectUrl is missing from TVC card - ${e}.`,"messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null;try{i.mark(r.ck.VideoMessageUpdateCard),this._updateCard(s,l,t),i.mark(r.ck.VideoMessageCreateTag);return this.createVideoMessageTag(l,s)}catch(e){return n.errorToTelemetry?.("Failed to create the video tag additionalData","messaging_inline_video_compose_serializer_error_tracking",void 0,!0),null}}createVideoMessageTag(e,t){const n=(0,P.ln)("video",{src:e.amsObjectUrl,cardId:t,itemscope:"",itemtype:h.T.amsVideo,"data-duration":(0,Ae.Hu)(e.duration),width:e.width.toString(),height:e.height.toString()});return n.children=[(0,P.rw)(Ae.R2)],n}_updateCard(e,t,n){const{amsObjectId:i}=t,a=n.messageProperties.amsReferences||[];n.messageProperties.amsReferences=[...a,i];const o=n.messageProperties.cards?.filter((t=>t.cardClientId!==e))||[];n.messageProperties.cards=o}};Me=(0,i.__decorate)([(0,s.HR)({name:"VideoMessage",filter:{[$.$S]:"VideoMessageCard"}})],Me);var xe=n(960983);const Re=(e,t,n)=>{e.forEach((e=>je(e,t,n)))},je=(e,t,n)=>{(0,xe.gU)(e,{type:"TextBlock"},(e=>{Le(e.text,t,n)})),(0,xe.gU)(e,{type:"FactSet"},(e=>{e.facts.forEach((e=>{Le(e.title,t,n),Le(e.value,t,n)}))}))},Le=(e,t,n)=>{const i=e.toLowerCase(),a='itemid="',o=i.indexOf(a),r=o+8;if(o>-1){const a=i.substring(r,r+1);if(t&&a){const i=Oe(a,t,n);i&&(e=e.replace(new RegExp(a,"g"),i))}}},Oe=(e,t,n)=>{let i="";return t.forEach((t=>{if(t.itemId===e){const{messageProperties:e,telemetryDatabag:a}=n;e.mentions||(e.mentions=[]),i=`${e.mentions.length}`;const o=t.displayName||"",r=t.mentionType||"",s=t.userId||"";a["DataBag.atmentions"]=(a["DataBag.atmentions"]||0)+1,e.mentions.push({itemId:i,displayName:o,userId:s,mentionType:r})}})),i};var $e=n(553586);let Ue=class{transform(e,t){if(!e||!t||!t.messageProperties)return;const{loggerFactory:n,coreSettings:i}=t,r=i.get(o.J.Extensibility).enableJITInstallForACv2FromComposeV2||!1,s=n.newLogger("MessageExtensionCardSerializer","services-io-browser-compose-serializer-extensions"),l=(0,a.unescape)(d.N.DomUtils.getAttributeValue(e,$.Qq)),c=d.N.DomUtils.getAttributeValue(e,$.fK);if(!l)return s.error("The props was missing"),null;if(!c)return s.error("The id of the card was missing"),null;try{const n=t.messageProperties.cards||[],{card:i,renderJitInstallConsentFooter:o}=JSON.parse(l);if(!(0,a.isObject)(i))throw new Error("not valid JSON object");(0,a.isString)(i.contentType)&&i.contentType.toLowerCase()===$e.s.Adaptive&&i.content&&((e,t)=>{const n=JSON.parse(e),i=n.body,a=(0,xe.NI)(n);a&&i&&Re(i,a,t)})(i.content,t);const{__typename:s,...u}=i;u.cardClientId=c,t.messageProperties.cards=[...n,u];const m=d.N.DomUtils.getElements({"data-tid":"jit-install-consent-footer"},e);(r?!!o:!(0,a.isEmpty)(m))&&(t.messageProperties.appIdsToInstall=(0,a.union)(t.messageProperties.appIdsToInstall,[i.appId]));const p=(0,P.ln)("span",{content:c,itemprop:"cardId"}),g=(0,P.ln)("span",{class:"inline-compose-card",itemid:c,itemscope:"",itemtype:h.T.inputExtension});return d.N.DomUtils.appendChild(g,p),g}catch(e){return s.error("Error while adding message extension card to message",e),null}}};Ue=(0,i.__decorate)([(0,s.wx)({name:"MessageExtension",filter:{[$.$S]:"MessageExtensionCard"}})],Ue);var Be=n(871471);let We=class{constructor(){}transform(e,t){const{loggerFactory:n}=t;if(!e)return;const i=(0,a.unescape)(d.N.DomUtils.getAttributeValue(e,$.Qq));if(!i)return;const o=(0,Be.D)(i);if((0,a.isEmpty)(o))return void n.newLogger("QuotedReplySerializer","services-io-browser-compose-serializer-extensions").error("Json parsing failed: ",i);const{from:r,messageId:s,preview:l,timestamp:c,userName:u}=o;if(!(r&&s&&l&&u))return void n.newLogger("QuotedReplySerializer","services-io-browser-compose-serializer-extensions").error("Json parsing failed: ",i);const m=(0,P.ln)("blockquote",{itemscope:"",itemtype:h.T.reply,itemid:s}),p=(0,P.ln)("strong",{itemprop:"mri",itemid:r}),g=(0,P.rw)((0,a.escape)(u));if(d.N.DomUtils.appendChild(p,g),d.N.DomUtils.appendChild(m,p),c){const e=(0,P.ln)("span",{itemprop:"time",itemid:c.toString()});d.N.DomUtils.appendChild(m,e)}const y=(0,P.ln)("p",{itemprop:"preview"}),v=(0,P.rw)((0,a.escape)(l));return d.N.DomUtils.appendChild(y,v),d.N.DomUtils.appendChild(m,y),m}};We=(0,i.__decorate)([(0,s.wx)({name:"QuotedReply",filter:{[$.$S]:"QuotedReplyCard"}}),(0,i.__metadata)("design:paramtypes",[])],We);let He=class{transform(e){return(0,a.isEmpty)(e.children)&&d.N.DomUtils.appendChild(e,(0,P.rw)("Â ")),e}};He=(0,i.__decorate)([(0,s.wx)({name:"TableCellSerializer",filter:"td",transient:!0})],He);let Ve=class{transform(e){return e.attribs.class="copy-paste-table",e.attribs.itemprop="copy-paste-table",e}};Ve=(0,i.__decorate)([(0,s.wx)({name:"TableSerializer",filter:"table",transient:!0})],Ve);var Ge=n(993737),ze=n(611741);let qe=class{transform(e,{authenticationUser:t,convId:n}){if(!e||!d.N.DomUtils.hasAttrib(e,u.zj.itemid))return;const i=(0,P.ln)(D.eK.span),a=(0,P.rw)((0,P.Q)(e));d.N.DomUtils.appendChild(i,a);const o=d.N.DomUtils.getAttributeValue(e,u.zj.itemid)||"",r=t?(0,Ge.I6)({userAadObjectId:t.profile.objectId,tenantAadObjectId:t.profile.tenantId}):void 0;return r?.logEvent(ze.z.ManualTagSend,{topicId:o,isTopicNameNumeric:!isNaN(parseFloat(this._getTopicName(e))),contextId:n}),i.attribs[u.zj.itemtype]=h.T.topic,i.attribs[u.zj.itemid]=o,i}_getTopicName(e){const t=(0,P.Q)(e);return t.startsWith("#")?t.substring(1):t}};qe=(0,i.__decorate)([(0,s.wx)({name:"TopicSerializer",filter:"topic"})],qe);var Je=n(689626),Qe=n(140210);let Ke=class{async transform(e,t){const n=t.coreSettings.get(o.J.Extensibility).postSendTimeoutInMs||2e3,{areUrlPreviewsAllowed:i}=t.coreSettings.get(o.J.Messaging);if(!!!i||!t.connectedExperienceEnabled||!e||!t.messageProperties||t.messageProperties.urlPreview||!t.urlPreviewService||!t.appBasedLinkService||!d.N.DomUtils.hasAttrib(e,"href"))return;const a=t.loggerFactory.newLogger("UrlPreviewSerializer","services-io-browser-compose-serializer-extensions"),r=e.attribs.href||"",s=[this.getUrlPreviewFromAppTimed(r,n,t,a),this.getUrlPreviewTimed(r,n,t,a)],[l,c]=await Promise.all(s),u=l||c&&Xe(c);return u?(t.messageProperties.urlPreview=u,e):void 0}async getUrlPreviewFromAppTimed(e,t,n,i){const{enableAppBasedLink:a}=n.coreSettings.get(o.J.Extensibility),{enableGetRichLinkToTeamOrChannel:s}=n.coreSettings.get(o.J.TeamsAndChannels),{deepLinkDomains:c}=n.coreSettings.get(o.J.Messaging);if(!a)return Promise.resolve(void 0);const d={enableDomainLinks:s,currentDomainLinks:c};if((0,Qe.D)(e,d))return;const u=n.scenarioFactory.newScenario(r.RG.ExtGetAppPreviewPostSend),m=n.getInstalledMessageExtensionApps(),p="post send app preview timed out";try{const i=await(0,l.E)(n.appBasedLinkService.getUrlPreviewFromApp(e,m,n.getAppDefinitions,u,n.convId),t,p);return u.stop(),i}catch(t){return Ye(t)&&t.code===Je.jK.TimedOut&&t.context===Je.w5.Timed?u.incomplete({errors:p}):u.fail(),void i.warn(`fetching app preview for url: ${e} failed with error: ${t}`)}}async getUrlPreviewTimed(e,t,n,i){const{enableGetRichLinkToTeamOrChannel:a}=n.coreSettings.get(o.J.TeamsAndChannels),{deepLinkDomains:r}=n.coreSettings.get(o.J.Messaging),s={enableDomainLinks:a,currentDomainLinks:r};if(!(0,Qe.D)(e,s))try{return await(0,l.E)(n.urlPreviewService.getPreview(e),t,"url preview timed out")}catch(t){return void i.warn(`fetching url preview for url: ${e} failed with error: ${t}`)}}};Ke=(0,i.__decorate)([(0,s.HR)({name:"URLPreviewSerializer",filter:"a",transient:!0})],Ke);const Ye=e=>!!(e&&((0,a.get)(e,"code")&&(0,a.get)(e,"context")||(0,a.get)(e,"reason"))),Xe=e=>({url:e.url,title:e.title,description:e.description,previewEnabled:!0,thumbnail:e.thumbnail,thumbnailMeta:e.thumbnail_meta}),Ze=[R],et=[U,O,ae.D,R,Q,qe,He,Ve,re,se.p,H,G,ue,le,Ue,We],tt=[Ce,z.O,Me,Ke,f,De],nt=[L]},16953:(e,t,n)=>{"use strict";n.d(t,{HT:()=>i,Lo:()=>a,Oz:()=>o,Fu:()=>r,GO:()=>s});const i={FailedToFetchRelatedContacts:"FailedToFetchRelatedContacts",BadRequest:"BadRequest",InvalidBackendResponse:"InvalidBackendResponse",InvalidCallerOrGroup:"InvalidCallerOrGroup",InvalidUserOrGroup:"InvalidUserOrGroup",Unknown:"Unknown"},a={Active:"Active",Inactive:"Inactive"};var o,r,s;!function(e){e.FailedToFetchRelatedContacts="FailedToFetchRelatedContacts",e.BadRequest="BadRequest",e.InvalidBackendResponse="InvalidBackendResponse",e.CallerIsNotGroupOwner="CallerIsNotGroupOwner",e.Unknown="Unknown"}(o||(o={})),function(e){e.AccessDenied="AccessDenied",e.BadRequest="BadRequest",e.InvalidArgument="InvalidArgument",e.InvalidBackendResponse="InvalidBackendResponse",e.UserProfileNotFound="UserProfileNotFound",e.Unknown="Unknown"}(r||(r={})),function(e){e.Success="Success",e.Pending="Pending",e.IngestionFailed="IngestionFailed"}(s||(s={}))},768896:(e,t,n)=>{"use strict";n.d(t,{q8:()=>c,dR:()=>d,Zl:()=>u});var i=n(191366),a=n(702135),o=n(689626),r=n(543491);const s="Browser does not support IndexedDB APIs",l="Error in indexedDB open request";async function c(e,t,n,c,d,u){let p;const g=(0,i.J)().indexedDB,h=new Promise(((i,h)=>{const y=d.newScenario(r.RG.IndexedDBFetch);y.appendEventData({dataSource:n});try{g||h((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,s)),p=g.open(e,t),p.onerror=()=>{h((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,l))},p.onupgradeneeded=e=>{m(t,n,c,p,e,i,h,y)},p.onsuccess=function(e,t,n,i,r,s,l){return()=>{try{const c=e.result,d=c.transaction([t]).objectStore(t),u=l?d.getAll():d.get(n);u.onsuccess=e=>{c.close(),i.stop();const t=e.target.result;r(l?t:t&&(t.value||u.result))},u.onerror=()=>{c.close(),i.fail(),s((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,"Error trying to get chat service sync end point from indexedDB"))}}catch(e){i.fail(),s((0,a.Tr)(o.w5.IndexDb,o.jK.IndexDbException,`Failed to read from '${t}' object store on the indexedDB.`))}}}(p,n,c,y,i,h,u)}catch(e){y.fail({errors:e.message}),h(e)}}));return h}async function d(e,t,n,a,o){{let l;const c=(0,i.J)().indexedDB;return new Promise(((i,d)=>{const u=o.newScenario(r.RG.IndexedDBDelete);u.appendEventData({dataSource:n});try{c||d(new Error(s)),l=c.open(e,t),l.onerror=()=>{d(new Error(s)),u.fail({errors:s})},l.onsuccess=()=>{!function(e,t,n,i,a){try{const o=e.result,r=o.transaction([t],"readwrite"),s=r.objectStore(t).clear();s.onsuccess=e=>{o.close(),n.stop(),i(e.target.result)},s.onerror=e=>{o.close(),n.fail(),a(`Error trying to delete data from indexedDB: ${e}`)}}catch(e){n.fail(),a(`Error trying to delete data from indexedDB: ${e}`)}}(l,n,u,i,d)},l.onupgradeneeded=e=>{m(t,n,a,l,e,i,d,u)}}catch(e){u.fail({errors:e.message}),d(e)}}))}}async function u(e,t,n,a,o,l){let c;const d=(0,i.J)().indexedDB,u=new Promise(((i,u)=>{const p=l.newScenario(r.RG.IndexedDBWrite);p.appendEventData({dataSource:n});try{d||u(new Error(s)),c=d.open(e,t),c.onerror=()=>{u(new Error(s)),p.fail({errors:s})},c.onsuccess=()=>{!function(e,t,n,i,a,o){try{const r=e.result,s=r.transaction([t],"readwrite").objectStore(t);let l;n.forEach((e=>{l=s.put(e),l.onsuccess=e=>{r.close(),i.stop(),a(e.target.result.value)},l.onerror=e=>{r.close(),i.fail(),o(`Error trying to write into indexedDB: ${e}`)}}))}catch(e){i.fail(),o(`Error trying to write into indexedDB: ${e}`)}}(c,n,o,p,i,u)},c.onupgradeneeded=e=>{m(t,n,a,c,e,i,u,p)}}catch(e){p.fail({errors:e.message}),u(e)}}));return u}function m(e,t,n,i,a,o,s,l){try{a.oldVersion<e&&i.result.createObjectStore(t,{keyPath:n}),l.mark(r.ck.IndexedDBUpgrade),o()}catch(e){l.fail(),s(`Failed to create object stores on the indexedDB: ${e}`)}}},87970:(e,t,n)=>{"use strict";n.d(t,{T:()=>a});var i=n(839779);class a{constructor(){this._executeCommandSubject=new i.X(void 0),this.executeCommand=(e,t)=>{this._executeCommandSubject.next({windowId:e,commandId:t})}}get executeCommandObservable(){return this._executeCommandSubject.asObservable()}}},701595:(e,t,n)=>{"use strict";n.d(t,{N:()=>o});var i=n(683184),a=n(876934);class o{constructor(e,t,n,i){this.logsCollectorService=t,this.coreSettings=n,this.hostCommunicationService=i,this.defaultLogsFilesDownloadDelayIntervalMs=333,this.defaultLogsFileUploadTimer=15e3,this.logger=e.newLogger("LogsFilesService","services-io-browser-logs-files")}async downloadLogsFiles(e,t=!0,n){this.logsCollectorService.setDownloadLogStatus(!0);let a=!0,o=this.defaultLogsFilesDownloadDelayIntervalMs;if(this.coreSettings){const e=this.coreSettings.get(i.J.Diagnostics);a=e.enableLogsFilesDownload||!1,o=e.logsFilesDownloadDelayIntervalMs||this.defaultLogsFilesDownloadDelayIntervalMs}if(!a)return this.logger.error(`Unabled to download logs files - logs files download is not enabled: ${a}`),!1;if(!e)return this.logger.error(`Unabled to download logs files - no host present: ${e}`),!1;const r=this.hostCommunicationService&&n;let s=0;const l=await this.logsCollectorService.callOnLogsFiles((async t=>{let i;const a=new Promise((a=>{i=e.setTimeout((async()=>{const i=r?await this.uploadLogsFileToVirtualServer(t,e,n,!1):await this.downloadLogsFile(t,e);a(i)}),s*o)})).then((t=>(void 0!==i&&e.clearTimeout(i),t)));return s++,a}),t);if(l){if(r){const e=await(this.hostCommunicationService?.loadModule("logscollection"));e?.webLogsDownloadCompleted?.({webLogsId:n})}}else{if(r)return this.logger.errorToTelemetry?.("Failed to upload all logs files to virtual server","logs_downloading"),this.downloadLogsFiles(e,!0);this.logger.error("Failed to download all logs files")}return this.logsCollectorService.setDownloadLogStatus(!1),l}downloadLogsFile(e,t){let n,i="";try{let a;a="string"==typeof e.content?new Blob([e?.content],{type:"text/plain;charset=utf-8"}):e.content,i=URL.createObjectURL(a);const o=t.document.createElement("a");o.setAttribute("href",i),o.setAttribute("download",e?.fileName),o.click(),o.remove(),n=!0}catch(t){this.logger.error(`Failed to download logs file ${e?.fileName} - error:`,t),n=!1}return i&&URL.revokeObjectURL&&URL.revokeObjectURL(i),Promise.resolve(n)}async uploadLogsFileToVirtualServer(e,t,n,i){let o=!1;try{const r=`${t.location.origin}/desktop/upload/log-collector/${n}/${e.fileName}`,s=t.fetch(r,{method:"PUT",headers:{"Content-Type":"text/plain"},body:e.content}),l=await(0,a.E)(s,this.defaultLogsFileUploadTimer);l.ok?o=!0:this.logger.error(`Failed to upload logs file to virtual server - ${e?.fileName}, isRetry - ${i}, status - ${l.statusText}`)}catch(t){this.logger.error(`Failed to upload logs file to virtual server - ${e?.fileName}, - isRetry- ${i}, - in ${this.defaultLogsFileUploadTimer} ms, - error:`,t)}return o||i?Promise.resolve(o):this.uploadLogsFileToVirtualServer(e,t,n,!0)}}},625540:(e,t,n)=>{"use strict";n.d(t,{XD:()=>a,jW:()=>o,Ko:()=>r,F$:()=>s,OB:()=>l,bF:()=>c});var i=n(827571);const a=async e=>{const{data:t}=await e.query({query:i.i8});return t?.activeWindows},o=async e=>{const t=await a(e);return t?.find((e=>e.isMainWindow&&"standard"===e.layoutConfig.layoutMode))},r=async e=>{const t=await a(e);return t?.filter((e=>e.isMainWindow))},s=e=>{try{const t=e.readQuery({query:i.i8});return t?.activeWindows}catch{return}},l=e=>e.watchQuery({query:i.i8}),c=(e,t)=>{try{return e.writeQuery({query:i.i8,data:{activeWindows:t}}),!0}catch{return!1}}},956898:(e,t,n)=>{"use strict";n.d(t,{E:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataActiveWindowsSaveReactiveVarsToHistoryMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"windowId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appIds"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"saveReactiveVarsToHistory"},arguments:[{kind:"Argument",name:{kind:"Name",value:"windowId"},value:{kind:"Variable",name:{kind:"Name",value:"windowId"}}},{kind:"Argument",name:{kind:"Name",value:"appIds"},value:{kind:"Variable",name:{kind:"Name",value:"appIds"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},827571:(e,t,n)=>{"use strict";n.d(t,{i8:()=>c});const i={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowOptions"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"left"}},{kind:"Field",name:{kind:"Name",value:"top"}},{kind:"Field",name:{kind:"Name",value:"width"}},{kind:"Field",name:{kind:"Name",value:"height"}}]}}]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Entity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"action"}},{kind:"Field",name:{kind:"Name",value:"options"}},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowOptions"}}]}},{kind:"Field",name:{kind:"Name",value:"linkedEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_linkedEntity"}}]}},{kind:"Field",name:{kind:"Name",value:"entityState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"flushableByLinkedEntity"}}]}}]}},...i.definitions,...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_linkedEntity"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"LinkedEntity"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"action"}}]}}]}.definitions]},o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_window"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Window"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"source"}},{kind:"Field",name:{kind:"Name",value:"clientLaunchId"}}]}},{kind:"Field",name:{kind:"Name",value:"extendedEntityContainerState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"containerState"}},{kind:"Field",name:{kind:"Name",value:"isExternal"}}]}},{kind:"Field",name:{kind:"Name",value:"blockingEntityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"blockedEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"blockedCommand"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"visibilityState"}},{kind:"Field",name:{kind:"Name",value:"stateTransition"}},{kind:"Field",name:{kind:"Name",value:"correlation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"startTimestamp"}},{kind:"Field",name:{kind:"Name",value:"source"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"blockedEntityOptions"}}]}},{kind:"Field",name:{kind:"Name",value:"isMainWindow"}},{kind:"Field",name:{kind:"Name",value:"isNotificationsWindow"}},{kind:"Field",name:{kind:"Name",value:"isInitialWindowStateHidden"}},{kind:"Field",name:{kind:"Name",value:"userContextId"}},{kind:"Field",name:{kind:"Name",value:"layoutConfig"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"layoutMode"}},{kind:"Field",name:{kind:"Name",value:"isFullscreen"}},{kind:"Field",name:{kind:"Name",value:"slots"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contextualNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"header"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"end"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"main"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"monitor"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"nav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"notifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"inAppNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"start"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"midNav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"subNav"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"titleBar"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}},{kind:"Field",name:{kind:"Name",value:"toasts"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"}},{kind:"Field",name:{kind:"Name",value:"isHidden"}},{kind:"Field",name:{kind:"Name",value:"width"}}]}}]}}]}}]}},...a.definitions]},r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeEntities"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActiveEntities"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"midNavEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"subNavEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"headerEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"startEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"mainEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"endEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"entityExtension"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"monitorEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}},{kind:"Field",name:{kind:"Name",value:"inAppNotificationsEntity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}}]}},...a.definitions]},s={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryItem"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryItem"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeEntities"}}]}},{kind:"Field",name:{kind:"Name",value:"reactiveVars"}}]}},...r.definitions]},l={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationState"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Window"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"windowHistoryNavigationState"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"canNavigateBack"}},{kind:"Field",name:{kind:"Name",value:"canNavigateForward"}},{kind:"Field",name:{kind:"Name",value:"backHistory"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationItem"}}]}},{kind:"Field",name:{kind:"Name",value:"forwardHistory"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationItem"}}]}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationItem"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"WindowHistoryNavigationItem"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"windowHistoryIndex"}},{kind:"Field",name:{kind:"Name",value:"entity"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_entity"}}]}}]}},...a.definitions]}.definitions]},c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataActiveWindowsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activeWindows"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeWindows"}}]}}]}},...{kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeWindows"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Window"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"windowOptions"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowOptions"}}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_window"}},{kind:"Field",name:{kind:"Name",value:"activeEntities"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_activeEntities"}}]}},{kind:"Field",name:{kind:"Name",value:"windowHistory"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryItem"}}]}},{kind:"Field",name:{kind:"Name",value:"currentWindowHistoryIndex"}},{kind:"FragmentSpread",name:{kind:"Name",value:"ServicesIoDataActiveWindowsFragment_windowHistoryNavigationState"}}]}},...i.definitions,...o.definitions,...r.definitions,...s.definitions,...l.definitions]}.definitions]}},474934:(e,t,n)=>{"use strict";n.d(t,{x:()=>w});var i,a=n(803238);!function(e){e.Info="Info",e.Warning="Warning",e.Error="Error",e.Debug="Debug"}(i||(i={}));var o=n(686219),r=n(323356),s=n(683184),l=n(882066);const c={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationUserQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"defaultName"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"user"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"isMailAddress"},value:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}}},{kind:"Argument",name:{kind:"Name",value:"defaultName"},value:{kind:"Variable",name:{kind:"Name",value:"defaultName"}}},{kind:"Argument",name:{kind:"Name",value:"callerInfo"},value:{kind:"Variable",name:{kind:"Name",value:"callerInfo"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"featureSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"coExistenceMode"}}]}}]}}]}}]},d={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationGetUsersQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mriOrEmailArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"getUsers"},arguments:[{kind:"Argument",name:{kind:"Name",value:"mriOrEmailArray"},value:{kind:"Variable",name:{kind:"Name",value:"mriOrEmailArray"}}},{kind:"Argument",name:{kind:"Name",value:"isMailAddress"},value:{kind:"Variable",name:{kind:"Name",value:"isMailAddress"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"email"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"userPrincipalName"}},{kind:"Field",name:{kind:"Name",value:"emailForQuery"}}]}}]}}]},u={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationPresenceSubscription"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"source"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PresenceSource"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presenceUpdateEvent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}},{kind:"Argument",name:{kind:"Name",value:"source"},value:{kind:"Variable",name:{kind:"Name",value:"source"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"isOutOfOffice"}},{kind:"Field",name:{kind:"Name",value:"lastSeenAt"}}]}}]}}]},m={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationPresencesQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userPresenceRequestArray"}},type:{kind:"NonNullType",type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"UserPresenceRequest"}}}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"presences"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userPresenceRequestArray"},value:{kind:"Variable",name:{kind:"Name",value:"userPresenceRequestArray"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"availability"}},{kind:"Field",name:{kind:"Name",value:"activity"}},{kind:"Field",name:{kind:"Name",value:"isOutOfOffice"}},{kind:"Field",name:{kind:"Name",value:"lastSeenAt"}}]}}]}}]},p={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationFireCallingIntentMutation"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CallingIntentInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fireCallingIntent"},arguments:[{kind:"Argument",name:{kind:"Name",value:"callingIntent"},value:{kind:"Variable",name:{kind:"Name",value:"callingIntent"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]},g={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationUserCallingSettingsQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userCallingSettings"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"isCallingAllowed"}},{kind:"Field",name:{kind:"Name",value:"isPstnCallingAllowed"}}]}}]}}]},h={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationIsPstnQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"uri"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"officeIntegrationIsPSTN"},arguments:[{kind:"Argument",name:{kind:"Name",value:"uri"},value:{kind:"Variable",name:{kind:"Name",value:"uri"}}}]}]}}]},y={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"ServicesIoDataOfficeIntegrationTenantVerifiedDomainQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"tenantVerifiedDomain"},arguments:[{kind:"Argument",name:{kind:"Name",value:"userId"},value:{kind:"Variable",name:{kind:"Name",value:"userId"}}}]}]}}]};var v,f,S=n(852793),k=n(832579);!function(e){e[e.UnInitialized=0]="UnInitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"}(v||(v={})),function(e){e.FreDialogDisplayedKey="office-integration-fre-dialog-displayed",e.HasManuallyUnregisteredIMProviderKey="office-integration-has-manually-unregistered"}(f||(f={}));const C="sip:",b=new Map([["InACall","OnThePhone"],["InAConferenceCall","InAMeeting"],["InAMeeting","InAMeeting"],["Presenting","Presenting"],["OffWork","Offline"],["Available","Online"],["Inactive","Idle"],["Busy","Busy"],["DoNotDisturb","Focusing"],["BeRightBack","BeRightBack"],["Away","Away"],["Offline","Offline"],["UrgentInterruptionsOnly","Focusing"],["PresenceUnknown","Unknown"],["OutOfOffice","OutOfOffice"]]);class w{static Instance(e,t,n,i,a,o,r,s){return w.instance||(w.instance=new w(e,t,n,i,a,o,r,s)),w.instance}static defaultInstance(){return w.instance}constructor(e,t,n,i,l,c,d,u){this.hostCommunicationService=e,this.coreSettings=t,this.client=n,this.entityCommanding=l,this.windowProvider=c,this.localStorage=d,this.authenticationUser=u,this.initializedState=v.UnInitialized,this.unsubscribers=[],this.entityCommand={stateTransition:o.su.none,visibilityState:o.fe.show,correlation:{source:r.D.OfficeIntegration}},this.presenceSubscriptionMap=new Map,this.uriToMriCacheMap=new Map,this.selfMri="",this.selfActivity="PresenceUnknown",this.debouncedUnresolvedUriMap=new Map,this.unknownUserSet=new Set,this.verifiedDomains=[],this.getUserCallingSettingsAsync=async()=>{const{data:e}=await this.client.query({query:g,variables:{}});return e.userCallingSettings},this.getIsPstnAsync=async e=>{const{data:t}=await this.client.query({query:h,variables:{uri:e}});return t.officeIntegrationIsPSTN},this.logger=i.newLogger("OfficeIntegration","services-io-data-office-integration");const m=this.coreSettings.get(s.J.People).debounceUriToMriProfileQueryInMilliSeconds||1e3;this.batchProfileQuery=(0,a.debounce)((async()=>{if(!(0,a.isEmpty)(this.debouncedUnresolvedUriMap)){const e=this.debouncedUnresolvedUriMap;this.debouncedUnresolvedUriMap=new Map,await this.resolveUrisToMrisFromServiceIntoCache(Array.from(e.values()));const t=Array.from(e.keys()),n=this.resolveUrisToMrisFromCache(t),i=t.filter((e=>n.has(e)));(0,a.isEmpty)(i)||this.handleTrackPresence(i)}}),m);const p=this.coreSettings.get(s.J.Presence).officeIntegrationPresenceSubscriptionExpiryMs||18e4;this.removeStaleSubscriptions=(0,a.debounce)((()=>{const e=Date.now(),t=this.presenceSubscriptionMap.size;this.presenceSubscriptionMap.forEach(((t,n)=>{t.lastPollingTime+p<e&&(t.presenceSubscription.unsubscribe(),this.presenceSubscriptionMap.delete(n))})),this.logger.log(`removeStaleSubscriptions size from ${t} to ${this.presenceSubscriptionMap.size}`)}),p)}async initialize(){if(!this.coreSettings.get(s.J.People).enableOfficeIntegration)return!1;if(this.coreSettings.get(s.J.Presence).enableCheckCoExistenceModeForOfficeIntegration){const e=this.authenticationUser?.loginUserName||"",{data:t}=await this.client.query({query:c,variables:{userId:e,isMailAddress:!0},context:{callerInfo:"office-integration-initialize"}}),n=t?.user?.featureSettings?.coExistenceMode;if(this.logger.log(`initialize coExistenceMode ${n}`),n&&n!==k.hN.TeamsOnly)return!1}if(this.initializedState!==v.UnInitialized)return!1;this.initializedState=v.Initializing;const e=await this.getModule();if(e){const{isRegistered:t,isAdminAccessRequired:n,isUacEnabled:a}=await(e.isRegisteredIMProvider?.())||{};if(this.logger.log(`initialize isRegistered ${t} isAdminAccessRequired ${n} isUacEnabled ${a}`),t)return this.startService(e);if(n&&a)this.startOfficeIntegrationFREDialog();else if(n||this.isLocalStoragePropertySet(f.HasManuallyUnregisteredIMProviderKey)){const e=`Failed to register due to isAdminAccessRequired ${n} isUacEnabled \n          ${a} HasManuallyUnregisteredIMProviderKey ${this.isLocalStoragePropertySet(f.HasManuallyUnregisteredIMProviderKey)}`;this.handleLogToTelemetry(e,"office_integration_register_im_provider",i.Warning)}else{const{disableT21AsDefaultIMProvider:t}=this.coreSettings.get(s.J.Presence),n=t?await(e.registerIMProviderV2?.(!1,!!a,!1)):await(e.registerIMProvider?.(!1,!!a));if(0===n)return this.startService(e);{const e=`Failed to register during silent registration with result ${n}`;this.handleLogToTelemetry(e,"office_integration_register_im_provider",i.Warning,{errorCode:n?.toString(16)})}}return!1}return!1}async finalize(){if(!this.coreSettings.get(s.J.People).enableOfficeIntegration)return!1;if(this.initializedState!==v.Initializing)return!1;const e=await this.getModule();if(e){const{isRegistered:t}=await(e.isRegisteredIMProvider?.())||{};if(t)return this.startService(e);const n="finalize is called without IM provider registered";return this.handleLogToTelemetry(n,"office_integration_fre_register_finalize_failed",i.Warning),!1}return!1}async shutdown(){if(this.initializedState!==v.Initialized)return!1;this.initializedState=v.UnInitialized,this.unsubscribers.forEach((e=>e()));const e=await this.getModule();if(e){const t=e.stopComServer?.();return!!t}return!1}async isRegisteredIMProvider(){const e=await this.getModule();return e?.isRegisteredIMProvider?.()}async registerIMProvider(e,t,n,a){const o=await this.getModule(),{disableT21AsDefaultIMProvider:r}=this.coreSettings.get(s.J.Presence);if(o){const s=r?await(o.registerIMProviderV2?.(e,t,n)):await(o.registerIMProvider?.(e,t)),l=`registerIMProvider result ${s} from ${a}. isAdminAccessRequired ${e} isUacEnabled ${t}`;return this.handleLogToTelemetry(l,"office_integration_register_im_provider",i.Info,{errorCode:s?.toString(16)}),0===s}return!1}async unregisterIMProvider(e){const t=await this.getModule();if(t){const n=await(t.unregisterIMProvider?.()),a=`unregisterIMProvider result ${n} from ${e}`;return this.handleLogToTelemetry(a,"office_integration_unregister_im_provider",i.Info,{errorCode:n?.toString(16)}),0===n}return!1}async toggleIMProvider(e){const{isRegistered:t,isAdminAccessRequired:n,isUacEnabled:i}=await this.isRegisteredIMProvider()||{};if(t){this.setLocalStorageProperty(f.HasManuallyUnregisteredIMProviderKey,"true");const t=await this.unregisterIMProvider(e);return await this.waitForRegistryUpdate(),t}this.setLocalStorageProperty(f.HasManuallyUnregisteredIMProviderKey,"false");if(await this.registerIMProvider(!!n,!!i,!0,e)){const e=await this.getModule();return!!e&&(this.startService(e),await this.waitForRegistryUpdate(),!0)}return!1}async waitForRegistryUpdate(){let e;await new Promise((t=>{e=this.windowProvider.setTimeout(t,250)})),this.windowProvider.clearTimeout(e)}isLocalStoragePropertySet(e){return"true"===this.localStorage?.get(e)}setLocalStorageProperty(e,t){this.localStorage?.set(e,t,"Platform")}async getModule(){return this.officeIntegrationModule||(this.officeIntegrationModule=await this.hostCommunicationService.loadModule("officeintegration")),this.officeIntegrationModule}async startService(e){if(this.initializedState===v.Initialized)return!1;let t;this.initializedState=v.Initialized,t=e.registerForStartChat?.((e=>this.handleStartChat(e))),t&&this.unsubscribers.push(t),t=e.registerForStartCall?.(((e,t,n)=>this.handleStartCall(e,t,n))),t&&this.unsubscribers.push(t),t=e.registerForTrackPresence?.((e=>this.handleTrackPresence(e))),t&&this.unsubscribers.push(t),t=e.registerForUntrackPresence?.((e=>this.handleUntrackPresence(e))),t&&this.unsubscribers.push(t),t=e.registerForLogStatement?.(((e,t)=>this.handleLogStatement(e,t))),t&&this.unsubscribers.push(t);const n=this.authenticationUser?.loginUserName||"",{data:i}=await this.client.query({query:c,variables:{userId:n,isMailAddress:!0},context:{callerInfo:"office-integration-start"}}),a=i?.user;if(a){const e=a.userPrincipalName?.toLowerCase(),t=a.email?.toLowerCase();a.mri&&(this.selfMri=a.mri,e&&this.uriToMriCacheMap.set(e,a.mri),t&&t!==e&&this.uriToMriCacheMap.set(t,a.mri))}const o=await this.client.query({query:y,variables:{userId:n}});o.data?.tenantVerifiedDomain&&(this.verifiedDomains=o.data.tenantVerifiedDomain);return!!await(e.startComServer?.(a?.userPrincipalName||n))}startOfficeIntegrationFREDialog(){if(this.isLocalStoragePropertySet(f.FreDialogDisplayedKey))this.logger.log("Skipping FRE as it has already been displayed for user");else{this.entityCommanding.shell.openFreDialog(this.entityCommand),this.setLocalStorageProperty(f.FreDialogDisplayedKey,"true");const e="Start office integration FRE through user dialog registration";this.handleLogToTelemetry(e,"office_integration_fre_register_dialog",i.Info)}}async notifyPresence(e){const t=await this.getModule();return t?.notifyPresence?.(e)}convertLastSeenAt(e){if(e){return new Date(e).getTime()}}notifyInitialPresence(e,t){const n=[];e.presences.forEach((e=>{const i=(0,S.j)()("InACall","InAConferenceCall","InAMeeting","Presenting","OffWork","Available","Inactive","Busy","DoNotDisturb","BeRightBack","Away","Offline","UrgentInterruptionsOnly","PresenceUnknown","OutOfOffice").find((t=>t===e.activity))||"PresenceUnknown";e.id===this.selfMri&&e.activity&&(this.selfActivity=e.activity),n.push({id:e.id,requestedUri:t.get(e.id)||"",status:b.get(i)||i,lastSeenAt:this.convertLastSeenAt(e.lastSeenAt)})})),this.notifyPresence(n)}async handleTrackPresence(e){const{enableFederatedPresenceForOfficeIntegration:t}=this.coreSettings.get(s.J.People),{disableRealTimePresenceForOfficeIntegration:n,presenceForOfficeIntegrationPollingIntervalMs:i}=this.coreSettings.get(s.J.Presence);t||(0,a.isEmpty)(this.verifiedDomains)||(e=e.filter((e=>{const t=e.substring(e.indexOf("@")+1);return(0,a.some)(this.verifiedDomains,(e=>e===t.toLocaleLowerCase()))})));const o=await this.mapUrisToMris(e,!0),r=[],l=new Map,c=i||12e4,d=Date.now();if(e.forEach((e=>{const t=o.get(e);if(t){const i=this.presenceSubscriptionMap.get(t);if(i){const a=i.lastPollingTime+c<d;i.lastPollingTime=d,(n&&a||!i.requestedUris.has(e)||t===this.selfMri&&"PresenceUnknown"===this.selfActivity)&&(i.requestedUris.add(e),r.push({userId:t,source:"ups"}),l.set(t,e))}else{const i=n?"local":"ups",a=this.client.subscribe({query:u,variables:{userId:t,source:i},context:{callerInfo:"office-integration"}}).subscribe((({data:e})=>{e&&this.notifyUpdatedPresence(e)})),o={requestedUris:new Set,presenceSubscription:a,lastPollingTime:d};o.requestedUris.add(e),this.presenceSubscriptionMap.set(t,o),r.push({userId:t,source:"ups"}),l.set(t,e)}}})),n&&this.removeStaleSubscriptions(),!(0,a.isEmpty)(r)){const{data:e}=await this.client.query({query:m,variables:{userPresenceRequestArray:r},context:{callerInfo:"office-integration"}});e&&this.notifyInitialPresence(e,l)}}async mapUrisToMris(e,t){const n=this.resolveUrisToMrisFromCache(e);if(n.size===e.length)return n;{const{enableDebounceUriToMriProfileQuery:i}=this.coreSettings.get(s.J.People),o=t&&i,r=[];return e.forEach((e=>{if(!n.has(e)){const t=e.startsWith(C)?e.substring(4):e;r.push(t),o&&this.debouncedUnresolvedUriMap.set(e,t)}})),(0,a.isEmpty)(r)?n:o?(this.batchProfileQuery(),n):(await this.resolveUrisToMrisFromServiceIntoCache(r),this.resolveUrisToMrisFromCache(e))}}async resolveUrisToMrisFromServiceIntoCache(e){if(e=e.filter((e=>!this.unknownUserSet.has(e.toLowerCase()))),(0,a.isEmpty)(e))return;const{data:t}=await this.client.query({query:d,variables:{mriOrEmailArray:e,isMailAddress:!0},context:{callerInfo:"office-integration-uri-resolution"}});t?.getUsers?.forEach((e=>{if(e.mri&&"unknown_email_address@invalid.teams.ms"!==e.email){const t=e.userPrincipalName?.toLowerCase(),n=e.email?.toLowerCase(),i=e.emailForQuery?.toLowerCase();t&&this.uriToMriCacheMap.set(t,e.mri),n&&n!==t&&this.uriToMriCacheMap.set(n,e.mri),i&&i!==t&&i!==n&&this.uriToMriCacheMap.set(i,e.mri)}else e.userPrincipalName&&this.unknownUserSet.add(e.userPrincipalName.toLowerCase())}))}resolveUrisToMrisFromCache(e){const t=new Map;return e.forEach((e=>{const n=e.toLowerCase(),i=n.startsWith(C)?n.substring(4):n,a=this.uriToMriCacheMap.get(i);a&&t.set(e,a)})),t}notifyUpdatedPresence(e){const t=e.presenceUpdateEvent;if(t){const e=t.id,n=this.presenceSubscriptionMap.get(e);if(n){const i=[],a=(0,S.j)()("InACall","InAConferenceCall","InAMeeting","Presenting","OffWork","Available","Inactive","Busy","DoNotDisturb","BeRightBack","Away","Offline","UrgentInterruptionsOnly","PresenceUnknown","OutOfOffice").find((e=>e===t.activity))||"PresenceUnknown",o=b.get(a)||a,r=this.convertLastSeenAt(t.lastSeenAt);n.requestedUris.forEach((t=>{i.push({id:e,requestedUri:t,status:o,lastSeenAt:r})})),e===this.selfMri&&t.activity&&(this.selfActivity=t.activity),this.notifyPresence(i)}}}async handleUntrackPresence(e){(await this.mapUrisToMris(e)).forEach(((e,t)=>{const n=this.presenceSubscriptionMap.get(e);n&&(n.requestedUris.delete(t),(0,a.isEmpty)(n.requestedUris)&&(n.presenceSubscription.unsubscribe(),this.presenceSubscriptionMap.delete(e)))}))}async handleStartChat(e){this.logger.log("Starting chat");const t=e.split(";").filter((e=>!!e.trim())),n=await this.mapUrisToMris(t),o=`mapped ${n.size} uris`;this.handleLogToTelemetry(o,"office_integration_handle_chat",i.Info);const r=Array.from(n.values());(0,a.isEmpty)(r)?this.handleLogToTelemetry("No mapped uris to start chat","office_integration_handle_chat",i.Warning):this.navigateToChat(r)}async navigateToChat(e,t=o.su.new){return this.entityCommanding.chat.chatWithUsers({userIds:e,entityCommand:{stateTransition:t,visibilityState:o.fe.show,correlation:{source:r.D.OfficeIntegrationChat}},entityOptions:{shouldCheckChatPolicy:!0}})}async handleStartCall(e,t,n){const{enableOfficeIntegrationCalling:a}=this.coreSettings.get(s.J.Calling);try{const[n,o]=await Promise.all([this.getUserCallingSettingsAsync(),this.getIsPstnAsync(e)]);if(!a||o&&!n?.isPstnCallingAllowed||!o&&!n?.isCallingAllowed)return void this.handleLogToTelemetry("Office integration calling or policy is disabled","office_integration_handle_call",i.Warning,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isPSTN:o,isVideo:t,isCallingAllowed:n?.isCallingAllowed,isPstnCallingAllowed:n?.isPstnCallingAllowed})});this.handleLogToTelemetry("Starting call","office_integration_handle_call",i.Info,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isPSTN:o,isVideo:t})});const r=o?this.getPstnCallingIntent(e):await this.getVoipCallingIntentAndNavigateChat(e,t);await this.client.mutate({mutation:p,variables:{callingIntent:r}}),this.handleLogToTelemetry("Successfully triggered call","office_integration_handle_call",i.Info,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isVideo:t})})}catch(e){this.handleLogToTelemetry("Failed to start call","office_integration_handle_call",i.Error,{context:JSON.stringify({enableOfficeIntegrationCalling:a,isVideo:t}),errors:e?.message||e})}}getPstnCallingIntent(e){return{type:"OneToOneCall",joinOptions:{},coordinates:{oneToOne:{mri:(0,l.DI)(e)}}}}async getVoipCallingIntentAndNavigateChat(e,t){const n=(await this.mapUrisToMris([e])).get(e);if(!n)throw new Error("No mapped uri to start call");return await this.navigateToChat([n],o.su.flush),{type:"OneToOneCall",coordinates:{oneToOne:{mri:n}},joinOptions:{outgoingVideo:t}}}handleLogStatement(e,t){switch(t){case i.Info:this.logger.log(e);break;case i.Debug:this.logger.debug(e);break;case i.Error:this.logger.error(e);break;case i.Warning:this.logger.warn(e)}}handleLogToTelemetry(e,t,n,a,o=!0){switch(n){case i.Info:this.logger.infoToTelemetry?this.logger.infoToTelemetry(e,t,a,o):this.logger.log(e);break;case i.Debug:this.logger.debugToTelemetry?this.logger.debugToTelemetry(e,t,a,o):this.logger.debug(e);break;case i.Error:this.logger.errorToTelemetry?this.logger.errorToTelemetry(e,t,a,o):this.logger.error(e);break;case i.Warning:this.logger.warnToTelemetry?this.logger.warnToTelemetry(e,t,a,o):this.logger.warn(e)}}}},636355:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});const i={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"activityFeed"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filters"}},type:{kind:"NamedType",name:{kind:"Name",value:"ActivityFeedFilterInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"enableAvatarUrlResolutionInActivityFeeds"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"activities"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"filters"},value:{kind:"Variable",name:{kind:"Name",value:"filters"}}},{kind:"Argument",name:{kind:"Name",value:"isFirstPage"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"DataFragmentsCommonActivitiesConnectionFragment"}},{kind:"Field",name:{kind:"Name",value:"activityConsumptionHorizonBookmark"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ActivityConsumptionHorizonBookmark"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"activityTimestamp"}},{kind:"Field",name:{kind:"Name",value:"chatTimestamp"}},{kind:"Field",name:{kind:"Name",value:"channelTimestamp"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"upfrontFilter"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"unreadOnly"}}]}},{kind:"Field",name:{kind:"Name",value:"showNotificationSettingsRecommendationCoachmark"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}]},{kind:"Field",name:{kind:"Name",value:"trackingInfo"},directives:[{kind:"Directive",name:{kind:"Name",value:"include"},arguments:[{kind:"Argument",name:{kind:"Name",value:"if"},value:{kind:"Variable",name:{kind:"Name",value:"isFirstPage"}}}]}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"totalFeedsCountOnBoot"}},{kind:"Field",name:{kind:"Name",value:"unseenCountOnBell"}}]}}]}}]}},...n(963469).f.definitions]}},591518:(e,t,n)=>{"use strict";n.d(t,{c:()=>l});const i=(e,t,n)=>{const{scenarioFactory:i}=e;return n?i.findScenarioByNameAndId(t,n):i.findScenario(t)},a=(e,t)=>{try{return JSON.stringify(t)}catch{return e.warn("exception occured in getFeedDataBagString"),""}},o=(e,t,n)=>{const{scenarioFactory:i,logger:a}=e,{scenarioId:o,data:r,timeoutMs:s}=n||{},l=i.newScenario(t,{timeoutMs:s});return o&&(l.clientId=o),r&&l.appendEventData(r),a.log(`${t} - scenario started with origin: ${r?.origin}`),l},r=(e,t,n,a)=>{const{logger:o}=e,r=i(e,t,n.scenarioId);r?r.cancel({message:a}):o.warn(`${t} with Id: ${n.scenarioId} - not found hence not cancelled`)},s=(e,t,n)=>{const i=((e,t,n)=>{let i=n;const o=t.eventData.feedDataBag;if(o){let t={};try{t=JSON.parse(o)}catch{e.warn("exception occured in prevFeedDataBagStr to object conversion")}i={...t,...i}}return a(e,i)||o})(e,t,n);t.appendEventData({feedDataBag:i})},l={addScenarioDataByNameId:(e,t,n,a)=>{const{logger:o}=e,r=i(e,t,a);r?r.appendEventData(n):o.warn(`No active scenario with ScenarioName: ${t} with Id: ${a}`)},appendFeedDataBag:s,cancelScenarioByNameId:r,cancelExistingAndCreateNewScenario:(e,t,n,i)=>(r(e,t,n,i),o(e,t,n)),findScenario:i,markScenarioStepByNameId:(e,t,n,a,o)=>{const{logger:r}=e,s=i(e,t,n.scenarioId);return s?s.mark(a,n.data,o):r.warn(`${t} with Id: ${n.scenarioId} - not found hence did not mareked step`),s},newScenario:o,startScenario:(e,t,n)=>{const{logger:a}=e;let r=i(e,t,n.scenarioId);return r?a.warn(`${t} - scenario already started with origin: ${r?.eventData?.origin}`):r=o(e,t,n),r},stopScenarioByNameId:(e,t,n,a)=>{const{logger:o}=e,r=i(e,t,n.scenarioId);if(r){const{data:e}=n;r.stop(e,a),o.log(`${t} - scenario stopped with id: ${r.clientId}`)}else o.warn(`No active scenario with ScenarioName: ${t} with Id: ${n.scenarioId}`)},getFeedDataBagString:a,findScenarioAndAppendFeedDataBag:(e,t,n,i)=>{const{logger:a}=e,o=l.findScenario(e,t,i);o?s(a,o,n):a.warn(`${t} with Id: ${i} - not found hence couldn't append feedDataBag`)}}},123901:(e,t,n)=>{"use strict";var i;n.d(t,{J:()=>i}),function(e){e.navWithoutEarlyFetch="navWithoutEarlyFetch"}(i||(i={}))},364565:(e,t,n)=>{"use strict";var i,a;n.d(t,{NN:()=>i,d_:()=>a,GD:()=>o}),function(e){e.Chat="Chat",e.Meetings="Meetings",e.Notifications="notifications",e.GraphApps="GraphApps",e.TeamsAndChannelsCustom="Custom",e.CallGroup="call_group",e.Recommendation="Recommendation"}(i||(i={})),function(e){e.Chat="notification_settings_details_chat_subheader_text",e.Meetings="notification_settings_details_only_meetings_subheader_string",e.TeamsAndChannelsCustom="notification_settings_details_teams_channel_subheader_text"}(a||(a={}));const o="activity-settings"},988917:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{NE:()=>i,iP:()=>a,S_:()=>o,ET:()=>r,B9:()=>s,US:()=>l,x4:()=>c,HX:()=>d,oi:()=>u,DO:()=>m,yF:()=>p,ch:()=>g,LI:()=>h,rm:()=>y,rp:()=>v,F4:()=>f}),function(e){e.Any="any",e.Never="never",e.Chat="chat",e.Reply="reply",e.ReplyToReply="replyToReply",e.Like="like",e.Mention="mention",e.TeamMembershipChange="teamMembershipChange",e.AddedToTeam="addedToTeam",e.PromotedToTeamAdmin="promotedToTeamAdmin",e.Download="download",e.Follow="follow",e.CallOrMeetup="callOrMeetup",e.ThirdParty="thirdParty",e.Unread="unread",e.Inferred="inferred",e.MessageSendFailed="messageSendFailed",e.LikeInChat="likeInChat",e.MentionInChat="mentionInChat",e.MentionInCommunity="mentionInCommunity",e.ReactionInCommunity="reactionInCommunity",e.CallTransferFailed="callTransferFailed",e.Call="call",e.MissedCall="missedCall",e.Voicemail="voicemail",e.GroupRenewal="groupRenewal",e.Error="error",e.DesktopNotification="desktopNotification",e.Trending="trending",e.ShareFromChat="shareFromChat",e.PresenceStatus="presenceStatus",e.Priority="priority",e.Reaction="reaction",e.ReactionInChat="reactionInChat",e.TeamsTasks="teamsTasks",e.TeamsEngagementActivity="teamsEngagementActivity",e.DLP="dLP",e.MsGraph="msGraph",e.StaffHub="StaffHub",e.SkypeConsumerCall="SkypeConsumerCall",e.SyntheticNotification="syntheticNotification",e.UserActivity="UserActivity",e.NativeNotificationFre="NativeNotificationFre",e.Recommendation="Recommendation",e.JoinInvite="joinInvite",e.CommunityReply="communityReply",e.CommunityReplyToReply="communityReplyToReply",e.CommunityMention="communityMention",e.CommunityMembership="communityMembership",e.Calendar="calendar",e.ReactionInSubCommunity="reactionInSubCommunity",e.MentionInSubCommunity="mentionInSubCommunity"}(i||(i={})),function(e){e.Everyone="everyone",e.Team="team",e.Person="person",e.AddedToTeam="addedToTeam",e.PromotedToTeamAdmin="promotedToTeamAdmin",e.DownloadStarted="downloadStarted",e.Downloaded="downloaded",e.DownloadFailed="downloadFailed",e.ChannelReplyMessage="channelReplyMessage",e.ChannelNewMessage="channelNewMessage",e.Call="call",e.Meetup="meetup",e.Bot="bot",e.Channel="channel",e.Campaign="campaign",e.MissedCall="missedCall",e.Voicemail="voicemail",e.ThirtyDayNotification="thirtyDayNotification",e.RifteenDayNotification="rifteenDayNotification",e.RenewedNotification="renewedNotification",e.OneOnOneChat="oneOnOneChat",e.GroupChat="groupChat",e.ShareFromChat="shareFromChat",e.Like="like",e.Angry="angry",e.Sad="sad",e.Laugh="laugh",e.Heart="heart",e.Surprised="surprised",e.NotifySender="notifySender",e.PendingSelfJoinRequest="pendingSelfJoinRequest",e.PendingOnBehalfOfJoinRequest="pendingOnBehalfOfJoinRequest",e.NativeNotificationFre="nativeNotificationFre",e.PendingOnBehalfOfJoinRequestMultiple="pendingOnBehalfOfJoinRequestMultiple",e.TaskAssignedToYou="taskAssignedToYou",e.UrgentTaskAssignedToYou="urgentTaskAssignedToYou",e.YourTaskWasUpdated="yourTaskWasUpdated",e.YourTaskChangedToNotStarted="yourTaskChangedToNotStarted",e.YourTaskChangedToInProgress="yourTaskChangedToInProgress",e.YourTaskChangedToCompleted="yourTaskChangedToCompleted",e.YourTaskChangedToBlocked="yourTaskChangedToBlocked",e.YourTaskChangedToRemoved="yourTaskChangedToRemoved",e.YourTaskChangedToNotApplicable="yourTaskChangedToNotApplicable",e.YourTaskWasReassigned="yourTaskWasReassigned",e.YourTaskWasDeleted="yourTaskWasDeleted",e.TaskListPublishedToYourTeam="taskListPublishedToYourTeam",e.TaskListRecalledFromYourTeam="taskListRecalledFromYourTeam",e.YourTaskWasMarkedUrgent="yourTaskWasMarkedUrgent",e.YourTaskWasMarkedNotUrgent="yourTaskWasMarkedNotUrgent",e.UrgentTaskPublishedToYourTeam="urgentTaskPublishedToYourTeam",e.SmsChat="smsChat",e.NewShift="newShift",e.SchedulePublished="schedulePublished",e.NewShiftRequest="newShiftRequest",e.ShiftRequestUpdated="shiftRequestUpdated",e.ShiftUpdated="shiftUpdated",e.MissedMeetingNudge="missedMeetingNudge",e.Tag="tag",e.InviteeJoined="inviteeJoined",e.AddedToSharedChannel="addedToSharedChannel",e.TeamShareTeamOwnerNotify="teamShareTeamOwnerNotify",e.PromotedToSharedChannelOwner="promotedToSharedChannelOwner",e.ChannelOwnerUnshareTeamOwnerNotify="channelOwnerUnshareTeamOwnerNotify",e.TeamOwnerUnshareChannelOwnerNotify="teamOwnerUnshareChannelOwnerNotify",e.HostOwnerUnshareChannelOwnerNotify="hostOwnerUnshareChannelOwnerNotify",e.HostOwnerUnshareTeamOwnerNotify="hostOwnerUnshareTeamOwnerNotify",e.Community="community",e.CommunityJoinInviteCreated="communityJoinInviteCreated",e.CommunityJoinInviteAccepted="communityJoinInviteAccepted",e.CommunityMembershipJoinRequestAccepted="communityMembershipJoinRequestAccepted",e.CommunityMembershipJoinRequestCreated="communityMembershipJoinRequestCreated",e.CommunityMembershipPromotedToAdmin="communityMembershipPromotedToAdmin",e.NewCalendarEvent="newCalendarEvent",e.CalendarEventCanceled="calendarEventCanceled",e.CalendarEventUpdated="calendarEventUpdated",e.InviteeJoinedOne2One="inviteeJoinedOne2One",e.InviteeJoinedGroupChat="inviteeJoinedGroupChat",e.InviteeJoinedCommunity="inviteeJoinedCommunity"}(a||(a={})),function(e){e.Call="call",e.Chat="chat"}(o||(o={}));const r=[i.Reaction,i.TeamMembershipChange,i.Mention,i.Follow,i.Reply,i.ReplyToReply],s=[i.MentionInChat,i.ReactionInChat,i.Priority];var l,c,d,u,m,p;!function(e){e.MobileOnly="mobile",e.DesktopWebOnly="desktopWeb",e.All="all"}(l||(l={})),function(e){e.taco="2a84919f-59d8-4441-a975-2a8c2643b741",e.calendar="ef56c0de-36fc-4ef8-b417-3d82ba9d073c"}(c||(c={})),function(e){e.toggleActivityRead="toggleActivityRead",e.deleteActivityFeedItem="deleteActivityFeedItem",e.removeActivityFeedItem="removeActivityFeedItem",e.channelNotificationSettings="channelNotificationSettings",e.missedCallFeedCallBackAction="missedCallFeedCallBackAction",e.missedCallFeedChatAction="missedCallFeedChatAction",e.notificationSettings="notificationSettings",e.turnOffLikesAndReactions="turnOffLikesAndReactions",e.muteApp="muteApp",e.turnOffChannel="turnOffChannel",e.turnOffAllTeamAndChannelMentions="turnOffAllTeamAndChannelMentions",e.turnOffRepliesFromChannel="turnOffRepliesFromChannel",e.turnOffPostsFromChannel="turnOffPostsFromChannel"}(d||(d={})),function(e){e.notificationSettings="notificationSettings",e.markAllAsRead="markAllAsRead"}(u||(u={})),function(e){e.mentionIcon="iconsMention",e.likeIcon="iconsReactionsLike",e.sadIcon="iconsReactionsSad",e.wowIcon="iconsReactionsWow",e.angryIcon="iconsReactionsAngry",e.heartIcon="iconsReactionsHeart",e.laughIcon="iconsReactionsLaugh",e.missedCallIcon="missedCallIcon",e.voicemailIcon="voicemailIcon",e.urgentIcon="iconsUrgent",e.defaultIcon="iconDefault",e.addedToTeamIcon="addedToTeamIcon",e.promotedToAdminIcon="promotedToAdminIcon",e.communityMentionIcon="communityMentionIcon",e.channelMentionIcon="channelMentionIcon",e.teamMentionIcon="teamMentionIcon",e.followChannelIcon="followChannelIcon",e.replyIcon="replyIcon",e.customIcon="customIcon",e.channelShareIcon="channelShareIcon",e.channelDismissIcon="channelDismissIcon",e.everyoneMentionIcon="everyoneMentionIcon",e.calendar="calendar",e.appIcon="iconsApp"}(m||(m={})),function(e){e.hasText="hasText",e.sentAFile="sentAFile",e.sentAnImage="sentAnImage",e.sentACard="sentACard",e.previewUnavailable="previewUnavailable",e.DLPMessagePreview="dlpMessagePreview"}(p||(p={}));const g=30,h=1e3;var y,v,f;!function(e){e.unread="unread",e.mention="mention",e.reactions="reactions",e.missedcall="missedcall",e.reply="reply",e.apps="apps",e.voicemail="voicemail",e.atmentions="atmentions"}(y||(y={})),function(e){e.states="states",e.types="types"}(v||(v={})),function(e){e.navWithoutEarlyFetch="navWithoutEarlyFetch",e.navOnEarlyFetch="navOnEarlyFetch",e.navOnDifferentMainEntity="navOnDifferentMainEntity",e.noNavOnSameMainEntity="noNavOnSameMainEntity"}(f||(f={}))},774205:(e,t,n)=>{"use strict";var i,a,o,r;n.d(t,{Nt:()=>i,Eg:()=>a,mL:()=>o,m$:()=>r,FH:()=>s,yn:()=>l}),function(e){e.DEFAULT="DEFAULT",e.CHANNEL="CHANNEL",e.COMMUNITIES="COMMUNITIES"}(i||(i={})),function(e){e.Private="Private"}(a||(a={})),function(e){e.chat="chatCampaign",e.meeting="meetingCampaign",e.files="filesCampaign",e.contactSyncConfirmation="contactSyncConfirmation",e.communityInvite="communityInviteCampaign"}(o||(o={})),function(e){e.channel="channel",e.chat="chat",e.communities="communities",e.communitiesJoinInviteView="communitiesJoinInviteView",e.communitiesJoinRequestsView="communitiesJoinRequestsView",e.communitiesMembersView="communitiesMembersView",e.communitiesCalendarEvent="communitiesCalendarEvent",e.syntheticNotificationCampaign="syntheticNotificationCampaign",e.joinInviteActivity="joinInviteActivity",e.teamPendingJoinRequest="teamPendingJoinRequest",e.manageTeamChannels="manageTeamChannels",e.manageChannelMembers="manageChannelMembers",e.msGraph="msGraph",e.calls="calls",e.communitiesL1View="communitiesL1View",e.onboardedToTeam="onboardedToTeam",e.generic="generic"}(r||(r={}));const s={teamAvatar:"teamAvatar",staticImage:"staticImage",imageUrl:"imageUrl",default:"default"},l={DLP:"DLP"}},140210:(e,t,n)=>{"use strict";n.d(t,{D:()=>f,W:()=>S});var i=n(803238),a=n(316877),o=n(733559),r=n(309501),s=n(702135),l=n(689626),c=n(301366),d=n(665641),u=n(643902),m=n(812630),p=n(288718),g=n(485510),h=n(683184),y=n(543491);const v=["teams","/l/message/","chat"],f=(e,t)=>{if(!t?.enableDomainLinks)return v.every((t=>e.includes(t)));try{const n=new URL(e),i=t.currentDomainLinks;return!!i&&i.some((e=>{const t=new URL(e);return n.hostname===t.hostname}))}catch(e){return!0}};class S{constructor(e,t,n,i,a){this.botsPlatformService=t,this.scenarioFactory=n,this.queryLinkRequestsInProgress={},this.logTelemetryForLinkUnfurlingInvokePostSend=(e,t,n,i,a)=>{if(!e?.definition)return;const o={id:e.id,botId:e.definition.messageExtensions?.[0]?.botId||"",scenarioCapability:p.Ky.messaging,name:e.definition.name||"",threadId:n||"",externalId:e.definition.externalId||"",version:e.definition.version||"",manifestVersion:e.definition.manifestVersion||"",installationState:e.installationState,draftId:a||"",linkUnfurlingType:i};this.userBiService.recordPanelAction({actionGesture:g.uS.asyncStateChange,actionOutcome:g.$K.invoke,actionScenario:t?g.Tk.linkUnfurlingAnonymousInvokePostSend:g.Tk.linkUnfurlingInvokePostSend,actionScenarioType:g.Yu.sendMsgs,moduleName:g.rA.linkUnfurl,moduleType:g.PO.link,panelRegion:g.Ai.main,panelType:g.wh.AppBasedLink,extensibilityData:o})},this.enableAppBasedLinkSsoAuth=e.get(h.J.Extensibility).enableAppBasedLinkSsoAuth,this.tokenPrefetchBots=e.get(h.J.Extensibility).tokenPrefetchBots,this.ssoForBotsDefaultWebResourceEnabledBotIds=e.get(h.J.Extensibility).ssoForBotsDefaultWebResourceEnabledBotIds,this.enableAnonymousAppBasedLink=e.get(h.J.Extensibility).enableAnonymousAppBasedLink,this.anonymousAppBasedLinkApps=e.get(h.J.Extensibility).anonymousAppBasedLinkApps,this.enablePreAuthCard=e.get(h.J.Extensibility).enablePreAuthCard,this.logger=i.newLogger("AppBasedLinkService","services-io-app-based-link"),this.enableGetRichLinkToTeamOrChannel=e.get(h.J.TeamsAndChannels).enableGetRichLinkToTeamOrChannel,this.deepLinkDomains=e.get(h.J.Messaging).deepLinkDomains,this.userBiService=a}async getUrlPreviewFromApp(e,t,n,a,o){let r="",s=!1;const l={enableDomainLinks:this.enableGetRichLinkToTeamOrChannel,currentDomainLinks:this.deepLinkDomains};if(m.o===o||f(e,l))return void this.logger.debug(`LinkUnfurling: getUrlPreviewFromApp: url is a chat url and no link preview is needed for url: ${e}`);let d=t&&(0,c.A4)(e,t);if(!d&&this.enableAnonymousAppBasedLink){const t=n()||[];(0,i.isEmpty)(t)&&(r="no app defs");const a=(0,c.A4)(e,t.map((e=>({installationState:"NotInstalled",installedScope:"Personal",id:e.id,definition:e}))));a?.definition&&(0,c.C4)((0,c.dX)(a.definition),this.enableAnonymousAppBasedLink,this.anonymousAppBasedLinkApps)&&(d=a,s=!0)}const p=d?.definition&&(0,c.dX)(d.definition);if(!p)return(0,i.isEmpty)(t)&&!r&&(r="no installed apps"),void a.incomplete({errors:r});let g;if(s?(g=await this.getAnonymousAppPreview(e,p,o),this.logger.debug(`LinkUnfurling: Fetching anonymous app preview for url: ${e}`)):(g=await this.getAppPreview(e,p,o),this.logger.debug(`LinkUnfurling: Fetching app preview for url: ${e}`)),"HasResult"===g?.type&&g.messageExtensionItem){const{card:t,previewCard:n}=g.messageExtensionItem;if(t&&this.logTelemetryForLinkUnfurlingInvokePostSend(d,s,o,"CardPreview",g?.messageExtensionItem?.card?.cardClientId||""),n)return this.logTelemetryForLinkUnfurlingInvokePostSend(d,s,o,"URLPreview",g?.messageExtensionItem?.previewCard?.cardClientId||""),(0,u.j)(e,n)}else this.logTelemetryForLinkUnfurlingInvokePostSend(d,s,o,"NoResult"),this.logger.debug(`LinkUnfurling: No app preview found for url: ${e}`)}async getAnonymousAppPreview(e,t,n){try{const i=this.getQueryLinkVariables(e,t,n);if(!i)throw(0,s.Tr)("AppBasedLinkService",l.jK.InvalidInput,"getAnonymousAppPreview",void 0,this.getErrorMessage("Invalid message extension passed to invoke",t));this.queryLinkRequestsInProgress[e]||(this.queryLinkRequestsInProgress[e]=this.queryLink(i,t,y.RG.ExtGetAnonymousAppPreview,void 0,"composeExtension/anonymousQueryLink"));const a=await this.queryLinkRequestsInProgress[e];return delete this.queryLinkRequestsInProgress[e],!a||this.isEmptyResult(a)?null:this.matchedAnonymousResult(e,t,a)}catch(t){throw delete this.queryLinkRequestsInProgress[e],t}}async getAppPreview(e,t,n,i,a){try{const o=await this.tryPrefetchingToken(t,a,this.logger),r={},s=a??o,l=!!s,c=await this.getMessageExtensionResult(e,t,n,i,s,r);return delete this.queryLinkRequestsInProgress[e],!c||this.isEmptyResult(c)?null:this.matchedResult(e,t,c,l,n,i,r)}catch(t){throw delete this.queryLinkRequestsInProgress[e],t}}async matchedAnonymousResult(e,t,n){switch(n.type){case"result":return this.logger.debug(`LinkUnfurling: Initiating result type response for url: ${e}`),this.handleResultResponse(e,n,t);case"auth":return this.logger.debug(`LinkUnfurling: Initiating anonymous auth for url: ${e}`),this.handleAnonymousAuthConfigResponse(e,n,t);default:return this.logger.error(this.getErrorMessage(`LinkUnfurling: Invalid value ${n.type} for field 'type' in invoke response`,t)),null}}async matchedResult(e,t,n,i,a,o,r){switch(n.type){case"result":return this.logger.debug(`LinkUnfurling: Initiating result type response for url: ${e}`),this.handleResultResponse(e,n,t);case"auth":case"config":return"config"===n.type?this.logger.debug(`LinkUnfurling: Initiating config type response for url: ${e}`):this.logger.debug(`LinkUnfurling: Initiating auth type response for url: ${e}`),this.handleAuthConfigResponse(e,n,t);case"silentAuth":if(i)return this.logger.error(this.getErrorMessage(`LinkUnfurling: Result type ${n.type} not allowed for duplicate request`,t)),null;if(this.enableAppBasedLinkSsoAuth){if(r?.consentOverride)return this.handleSsoAuthResponse({isFailure:!1,isConsentRequired:!0,token:void 0},n,e,t,a,o);const i=await this.tryGetAuthToken(t);return this.handleSsoAuthResponse(i,n,e,t,a,o)}default:return this.logger.error(this.getErrorMessage(`Invalid value ${n.type} for field 'type' in invoke response`,t)),null}}isEmptyResult(e){const t=Object.keys(e);return 1===t.length&&"__typename"===t[0]}async handleSsoAuthResponse(e,t,n,i,a,o){const{isFailure:r,isConsentRequired:s,token:l}=e;if(r)return null;if(l&&!s){return await this.getAppPreview(n,i,a,o,{token:l})}return this.handleAuthConfigResponse(n,t,i)}getWebApplicationInfo(e){const t=e.messageExtensions&&e.messageExtensions[0].botId;return t&&this.ssoForBotsDefaultWebResourceEnabledBotIds&&this.ssoForBotsDefaultWebResourceEnabledBotIds?.indexOf(t)>=0?{botId:t,resource:`api://botid-${t}`}:{botId:t,resource:e.resource}}async tryPrefetchingToken(e,t,n){const{botId:i,resource:a}=this.getWebApplicationInfo(e);if(t||!this.enableAppBasedLinkSsoAuth||!i||!a||!this.tokenPrefetchBots||-1===this.tokenPrefetchBots.indexOf(i))return null;const o=this.scenarioFactory.newScenario(y.RG.AppBasedLinkAadAuth);o.appendEventData({"Bot.Id":i,context:"tokenPrefetch"});try{const e=await this.botsPlatformService.getAuthTokenForBot(i,a,!0,n);return o.stop(),{token:e}}catch(e){o.incomplete({errors:"tryPrefetchingToken: Token failed to acquire"})}return null}async tryGetAuthToken(e){const{botId:t,resource:n}=this.getWebApplicationInfo(e);if(!t||!n)return{isFailure:!0,isConsentRequired:!1,token:void 0};const i=this.scenarioFactory.newScenario(y.RG.AppBasedLinkAadAuth);i.appendEventData({"Bot.Id":t,context:"silent:true"});try{const e=await this.botsPlatformService.getAuthTokenForBot(t,n,!0,this.logger);return i.stop(),{isFailure:!1,isConsentRequired:!1,token:e}}catch(e){return e.code===l.jK.UserConsentRequired?(i.incomplete(),{isFailure:!1,isConsentRequired:!0,token:void 0}):e.code===l.jK.InvalidInput?(i.stop(),{isFailure:!0,isConsentRequired:!1,token:void 0}):(i.fail({errorCode:e.code}),{isFailure:!0,isConsentRequired:!1,token:void 0})}}async getMessageExtensionResult(e,t,n,i,a,o){const r=this.getQueryLinkVariables(e,t,n,i,a);return r?(this.queryLinkRequestsInProgress[e]||(this.queryLinkRequestsInProgress[e]=this.queryLink(r,t,y.RG.GetAppPreviewResult,o)),this.queryLinkRequestsInProgress[e]):(this.logger.error(this.getErrorMessage("Invalid message extension passed to invoke",t)),Promise.resolve(null))}queryLink(e,t,n,r,s){const l=(0,a.v4)(),c=this.scenarioFactory.newScenario(n);return c.appendEventData({"Bot.Id":e.botInvokeParams.botMri,"App.Id":t.id,"Thread.Id":e.botInvokeParams.threadId??"",appType:(0,i.isEmpty)(t.externalId)?"GlobalApp":(0,i.isEmpty)(t.tenantId)?"CustomApp":"TenantApp",correlationId:l}),this.botsPlatformService.executeBotInvoke(e.botInvokeParams,e.invokeValue,o.CB,this.logger,l,s||"composeExtension/queryLink",void 0,void 0,c).then((e=>(c.stop(),e))).catch((t=>{if(this.logger.warn(`Invoke failed with error: ${t} and args: ${JSON.stringify(e)}`),this.handleInvokeFailure(c,t,r),r?.consentOverride)return{type:"silentAuth"};throw t}))}handleInvokeFailure(e,t,n){if(t)if((e=>!!e&&!!(0,i.get)(e,"code")&&!!(0,i.get)(e,"message"))(t))switch(t.code){case l.jK.BotError:case l.jK.BotDisabledByAdmin:e.stop({errorCode:t.code,errors:JSON.stringify([t.message])});break;case l.jK.UserConsentRequired:e.incomplete({errorCode:t.code,errors:JSON.stringify([t.message])}),n&&(n.consentOverride=!0);break;default:e.fail({errorCode:t.code,errors:JSON.stringify([t.message])})}else e.fail({errorCode:l.jK.Unknown});else e.fail()}handleResultResponse(e,t,n){const o=(0,i.first)(t.items),r=o?.card,{defaultPreviewType:s,cachePolicyType:l}=this.processSuggestedActions(t.suggestedActions);if(r){const t=(0,a.v4)().replace(new RegExp("-","g"),""),c=(0,i.cloneDeep)(r),d=o?.previewCard||this.isSupportedPreviewCardType(c)&&c;return d?{__typename:"AppPreviewResult",id:e,type:"HasResult",messageExtensionItem:{__typename:"MessageExtensionItem",previewCard:d,card:{__typename:"Card",contentType:r.contentType,content:r.content,cardClientId:t,appId:n.id,appName:n.name,appIcon:n.largeImageUrl}},...s&&{defaultPreviewType:s},...l&&{cachePolicyType:l}}:(this.logger.error(this.getErrorMessage(`Could not use card with content type: ${r.contentType} as a preview card`,n)),null)}return null}handleAnonymousAuthConfigResponse(e,t,n){let i;return this.enablePreAuthCard&&t.items?.length&&(i=t.items[0]?.card),t.suggestedActions?.actions&&this.logger.warn("Suggested actions are not supported for anonymous query link invoke!"),{__typename:"AppPreviewResult",id:e,type:"MatchButNeedAuthOrConfig",permissionDetails:{__typename:"AppBasedLinkPermissionDetails",id:n.id,card:i,isAnonymous:!0}}}handleAuthConfigResponse(e,t,n){const a=t.suggestedActions?.actions?.[0];let o;if(this.enablePreAuthCard&&t.items?.length&&(o=t.items[0]?.card),a&&n.validDomains&&(0,d.Fd)(a.value,(0,i.compact)(n.validDomains)))return{__typename:"AppPreviewResult",id:e,type:"MatchButNeedAuthOrConfig",permissionDetails:{__typename:"AppBasedLinkPermissionDetails",id:n.id,card:o,openUrlResult:{__typename:"AppBasedLinkOpenUrlResult",title:a.title,url:a.value,isAuth:"auth"===t.type||"silentAuth"===t.type}}};const{resource:r}=this.getWebApplicationInfo(n);return"silentAuth"===t.type&&!a&&r?{__typename:"AppPreviewResult",id:e,type:"MatchButNeedAuthOrConfig",permissionDetails:{__typename:"AppBasedLinkPermissionDetails",id:n.id,aadAuthResult:{__typename:"AppBasedLinkAadAuthResult",resource:r}}}:(this.logger.error(this.getErrorMessage("Invalid auth/config result from bot",n)),null)}isSupportedPreviewCardType(e){const t=e.contentType.toLowerCase();return"application/vnd.microsoft.card.hero"===t||"application/vnd.microsoft.card.thumbnail"===t}getQueryLinkVariables(e,t,n,i,a){const o=t.messageExtensions?.[0];if(o){return{botInvokeParams:{threadId:n??"",botMri:`${r.at.BotPrefix}${o.botId??""}`},invokeValue:JSON.stringify({url:e,...i&&{state:i},...a&&{authentication:a}})}}}getErrorMessage(e,t){return`${e} for app id: ${t.id}`}processSuggestedActions(e){let t,n;return e?(e.actions?.forEach((e=>{switch(e.type){case"setDefaultUrlPreviewType":t=this.getPreviewType(e.value),t||this.logger.error(`Invalid invoke response: invalid setDefaultUrlPreviewType ${e.value}`);break;case"setCachePolicy":try{const t=JSON.parse(e.value);n=this.getCachePolicy(t.type)}catch(t){this.logger.error(`Invalid invoke response: setCachePolicy requires stringified JSON payload, but got ${e.value}`);break}n||this.logger.error("Invalid invoke response: invalid cache policy type");break;default:this.logger.error(`Invalid invoke response: unsupported suggestedAction type: ${e.type}`)}})),{defaultPreviewType:t,cachePolicyType:n}):{defaultPreviewType:t,cachePolicyType:n}}getPreviewType(e){switch(e){case"Thumbnail":return"Thumbnail";case"Card":return"Card";default:return}}getCachePolicy(e){if("no-cache"===e)return"NoCache"}}},812630:(e,t,n)=>{"use strict";n.d(t,{o:()=>i});const i="48:notes"},457857:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var i=n(72742),a=n(960983),o=n(543491);const r=(e,t)=>{const n=(0,a.NI)(e),i=e.body;i&&n&&s(i,n,t)},s=(e,t,n)=>{const i=n?.newScenario(o.RG.ExtCardMentionsInvoke),a={hasMentions:!1};e.forEach((e=>l(e,t,a))),i&&(a.hasMentions?i.mark(o.ck.ExtCardMentionsInvokeComplete):i.mark(o.ck.ExtCardMentionsInvokeMissing),i.stop())},l=(e,t,n)=>{(0,a.gU)(e,{type:"TextBlock"},(e=>{c(t,n)(e)})),(0,a.gU)(e,{type:"FactSet"},(e=>{d(t,n)(e)}))},c=(e,t)=>n=>{e.forEach(((e,i)=>{n.text=u(n.text,i,e,t)}))},d=(e,t)=>n=>{n.facts.forEach((n=>{e.forEach(((e,i)=>{n.title=u(n.title,i,e,t),n.value=u(n.value,i,e,t)}))}))},u=(e,t,n,a)=>{const{mentionsText:o,isMentionsApplied:r}=m(e,t,n,i.T.mention);return a.hasMentions=a.hasMentions||r,o},m=(e,t,n,i)=>{let a=!1;if(-1!==e.indexOf(t)){const o=`<span contenteditable="false" itemscope="" itemtype="${i}" itemid="${n.itemId}">${g(p(t))}</span>`;e=e.replace(new RegExp(t,"g"),o),a=!0}return{mentionsText:e,isMentionsApplied:a}},p=e=>e.substring(4,e.length-5),g=e=>e?e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;"):""},733559:(e,t,n)=>{"use strict";n.d(t,{CB:()=>l,G8:()=>c,$Z:()=>d});var i=n(803238),a=n(147026),o=n(938772),r=n(457857),s=n(553586);const l=(e,t)=>{const n={__typename:"MessageExtensionResult"},i=e?.composeExtension;if(!i)return n;const a=i.type,o=i.text,l=i.attachments,c=i.suggestedActions;if(!l){const e=u(i.activityPreview);return{...n,...a&&{type:a},...o&&{text:o},...c&&{suggestedActions:c},...e&&{activityPreview:e}}}const d=i.attachmentLayout;l.forEach((e=>{e.contentType.toLowerCase()===s.s.Adaptive&&(0,r.j)(e.content,t)}));const m={items:Array.from(l,(e=>({card:{content:JSON.stringify(e.content),contentType:e.contentType},previewCard:e.preview?{content:JSON.stringify(e.preview.content),contentType:e.preview.contentType}:void 0}))),...a&&{type:a},...d&&{attachmentLayout:d},...c&&{suggestedActions:c},...o&&{text:o}};return{...n,...m}},c=e=>{if((0,i.isEmpty)(e))return(0,a.VF)(e);switch(e.responseType){case"composeExtension":return l(e);case"task":return(0,a.VF)(e);default:throw(0,o.XD)(o.jI.InvalidInvokeResponseType)}},d=e=>{if(!Array.isArray(e))return;const t=e.map((e=>{const t=(0,i.first)(e?.attachments);return{type:e?.type,attachments:t&&[{contentType:t.contentType,content:t.content&&JSON.parse(t.content)}]}})).filter((e=>!!e.attachments));return(0,i.isEmpty)(t)?void 0:t},u=e=>{if(!Array.isArray(e))return;const t=e.map((e=>{const t=(0,i.first)(e?.attachments);return{type:e?.type,attachments:t&&[{contentType:t.contentType,content:t.content&&JSON.stringify(t.content)}]}})).filter((e=>!!e.attachments));return(0,i.isEmpty)(t)?void 0:t}},147026:(e,t,n)=>{"use strict";n.d(t,{VF:()=>o,ef:()=>r,Ic:()=>u});var i=n(803238),a=n(938772);const o=e=>{if((0,i.isEmpty)(e))return u();if(s(e))return c(e.task);if(l(e))return d(e.task);throw(0,a.Pn)(a.pF.Unknown)},r=e=>{const t=e.value,n=(0,i.get)(t,"url"),o=(0,i.get)(t,"card");let r;if(!o&&!n)throw(0,a.Pn)(a.pF.MissingCardAndUrl);if(o&&n)throw(0,a.Pn)(a.pF.BothCardAndUrl);if(o)r=p(e);else if(!(0,i.isString)(n))throw(0,a.Pn)(a.pF.InvalidUrl);const{title:s,fallbackUrl:l,completionBotId:c,height:d,width:u}=t;return{title:s,fallbackUrl:l,completionBotId:c,url:n,card:r,height:m(d),width:m(u)}},s=e=>e.task&&"continue"===e.task.type&&(0,i.isObject)(e.task.value),l=e=>e.task&&"message"===e.task.type&&(0,i.isString)(e.task.value),c=e=>{const t=r(e);return{__typename:"TaskModuleTaskContinue",type:e.type,value:t}},d=({type:e,value:t})=>({__typename:"TaskModuleTaskMessage",type:e,value:t}),u=()=>({__typename:"TaskModuleTaskDone",text:"Done"}),m=e=>{if((0,i.isString)(e)){return{__typename:"DimensionInString",value:e}}if((0,i.isNumber)(e)){return{__typename:"DimensionInFloat",value:e}}return null},p=e=>{const t=e.value.card;try{if(t&&g(t)){const{content:e={},contentType:n}=t;return{__typename:"Card",contentType:n,content:JSON.stringify(e)}}throw(0,a.Pn)(a.pF.InvalidAdaptiveCard)}catch{throw(0,a.Pn)(a.pF.InvalidAdaptiveCard)}},g=e=>{const t=(0,i.get)(e,"contentType");return(0,i.isString)(t)&&t.toLowerCase()==="application/vnd.microsoft.card.adaptive".toLowerCase()}},156644:(e,t,n)=>{"use strict";n.d(t,{bD:()=>i,Rz:()=>k,kK:()=>C,c:()=>b,qT:()=>w,K8:()=>T,qg:()=>I,pd:()=>N,se:()=>E,Fh:()=>A,vJ:()=>_,jc:()=>F,Dm:()=>r,wx:()=>s,rS:()=>P,D7:()=>M,Gz:()=>x});var i,a,o,r,s,l=n(316877),c=n(683184),d=n(66432),u=n(256676),m=n(543491);function p(e){const{clientId:t}=e.get(c.J.Brb);return t}function g(e){const{licenseType:t}=e.get(c.J.UserResources);return t}function h(e,t,n,a){const{adoTagsForAllItems:o,categories:r}=e.get(c.J.Brb),s=r?.find((e=>e?.id===t)),l=s?.additionalAdoTags||"",u=n.get(i.Ring)||"unknownRing",m=function(e,t){const{platformAdoTagPrefix:n,platformAdoTagSuffix:i}=e.get(c.J.Brb);let a=`${n||"teams"}_${i||t.config.browser}`;return n&&i&&t?.config?.platformId===d.us.Web&&(a=t?.config?.browser?`${a}_${t?.config?.browser}`:a),a}(e,a);return[o,l,u,m,n.get(i.MTMA)?"MTMA":""].filter((e=>e)).join(";")}function y(e,t,n){const a=`${function(e){const t=e.get(i.Build)||"";return t.startsWith("local")?"[LOCAL] ":t.indexOf("oncdn")>=0?"[CONTAINER] ":""}(n)||""}${e||""}`,{brbItemTitleMaxLength:o}=t.get(c.J.Brb);return f(a,o||1500)}function v(e,t){const{brbItemDescriptionMaxLength:n}=t.get(c.J.Brb);return f(e||"",n||5e3)}function f(e,t){return(e=e||"No text provided").length>t?`${e.substring(0,t-3)}...`:e}function S(e){let t="";const n=e.get(i.MTMA);n&&"MTMA"===n&&(t="<h3>(This is MTMA scenario, please check logs from user's other accounts under Links tab)</h3><br>");let a="";return e?.forEach(((e,t)=>{a=`${a}<b>${t}:</b> ${e}<br>`})),`<h3><strong>All the logs & screenshots (if attached) are available in the devlogs link which is present in the Links tab.</strong></h3><br>${t}${a}`.trim()}async function k(e,t,n){try{const n=await t.loadModule("toasts");if(n){const t=await(n?.getFocusAssistStateAsync?.());e.set(a.FocusAssistant,t||"");const i=await(n?.getGlobalNotificationSettingsAsync?.());e.set(a.GlobalNotificationSettings,i?.global||"")}}catch(e){n.log("Failed to obtain system notification settings: ",e)}}function C(e,t,n,a,o){e.set(i.UserEmail,t?.profile?.email||t?.profile?.upn||t?.profile?.preferred_username||""),e.set(i.UserType,t?.type?.toString()||""),e.set(i.TenantID,t?.profile?.tid||""),e.set(i.Ring,n.get(c.J.Metadata)?.ring?.id||""),e.set(i.UserID,t?.profile?.oid?.toString()||"");const r=n.get(c.J.Brb)?.sendBrbMSAlias?a.config.clientType===d.Bh.Maglev?t?.userName:t?.profile?.upn||t?.profile?.email:"";e.set(i.MSAlias,r||"");const{sessionId:s}=n.get(c.J.Platform);e.set(i.SessionId,s||""),e.set(i.Language,o?.locale||"")}async function b(e,t,n){try{const n=await t.loadModule("osutils");if(n){const t=await(n?.getDeviceInfo?.());e.set(i.OsVersion,t?.osVersion||""),e.set(i.UbrVersion,t?.ubrVersion||""),e.set(i.DeviceID,t?.deviceId||"unkown deviceID"),e.set(i.SystemManufacturer,t?.make||""),e.set(i.DeviceModel,t?.model||""),e.set(i.AppCenterInstallerId,t?.appCenterInstallerId||"")}}catch(e){n.log("Error while obtaining BRB device informations: ",e)}}async function w(e,t,n){try{e.set(i.slimCoreVersion,t?.SlimCore?.getVersion().toString()||"unkown slimcore version")}catch(e){n.log("Impossible fetch slimcore version: ",e)}}async function T(e,t,n,a){try{const{browser:a,browserVersion:o,clientVersion:r}=n.get(c.J.Platform);e.set(i.Browser,a||""),e.set(i.BrowserVersion,o||""),e.set(i.WebClientBuild,r||"");const{systemInfoClient:s}=n.get(c.J.Brb);e.set(i.Client,s||"");const{desktopVersion:l}=n.get(c.J.Host);e.set(i.DesktopClientVersion,l||"unknown"),e.set(i.Platform,t?.config?.platformId?.toString()||""),e.set(i.Os,t?.config?.osPlatform||"")}catch(e){a.log("Failed to obtain app information: ",e)}}async function I(e,t,n){try{const{enableCustomNotificationsForCalls:n,enableCustomNotificationsForChats:i,enableCustomNotificationsOnDesktop:o}=t.get(c.J.Core);e.set(a.CustomNotificationOnDesktop,o?"Enabled":"Disabled"),e.set(a.CustomNotificationForCalls,n?"Enabled":"Disabled"),e.set(a.CustomNotificationForChats,i?"Enabled":"Disabled")}catch(e){n.log("Failed to obtain app information: ",e)}}function N(e,t,n){try{const{callingEnableUnifiedJoinFlowForPlaceCalls:n}=t.get(c.J.Calling);e.set(o.callingEnableUnifiedJoinFlowForPlaceCalls,n?"Enabled":"Disabled")}catch(e){n.log("Failed to obtain FF callingEnableUnifiedJoinFlowForPlaceCalls status: ",e)}}async function E(e,t){const n=await(t?.getCachedUsers?.({id:(0,l.v4)(),scenarioName:m.RG.AuthWebCachedUser,source:"brb-utils::addMTMAInfo"})),a=n?.length&&n.length>1;e.set(i.MTMA,a?"MTMA":"")}function A(e,t,n,a,o){return(0,u.u4)({ReportTitle:y(e.text,t,a),ReportDescription:v(e.text,t),CategoryName:e.categoryId,UploadID:(0,l.v4)(),InitiatorIDs:[],ClientID:p(t),ClientVersion:D(a),CorelibVersion:"",Ring:a.get(i.Ring),SkypeAuthToken:n,TenantName:"",TenantID:a.get(i.TenantID),UserID:a.get(i.UserID),Email:a.get(i.UserEmail),MSAlias:a.get(i.MSAlias)||"",SkipEmailNotification:!1,SkipVsoTicketCreation:!1,SystemInfo:S(a),VsoTags:h(t,e.categoryId,a,o),LicenseType:g(t),IsAutoBrb:"true"===a.get(i.IsAutoBrb)})}function _(e,t,n){const{extendBrbReportsUrl:a,clientId:o}=t.get(c.J.Brb);return{baseUrl:a?.substring(0,a.lastIndexOf("/"))??"",title:e.text,clientId:o??"",clientVersion:D(n),ring:n.get(i.Ring)}}function F(e,t,n,a,o){return(0,u.u4)({ReportTitle:y(e.text,a,o),ReportDescription:v(e.text,a),CategoryName:e.categoryId,SkypeAuthToken:t,UploadID:(0,l.v4)(),InitiatorIDs:[n],ClientID:p(a),ClientVersion:D(o),Email:o.get(i.UserEmail),TenantID:o.get(i.TenantID),UserID:o.get(i.UserID),Ring:o.get(i.Ring)})}function D(e){return e.get(i.WebClientBuild)||"1.1.11.1111_11/1.1.1.1111111111"}function P(e,t,n,i,a){let o=i;o=o?o===s.ApiFailure?s.ApiFailure:o.includes(s.TimedOut)?s.TimedOut:s.Unknown:void 0;let r=e.get(t);return r?(r.uploadStatus=n,r.byteSize=a??r.byteSize,r.error=o??r.error):(r={uploadStatus:n,byteSize:a,error:o},e.set(t,r)),o}function M(e){let t=!0;const n=[];for(const[i,a]of e.entries()){const e=a.byteSize?`(${a.byteSize} bytes)`:"",o=`Status: ${a.uploadStatus}`;t=a.uploadStatus===r.Success&&t;const s=`FileName: ${i} ${e}, ${o}${a.error?`, error: ${a.error}`:""}`;n.push(s)}return{content:n.join("\r\n"),allLogFilesUploaded:t,summaryFileUploaded:!1}}function x(e){const t=e.split("/"),n=t.length>1?t[t.length-1]:e;return e.includes("WebLogs/Core")?`WebLogs/Core/${n}`:e.includes("WebLogs/User")?`WebLogs/User/${n}`:n}!function(e){e.UserEmail="UserEmail",e.TenantID="TenantID",e.Ring="Ring",e.UserID="UserID",e.WebClientBuild="WebClient build",e.Build="Build",e.MTMA="MTMA",e.MSAlias="MSAlias",e.DeviceID="Device ID",e.Language="Language",e.SystemManufacturer="System Manufacturer",e.DeviceModel="Device Model",e.DesktopVersion="Desktop Version",e.slimCoreVersion="Slimcore Version",e.UbrVersion="Update Build Revision",e.Platform="Platform",e.Os="OS",e.OsVersion="OS Version",e.Browser="Browser",e.BrowserVersion="Browser Version",e.Client="Client",e.UserType="User Type",e.SessionId="Session Id",e.DesktopClientVersion="Desktop Client Version",e.AppCenterInstallerId="AppCenter Installer ID",e.IsAutoBrb="IsAutoBrb"}(i||(i={})),function(e){e.FocusAssistant="Focus Assistant",e.GlobalNotificationSettings="Global Notification Settings",e.CustomNotificationOnDesktop="Custom Notification on Desktop",e.CustomNotificationForChats="Custom Notification for Chats",e.CustomNotificationForCalls="Custom Notification for Calls"}(a||(a={})),function(e){e.callingEnableUnifiedJoinFlowForPlaceCalls="Enable Unified Join Flow For Place Calls"}(o||(o={})),function(e){e.Requested="Requested",e.Success="Success",e.Failure="Failure"}(r||(r={})),function(e){e.TimedOut="TimedOut",e.Unknown="Unknown",e.ApiFailure="ApiFailure",e.NetworkError="NetworkError"}(s||(s={}))},27646:(e,t,n)=>{"use strict";n.d(t,{w:()=>v});var i=n(683184),a=n(543491),o=n(945151),r=n(37718),s=n(156644),l=n(156771);const c=e=>{const t=e.loggerFactory.newLogger("BrbServiceEndpointsManager","services-io-brb");return{baseUrl:"https://brbv2",serviceName:o.E.BRB,models:{createBrbItem:u(e,t),uploadLogsFile:m(e,t),releaseBrbItem:p(e,t),extendBrbReports:d(e,t)}}},d=async(e,t)=>({allowedResponses:[r.qb.OK],constructRequest:(n,a,o,r)=>{if(!a){const e=`Skype token is not present: ${a}`;throw t.error(e),new Error(e)}const{extendBrbReportsUrl:l}=e.coreSettings.get(i.J.Brb);if(!l){const e=`Failed to retrieve extend BRB report url from core settings: ${l}`;throw t.error(e),new Error(e)}let c;try{c=(0,s.jc)(n,a,o,e.coreSettings,r)}catch(e){throw t.error("Failed to get extend BRB report request body:",e),e}const d=new URL(l);return{method:"POST",url:d.href,headers:{Host:d.hostname,"Content-Type":"application/json","Content-Length":`${c.length}`},body:c}},abortOnTimeout:!1}),u=async(e,t)=>({allowedResponses:[r.qb.OK],constructRequest:(n,a,o)=>{if(!n){const e=`Skype token is not present: ${n}`;throw t.error(e),new Error(e)}const{createBrbRequestUrl:r}=e.coreSettings.get(i.J.Brb);if(!r){const e=`Failed to retrieve create BRB request url from core settings: ${r}`;throw t.error(e),new Error(e)}let l;try{l=(0,s.Fh)(a,e.coreSettings,n,o,e.platformService)}catch(e){throw t.error("Failed to get create BRB item request body:",e),e}const c=new URL(r);return{method:"POST",url:c.href,headers:{Host:c.hostname,"Content-Type":"application/json","Content-Length":`${l.length}`},body:l}}}),m=(e,t)=>Promise.resolve({allowedResponses:[r.qb.CREATED],constructRequest:(n,a)=>{if(!n){const e=`Create BRB item response body is not present: ${n}`;throw t.error(e),new Error(e)}if(!a){const e=`Logs file is not present: ${a}`;throw t.error(e),new Error(e)}const{enableGzipUpload:o,minSizeToGzip:r}=e.coreSettings.get(i.J.Brb,["enableGzipUpload","minSizeToGzip"]),s=new URL(n.ContainerUrl);let c,d,u;return o&&"string"==typeof a.content&&a.content.length>(r??2e3)?(c=(0,l.gzip)(a.content),d=c.length,u=!0):(c=a.content,d="string"==typeof a.content?a.content.length:a.content.size,u=!1),{method:"PUT",url:`${s.href}/${a.fileName}?${n.SASToken}`,headers:{Host:s.hostname,"Content-Type":"text/plain","Content-Length":d.toString(),"x-ms-blob-type":"BlockBlob",...u?{"Content-Encoding":"gzip"}:{}},body:c}},transformResponse:()=>Promise.resolve(!0),abortOnTimeout:!1}),p=(e,t)=>Promise.resolve({allowedResponses:[r.qb.OK],constructRequest:n=>{if(!n){const e=`Container ID is not present: ${n}`;throw t.error(e),new Error(e)}const{releaseBrbRequestUrlPrefix:a}=e.coreSettings.get(i.J.Brb);if(!a){const e=`Failed to retrieve release BRB request url prefix from core settings: ${a}`;throw t.error(e),new Error(e)}const o=new URL(`${a}${n}`);return{method:"POST",url:o.href,headers:{Host:o.hostname,"Content-Length":"0"}}},transformResponse:()=>Promise.resolve(!0),abortOnTimeout:!1});var g=n(876934),h=n(625540);class y{constructor(e,t,n,i,a,o,r,s,l,c,d,u,m){this.coreSettings=t,this.logsCollectorService=n,this.authenticationService=i,this.platformService=a,this.discover=o,this.host=r,this.hostCommunicationService=s,this.brbServiceApi=l,this.i18n=c,this.activeWindowsService=d,this.authenticationUser=u,this.apolloClient=m,this.defaultUploadDesktopLogsTimeoutMs=2e4,this.logger=e.newLogger("BrbServiceTasks","services-io-brb")}async getSystemInfo(){const e=new Map;let t;e.set("TimeStamp",(new Date).toISOString()),this.logger.debug("... starting getSystemInfo() brb");try{t=await this.authenticationService.getUser()}catch(e){this.logger.error("Failed to fetch user:",e)}(0,s.kK)(e,t,this.coreSettings,this.platformService,this.i18n);const{enableMTMA:n}=this.coreSettings.get(i.J.Core);n&&await(0,s.se)(e,this.authenticationService),await(0,s.qT)(e,this.host,this.logger),await(0,s.K8)(e,this.platformService,this.coreSettings,this.logger),await(0,s.c)(e,this.hostCommunicationService,this.logger),await(0,s.Rz)(e,this.hostCommunicationService,this.logger),await(0,s.qg)(e,this.coreSettings,this.logger),(0,s.pd)(e,this.coreSettings,this.logger);let a=new Map;try{a=await this.logsCollectorService.getSystemInfo()||new Map}catch(e){this.logger.error("Failed to fetch system info from logs collector service:",e)}return new Map([...Array.from(e.entries()),...Array.from(a.entries())])}async createBrbItem(e,t){let n;try{const i=await this.discover.validateSkypeToken();n=await this.brbServiceApi.createBrbItem(i,e,t)}catch(e){return this.logger.error("Failed creating BRB item:",e),null}return n}async extendBrbReports(e,t,n){let i;try{const a=await this.discover.validateSkypeToken();i=await this.brbServiceApi.extendBrbReports(e,a,t,n)}catch(e){return this.logger.error("Failed extending BRB report"),null}return i}async uploadWebLogsFiles(e,t){const n=new Map,{enableMTMA:o}=this.coreSettings.get(i.J.Core),{maxBRBLogsCountInLogFile:r}=this.coreSettings.get(i.J.Diagnostics),l=async i=>{const o=i.content instanceof Blob?i.content.size:new Blob([i.content]).size,r=`File name: ${i.fileName}, size: ${o} bytes, container: ${e.ContainerID}}`;(0,s.rS)(n,i.fileName,s.Dm.Requested,void 0,o);const l=(0,s.Gz)(i.fileName);try{const c=await this.brbServiceApi.uploadLogsFile(e,i),d=c?s.Dm.Success:s.Dm.Failure;return(0,s.rS)(n,i.fileName,d,d?void 0:s.wx.ApiFailure,o),t?.mark(a.ck.UploadWebLogsFiles,{reason:r,size:o,context:l},d?"success":"failure"),c}catch(e){return this.logger.error(`Failed to upload logs file - ${i.fileName} - error:`,e),(0,s.rS)(n,i.fileName,s.Dm.Failure,e.toString(),o),t?.mark(a.ck.UploadWebLogsFiles,{reason:r,size:o,context:l},"failure"),!1}};try{o&&this.authenticationUser?.id?await this.logsCollectorService.callOnUserLogsFiles([this.authenticationUser.id],l,!1,!1,r||void 0):await this.logsCollectorService.callOnLogsFiles(l,!1,!1,r||void 0)}catch(e){return this.logger.error("Failed when calling upload on all logs files:",e),n}return n}async uploadDesktopLogsFiles(e,t,n){const o="Desktop-Logs-and-Screenshots",r=new Map,l=await this.hostCommunicationService.loadModule("brb");if(!l)return this.logger.log("uploadDesktopLogsFiles(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),r;let c;const{enableMTMA:d}=this.coreSettings.get(i.J.Core);if(d&&this.apolloClient&&this.activeWindowsService){const e=this.authenticationUser?.id,n=this.activeWindowsService.enableDecoupleCommandingFromApollo?this.activeWindowsService.getActiveWindows():await(0,h.XD)(this.apolloClient),i=[];n.forEach((t=>{t.userContextId===e&&i.push(t.id)})),c=t?.filter((e=>i.includes(e)))}else c=t;if(!l.uploadDesktopLogs)return this.logger.error("uploadDesktopLogs not available on brb module."),r;const u={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature},screenshotIds:c},{uploadDesktopLogsTimeoutMs:m}=this.coreSettings.get(i.J.Brb);try{this.logger.log(`uploadDesktopLogsFiles(): upload desktop logs and screenshots with timer to container: ${e.ContainerID}`);const t=m??this.defaultUploadDesktopLogsTimeoutMs,i=await(0,g.E)(l.uploadDesktopLogs(u),t,`uploadDesktopLogs timed out. Ran for ${t} ms.`),c=!!i?.status;return(0,s.rS)(r,o,c?s.Dm.Success:s.Dm.Failure,c?void 0:s.wx.ApiFailure),n?.mark(a.ck.UploadDesktopLogsFiles,c?void 0:{reason:`${s.wx.ApiFailure}`},c?"success":"failure"),r}catch(e){this.logger.error("Failed to upload desktop logs files. Error:",e);const t=(0,g.T)(e)?s.wx.TimedOut:s.wx.Unknown;return(0,s.rS)(r,o,s.Dm.Failure,t),n?.mark(a.ck.UploadDesktopLogsFiles,{reason:t},"failure"),r}}async uploadHeapSnapshotFiles(e,t){const n="Heap-Snapshot",i=new Map,o=await this.hostCommunicationService.loadModule("brb");if(!o)return this.logger.log("uploadHeapSnapshotFiles(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),i;if(!o.uploadHeapSnapshot)return this.logger.error("uploadHeapSnapshot not available on brb module."),i;const r={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature}};try{const e=await o.uploadHeapSnapshot(r),l=!!e?.status;return(0,s.rS)(i,n,l?s.Dm.Success:s.Dm.Failure,l?void 0:s.wx.ApiFailure),t?.mark(a.ck.UploadHeapSnapshotFiles,l?void 0:{reason:`${s.wx.ApiFailure}`},l?"success":"failure"),i}catch(e){this.logger.error("Failed to upload heapsnapshot files. Error:",e),this.logger.errorToTelemetry?.("Failed to upload heap snapshot file","brb");const o=(0,s.rS)(i,n,s.Dm.Failure,e.toString());return t?.mark(a.ck.UploadHeapSnapshotFiles,{reason:o},"failure"),i}}async uploadMemoryTracingFile(e,t){const n="Memory-Tracing",i=new Map,o=await this.hostCommunicationService.loadModule("brb");if(!o)return this.logger.log("uploadMemoryTracingFile(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out."),i;if(!o.uploadMemoryTracing)return this.logger.error("uploadMemoryTracing not available on brb module."),i;const r={azureBlobStorageInfo:{sharedAccessSignature:e.SharedAccessSignature}};try{const e=await o.uploadMemoryTracing(r),l=!!e?.status;return(0,s.rS)(i,n,l?s.Dm.Success:s.Dm.Failure,l?void 0:s.wx.ApiFailure),t?.mark(a.ck.UploadMemoryTracingFile,l?void 0:{reason:`${s.wx.ApiFailure}`},l?"success":"failure"),i}catch(e){this.logger.error("Failed to upload memory tracing file. Error:",e),this.logger.errorToTelemetry?.("Failed to upload memory tracing file","brb");const o=(0,s.rS)(i,n,s.Dm.Failure,e.toString());return t?.mark(a.ck.UploadMemoryTracingFile,{reason:o},"failure"),i}}async releaseBrbItem(e){let t;try{t=await this.brbServiceApi.releaseBrbItem(e)}catch(e){return this.logger.error("Failed to release the BRB item - error:",e),!1}return t}async uploadFileUploadSummary(e,t,n){const i=(0,s.D7)(t);try{const t=await this.brbServiceApi.uploadLogsFile(e,{fileName:"brb-file-upload-summary.txt",content:i.content,isPiiFree:!0});return n?.mark(a.ck.UploadFileUploadSummary),i.summaryFileUploaded=t,i}catch(e){const t=e.toString().includes("TimedOut")?s.wx.TimedOut:s.wx.Unknown;return n?.mark(a.ck.UploadFileUploadSummary,{reason:t},"failure"),i.summaryFileUploaded=!1,i}}}class v{constructor(e,t,n,i,a,o,r,s,l,d,u,m,p,g){this.coreSettings=t,this.hostCommunicationService=s,this.scenarioFactory=d,this.defaultDisclaimer='NOTE: Data sent in feedback submissions will be "Support Data" under your agreement for Microsoft 365, including any information that would otherwise be considered "Customer Data" or "Personal Data". Please do not submit feedback that may include data you do not wish to provide to Microsoft as "Support Data".',this.logger=e.newLogger("BrbService","services-io-brb");const h=l.createApi(c);this.brbServiceTasks=new y(e,t,n,i,a,o,r,s,h,u,m,p,g)}registerRootToolsManager(e){try{this.rtm=e}catch(t){this.logger.error("could not get getRootToolsManager",e)}}async getSystemInfo(){let e=new Map;try{e=await this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.error("Failed to fetch system info:",e)}return Promise.resolve(e)}async getBrbFormData(){const{categories:e,disclaimer:t}=this.coreSettings.get(i.J.Brb),n=[];return e?.forEach((e=>{e&&n.push({id:e.id,name:e.name})})),this.logger.logNoPii?.("Returning data for BRB form",n),{disclaimer:t||this.defaultDisclaimer,categories:n}}async getBrbScreenshots(e){const t=await this.hostCommunicationService.loadModule("brb");if(!t)return void this.logger.logNoPii?.("getBrbScreenshots(): HostComms is unable to load brb module. We are running on Web or Teams 1.0. Bailing out.");this.logger.logNoPii?.("Requesting screenshots from host");const n=await(t.getScreenshotThumbnails?.({width:e.width,height:e.height||void 0}));return this.logger.logNoPii?.("Returning host-provided screenshots"),n?.screenshots}async createBrbItem(e,t){const{enableBrb:n}=this.coreSettings.get(i.J.Brb);if(!n)return void this.logger.logNoPii?.("Create BRB item not enabled - setting:",n);const o=this.scenarioFactory.newScenario(a.RG.BrbCreateItem,{timeoutMs:36e5});o.appendEventData({isAutoBrb:t}),o.mark(a.ck.BrbSubmitted);const r=await this.processCreateBrbRequest(e,!!t);if("error"!==r.kind)return o.stop(),{containerId:r.response.ContainerID};o.fail({reason:r.reason})}async extendBrbReports(e,t,n){const{enableBrb:o}=this.coreSettings.get(i.J.Brb),r=this.scenarioFactory.newScenario(a.RG.BrbExtendReports);if(r.appendEventData({isAutoBrb:n}),!o){const e="Current account is not internal ring account";return this.logger.errorNoPii?.(e),r.cancel({reason:e}),!1}const s=await this.processExtendBrbReportsRequest(e,t.containerId);return s?r.stop():r.fail(),this.logger.logNoPii?.("Finished extending brb report"),s}async processExtendBrbReportsRequest(e,t){let n=new Map;try{n=await this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.errorNoPii?.("Failed to fetch system info")}let i=null;try{i=await this.brbServiceTasks.extendBrbReports(e,t,n)}catch(e){return this.logger.errorNoPii?.("Failed to Extend BRB Reports"),!1}if(!i)return this.logger.error(`Request to Extend BRB Reports failed to receive response body: ${i}`),!1;let a=!1;try{a=await this.uploadFilesToBrbItem(i,e.includeHeapSnapshot,e.screenshotIds?[...e.screenshotIds]:void 0),a||this.logger.error(`Failed to upload all logs files to first party container: ${t}`)}catch(e){this.logger.error(`Error when uploading all logs files to first party container: ${t}`)}return!0}async processCreateBrbRequest(e,t){let n=new Map;try{n=await this.brbServiceTasks.getSystemInfo()}catch(e){this.logger.error("Failed to fetch system info:",e)}n.set(s.bD.IsAutoBrb,t?"true":"");let a=null;try{a=await this.brbServiceTasks.createBrbItem(e,n)}catch(e){return this.logger.error("Failed to create BRB item:",e),{kind:"error",reason:"Failed to create BRB item"}}if(!a)return this.logger.error(`Request to create BRB item failed to receive response body: ${a}`),{kind:"error",reason:"Request to create BRB item failed to receive response body"};this.triggerRemoteEvent(e.categoryId,a.ContainerID);let o=!1;try{o=await this.uploadFilesToBrbItem(a,e.includeHeapSnapshot,e.screenshotIds?[...e.screenshotIds]:void 0)}catch(e){this.logger.error("Failed to upload all logs files:",e)}o||this.logger.errorToTelemetry?.("Failed to upload all logs files - attempting to complete BRB item","brb");const{enableBrbReleaseLogsContainer:r}=this.coreSettings.get(i.J.Brb);if(r){let e=!1;try{this.logger.logNoPii?.("Start releasing Brb item."),e=await this.brbServiceTasks.releaseBrbItem(a.ContainerID)}catch(e){return this.logger.error("Failed to release BRB item:",e),{kind:"error",reason:"Failed to release BRB item"}}if(!e){const e="Failed to release the BRB item";return this.logger.errorNoPii?.(e),{kind:"error",reason:e}}}else this.logger.logNoPii?.("Skip releasing Brb item.");return{kind:"response",response:a}}async uploadFilesToBrbItem(e,t=!1,n){const i=this.scenarioFactory.newScenario(a.RG.BrbUploadLogs),o=[];let r=new Map;t&&(r=await this.brbServiceTasks.uploadHeapSnapshotFiles(e,i),o.push(this.brbServiceTasks.uploadMemoryTracingFile(e,i))),o.push(this.brbServiceTasks.uploadWebLogsFiles(e,i)),o.push(this.brbServiceTasks.uploadDesktopLogsFiles(e,n,i));(await Promise.all(o)).forEach((e=>{e.forEach(((e,t)=>{r.set(t,e)}))}));const s=await this.brbServiceTasks.uploadFileUploadSummary(e,r,i),l=s.allLogFilesUploaded&&s.summaryFileUploaded;return l?i.stop():i.fail(),l}isRemoteBrbCategory(e){return["1","2","3","49","50","76","11"].indexOf(e)>=0}triggerRemoteEvent(e,t,n){if(!this.rtm)return this.logger.warn("RootToolsManager undefined"),!1;const{enableRemoteBrbEvent:a}=this.coreSettings.get(i.J.Brb,["enableRemoteBrbEvent"]);if(!a||!this.isRemoteBrbCategory(e))return this.logger.warn("Did not trigger remote event"),!1;try{return this.rtm.sendBRBEvent({uploadId:t}),this.logger.log("Triggered remote event for container ",t),!0}catch(e){return this.logger.error("Failed to trigger remote event"),!1}}}},420250:(e,t,n)=>{"use strict";n.d(t,{V:()=>i,N:()=>a});const i="broadcast-updated-event",a={streamUpdateHubEvent:"streamUpdate",captionsUpdate:"captionsUpdate",subscribeToStreamUpdatesHubEvent:"subscribeToStreamUpdates",notifyStreamSwitch:"notifyStreamSwitch",transcriptionStateUpdate:"transcriptionStateUpdate"}},603885:(e,t,n)=>{"use strict";var i;n.d(t,{N:()=>i}),function(e){e.UNIFIED_CALENDAR_SYNCING="UNIFIED_CALENDAR_SYNCING",e.UNIFIED_CALENDAR_SYNC_FAILED="UNIFIED_CALENDAR_SYNC_FAILED",e.UNIFIED_CALENDAR_UPTO_DATE="UNIFIED_CALENDAR_UPTO_DATE",e.EMPTY="EMPTY"}(i||(i={}))},816948:(e,t,n)=>{"use strict";var i,a;n.d(t,{mN:()=>i,GB:()=>a,yR:()=>o,oo:()=>r,Q0:()=>s,ex:()=>l,PR:()=>c,gh:()=>d,LC:()=>u,Ky:()=>m,ji:()=>p}),function(e){e.InProgress="InProgress",e.Success="Success",e.Error="Error",e.PartialSuccess="PartialSuccess"}(i||(i={})),function(e){e.StatusEntity="Microsoft.SkypeSpaces.MiddleTier.Models.StatusEntity"}(a||(a={}));const o="x-serverrequestid",r="call_blocking_list_refreshed",s=36e5,l="https://teams.microsoft.com/";var c;!function(e){e.getBlockedContacts="getBlockedContacts",e.postBlockedContacts="postBlockedContacts"}(c||(c={}));const d="api/",u=[{id:c.getBlockedContacts,path:"mt/part/msft/beta/userSettings/blocklist"},{id:c.postBlockedContacts,path:"mt/part/msft/beta/userSettings/blocklist/manage"}],m="https://teams.live.com/";var p;!function(e){e.Add="Add",e.Remove="Remove"}(p||(p={}))},979242:(e,t,n)=>{"use strict";n.d(t,{H:()=>i});const i={On:"On",Off:"Off",BannerAndFeed:"BannerAndFeed",OnlyFeed:"OnlyFeed",OnlyBanner:"OnlyBanner",All:"All",CallMentionChats:"CallMentionChats",Immediately:"Immediately",Every10Mins:"Every10Mins",Hourly:"Hourly",EveryEightHours:"EveryEightHours",Daily:"Daily",Never:"Never",AllActivity:"AllActivity",MyAtMentions:"MyAtMentions",Custom:"Custom",Feed:"Feed",Ring:"Ring",Banner:"Banner",Mute:"Mute",MuteChat:"MuteChat",Unmute:"Unmute",MuteUntilJoin:"MuteUntilJoin",Purple:"Purple",Native:"Native",Default:"Default",DefaultUrgent:"DefaultUrgent",Soft:"Soft",Softest:"Softest",Loud:"Loud",Loudest:"Loudest",MoreUrgent:"MoreUrgent",VeryUrgent:"VeryUrgent",Alarm:"Alarm"}},832554:(e,t,n)=>{"use strict";n.d(t,{HI:()=>i,LC:()=>a,aO:()=>o,YK:()=>r,UQ:()=>s});const i={addMembersToThread:"addMembersToThread",createThread:"createThread",deleteConversation:"deleteConversation",locationSharingQuery:"locationSharingQuery",removeMemberFromThread:"removeMemberFromThread",reportUser:"reportUser",updateThreadProperties:"updateThreadProperties"},a={addMembersToThread:"beta/groups/{threadId}/members",createThread:"beta/groups/create",deleteConversation:"beta/groups/{threadId}/deleteChat",locationSharingQuery:"https://teams.live.com/api/location/prod",removeMemberFromThread:"beta/groups/{threadId}/members/{userMri}",reportUser:"/beta/users/{userMri}/report",updateThreadProperties:"beta/groups/{threadId}/properties"},o="ConsumerGroupsService",r="{threadId}",s="{userMri}"},583545:(e,t,n)=>{"use strict";n.d(t,{jP:()=>h,O5:()=>f,Nc:()=>S});var i=n(683184),a=n(945151),o=n(741679),r=n(750082),s=n(832554),l=n(663336);const c="v1/threads/{threadId}/members",d="v1/threads",u="v1/threads/{threadId}",m="v1/threads/{threadId}/members/{userMri}",p="/v1/users/{userMri}/report",g="v1/threads/{threadId}/properties",h="https://groupssvc.fl.teams.microsoft.com/teams.readwrite";function y(e){return Promise.resolve({constructRequest:e,rejectHttpError:!0})}const v=(e,t,n)=>{const i=(0,r.h)(t,n),a=(0,o.g)(y,i);return{addMembersToThread:a((0,l.Hd)(e.groupsServiceAddToRosterEndpoint||c,e.groupsServiceThreadIdParameterToken||s.YK)),createThread:a((0,l._)(e.groupsServiceCreateGroupEndpoint||d)).withTransform(l.jI),deleteConversation:a((0,l.uz)(e.groupsServiceDeleteConversationEndpoint||u,e.groupsServiceThreadIdParameterToken||s.YK)),locationSharingQuery:a(l.Jo),removeMemberFromThread:a((0,l.Jr)(e.groupsServiceRemoveFromRosterEndpoint||m,e.groupsServiceThreadIdParameterToken||s.YK,e.groupsServiceUserMriParameterToken||s.UQ)),reportUser:a((0,l.zR)(e.reportUserEndpoint||p,e.groupsServiceUserMriParameterToken||s.UQ)).withTransform(l.Vo),updateConversationTopic:a((0,l.lh)(e.groupsServiceUpdatePropertiesEndpoint||g,e.groupsServiceThreadIdParameterToken||s.YK))}},f=e=>{const{coreSettings:t,platformService:n,authenticationResources:o,authenticationService:r,config:s}=e,l=t.get(i.J.ConsumerGroups);return{serviceName:a.E.GroupsServiceV2,baseUrlPromise:()=>e.discover.regionGtm("groupsServiceV2"),authResource:S(r,o,h),models:v(l,n,s)}},S=(e,t,n)=>i=>e.getUser().then((()=>{const a=t.composeAuthResources((t=>e.authorizeRequest(t,n)),t.skypeXTokenAuthResource);return a(i)}))},663336:(e,t,n)=>{"use strict";n.d(t,{Hd:()=>s,_:()=>l,Jr:()=>c,lh:()=>d,uz:()=>u,Jo:()=>m,zR:()=>p,jI:()=>g,Vo:()=>h});var i=n(945151),a=n(900366),o=n(309501),r=n(832554);const s=(e,t)=>(n,a,s=!0)=>{const l=e.replace(t,encodeURIComponent(n)),c=s?{members:a.map((e=>({id:e.id,role:o.nL.Admin,shareHistoryTime:0})))}:{members:a.map((e=>({id:e.id,role:e.role,shareHistoryTime:0})))};return{url:l,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(c),serviceName:i.E.GroupsServiceV2,apiName:r.HI.addMembersToThread}},l=e=>(t,n,a,s)=>{const l="true"===n[o.Q5.IsStickyThread],c=""===a,d=""===s,u={members:t.map((e=>({id:e.id,role:l?o.nL.User:o.nL.Admin}))),properties:n,inviterMri:c?void 0:a,inviteLink:d?void 0:s};return{url:e,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(u),serviceName:i.E.GroupsServiceV2,apiName:r.HI.createThread}},c=(e,t,n)=>(a,o)=>({url:e.replace(t,encodeURIComponent(a)).replace(n,encodeURIComponent(o)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:i.E.GroupsServiceV2,apiName:r.HI.removeMemberFromThread}),d=(e,t)=>(n,a)=>{const o={topic:a};return{url:e.replace(t,encodeURIComponent(n)),method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(o),serviceName:i.E.GroupsServiceV2,apiName:r.HI.updateThreadProperties}},u=(e,t)=>n=>({url:e.replace(t,encodeURIComponent(n)),method:"DELETE",headers:{"content-type":"application/json"},serviceName:i.E.GroupsServiceV2,apiName:r.HI.deleteConversation}),m=(e,t)=>{const n={Query:e};return{url:`${t}/graphql`,method:"POST",headers:{"content-type":"application/json;charset=utf-8"},body:JSON.stringify(n),serviceName:i.E.MiddleTier,apiName:r.HI.locationSharingQuery}},p=(e,t)=>(n,a)=>({url:e.replace(t,encodeURIComponent(n)),method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(a),serviceName:i.E.GroupsServiceV2,apiName:r.HI.reportUser});async function g(e){const{status:t,headers:{location:n},body:i}=e;if(void 0===n)throw new Error("location undefined");return{status:t,threadId:(0,a.F)(n),responseBody:i}}async function h(e){const{body:t,status:n}=e;return{status:n,responseBody:t}}},407271:(e,t,n)=>{"use strict";n.d(t,{Ut:()=>i,$O:()=>o,rv:()=>r,bw:()=>s,X9:()=>l,i5:()=>c,kA:()=>d,rg:()=>u,Ms:()=>m,h:()=>p,EQ:()=>g});var i,a=n(447697);!function(e){e.feed="TeamsFeed",e.syncFeed="TeamsFeedSync"}(i||(i={}));const o={defaultSection:"TeamsFeed",defaultTimeSortedSection:"TeamsFeedTimeSorted",defaultItemsToFetch:3,defaultLoadMoreItemsCount:5,defaultItemsToCompare:3,defaultReadSignalMinDwellTime:5e3,defaultCDLLoadMoreItemsCount:5,defaultDataSyncIntervalTime:3e5,defaultDiscoverTriagingTime:3e5,defaultServerCacheRetentionTimeInHrsSinceFirstCall:72,defaultDiscoverPollingInterval:3e5,defaultMinPageSizeForLoadMoreAPI:1,optimizeHydrationConfig:{durationToAllowBackgroundHydration:864e5,defaultLastVisitedSurface:a.ai.channel,enableHydrationOnTeamsClick:!1},lastVisitedSection:"LastVisited"},r=3,s=1e3,l=6e4,c=2,d=["408","409","429","504"],u={maxRetryCount:r,maxDelayTimeMs:l,exponentialDelayFactor:c,retryableErrorCodes:d,initialDelayMs:s};var m,p,g;!function(e){e.api="api",e.indexDB="indexdb",e.cdlCache="cdlcache",e.apolloCache="apollocache",e.unknown="unknown"}(m||(m={})),function(e){e.polling="polling",e.startup="startup",e.switch="switch",e.scroll="scroll",e.removeContent="removeContent",e.retry="retry",e.newUpdatesPoll="newUpdatesPoll",e.optimizer="optimizer",e.startupSync="startupSync",e.pollingSync="pollingSync",e.teamsClick="teamsClick"}(p||(p={})),function(e){e.emptyApiResponse="EMPTY_API_RESPONSE",e.validationFailed="VALIDATION_FAILED",e.hydrationFailed="HYDRATION_FAILED"}(g||(g={}))},447697:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{X:()=>i,fT:()=>a,ai:()=>o}),function(e){e.SyncEngine="syncEngine",e.UserPreferenceChanged="userPreferenceChanged",e.UnknownCallInitiator="unknownCallInitiator",e.Optimizer="optimizer",e.teamsClick="teamsClick"}(i||(i={})),function(e){e.SyncEngine="syncEngine",e.StartPollMutation="startPollMutation"}(a||(a={})),function(e){e.discover="discover",e.channel="channel"}(o||(o={}))},452772:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{Hw:()=>i,F4:()=>a,cL:()=>o}),function(e){e[e.Valid=0]="Valid",e[e.Expired=1]="Expired",e[e.NoData=2]="NoData",e[e.NoCache=3]="NoCache"}(i||(i={})),function(e){e.Filters="Filters",e.None="None",e.ConsumerKey="ConsumerKey"}(a||(a={})),function(e){e.OnExpiry="OnExpiry",e.Never="Never"}(o||(o={}))},752709:(e,t,n)=>{"use strict";var i;n.d(t,{m:()=>i}),function(e){e[e.Success=0]="Success",e[e.Success_NoChanges=1]="Success_NoChanges",e[e.Abandoned_ClientVeryActive=2]="Abandoned_ClientVeryActive",e[e.Abandoned_NoNetwork=3]="Abandoned_NoNetwork",e[e.Error_TimedOut=4]="Error_TimedOut",e[e.Error_TransformFailed=5]="Error_TransformFailed",e[e.Error_BrowserError=6]="Error_BrowserError",e[e.Error_Unknown=7]="Error_Unknown",e[e.NotStarted=8]="NotStarted"}(i||(i={}))},609930:(e,t,n)=>{"use strict";var i;n.d(t,{z:()=>i}),function(e){e[e.Manual=0]="Manual",e[e.WhenExpired=1]="WhenExpired"}(i||(i={}))},346584:(e,t,n)=>{"use strict";n.d(t,{bn:()=>w,fh:()=>T,un:()=>b});var i=n(933609),a=n(316877),o=n(609930),r=n(752709),s=n(452772);const l="c72ea287-ed77-4fa6-a480-3712406c367e";class c{constructor(e,t,n){this.serviceName=e,this.ecsParameters=n,this.logger=t.newLogger(`EcsClient_${this.serviceName}`,"services-io-ecs")}async initializeCache(e){this.cache={storage:e.storage,partitionOptions:{strategy:e.partitionBy||s.F4.None,excludeFilters:e.excludeFiltersFromPartition||[],consumerKey:e.consumerKey},invalidate:e.invalidateCache||s.cL.Never};const{configKey:t,metadataKey:n}=this.generateCacheKeys();try{const e=await this.cache.storage.getItem(t),i=await this.cache.storage.getItem(n);if(e){const n=JSON.parse(e),a=i?JSON.parse(i):{requestStatus:r.m.Success};this.data={ecsConfiguration:n,...a},this.logger.log(`Cache successfully loaded: ${t}`)}else this.logger.log(`No cached data found: ${t}`)}catch(e){this.logger.log(`Error while loading from cache '${t}', error:`,e)}}get(){return this.cache?.invalidate===s.cL.OnExpiry&&this.cacheState===s.Hw.Expired&&(this.logger.log("Cache expired, clearing cache"),this.clearCache()),this.data}get expiration(){const e=this.data?.headers?.Expires;return e&&new Date(e)}get cacheState(){return void 0===this.cache?s.Hw.NoCache:this.data?this.expiration&&this.expiration.valueOf()>Date.now()?s.Hw.Valid:s.Hw.Expired:s.Hw.NoData}getDiagnosticInfo(){return{serviceName:this.serviceName,ecsParameters:this.ecsParameters,expirationTime:this.expiration}}generateCacheKeys(){if(void 0===this.cache)throw new Error("Cannot generate keys until after initializeCache() is called");const{strategy:e,excludeFilters:t,consumerKey:n}=this.cache.partitionOptions;let i=`ecs.cache.${this.serviceName}`;switch(e){case s.F4.ConsumerKey:if(!n)throw new Error("Cannot generate key using PartitionStrategy.ConsumerKey if consumerKey is not provided");i=`${n}`;break;case s.F4.Filters:{if(!this.ecsParameters)throw new Error("Cannot generate key using PartitionStrategy.Filters if ecsParameters is not set during instantiation");const e=this.ecsParameters.filters||{};t.length&&t.forEach((t=>{e[t]&&delete e[t]}));const n=Object.values(e).filter((e=>void 0!==e||null!==e));n.length&&(i+=`.${n.join(".")}`);break}case s.F4.None:}const a=`${i}.metadata`;return this.logger.debug(`Storage Keys calculated: ${i}, ${a}`),{configKey:i,metadataKey:a}}async clearCache(){if(this.data=void 0,void 0===this.cache)return;const{configKey:e,metadataKey:t}=this.generateCacheKeys();await this.cache.storage.removeItem(e),await this.cache.storage.removeItem(t),this.logger.log(`Cache for '${e}' and ${t} cleared.`)}}var d=n(37718),u=n(803238);const m="1.2.0",p="ECSCanary=1",g="@1js/ecs-client",h=(e,t,n,i)=>Promise.resolve({constructRequest:(t,a,o)=>({apiName:"getConfiguration",url:e,method:"GET",headers:{...n,...i,...o?{"If-None-Match":o}:void 0},correlationId:t}),customTelemetry:v,transformResponse:f(t),allowedResponses:[d.qb.OK,d.qb.NOT_MODIFIED,d.qb.CREATED,d.qb.NO_CONTENT]});function y(e,t,n){const i=function(e){return`${e.domain}/config/v1/${e.client}/`}(e),a=function(e){const t=[];if((0,u.forOwn)(e.filters,((e,n)=>{e&&(!(0,u.isArray)(e)||e.length>0)&&t.push(`${n}=${e}`)})),e.agents){const n=e.agents.join(",");t.push(`agents=${n}`)}return t.push(p),`${e.version}?${t.join("&")}`}(e),o=function(e){return{"X-ECS-Client-Last-Telemetry-Events":`ecs_client_library_name=${g},ecs_client_app_name=${e},ecs_client_version=${m}`}}(t);return{endpointUrl:`${i}${a}`,endpointModels:()=>({baseUrl:i,serviceName:t,models:{getConfigurationAsync:h(a,n,o,e.additionalHeaders)}})}}function v(e,t,n){return JSON.stringify({correlationId:e,serviceName:t,eTag:n,initialFetch:void 0===n})}const f=e=>async t=>{switch(e.debug(`Response headers: ${JSON.stringify(t.headers)}`),t.status){case d.qb.OK:{const n=await t.body.json(),i=t.headers.expires??n.Headers.Expires,a=t.headers.etag??n.Headers.ETag,o=n.Headers.CountryCode;return{requestStatus:r.m.Success,ecsConfiguration:n,headers:S(e,i,a,o)}}case d.qb.NOT_MODIFIED:case d.qb.CREATED:case d.qb.NO_CONTENT:return{requestStatus:r.m.Success_NoChanges,headers:S(e,t.headers.expires,t.headers.etag)};default:throw new Error(`Response status ${t.status} unexpectedly allowed`)}},S=(e,t,n,i)=>{let a=Date.parse(t);if(isNaN(a)){const e=t.match(/\d+/g);if(e&&1===e.length&&(a=Number.parseInt(t,10)),isNaN(a))throw new Error(`Invalid or missing expiration date: '${t}'`)}if(!n)throw new Error("Missing etag value");return i||e.warn("Missing country code"),{ETag:n,Expires:new Date(a),CountryCode:i}};class k extends c{constructor(e,t,n,i,a,r,s){super(e,n,t),this.ecsParameters=t,this.endpointsManager=i,this.fetchPrecheck=a,this.transformData=r,this.fetchMode=o.z.Manual,this.clientType="EcsClient";const{endpointUrl:l,endpointModels:c}=y(this.ecsParameters,this.serviceName,this.logger);this.fetchUrl=l,this.ecsApi=this.endpointsManager.createApi(c),s&&(this.data=s.data,this.cache=s.cache)}async fetch(){const e=void 0===this.eTag,t=(0,a.v4)();this.lastAttemptedFetch=new Date,this.logger.log(`Getting ECS configuration from ${this.fetchUrl}. correlationId=${t}, isInitialFetch=${e}`);const n=this.fetchPrecheck?.()||!0;if(!0!==n)return this.scheduleNextConfigurationFetch(),this.logger.debug(`${n.errorMessage}. correlationId=${t}`),{requestStatus:n.requestStatus};try{const n=await this.ecsApi.getConfigurationAsync(t,this.serviceName,this.eTag);this.logger.log(`ECS configuration fetch complete. status=${r.m[n.requestStatus]}, correlationId=${t}, isInitialFetch=${e}`),this.data=this.onSuccess(n,t),this.configIds=n.ecsConfiguration?.ConfigIDs,this.updateCache()}catch(e){return this.onError(e,t)}return this.scheduleNextConfigurationFetch(),this.data}startFetchSchedule(e,t){this.host=e,this.callbackFunction=t,this.fetchMode=o.z.WhenExpired,this.logger.debug("Starting ECS configuration fetch schedule in WhenExpired mode."),this.scheduleNextConfigurationFetch()}updateParameters(e){const t=this.fetchUrl,{endpointUrl:n,endpointModels:i}=y(e,this.serviceName,this.logger);return this.fetchUrl=n,this.ecsApi=this.endpointsManager.createApi(i),this.ecsParameters=e,t!==this.fetchUrl}dispose(){this.fetchMode=o.z.Manual,this.clearConfigurationFetchSchedule()}getDiagnosticInfo(){return{serviceName:this.serviceName,configIds:this.configIds,ecsParameters:this.ecsParameters,etag:this.eTag,fetchUrl:this.fetchUrl,lastAttemptedFetch:this.lastAttemptedFetch,lastSuccessfulFetch:this.lastSuccessfulFetch,nextScheduledFetch:this.nextScheduledFetch,fetchMode:this.fetchMode,expirationTime:this.expiration}}get eTag(){return this.data?.headers?.ETag}async updateCache(){if(void 0===this.cache)return;const{storage:e}=this.cache,{configKey:t,metadataKey:n}=this.generateCacheKeys();if(!this.data?.ecsConfiguration||0===Object.keys(this.data.ecsConfiguration).length)return void this.logger.log(`updateCache() received empty data. Cache State: ${s.Hw[this.cacheState]} (Storage key: ${t})`);const{ecsConfiguration:i,...a}=this.data;await e.setItem(t,JSON.stringify(i)),await e.setItem(n,JSON.stringify(a)),this.logger.log(`Cache '${t}' updated.`)}onSuccess(e,t){let n;switch(e.requestStatus){case r.m.Success:if(!e.ecsConfiguration)throw new Error("ECS configuration is unexpectedly undefined on a successful response");if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");if(!this.ecsParameters.disableSentinelConfigValidation&&!this.validateSentinelConfig(e.ecsConfiguration))throw new Error("Sentinel Config is missing from response");n=this.transformData?.(e)||e;break;case r.m.Success_NoChanges:if(!e.headers)throw new Error("Headers object is unexpectedly undefined on a successful response");n={...this.data,requestStatus:e.requestStatus,headers:e.headers},this.data=n,this.updateCache(),this.logger.debug(`ECS configuration is unchanged. eTag=${this.eTag}, correlationId=${t}`);break;default:throw new Error(`Received unexpected request status of ${r.m[e.requestStatus]}`)}return this.lastSuccessfulFetch=this.lastAttemptedFetch,n}onError(e,t){const n=this.processErrorText(e,"unknown error");let a=r.m.Error_Unknown;switch(e.reason){case i.A.TimedOut:a=r.m.Error_TimedOut;break;case i.A.TransformFailed:a=r.m.Error_TransformFailed;break;default:a=e?.reason===i.A.RejectHttpError&&void 0===e?.serverResponse?.status?r.m.Error_BrowserError:r.m.Error_Unknown}return this.logger.error(`Fetching ECS configuration failed. error=${e}, innerExceptionMessage=${e.innerException?.message} correlationId=${t}`),{requestStatus:a,errorMessage:n}}processErrorText(e,t){let n=t;return e&&(n=Object.keys(e)?.length>0?JSON.stringify(e):e.message,e.innerException&&(n+=` innerExceptionMessage: ${e.innerException.message}`)),n}validateSentinelConfig(e){return e[l]?(this.logger.log("ECS Sentinel Config is present in ECS response at the root level"),!0):e.ECS?.[l]?(this.logger.log("ECS Sentinel Config is present in ECS response inside ECS object"),!0):(this.logger.error("ECS Sentinel Config is missing from ECS response"),!1)}clearConfigurationFetchSchedule(){this.setTimeoutHandle&&this.host&&(this.host.clearTimeout(this.setTimeoutHandle),this.setTimeoutHandle=void 0,this.logger.debug("Cleared existing queued configuration fetch"))}scheduleNextConfigurationFetch(){if(this.clearConfigurationFetchSchedule(),this.fetchMode===o.z.Manual)return void this.logger.debug("No need to queue configuration fetch in manual mode, ignoring...");if(!this.host)return void this.logger.error("No host provided, cannot schedule next configuration fetch");const e=this.calculateFetchInterval();this.setTimeoutHandle=this.host.setTimeout((async()=>{const e=await this.fetch();this.callbackFunction&&this.callbackFunction(e)}),e),this.nextScheduledFetch=new Date(Date.now()+e),this.logger.debug(`Next ECS configuration fetch will occur in ${e}ms at ${this.nextScheduledFetch}`)}calculateFetchInterval(){if(this.fetchMode===o.z.Manual)throw new Error(`Calculating fetch interval is not supported when using ${o.z[this.fetchMode]} fetch mode.`);const e=(this.expiration??new Date).valueOf()-Date.now();return e<k.MinimumRefreshIntervalInMilliseconds?(this.logger.warn(`Calculated refresh interval of ${e}ms based on expires header was below the allowed minimum of ${k.MinimumRefreshIntervalInMilliseconds}ms. Minimum value will be used instead.`),k.MinimumRefreshIntervalInMilliseconds):e}}k.MinimumRefreshIntervalInMilliseconds=18e5;class C extends c{constructor(){super(...arguments),this.clientType="LocalEcsClient"}createClient({ecsParameters:e,endpointsManager:t,loggerFactory:n,fetchPrecheck:i,transformData:a}){const o={data:this.data,cache:this.cache};return new k(this.serviceName,e,n,t,i,a,o)}}async function b({serviceName:e,cacheOptions:t,loggerFactory:n}){const i=new C(e,n);return await i.initializeCache(t),i}function w({serviceName:e,ecsParameters:t,loggerFactory:n,endpointsManager:i,fetchPrecheck:a,transformData:o}){return new k(e,t,n,i,a,o)}async function T({serviceName:e,ecsParameters:t,cacheOptions:n,loggerFactory:i,endpointsManager:a,fetchPrecheck:o,transformData:r}){const s=new k(e,t,i,a,o,r);return await s.initializeCache(n),s}},674271:(e,t,n)=>{"use strict";n.d(t,{f5:()=>i,PJ:()=>a,QD:()=>o});const i="most-recent",a="first",o="last"},268632:(e,t,n)=>{"use strict";var i,a,o;n.d(t,{Jv:()=>i,OP:()=>a,cw:()=>o}),function(e){e.NotInstalled="NotInstalled",e.InstalledNotActive="InstalledNotActive",e.InstalledActive="InstalledActive"}(i||(i={})),function(e){e.Teams1="Teams1",e.Teams2="Teams2"}(a||(a={})),function(e){e.DownloadedAndInstalled="DownloadedAndInstalled",e.FailedToDownload="FailedToDownload",e.FailedToInstall="FailedToInstall",e.DownloadPageOpened="DownloadPageOpened"}(o||(o={}))},258867:(e,t,n)=>{"use strict";var i,a,o,r,s,l,c,d,u,m;n.d(t,{tq:()=>i,dt:()=>a,S1:()=>o,A$:()=>r,p6:()=>s,G5:()=>l,oY:()=>d}),function(e){e.toastFromWeb="toastFromWeb",e.toastFromHost="toastFromHost"}(i||(i={})),function(e){e.calls="calls",e.chats="chats",e.toasts="toasts",e.signout="signout",e.extensions="extensions",e.reminders="reminders",e.channels="channels",e.activity="activity",e.campaignnotifications="campaignnotifications",e.communities="communities",e.callingdeeplink="callingdeeplink",e.communitiesevents="communitiesevents",e.settingsstore="settingsstore",e.communitiesjoinrequest="communitiesjoinrequest",e.communitiesmembers="communitiesmembers",e.alerts="alerts"}(a||(a={})),function(e){e.hide="hide",e.show="show"}(o||(o={})),function(e){e.mutate="mutate",e.view="view",e.list="list",e.join="join"}(r||(r={})),function(e){e.success="success",e.critical="critical"}(s||(s={})),function(e){e.start="start",e.quit="quit",e.restart="restart"}(l||(l={})),function(e){e.airgap08="airgap08",e.prod="prod",e.life="life",e.dod="dod",e.gcch="gcch",e.gallatin="gallatin",e.airgap09="airgap09"}(c||(c={})),function(e){e.available="available",e.busy="busy",e.doNotDisturb="doNotDisturb",e.beRightBack="beRightBack",e.away="away",e.offLine="offLine",e.resetAvailability="resetAvailability"}(d||(d={})),function(e){e.Accepted="Accepted",e.Tentative="Tentative",e.Declined="Declined",e.NotResponded="NotResponded"}(u||(u={})),function(e){e.inProc="inProc",e.outOfProc="outOfProc"}(m||(m={}))},24208:(e,t,n)=>{"use strict";var i,a,o,r,s;n.d(t,{$y:()=>i,f8:()=>a}),function(e){e.Locked="Locked",e.Unlocked="Unlocked",e.Unknown="Unknown",e.Resumed="Resumed",e.Suspending="Suspending"}(i||(i={})),function(e){e.Light="Light",e.Dark="Dark",e.Contrast="Contrast",e.OSTheme="OSTheme"}(a||(a={})),function(e){e.Unknown="Unknown",e.Crashed="Crashed",e.LaunchFailed="LaunchFailed",e.OutOfMemory="OutOfMemory",e.Terminated="Terminated",e.Unexpected="Unexpected",e.Unresponsive="Unresponsive"}(o||(o={})),function(e){e.Unknown="Unknown",e.BrowserProcessExited="BrowserProcessExited",e.FrameRenderProcessExited="FrameRenderProcessExited",e.GpuProcessExited="GpuProcessExited",e.MainWindow="MainWindow",e.PpapiPluginProcessExited="PpapiPluginProcessExited",e.PpapiBrokerProcessExited="PpapiBrokerProcessExited",e.RenderProcessExited="RenderProcessExited",e.RenderProcessUnresponsive="RenderProcessUnresponsive",e.SandboxHelperProcessExited="SandboxHelperProcessExited",e.UtilityProcessExited="UtilityProcessExited"}(r||(r={})),function(e){e.Internal="Internal",e.Clone="Clone",e.Extend="Extend",e.External="External"}(s||(s={}))},284669:(e,t,n)=>{"use strict";var i;n.d(t,{t:()=>i}),function(e){e.activity="activity",e.alarm="alarm",e.alert="alert",e.attention="attention",e.busy="busy",e.error="error",e.oofDoNotDisturb="oofDoNotDisturb",e.oofAvailable="oofAvailable",e.oofAway="oofAway",e.oofBusy="oofBusy",e.oofOffline="oofOffline",e.oofUnknown="oofUnknown",e.available="available",e.away="away",e.doNotDisturb="doNotDisturb",e.offline="offline",e.unknown="unknown"}(i||(i={}))},668712:(e,t,n)=>{"use strict";var i,a,o,r,s;n.d(t,{mG:()=>i,lX:()=>a,ZD:()=>o}),function(e){e.DisabledByGroupPolicy="DisabledByGroupPolicy",e.DisabledByManifest="DisabledByManifest",e.DisabledForApplication="DisabledForApplication",e.DisabledForUser="DisabledForUser",e.Enabled="Enabled"}(i||(i={})),function(e){e.AlarmsOnly="AlarmsOnly",e.Off="Off",e.PriorityOnly="PriorityOnly"}(a||(a={})),function(e){e.Unrestricted="Unrestricted",e.PriorityOnly="PriorityOnly",e.AlarmsOnly="AlarmsOnly"}(o||(o={})),function(e){e.UserCancelled="UserCancelled",e.ApplicationHidden="ApplicationHidden",e.TimedOut="TimedOut",e.FocusAssist="FocusAssist"}(r||(r={})),function(e){e.Unknown="Unknown",e.NotificationDisabled="NotificationDisabled",e.NotificationTypeDisabled="NotificationTypeDisabled"}(s||(s={}))},996478:(e,t,n)=>{"use strict";var i,a;n.d(t,{a:()=>i,D:()=>a}),function(e){e.PresenceUnknown="PresenceUnknown",e.Available="Available",e.AvailableIdle="AvailableIdle",e.Away="Away",e.Busy="Busy",e.BusyIdle="BusyIdle",e.DoNotDisturb="DoNotDisturb",e.BeRightBack="BeRightBack",e.Offline="Offline"}(i||(i={})),function(e){e.call="call",e.mention="mention",e.chat="chat",e.channel="channel",e.other="other"}(a||(a={}))},542187:(e,t,n)=>{"use strict";var i,a,o,r,s,l,c;n.d(t,{px:()=>i,i$:()=>r}),function(e){e.None="None",e.Core="Core",e.MeetNow="MeetNow",e.Loading="Loading",e.Main="Main",e.Mini="Mini",e.ChatPopout="ChatPopout",e.Meeting="Meeting",e.Presenter="Presenter"}(i||(i={})),function(e){e.MouseEnter="MouseEnter",e.MouseLeave="MouseLeave",e.Click="Click"}(a||(a={})),function(e){e.Text="Text",e.Pointer="Pointer"}(o||(o={})),function(e){e.ButtonsOnly="ButtonsOnly",e.FullWidth="FullWidth"}(r||(r={})),function(e){e.TopLeft="TopLeft",e.TopRight="TopRight",e.BottomLeft="BottomLeft",e.BottomRight="BottomRight"}(s||(s={})),function(e){e.Hidden="Hidden",e.Visible="Visible",e.Disabled="Disabled"}(l||(l={})),function(e){e.Rectangle="Rectangle"}(c||(c={}))},92613:(e,t,n)=>{"use strict";var i;n.d(t,{$:()=>i}),function(e){e.None="none",e.DayStart="dayStart",e.MeetingPrep="meetingPrep",e.MeetingStart="meetingStart",e.MeetingStarted="meetingStarted",e.MeetingEnd="meetingEnd",e.Feedback="feedback",e.InMeetingActionStatusUpdated="inMeetingActionStatusUpdated",e.InMeetingGreeting="inMeetingGreeting",e.InMeetingShareFile="inMeetingShareFile",e.RunningLate="inMeetingRunningLate",e.ReportUsage="reportUsage"}(i||(i={}))},567861:(e,t,n)=>{"use strict";n.d(t,{h:()=>i});class i{constructor(){}static getInstance(){return this.platformAppConversationService||(this.platformAppConversationService=new i),this.platformAppConversationService}setSubEntityDeepLinkInfo(e){this.deepLink=e}getSubEntityDeepLinkInfo(){return this.deepLink}setClientMessageId(e){this.clientMessageId=e}getClientMessageId(){return this.clientMessageId}}},686708:(e,t,n)=>{"use strict";n.d(t,{r_:()=>o,Sb:()=>r,gt:()=>s,eS:()=>l,JW:()=>c,Qs:()=>d,ZD:()=>u,nf:()=>m,z$:()=>p});var i=n(683184),a=n(491948);const o=e=>"string"==typeof e&&a.zV.indexOf(e)>-1,r=e=>e&&0!==e.length?e[0].toLowerCase()+e.substring(1):e,s=()=>{const e={};return a.KB.forEach((t=>{const n=t.split("-");2===n.length&&(e[n[1]]=n[0])})),e},l=()=>{const e={};return a.KB.forEach((t=>{const n=t.split("-");2===n.length&&(e[n[0]]=n[1])})),e},c=e=>{const t=[],n=[],i=Array.from(a.$6).concat(Array.from(a.OL)),o=new Set(i??[]);return e.forEach((e=>{o.has(e)?n.push(e):t.push(e)})),{policiesNamespaces:t,settingsNamespaces:n}},d=e=>{if(!e)return e;const t=l();Object.keys(t).forEach((n=>{const i=t[n];e[n]&&!e[i]&&(e[i]=e[n]),e[i]&&!e[n]&&(e[n]=e[i])}));const n={};u().forEach((t=>{e[t]&&(n[t]=e[t])}));const i={...e.policySettings,...n};return Object.keys(i).length>0&&(e.policySettings=i),e},u=()=>["byot","callingLineIdentityPolicy","clientPolicy","dialPlanPolicy","locationPolicy","teamsInteropPolicy","teamsMeetingPolicy","voicePolicy"],m=(e,t,n)=>{if("userPropertiesSettings"===e){const i=t,a=i?.isOnCloud?["rest","substrate"]:["ews"];for(const t of a)if("TaskTimedOut"===i?.autodiscoverSettings?.[t]?.mailboxDiscoverabilityError?.errorCode){n[e]="TaskTimedOut";break}}},p=(e,t)=>{const n=e("policies").namespaces??[],a=t.get(i.J.Core,["unsupportedPoliciesNamespaces"]).unsupportedPoliciesNamespaces??[],{enableDeviceStoreMetadataFetch:o}=t.get(i.J.Marketplace);o||a.push("deviceStoreMetadata");const{enableFetchingSmbTenantSettings:r}=t.get(i.J.Smb);r||a.push("smbTenantSettings");const{enableTeamsUserPhoneNumbersFetching:s}=t.get(i.J.Calling);s||a.push("teamsUserPhoneNumbers");const{enableMediaConnectivityPolicy:l}=t.get(i.J.Calling);l||a.push("teamsMediaConnectivityPolicy");const{enableTenantSiteUrlAndDomains:c}=t.get(i.J.Extensibility);c||a.push("tenantSiteUrlAndDomains");const{enableLocaleSyncWithMSAccount:d}=t.get(i.J.Localization);return d||a.push("userLanguageAccountSettings"),0===a.length?n:n.filter((e=>!a.includes(e)))}},491948:(e,t,n)=>{"use strict";n.d(t,{$6:()=>i,OL:()=>a,Ao:()=>o,KB:()=>r,zV:()=>s});const i=["adminSettings","clientSettings","deviceStoreMetadata","educationSettings","organizationSettings","smbTenantSettings","tenantProperties","tenantSettingsV2","tenantSiteUrl","tenantSiteUrlAndDomains","tenantVoiceSettings","userPropertiesSettings","userResourcesSettings","voiceAdminSettings","teamsMessagingConfiguration","teamsLinkPolicy","teamsUserPhoneNumbers","userLanguageAccountSettings"],a=["ageConsentPolicy"],o=["branchSurvivabilityPolicy","broadcastMeetingPolicy","callingLineIdentityPolicy","callingPolicy","callParkPolicy","dialPlanPolicy","educationAssignmentsAppPolicy","feedbackPolicy","filesPolicy","meetingPolicy","messagingPolicy","policySettings","shiftsPolicy","syntheticAutomatedCallPolicy","targetingPolicy","teamsAndChannelsPolicy","updateManagementPolicy","upgradePolicy","vdiPolicy","voicemailPolicy","byot","callingLineIdentity","clientPolicy","externalAccessPolicy","locationPolicy","onlineDialinConferencingPolicy","onlineVoicemailPolicy","onlineVoiceRoutingPolicy","teamsAppPermissionPolicy","teamsAppSetupPolicy","teamsBranchSurvivabilityPolicy","teamsCallingPolicy","teamsCallParkPolicy","teamsChannelsPolicy","teamsEducationAssignmentsAppPolicy","teamsEmergencyCallingPolicy","teamsEmergencyCallRoutingPolicy","teamsEnhancedEncryptionPolicy","teamsEventsPolicy","teamsFeedbackPolicy","teamsFilesPolicy","teamsInteropPolicy","teamsMediaConnectivityPolicy","teamsMediaLoggingPolicy","teamsMeetingBrandingPolicy","teamsMeetingBroadcastPolicy","teamsMeetingPolicy","teamsMessagingPolicy","teamsRoomVideoTeleConferencingPolicy","teamsShiftsPolicy","teamsSyntheticAutomatedCallPolicy","teamsTargetingPolicy","teamsUpdateManagementPolicy","teamsUpgradePolicy","teamsVdiPolicy","teamsVirtualAppointmentsPolicy","teamsVoiceApplicationsPolicy","tenantDialPlan","voicePolicy"],r=["callingLineIdentity-callingLineIdentityPolicy","onlineVoicemailPolicy-voicemailPolicy","teamsBranchSurvivabilityPolicy-branchSurvivabilityPolicy","teamsCallingPolicy-callingPolicy","teamsCallParkPolicy-callParkPolicy","teamsChannelsPolicy-teamsAndChannelsPolicy","teamsEducationAssignmentsAppPolicy-educationAssignmentsAppPolicy","teamsFeedbackPolicy-feedbackPolicy","teamsFilesPolicy-filesPolicy","teamsMeetingBroadcastPolicy-broadcastMeetingPolicy","teamsMeetingPolicy-meetingPolicy","teamsMessagingPolicy-messagingPolicy","teamsShiftsPolicy-shiftsPolicy","teamsSyntheticAutomatedCallPolicy-syntheticAutomatedCallPolicy","teamsTargetingPolicy-targetingPolicy","teamsUpdateManagementPolicy-updateManagementPolicy","teamsUpgradePolicy-upgradePolicy","teamsVdiPolicy-vdiPolicy","tenantDialPlan-dialPlanPolicy"],s=Array.from(i).concat(Array.from(a)).concat(Array.from(o))},620870:(e,t,n)=>{"use strict";n.d(t,{o:()=>o,O:()=>s});var i=n(683184);const a="MicrosoftTeams",o=e=>{const t=e.event.data?.();if(t){const n=r(e),i=t.telemetryItem;return{...i,data:{...i.data,...n}}}return null},r=({coreSettings:e,sessionStartGesture:t,client:n})=>{const{clientVersion:o}=e.get(i.J.Platform),{ring:r,environment:s}=e.get(i.J.Metadata),{clientType:l}=e.get(i.J.People),c=l||a,d=n?.ctx?.authenticationUser?.profile;return{hostApp:l||a,hostAppRing:r?.id||"",hostAppVersion:o??"",complianceEnvironment:s??"",sessionStartGesture:t,clientType:c,userId:d?.objectId??"",tenantId:d?.tenantId??"",puid:d?.puid??""}},s=e=>{const{environment:t}=e.get(i.J.Metadata);switch(t?.toLowerCase()){case"life":case"prod":return"Prod";case"gcc":return"GccModerate";case"gcchigh":return"GccHigh";case"dod":return"DoD";case"gallatin":return"Gallatin";case"ag08":return"AG08";case"ag09":return"AG09";default:return null}}},53246:(e,t,n)=>{"use strict";n.d(t,{W:()=>o});var i=n(112589),a=n(620870);class o{static associateIngestionKeyWithAppName(e,t,n){o.ingestionKeys.set(t,e),n&&o.middlewaresMap.set(t,n),(0,i.Yf)().initializeSecondPartyLogger(t,e)}static associateIngestionKeyWithAppNameIfNecessary(e,t,n){o.isAssociated(t)||o.associateIngestionKeyWithAppName(e,t,n)}static isAssociated(e){return o.ingestionKeys.has(e)}static logEvent(e){const t=e.event.data?.().appName,n=(0,a.o)(e);if(t&&n){const e=o.executeMiddleware(t,n);(0,i.Yf)().logSecondPartyEvent(t,e)}}static executeMiddleware(e,t){const n=o.middlewaresMap.get(e);return n?n.reduce(((e,t)=>t(e)),t):t}}o.ingestionKeys=new Map,o.middlewaresMap=new Map},213906:(e,t,n)=>{"use strict";n.d(t,{vc:()=>i,Bd:()=>a,d5:()=>o});const i={EmptyEvent:"EmptyEvent",NotEnabled:"NotEnabled",RequiredFieldMissing:"RequiredFieldMissing",SubscriptionFailed:"SubscriptionFailed",MethodNotAvailable:"showBadge not available on taskbar module.",ModuleUnableToLoad:"HostComms is unable to load taskbar module. We are running on Web or Teams 1.0. Bailing out."},a={ModuleLoaded:"HostComms has loaded taskbar module. Setting badge.",UpdatedEvent:"Updated Taskbar Badge Count:"},o="TaskbarService"},426185:(e,t,n)=>{"use strict";n.d(t,{a:()=>o});var i=n(683184),a=n(213906);class o{constructor(e,t,n){this.coreSettings=t,this.hostCommunicationService=n,this.getBadge=e=>({icon:{countBadge:{value:e}}}),this.logger=e.newLogger(a.d5,"services-io-taskbar")}async showBadge(e){if(!this.enableTaskbarBadgeMaglev)return void this.logger.log(a.vc.NotEnabled);const t=await this.hostCommunicationService.loadModule("taskbar");if(t){if(t.showBadge)return this.logger.log(`${a.Bd.ModuleLoaded} with count badge: ${e.icon?.countBadge?.value}`),t.showBadge(e);this.logger.log(a.vc.MethodNotAvailable)}else this.logger.error(a.vc.ModuleUnableToLoad)}async showBadgeCount(e){return this.showBadge(this.getBadge(e))}async resetBadge(){return this.showBadgeCount(0)}get enableTaskbarBadgeMaglev(){return!!this.coreSettings.get(i.J.Core).enableTaskbarBadgeMaglev}}},953874:(e,t,n)=>{"use strict";n.d(t,{K:()=>Ae});var i=n(945151),a=n(37718),o=n(750082),r=n(741679),s=n(994007),l=n(933609),c=n(256676),d=n(793669);const u={source:"teamsAndChannels"},m=()=>({authOptions:u,apiName:"canCreateTWT",url:"beta/teams/canCreateTWT",method:"GET"}),p=e=>({authOptions:u,apiName:"createTeam",url:"beta/teams/create",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),g=(e,t)=>({authOptions:u,apiName:"editTeam",url:`beta/teams/${e}`,method:"PATCH",body:JSON.stringify(t),headers:{"content-type":"application/json"}}),h=(e,t,n)=>({authOptions:u,apiName:"profilepicture",url:`beta/teams/${e}/profilepicture?threadId=${t}`,method:"POST",body:n,headers:{"content-type":"application/json"}}),y=async e=>{if(e.status===a.qb.OK)return!0;throw new Error(`Request to server failed with ${e?.status} request url: ${e?.url}`)},v=e=>({authOptions:u,apiName:"defaultProfilePicture",url:`beta/teams/defaultProfilePicture?displayName=${e}&highResolution=true`,method:"GET",headers:{"content-type":"application/json"}}),f=async e=>{if(e.status===a.qb.OK&&e?.body){const t=await e.body.blob();return await(0,d.n)(t)||""}throw(0,s.T)(l.A.TransformFailed,e)},S=e=>({authOptions:u,apiName:"findJoinRequests",url:"beta/teams/findJoinRequests",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),k=e=>({authOptions:u,apiName:"getChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,method:"GET",headers:{"content-type":"application/json"}}),C={Team:0,Edu:1,Class:2,Plc:3,Staff:4,HealthcareCareCoordination:5,Community:6},b=e=>({authOptions:u,apiName:"migrateGroupToTeam",url:`beta/teams/migrateGroup/${encodeURIComponent(e.groupId)}`,body:(0,c.u4)({...e,teamType:C[e.teamType]??-1}),method:"PUT",headers:{"content-type":"application/json"}}),w=e=>({authOptions:u,apiName:"myGroupMemberships",url:`beta/teams/usergroups?teamType=${e}`,method:"GET",headers:{"content-type":"application/json"}}),T=(e,t)=>({authOptions:u,apiName:"createChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,body:JSON.stringify(t),method:"POST",headers:{"content-type":"application/json"}}),I=(e,t)=>({authOptions:u,apiName:"updateChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,body:JSON.stringify(t),method:"PUT",headers:{"content-type":"application/json"}}),N=e=>({authOptions:u,apiName:"removeChannelEmailSettingsRequest",url:`beta/channels/${e}/email`,method:"DELETE",headers:{"content-type":"application/json"}}),E=(e,t)=>({authOptions:u,apiName:"handleBulkJoinRequests",url:`beta/teams/bulkJoinRequestAdminAction?silentAction=${t}`,method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),A=(e,t)=>({authOptions:u,apiName:"handleJoinRequest",url:`beta/teams/joinRequestAdminAction?silentAction=${t}`,method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),_=(e,t,n)=>({authOptions:u,apiName:"leaveChannel",url:`beta/teams/${e}/channels/${t}/members/${n}`,method:"DELETE",headers:{"content-type":"application/json"}}),F=e=>({authOptions:u,apiName:"userGroupSettings",url:"beta/users/groupsSettings",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),D=e=>({authOptions:u,apiName:"groupSettings",url:`beta/teams/${e}/groupSettings`,method:"GET"}),P=e=>({authOptions:u,apiName:"setFavoritedTimeForStaleTeams",url:"beta/users/setFavoriteTime",body:JSON.stringify(e),method:"PUT",headers:{"content-type":"application/json"}}),M=(e,t,n)=>({authOptions:u,apiName:"removePrivateChannelMembership",url:`beta/teams/${e}/channels/${t}/members/${n}`,method:"DELETE",headers:{"content-type":"application/json"}}),x=(e,t)=>({authOptions:u,apiName:"restoreChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}/restore`,method:"PATCH"}),R=(e,t,n)=>({authOptions:u,apiName:"deleteChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}`,method:"DELETE",body:JSON.stringify(n),headers:{"content-type":"application/json"}}),j=e=>({authOptions:u,apiName:"getSensitivityLabels",url:`beta/users/sensitivityLabels?includeUnscopedLabels=${e}`,method:"GET"}),L=()=>({authOptions:u,apiName:"getSensitivityPolicySettings",url:"beta/users/sensitivityPolicySettings",method:"GET"}),O=(e,t)=>({authOptions:u,apiName:"sponsorJoinRequest",url:`beta/teams/sponsorJoinRequest/${e}`,method:"POST",body:JSON.stringify(t),headers:{"content-type":"application/json"}}),$=e=>e.body.json().then((e=>{if(e?.value)return{...e.value,groupId:e.value?.siteInfo?.groupId}})).catch((()=>{throw(0,s.T)(l.A.TransformFailed,e)})),U=async e=>{const t=await e.body.json();if(t&&t.joinRequestsPerTeam){const e=t.joinRequestsPerTeam,n=Object.keys(e),i=[];for(const t of n)if(e[t])for(const n of e[t])n.teamId=t,i.push(n);return t.joinRequestsPerTeam=i,t}},B=e=>({authOptions:u,apiName:"validateTeamName",url:"beta/teams/validateNaming",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),W=e=>({authOptions:u,apiName:"allChannels",url:`beta/teams/${e}/allchannels`,method:"PUT",body:JSON.stringify({Channels:[{Type:"standard",State:["deleted"]},{Type:"private",State:["deleted"]},{Type:"shared",State:["deleted"]}]}),headers:{"content-type":"application/json"}}),H=e=>({authOptions:u,apiName:"allChannels",url:`beta/teams/${e}/allchannels`,method:"PUT",body:JSON.stringify({Channels:[{Type:"standard",State:["archived"]},{Type:"private",State:["archived"]},{Type:"shared",State:["archived"]}]}),headers:{"content-type":"application/json"}}),V=(e,t)=>({authOptions:u,apiName:"updateTeamMembership",url:`beta/teams/${encodeURIComponent(e)}/members`,method:"PUT",body:JSON.stringify(t),headers:{"content-type":"application/json"}}),G=(e,t,n,i)=>({authOptions:u,apiName:"updateTeamMembership",url:`beta/teams/${e}/members`,method:"PUT",body:JSON.stringify({groupId:t,userMri:n,updateType:i}),headers:{"content-type":"application/json"}}),z=(e,t,n,i)=>({authOptions:u,apiName:"updatePrivateChannelMembership",url:`beta/teams/${e}/channels/${t}/members/${n}`,method:"PATCH",body:JSON.stringify({mri:n,role:i}),headers:{"content-type":"application/json"}}),q=e=>({authOptions:u,apiName:"resetTeamJoinCode",url:`beta/teams/${e}/joinCode`,method:"PUT",headers:{"content-type":"application/json"}}),J=e=>({authOptions:u,apiName:"removeTeamJoinCode",url:`beta/teams/${e}/joinCode`,method:"DELETE",headers:{"content-type":"application/json"}}),Q=e=>({authOptions:u,apiName:"getTeamJoinCode",url:`beta/teams/${e}/joinCode`,method:"GET"}),K=e=>({authOptions:u,apiName:"getRetentionLabels",url:`beta/teams/${e}/retentionlabels`,method:"GET"}),Y=e=>({authOptions:u,apiName:"renewTeam",url:`beta/teams/${e}/renew`,method:"POST"}),X=(e,t)=>({authOptions:u,apiName:"updateTeamDiscoverability",url:`beta/teams/${e}/discoverable`,method:"PUT",body:JSON.stringify(t)}),Z=e=>({authOptions:u,apiName:"getRecommendedTeams",url:`beta/teams/suggested?accessType=${e}&enableFallback=true`,method:"GET"}),ee=e=>({authOptions:u,apiName:"joinTeamById",url:`beta/teams/joinRequest/${e}`,method:"POST",headers:{"content-type":"application/json"}}),te=(e,t,n)=>({authOptions:u,apiName:"searchRecommendedTeams",url:`beta/teams/find?keywords=${encodeURIComponent(t)}&accessType=${e}&enableKeywordSearch=false&top=100&skipToken=${encodeURIComponent(n||"")}`,method:"GET"}),ne=e=>({authOptions:u,apiName:"joinTeamWithCode",url:"beta/teams/joinByCode",method:"POST",body:JSON.stringify(e),headers:{"content-type":"application/json"}}),ie=e=>({authOptions:u,apiName:"cancelJoinRequest",url:`beta/teams/cancelJoinRequest/${e}`,method:"POST",headers:{"content-type":"application/json"}}),ae=e=>({authOptions:u,apiName:"deleteTeam",url:`beta/teams/${encodeURIComponent(e)}/delete`,method:"DELETE",headers:{"content-type":"application/json"}}),oe=e=>({authOptions:u,apiName:"archiveTeam",url:`beta/teams/${encodeURIComponent(e)}/archive`,method:"POST",headers:{"content-type":"application/json"}}),re=(e,t)=>({authOptions:u,apiName:"unarchiveChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${t}/unarchive`,method:"POST",headers:{"content-type":"application/json"}}),se=(e,t)=>({authOptions:u,apiName:"archiveChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${t}/archive`,method:"POST",headers:{"content-type":"application/json"}}),le=e=>({authOptions:u,apiName:"unarchiveTeam",url:`beta/teams/${encodeURIComponent(e)}/unarchive`,method:"POST",headers:{"content-type":"application/json"}}),ce=(e,t)=>({authOptions:u,apiName:"setChannelShowForMember",url:`beta/teams/${e}/setDefaultChannel`,method:t?"PUT":"DELETE",headers:{"content-type":"application/json"}}),de=(e,t)=>({authOptions:u,apiName:"createChannel",url:`beta/teams/${e}/channels`,method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}),ue=async e=>e.body.json().then((e=>({id:e.value.objectId}))).catch((()=>{throw(0,s.T)(l.A.TransformFailed,e)})),me=(e,t,n)=>({authOptions:u,apiName:"updateChannel",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}`,method:"PATCH",headers:{"content-type":"application/json"},body:JSON.stringify(n)}),pe=(e,t,n,i)=>{const a={users:n,groupId:t},o=i?"?allowBotsInChannel=true":"";return{authOptions:u,method:"PUT",url:`beta/teams/${encodeURIComponent(e)}/bulkUpdateRoledMembers${o}`,body:(0,c.XC)(a),headers:{"content-type":"application/json"}}},ge=(e,t,n)=>{const i={value:n};return{authOptions:u,method:"PUT",url:`beta/teams/${encodeURIComponent(e)}/channels/${encodeURIComponent(t)}/members`,body:(0,c.XC)(i),headers:{"content-type":"application/json"}}},he=(e,t)=>{const n=t.map((e=>e.mri));return{authOptions:u,method:"POST",url:`beta/teams/sponsorJoinRequest/${encodeURIComponent(e)}`,body:(0,c.XC)(n),headers:{"content-type":"application/json"}}},ye=e=>({authOptions:u,apiName:"getTeamInfo",url:`beta/teams/getTeamInfo?groupId=${e}`,method:"GET",headers:{"content-type":"application/json"}}),ve=(e,t,n)=>{const i={...n,userType:"Guest"},a=`beta/teams/${encodeURIComponent(e)}/${t}/inviteAndAddGuest`;return{authOptions:u,apiName:"inviteAndAddGuest",url:a,method:"PUT",headers:{"content-type":"application/json"},body:(0,c.u4)(i)}},fe=(e,t,n,i)=>{const a={type:"Team"===e?"team":"channel",containerId:t,groupId:n,itemId:i,allowXtenantAccess:"SharedChannel"===e};return{authOptions:u,apiName:"deeplink",url:"beta/deeplink",method:"POST",body:JSON.stringify(a),headers:{"content-type":"application/json"}}},Se=(e,t)=>({authOptions:u,apiName:"getChannelInfo",url:`beta/teams/${e}/channels/${encodeURIComponent(t)}/info`,method:"GET",headers:{"content-type":"application/json"}}),ke={None:0,Private:1,Secret:2,Public:3,HiddenMembership:4,Unknown:5,All:6},Ce=(e,t)=>({authOptions:u,apiName:"cloneTeam",url:`beta/teams/${encodeURIComponent(e)}/clone`,method:"POST",headers:{"content-type":"application/json"},body:(0,c.u4)({...t,accessType:Object.keys(ke).indexOf(t.accessType.toString())})}),be=e=>({authOptions:u,apiName:"templateProvisioningStatus",url:`beta/teams/${encodeURIComponent(e)}/templateProvisioningStatus`,method:"GET",headers:{"content-type":"application/json"}}),we=e=>({authOptions:u,apiName:"syncTeamsRoster",url:"beta/teams/syncTeamsRoster",method:"PUT",headers:{"content-type":"application/json"},body:(0,c.u4)(e)}),Te=e=>{const{authenticationResources:t,discover:n,platformService:a,config:s}=e,l=(0,o.h)(a,s),c=(0,r.g)(Ie,l),d=(0,r.g)(Ne,l);return{baseUrlPromise:()=>n.regionGtm("middleTier"),serviceName:i.E.MiddleTier,authResource:t.mtAuthWithSkypeXTokenResource,models:{canCreateTWT:c(m),createTeam:c(p).withTransform($),deletedChannels:c(W),archivedChannels:c(H),editTeam:c(g),changeTeamPicture:c(h).withTransform(y),channelJoinInfo:c(Se),getDefaultTeamPicture:c(v).withTransform(f),findJoinRequests:c(S).withTransform(U),getChannelEmailSettings:d(k),migrateGroupToTeam:c(b),myGroupMemberships:c(w),createChannelEmailSettings:d(T),updateChannelEmailSettings:d(I),removeChannelEmailSettings:d(N),handleBulkJoinRequests:c(E),handleJoinRequest:c(A),leaveChannel:c(_),groupSettings:c(D),myGroupSettings:c(F),removePrivateChannelMembership:c(M),setFavoritedTimeForStaleTeams:c(P),restoreChannel:c(x),deleteChannel:c(R),editChannel:c(me),sensitivityLabels:c(j),sensitivityPolicySettings:c(L),sponsorJoinRequest:c(O),updatePrivateChannelMembership:c(z),updateTeamMembership:c(G),validateTeamName:c(B),removeTeamMembership:c(V),resetTeamJoinCode:c(q),removeTeamJoinCode:c(J),getTeamJoinCode:c(Q),getRetentionLabels:c(K),renewTeam:c(Y),updateTeamDiscoverability:c(X),getRecommendedTeams:c(Z),joinTeamById:c(ee),searchRecommendedTeams:c(te),joinTeamWithCode:c(ne),cancelJoinRequest:c(ie),archiveTeamRequest:c(oe),unarchiveTeamRequest:c(le),archiveChannelRequest:c(se),unarchiveChannelRequest:c(re),deleteTeamRequest:c(ae),leaveTeamRequest:Ne(V),setChannelShowForMember:c(ce),createChannel:c(de).withTransform(ue),addBulkMembersToTeam:c(pe),addBulkMembersToPrivateChannel:c(ge),requestToAddMembersToTeam:c(he),getTeamByGroupId:c(ye),inviteAndAddGuestToTeam:Ne(ve),teamsAndChannelsPageDeepLinkUrl:c(fe),cloneTeam:c(Ce),templateProvisioningStatus:c(be),syncTeamsRoster:c(we)}}};function Ie(e){return Promise.resolve({constructRequest:e,allowedResponses:[a.qj.HTTP_2XX]})}function Ne(e){return Promise.resolve({constructRequest:e,allowedResponses:[a.qj.HTTP_2XX,a.qj.HTTP_4XX]})}var Ee=n(981917);class Ae{constructor(e){this._transport=e.createApi(Te)}canCreateTWT(){return this._transport.canCreateTWT()}createTeam(e){const t={...e,accessType:this.convertTeamAccessType(e.accessType)};return this._transport.createTeam(t)}deletedChannels(e){return this._transport.deletedChannels(e)}archivedChannels(e){return this._transport.archivedChannels(e)}editTeam(e,t){return this._transport.editTeam(e,t)}changeTeamPicture(e,t,n){return this._transport.changeTeamPicture(e,t,n)}getDefaultTeamPicture(e){return this._transport.getDefaultTeamPicture(e)}findJoinRequests(e){return this._transport.findJoinRequests(e)}getChannelEmailSettings(e){return this._transport.getChannelEmailSettings(e)}createChannelEmailSettings(e,t){return this._transport.createChannelEmailSettings(e,t)}updateChannelEmailSettings(e,t){return this._transport.updateChannelEmailSettings(e,t)}removeChannelEmailSettings(e){return this._transport.removeChannelEmailSettings(e)}handleBulkJoinRequests(e,t){return this._transport.handleBulkJoinRequests(e,t)}handleJoinRequest(e,t){return this._transport.handleJoinRequest(e,t)}leaveChannel(e,t,n){return this._transport.leaveChannel(e,t,n)}setFavoritedTimeForStaleTeams(e){return this._transport.setFavoritedTimeForStaleTeams(e)}removePrivateChannelMembership(e,t,n){return this._transport.removePrivateChannelMembership(e,t,n)}removeTeamMembership(e,t){return this._transport.removeTeamMembership(e,t)}restoreChannel(e,t){return this._transport.restoreChannel(e,t)}deleteChannel(e,t,n){return this._transport.deleteChannel(e,t,n)}myGroupSettings(e){return this._transport.myGroupSettings(e)}groupSettings(e){return this._transport.groupSettings(e)}sensitivityLabels(e=!1){return this._transport.sensitivityLabels(e)}sensitivityPolicySettings(){return this._transport.sensitivityPolicySettings()}sponsorJoinRequest(e,t){return this._transport.sponsorJoinRequest(e,t)}validateTeamName(e){return this._transport.validateTeamName(e)}getRetentionLabels(e){return this._transport.getRetentionLabels(e)}updateTeamMembership(e,t,n,i){return this._transport.updateTeamMembership(e,t,n,i)}updatePrivateChannelMembership(e,t,n,i){return this._transport.updatePrivateChannelMembership(e,t,n,i)}resetTeamJoinCode(e){return this._transport.resetTeamJoinCode(e)}removeTeamJoinCode(e){return this._transport.removeTeamJoinCode(e)}getTeamJoinCode(e){return this._transport.getTeamJoinCode(e)}renewTeam(e){return this._transport.renewTeam(e)}updateTeamDiscoverability(e,t){return this._transport.updateTeamDiscoverability(e,t)}getRecommendedTeams(e){return this._transport.getRecommendedTeams(e)}joinTeamById(e){return this._transport.joinTeamById(e)}searchRecommendedTeams(e,t,n){return this._transport.searchRecommendedTeams(e,t,n)}joinTeamWithCode(e){return this._transport.joinTeamWithCode(e)}cancelJoinRequest(e){return this._transport.cancelJoinRequest(e)}archiveTeamRequest(e){return this._transport.archiveTeamRequest(e)}unarchiveTeamRequest(e){return this._transport.unarchiveTeamRequest(e)}archiveChannelRequest(e,t,n){return this._transport.archiveChannelRequest(e,t,n)}unarchiveChannelRequest(e,t){return this._transport.unarchiveChannelRequest(e,t)}deleteTeamRequest(e){return this._transport.deleteTeamRequest(e)}leaveTeamRequest(e,t){return this._transport.leaveTeamRequest(e,t)}setChannelShowForMember(e,t){return this._transport.setChannelShowForMember(e,t)}myGroupMemberships(e){return this._transport.myGroupMemberships(e)}createChannel(e,t){return this._transport.createChannel(e,t)}editChannel(e,t,n){return this._transport.editChannel(e,t,n)}addBulkMembersToTeam(e,t,n,i){return this._transport.addBulkMembersToTeam(e,t,n,i)}addBulkMembersToPrivateChannel(e,t,n){return this._transport.addBulkMembersToPrivateChannel(e,t,n)}requestToAddMembersToTeam(e,t){return this._transport.requestToAddMembersToTeam(e,t)}migrateGroupToTeam(e){return this._transport.migrateGroupToTeam(e)}getTeamByGroupId(e){return this._transport.getTeamByGroupId(e)}inviteAndAddGuestToTeam(e,t,n){return this._transport.inviteAndAddGuestToTeam(e,t,n)}teamsAndChannelsPageDeepLinkUrl(e,t,n,i){return this._transport.teamsAndChannelsPageDeepLinkUrl(e,t,n,i)}channelJoinInfo(e,t){return this._transport.channelJoinInfo(e,t)}cloneTeam(e,t){return this._transport.cloneTeam(e,t)}templateProvisioningStatus(e){return this._transport.templateProvisioningStatus(e)}syncTeamsRoster(e){return this._transport.syncTeamsRoster(e)}convertTeamAccessType(e){return"Public"===e?Ee.eU.Public:Ee.eU.Private}}},174057:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});const i="ModuleLoaded",a="Focus Assist not available on module.",o="HostComms is unable to load toast toasts module. Bailing out.";class r{constructor(e,t){this.hostCommunicationService=t,this.logger=e.newLogger("ToastSettingsService","services-io-toast-settings")}async getFocusAssistStateAsync(){const e=await this.hostCommunicationService.loadModule("toasts");if(e){if(e.getFocusAssistStateAsync)return this.logger.log(i),e.getFocusAssistStateAsync();this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice")}else this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async getGlobalNotificationSettingsAsync(e){const t=await this.hostCommunicationService.loadModule("toasts");if(t){if(t.getGlobalNotificationSettingsAsync)return this.logger.log(i),e?t.getGlobalNotificationSettingsAsync(e):t.getGlobalNotificationSettingsAsync();this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice")}else this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async registerForToastDismissed(e){const t=await this.hostCommunicationService.loadModule("toasts");t?t.registerForToastDismissed?t.registerForToastDismissed(e):this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice"):this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async registerForNotificationModeChanged(e){const t=await this.hostCommunicationService.loadModule("toasts");t?t.registerForNotificationModeChanged?t.registerForNotificationModeChanged(e):this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice"):this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}async registerForFocusSessionChanged(e){const t=await this.hostCommunicationService.loadModule("toasts");t?t.registerForFocusSessionChanged?t.registerForFocusSessionChanged(e):this.logger.errorToTelemetry?.(a,"toast_service_settings_warn_user_notice"):this.logger.errorToTelemetry?.(o,"toast_service_settings_warn_user_notice")}}},138633:(e,t,n)=>{"use strict";var i,a;n.d(t,{HZ:()=>o,so:()=>r}),function(e){e.Softest="Softest",e.Soft="Soft",e.Default="Default",e.Loud="Loud",e.Loudest="Loudest"}(i||(i={})),function(e){e.Default="DefaultUrgent",e.MoreUrgent="MoreUrgent",e.VeryUrgent="VeryUrgent",e.Alarm="Alarm"}(a||(a={}));const o=[i.Softest,i.Soft,i.Default,i.Loud,i.Loudest],r=(a.Default,a.MoreUrgent,a.VeryUrgent,a.Alarm,e=>{const t=s[e];return t||{soundFile:"teams_basic_notification_default",labelKey:"notification_sound_type_default"}}),s={[i.Softest]:{soundFile:"teams_basic_notification_softest",labelKey:"notification_sound_type_softest"},[i.Soft]:{soundFile:"teams_basic_notification_softer",labelKey:"notification_sound_type_soft"},[i.Default]:{soundFile:"teams_basic_notification_default",labelKey:"notification_sound_type_default"},[i.Loud]:{soundFile:"teams_basic_notification_clearer",labelKey:"notification_sound_type_loud"},[i.Loudest]:{soundFile:"teams_basic_notification_clearest",labelKey:"notification_sound_type_loudest"},[a.Alarm]:{soundFile:"teams_urgent_notification_alarm",labelKey:"notification_sound_type_alarm"},[a.Default]:{soundFile:"teams_urgent_notification_default",labelKey:"notification_sound_type_default"},[a.MoreUrgent]:{soundFile:"teams_urgent_notification_more_urgent",labelKey:"notification_sound_type_more_urgent"},[a.VeryUrgent]:{soundFile:"teams_urgent_notification_very_urgent",labelKey:"notification_sound_type_very_urgent"}}},643902:(e,t,n)=>{"use strict";n.d(t,{j:()=>o});var i=n(833851),a=n(771574);const o=(e,t)=>{try{const n=JSON.parse(t.content);return{url:e,title:n.title&&r(n.title),description:n.text&&r(n.text),thumbnail:n.images&&n.images[0]?.url}}catch(e){throw new Error(`parsing preview content failed with error: ${(0,a.A)(e.message||"")}`)}},r=e=>(new i._).stripHtml(e)||""},125912:(e,t,n)=>{"use strict";n.d(t,{BZ:()=>r});var i=n(191366);const a="isOptedIntoT2Web",o="web_app_switcher_opt_out_redirection_fail";class r{constructor(e,t,n){this.localStorage=e,this.crossTabsService=n,this.logger=t.newLogger("WebAppSwitcherService","services-io-web-app-switcher"),this.logger.log("WebAppSwitcherService initialized")}optOutOfT2Web(e,t){this.crossTabsService?(this.logger.warnNoPii?.("Opting user out of T2",e),this.doRedirection(!0,!0,!0,e,t)):this.logger.errorToTelemetry?.("Cross tabs service is undefined",o,{commandSource:e},!0)}redirectThisTabToT1(e){this.doRedirection(!1,!1,!1,e)}doRedirection(e,t,n,a,r){let s;try{s=this.getT1Url(r)}catch(e){return void this.logger.errorToTelemetry?.("Failed to get T1 url",o,{commandSource:a},!0)}t&&!this.clearOptInFlag(a)||(e&&this.crossTabsService?.postMessage("T2WebOptOut"),this.logger.warnToTelemetry?.("Redirecting to T1 web","web_app_switcher_opt_out_redirection_success",{endpointUrl:s,commandSource:a},!0),n&&this.localStorage.trySet("lastT2WebOptOutInfo",JSON.stringify({source:a??"Unknown",timestamp:Date.now()}),"Framework","Global"),(0,i.J)().location.replace(s))}clearOptInFlag(e){return this.localStorage.get(a,"Global")?(this.localStorage.remove(a,"Global"),this.localStorage.get(a,"Global")?(this.logger.errorToTelemetry?.("Failed to clear opt-in flag",o,{commandSource:e},!0),!1):(this.localStorage.remove("forceT2Only","Global"),this.logger.warnNoPii?.("isOptedIntoT2Web flag cleared from local storage",e),!0)):(this.logger.errorToTelemetry?.("Opt-in flag not found",o,{commandSource:e},!0),!1)}getT1Url(e){let t;const n=(0,i.J)();if(e){const n=new URL(e),i=n.pathname+n.search+n.hash,a=new URL(n.origin);a.pathname="/_",a.hash=i,t=a}else{const e=new URL(n.location.href);t=new URL(e.origin)}return t.href}}},482169:(e,t,n)=>{"use strict";n.d(t,{Q:()=>i});class i{static get Instance(){return i._instance||(i._instance=new i),i._instance}constructor(){this.outstandingRequests=void 0,this.mostRecentRequest=void 0,this.requestsMapping=void 0,this.decimalPlaces=void 0,this.subscriber=void 0,this.decimalPlaces=3}processRequest(e,t,n){if(!this.subscriber)return;const{requests:i}=this.outstandingRequests;i.has(e)||i.set(e,{requestsByName:new Map});const{requestsByName:a}=i.get(e),o=a.get(t)||0;a.set(t,o+1),this.requestsMapping.set(n,{operationName:t,operationType:e}),this.notify()}processResponse(e,t){if(!this.subscriber||!this.requestsMapping.has(e))return;const{operationName:n,operationType:i}=this.requestsMapping.get(e);if("subscription"===i)return;this.requestsMapping.delete(e);const a=this.outstandingRequests&&this.outstandingRequests.requests;if(a.has(i)){const{requestsByName:e}=a.get(i);let t=e.get(n);1===t?e.delete(n):t>0&&e.set(n,--t)}const o={requestInfo:{operationName:n,operationType:i},responseTime:t&&parseFloat(t.toFixed(this.decimalPlaces))};this.mostRecentRequest=o,this.notify()}subscribe(e){this.subscriber=e,this.outstandingRequests={requests:new Map},this.requestsMapping=new Map}unsubscribe(){this.subscriber=void 0,this.outstandingRequests=void 0,this.requestsMapping=void 0}notify(){this.subscriber.processUpdate(this.outstandingRequests,this.mostRecentRequest)}}i._instance=void 0},867135:(e,t,n)=>{"use strict";n.d(t,{f5:()=>r,zB:()=>s,m0:()=>l,$J:()=>c,mw:()=>d,Mf:()=>u,NF:()=>m,UL:()=>p,hR:()=>h,Ij:()=>y,gE:()=>v,Tx:()=>f,IB:()=>C,yN:()=>T,RA:()=>I,OO:()=>N,e2:()=>E,uD:()=>A,yQ:()=>_});var i=n(980776),a=n(256676),o=n(156771);const r="=====",s="Core",l="Logs",c="Core",d=(e,t)=>{const n="function"==typeof e.timeStamp.getTime?e.timeStamp:new Date(e.timeStamp),i="function"==typeof t.timeStamp.getTime?t.timeStamp:new Date(t.timeStamp);return n.getTime()-i.getTime()},u=e=>{if(!e||0===e.length)return"";let t="";return e.forEach((e=>{if(e)if(e.message?.startsWith(r)&&e.message?.endsWith(r))t+=`\n${e.message}\r\n`;else{const n="function"==typeof e.timeStamp?.toISOString?e.timeStamp.toISOString():e.timeStamp,i="string"==typeof e.levelName?e.levelName.substring(0,3):"unknownLevelName";t+=`${n} ${i}\t${e.message}\r\n`}})),(0,a.LQ)(t)},m=(e,t,n,i,a=!1)=>{if(!e)return;let r=JSON.stringify(void 0===i?t:{sessionId:i,logsArray:t});a&&(r=(0,o.gzip)(r,{to:"string"})),e.setItem(n,r)},p=(e,t,n,i)=>{if(!t)return;const a=t.getItem(n);if(a){const t=JSON.parse(a);if(Array.isArray(t)&&t.length>0){const n=t.map((e=>g(e))).sort(((e,t)=>e.timeStamp.getTime()-t.timeStamp.getTime()));e.addEvents(n)}}i&&t.removeItem(n)};function g(e){const t={message:`DiagnosticsService - Converting event from localStorage failed - ${e}`,isPiiFree:!0,level:i.i.Error,levelName:"error",timeStamp:new Date};try{const n=e;if("timeStamp"in n){if("string"==typeof n.timeStamp){if(isNaN(Date.parse(n.timeStamp)))return t;n.timeStamp=new Date(n.timeStamp)}return n}}catch{}return t}const h=(e,t,n,o,r,s=!1)=>{n.length>512&&(n=n.substring(0,512)+"...");const l={message:n=(0,a.LQ)(n),level:t,levelName:i.i[t],timeStamp:r||new Date,isPiiFree:o};return e.addEvent(l,s),l},y=e=>e?.length?e.filter((e=>e.isPiiFree)):e,v=(e,t,n)=>{let i="";try{const a=f(e,t,!1);a&&a.logsArray.length>0&&(n&&(a.logsArray=y(a.logsArray)),i=u(a.logsArray))}catch{i="Previous session logs parsing failed"}return i},f=(e,t,n)=>{let i=e?.getItem(t);if(i)try{if("{"!==i.charAt(0)&&"["!==i.charAt(0))try{i=(0,o.ungzip)(i,{to:"string"})}catch{}const a=JSON.parse(i);if(i=null,a)return n&&e.removeItem(t),"logsArray"in a?{sessionId:a.sessionId,logsArray:a.logsArray.map((e=>g(e)))}:{sessionId:"",logsArray:a}}catch{}},S="tmp.previousSessionLogs",k="tmp.previousSessionErrorLogs",C=(e,t=!1)=>`${t?k:S}${e?`-${e}`:""}`,b="persistedDiagnostics",w="persistedErrorDiagnostics",T=(e,t=!1)=>`${t?w:b}${e?`-${e}`:""}`,I=(e,t,n,o)=>{const r=e.getBufferedEvents();if(r&&r.length>0){const s={message:`DiagnosticsService: The following logs were persisted from a previous session ${o}`,isPiiFree:!0,level:i.i.Info,levelName:"info",timeStamp:new Date};((e,t,n)=>{e&&e.setItem(t,(0,a.u4)(n))})(t,n,[{message:`DiagnosticsService: The above logs were persisted from a previous session ${o}`,isPiiFree:!0,level:i.i.Info,levelName:"info",timeStamp:r[0].timeStamp},...r,s]),e.addEvent({message:`DiagnosticsService: Persisting diagnostic events for next load. Key: ${n}`,isPiiFree:!0,level:i.i.Warn,levelName:"warn",timeStamp:new Date})}},N=(e,t)=>{try{const n=new Set([C(void 0,!0),C(void 0,!1)].concat(t.map((e=>C(e,!0))),t.map((e=>C(e,!1)))));Object.keys(e).filter((e=>(e.startsWith(S)||e.startsWith(k))&&!n.has(e))).forEach((t=>e.removeItem(t)))}catch{}},E=e=>{try{Object.keys(e).filter((e=>e.startsWith(b)||e.startsWith(w))).forEach((t=>e.removeItem(t)))}catch{}},A=(e,t)=>{try{const n=C(t,!1);e.removeItem(n);const i=C(t,!0);e.removeItem(i)}catch{}},_=e=>{try{const t="previousLoaderDiagnostics";Object.keys(e.localStorage).filter((e=>e.startsWith(S)||e.startsWith(k)||e.indexOf(t)>=0)).forEach((t=>e.localStorage.removeItem(t)))}catch{}}},741679:(e,t,n)=>{"use strict";n.d(t,{K:()=>o,g:()=>r});var i=n(48524),a=n(750082);const o=(e,t,n)=>o=>{const{discover:r,authenticationResources:l,platformService:c,config:d}=o,u=(0,a.h)(c,d),{headers:m,...p}=t,g={...u,...m};return{baseUrlPromise:()=>r.regionGtm("middleTier"),serviceName:e,authResource:l.mtAuthResource,models:n((e=>{const t=Promise.resolve({constructRequest:(0,i.$)(e,g),...p});return s(t)}))}},r=(e,t,n)=>a=>{const o=e((0,i.$)(a,t),n);return s(o)},s=e=>{const t=Object.assign(e,{allow:n=>(e.then((e=>e.allowedResponses=n)),t),withCustomTelemetry:n=>(e.then((e=>e.customTelemetry=n)),t),withRetry:n=>(e.then((e=>e.retryPolicy=n)),t),withResponse:n=>(e.then((e=>e.responseType=n)),t),withTransform:n=>(e.then((e=>e.transformResponse=n)),t)});return t}},994007:(e,t,n)=>{"use strict";function i(e,t,n){const i=new Error(e);return Object.assign(i,{reason:e,serverResponse:t,innerException:n})}n.d(t,{T:()=>i})},48524:(e,t,n)=>{"use strict";function i(e,t){return t?(...n)=>{const i=e(...n);return{...i,headers:{...t,...i.headers}}}:e}n.d(t,{$:()=>i})},719799:(e,t,n)=>{"use strict";n.d(t,{Sk:()=>r,xk:()=>s,hg:()=>l,jq:()=>c,SW:()=>d,m6:()=>u,m_:()=>m});var i=n(914953),a=n(316877),o=n(842070);const r=(e,t,n)=>{const i=[];let a="",o="",r=!1;return t.forEach((t=>{const s=t?.type||"";for(const e of n||[])if(e.enabled){if(e.fileType?.includes(s)){a=e.appType,o=e.appId,r=!0;break}e.fileType?.includes("all")&&(r=!0)}if(r){const n=((e,t,n,i)=>({location:e.objectUrl||"",type:"MeetingChat",subType:n,metadata:{appTitle:n,appId:i,userId:t,fileTitle:e.title||"",imageUrl:e.previewUrl||"",shareUrl:e.shareUrl||"",fileId:e.id,fileType:e.type||"",baseUrl:e.baseUrl||"",siteId:e.sharepointIds?.siteId||void 0,listItemUniqueId:e.sharepointIds?.listItemUniqueId||void 0}}))(t,e,a,o);i.push(n),a="",o="",r=!1}})),i},s=(e,t,n,i)=>({meetingUrl:n??"https://teams.microsoft.com",threadId:e,messageId:i,organizerUpn:t}),l=(e,t)=>{const n=t.newScenario(e);let o=n.id;return(0,i.z)(o)||(o=(0,a.v4)()),n.appendEventData({correlationId:o}),{scenario:n,correlationId:o}};function c(e,t){const n={message:e.reason?.[o.zm.logErrorMessage],statusCode:e.reason?.[o.zm.httpStatusCode],errorCode:e.reason?.[o.zm.internalErrorCode],subError:e.reason?.[o.zm.subError],correlationId:e.reason?.[o.zm.correlationId],cmdRequestId:e.reason?.[o.zm.cmdRequestId],reportingService:e.reason?.[o.zm.reportingService]};t.fail(n)}const d=(e,t)=>((e,t)=>{let n={};e.state&&(n={...n,state:e.state});e.isShared&&(n={...n,isShared:e.isShared});e.linkScope&&(n={...n,linkScope:e.linkScope});e.hostClient&&(n={...n,hostClient:e.hostClient});e.appId&&(n={...n,appId:e.appId});e.appTitle&&(n={...n,appTitle:e.appTitle});e.fileTitle&&(n={...n,fileTitle:e.fileTitle});e.imageUrl&&(n={...n,imageUrl:e.imageUrl});e.userId&&(n={...n,userId:e.userId});e.shareUrl&&(n={...n,shareUrl:e.shareUrl});e.fileId&&(n={...n,fileId:e.fileId});e.fileType&&(n={...n,fileType:e.fileType});e.baseUrl&&(n={...n,baseUrl:e.baseUrl});e.objectUrl&&(n={...n,objectUrl:e.objectUrl});e.meetingContentMetadataObject&&(n={...n,meetingContentMetadataObject:e.meetingContentMetadataObject});e.thumbnailUrl&&(n={...n,thumbnailUrl:e.thumbnailUrl});t&&e.siteId&&(n={...n,siteId:e.siteId});t&&e.listItemUniqueId&&(n={...n,listItemUniqueId:e.listItemUniqueId});return n})(e,t),u=(e,t)=>e.map((e=>((e,t)=>{const n=e.metadata??{};return{id:e.id,location:e.location,type:e.type,subType:n.appTitle??"",metadata:d(n,t)}})(e,t)));function m(e,t,n,i,a,o,r,s,l){return{externalEntityKey:e,seriesExternalEntityKey:t,organizer:n,user:i,meetingUrl:a.meetingUrl,threadId:a.threadId,messageId:a.messageId,organizerUpn:a.organizerUpn,resources:u(o,l),organizedByUserId:r,organizedByUserUpn:s}}},420257:(e,t,n)=>{"use strict";n.d(t,{E:()=>i,Z:()=>a});const i="beta/atpsafelinks/getpolicy/",a="atp-safelinks-policy"},342079:(e,t,n)=>{"use strict";n.d(t,{c:()=>y});var i=n(543491),a=n(924811),o=n(420257),r=n(683184),s=n(193672),l=n(945151),c=n(741679),d=n(37718);const u={source:"safelinks"},m=()=>({authOptions:u,url:o.E,method:"GET",serviceName:l.E.AtpSafelinksService,apiName:"safelink"}),p=(0,c.K)(l.E.AtpSafelinksService,{rejectHttpError:!0,allowedResponses:[d.qj.HTTP_2XX]},(e=>({getPolicy:e(m)}))),g=e=>{const t=(0,s.S)(e);return{getPolicy:h(t)}},h=e=>async()=>{const t=await e(m());return await t.body.json()};class y{constructor(e,t,n,i,a,o){this.send=e,this.scenarioFactory=t,this.localStorage=i,this.coreSettings=a,this.logger=n.newLogger("AtpSafelinksService","services-utilities-atp-safelinks"),this.atpSafelinksServiceTransport=((e,t,n)=>{const{enableEndpointsManagerOnAtpSafelinksService:i}=n.get(r.J.Messaging);return i?t.createApi(p):g(e)})(this.send,o,this.coreSettings)}async initPolicy(){const e=this.scenarioFactory.newScenario(i.RG.ATPGetPolicyTask);try{await this.getPolicy(),e.stop()}catch(t){const n=`Error getting ATP Safelinks policy: ${t.message||""}`;this.logger.error(n),e.fail({errors:n})}}async getPolicy(){return this.getPolicyFromLocalStore()??this.getPolicyFromRemote()}getPolicyFromLocalStore(){let e=null;try{const t=this.localStorage.get(o.Z);if(t){const n=JSON.parse(t);(0,a.z)(n.cookie,n.webAffinitizedUrl)?e=n:this.logger.log("Invalid policy found from localStorage, fetching new policy")}}catch(e){this.logger.error(`Error while getting ATP safelinks policy from localStorage: ${e}`)}return e}async getPolicyFromRemote(){let e=null;const t=this.scenarioFactory.newScenario(i.RG.ATPGetPolicy);try{const n=await this.atpSafelinksServiceTransport.getPolicy();this.localStorage?.trySet(o.Z,JSON.stringify(n),"Messaging"),this.logger.log(`ATP Policy isATPSafelinksEnabled: ${n.isATPSafelinksEnabled}`),t.stop(),e=n}catch(e){this.logger.error(`AtpSafelinks GetPolicy API failed with Error: ${e&&e.message}`),t.fail({errors:"atp_get_policy_failed"})}return e}}},985714:(e,t,n)=>{"use strict";n.d(t,{sX:()=>s,mH:()=>d,Wn:()=>u});var i=n(683184),a=n(390848);const o={access_token:{xms_cc:{values:["CP1"]}}},r=JSON.stringify(o),s=(e,t,n,a,s)=>{const d=((e,t)=>{const{caeEnabledResources:n}=t?.get(i.J.Auth)||{};return!(!e||!n||!(Array.isArray(n)&&n.findIndex((t=>e.includes(t)))>-1))})(e,s);let u=c(t,n,a);if(d&&(u=((e,t)=>{if(!t)return r;try{const e=JSON.parse(t);return e?.access_token?JSON.stringify({access_token:{...e.access_token,...o.access_token}}):r}catch(t){return void e?.errorToTelemetry?.("getClaimsForRequest: Json parsing failed","auth_add_claims_to_request",void 0,!0)}})(a,u)),n?.addEventData(["cp1"+(u?.includes("CP1")?"on":"off")]),t&&u&&u!==r){const e=l(u,a);e&&n?.addEventData([`claimsChallengeHeaderList:${e}`])}return u},l=(e,t)=>{try{const{access_token:t}=JSON.parse(e);if(t){if(t.xms_caeerror?.value&&!isNaN(Number(t.xms_caeerror.value))){const{xms_caeerror:e,...n}=t,i=`xms_caeerror_${e.value}`;return[...Object.keys(n),i].join()}return Object.keys(t).join()}return null}catch(e){return t?.errorToTelemetry?.("getClaimChallengeKeys: Json parsing failed","auth_add_claims_to_request",void 0,!0),null}},c=(e,t,n)=>{if(e&&"string"==typeof e&&""!==e.trim())try{const i=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)?(0,a.G)(e):e,o=JSON.parse(i);if(o&&"object"==typeof o)return t?.addEventData(["claim:"+ +!!i]),i;t?.addEventData(["invalidJSON"]),n?.log("Claims are not a valid json object, returning undefined.")}catch(e){t?.addEventData(["base64DecodeFail"]),n?.errorToTelemetry?.("validateAndDecodeClaims: invalid base64 string input","auth_add_claims_to_request",void 0,!0)}};var d;!function(e){e.WWW_AUTHENTICATE_HEADER="www-authenticate",e.ERROR_PREFIX="error=",e.CLAIMS_PREFIX="claims=",e.INSUFFICIENT_CLAIMS="insufficient_claims"}(d||(d={}));const u=(e,t)=>{const n={error:void 0,claims:void 0},i=e?.[d.WWW_AUTHENTICATE_HEADER];if(!i)return n;const o=i.split(",").filter(Boolean).map((e=>e.trim()));for(const e of o){const i=e.split('"');if(3===i.length)switch(i[0].toLocaleLowerCase()){case d.ERROR_PREFIX:n.error=i[1];break;case d.CLAIMS_PREFIX:n.claims=t?i[1]:(0,a.G)(i[1])}}return n}},354162:(e,t,n)=>{"use strict";n.d(t,{NH:()=>o,Ee:()=>r,sC:()=>s});var i=n(683184),a=n(907203);const o=e=>e.get(i.J.Auth).buildCloud,r=(e,t)=>{const n=t?.get(i.J.Auth).cloudDomainMap;if(!n)return;const o=n.find((t=>t.domain===e))?.cloud;return o?a.G7[o]:void 0},s=(e,t)=>{const n=t?.get(i.J.Auth).cloudDomainMap;if(!n||!e)return"";const a=n.find((t=>t.cloud===e))?.domain;return a?`https://${a}/v2/`:""}},330760:(e,t,n)=>{"use strict";n.d(t,{pZ:()=>m,eH:()=>p,Qk:()=>g,JX:()=>f,xT:()=>S,ce:()=>b,Ay:()=>w});var i=n(965517),a=n(907203),o=n(543491),r=n(683184),s=n(985714),l=n(799571),c=n(894638),d=n(7487);const u=l.uI.TWENTYFOUR*l.rF.ONE_HOUR;async function m(e,t,n,o,c,d,u,m,p){let g=i.Zw.Skype;const[h,k]=I(t,m),{forceRenew:C,tokenToRenew:N}=p||{};let E=!1,{ic3NonCaeResource:A,ic3CaeResource:_}=c.get(r.J.Auth);A||(A=l.ej.IC3_GATEWAY_AAD_KEY),_||(_=l.ej.IC3_GATEWAY_CAE_KEY),E=(await n.getUser())?.type===a.Ch.Anonymous,h?.addScenarioMark("ic3-gateway-token-helper-get-token-start",{commandSource:t,context:`preferredTokenTypes: ${e.map((e=>i.Zw[e]))}`});const F=E?i.Zw.Skype:S(t,c);let D;if(h?.addScenarioMark("ic3-gateway-token-helper-get-token-type-from-config",{commandSource:t,context:`SupportedTokenType: ${i.Zw[F]}`}),!E&&void 0!==d){const e="WWW-Authenticate",a=d.get(e);if(a){let e;if(h?.addScenarioMark("ic3-gateway-token-helper-parse-www-authn-header",{commandSource:t,context:"WWW-Authenticate headers present: true"}),void 0!==(e=T(a))){const t=(0,s.sX)(_,e,h,u,c);return v(_,i.Zw.CAE,n,h,k,t)}b(a)&&(h?.addScenarioMark("ic3-gateway-token-helper-parse-www-authn-header",{commandSource:t,context:"isSkypeTokenMigrationHeader: true"}),D=w(a),h?.addScenarioMark("ic3-gateway-token-helper-header-is-stm",{commandSource:t,context:`protocolFromHeader: ${i.Zw[D]}`}))}}switch(g=E?i.Zw.Skype:f(e,F,D),h?.addScenarioMark("ic3-gateway-token-helper-protocol-to-use",{commandSource:t,context:`protocolToUse: ${i.Zw[g]}`}),g){case i.Zw.Skype:return y(o,h,k,C);case i.Zw.AAD:return v(A,g,n,h,k,void 0,N);case i.Zw.CAE:return v(_,g,n,h,k);default:throw k?.({authEventData:"ic3-gateway-token-helper-get-token-end",reason:"Cannot determine protocol to use.",status:"failure"}),new Error(`cannot determine protocol to use. ${e}, ${t}, ${n}, ${o}, ${c}, ${d}`)}}const p=(e,t,n)=>{if(!e||!t)return;const i=e.get(t);if(i){if(!h(i.fallbackTime,n))return i.tokenType;e.delete(t)}},g=(e,t,n)=>{e&&t&&void 0!==n&&e.set(t,{tokenType:n,fallbackTime:(new Date).getTime()})},h=(e,t)=>{const{stmFallbackMapTimerInHr:n}=t.get(r.J.Auth),i=n?n*l.rF.ONE_HOUR:u;return(new Date).getTime()-e>i},y=async(e,t,n,a)=>{try{t?.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-start",{authEventData:`forceRenew: ${a}`}),await e.validateSkypeToken({forceRenew:a});const o={...await e.getSkypeTokenInfoFromDiscoveryResponse()};return o.expiration=Math.round(o.expiration/l.rF.MILLI_PER_SECOND),t?.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-end",{authEventData:`expiry in seconds: ${o.expiration}`,message:`expiry in seconds: ${o.expiration}`,status:"success"}),n?.(),{token:o,tokenType:i.Zw.Skype}}catch(e){throw t?.addScenarioMark("ic3-gateway-token-helper-acquire-skype-token-end",{error:e,status:"failure"}),n?.({error:e}),e}},v=async(e,t,n,i,a,o,r)=>{try{if(i?.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-start",{authEventData:`resource: ${e}, tokenToRenew: ${!!r}`}),n.acquireTokenV2){const s={tflClaim:r,...void 0!==o&&{claim:o}},c=await n.acquireTokenV2(e,s),d=Date.now(),u=(c?.expires-l.rF.SECONDS_PER_MINUTE)*l.rF.MILLI_PER_SECOND;return u<=d&&i?.addScenarioMark("ic3-gateway-token-helper-retry-aad-token-expiry-offset",{authEventData:`resource: ${e}, expiry in seconds: ${c.expires}, now: ${d}, time_diff: ${u-d}, fromCache: ${c.fromCache}`,message:`resource: ${e}, expiry in seconds: ${c.expires}, now: ${d}, time_diff: ${u-d}, fromCache: ${c.fromCache}`}),i?.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-end",{authEventData:`resource: ${e}, expiry_AuthService: ${c.expires}, fromCache: ${c.fromCache}`,message:`resource: ${e}, expiry_AuthService: ${c.expires}, fromCache: ${c.fromCache}`,status:"success"}),a?.(),{token:c,tokenType:t}}throw a?.({authEventData:`resource: ${e}`,reason:"IAuthenticationService does not have acquireTokenV2",status:"failure"}),new Error("IAuthenticationService does not have acquireTokenV2")}catch(t){throw i?.addScenarioMark("ic3-gateway-token-helper-acquire-aad-token-end",{authEventData:`resource: ${e}`,status:"failure",error:t}),a?.({error:t}),t}},f=(e,t,n)=>{e.sort(((e,t)=>t-e));const i=[e[0],t];return void 0!==n&&i.push(n),i.sort(((e,t)=>e-t)),i[0]},S=(e,t,n,o)=>{if(void 0===e||void 0===t||o?.type===a.Ch.Anonymous)return i.Zw.Skype;const{skypeTokenMigrationServiceInfo:s}=t.get(r.J.Auth),l=s?.find((t=>t?.source===e));if(void 0===l)return i.Zw.Skype;n?.addEventData([`source: ${l?.source}, isOnboarded: ${l?.isOnboarded},type: ${l?.tokenType}`]);const c=l?.isOnboarded,d=l?.tokenType;return c&&d?k(d):i.Zw.Skype},k=e=>{switch(e){case"Skype":return i.Zw.Skype;case"AAD":return i.Zw.AAD;case"CAE":return i.Zw.CAE}return e};var C;!function(e){e.TOKEN_TYPES="token_types="}(C||(C={}));const b=e=>e&&e.indexOf(C.TOKEN_TYPES)>-1&&e.indexOf(i.hO.BEARER)>-1,w=e=>{const t=e?.toLowerCase();return t?.indexOf("cae")>-1?i.Zw.CAE:t?.indexOf("aad")>-1?i.Zw.AAD:(t?.indexOf("skype"),i.Zw.Skype)},T=e=>{const t={[s.mH.WWW_AUTHENTICATE_HEADER]:e},n=(0,s.Wn)(t);return n&&n.error===s.mH.INSUFFICIENT_CLAIMS?n.claims:void 0},I=(e,t)=>{const n=o.RG.GetIC3GatewayToken,i={id:void 0!==t?t:(0,d.pW)(),scenarioName:n,source:e};try{const[e,t]=(0,c.OU)({options:{correlation:i},source:"ic3-gateway-token-helper",scenarioName:n,subContext:"ic3-gateway-token-helper::getIC3GateWayToken",startWithoutScenario:!1});return[e,t]}catch{return[void 0,void 0]}}},374038:(e,t,n)=>{"use strict";n.d(t,{N2:()=>o,$l:()=>r,Ej:()=>s});var i=n(907203),a=n(683184);function o(e,t,n){return r(e)&&(e?.role===i.w4.Anonymous||!s(t,n))}function r(e){return!!e?.isAuthenticated}function s(e,t){const{enableTflFreProfileConsentDialog:n}=e.get(a.J.Fre);return!(!n||t&&"true"===t.get("TflFreProfileCardDisplayed"))}},599134:(e,t,n)=>{"use strict";n.d(t,{I:()=>a});var i=n(66432);function a(e,t){const n=t?.clientTypeServiceHeader??e.config.clientType,a=t?.embedContext;return n===i.Bh.CDLWorker?i.Bh.CDLWorker:n===i.Bh.Embed&&a?`${i.Bh.Embed}-${a}`:n}},390848:(e,t,n)=>{"use strict";n.d(t,{J:()=>o,G:()=>r});var i=n(702135),a=n(689626);function o(e){if(!e)throw(0,i.Tr)(a.w5.Authentication,a.jK.InvalidInput,"parseJWT",void 0,`invalid token, value = ${e}`);try{const[,t]=e.split("."),n=r(t);return JSON.parse(n)}catch(t){throw(0,i.Tr)(a.w5.Authentication,a.jK.InvalidInput,"parseJWT",{innerError:t},`token contains dot = ${e.includes(".")}; token length = ${e.length}`)}}function r(e){if(!e)throw(0,i.Tr)(a.w5.Authentication,a.jK.InvalidInput,"base64DecodeStringUrlSafe",void 0,`invalid base64 string input, value = ${e}`);return e=e.replace(/-/g,"+").replace(/_/g,"/"),decodeURIComponent(escape(atob(e)))}},198418:(e,t,n)=>{"use strict";n.d(t,{B:()=>i});class i{constructor(e){this._cap=e,this._map=new Map}clear(){return this._map.clear()}entries(){return this._map.entries()}get(e){return this._map.get(e)}has(e){return this._map.has(e)}set(e,t){if(this._map.size>=this._cap){const e=this._map.keys().next().value;this._map.delete(e)}return this._map.set(e,t)}size(){return this._map.size}}},396015:(e,t,n)=>{"use strict";n.d(t,{g:()=>a});var i=n(803238);const a=(e,t)=>{if((0,i.isArray)(e))return t}},861914:(e,t,n)=>{"use strict";n.d(t,{E:()=>a,Y:()=>o});const i=({osName:e,osVersion:t})=>{if(e?.toLowerCase()?.includes("windows")&&t)try{const e=t.match(/^(\d+)\.(\d+)\.(\d+)$/),n=4,i=1,a=2,o=3;if(e&&e.length===n){const t=parseInt(e[i],10),n=parseInt(e[a],10);return{majorVersion:t,minorVersion:n,revision:parseInt(e[o],10)}}}catch{}},a=({osName:e,osVersion:t})=>{const n=i({osName:e,osVersion:t});return void 0!==n&&(n.majorVersion>=10&&n.minorVersion>=0&&n.revision>=22e3)},o=({osName:e,osVersion:t})=>{const n=i({osName:e,osVersion:t});return void 0!==n&&(10===n.majorVersion&&0===n.minorVersion&&n.revision<22e3&&n.revision>=10240)}},914953:(e,t,n)=>{"use strict";function i(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}n.d(t,{z:()=>i})},750082:(e,t,n)=>{"use strict";n.d(t,{h:()=>o});var i=n(945151),a=n(599134);function o(e,t,n,o){return{[i.f.xMsClientType]:(0,a.I)(e,t),[i.f.xMsClientVersion]:e.config.clientVersion,[i.f.xMsSessionId]:e.host.sessionId,[i.f.xMsRequestId]:n||"",[i.f.xMsClientCaller]:o||""}}},713410:(e,t,n)=>{"use strict";n.d(t,{WD:()=>i,av:()=>a,ax:()=>o,Hs:()=>r,nC:()=>s,bM:()=>l});const i="mainAppWindowActiveEntities",a="appActiveEntitiesHistory",o="mainWindowNavHistory",r="mainWindowNavHistoryIndex",s=e=>{const t=["mainAppWindowActiveEntities","mainWindowNavHistory","mainWindowNavHistoryIndex"];return e&&t.push(`${e}-mainAppWindowActiveEntities`,`${e}-mainWindowNavHistory`,`${e}-mainWindowNavHistoryIndex`),t},l=(e,t)=>`${t?`${t}-`:""}${e}`},730850:(e,t,n)=>{"use strict";n.d(t,{q:()=>i});const i=e=>e instanceof Date&&!isNaN(e.getTime())},269678:(e,t,n)=>{"use strict";n.d(t,{H:()=>s,c:()=>l});var i=n(739720),a=n(689626),o=n(543491),r=n(7487);const s="serviceId";class l{constructor(e,t,n,o,r,s){this.rebootService=e,this.host=t,this.logger=n,this.authenticationService=o,this.localStorage=r,this.experienceConfig=s,this.switchRing=async e=>{await this.clearCachedIndexFile();const t={qsps:{ring:e}};this.rebootService.rebootApp(i.Z.RingSwitch,i.d.DeveloperSwitchersService,t)},this.clearContainer=async()=>{await this.clearCachedIndexFile();this.rebootService.rebootApp(i.Z.ClearContainer,i.d.DeveloperSwitchersService,{qsps:{clearcontainer:"true"}})},this.clearCachedIndexFile=async()=>{try{if(void 0!==this.host.caches){const e=await this.host.caches.open(a.eL);await e.delete(`/${this.experienceConfig?.basePath}/`)}}catch(e){this.logger.error(`Clear cached index file before switching ring failed with error: ${e}`)}}}async switchService(e){if(this.logger.log(`Switch service to ${e}`),this.authenticationService.logout){const t=this.localStorage.get(s,"Experience")||void 0;this.localStorage.trySet(s,e,"Framework","Experience");const n=`logging out user to switch to service ${e}`;this.logger.infoToTelemetry?.(n,"service_switch",{currentState:t,newState:e},!0);const i={id:(0,r.pW)(),source:"developer-switchers-resolvers",scenarioName:o.RG.AuthWebLogout};return await this.authenticationService.logout({reason:n,correlation:i}),Promise.resolve(!0)}const t="authenticationService.logout not implemented!";return this.logger.errorToTelemetry?.(t,"service_switch",{newState:e,error:t},!0),Promise.resolve(!1)}}},557870:(e,t,n)=>{"use strict";n.d(t,{gD:()=>p,fM:()=>g});var i=n(925703),a=n(677362);const o=new RegExp(a.yH.oneNoteTargetRegex),r=new RegExp(a.yH.oneNoteSectionRegex),s=e=>{const t=o.exec(e);let n="";return t&&(n=t[1]),n},l=e=>{const t=r.exec(e);let n="";return t&&(n=t[1]),n};var c=n(627718);const d=new RegExp(a.yH.oneDriveFile),u=new RegExp(a.yH.sharePointFile),m=new RegExp(a.yH.spListItemPersonalUrlRegex),p=(e,t,n)=>{if(a.aA.includes(t))return null;const o=(0,i.Q)(e),r=o?o.replace(a.yH.trailingSlashRegex,""):"";let s,l=null,p="";if((0,c.Y1)(t)&&m.test(e)){let t=e.split(`/${a.HV.personal}/`)[1]||"";p=decodeURIComponent(t.split("/")[0]),t=e.split("/Lists/")[1]||"",s=decodeURIComponent(t.split("/")[0])}else if(d.test(e))p=a.HV.personal,s=r.split("/").pop();else if(u.test(e)){const t=r.split("/").pop()||"";p=decodeURIComponent(t);const n=2;s=decodeURIComponent(e.substring(r.length-1).split("/")[n])}if((p||s)&&(l={sourceTeamName:p,sourceChannelName:s}),t===a.BY.extension&&-1!==n?.indexOf(a.BY.extensionWithDot)){const e=y(n);e?.sectionGroup&&l&&(l.sourceChannelName=`${l.sourceChannelName} > ${e.sectionGroup}`),e?.section&&l&&(l.sourceChannelName=`${l.sourceChannelName} > ${e.section}`)}return l},g=(e,t)=>{let n=null;const i=decodeURIComponent(e);let a=s(i),o=l(a),r="";if(o.includes("/")){const e=o.lastIndexOf("/");a=a.substring(e+1),o=o.substring(e+1)}o=h(o);const c=t;t=o;const d=a.indexOf("/");if(-1!==d){const e=a.lastIndexOf("|");let n=a.substring(d+1,e);n=h(n),t=n,r=o}return n={title:t,noteBook:c,section:r},n},h=e=>e.replace(/(?:\\(.))/g,"$1"),y=e=>{let t=null,n="",i="",a="";e&&(n=decodeURIComponent(e));let o=s(n),r=l(o);if(r.includes("/")){const e=r.lastIndexOf("/");if(a=r.substring(0,e),a){const e=a.split("/");let t="";e.forEach((e=>{t=""===t?e:`${t} > ${e}`})),a=t}o=o.substring(e+1),r=r.substring(e+1)}return-1!==o.indexOf("/")&&(i=r),t={sectionGroup:h(a),section:h(i)},t}},674716:(e,t,n)=>{"use strict";n.d(t,{V:()=>s});var i=n(229113),a=n(249998),o=n(677362),r=n(702135);const s=(e,t,n)=>{const s=c(e),d=(0,r.O$)(e,i.z.internalErrorCode),u=(0,r.O$)(e,i.z.httpCode,e?.code||d||""),m={errorMessage:s,serverRequestId:(0,r.O$)(e,i.z.correlationId)};t(s),(0,a.X)(parseInt(u||"",10))&&!l(parseInt(u||"",10),d)?n&&n.fail({errors:JSON.stringify(m),errorCode:`${u}`}):n&&n.incomplete({errors:JSON.stringify(m),errorCode:`${u||o.BS.Unhandled}`})},l=(e,t)=>e&&e===o.Bx.badRequest&&t&&t===o.BS.InvalidRequest,c=e=>{let t=(0,r.O$)(e,i.z.logErrorMessage,e?.message||"");const n=(0,r.O$)(e,"innerError",{message:""});t=`${t}. ${n?n.message:""}`;const a={context:e?.context,subContext:e?.subContext};return t=`${t}. ${JSON.stringify(a)}`,t}},564168:(e,t,n)=>{"use strict";n.d(t,{qB:()=>i,rF:()=>a,IJ:()=>o,Zw:()=>r});const i={SSO_TOKEN:"OutlookSSOToken",ADDIN_ERROR:"OutlookAddInError",SSO_READY:"OutlookSSOReady",USE_CACHED_SSO_TOKEN:"OutlookUseCachedSSOToken",SSO_COMPLETE_TIME:"OutlookSSOCompleteTime",DIALOG_TRIGGER_TIME:"OutlookDialogTriggerTime",CONTEXT:"STTOutlookContext",STEP_MARKERS:"STTOutlookStepMarkers",AUTH_STRAP_ERROR:"STTOutlookAuthStrapError",AUTH_STRAP_REDIRECT_TIME:"STTOutlookAuthStrapRedirect",OAUTH_START_TIME:"OutlookOAuthStartTime",OAUTH_ELAPSED_TIME:"OutlookOAuthElapsedTime",PLATFORM_INFO:"OutlookPlatformInfo",STT_START_TIME:"STTExperienceStartTime"};var a,o,r;!function(e){e[e.HOURS_PER_DAY=24]="HOURS_PER_DAY",e[e.MINUTES_PER_HOUR=60]="MINUTES_PER_HOUR",e[e.SECONDS_PER_MINUTE=60]="SECONDS_PER_MINUTE",e[e.MILLISECS_PER_SECOND=1e3]="MILLISECS_PER_SECOND",e[e.TOKEN_EXP_MINUTE=10]="TOKEN_EXP_MINUTE",e[e.SSO_TIMEOUT_MILLISEC=7e3]="SSO_TIMEOUT_MILLISEC",e[e.SSO_RETRY_INTERVAL=100]="SSO_RETRY_INTERVAL",e[e.SSO_CLAIM_TIMEOUT_MINUTES=5]="SSO_CLAIM_TIMEOUT_MINUTES",e[e.SSO_CLAIM_TIMEOUT_MILLISEC=3e5]="SSO_CLAIM_TIMEOUT_MILLISEC",e[e.SSO_CLAIM_RETRY_INTERVAL=1e3]="SSO_CLAIM_RETRY_INTERVAL",e[e.STT_USAGE_EXPIRATION_DAYS=15]="STT_USAGE_EXPIRATION_DAYS",e[e.STT_USAGE_EXPIRATION_MILLISEC=1296e6]="STT_USAGE_EXPIRATION_MILLISEC"}(a||(a={})),function(e){e.NotProvided="NotProvided",e.Expired="Expired",e.Valid="Valid",e.Invalid="Invalid"}(o||(o={})),function(e){e.SSO="SSO",e.OAuth="OAuth"}(r||(r={}))},903692:(e,t,n)=>{"use strict";n.d(t,{j:()=>r});var i=n(1489),a=n(873640),o=n(59083);const r=(e,t,n,r)=>(0,i.z)((0,a.R)(((n,i)=>Array.from(function*(e,t,n,i){const a=e[Symbol.iterator](),o=t[Symbol.iterator]();let r=a.next(),s=o.next();for(;!s.done||!r.done;)s.done||!r.done&&s.value.id>r.value[0].id?(i(r.value[1]),r=a.next()):r.done||s.value.id<r.value[0].id?(yield[s.value,n(s.value)],s=o.next()):(yield[s.value,r.value[1]],r=a.next(),s=o.next())}(n,Array.from(i).sort(((e,t)=>e.id.localeCompare(t.id))),(t=>{try{return{type:"value",value:e(t)}}catch(e){return r&&r(t,e),{type:"error",error:e}}}),(e=>{if("error"!==e.type)return t(e.value)})))),[]),(0,o.U)((e=>e.filter((e=>"value"===e[1].type)).map((e=>n(e[0],e[1].value))))))},567885:(e,t,n)=>{"use strict";n.d(t,{W:()=>i,m:()=>a});const i=(e,t)=>e.split(" ").filter((e=>e===`itemtype="${t}"`)).length,a=(e,t)=>t.map((t=>i(e,t))).reduce(((e,t)=>t+e),0)},456366:(e,t,n)=>{"use strict";n.d(t,{Y:()=>r});var i=n(567885),a=n(72742);const o=(e,t)=>{const n=Date.now();if(!e)return void t.warn(`calculateTimeDifferenceToNow:: Invalid inputTime provided, returning undefined. inputTime isNull=${null===e}, isUndefined=${void 0===e}`);const i=Number(e);if(!isNaN(i))return n-i;t.warn("calculateTimeDifferenceToNow:: Invalid inputTime provided, numericRepresentation isNan=true")};function r(e){const{scenario:t,logger:n}=e;if(!t)return void n.warn(`sendMessageScenarioTelemetry:: Scenario was not provided, unable to append event data. scenario isNull=${null===t}, isUndefined=${void 0===t}`);const r=function(e){const{message:t,logger:n}=e,r=t?.content??"";return{filesCount:t?.files?.length??0,imagesCount:(0,i.m)(r,[a.T.amsImage,a.T.inlineImage,a.T.cachedImage]),videosCount:(0,i.W)(r,a.T.amsVideo),gifCount:(0,i.W)(r,a.T.giphy),stickerCount:(0,i.W)(r,a.T.sticker),emojiCount:(0,i.m)(r,[a.T.emoji,a.T.customEmoji]),isCrossPost:!!t?.crossPostChannels?.length,timeSinceOriginalSend:o(t?.originalSendPipelineTime,n),oamRetryCount:e.oamRetryCount,isOamRetry:e.oamRetryCount>0}}(e);t.appendEventData(r)}},532522:(e,t,n)=>{"use strict";var i;n.d(t,{JP:()=>i,UM:()=>a,ZZ:()=>o,Ny:()=>r}),function(e){e.unified="unified",e.split="split",e.none="none"}(i||(i={}));const a=(e,t,n,a)=>{const{hasUserEnabledAdaptiveRailForDesktop:o,hasUserEnabledUnifiedAppForDesktop:r}=a;return e&&t&&o?n&&!r?i.split:i.unified:i.none},o=e=>{const{hasUserEnabledAdaptiveRailForDesktop:t}=e;return!!t},r=e=>{const{hasUserEnabledUnifiedAppForDesktop:t}=e;return!1===t?i.split:i.unified}},761902:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var i=n(96496);const a=(e,t)=>{try{return e.matchMedia(i.s0.ColorContrastOverride).matches?(t?.log(`OS Theme Matches: ${i.s0.ColorContrastOverride}`),i.f8.Contrast):e.matchMedia(i.s0.Dark).matches?(t?.log(`OS Theme Matches: ${i.s0.Dark}`),i.f8.Dark):e.matchMedia(i.s0.Light).matches?(t?.log(`OS Theme Matches: ${i.s0.Light}`),i.f8.Light):(t?.log("OS Theme Matches: None. Returning theme type light."),i.f8.Light)}catch(e){return void t?.log(`Couldn't resolve getOsTheme: ${e.message}`)}}},64340:(e,t,n)=>{"use strict";n.d(t,{R6:()=>r,FP:()=>l,sN:()=>c,OA:()=>d,u_:()=>u});var i=n(379658),a=n(96496),o=n(761902);const r=e=>({[a.f8.Light]:e===i.s.life?a.Q2.DefaultTfl:a.Q2.DefaultV2,[a.f8.Dark]:e===i.s.life?a.Q2.DarkTfl:a.Q2.DarkV2,[a.f8.Contrast]:a.Q2.HighContrast}),s=(e,t)=>t[e]||a.Q2.DefaultV2,l=()=>({[a.Q2.Default]:a.f8.Light,[a.Q2.DefaultV2]:a.f8.Light,[a.Q2.DefaultTfl]:a.f8.Light,[a.Q2.Dark]:a.f8.Dark,[a.Q2.DarkV2]:a.f8.Dark,[a.Q2.DarkTfl]:a.f8.Dark,[a.Q2.HighContrast]:a.f8.Contrast}),c=(e,t)=>t[e]||a.f8.Light,d=e=>c(e,l()),u=(e,t,n,i)=>{const a=e.getPreferences("theme")??{};return m(a,t,n,i)},m=(e,t,n,i)=>{const r=p(t);if(r)return r;if(e.followOsTheme){const e=(0,o.Z)(t,i);if(e)return s(e,n)}else if(e.userTheme)return s(e.userTheme,n);return a.Q2.DefaultV2},p=e=>{const t=new URLSearchParams(e.location.search).get("theme");if(t){const e=Object.keys(a.Q2).find((e=>e.toUpperCase()===t.toUpperCase()));return a.Q2[e]}}},212325:(e,t,n)=>{"use strict";n.d(t,{as:()=>i});const i=(e,t)=>{if(e.is(t))return t;throw new TypeError}},381721:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNENkQ2RDYiLz4KPHBhdGggZD0iTTI1Ljk5OTMgMzBDMjUuOTk5MyAyOS40NDg0IDI1LjU1MjIgMjkuMDAxMyAyNS4wMDA2IDI5LjAwMTNDMjQuNDQ5MSAyOS4wMDEzIDI0LjAwMiAyOS40NDg0IDI0LjAwMiAzMEMyNC4wMDIgMzAuNTUxNSAyNC40NDkxIDMwLjk5ODYgMjUuMDAwNiAzMC45OTg2QzI1LjU1MjIgMzAuOTk4NiAyNS45OTkzIDMwLjU1MTUgMjUuOTk5MyAzMFpNMjUuNzQwMSAyMi4xNDY3QzI1LjY5MDEgMjEuNzgwNyAyNS4zNzYxIDIxLjQ5ODggMjQuOTk2NCAyMS40OTkxQzI0LjU4MjIgMjEuNDk5NCAyNC4yNDY3IDIxLjgzNTQgMjQuMjQ3IDIyLjI0OTdMMjQuMjUwNiAyNi43NTEzTDI0LjI1NzUgMjYuODUzQzI0LjMwNzUgMjcuMjE5MSAyNC42MjE1IDI3LjUwMSAyNS4wMDEyIDI3LjUwMDdDMjUuNDE1NCAyNy41MDAzIDI1Ljc1MDkgMjcuMTY0MyAyNS43NTA2IDI2Ljc1MDFMMjUuNzQ3IDIyLjI0ODVMMjUuNzQwMSAyMi4xNDY3Wk0yNi45NjkzIDE2LjY1ODlDMjYuMTEzIDE1LjExMTEgMjMuODg3OCAxNS4xMTExIDIzLjAzMTYgMTYuNjU4OUwxNS4yODYzIDMwLjY2MDRDMTQuNDU2OCAzMi4xNiAxNS41NDE0IDMzLjk5OTUgMTcuMjU1MiAzMy45OTk1SDMyLjc0NjJDMzQuNDYgMzMuOTk5NSAzNS41NDQ2IDMyLjE2IDM0LjcxNSAzMC42NjAzTDI2Ljk2OTMgMTYuNjU4OVpNMjQuMzQ0MiAxNy4zODVDMjQuNjI5NiAxNi44NjkxIDI1LjM3MTMgMTYuODY5MSAyNS42NTY3IDE3LjM4NUwzMy40MDI1IDMxLjM4NjVDMzMuNjc5IDMxLjg4NjMgMzMuMzE3NSAzMi40OTk1IDMyLjc0NjIgMzIuNDk5NUgxNy4yNTUyQzE2LjY4MzkgMzIuNDk5NSAxNi4zMjI0IDMxLjg4NjMgMTYuNTk4OSAzMS4zODY1TDI0LjM0NDIgMTcuMzg1WiIgZmlsbD0iIzMzMzMzMyIvPgo8L3N2Zz4K"},383657:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNENkQ2RDYiLz4KPHBhdGggZD0iTTIxLjIwNjkgMTdDMjEuNjY3NSAxNyAyMi4xMTUzIDE3LjE0MTMgMjIuNDkwOSAxNy40MDIzTDIyLjY0NzMgMTcuNTIxNUwyNS4wMjIgMTkuNUgzMi43NUMzMy44ODY3IDE5LjUgMzQuODI2NiAyMC4zNDMgMzQuOTc4NSAyMS40Mzc5TDM0Ljk5NDggMjEuNTk2TDM1IDIxLjc1VjMwLjc1QzM1IDMxLjk0MDkgMzQuMDc0OCAzMi45MTU2IDMyLjkwNCAzMi45OTQ4TDMyLjc1IDMzSDE3LjI1QzE2LjA1OTEgMzMgMTUuMDg0NCAzMi4wNzQ4IDE1LjAwNTIgMzAuOTA0TDE1IDMwLjc1VjE5LjI1QzE1IDE4LjA1OTEgMTUuOTI1MiAxNy4wODQ0IDE3LjA5NiAxNy4wMDUyTDE3LjI1IDE3SDIxLjIwNjlaTTIyLjY0NzMgMjIuOTc4NUMyMi4yOTM1IDIzLjI3MzMgMjEuODU5MSAyMy40NTE1IDIxLjQwMzQgMjMuNDkxNEwyMS4yMDY5IDIzLjVMMTYuNSAyMy40OTlWMzAuNzVDMTYuNSAzMS4xMjk3IDE2Ljc4MjIgMzEuNDQzNSAxNy4xNDgyIDMxLjQ5MzJMMTcuMjUgMzEuNUgzMi43NUMzMy4xMjk3IDMxLjUgMzMuNDQzNSAzMS4yMTc4IDMzLjQ5MzIgMzAuODUxOEwzMy41IDMwLjc1VjIxLjc1QzMzLjUgMjEuMzcwMyAzMy4yMTc4IDIxLjA1NjUgMzIuODUxOCAyMS4wMDY4TDMyLjc1IDIxSDI1LjAyMUwyMi42NDczIDIyLjk3ODVaTTIxLjIwNjkgMTguNUgxNy4yNUMxNi44NzAzIDE4LjUgMTYuNTU2NSAxOC43ODIyIDE2LjUwNjggMTkuMTQ4MkwxNi41IDE5LjI1VjIxLjk5OUwyMS4yMDY5IDIyQzIxLjM0NzMgMjIgMjEuNDg0MSAyMS45NjA2IDIxLjYwMjIgMjEuODg3NEwyMS42ODcxIDIxLjgyNjJMMjMuNTc4IDIwLjI0OUwyMS42ODcxIDE4LjY3MzhDMjEuNTc5MiAxOC41ODQgMjEuNDQ4OSAxOC41MjY2IDIxLjMxMTMgMTguNTA3M0wyMS4yMDY5IDE4LjVaIiBmaWxsPSIjMzMzMzMzIi8+Cjwvc3ZnPgo="},285474:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIHZpZXdCb3g9IjAgMCA1MCA1MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGNpcmNsZSBjeD0iMjUiIGN5PSIyNSIgcj0iMjUiIGZpbGw9IiNENkQ2RDYiLz4KPHBhdGggZD0iTTMxLjc0OTggMzMuNDk1MUMzMi4xNjQgMzMuNDk0OSAzMi41IDMzLjgzMDYgMzIuNSAzNC4yNDQ4QzMyLjUgMzQuNjU5IDMyLjE2NDQgMzQuOTk0OSAzMS43NTAyIDM0Ljk5NTFMMTguNzUwMiAzNC45OTg4QzE4LjMzNiAzNC45OTg5IDE4IDM0LjY2MzIgMTggMzQuMjQ5QzE4IDMzLjgzNDggMTguMzM1NiAzMy40OTg5IDE4Ljc0OTggMzMuNDk4OEwzMS43NDk4IDMzLjQ5NTFaTTI1LjE0ODIgMTUuMDA2OEwyNS4yNSAxNUMyNS42Mjk3IDE1IDI1Ljk0MzUgMTUuMjgyMiAyNS45OTMyIDE1LjY0ODJMMjYgMTUuNzVMMjUuOTk5IDI5LjQzNUwyOS43MjA4IDI1LjcxNDdDMjkuOTg3MSAyNS40NDg0IDMwLjQwMzggMjUuNDI0MyAzMC42OTc0IDI1LjY0MjJMMzAuNzgxNSAyNS43MTQ4QzMxLjA0NzcgMjUuOTgxMSAzMS4wNzE5IDI2LjM5NzcgMzAuODU0IDI2LjY5MTNMMzAuNzgxNCAyNi43NzU0TDI1Ljc4MzcgMzEuNzcyMUMyNS41MTc2IDMyLjAzODEgMjUuMTAxMiAzMi4wNjI0IDI0LjgwNzYgMzEuODQ0OUwyNC43MjM1IDMxLjc3MjRMMTkuNzIgMjYuNzc1N0MxOS40MjY5IDI2LjQ4MzEgMTkuNDI2NiAyNi4wMDgyIDE5LjcxOTMgMjUuNzE1MUMxOS45ODU0IDI1LjQ0ODYgMjAuNDAyIDI1LjQyNDEgMjAuNjk1OCAyNS42NDE4TDIwLjc4IDI1LjcxNDRMMjQuNDk5IDI5LjQyOEwyNC41IDE1Ljc1QzI0LjUgMTUuMzcwMyAyNC43ODIyIDE1LjA1NjUgMjUuMTQ4MiAxNS4wMDY4TDI1LjI1IDE1TDI1LjE0ODIgMTUuMDA2OFoiIGZpbGw9IiMzMzMzMzMiLz4KPC9zdmc+Cg=="},122057:(e,t,n)=>{var i={"./ar-sa/activity.js":[298228,625622],"./ar-sa/artifacts-platform.js":[88162,134508],"./ar-sa/audience-view-dialog.js":[888145,158571],"./ar-sa/auth.js":[595308,625622],"./ar-sa/autosuggest.js":[543117,625622],"./ar-sa/avatar.js":[607748,625622],"./ar-sa/biometric-enrollment.js":[772192,575363],"./ar-sa/breakout-rooms.js":[992492,384177],"./ar-sa/broadcast.js":[567708,410412],"./ar-sa/calendar.js":[864153,642143],"./ar-sa/calling.js":[195108,396624],"./ar-sa/campaign-notifications.js":[191240,625622],"./ar-sa/carousel-multi-card.js":[null],"./ar-sa/cast.js":[74267,625622],"./ar-sa/channels.js":[141251,625622],"./ar-sa/chat-list.js":[445002,625622],"./ar-sa/coach-report.js":[660310,690514],"./ar-sa/comment-stream.js":[413591,403734],"./ar-sa/communities.js":[336272,625622],"./ar-sa/compose.js":[548512,625622],"./ar-sa/contacts.js":[637084,625622],"./ar-sa/datepicker.js":[316194,682989],"./ar-sa/desktop.js":[null],"./ar-sa/digital-signage.js":[null],"./ar-sa/discover-surface.js":[475585,170918],"./ar-sa/edu.js":[934064,73297],"./ar-sa/embed.js":[113687,625622],"./ar-sa/errors.js":[530122,625622],"./ar-sa/esp.js":[601750,210828],"./ar-sa/extensibility-ptz-extension.js":[null],"./ar-sa/extensibility-room-remote.js":[null],"./ar-sa/extensibility.js":[114969,625622],"./ar-sa/feedback.js":[749779,237598],"./ar-sa/files.js":[832242,625622],"./ar-sa/framework.js":[6173,625622],"./ar-sa/freemium-upgrade.js":[null],"./ar-sa/funstuff.js":[137745,122675],"./ar-sa/gallery.js":[358430,374917],"./ar-sa/growth.js":[282773,625622],"./ar-sa/guardians.js":[975917,841795],"./ar-sa/health.js":[78071,808438],"./ar-sa/help.js":[null],"./ar-sa/hololens.js":[500181,396624],"./ar-sa/host-controls.js":[5994,262667],"./ar-sa/jana.js":[276413,707481],"./ar-sa/lightbox.js":[405856,625622],"./ar-sa/live-persona-card.js":[435088,625622],"./ar-sa/live-persona-editor.js":[608250,698249],"./ar-sa/lms-integration.js":[null],"./ar-sa/meet-for-work.js":[119432,149974],"./ar-sa/meeting-analytics.js":[179106,600629],"./ar-sa/meeting-apis-app.js":[null],"./ar-sa/meeting-bot.js":[null],"./ar-sa/meeting-collaboration.js":[814319,528749],"./ar-sa/meeting-flyout.js":[363053,625622],"./ar-sa/meeting-meet-app.js":[3367,625622],"./ar-sa/meeting-options.js":[325264,608656],"./ar-sa/meeting-recap.js":[273372,9143],"./ar-sa/meeting-room-console.js":[null],"./ar-sa/meeting-stream-app.js":[null],"./ar-sa/message-escalate-dialog.js":[781308,614542],"./ar-sa/messaging.js":[185498,625622],"./ar-sa/mobile-attach.js":[null],"./ar-sa/mtma-missed-notifications.js":[990846,625622],"./ar-sa/nova.js":[874036,625622],"./ar-sa/people-app.js":[null],"./ar-sa/people-picker.js":[591045,625622],"./ar-sa/people-targeting.js":[967062,995682],"./ar-sa/people.js":[1227,625622],"./ar-sa/person.js":[748843,625622],"./ar-sa/phonelink-sms.js":[629996,763045],"./ar-sa/pre-core.js":[null],"./ar-sa/premium-benefits.js":[805199,614133],"./ar-sa/presence.js":[703038,625622],"./ar-sa/queues.js":[67334,723966],"./ar-sa/recurrence.js":[738554,396362],"./ar-sa/rsc-application-permissions.js":[null],"./ar-sa/search.js":[212523,682989],"./ar-sa/semantic-object.js":[256916,504317],"./ar-sa/settings.js":[19448,625622],"./ar-sa/share-in-meetings.js":[null],"./ar-sa/share-to-teams-outlook-addin.js":[null],"./ar-sa/share-to-teams-third-party.js":[null],"./ar-sa/share-to-teams.js":[455594,574853],"./ar-sa/shortcut.js":[307893,625622],"./ar-sa/shortcuts.js":[594776,625622],"./ar-sa/simple-collab.js":[412227,625622],"./ar-sa/smart-device.js":[null],"./ar-sa/survey.js":[271363,434287],"./ar-sa/sv-flyout.js":[742358,625622],"./ar-sa/teams-and-channels.js":[364241,715523],"./ar-sa/teams-insider.js":[574280,625622],"./ar-sa/telemetry.js":[426556,625622],"./ar-sa/tfl-homepage.js":[262728,625622],"./ar-sa/tfl-onboarding.js":[954278,625622],"./ar-sa/toast-notifications.js":[223006,625622],"./ar-sa/trusted-ui.js":[null],"./ar-sa/unified-search.js":[295939,574853],"./ar-sa/unsupported-browser.js":[null],"./ar-sa/url-preview.js":[622171,625622],"./ar-sa/video-capture.js":[21592,364091],"./ar-sa/video-message.js":[131535,751789],"./ar-sa/virtual-consumer-events.js":[542348,164269],"./ar-sa/virtual-events.js":[385164,534918],"./ar-sa/webinar.js":[987909,369621],"./ar-sa/welcome-bot.js":[null],"./ar-sa/whats-new.js":[126945,625622],"./ar-sa/wiki.js":[null],"./az-latn-az/activity.js":[687364,451822],"./az-latn-az/artifacts-platform.js":[111918,323871],"./az-latn-az/audience-view-dialog.js":[573645,88553],"./az-latn-az/auth.js":[430280,451822],"./az-latn-az/autosuggest.js":[12614,451822],"./az-latn-az/avatar.js":[455166,451822],"./az-latn-az/biometric-enrollment.js":[312605,896555],"./az-latn-az/breakout-rooms.js":[37296,790149],"./az-latn-az/broadcast.js":[242698,212243],"./az-latn-az/calendar.js":[784508,572324],"./az-latn-az/calling.js":[23929,997686],"./az-latn-az/campaign-notifications.js":[144149,451822],"./az-latn-az/carousel-multi-card.js":[null],"./az-latn-az/cast.js":[429021,451822],"./az-latn-az/channels.js":[892980,451822],"./az-latn-az/chat-list.js":[935940,451822],"./az-latn-az/coach-report.js":[77752,551052],"./az-latn-az/comment-stream.js":[389229,914557],"./az-latn-az/communities.js":[971158,451822],"./az-latn-az/compose.js":[459118,451822],"./az-latn-az/contacts.js":[609885,451822],"./az-latn-az/datepicker.js":[877411,580016],"./az-latn-az/desktop.js":[null],"./az-latn-az/digital-signage.js":[null],"./az-latn-az/discover-surface.js":[157995,953303],"./az-latn-az/edu.js":[581861,375543],"./az-latn-az/embed.js":[125631,451822],"./az-latn-az/errors.js":[455173,451822],"./az-latn-az/esp.js":[34051,705406],"./az-latn-az/extensibility-ptz-extension.js":[null],"./az-latn-az/extensibility-room-remote.js":[null],"./az-latn-az/extensibility.js":[639092,451822],"./az-latn-az/feedback.js":[612295,170418],"./az-latn-az/files.js":[305138,451822],"./az-latn-az/framework.js":[967296,451822],"./az-latn-az/freemium-upgrade.js":[null],"./az-latn-az/funstuff.js":[304579,850506],"./az-latn-az/gallery.js":[13550,188146],"./az-latn-az/growth.js":[471030,451822],"./az-latn-az/guardians.js":[615265,706767],"./az-latn-az/health.js":[384375,386032],"./az-latn-az/help.js":[null],"./az-latn-az/hololens.js":[381837,997686],"./az-latn-az/host-controls.js":[443087,776357],"./az-latn-az/jana.js":[223783,398056],"./az-latn-az/lightbox.js":[463515,451822],"./az-latn-az/live-persona-card.js":[20600,451822],"./az-latn-az/live-persona-editor.js":[490024,306031],"./az-latn-az/lms-integration.js":[null],"./az-latn-az/meet-for-work.js":[292367,391829],"./az-latn-az/meeting-analytics.js":[175229,469482],"./az-latn-az/meeting-apis-app.js":[null],"./az-latn-az/meeting-bot.js":[null],"./az-latn-az/meeting-collaboration.js":[869178,461215],"./az-latn-az/meeting-flyout.js":[893412,451822],"./az-latn-az/meeting-meet-app.js":[309995,451822],"./az-latn-az/meeting-options.js":[884935,983695],"./az-latn-az/meeting-recap.js":[143912,70849],"./az-latn-az/meeting-room-console.js":[null],"./az-latn-az/meeting-stream-app.js":[null],"./az-latn-az/message-escalate-dialog.js":[767625,870902],"./az-latn-az/messaging.js":[146971,451822],"./az-latn-az/mobile-attach.js":[null],"./az-latn-az/mtma-missed-notifications.js":[77989,451822],"./az-latn-az/nova.js":[549160,451822],"./az-latn-az/people-app.js":[null],"./az-latn-az/people-picker.js":[257045,451822],"./az-latn-az/people-targeting.js":[33099,424677],"./az-latn-az/people.js":[193730,451822],"./az-latn-az/person.js":[643245,451822],"./az-latn-az/phonelink-sms.js":[34067,257164],"./az-latn-az/pre-core.js":[null],"./az-latn-az/premium-benefits.js":[345927,868532],"./az-latn-az/presence.js":[599444,451822],"./az-latn-az/queues.js":[202888,427903],"./az-latn-az/recurrence.js":[981881,724092],"./az-latn-az/rsc-application-permissions.js":[null],"./az-latn-az/search.js":[456853,580016],"./az-latn-az/semantic-object.js":[986718,770293],"./az-latn-az/settings.js":[144439,451822],"./az-latn-az/share-in-meetings.js":[null],"./az-latn-az/share-to-teams-outlook-addin.js":[null],"./az-latn-az/share-to-teams-third-party.js":[null],"./az-latn-az/share-to-teams.js":[673975,154423],"./az-latn-az/shortcut.js":[658541,451822],"./az-latn-az/shortcuts.js":[819260,451822],"./az-latn-az/simple-collab.js":[839975,451822],"./az-latn-az/smart-device.js":[null],"./az-latn-az/survey.js":[772445,172479],"./az-latn-az/sv-flyout.js":[96338,451822],"./az-latn-az/teams-and-channels.js":[642409,274403],"./az-latn-az/teams-insider.js":[367276,451822],"./az-latn-az/telemetry.js":[79433,451822],"./az-latn-az/tfl-homepage.js":[317572,451822],"./az-latn-az/tfl-onboarding.js":[379901,451822],"./az-latn-az/toast-notifications.js":[272620,451822],"./az-latn-az/trusted-ui.js":[null],"./az-latn-az/unified-search.js":[541976,154423],"./az-latn-az/unsupported-browser.js":[null],"./az-latn-az/url-preview.js":[579462,451822],"./az-latn-az/video-capture.js":[97013,461803],"./az-latn-az/video-message.js":[486314,292584],"./az-latn-az/virtual-consumer-events.js":[99695,590526],"./az-latn-az/virtual-events.js":[910969,266179],"./az-latn-az/webinar.js":[469951,716804],"./az-latn-az/welcome-bot.js":[null],"./az-latn-az/whats-new.js":[231175,451822],"./az-latn-az/wiki.js":[null],"./bg-bg/activity.js":[271390,950747],"./bg-bg/artifacts-platform.js":[956094,333560],"./bg-bg/audience-view-dialog.js":[907319,419562],"./bg-bg/auth.js":[923495,950747],"./bg-bg/autosuggest.js":[115652,950747],"./bg-bg/avatar.js":[571935,950747],"./bg-bg/biometric-enrollment.js":[40165,87417],"./bg-bg/breakout-rooms.js":[286088,751764],"./bg-bg/broadcast.js":[245489,243890],"./bg-bg/calendar.js":[535505,292712],"./bg-bg/calling.js":[367578,154788],"./bg-bg/campaign-notifications.js":[800223,950747],"./bg-bg/carousel-multi-card.js":[null],"./bg-bg/cast.js":[699103,950747],"./bg-bg/channels.js":[906821,950747],"./bg-bg/chat-list.js":[334918,950747],"./bg-bg/coach-report.js":[239658,930972],"./bg-bg/comment-stream.js":[251148,765924],"./bg-bg/communities.js":[946077,950747],"./bg-bg/compose.js":[40584,950747],"./bg-bg/contacts.js":[821789,950747],"./bg-bg/datepicker.js":[757005,93050],"./bg-bg/desktop.js":[null],"./bg-bg/digital-signage.js":[null],"./bg-bg/discover-surface.js":[324353,777384],"./bg-bg/edu.js":[979877,676953],"./bg-bg/embed.js":[469220,950747],"./bg-bg/errors.js":[130743,950747],"./bg-bg/esp.js":[153596,687921],"./bg-bg/extensibility-ptz-extension.js":[null],"./bg-bg/extensibility-room-remote.js":[null],"./bg-bg/extensibility.js":[30873,950747],"./bg-bg/feedback.js":[249425,213722],"./bg-bg/files.js":[447659,950747],"./bg-bg/framework.js":[374608,950747],"./bg-bg/freemium-upgrade.js":[null],"./bg-bg/funstuff.js":[82961,574010],"./bg-bg/gallery.js":[310654,40416],"./bg-bg/growth.js":[793190,950747],"./bg-bg/guardians.js":[924970,984975],"./bg-bg/health.js":[759762,665641],"./bg-bg/help.js":[null],"./bg-bg/hololens.js":[722758,154788],"./bg-bg/host-controls.js":[972002,54425],"./bg-bg/jana.js":[787676,649030],"./bg-bg/lightbox.js":[79091,950747],"./bg-bg/live-persona-card.js":[960370,950747],"./bg-bg/live-persona-editor.js":[798306,850739],"./bg-bg/lms-integration.js":[null],"./bg-bg/meet-for-work.js":[682769,877414],"./bg-bg/meeting-analytics.js":[971873,798696],"./bg-bg/meeting-apis-app.js":[null],"./bg-bg/meeting-bot.js":[null],"./bg-bg/meeting-collaboration.js":[723047,99504],"./bg-bg/meeting-flyout.js":[611422,950747],"./bg-bg/meeting-meet-app.js":[387788,950747],"./bg-bg/meeting-options.js":[786780,72333],"./bg-bg/meeting-recap.js":[612996,36018],"./bg-bg/meeting-room-console.js":[null],"./bg-bg/meeting-stream-app.js":[null],"./bg-bg/message-escalate-dialog.js":[77514,453120],"./bg-bg/messaging.js":[153968,950747],"./bg-bg/mobile-attach.js":[null],"./bg-bg/mtma-missed-notifications.js":[696268,950747],"./bg-bg/nova.js":[575596,950747],"./bg-bg/people-app.js":[null],"./bg-bg/people-picker.js":[358008,950747],"./bg-bg/people-targeting.js":[809330,263237],"./bg-bg/people.js":[939180,950747],"./bg-bg/person.js":[417112,950747],"./bg-bg/phonelink-sms.js":[875957,263667],"./bg-bg/pre-core.js":[null],"./bg-bg/premium-benefits.js":[173487,303143],"./bg-bg/presence.js":[641233,950747],"./bg-bg/queues.js":[578802,200650],"./bg-bg/recurrence.js":[232682,904685],"./bg-bg/rsc-application-permissions.js":[null],"./bg-bg/search.js":[185417,93050],"./bg-bg/semantic-object.js":[66619,938652],"./bg-bg/settings.js":[798720,950747],"./bg-bg/share-in-meetings.js":[null],"./bg-bg/share-to-teams-outlook-addin.js":[null],"./bg-bg/share-to-teams-third-party.js":[null],"./bg-bg/share-to-teams.js":[501089,56738],"./bg-bg/shortcut.js":[183282,950747],"./bg-bg/shortcuts.js":[439841,950747],"./bg-bg/simple-collab.js":[151537,950747],"./bg-bg/smart-device.js":[null],"./bg-bg/survey.js":[82625,878864],"./bg-bg/sv-flyout.js":[728558,950747],"./bg-bg/teams-and-channels.js":[689885,730235],"./bg-bg/teams-insider.js":[207829,950747],"./bg-bg/telemetry.js":[612708,950747],"./bg-bg/tfl-homepage.js":[464975,950747],"./bg-bg/tfl-onboarding.js":[126555,950747],"./bg-bg/toast-notifications.js":[623136,950747],"./bg-bg/trusted-ui.js":[null],"./bg-bg/unified-search.js":[27584,56738],"./bg-bg/unsupported-browser.js":[null],"./bg-bg/url-preview.js":[989155,950747],"./bg-bg/video-capture.js":[896494,692235],"./bg-bg/video-message.js":[808889,189711],"./bg-bg/virtual-consumer-events.js":[869202,203290],"./bg-bg/virtual-events.js":[232420,714927],"./bg-bg/webinar.js":[756834,428488],"./bg-bg/welcome-bot.js":[null],"./bg-bg/whats-new.js":[872404,950747],"./bg-bg/wiki.js":[null],"./ca-es-valencia/activity.js":[12467,207056],"./ca-es-valencia/artifacts-platform.js":[408541,363857],"./ca-es-valencia/audience-view-dialog.js":[66496,604918],"./ca-es-valencia/auth.js":[156705,207056],"./ca-es-valencia/autosuggest.js":[367912,207056],"./ca-es-valencia/avatar.js":[252446,207056],"./ca-es-valencia/biometric-enrollment.js":[240891,162716],"./ca-es-valencia/breakout-rooms.js":[682573,870057],"./ca-es-valencia/broadcast.js":[748779,884441],"./ca-es-valencia/calendar.js":[945905,678220],"./ca-es-valencia/calling.js":[618139,156722],"./ca-es-valencia/campaign-notifications.js":[852129,207056],"./ca-es-valencia/carousel-multi-card.js":[null],"./ca-es-valencia/cast.js":[340614,207056],"./ca-es-valencia/channels.js":[255741,207056],"./ca-es-valencia/chat-list.js":[632874,207056],"./ca-es-valencia/coach-report.js":[533486,159556],"./ca-es-valencia/comment-stream.js":[514259,9160],"./ca-es-valencia/communities.js":[446515,207056],"./ca-es-valencia/compose.js":[374365,207056],"./ca-es-valencia/contacts.js":[987475,207056],"./ca-es-valencia/datepicker.js":[372784,301400],"./ca-es-valencia/desktop.js":[null],"./ca-es-valencia/digital-signage.js":[null],"./ca-es-valencia/discover-surface.js":[504406,782196],"./ca-es-valencia/edu.js":[988085,282305],"./ca-es-valencia/embed.js":[258081,207056],"./ca-es-valencia/errors.js":[321064,207056],"./ca-es-valencia/esp.js":[775643,74837],"./ca-es-valencia/extensibility-ptz-extension.js":[null],"./ca-es-valencia/extensibility-room-remote.js":[null],"./ca-es-valencia/extensibility.js":[318357,207056],"./ca-es-valencia/feedback.js":[446402,906998],"./ca-es-valencia/files.js":[226584,207056],"./ca-es-valencia/framework.js":[55604,207056],"./ca-es-valencia/freemium-upgrade.js":[null],"./ca-es-valencia/funstuff.js":[628342,66011],"./ca-es-valencia/gallery.js":[196271,230191],"./ca-es-valencia/growth.js":[254194,207056],"./ca-es-valencia/guardians.js":[435602,486855],"./ca-es-valencia/health.js":[3438,434626],"./ca-es-valencia/help.js":[null],"./ca-es-valencia/hololens.js":[929743,156722],"./ca-es-valencia/host-controls.js":[451483,484323],"./ca-es-valencia/jana.js":[741691,114965],"./ca-es-valencia/lightbox.js":[405037,207056],"./ca-es-valencia/live-persona-card.js":[463066,207056],"./ca-es-valencia/live-persona-editor.js":[408057,646735],"./ca-es-valencia/lms-integration.js":[null],"./ca-es-valencia/meet-for-work.js":[206974,189591],"./ca-es-valencia/meeting-analytics.js":[396298,610652],"./ca-es-valencia/meeting-apis-app.js":[null],"./ca-es-valencia/meeting-bot.js":[null],"./ca-es-valencia/meeting-collaboration.js":[468590,677740],"./ca-es-valencia/meeting-flyout.js":[626336,207056],"./ca-es-valencia/meeting-meet-app.js":[23535,207056],"./ca-es-valencia/meeting-options.js":[988223,245915],"./ca-es-valencia/meeting-recap.js":[912737,973771],"./ca-es-valencia/meeting-room-console.js":[null],"./ca-es-valencia/meeting-stream-app.js":[null],"./ca-es-valencia/message-escalate-dialog.js":[307400,781288],"./ca-es-valencia/messaging.js":[3674,207056],"./ca-es-valencia/mobile-attach.js":[null],"./ca-es-valencia/mtma-missed-notifications.js":[704847,207056],"./ca-es-valencia/nova.js":[304086,207056],"./ca-es-valencia/people-app.js":[null],"./ca-es-valencia/people-picker.js":[281561,207056],"./ca-es-valencia/people-targeting.js":[864092,231402],"./ca-es-valencia/people.js":[75049,207056],"./ca-es-valencia/person.js":[897923,207056],"./ca-es-valencia/phonelink-sms.js":[183074,262146],"./ca-es-valencia/pre-core.js":[null],"./ca-es-valencia/premium-benefits.js":[331810,497937],"./ca-es-valencia/presence.js":[346318,207056],"./ca-es-valencia/queues.js":[836480,327612],"./ca-es-valencia/recurrence.js":[460728,691643],"./ca-es-valencia/rsc-application-permissions.js":[null],"./ca-es-valencia/search.js":[499971,301400],"./ca-es-valencia/semantic-object.js":[2617,817638],"./ca-es-valencia/settings.js":[416674,207056],"./ca-es-valencia/share-in-meetings.js":[null],"./ca-es-valencia/share-to-teams-outlook-addin.js":[null],"./ca-es-valencia/share-to-teams-third-party.js":[null],"./ca-es-valencia/share-to-teams.js":[928115,500906],"./ca-es-valencia/shortcut.js":[919731,207056],"./ca-es-valencia/shortcuts.js":[701357,207056],"./ca-es-valencia/simple-collab.js":[666972,207056],"./ca-es-valencia/smart-device.js":[null],"./ca-es-valencia/survey.js":[794807,270706],"./ca-es-valencia/sv-flyout.js":[445921,207056],"./ca-es-valencia/teams-and-channels.js":[17256,295589],"./ca-es-valencia/teams-insider.js":[304003,207056],"./ca-es-valencia/telemetry.js":[408335,207056],"./ca-es-valencia/tfl-homepage.js":[500923,207056],"./ca-es-valencia/tfl-onboarding.js":[656013,207056],"./ca-es-valencia/toast-notifications.js":[513251,207056],"./ca-es-valencia/trusted-ui.js":[null],"./ca-es-valencia/unified-search.js":[451392,500906],"./ca-es-valencia/unsupported-browser.js":[null],"./ca-es-valencia/url-preview.js":[275142,207056],"./ca-es-valencia/video-capture.js":[547471,478526],"./ca-es-valencia/video-message.js":[732839,273177],"./ca-es-valencia/virtual-consumer-events.js":[170648,967509],"./ca-es-valencia/virtual-events.js":[166362,699458],"./ca-es-valencia/webinar.js":[34011,513478],"./ca-es-valencia/welcome-bot.js":[null],"./ca-es-valencia/whats-new.js":[691254,207056],"./ca-es-valencia/wiki.js":[null],"./ca-es/activity.js":[219480,483240],"./ca-es/artifacts-platform.js":[87800,461336],"./ca-es/audience-view-dialog.js":[294035,792193],"./ca-es/auth.js":[590272,483240],"./ca-es/autosuggest.js":[462820,483240],"./ca-es/avatar.js":[596172,483240],"./ca-es/biometric-enrollment.js":[101372,206279],"./ca-es/breakout-rooms.js":[340251,739625],"./ca-es/broadcast.js":[366520,264078],"./ca-es/calendar.js":[65327,45196],"./ca-es/calling.js":[277835,396079],"./ca-es/campaign-notifications.js":[96211,483240],"./ca-es/carousel-multi-card.js":[null],"./ca-es/cast.js":[806436,483240],"./ca-es/channels.js":[886868,483240],"./ca-es/chat-list.js":[668979,483240],"./ca-es/coach-report.js":[48935,85637],"./ca-es/comment-stream.js":[295285,73731],"./ca-es/communities.js":[999489,483240],"./ca-es/compose.js":[961357,483240],"./ca-es/contacts.js":[281997,483240],"./ca-es/datepicker.js":[630467,499648],"./ca-es/desktop.js":[null],"./ca-es/digital-signage.js":[null],"./ca-es/discover-surface.js":[954229,717704],"./ca-es/edu.js":[271104,861024],"./ca-es/embed.js":[317485,483240],"./ca-es/errors.js":[450345,483240],"./ca-es/esp.js":[80584,403626],"./ca-es/extensibility-ptz-extension.js":[null],"./ca-es/extensibility-room-remote.js":[null],"./ca-es/extensibility.js":[142619,483240],"./ca-es/feedback.js":[147435,593930],"./ca-es/files.js":[908523,483240],"./ca-es/framework.js":[408222,483240],"./ca-es/freemium-upgrade.js":[null],"./ca-es/funstuff.js":[187769,698012],"./ca-es/gallery.js":[380508,605363],"./ca-es/growth.js":[503341,483240],"./ca-es/guardians.js":[129003,337232],"./ca-es/health.js":[119534,823264],"./ca-es/help.js":[null],"./ca-es/hololens.js":[178328,396079],"./ca-es/host-controls.js":[535841,441467],"./ca-es/jana.js":[927267,644495],"./ca-es/lightbox.js":[114404,483240],"./ca-es/live-persona-card.js":[784037,483240],"./ca-es/live-persona-editor.js":[957699,580387],"./ca-es/lms-integration.js":[null],"./ca-es/meet-for-work.js":[383095,815469],"./ca-es/meeting-analytics.js":[415163,335020],"./ca-es/meeting-apis-app.js":[null],"./ca-es/meeting-bot.js":[null],"./ca-es/meeting-collaboration.js":[179961,481166],"./ca-es/meeting-flyout.js":[313713,483240],"./ca-es/meeting-meet-app.js":[412928,483240],"./ca-es/meeting-options.js":[739407,417589],"./ca-es/meeting-recap.js":[192498,788864],"./ca-es/meeting-room-console.js":[null],"./ca-es/meeting-stream-app.js":[null],"./ca-es/message-escalate-dialog.js":[326868,914629],"./ca-es/messaging.js":[969388,483240],"./ca-es/mobile-attach.js":[null],"./ca-es/mtma-missed-notifications.js":[232864,483240],"./ca-es/nova.js":[382646,483240],"./ca-es/people-app.js":[null],"./ca-es/people-picker.js":[121792,483240],"./ca-es/people-targeting.js":[908073,527639],"./ca-es/people.js":[381498,483240],"./ca-es/person.js":[211378,483240],"./ca-es/phonelink-sms.js":[762931,611443],"./ca-es/pre-core.js":[null],"./ca-es/premium-benefits.js":[482552,428428],"./ca-es/presence.js":[423059,483240],"./ca-es/queues.js":[960409,400287],"./ca-es/recurrence.js":[698906,87237],"./ca-es/rsc-application-permissions.js":[null],"./ca-es/search.js":[969225,499648],"./ca-es/semantic-object.js":[697997,116676],"./ca-es/settings.js":[7038,483240],"./ca-es/share-in-meetings.js":[null],"./ca-es/share-to-teams-outlook-addin.js":[null],"./ca-es/share-to-teams-third-party.js":[null],"./ca-es/share-to-teams.js":[716774,594772],"./ca-es/shortcut.js":[708220,483240],"./ca-es/shortcuts.js":[951071,483240],"./ca-es/simple-collab.js":[95685,483240],"./ca-es/smart-device.js":[null],"./ca-es/survey.js":[92859,284765],"./ca-es/sv-flyout.js":[972159,483240],"./ca-es/teams-and-channels.js":[860774,376001],"./ca-es/teams-insider.js":[154447,483240],"./ca-es/telemetry.js":[717785,483240],"./ca-es/tfl-homepage.js":[605919,483240],"./ca-es/tfl-onboarding.js":[740381,483240],"./ca-es/toast-notifications.js":[207965,483240],"./ca-es/trusted-ui.js":[null],"./ca-es/unified-search.js":[790744,594772],"./ca-es/unsupported-browser.js":[null],"./ca-es/url-preview.js":[860458,483240],"./ca-es/video-capture.js":[111666,653075],"./ca-es/video-message.js":[286812,673889],"./ca-es/virtual-consumer-events.js":[527260,465344],"./ca-es/virtual-events.js":[564248,849448],"./ca-es/webinar.js":[745923,257405],"./ca-es/welcome-bot.js":[null],"./ca-es/whats-new.js":[106914,483240],"./ca-es/wiki.js":[null],"./cs-cz/activity.js":[850979,132076],"./cs-cz/artifacts-platform.js":[650946,967953],"./cs-cz/audience-view-dialog.js":[714313,154039],"./cs-cz/auth.js":[390459,132076],"./cs-cz/autosuggest.js":[280930,132076],"./cs-cz/avatar.js":[569204,132076],"./cs-cz/biometric-enrollment.js":[405798,542985],"./cs-cz/breakout-rooms.js":[947363,742109],"./cs-cz/broadcast.js":[529226,95844],"./cs-cz/calendar.js":[582789,120132],"./cs-cz/calling.js":[643919,53615],"./cs-cz/campaign-notifications.js":[393461,132076],"./cs-cz/carousel-multi-card.js":[null],"./cs-cz/cast.js":[886323,132076],"./cs-cz/channels.js":[890629,132076],"./cs-cz/chat-list.js":[901315,132076],"./cs-cz/coach-report.js":[120311,922194],"./cs-cz/comment-stream.js":[836044,336006],"./cs-cz/communities.js":[854671,132076],"./cs-cz/compose.js":[676964,132076],"./cs-cz/contacts.js":[678314,132076],"./cs-cz/datepicker.js":[469988,600284],"./cs-cz/desktop.js":[null],"./cs-cz/digital-signage.js":[null],"./cs-cz/discover-surface.js":[339989,958646],"./cs-cz/edu.js":[951703,735611],"./cs-cz/embed.js":[569257,132076],"./cs-cz/errors.js":[679807,132076],"./cs-cz/esp.js":[539044,707536],"./cs-cz/extensibility-ptz-extension.js":[null],"./cs-cz/extensibility-room-remote.js":[null],"./cs-cz/extensibility.js":[155869,132076],"./cs-cz/feedback.js":[48257,755771],"./cs-cz/files.js":[879807,132076],"./cs-cz/framework.js":[587042,132076],"./cs-cz/freemium-upgrade.js":[null],"./cs-cz/funstuff.js":[883899,94207],"./cs-cz/gallery.js":[270755,662990],"./cs-cz/growth.js":[697938,132076],"./cs-cz/guardians.js":[436047,943212],"./cs-cz/health.js":[108255,453356],"./cs-cz/help.js":[null],"./cs-cz/hololens.js":[770883,53615],"./cs-cz/host-controls.js":[638686,740542],"./cs-cz/jana.js":[178198,911177],"./cs-cz/lightbox.js":[727105,132076],"./cs-cz/live-persona-card.js":[447546,132076],"./cs-cz/live-persona-editor.js":[229782,673280],"./cs-cz/lms-integration.js":[null],"./cs-cz/meet-for-work.js":[568920,37436],"./cs-cz/meeting-analytics.js":[960296,911637],"./cs-cz/meeting-apis-app.js":[null],"./cs-cz/meeting-bot.js":[null],"./cs-cz/meeting-collaboration.js":[767012,51704],"./cs-cz/meeting-flyout.js":[966953,132076],"./cs-cz/meeting-meet-app.js":[281203,132076],"./cs-cz/meeting-options.js":[835352,459166],"./cs-cz/meeting-recap.js":[149887,243158],"./cs-cz/meeting-room-console.js":[null],"./cs-cz/meeting-stream-app.js":[null],"./cs-cz/message-escalate-dialog.js":[238752,992480],"./cs-cz/messaging.js":[214264,132076],"./cs-cz/mobile-attach.js":[null],"./cs-cz/mtma-missed-notifications.js":[635060,132076],"./cs-cz/nova.js":[727746,132076],"./cs-cz/people-app.js":[null],"./cs-cz/people-picker.js":[180046,132076],"./cs-cz/people-targeting.js":[1236,440824],"./cs-cz/people.js":[968097,132076],"./cs-cz/person.js":[337686,132076],"./cs-cz/phonelink-sms.js":[328386,943397],"./cs-cz/pre-core.js":[null],"./cs-cz/premium-benefits.js":[33542,483314],"./cs-cz/presence.js":[47206,132076],"./cs-cz/queues.js":[208699,988486],"./cs-cz/recurrence.js":[582906,98857],"./cs-cz/rsc-application-permissions.js":[null],"./cs-cz/search.js":[792429,600284],"./cs-cz/semantic-object.js":[492091,385869],"./cs-cz/settings.js":[214625,132076],"./cs-cz/share-in-meetings.js":[null],"./cs-cz/share-to-teams-outlook-addin.js":[null],"./cs-cz/share-to-teams-third-party.js":[null],"./cs-cz/share-to-teams.js":[359768,125532],"./cs-cz/shortcut.js":[477026,132076],"./cs-cz/shortcuts.js":[105821,132076],"./cs-cz/simple-collab.js":[690849,132076],"./cs-cz/smart-device.js":[null],"./cs-cz/survey.js":[716441,788207],"./cs-cz/sv-flyout.js":[495872,132076],"./cs-cz/teams-and-channels.js":[665418,126263],"./cs-cz/teams-insider.js":[746684,132076],"./cs-cz/telemetry.js":[326694,132076],"./cs-cz/tfl-homepage.js":[331010,132076],"./cs-cz/tfl-onboarding.js":[718543,132076],"./cs-cz/toast-notifications.js":[673999,132076],"./cs-cz/trusted-ui.js":[null],"./cs-cz/unified-search.js":[364298,125532],"./cs-cz/unsupported-browser.js":[null],"./cs-cz/url-preview.js":[629621,132076],"./cs-cz/video-capture.js":[512694,579880],"./cs-cz/video-message.js":[216950,347924],"./cs-cz/virtual-consumer-events.js":[557383,454148],"./cs-cz/virtual-events.js":[289218,119374],"./cs-cz/webinar.js":[194524,151397],"./cs-cz/welcome-bot.js":[null],"./cs-cz/whats-new.js":[41703,132076],"./cs-cz/wiki.js":[null],"./cy-gb/activity.js":[743940,952344],"./cy-gb/artifacts-platform.js":[712725,860319],"./cy-gb/audience-view-dialog.js":[349682,351685],"./cy-gb/auth.js":[248369,952344],"./cy-gb/autosuggest.js":[100459,952344],"./cy-gb/avatar.js":[314393,952344],"./cy-gb/biometric-enrollment.js":[756524,317734],"./cy-gb/breakout-rooms.js":[515442,615483],"./cy-gb/broadcast.js":[676909,818364],"./cy-gb/calendar.js":[551864,477661],"./cy-gb/calling.js":[549471,705875],"./cy-gb/campaign-notifications.js":[702240,952344],"./cy-gb/carousel-multi-card.js":[null],"./cy-gb/cast.js":[284581,952344],"./cy-gb/channels.js":[859756,952344],"./cy-gb/chat-list.js":[536168,952344],"./cy-gb/coach-report.js":[926494,678153],"./cy-gb/comment-stream.js":[822669,887683],"./cy-gb/communities.js":[727934,952344],"./cy-gb/compose.js":[402422,952344],"./cy-gb/contacts.js":[116014,952344],"./cy-gb/datepicker.js":[940215,398842],"./cy-gb/desktop.js":[null],"./cy-gb/digital-signage.js":[null],"./cy-gb/discover-surface.js":[473938,292044],"./cy-gb/edu.js":[707153,214301],"./cy-gb/embed.js":[296109,952344],"./cy-gb/errors.js":[975418,952344],"./cy-gb/esp.js":[200144,459982],"./cy-gb/extensibility-ptz-extension.js":[null],"./cy-gb/extensibility-room-remote.js":[null],"./cy-gb/extensibility.js":[809065,952344],"./cy-gb/feedback.js":[574807,384120],"./cy-gb/files.js":[393450,952344],"./cy-gb/framework.js":[221199,952344],"./cy-gb/freemium-upgrade.js":[null],"./cy-gb/funstuff.js":[851538,160982],"./cy-gb/gallery.js":[666524,954009],"./cy-gb/growth.js":[990805,952344],"./cy-gb/guardians.js":[230418,394476],"./cy-gb/health.js":[260026,337425],"./cy-gb/help.js":[null],"./cy-gb/hololens.js":[311440,705875],"./cy-gb/host-controls.js":[660184,563297],"./cy-gb/jana.js":[918403,64332],"./cy-gb/lightbox.js":[702070,952344],"./cy-gb/live-persona-card.js":[552222,952344],"./cy-gb/live-persona-editor.js":[886732,868098],"./cy-gb/lms-integration.js":[null],"./cy-gb/meet-for-work.js":[947290,339730],"./cy-gb/meeting-analytics.js":[668957,891041],"./cy-gb/meeting-apis-app.js":[null],"./cy-gb/meeting-bot.js":[null],"./cy-gb/meeting-collaboration.js":[516907,304788],"./cy-gb/meeting-flyout.js":[298702,952344],"./cy-gb/meeting-meet-app.js":[381564,952344],"./cy-gb/meeting-options.js":[450017,910122],"./cy-gb/meeting-recap.js":[418848,613299],"./cy-gb/meeting-room-console.js":[null],"./cy-gb/meeting-stream-app.js":[null],"./cy-gb/message-escalate-dialog.js":[670499,803073],"./cy-gb/messaging.js":[199699,952344],"./cy-gb/mobile-attach.js":[null],"./cy-gb/mtma-missed-notifications.js":[804984,952344],"./cy-gb/nova.js":[394668,952344],"./cy-gb/people-app.js":[null],"./cy-gb/people-picker.js":[143781,952344],"./cy-gb/people-targeting.js":[950071,914044],"./cy-gb/people.js":[333745,952344],"./cy-gb/person.js":[510313,952344],"./cy-gb/phonelink-sms.js":[767190,784017],"./cy-gb/pre-core.js":[null],"./cy-gb/premium-benefits.js":[337524,330690],"./cy-gb/presence.js":[959406,952344],"./cy-gb/queues.js":[737663,5748],"./cy-gb/recurrence.js":[588834,940125],"./cy-gb/rsc-application-permissions.js":[null],"./cy-gb/search.js":[407976,398842],"./cy-gb/semantic-object.js":[95257,855200],"./cy-gb/settings.js":[862364,952344],"./cy-gb/share-in-meetings.js":[null],"./cy-gb/share-to-teams-outlook-addin.js":[null],"./cy-gb/share-to-teams-third-party.js":[null],"./cy-gb/share-to-teams.js":[733739,120765],"./cy-gb/shortcut.js":[519918,952344],"./cy-gb/shortcuts.js":[907560,952344],"./cy-gb/simple-collab.js":[66470,952344],"./cy-gb/smart-device.js":[null],"./cy-gb/survey.js":[257311,250936],"./cy-gb/sv-flyout.js":[667419,952344],"./cy-gb/teams-and-channels.js":[781786,424444],"./cy-gb/teams-insider.js":[861758,952344],"./cy-gb/telemetry.js":[937415,952344],"./cy-gb/tfl-homepage.js":[836020,952344],"./cy-gb/tfl-onboarding.js":[270746,952344],"./cy-gb/toast-notifications.js":[619511,952344],"./cy-gb/trusted-ui.js":[null],"./cy-gb/unified-search.js":[597371,120765],"./cy-gb/unsupported-browser.js":[null],"./cy-gb/url-preview.js":[842671,952344],"./cy-gb/video-capture.js":[216894,504484],"./cy-gb/video-message.js":[47900,803941],"./cy-gb/virtual-consumer-events.js":[253533,231759],"./cy-gb/virtual-events.js":[261375,998813],"./cy-gb/webinar.js":[87450,855320],"./cy-gb/welcome-bot.js":[null],"./cy-gb/whats-new.js":[315046,952344],"./cy-gb/wiki.js":[null],"./da-dk/activity.js":[615959,906990],"./da-dk/artifacts-platform.js":[64012,613980],"./da-dk/audience-view-dialog.js":[244353,237123],"./da-dk/auth.js":[564194,906990],"./da-dk/autosuggest.js":[602696,906990],"./da-dk/avatar.js":[432169,906990],"./da-dk/biometric-enrollment.js":[560380,533884],"./da-dk/breakout-rooms.js":[688180,513691],"./da-dk/broadcast.js":[748687,764009],"./da-dk/calendar.js":[544983,700826],"./da-dk/calling.js":[948710,610319],"./da-dk/campaign-notifications.js":[957007,906990],"./da-dk/carousel-multi-card.js":[null],"./da-dk/cast.js":[885723,906990],"./da-dk/channels.js":[832977,906990],"./da-dk/chat-list.js":[387150,906990],"./da-dk/coach-report.js":[299702,105183],"./da-dk/comment-stream.js":[856465,827120],"./da-dk/communities.js":[988949,906990],"./da-dk/compose.js":[533217,906990],"./da-dk/contacts.js":[413855,906990],"./da-dk/datepicker.js":[269252,704120],"./da-dk/desktop.js":[null],"./da-dk/digital-signage.js":[null],"./da-dk/discover-surface.js":[813588,983999],"./da-dk/edu.js":[59300,156716],"./da-dk/embed.js":[778224,906990],"./da-dk/errors.js":[742152,906990],"./da-dk/esp.js":[639958,436856],"./da-dk/extensibility-ptz-extension.js":[null],"./da-dk/extensibility-room-remote.js":[null],"./da-dk/extensibility.js":[45056,906990],"./da-dk/feedback.js":[328711,830598],"./da-dk/files.js":[888405,906990],"./da-dk/framework.js":[828214,906990],"./da-dk/freemium-upgrade.js":[null],"./da-dk/funstuff.js":[877967,355706],"./da-dk/gallery.js":[83627,657426],"./da-dk/growth.js":[372739,906990],"./da-dk/guardians.js":[788317,552876],"./da-dk/health.js":[347430,280520],"./da-dk/help.js":[null],"./da-dk/hololens.js":[548706,610319],"./da-dk/host-controls.js":[115605,717943],"./da-dk/jana.js":[406035,956121],"./da-dk/lightbox.js":[461895,906990],"./da-dk/live-persona-card.js":[453175,906990],"./da-dk/live-persona-editor.js":[2817,24348],"./da-dk/lms-integration.js":[null],"./da-dk/meet-for-work.js":[314427,392796],"./da-dk/meeting-analytics.js":[685983,507004],"./da-dk/meeting-apis-app.js":[null],"./da-dk/meeting-bot.js":[null],"./da-dk/meeting-collaboration.js":[33910,855531],"./da-dk/meeting-flyout.js":[358957,906990],"./da-dk/meeting-meet-app.js":[677254,906990],"./da-dk/meeting-options.js":[106372,210749],"./da-dk/meeting-recap.js":[496302,723063],"./da-dk/meeting-room-console.js":[null],"./da-dk/meeting-stream-app.js":[null],"./da-dk/message-escalate-dialog.js":[749743,57020],"./da-dk/messaging.js":[812086,906990],"./da-dk/mobile-attach.js":[null],"./da-dk/mtma-missed-notifications.js":[17736,906990],"./da-dk/nova.js":[86801,906990],"./da-dk/people-app.js":[null],"./da-dk/people-picker.js":[209706,906990],"./da-dk/people-targeting.js":[2432,514533],"./da-dk/people.js":[597843,906990],"./da-dk/person.js":[346359,906990],"./da-dk/phonelink-sms.js":[926853,811210],"./da-dk/pre-core.js":[null],"./da-dk/premium-benefits.js":[510666,631157],"./da-dk/presence.js":[605482,906990],"./da-dk/queues.js":[188247,934672],"./da-dk/recurrence.js":[487004,23280],"./da-dk/rsc-application-permissions.js":[null],"./da-dk/search.js":[631926,704120],"./da-dk/semantic-object.js":[122623,503966],"./da-dk/settings.js":[899472,906990],"./da-dk/share-in-meetings.js":[null],"./da-dk/share-to-teams-outlook-addin.js":[null],"./da-dk/share-to-teams-third-party.js":[null],"./da-dk/share-to-teams.js":[507669,74120],"./da-dk/shortcut.js":[563267,906990],"./da-dk/shortcuts.js":[780664,906990],"./da-dk/simple-collab.js":[801405,906990],"./da-dk/smart-device.js":[null],"./da-dk/survey.js":[233911,274590],"./da-dk/sv-flyout.js":[693277,906990],"./da-dk/teams-and-channels.js":[727218,545321],"./da-dk/teams-insider.js":[626888,906990],"./da-dk/telemetry.js":[898502,906990],"./da-dk/tfl-homepage.js":[996277,906990],"./da-dk/tfl-onboarding.js":[37856,906990],"./da-dk/toast-notifications.js":[585305,906990],"./da-dk/trusted-ui.js":[null],"./da-dk/unified-search.js":[993456,74120],"./da-dk/unsupported-browser.js":[null],"./da-dk/url-preview.js":[169296,906990],"./da-dk/video-capture.js":[807026,417274],"./da-dk/video-message.js":[231422,503266],"./da-dk/virtual-consumer-events.js":[258225,383524],"./da-dk/virtual-events.js":[346895,282118],"./da-dk/webinar.js":[492657,478755],"./da-dk/welcome-bot.js":[null],"./da-dk/whats-new.js":[324879,906990],"./da-dk/wiki.js":[null],"./de-de/activity.js":[831656,536397],"./de-de/artifacts-platform.js":[853517,813802],"./de-de/audience-view-dialog.js":[717560,914712],"./de-de/auth.js":[31766,536397],"./de-de/autosuggest.js":[198757,536397],"./de-de/avatar.js":[368491,536397],"./de-de/biometric-enrollment.js":[539415,562050],"./de-de/breakout-rooms.js":[764295,157427],"./de-de/broadcast.js":[729303,67131],"./de-de/calendar.js":[621183,468734],"./de-de/calling.js":[957171,497507],"./de-de/campaign-notifications.js":[968482,536397],"./de-de/carousel-multi-card.js":[null],"./de-de/cast.js":[339457,536397],"./de-de/channels.js":[772757,536397],"./de-de/chat-list.js":[22592,536397],"./de-de/coach-report.js":[675847,312374],"./de-de/comment-stream.js":[205879,224189],"./de-de/communities.js":[217698,536397],"./de-de/compose.js":[371071,536397],"./de-de/contacts.js":[829345,536397],"./de-de/datepicker.js":[924189,109545],"./de-de/desktop.js":[null],"./de-de/digital-signage.js":[null],"./de-de/discover-surface.js":[497805,535964],"./de-de/edu.js":[232394,486943],"./de-de/embed.js":[52052,536397],"./de-de/errors.js":[520899,536397],"./de-de/esp.js":[397492,959048],"./de-de/extensibility-ptz-extension.js":[null],"./de-de/extensibility-room-remote.js":[null],"./de-de/extensibility.js":[774283,536397],"./de-de/feedback.js":[876678,892214],"./de-de/files.js":[789749,536397],"./de-de/framework.js":[709707,536397],"./de-de/freemium-upgrade.js":[null],"./de-de/funstuff.js":[899793,935521],"./de-de/gallery.js":[765771,432106],"./de-de/growth.js":[760567,536397],"./de-de/guardians.js":[146923,257052],"./de-de/health.js":[349952,926884],"./de-de/help.js":[null],"./de-de/hololens.js":[147035,497507],"./de-de/host-controls.js":[595807,133230],"./de-de/jana.js":[535658,480713],"./de-de/lightbox.js":[980893,536397],"./de-de/live-persona-card.js":[1878,536397],"./de-de/live-persona-editor.js":[168981,572848],"./de-de/lms-integration.js":[null],"./de-de/meet-for-work.js":[504586,804102],"./de-de/meeting-analytics.js":[931236,75667],"./de-de/meeting-apis-app.js":[null],"./de-de/meeting-bot.js":[null],"./de-de/meeting-collaboration.js":[936824,51093],"./de-de/meeting-flyout.js":[714761,536397],"./de-de/meeting-meet-app.js":[42019,536397],"./de-de/meeting-options.js":[136940,731908],"./de-de/meeting-recap.js":[20167,756204],"./de-de/meeting-room-console.js":[null],"./de-de/meeting-stream-app.js":[null],"./de-de/message-escalate-dialog.js":[109714,100741],"./de-de/messaging.js":[32515,536397],"./de-de/mobile-attach.js":[null],"./de-de/mtma-missed-notifications.js":[234800,536397],"./de-de/nova.js":[778853,536397],"./de-de/people-app.js":[null],"./de-de/people-picker.js":[724989,536397],"./de-de/people-targeting.js":[583277,444465],"./de-de/people.js":[119238,536397],"./de-de/person.js":[129642,536397],"./de-de/phonelink-sms.js":[860582,535820],"./de-de/pre-core.js":[null],"./de-de/premium-benefits.js":[629087,385798],"./de-de/presence.js":[384614,536397],"./de-de/queues.js":[60550,75296],"./de-de/recurrence.js":[865561,830590],"./de-de/rsc-application-permissions.js":[null],"./de-de/search.js":[253013,109545],"./de-de/semantic-object.js":[677039,704288],"./de-de/settings.js":[784026,536397],"./de-de/share-in-meetings.js":[null],"./de-de/share-to-teams-outlook-addin.js":[null],"./de-de/share-to-teams-third-party.js":[null],"./de-de/share-to-teams.js":[290598,21514],"./de-de/shortcut.js":[786389,536397],"./de-de/shortcuts.js":[885191,536397],"./de-de/simple-collab.js":[942266,536397],"./de-de/smart-device.js":[null],"./de-de/survey.js":[622225,555204],"./de-de/sv-flyout.js":[373486,536397],"./de-de/teams-and-channels.js":[489562,641272],"./de-de/teams-insider.js":[250481,536397],"./de-de/telemetry.js":[771706,536397],"./de-de/tfl-homepage.js":[953906,536397],"./de-de/tfl-onboarding.js":[733569,536397],"./de-de/toast-notifications.js":[944361,536397],"./de-de/trusted-ui.js":[null],"./de-de/unified-search.js":[717065,21514],"./de-de/unsupported-browser.js":[null],"./de-de/url-preview.js":[267432,536397],"./de-de/video-capture.js":[236313,864466],"./de-de/video-message.js":[623652,315682],"./de-de/virtual-consumer-events.js":[125140,673678],"./de-de/virtual-events.js":[846167,587150],"./de-de/webinar.js":[748598,481516],"./de-de/welcome-bot.js":[null],"./de-de/whats-new.js":[22200,536397],"./de-de/wiki.js":[null],"./el-gr/activity.js":[122434,884766],"./el-gr/artifacts-platform.js":[43130,229407],"./el-gr/audience-view-dialog.js":[45397,797146],"./el-gr/auth.js":[383125,884766],"./el-gr/autosuggest.js":[222619,884766],"./el-gr/avatar.js":[894735,884766],"./el-gr/biometric-enrollment.js":[666654,692186],"./el-gr/breakout-rooms.js":[779262,108998],"./el-gr/broadcast.js":[27555,352433],"./el-gr/calendar.js":[822575,16487],"./el-gr/calling.js":[282770,23762],"./el-gr/campaign-notifications.js":[607571,884766],"./el-gr/carousel-multi-card.js":[null],"./el-gr/cast.js":[13288,884766],"./el-gr/channels.js":[121906,884766],"./el-gr/chat-list.js":[507330,884766],"./el-gr/coach-report.js":[173623,508058],"./el-gr/comment-stream.js":[951413,585153],"./el-gr/communities.js":[306308,884766],"./el-gr/compose.js":[113030,884766],"./el-gr/contacts.js":[226943,884766],"./el-gr/datepicker.js":[629617,939387],"./el-gr/desktop.js":[null],"./el-gr/digital-signage.js":[null],"./el-gr/discover-surface.js":[332026,848170],"./el-gr/edu.js":[891581,622685],"./el-gr/embed.js":[927087,884766],"./el-gr/errors.js":[641245,884766],"./el-gr/esp.js":[267187,29475],"./el-gr/extensibility-ptz-extension.js":[null],"./el-gr/extensibility-room-remote.js":[null],"./el-gr/extensibility.js":[661032,884766],"./el-gr/feedback.js":[379816,860596],"./el-gr/files.js":[185425,884766],"./el-gr/framework.js":[13107,884766],"./el-gr/freemium-upgrade.js":[null],"./el-gr/funstuff.js":[416644,999385],"./el-gr/gallery.js":[366956,290265],"./el-gr/growth.js":[660384,884766],"./el-gr/guardians.js":[215036,722799],"./el-gr/health.js":[924368,113484],"./el-gr/help.js":[null],"./el-gr/hololens.js":[105183,23762],"./el-gr/host-controls.js":[556355,34799],"./el-gr/jana.js":[375649,352626],"./el-gr/lightbox.js":[649702,884766],"./el-gr/live-persona-card.js":[557221,884766],"./el-gr/live-persona-editor.js":[687044,564212],"./el-gr/lms-integration.js":[null],"./el-gr/meet-for-work.js":[959047,461300],"./el-gr/meeting-analytics.js":[849150,296105],"./el-gr/meeting-apis-app.js":[null],"./el-gr/meeting-bot.js":[null],"./el-gr/meeting-collaboration.js":[512112,550099],"./el-gr/meeting-flyout.js":[490626,884766],"./el-gr/meeting-meet-app.js":[450431,884766],"./el-gr/meeting-options.js":[545427,195002],"./el-gr/meeting-recap.js":[580786,2784],"./el-gr/meeting-room-console.js":[null],"./el-gr/meeting-stream-app.js":[null],"./el-gr/message-escalate-dialog.js":[824673,993207],"./el-gr/messaging.js":[780246,884766],"./el-gr/mobile-attach.js":[null],"./el-gr/mtma-missed-notifications.js":[864519,884766],"./el-gr/nova.js":[868841,884766],"./el-gr/people-app.js":[null],"./el-gr/people-picker.js":[77290,884766],"./el-gr/people-targeting.js":[505038,559752],"./el-gr/people.js":[734320,884766],"./el-gr/person.js":[239723,884766],"./el-gr/phonelink-sms.js":[494484,416005],"./el-gr/pre-core.js":[null],"./el-gr/premium-benefits.js":[852729,338542],"./el-gr/presence.js":[594987,884766],"./el-gr/queues.js":[293907,881275],"./el-gr/recurrence.js":[334927,33925],"./el-gr/rsc-application-permissions.js":[null],"./el-gr/search.js":[52655,939387],"./el-gr/semantic-object.js":[544916,492521],"./el-gr/settings.js":[708537,884766],"./el-gr/share-in-meetings.js":[null],"./el-gr/share-to-teams-outlook-addin.js":[null],"./el-gr/share-to-teams-third-party.js":[null],"./el-gr/share-to-teams.js":[140749,401199],"./el-gr/shortcut.js":[686757,884766],"./el-gr/shortcuts.js":[758717,884766],"./el-gr/simple-collab.js":[448815,884766],"./el-gr/smart-device.js":[null],"./el-gr/survey.js":[285738,466953],"./el-gr/sv-flyout.js":[748586,884766],"./el-gr/teams-and-channels.js":[490614,711265],"./el-gr/teams-insider.js":[19019,884766],"./el-gr/telemetry.js":[247528,884766],"./el-gr/tfl-homepage.js":[796494,884766],"./el-gr/tfl-onboarding.js":[100467,884766],"./el-gr/toast-notifications.js":[131432,884766],"./el-gr/trusted-ui.js":[null],"./el-gr/unified-search.js":[62625,401199],"./el-gr/unsupported-browser.js":[null],"./el-gr/url-preview.js":[44554,884766],"./el-gr/video-capture.js":[705381,101345],"./el-gr/video-message.js":[420374,86142],"./el-gr/virtual-consumer-events.js":[542849,48548],"./el-gr/virtual-events.js":[830190,796736],"./el-gr/webinar.js":[189920,798654],"./el-gr/welcome-bot.js":[null],"./el-gr/whats-new.js":[332422,884766],"./el-gr/wiki.js":[null],"./en-gb/activity.js":[485273,724937],"./en-gb/artifacts-platform.js":[161640,727959],"./en-gb/audience-view-dialog.js":[754655,617828],"./en-gb/auth.js":[390153,724937],"./en-gb/autosuggest.js":[127858,724937],"./en-gb/avatar.js":[183536,724937],"./en-gb/biometric-enrollment.js":[46759,286608],"./en-gb/breakout-rooms.js":[977996,701254],"./en-gb/broadcast.js":[379249,273851],"./en-gb/calendar.js":[155841,433580],"./en-gb/calling.js":[441651,694057],"./en-gb/campaign-notifications.js":[323644,724937],"./en-gb/carousel-multi-card.js":[null],"./en-gb/cast.js":[243677,724937],"./en-gb/channels.js":[139958,724937],"./en-gb/chat-list.js":[34324,724937],"./en-gb/coach-report.js":[3166,95683],"./en-gb/comment-stream.js":[721910,68754],"./en-gb/communities.js":[664007,724937],"./en-gb/compose.js":[829922,724937],"./en-gb/contacts.js":[432708,724937],"./en-gb/datepicker.js":[988078,993820],"./en-gb/desktop.js":[null],"./en-gb/digital-signage.js":[null],"./en-gb/discover-surface.js":[253269,476547],"./en-gb/edu.js":[172255,103707],"./en-gb/embed.js":[425074,724937],"./en-gb/errors.js":[234194,724937],"./en-gb/esp.js":[538378,139886],"./en-gb/extensibility-ptz-extension.js":[null],"./en-gb/extensibility-room-remote.js":[null],"./en-gb/extensibility.js":[106415,724937],"./en-gb/feedback.js":[88476,494084],"./en-gb/files.js":[133060,724937],"./en-gb/framework.js":[847093,724937],"./en-gb/freemium-upgrade.js":[null],"./en-gb/funstuff.js":[842870,915446],"./en-gb/gallery.js":[754447,944284],"./en-gb/growth.js":[681896,724937],"./en-gb/guardians.js":[645655,388664],"./en-gb/health.js":[530486,407949],"./en-gb/help.js":[null],"./en-gb/hololens.js":[209137,694057],"./en-gb/host-controls.js":[844840,255477],"./en-gb/jana.js":[692827,333421],"./en-gb/lightbox.js":[539703,724937],"./en-gb/live-persona-card.js":[705762,724937],"./en-gb/live-persona-editor.js":[682211,781891],"./en-gb/lms-integration.js":[null],"./en-gb/meet-for-work.js":[734850,255306],"./en-gb/meeting-analytics.js":[53171,299290],"./en-gb/meeting-apis-app.js":[null],"./en-gb/meeting-bot.js":[null],"./en-gb/meeting-collaboration.js":[448927,161855],"./en-gb/meeting-flyout.js":[323951,724937],"./en-gb/meeting-meet-app.js":[927017,724937],"./en-gb/meeting-options.js":[840957,536821],"./en-gb/meeting-recap.js":[264322,478432],"./en-gb/meeting-room-console.js":[null],"./en-gb/meeting-stream-app.js":[null],"./en-gb/message-escalate-dialog.js":[692543,321647],"./en-gb/messaging.js":[969756,724937],"./en-gb/mobile-attach.js":[null],"./en-gb/mtma-missed-notifications.js":[628266,724937],"./en-gb/nova.js":[44945,724937],"./en-gb/people-app.js":[null],"./en-gb/people-picker.js":[940872,724937],"./en-gb/people-targeting.js":[852248,580648],"./en-gb/people.js":[441139,724937],"./en-gb/person.js":[595025,724937],"./en-gb/phonelink-sms.js":[37400,40880],"./en-gb/pre-core.js":[null],"./en-gb/premium-benefits.js":[793223,224786],"./en-gb/presence.js":[978506,724937],"./en-gb/queues.js":[697149,972463],"./en-gb/recurrence.js":[841212,137390],"./en-gb/rsc-application-permissions.js":[null],"./en-gb/search.js":[365631,993820],"./en-gb/semantic-object.js":[281596,206396],"./en-gb/settings.js":[637825,724937],"./en-gb/share-in-meetings.js":[null],"./en-gb/share-to-teams-outlook-addin.js":[null],"./en-gb/share-to-teams-third-party.js":[null],"./en-gb/share-to-teams.js":[879578,439370],"./en-gb/shortcut.js":[830876,724937],"./en-gb/shortcuts.js":[453006,724937],"./en-gb/simple-collab.js":[806818,724937],"./en-gb/smart-device.js":[null],"./en-gb/survey.js":[988810,142549],"./en-gb/sv-flyout.js":[709696,724937],"./en-gb/teams-and-channels.js":[611512,763823],"./en-gb/teams-insider.js":[881467,724937],"./en-gb/telemetry.js":[496978,724937],"./en-gb/tfl-homepage.js":[923515,724937],"./en-gb/tfl-onboarding.js":[80163,724937],"./en-gb/toast-notifications.js":[994428,724937],"./en-gb/trusted-ui.js":[null],"./en-gb/unified-search.js":[601166,439370],"./en-gb/unsupported-browser.js":[null],"./en-gb/url-preview.js":[999474,724937],"./en-gb/video-capture.js":[960443,937398],"./en-gb/video-message.js":[255755,881735],"./en-gb/virtual-consumer-events.js":[369115,515111],"./en-gb/virtual-events.js":[394782,887434],"./en-gb/webinar.js":[361179,433105],"./en-gb/welcome-bot.js":[null],"./en-gb/whats-new.js":[30719,724937],"./en-gb/wiki.js":[null],"./en-us/activity.js":[60520,50906],"./en-us/artifacts-platform.js":[280189,583005],"./en-us/audience-view-dialog.js":[259545,137252],"./en-us/auth.js":[83902,50906],"./en-us/autosuggest.js":[493977,50906],"./en-us/avatar.js":[665401,50906],"./en-us/biometric-enrollment.js":[232769,344667],"./en-us/breakout-rooms.js":[712680,117233],"./en-us/broadcast.js":[6162,788811],"./en-us/calendar.js":[158300,336537],"./en-us/calling.js":[102466,246657],"./en-us/campaign-notifications.js":[733785,50906],"./en-us/carousel-multi-card.js":[null],"./en-us/cast.js":[78499,50906],"./en-us/channels.js":[814117,50906],"./en-us/chat-list.js":[889367,50906],"./en-us/coach-report.js":[390464,697206],"./en-us/comment-stream.js":[693333,721599],"./en-us/communities.js":[666071,50906],"./en-us/compose.js":[652407,50906],"./en-us/contacts.js":[767921,50906],"./en-us/datepicker.js":[843754,20538],"./en-us/desktop.js":[null],"./en-us/digital-signage.js":[null],"./en-us/discover-surface.js":[844621,428433],"./en-us/edu.js":[136835,267881],"./en-us/embed.js":[307155,50906],"./en-us/errors.js":[763500,50906],"./en-us/esp.js":[898367,317797],"./en-us/extensibility-ptz-extension.js":[null],"./en-us/extensibility-room-remote.js":[null],"./en-us/extensibility.js":[718907,50906],"./en-us/feedback.js":[391219,394436],"./en-us/files.js":[341579,50906],"./en-us/framework.js":[954208,50906],"./en-us/freemium-upgrade.js":[null],"./en-us/funstuff.js":[251122,391946],"./en-us/gallery.js":[484025,711746],"./en-us/growth.js":[274198,50906],"./en-us/guardians.js":[98822,258259],"./en-us/health.js":[373414,848588],"./en-us/help.js":[null],"./en-us/hololens.js":[98998,246657],"./en-us/host-controls.js":[464621,334558],"./en-us/jana.js":[419835,654615],"./en-us/lightbox.js":[394736,50906],"./en-us/live-persona-card.js":[982513,50906],"./en-us/live-persona-editor.js":[65967,432916],"./en-us/lms-integration.js":[null],"./en-us/meet-for-work.js":[197104,464880],"./en-us/meeting-analytics.js":[243650,590631],"./en-us/meeting-apis-app.js":[null],"./en-us/meeting-bot.js":[null],"./en-us/meeting-collaboration.js":[962021,972986],"./en-us/meeting-flyout.js":[210370,50906],"./en-us/meeting-meet-app.js":[130968,50906],"./en-us/meeting-options.js":[875934,292819],"./en-us/meeting-recap.js":[736872,42849],"./en-us/meeting-room-console.js":[null],"./en-us/meeting-stream-app.js":[null],"./en-us/message-escalate-dialog.js":[728298,93760],"./en-us/messaging.js":[17698,50906],"./en-us/mobile-attach.js":[null],"./en-us/mtma-missed-notifications.js":[872008,50906],"./en-us/nova.js":[453178,50906],"./en-us/people-app.js":[null],"./en-us/people-picker.js":[511645,50906],"./en-us/people-targeting.js":[506156,420443],"./en-us/people.js":[38565,50906],"./en-us/person.js":[920713,50906],"./en-us/phonelink-sms.js":[412849,889082],"./en-us/pre-core.js":[null],"./en-us/premium-benefits.js":[945779,548894],"./en-us/presence.js":[613451,50906],"./en-us/queues.js":[437346,630154],"./en-us/recurrence.js":[647048,402525],"./en-us/rsc-application-permissions.js":[null],"./en-us/search.js":[327920,20538],"./en-us/semantic-object.js":[229442,87562],"./en-us/settings.js":[550500,50906],"./en-us/share-in-meetings.js":[null],"./en-us/share-to-teams-outlook-addin.js":[null],"./en-us/share-to-teams-third-party.js":[null],"./en-us/share-to-teams.js":[848498,335626],"./en-us/shortcut.js":[605988,50906],"./en-us/shortcuts.js":[69836,50906],"./en-us/simple-collab.js":[810995,50906],"./en-us/smart-device.js":[null],"./en-us/survey.js":[162863,667569],"./en-us/sv-flyout.js":[91097,50906],"./en-us/teams-and-channels.js":[55662,126819],"./en-us/teams-insider.js":[200231,50906],"./en-us/telemetry.js":[553318,50906],"./en-us/tfl-homepage.js":[648010,50906],"./en-us/tfl-onboarding.js":[308585,50906],"./en-us/toast-notifications.js":[622802,50906],"./en-us/trusted-ui.js":[null],"./en-us/unified-search.js":[593988,335626],"./en-us/unsupported-browser.js":[null],"./en-us/url-preview.js":[645425,50906],"./en-us/video-capture.js":[961970,745303],"./en-us/video-message.js":[989906,612083],"./en-us/virtual-consumer-events.js":[682937,186413],"./en-us/virtual-events.js":[822136,548906],"./en-us/webinar.js":[689665,621372],"./en-us/welcome-bot.js":[null],"./en-us/whats-new.js":[335216,50906],"./en-us/wiki.js":[null],"./es-es/activity.js":[311245,880184],"./es-es/artifacts-platform.js":[274746,467608],"./es-es/audience-view-dialog.js":[125212,376583],"./es-es/auth.js":[459692,880184],"./es-es/autosuggest.js":[717371,880184],"./es-es/avatar.js":[580284,880184],"./es-es/biometric-enrollment.js":[241924,995859],"./es-es/breakout-rooms.js":[759383,917196],"./es-es/broadcast.js":[754019,21033],"./es-es/calendar.js":[951608,283992],"./es-es/calling.js":[930887,544570],"./es-es/campaign-notifications.js":[12963,880184],"./es-es/carousel-multi-card.js":[null],"./es-es/cast.js":[388307,880184],"./es-es/channels.js":[405974,880184],"./es-es/chat-list.js":[656660,880184],"./es-es/coach-report.js":[492773,602943],"./es-es/comment-stream.js":[567394,664258],"./es-es/communities.js":[30194,880184],"./es-es/compose.js":[622715,880184],"./es-es/contacts.js":[253980,880184],"./es-es/datepicker.js":[644563,786549],"./es-es/desktop.js":[null],"./es-es/digital-signage.js":[null],"./es-es/discover-surface.js":[565157,305777],"./es-es/edu.js":[50357,50302],"./es-es/embed.js":[457267,880184],"./es-es/errors.js":[926137,880184],"./es-es/esp.js":[494736,76605],"./es-es/extensibility-ptz-extension.js":[null],"./es-es/extensibility-room-remote.js":[null],"./es-es/extensibility.js":[303399,880184],"./es-es/feedback.js":[926456,109433],"./es-es/files.js":[432527,880184],"./es-es/framework.js":[481449,880184],"./es-es/freemium-upgrade.js":[null],"./es-es/funstuff.js":[772684,638860],"./es-es/gallery.js":[448441,246477],"./es-es/growth.js":[921072,880184],"./es-es/guardians.js":[84722,336153],"./es-es/health.js":[959169,156354],"./es-es/help.js":[null],"./es-es/hololens.js":[638974,544570],"./es-es/host-controls.js":[806893,182353],"./es-es/jana.js":[449054,2729],"./es-es/lightbox.js":[280407,880184],"./es-es/live-persona-card.js":[483468,880184],"./es-es/live-persona-editor.js":[557168,712936],"./es-es/lms-integration.js":[null],"./es-es/meet-for-work.js":[68554,347038],"./es-es/meeting-analytics.js":[906702,553069],"./es-es/meeting-apis-app.js":[null],"./es-es/meeting-bot.js":[null],"./es-es/meeting-collaboration.js":[147099,254970],"./es-es/meeting-flyout.js":[617018,880184],"./es-es/meeting-meet-app.js":[923198,880184],"./es-es/meeting-options.js":[173523,500140],"./es-es/meeting-recap.js":[936362,776418],"./es-es/meeting-room-console.js":[null],"./es-es/meeting-stream-app.js":[null],"./es-es/message-escalate-dialog.js":[771418,119233],"./es-es/messaging.js":[899921,880184],"./es-es/mobile-attach.js":[null],"./es-es/mtma-missed-notifications.js":[293308,880184],"./es-es/nova.js":[890684,880184],"./es-es/people-app.js":[null],"./es-es/people-picker.js":[671397,880184],"./es-es/people-targeting.js":[549834,871409],"./es-es/people.js":[113407,880184],"./es-es/person.js":[59952,880184],"./es-es/phonelink-sms.js":[143547,953707],"./es-es/pre-core.js":[null],"./es-es/premium-benefits.js":[134436,369295],"./es-es/presence.js":[746729,880184],"./es-es/queues.js":[124461,319516],"./es-es/recurrence.js":[316710,458276],"./es-es/rsc-application-permissions.js":[null],"./es-es/search.js":[83360,786549],"./es-es/semantic-object.js":[538243,404904],"./es-es/settings.js":[41280,880184],"./es-es/share-in-meetings.js":[null],"./es-es/share-to-teams-outlook-addin.js":[null],"./es-es/share-to-teams-third-party.js":[null],"./es-es/share-to-teams.js":[183534,959258],"./es-es/shortcut.js":[933922,880184],"./es-es/shortcuts.js":[777648,880184],"./es-es/simple-collab.js":[346473,880184],"./es-es/smart-device.js":[null],"./es-es/survey.js":[227518,705170],"./es-es/sv-flyout.js":[257902,880184],"./es-es/teams-and-channels.js":[322393,673773],"./es-es/teams-insider.js":[491810,880184],"./es-es/telemetry.js":[671230,880184],"./es-es/tfl-homepage.js":[988960,880184],"./es-es/tfl-onboarding.js":[905246,880184],"./es-es/toast-notifications.js":[731874,880184],"./es-es/trusted-ui.js":[null],"./es-es/unified-search.js":[223872,959258],"./es-es/unsupported-browser.js":[null],"./es-es/url-preview.js":[281735,880184],"./es-es/video-capture.js":[701394,345804],"./es-es/video-message.js":[668243,285783],"./es-es/virtual-consumer-events.js":[298904,467835],"./es-es/virtual-events.js":[179491,206431],"./es-es/webinar.js":[360716,898261],"./es-es/welcome-bot.js":[null],"./es-es/whats-new.js":[910271,880184],"./es-es/wiki.js":[null],"./es-mx/activity.js":[782151,102701],"./es-mx/artifacts-platform.js":[623093,176902],"./es-mx/audience-view-dialog.js":[350324,423859],"./es-mx/auth.js":[600229,102701],"./es-mx/autosuggest.js":[4074,102701],"./es-mx/avatar.js":[215e3,102701],"./es-mx/biometric-enrollment.js":[942753,156149],"./es-mx/breakout-rooms.js":[803811,481174],"./es-mx/broadcast.js":[490022,112502],"./es-mx/calendar.js":[580521,138885],"./es-mx/calling.js":[806645,457699],"./es-mx/campaign-notifications.js":[739180,102701],"./es-mx/carousel-multi-card.js":[null],"./es-mx/cast.js":[96347,102701],"./es-mx/channels.js":[731075,102701],"./es-mx/chat-list.js":[709393,102701],"./es-mx/coach-report.js":[534300,956210],"./es-mx/comment-stream.js":[512606,642439],"./es-mx/communities.js":[233269,102701],"./es-mx/compose.js":[924017,102701],"./es-mx/contacts.js":[42278,102701],"./es-mx/datepicker.js":[632446,849810],"./es-mx/desktop.js":[null],"./es-mx/digital-signage.js":[null],"./es-mx/discover-surface.js":[770587,688466],"./es-mx/edu.js":[961422,857709],"./es-mx/embed.js":[137572,102701],"./es-mx/errors.js":[186140,102701],"./es-mx/esp.js":[942730,315580],"./es-mx/extensibility-ptz-extension.js":[null],"./es-mx/extensibility-room-remote.js":[null],"./es-mx/extensibility.js":[22685,102701],"./es-mx/feedback.js":[383136,956260],"./es-mx/files.js":[214835,102701],"./es-mx/framework.js":[163817,102701],"./es-mx/freemium-upgrade.js":[null],"./es-mx/funstuff.js":[253692,93734],"./es-mx/gallery.js":[202797,311136],"./es-mx/growth.js":[785826,102701],"./es-mx/guardians.js":[882238,858686],"./es-mx/health.js":[495256,587846],"./es-mx/help.js":[null],"./es-mx/hololens.js":[336898,457699],"./es-mx/host-controls.js":[890233,443188],"./es-mx/jana.js":[416341,412981],"./es-mx/lightbox.js":[34357,102701],"./es-mx/live-persona-card.js":[882517,102701],"./es-mx/live-persona-editor.js":[758329,234038],"./es-mx/lms-integration.js":[null],"./es-mx/meet-for-work.js":[717823,418185],"./es-mx/meeting-analytics.js":[933253,547331],"./es-mx/meeting-apis-app.js":[null],"./es-mx/meeting-bot.js":[null],"./es-mx/meeting-collaboration.js":[266842,226590],"./es-mx/meeting-flyout.js":[957743,102701],"./es-mx/meeting-meet-app.js":[546333,102701],"./es-mx/meeting-options.js":[283775,440553],"./es-mx/meeting-recap.js":[412142,98289],"./es-mx/meeting-room-console.js":[null],"./es-mx/meeting-stream-app.js":[null],"./es-mx/message-escalate-dialog.js":[409086,535376],"./es-mx/messaging.js":[332222,102701],"./es-mx/mobile-attach.js":[null],"./es-mx/mtma-missed-notifications.js":[428406,102701],"./es-mx/nova.js":[99140,102701],"./es-mx/people-app.js":[null],"./es-mx/people-picker.js":[740055,102701],"./es-mx/people-targeting.js":[566666,694543],"./es-mx/people.js":[65897,102701],"./es-mx/person.js":[946411,102701],"./es-mx/phonelink-sms.js":[526293,536494],"./es-mx/pre-core.js":[null],"./es-mx/premium-benefits.js":[453134,330165],"./es-mx/presence.js":[820291,102701],"./es-mx/queues.js":[804690,845483],"./es-mx/recurrence.js":[602910,8275],"./es-mx/rsc-application-permissions.js":[null],"./es-mx/search.js":[95644,849810],"./es-mx/semantic-object.js":[142505,667442],"./es-mx/settings.js":[708340,102701],"./es-mx/share-in-meetings.js":[null],"./es-mx/share-to-teams-outlook-addin.js":[null],"./es-mx/share-to-teams-third-party.js":[null],"./es-mx/share-to-teams.js":[647085,446402],"./es-mx/shortcut.js":[549203,102701],"./es-mx/shortcuts.js":[683284,102701],"./es-mx/simple-collab.js":[196356,102701],"./es-mx/smart-device.js":[null],"./es-mx/survey.js":[697422,610501],"./es-mx/sv-flyout.js":[253764,102701],"./es-mx/teams-and-channels.js":[964913,782856],"./es-mx/teams-insider.js":[18498,102701],"./es-mx/telemetry.js":[777616,102701],"./es-mx/tfl-homepage.js":[747618,102701],"./es-mx/tfl-onboarding.js":[971189,102701],"./es-mx/toast-notifications.js":[45891,102701],"./es-mx/trusted-ui.js":[null],"./es-mx/unified-search.js":[81793,446402],"./es-mx/unsupported-browser.js":[null],"./es-mx/url-preview.js":[381097,102701],"./es-mx/video-capture.js":[127209,488029],"./es-mx/video-message.js":[758468,828853],"./es-mx/virtual-consumer-events.js":[605821,378894],"./es-mx/virtual-events.js":[644445,45157],"./es-mx/webinar.js":[94914,433454],"./es-mx/welcome-bot.js":[null],"./es-mx/whats-new.js":[93340,102701],"./es-mx/wiki.js":[null],"./et-ee/activity.js":[186694,468304],"./et-ee/artifacts-platform.js":[159365,150399],"./et-ee/audience-view-dialog.js":[881077,161768],"./et-ee/auth.js":[14293,468304],"./et-ee/autosuggest.js":[282832,468304],"./et-ee/avatar.js":[402085,468304],"./et-ee/biometric-enrollment.js":[838819,96148],"./et-ee/breakout-rooms.js":[891978,2101],"./et-ee/broadcast.js":[738635,420957],"./et-ee/calendar.js":[991415,700075],"./et-ee/calling.js":[526163,646978],"./et-ee/campaign-notifications.js":[264015,468304],"./et-ee/carousel-multi-card.js":[null],"./et-ee/cast.js":[148416,468304],"./et-ee/channels.js":[754586,468304],"./et-ee/chat-list.js":[579300,468304],"./et-ee/coach-report.js":[390260,346839],"./et-ee/comment-stream.js":[596931,85136],"./et-ee/communities.js":[571387,468304],"./et-ee/compose.js":[241010,468304],"./et-ee/contacts.js":[186490,468304],"./et-ee/datepicker.js":[82211,594819],"./et-ee/desktop.js":[null],"./et-ee/digital-signage.js":[null],"./et-ee/discover-surface.js":[941302,828178],"./et-ee/edu.js":[565355,455536],"./et-ee/embed.js":[365862,468304],"./et-ee/errors.js":[936183,468304],"./et-ee/esp.js":[799e3,819521],"./et-ee/extensibility-ptz-extension.js":[null],"./et-ee/extensibility-room-remote.js":[null],"./et-ee/extensibility.js":[211870,468304],"./et-ee/feedback.js":[815274,136954],"./et-ee/files.js":[639447,468304],"./et-ee/framework.js":[495682,468304],"./et-ee/freemium-upgrade.js":[null],"./et-ee/funstuff.js":[366681,555695],"./et-ee/gallery.js":[194436,774224],"./et-ee/growth.js":[246362,468304],"./et-ee/guardians.js":[45202,156275],"./et-ee/health.js":[34780,954964],"./et-ee/help.js":[null],"./et-ee/hololens.js":[370602,646978],"./et-ee/host-controls.js":[556909,298789],"./et-ee/jana.js":[397604,195484],"./et-ee/lightbox.js":[609622,468304],"./et-ee/live-persona-card.js":[551955,468304],"./et-ee/live-persona-editor.js":[368756,147679],"./et-ee/lms-integration.js":[null],"./et-ee/meet-for-work.js":[543448,523041],"./et-ee/meeting-analytics.js":[582659,958359],"./et-ee/meeting-apis-app.js":[null],"./et-ee/meeting-bot.js":[null],"./et-ee/meeting-collaboration.js":[760020,760438],"./et-ee/meeting-flyout.js":[553895,468304],"./et-ee/meeting-meet-app.js":[428283,468304],"./et-ee/meeting-options.js":[185354,596007],"./et-ee/meeting-recap.js":[503380,397822],"./et-ee/meeting-room-console.js":[null],"./et-ee/meeting-stream-app.js":[null],"./et-ee/message-escalate-dialog.js":[972309,63434],"./et-ee/messaging.js":[333965,468304],"./et-ee/mobile-attach.js":[null],"./et-ee/mtma-missed-notifications.js":[200559,468304],"./et-ee/nova.js":[122903,468304],"./et-ee/people-app.js":[null],"./et-ee/people-picker.js":[854962,468304],"./et-ee/people-targeting.js":[793712,350138],"./et-ee/people.js":[318868,468304],"./et-ee/person.js":[704959,468304],"./et-ee/phonelink-sms.js":[285472,376522],"./et-ee/pre-core.js":[null],"./et-ee/premium-benefits.js":[477205,479569],"./et-ee/presence.js":[895574,468304],"./et-ee/queues.js":[55115,940782],"./et-ee/recurrence.js":[689783,68074],"./et-ee/rsc-application-permissions.js":[null],"./et-ee/search.js":[429304,594819],"./et-ee/semantic-object.js":[722356,145898],"./et-ee/settings.js":[777258,468304],"./et-ee/share-in-meetings.js":[null],"./et-ee/share-to-teams-outlook-addin.js":[null],"./et-ee/share-to-teams-third-party.js":[null],"./et-ee/share-to-teams.js":[182010,803184],"./et-ee/shortcut.js":[718532,468304],"./et-ee/shortcuts.js":[222830,468304],"./et-ee/simple-collab.js":[26462,468304],"./et-ee/smart-device.js":[null],"./et-ee/survey.js":[394068,314309],"./et-ee/sv-flyout.js":[222721,468304],"./et-ee/teams-and-channels.js":[757738,382703],"./et-ee/teams-insider.js":[548846,468304],"./et-ee/telemetry.js":[983945,468304],"./et-ee/tfl-homepage.js":[267393,468304],"./et-ee/tfl-onboarding.js":[282677,468304],"./et-ee/toast-notifications.js":[290039,468304],"./et-ee/trusted-ui.js":[null],"./et-ee/unified-search.js":[143886,803184],"./et-ee/unsupported-browser.js":[null],"./et-ee/url-preview.js":[309119,468304],"./et-ee/video-capture.js":[509784,732751],"./et-ee/video-message.js":[863588,942049],"./et-ee/virtual-consumer-events.js":[899185,895757],"./et-ee/virtual-events.js":[933503,94155],"./et-ee/webinar.js":[442460,713750],"./et-ee/welcome-bot.js":[null],"./et-ee/whats-new.js":[733289,468304],"./et-ee/wiki.js":[null],"./eu-es/activity.js":[112246,324278],"./eu-es/artifacts-platform.js":[570130,238820],"./eu-es/audience-view-dialog.js":[408049,105082],"./eu-es/auth.js":[939156,324278],"./eu-es/autosuggest.js":[822101,324278],"./eu-es/avatar.js":[823511,324278],"./eu-es/biometric-enrollment.js":[279216,60684],"./eu-es/breakout-rooms.js":[10731,921995],"./eu-es/broadcast.js":[38816,962457],"./eu-es/calendar.js":[368562,417253],"./eu-es/calling.js":[653569,682522],"./eu-es/campaign-notifications.js":[323023,324278],"./eu-es/carousel-multi-card.js":[null],"./eu-es/cast.js":[405943,324278],"./eu-es/channels.js":[996216,324278],"./eu-es/chat-list.js":[835853,324278],"./eu-es/coach-report.js":[339176,784224],"./eu-es/comment-stream.js":[229906,526493],"./eu-es/communities.js":[731942,324278],"./eu-es/compose.js":[391961,324278],"./eu-es/contacts.js":[210179,324278],"./eu-es/datepicker.js":[419554,330078],"./eu-es/desktop.js":[null],"./eu-es/digital-signage.js":[null],"./eu-es/discover-surface.js":[623202,494973],"./eu-es/edu.js":[49911,425645],"./eu-es/embed.js":[935938,324278],"./eu-es/errors.js":[114269,324278],"./eu-es/esp.js":[683922,833665],"./eu-es/extensibility-ptz-extension.js":[null],"./eu-es/extensibility-room-remote.js":[null],"./eu-es/extensibility.js":[23633,324278],"./eu-es/feedback.js":[804898,879882],"./eu-es/files.js":[439641,324278],"./eu-es/framework.js":[651524,324278],"./eu-es/freemium-upgrade.js":[null],"./eu-es/funstuff.js":[867807,439738],"./eu-es/gallery.js":[245213,183393],"./eu-es/growth.js":[83898,324278],"./eu-es/guardians.js":[991313,323246],"./eu-es/health.js":[547773,993305],"./eu-es/help.js":[null],"./eu-es/hololens.js":[572081,682522],"./eu-es/host-controls.js":[908222,828268],"./eu-es/jana.js":[961316,548049],"./eu-es/lightbox.js":[543936,324278],"./eu-es/live-persona-card.js":[55273,324278],"./eu-es/live-persona-editor.js":[896440,361607],"./eu-es/lms-integration.js":[null],"./eu-es/meet-for-work.js":[158655,516703],"./eu-es/meeting-analytics.js":[122863,481897],"./eu-es/meeting-apis-app.js":[null],"./eu-es/meeting-bot.js":[null],"./eu-es/meeting-collaboration.js":[409616,876316],"./eu-es/meeting-flyout.js":[685555,324278],"./eu-es/meeting-meet-app.js":[157518,324278],"./eu-es/meeting-options.js":[974300,397782],"./eu-es/meeting-recap.js":[341363,43342],"./eu-es/meeting-room-console.js":[null],"./eu-es/meeting-stream-app.js":[null],"./eu-es/message-escalate-dialog.js":[83667,506841],"./eu-es/messaging.js":[614744,324278],"./eu-es/mobile-attach.js":[null],"./eu-es/mtma-missed-notifications.js":[292923,324278],"./eu-es/nova.js":[716964,324278],"./eu-es/people-app.js":[null],"./eu-es/people-picker.js":[771884,324278],"./eu-es/people-targeting.js":[886710,388216],"./eu-es/people.js":[780611,324278],"./eu-es/person.js":[744885,324278],"./eu-es/phonelink-sms.js":[412918,242666],"./eu-es/pre-core.js":[null],"./eu-es/premium-benefits.js":[946373,560551],"./eu-es/presence.js":[211874,324278],"./eu-es/queues.js":[931878,960489],"./eu-es/recurrence.js":[766539,343642],"./eu-es/rsc-application-permissions.js":[null],"./eu-es/search.js":[743441,330078],"./eu-es/semantic-object.js":[770134,82023],"./eu-es/settings.js":[426180,324278],"./eu-es/share-in-meetings.js":[null],"./eu-es/share-to-teams-outlook-addin.js":[null],"./eu-es/share-to-teams-third-party.js":[null],"./eu-es/share-to-teams.js":[394733,862982],"./eu-es/shortcut.js":[20595,324278],"./eu-es/shortcuts.js":[462886,324278],"./eu-es/simple-collab.js":[95338,324278],"./eu-es/smart-device.js":[null],"./eu-es/survey.js":[566436,873166],"./eu-es/sv-flyout.js":[534981,324278],"./eu-es/teams-and-channels.js":[714714,795691],"./eu-es/teams-insider.js":[122871,324278],"./eu-es/telemetry.js":[99825,324278],"./eu-es/tfl-homepage.js":[73189,324278],"./eu-es/tfl-onboarding.js":[481947,324278],"./eu-es/toast-notifications.js":[28128,324278],"./eu-es/trusted-ui.js":[null],"./eu-es/unified-search.js":[312528,862982],"./eu-es/unsupported-browser.js":[null],"./eu-es/url-preview.js":[388353,324278],"./eu-es/video-capture.js":[146239,393786],"./eu-es/video-message.js":[372996,926946],"./eu-es/virtual-consumer-events.js":[137571,190426],"./eu-es/virtual-events.js":[173079,693916],"./eu-es/webinar.js":[381415,992680],"./eu-es/welcome-bot.js":[null],"./eu-es/whats-new.js":[667931,324278],"./eu-es/wiki.js":[null],"./fi-fi/activity.js":[426357,416211],"./fi-fi/artifacts-platform.js":[375712,615798],"./fi-fi/audience-view-dialog.js":[454980,294122],"./fi-fi/auth.js":[425239,416211],"./fi-fi/autosuggest.js":[558789,416211],"./fi-fi/avatar.js":[176776,416211],"./fi-fi/biometric-enrollment.js":[72159,223035],"./fi-fi/breakout-rooms.js":[634632,156721],"./fi-fi/broadcast.js":[863833,660347],"./fi-fi/calendar.js":[772100,322125],"./fi-fi/calling.js":[790322,379316],"./fi-fi/campaign-notifications.js":[571937,416211],"./fi-fi/carousel-multi-card.js":[null],"./fi-fi/cast.js":[710808,416211],"./fi-fi/channels.js":[611536,416211],"./fi-fi/chat-list.js":[775782,416211],"./fi-fi/coach-report.js":[513031,98725],"./fi-fi/comment-stream.js":[353478,439809],"./fi-fi/communities.js":[809302,416211],"./fi-fi/compose.js":[742372,416211],"./fi-fi/contacts.js":[484913,416211],"./fi-fi/datepicker.js":[102489,478746],"./fi-fi/desktop.js":[null],"./fi-fi/digital-signage.js":[null],"./fi-fi/discover-surface.js":[396425,847794],"./fi-fi/edu.js":[282388,241544],"./fi-fi/embed.js":[926855,416211],"./fi-fi/errors.js":[604984,416211],"./fi-fi/esp.js":[425519,37364],"./fi-fi/extensibility-ptz-extension.js":[null],"./fi-fi/extensibility-room-remote.js":[null],"./fi-fi/extensibility.js":[724029,416211],"./fi-fi/feedback.js":[926516,939701],"./fi-fi/files.js":[864567,416211],"./fi-fi/framework.js":[351030,416211],"./fi-fi/freemium-upgrade.js":[null],"./fi-fi/funstuff.js":[761401,936437],"./fi-fi/gallery.js":[537011,239117],"./fi-fi/growth.js":[295869,416211],"./fi-fi/guardians.js":[853678,756774],"./fi-fi/health.js":[241192,721941],"./fi-fi/help.js":[null],"./fi-fi/hololens.js":[756399,379316],"./fi-fi/host-controls.js":[276921,932703],"./fi-fi/jana.js":[138469,979448],"./fi-fi/lightbox.js":[17410,416211],"./fi-fi/live-persona-card.js":[974357,416211],"./fi-fi/live-persona-editor.js":[541998,957525],"./fi-fi/lms-integration.js":[null],"./fi-fi/meet-for-work.js":[908984,119371],"./fi-fi/meeting-analytics.js":[658574,265469],"./fi-fi/meeting-apis-app.js":[null],"./fi-fi/meeting-bot.js":[null],"./fi-fi/meeting-collaboration.js":[556451,784384],"./fi-fi/meeting-flyout.js":[683930,416211],"./fi-fi/meeting-meet-app.js":[800157,416211],"./fi-fi/meeting-options.js":[412314,380473],"./fi-fi/meeting-recap.js":[262934,854022],"./fi-fi/meeting-room-console.js":[null],"./fi-fi/meeting-stream-app.js":[null],"./fi-fi/message-escalate-dialog.js":[81392,247861],"./fi-fi/messaging.js":[879263,416211],"./fi-fi/mobile-attach.js":[null],"./fi-fi/mtma-missed-notifications.js":[951510,416211],"./fi-fi/nova.js":[639597,416211],"./fi-fi/people-app.js":[null],"./fi-fi/people-picker.js":[709714,416211],"./fi-fi/people-targeting.js":[197569,96380],"./fi-fi/people.js":[702526,416211],"./fi-fi/person.js":[636213,416211],"./fi-fi/phonelink-sms.js":[190043,411582],"./fi-fi/pre-core.js":[null],"./fi-fi/premium-benefits.js":[965837,312889],"./fi-fi/presence.js":[654615,416211],"./fi-fi/queues.js":[460865,209411],"./fi-fi/recurrence.js":[255619,647573],"./fi-fi/rsc-application-permissions.js":[null],"./fi-fi/search.js":[359217,478746],"./fi-fi/semantic-object.js":[842940,380293],"./fi-fi/settings.js":[951151,416211],"./fi-fi/share-in-meetings.js":[null],"./fi-fi/share-to-teams-outlook-addin.js":[null],"./fi-fi/share-to-teams-third-party.js":[null],"./fi-fi/share-to-teams.js":[340398,847663],"./fi-fi/shortcut.js":[90529,416211],"./fi-fi/shortcuts.js":[290214,416211],"./fi-fi/simple-collab.js":[850830,416211],"./fi-fi/smart-device.js":[null],"./fi-fi/survey.js":[90076,919353],"./fi-fi/sv-flyout.js":[81133,416211],"./fi-fi/teams-and-channels.js":[529514,228437],"./fi-fi/teams-insider.js":[477124,416211],"./fi-fi/telemetry.js":[194853,416211],"./fi-fi/tfl-homepage.js":[329033,416211],"./fi-fi/tfl-onboarding.js":[779145,416211],"./fi-fi/toast-notifications.js":[310196,416211],"./fi-fi/trusted-ui.js":[null],"./fi-fi/unified-search.js":[663361,847663],"./fi-fi/unsupported-browser.js":[null],"./fi-fi/url-preview.js":[607534,416211],"./fi-fi/video-capture.js":[90196,166433],"./fi-fi/video-message.js":[741061,626886],"./fi-fi/virtual-consumer-events.js":[697749,179299],"./fi-fi/virtual-events.js":[521103,360818],"./fi-fi/webinar.js":[452711,603683],"./fi-fi/welcome-bot.js":[null],"./fi-fi/whats-new.js":[373916,416211],"./fi-fi/wiki.js":[null],"./fil-ph/activity.js":[273363,980117],"./fil-ph/artifacts-platform.js":[431944,761030],"./fil-ph/audience-view-dialog.js":[938274,351507],"./fil-ph/auth.js":[705927,980117],"./fil-ph/autosuggest.js":[83075,980117],"./fil-ph/avatar.js":[578622,980117],"./fil-ph/biometric-enrollment.js":[969410,471920],"./fil-ph/breakout-rooms.js":[476595,282982],"./fil-ph/broadcast.js":[473904,941445],"./fil-ph/calendar.js":[246720,870913],"./fil-ph/calling.js":[771276,167083],"./fil-ph/campaign-notifications.js":[465539,980117],"./fil-ph/carousel-multi-card.js":[null],"./fil-ph/cast.js":[597460,980117],"./fil-ph/channels.js":[444221,980117],"./fil-ph/chat-list.js":[285882,980117],"./fil-ph/coach-report.js":[797145,350218],"./fil-ph/comment-stream.js":[691199,880142],"./fil-ph/communities.js":[93779,980117],"./fil-ph/compose.js":[722503,980117],"./fil-ph/contacts.js":[461293,980117],"./fil-ph/datepicker.js":[630231,845153],"./fil-ph/desktop.js":[null],"./fil-ph/digital-signage.js":[null],"./fil-ph/discover-surface.js":[658265,144178],"./fil-ph/edu.js":[873011,909647],"./fil-ph/embed.js":[4290,980117],"./fil-ph/errors.js":[699604,980117],"./fil-ph/esp.js":[446525,864422],"./fil-ph/extensibility-ptz-extension.js":[null],"./fil-ph/extensibility-room-remote.js":[null],"./fil-ph/extensibility.js":[552317,980117],"./fil-ph/feedback.js":[637553,335138],"./fil-ph/files.js":[324255,980117],"./fil-ph/framework.js":[812749,980117],"./fil-ph/freemium-upgrade.js":[null],"./fil-ph/funstuff.js":[979310,284276],"./fil-ph/gallery.js":[853632,57510],"./fil-ph/growth.js":[970954,980117],"./fil-ph/guardians.js":[901554,962294],"./fil-ph/health.js":[300854,567017],"./fil-ph/help.js":[null],"./fil-ph/hololens.js":[925333,167083],"./fil-ph/host-controls.js":[215365,959009],"./fil-ph/jana.js":[333089,517637],"./fil-ph/lightbox.js":[767186,980117],"./fil-ph/live-persona-card.js":[604394,980117],"./fil-ph/live-persona-editor.js":[669600,299526],"./fil-ph/lms-integration.js":[null],"./fil-ph/meet-for-work.js":[706405,176194],"./fil-ph/meeting-analytics.js":[127860,187408],"./fil-ph/meeting-apis-app.js":[null],"./fil-ph/meeting-bot.js":[null],"./fil-ph/meeting-collaboration.js":[739924,590049],"./fil-ph/meeting-flyout.js":[836257,980117],"./fil-ph/meeting-meet-app.js":[183349,980117],"./fil-ph/meeting-options.js":[59820,961320],"./fil-ph/meeting-recap.js":[614620,900551],"./fil-ph/meeting-room-console.js":[null],"./fil-ph/meeting-stream-app.js":[null],"./fil-ph/message-escalate-dialog.js":[182286,700369],"./fil-ph/messaging.js":[102910,980117],"./fil-ph/mobile-attach.js":[null],"./fil-ph/mtma-missed-notifications.js":[925602,980117],"./fil-ph/nova.js":[757857,980117],"./fil-ph/people-app.js":[null],"./fil-ph/people-picker.js":[75778,980117],"./fil-ph/people-targeting.js":[326156,277233],"./fil-ph/people.js":[638275,980117],"./fil-ph/person.js":[920839,980117],"./fil-ph/phonelink-sms.js":[938381,346667],"./fil-ph/pre-core.js":[null],"./fil-ph/premium-benefits.js":[386105,421375],"./fil-ph/presence.js":[258313,980117],"./fil-ph/queues.js":[185374,877837],"./fil-ph/recurrence.js":[295980,200471],"./fil-ph/rsc-application-permissions.js":[null],"./fil-ph/search.js":[604374,845153],"./fil-ph/semantic-object.js":[623143,676317],"./fil-ph/settings.js":[827176,980117],"./fil-ph/share-in-meetings.js":[null],"./fil-ph/share-to-teams-outlook-addin.js":[null],"./fil-ph/share-to-teams-third-party.js":[null],"./fil-ph/share-to-teams.js":[987129,520351],"./fil-ph/shortcut.js":[607050,980117],"./fil-ph/shortcuts.js":[581576,980117],"./fil-ph/simple-collab.js":[874771,980117],"./fil-ph/smart-device.js":[null],"./fil-ph/survey.js":[495581,321346],"./fil-ph/sv-flyout.js":[810189,980117],"./fil-ph/teams-and-channels.js":[243085,157944],"./fil-ph/teams-insider.js":[804746,980117],"./fil-ph/telemetry.js":[617934,980117],"./fil-ph/tfl-homepage.js":[427964,980117],"./fil-ph/tfl-onboarding.js":[40927,980117],"./fil-ph/toast-notifications.js":[848107,980117],"./fil-ph/trusted-ui.js":[null],"./fil-ph/unified-search.js":[102366,520351],"./fil-ph/unsupported-browser.js":[null],"./fil-ph/url-preview.js":[374594,980117],"./fil-ph/video-capture.js":[864657,690531],"./fil-ph/video-message.js":[648792,653188],"./fil-ph/virtual-consumer-events.js":[321674,961739],"./fil-ph/virtual-events.js":[134480,443750],"./fil-ph/webinar.js":[76429,581249],"./fil-ph/welcome-bot.js":[null],"./fil-ph/whats-new.js":[183780,980117],"./fil-ph/wiki.js":[null],"./fr-ca/activity.js":[534619,57164],"./fr-ca/artifacts-platform.js":[182747,942595],"./fr-ca/audience-view-dialog.js":[523545,673321],"./fr-ca/auth.js":[549476,57164],"./fr-ca/autosuggest.js":[347724,57164],"./fr-ca/avatar.js":[465979,57164],"./fr-ca/biometric-enrollment.js":[500534,248098],"./fr-ca/breakout-rooms.js":[397153,387132],"./fr-ca/broadcast.js":[915395,967847],"./fr-ca/calendar.js":[103426,152287],"./fr-ca/calling.js":[828390,57069],"./fr-ca/campaign-notifications.js":[233962,57164],"./fr-ca/carousel-multi-card.js":[null],"./fr-ca/cast.js":[954416,57164],"./fr-ca/channels.js":[392389,57164],"./fr-ca/chat-list.js":[54650,57164],"./fr-ca/coach-report.js":[762860,145424],"./fr-ca/comment-stream.js":[85211,688502],"./fr-ca/communities.js":[950036,57164],"./fr-ca/compose.js":[762766,57164],"./fr-ca/contacts.js":[863311,57164],"./fr-ca/datepicker.js":[878690,480253],"./fr-ca/desktop.js":[null],"./fr-ca/digital-signage.js":[null],"./fr-ca/discover-surface.js":[466684,413768],"./fr-ca/edu.js":[68031,721231],"./fr-ca/embed.js":[528027,57164],"./fr-ca/errors.js":[875031,57164],"./fr-ca/esp.js":[131376,985381],"./fr-ca/extensibility-ptz-extension.js":[null],"./fr-ca/extensibility-room-remote.js":[null],"./fr-ca/extensibility.js":[415046,57164],"./fr-ca/feedback.js":[185715,157643],"./fr-ca/files.js":[191376,57164],"./fr-ca/framework.js":[695512,57164],"./fr-ca/freemium-upgrade.js":[null],"./fr-ca/funstuff.js":[707710,889173],"./fr-ca/gallery.js":[180299,546713],"./fr-ca/growth.js":[286574,57164],"./fr-ca/guardians.js":[766222,961235],"./fr-ca/health.js":[25418,987110],"./fr-ca/help.js":[null],"./fr-ca/hololens.js":[804749,57069],"./fr-ca/host-controls.js":[50436,97463],"./fr-ca/jana.js":[805195,381748],"./fr-ca/lightbox.js":[279371,57164],"./fr-ca/live-persona-card.js":[459093,57164],"./fr-ca/live-persona-editor.js":[85037,618903],"./fr-ca/lms-integration.js":[null],"./fr-ca/meet-for-work.js":[215465,734966],"./fr-ca/meeting-analytics.js":[836961,985340],"./fr-ca/meeting-apis-app.js":[null],"./fr-ca/meeting-bot.js":[null],"./fr-ca/meeting-collaboration.js":[93741,591366],"./fr-ca/meeting-flyout.js":[504710,57164],"./fr-ca/meeting-meet-app.js":[605261,57164],"./fr-ca/meeting-options.js":[322593,182222],"./fr-ca/meeting-recap.js":[463886,300211],"./fr-ca/meeting-room-console.js":[null],"./fr-ca/meeting-stream-app.js":[null],"./fr-ca/message-escalate-dialog.js":[741545,941787],"./fr-ca/messaging.js":[44231,57164],"./fr-ca/mobile-attach.js":[null],"./fr-ca/mtma-missed-notifications.js":[760332,57164],"./fr-ca/nova.js":[122504,57164],"./fr-ca/people-app.js":[null],"./fr-ca/people-picker.js":[474569,57164],"./fr-ca/people-targeting.js":[74142,159360],"./fr-ca/people.js":[486606,57164],"./fr-ca/person.js":[384905,57164],"./fr-ca/phonelink-sms.js":[561103,908400],"./fr-ca/pre-core.js":[null],"./fr-ca/premium-benefits.js":[240612,976121],"./fr-ca/presence.js":[669008,57164],"./fr-ca/queues.js":[396577,392968],"./fr-ca/recurrence.js":[520121,775123],"./fr-ca/rsc-application-permissions.js":[null],"./fr-ca/search.js":[820388,480253],"./fr-ca/semantic-object.js":[830692,981879],"./fr-ca/settings.js":[106300,57164],"./fr-ca/share-in-meetings.js":[null],"./fr-ca/share-to-teams-outlook-addin.js":[null],"./fr-ca/share-to-teams-third-party.js":[null],"./fr-ca/share-to-teams.js":[491806,792966],"./fr-ca/shortcut.js":[238473,57164],"./fr-ca/shortcuts.js":[460926,57164],"./fr-ca/simple-collab.js":[688290,57164],"./fr-ca/smart-device.js":[null],"./fr-ca/survey.js":[759606,257760],"./fr-ca/sv-flyout.js":[337127,57164],"./fr-ca/teams-and-channels.js":[470546,519135],"./fr-ca/teams-insider.js":[309874,57164],"./fr-ca/telemetry.js":[497224,57164],"./fr-ca/tfl-homepage.js":[885240,57164],"./fr-ca/tfl-onboarding.js":[710196,57164],"./fr-ca/toast-notifications.js":[779927,57164],"./fr-ca/trusted-ui.js":[null],"./fr-ca/unified-search.js":[21756,792966],"./fr-ca/unsupported-browser.js":[null],"./fr-ca/url-preview.js":[49769,57164],"./fr-ca/video-capture.js":[259914,24493],"./fr-ca/video-message.js":[311355,583527],"./fr-ca/virtual-consumer-events.js":[903687,766368],"./fr-ca/virtual-events.js":[324895,953578],"./fr-ca/webinar.js":[683620,682831],"./fr-ca/welcome-bot.js":[null],"./fr-ca/whats-new.js":[395533,57164],"./fr-ca/wiki.js":[null],"./fr-fr/activity.js":[896049,760325],"./fr-fr/artifacts-platform.js":[210992,553802],"./fr-fr/audience-view-dialog.js":[444291,731953],"./fr-fr/auth.js":[51073,760325],"./fr-fr/autosuggest.js":[911025,760325],"./fr-fr/avatar.js":[653487,760325],"./fr-fr/biometric-enrollment.js":[610251,737249],"./fr-fr/breakout-rooms.js":[545472,697328],"./fr-fr/broadcast.js":[601885,617794],"./fr-fr/calendar.js":[603217,744778],"./fr-fr/calling.js":[43915,500637],"./fr-fr/campaign-notifications.js":[879295,760325],"./fr-fr/carousel-multi-card.js":[null],"./fr-fr/cast.js":[976631,760325],"./fr-fr/channels.js":[468332,760325],"./fr-fr/chat-list.js":[917655,760325],"./fr-fr/coach-report.js":[107122,504858],"./fr-fr/comment-stream.js":[900094,525040],"./fr-fr/communities.js":[459251,760325],"./fr-fr/compose.js":[134120,760325],"./fr-fr/contacts.js":[802889,760325],"./fr-fr/datepicker.js":[441859,939090],"./fr-fr/desktop.js":[null],"./fr-fr/digital-signage.js":[null],"./fr-fr/discover-surface.js":[251526,760323],"./fr-fr/edu.js":[462012,244357],"./fr-fr/embed.js":[182396,760325],"./fr-fr/errors.js":[905818,760325],"./fr-fr/esp.js":[786857,534179],"./fr-fr/extensibility-ptz-extension.js":[null],"./fr-fr/extensibility-room-remote.js":[null],"./fr-fr/extensibility.js":[443598,760325],"./fr-fr/feedback.js":[886410,846064],"./fr-fr/files.js":[569471,760325],"./fr-fr/framework.js":[956931,760325],"./fr-fr/freemium-upgrade.js":[null],"./fr-fr/funstuff.js":[495557,630898],"./fr-fr/gallery.js":[977803,558035],"./fr-fr/growth.js":[480795,760325],"./fr-fr/guardians.js":[277551,142469],"./fr-fr/health.js":[816300,917706],"./fr-fr/help.js":[null],"./fr-fr/hololens.js":[413765,500637],"./fr-fr/host-controls.js":[39592,739134],"./fr-fr/jana.js":[245645,313401],"./fr-fr/lightbox.js":[915013,760325],"./fr-fr/live-persona-card.js":[616866,760325],"./fr-fr/live-persona-editor.js":[671122,949358],"./fr-fr/lms-integration.js":[null],"./fr-fr/meet-for-work.js":[366905,588890],"./fr-fr/meeting-analytics.js":[607816,60785],"./fr-fr/meeting-apis-app.js":[null],"./fr-fr/meeting-bot.js":[null],"./fr-fr/meeting-collaboration.js":[554827,120352],"./fr-fr/meeting-flyout.js":[834686,760325],"./fr-fr/meeting-meet-app.js":[648821,760325],"./fr-fr/meeting-options.js":[804758,628087],"./fr-fr/meeting-recap.js":[235798,443436],"./fr-fr/meeting-room-console.js":[null],"./fr-fr/meeting-stream-app.js":[null],"./fr-fr/message-escalate-dialog.js":[342257,181239],"./fr-fr/messaging.js":[936121,760325],"./fr-fr/mobile-attach.js":[null],"./fr-fr/mtma-missed-notifications.js":[324702,760325],"./fr-fr/nova.js":[690761,760325],"./fr-fr/people-app.js":[null],"./fr-fr/people-picker.js":[390128,760325],"./fr-fr/people-targeting.js":[346755,113739],"./fr-fr/people.js":[240293,760325],"./fr-fr/person.js":[56327,760325],"./fr-fr/phonelink-sms.js":[81994,560834],"./fr-fr/pre-core.js":[null],"./fr-fr/premium-benefits.js":[255790,450757],"./fr-fr/presence.js":[103282,760325],"./fr-fr/queues.js":[298347,306284],"./fr-fr/recurrence.js":[364561,538552],"./fr-fr/rsc-application-permissions.js":[null],"./fr-fr/search.js":[756845,939090],"./fr-fr/semantic-object.js":[517889,893870],"./fr-fr/settings.js":[332867,760325],"./fr-fr/share-in-meetings.js":[null],"./fr-fr/share-to-teams-outlook-addin.js":[null],"./fr-fr/share-to-teams-third-party.js":[null],"./fr-fr/share-to-teams.js":[938173,102774],"./fr-fr/shortcut.js":[82892,760325],"./fr-fr/shortcuts.js":[422350,760325],"./fr-fr/simple-collab.js":[730721,760325],"./fr-fr/smart-device.js":[null],"./fr-fr/survey.js":[433828,687844],"./fr-fr/sv-flyout.js":[202953,760325],"./fr-fr/teams-and-channels.js":[717977,454067],"./fr-fr/teams-insider.js":[505781,760325],"./fr-fr/telemetry.js":[922195,760325],"./fr-fr/tfl-homepage.js":[551168,760325],"./fr-fr/tfl-onboarding.js":[998303,760325],"./fr-fr/toast-notifications.js":[325212,760325],"./fr-fr/trusted-ui.js":[null],"./fr-fr/unified-search.js":[415529,102774],"./fr-fr/unsupported-browser.js":[null],"./fr-fr/url-preview.js":[162812,760325],"./fr-fr/video-capture.js":[120220,343970],"./fr-fr/video-message.js":[386549,754509],"./fr-fr/virtual-consumer-events.js":[758118,518363],"./fr-fr/virtual-events.js":[587595,630669],"./fr-fr/webinar.js":[32433,278800],"./fr-fr/welcome-bot.js":[null],"./fr-fr/whats-new.js":[425571,760325],"./fr-fr/wiki.js":[null],"./gl-es/activity.js":[967858,334496],"./gl-es/artifacts-platform.js":[250142,340600],"./gl-es/audience-view-dialog.js":[608600,716089],"./gl-es/auth.js":[464651,334496],"./gl-es/autosuggest.js":[597358,334496],"./gl-es/avatar.js":[232794,334496],"./gl-es/biometric-enrollment.js":[12414,196057],"./gl-es/breakout-rooms.js":[843392,489703],"./gl-es/broadcast.js":[432191,6942],"./gl-es/calendar.js":[462507,149590],"./gl-es/calling.js":[933004,221833],"./gl-es/campaign-notifications.js":[887716,334496],"./gl-es/carousel-multi-card.js":[null],"./gl-es/cast.js":[480749,334496],"./gl-es/channels.js":[646590,334496],"./gl-es/chat-list.js":[483567,334496],"./gl-es/coach-report.js":[928445,165518],"./gl-es/comment-stream.js":[337997,137546],"./gl-es/communities.js":[145324,334496],"./gl-es/compose.js":[664900,334496],"./gl-es/contacts.js":[857367,334496],"./gl-es/datepicker.js":[95348,269971],"./gl-es/desktop.js":[null],"./gl-es/digital-signage.js":[null],"./gl-es/discover-surface.js":[603112,810970],"./gl-es/edu.js":[133824,826569],"./gl-es/embed.js":[555796,334496],"./gl-es/errors.js":[27039,334496],"./gl-es/esp.js":[836739,531908],"./gl-es/extensibility-ptz-extension.js":[null],"./gl-es/extensibility-room-remote.js":[null],"./gl-es/extensibility.js":[297867,334496],"./gl-es/feedback.js":[780277,354972],"./gl-es/files.js":[808151,334496],"./gl-es/framework.js":[115333,334496],"./gl-es/freemium-upgrade.js":[null],"./gl-es/funstuff.js":[814974,158412],"./gl-es/gallery.js":[256650,157449],"./gl-es/growth.js":[146990,334496],"./gl-es/guardians.js":[231265,674687],"./gl-es/health.js":[969855,693762],"./gl-es/help.js":[null],"./gl-es/hololens.js":[306819,221833],"./gl-es/host-controls.js":[628762,715815],"./gl-es/jana.js":[516835,16616],"./gl-es/lightbox.js":[557918,334496],"./gl-es/live-persona-card.js":[463133,334496],"./gl-es/live-persona-editor.js":[892326,810259],"./gl-es/lms-integration.js":[null],"./gl-es/meet-for-work.js":[947535,998529],"./gl-es/meeting-analytics.js":[397258,505954],"./gl-es/meeting-apis-app.js":[null],"./gl-es/meeting-bot.js":[null],"./gl-es/meeting-collaboration.js":[708191,99986],"./gl-es/meeting-flyout.js":[537582,334496],"./gl-es/meeting-meet-app.js":[912247,334496],"./gl-es/meeting-options.js":[323492,388787],"./gl-es/meeting-recap.js":[784024,351403],"./gl-es/meeting-room-console.js":[null],"./gl-es/meeting-stream-app.js":[null],"./gl-es/message-escalate-dialog.js":[653603,690766],"./gl-es/messaging.js":[335954,334496],"./gl-es/mobile-attach.js":[null],"./gl-es/mtma-missed-notifications.js":[896775,334496],"./gl-es/nova.js":[802173,334496],"./gl-es/people-app.js":[null],"./gl-es/people-picker.js":[945315,334496],"./gl-es/people-targeting.js":[360847,118228],"./gl-es/people.js":[524042,334496],"./gl-es/person.js":[249028,334496],"./gl-es/phonelink-sms.js":[505684,957541],"./gl-es/pre-core.js":[null],"./gl-es/premium-benefits.js":[49816,57736],"./gl-es/presence.js":[564002,334496],"./gl-es/queues.js":[332160,388997],"./gl-es/recurrence.js":[876569,670200],"./gl-es/rsc-application-permissions.js":[null],"./gl-es/search.js":[32893,269971],"./gl-es/semantic-object.js":[865204,333981],"./gl-es/settings.js":[912160,334496],"./gl-es/share-in-meetings.js":[null],"./gl-es/share-to-teams-outlook-addin.js":[null],"./gl-es/share-to-teams-third-party.js":[null],"./gl-es/share-to-teams.js":[888687,793200],"./gl-es/shortcut.js":[43235,334496],"./gl-es/shortcuts.js":[49133,334496],"./gl-es/simple-collab.js":[903456,334496],"./gl-es/smart-device.js":[null],"./gl-es/survey.js":[161333,913749],"./gl-es/sv-flyout.js":[207142,334496],"./gl-es/teams-and-channels.js":[945788,988558],"./gl-es/teams-insider.js":[187635,334496],"./gl-es/telemetry.js":[959336,334496],"./gl-es/tfl-homepage.js":[801848,334496],"./gl-es/tfl-onboarding.js":[826412,334496],"./gl-es/toast-notifications.js":[837090,334496],"./gl-es/trusted-ui.js":[null],"./gl-es/unified-search.js":[886752,793200],"./gl-es/unsupported-browser.js":[null],"./gl-es/url-preview.js":[385698,334496],"./gl-es/video-capture.js":[434895,865947],"./gl-es/video-message.js":[131718,328749],"./gl-es/virtual-consumer-events.js":[8522,57664],"./gl-es/virtual-events.js":[698741,170796],"./gl-es/webinar.js":[961330,134257],"./gl-es/welcome-bot.js":[null],"./gl-es/whats-new.js":[19186,334496],"./gl-es/wiki.js":[null],"./he-il/activity.js":[403597,785333],"./he-il/artifacts-platform.js":[112677,410047],"./he-il/audience-view-dialog.js":[548263,449744],"./he-il/auth.js":[129209,785333],"./he-il/autosuggest.js":[758075,785333],"./he-il/avatar.js":[959602,785333],"./he-il/biometric-enrollment.js":[725446,99598],"./he-il/breakout-rooms.js":[613801,275339],"./he-il/broadcast.js":[957221,54541],"./he-il/calendar.js":[680733,921777],"./he-il/calling.js":[104053,944047],"./he-il/campaign-notifications.js":[916319,785333],"./he-il/carousel-multi-card.js":[null],"./he-il/cast.js":[390480,785333],"./he-il/channels.js":[388121,785333],"./he-il/chat-list.js":[177459,785333],"./he-il/coach-report.js":[958007,789525],"./he-il/comment-stream.js":[673652,380163],"./he-il/communities.js":[18953,785333],"./he-il/compose.js":[851415,785333],"./he-il/contacts.js":[253322,785333],"./he-il/datepicker.js":[186840,849120],"./he-il/desktop.js":[null],"./he-il/digital-signage.js":[null],"./he-il/discover-surface.js":[543772,855777],"./he-il/edu.js":[279873,657763],"./he-il/embed.js":[588411,785333],"./he-il/errors.js":[770819,785333],"./he-il/esp.js":[978759,313666],"./he-il/extensibility-ptz-extension.js":[null],"./he-il/extensibility-room-remote.js":[null],"./he-il/extensibility.js":[947426,785333],"./he-il/feedback.js":[633223,948836],"./he-il/files.js":[923499,785333],"./he-il/framework.js":[622681,785333],"./he-il/freemium-upgrade.js":[null],"./he-il/funstuff.js":[413215,710566],"./he-il/gallery.js":[834354,309981],"./he-il/growth.js":[452430,785333],"./he-il/guardians.js":[464657,97202],"./he-il/health.js":[888198,632724],"./he-il/help.js":[null],"./he-il/hololens.js":[280646,944047],"./he-il/host-controls.js":[344719,151257],"./he-il/jana.js":[165342,292041],"./he-il/lightbox.js":[908591,785333],"./he-il/live-persona-card.js":[532384,785333],"./he-il/live-persona-editor.js":[595887,48710],"./he-il/lms-integration.js":[null],"./he-il/meet-for-work.js":[251606,358137],"./he-il/meeting-analytics.js":[110754,498261],"./he-il/meeting-apis-app.js":[null],"./he-il/meeting-bot.js":[null],"./he-il/meeting-collaboration.js":[620147,767634],"./he-il/meeting-flyout.js":[955884,785333],"./he-il/meeting-meet-app.js":[778121,785333],"./he-il/meeting-options.js":[645997,47838],"./he-il/meeting-recap.js":[958835,900183],"./he-il/meeting-room-console.js":[null],"./he-il/meeting-stream-app.js":[null],"./he-il/message-escalate-dialog.js":[287358,379959],"./he-il/messaging.js":[146480,785333],"./he-il/mobile-attach.js":[null],"./he-il/mtma-missed-notifications.js":[507470,785333],"./he-il/nova.js":[914559,785333],"./he-il/people-app.js":[null],"./he-il/people-picker.js":[62058,785333],"./he-il/people-targeting.js":[627426,344975],"./he-il/people.js":[892894,785333],"./he-il/person.js":[987573,785333],"./he-il/phonelink-sms.js":[180325,104374],"./he-il/pre-core.js":[null],"./he-il/premium-benefits.js":[199926,330005],"./he-il/presence.js":[35110,785333],"./he-il/queues.js":[37406,853223],"./he-il/recurrence.js":[88528,600809],"./he-il/rsc-application-permissions.js":[null],"./he-il/search.js":[919336,849120],"./he-il/semantic-object.js":[480295,37131],"./he-il/settings.js":[783859,785333],"./he-il/share-in-meetings.js":[null],"./he-il/share-to-teams-outlook-addin.js":[null],"./he-il/share-to-teams-third-party.js":[null],"./he-il/share-to-teams.js":[976007,434692],"./he-il/shortcut.js":[775530,785333],"./he-il/shortcuts.js":[524378,785333],"./he-il/simple-collab.js":[52370,785333],"./he-il/smart-device.js":[null],"./he-il/survey.js":[528169,226816],"./he-il/sv-flyout.js":[995768,785333],"./he-il/teams-and-channels.js":[510202,122413],"./he-il/teams-insider.js":[391101,785333],"./he-il/telemetry.js":[92694,785333],"./he-il/tfl-homepage.js":[825862,785333],"./he-il/tfl-onboarding.js":[442642,785333],"./he-il/toast-notifications.js":[227256,785333],"./he-il/trusted-ui.js":[null],"./he-il/unified-search.js":[330809,434692],"./he-il/unsupported-browser.js":[null],"./he-il/url-preview.js":[823822,785333],"./he-il/video-capture.js":[143989,925580],"./he-il/video-message.js":[824559,879659],"./he-il/virtual-consumer-events.js":[355283,957690],"./he-il/virtual-events.js":[938771,453196],"./he-il/webinar.js":[906705,11957],"./he-il/welcome-bot.js":[null],"./he-il/whats-new.js":[341607,785333],"./he-il/wiki.js":[null],"./hi-in/activity.js":[782904,870716],"./hi-in/artifacts-platform.js":[428342,854314],"./hi-in/audience-view-dialog.js":[569654,63335],"./hi-in/auth.js":[188123,870716],"./hi-in/autosuggest.js":[199521,870716],"./hi-in/avatar.js":[428229,870716],"./hi-in/biometric-enrollment.js":[844642,469338],"./hi-in/breakout-rooms.js":[348325,731591],"./hi-in/broadcast.js":[369479,536227],"./hi-in/calendar.js":[647248,80262],"./hi-in/calling.js":[143354,334349],"./hi-in/campaign-notifications.js":[878729,870716],"./hi-in/carousel-multi-card.js":[null],"./hi-in/cast.js":[551565,870716],"./hi-in/channels.js":[571109,870716],"./hi-in/chat-list.js":[72517,870716],"./hi-in/coach-report.js":[865957,59797],"./hi-in/comment-stream.js":[869209,727144],"./hi-in/communities.js":[416640,870716],"./hi-in/compose.js":[616649,870716],"./hi-in/contacts.js":[177247,870716],"./hi-in/datepicker.js":[286977,723794],"./hi-in/desktop.js":[null],"./hi-in/digital-signage.js":[null],"./hi-in/discover-surface.js":[27968,734632],"./hi-in/edu.js":[446140,831933],"./hi-in/embed.js":[872593,870716],"./hi-in/errors.js":[25470,870716],"./hi-in/esp.js":[468717,829046],"./hi-in/extensibility-ptz-extension.js":[null],"./hi-in/extensibility-room-remote.js":[null],"./hi-in/extensibility.js":[542502,870716],"./hi-in/feedback.js":[878961,759374],"./hi-in/files.js":[934060,870716],"./hi-in/framework.js":[521740,870716],"./hi-in/freemium-upgrade.js":[null],"./hi-in/funstuff.js":[882656,136410],"./hi-in/gallery.js":[195232,730922],"./hi-in/growth.js":[717070,870716],"./hi-in/guardians.js":[86813,206336],"./hi-in/health.js":[776167,202148],"./hi-in/help.js":[null],"./hi-in/hololens.js":[97717,334349],"./hi-in/host-controls.js":[61968,720054],"./hi-in/jana.js":[276790,241166],"./hi-in/lightbox.js":[513271,870716],"./hi-in/live-persona-card.js":[868120,870716],"./hi-in/live-persona-editor.js":[691374,3796],"./hi-in/lms-integration.js":[null],"./hi-in/meet-for-work.js":[545023,91135],"./hi-in/meeting-analytics.js":[68836,810589],"./hi-in/meeting-apis-app.js":[null],"./hi-in/meeting-bot.js":[null],"./hi-in/meeting-collaboration.js":[542733,318957],"./hi-in/meeting-flyout.js":[798545,870716],"./hi-in/meeting-meet-app.js":[932430,870716],"./hi-in/meeting-options.js":[112298,793337],"./hi-in/meeting-recap.js":[911188,413199],"./hi-in/meeting-room-console.js":[null],"./hi-in/meeting-stream-app.js":[null],"./hi-in/message-escalate-dialog.js":[486187,520401],"./hi-in/messaging.js":[757891,870716],"./hi-in/mobile-attach.js":[null],"./hi-in/mtma-missed-notifications.js":[410656,870716],"./hi-in/nova.js":[130591,870716],"./hi-in/people-app.js":[null],"./hi-in/people-picker.js":[866391,870716],"./hi-in/people-targeting.js":[981659,335833],"./hi-in/people.js":[576024,870716],"./hi-in/person.js":[106614,870716],"./hi-in/phonelink-sms.js":[89892,540771],"./hi-in/pre-core.js":[null],"./hi-in/premium-benefits.js":[247468,885490],"./hi-in/presence.js":[634738,870716],"./hi-in/queues.js":[71790,198723],"./hi-in/recurrence.js":[991822,622999],"./hi-in/rsc-application-permissions.js":[null],"./hi-in/search.js":[691101,723794],"./hi-in/semantic-object.js":[608386,697606],"./hi-in/settings.js":[325510,870716],"./hi-in/share-in-meetings.js":[null],"./hi-in/share-to-teams-outlook-addin.js":[null],"./hi-in/share-to-teams-third-party.js":[null],"./hi-in/share-to-teams.js":[289648,141064],"./hi-in/shortcut.js":[780341,870716],"./hi-in/shortcuts.js":[833424,870716],"./hi-in/simple-collab.js":[512101,870716],"./hi-in/smart-device.js":[null],"./hi-in/survey.js":[43284,665054],"./hi-in/sv-flyout.js":[460433,870716],"./hi-in/teams-and-channels.js":[161806,929922],"./hi-in/teams-insider.js":[979749,870716],"./hi-in/telemetry.js":[229823,870716],"./hi-in/tfl-homepage.js":[10668,870716],"./hi-in/tfl-onboarding.js":[109558,870716],"./hi-in/toast-notifications.js":[808965,870716],"./hi-in/trusted-ui.js":[null],"./hi-in/unified-search.js":[798871,141064],"./hi-in/unsupported-browser.js":[null],"./hi-in/url-preview.js":[577308,870716],"./hi-in/video-capture.js":[951548,372487],"./hi-in/video-message.js":[231582,756391],"./hi-in/virtual-consumer-events.js":[947381,570960],"./hi-in/virtual-events.js":[504500,136608],"./hi-in/webinar.js":[697294,893288],"./hi-in/welcome-bot.js":[null],"./hi-in/whats-new.js":[254347,870716],"./hi-in/wiki.js":[null],"./hr-hr/activity.js":[299780,489109],"./hr-hr/artifacts-platform.js":[447477,154212],"./hr-hr/audience-view-dialog.js":[713107,115314],"./hr-hr/auth.js":[913546,489109],"./hr-hr/autosuggest.js":[757525,489109],"./hr-hr/avatar.js":[556611,489109],"./hr-hr/biometric-enrollment.js":[101619,733075],"./hr-hr/breakout-rooms.js":[294497,425527],"./hr-hr/broadcast.js":[864623,883654],"./hr-hr/calendar.js":[279118,771216],"./hr-hr/calling.js":[532841,42044],"./hr-hr/campaign-notifications.js":[54447,489109],"./hr-hr/carousel-multi-card.js":[null],"./hr-hr/cast.js":[824457,489109],"./hr-hr/channels.js":[145796,489109],"./hr-hr/chat-list.js":[444600,489109],"./hr-hr/coach-report.js":[917355,481550],"./hr-hr/comment-stream.js":[392051,31490],"./hr-hr/communities.js":[570727,489109],"./hr-hr/compose.js":[466539,489109],"./hr-hr/contacts.js":[860528,489109],"./hr-hr/datepicker.js":[827327,870723],"./hr-hr/desktop.js":[null],"./hr-hr/digital-signage.js":[null],"./hr-hr/discover-surface.js":[431937,470676],"./hr-hr/edu.js":[505418,989560],"./hr-hr/embed.js":[89603,489109],"./hr-hr/errors.js":[793573,489109],"./hr-hr/esp.js":[490035,288910],"./hr-hr/extensibility-ptz-extension.js":[null],"./hr-hr/extensibility-room-remote.js":[null],"./hr-hr/extensibility.js":[63702,489109],"./hr-hr/feedback.js":[170863,717868],"./hr-hr/files.js":[898204,489109],"./hr-hr/framework.js":[225667,489109],"./hr-hr/freemium-upgrade.js":[null],"./hr-hr/funstuff.js":[784273,664384],"./hr-hr/gallery.js":[301895,16746],"./hr-hr/growth.js":[616056,489109],"./hr-hr/guardians.js":[610263,689118],"./hr-hr/health.js":[591781,296046],"./hr-hr/help.js":[null],"./hr-hr/hololens.js":[882032,42044],"./hr-hr/host-controls.js":[577970,490112],"./hr-hr/jana.js":[317817,699798],"./hr-hr/lightbox.js":[891561,489109],"./hr-hr/live-persona-card.js":[496288,489109],"./hr-hr/live-persona-editor.js":[73473,826528],"./hr-hr/lms-integration.js":[null],"./hr-hr/meet-for-work.js":[628173,475086],"./hr-hr/meeting-analytics.js":[821137,156312],"./hr-hr/meeting-apis-app.js":[null],"./hr-hr/meeting-bot.js":[null],"./hr-hr/meeting-collaboration.js":[122288,119069],"./hr-hr/meeting-flyout.js":[349010,489109],"./hr-hr/meeting-meet-app.js":[437139,489109],"./hr-hr/meeting-options.js":[710573,855228],"./hr-hr/meeting-recap.js":[461399,614401],"./hr-hr/meeting-room-console.js":[null],"./hr-hr/meeting-stream-app.js":[null],"./hr-hr/message-escalate-dialog.js":[90,996357],"./hr-hr/messaging.js":[147983,489109],"./hr-hr/mobile-attach.js":[null],"./hr-hr/mtma-missed-notifications.js":[964194,489109],"./hr-hr/nova.js":[867838,489109],"./hr-hr/people-app.js":[null],"./hr-hr/people-picker.js":[917806,489109],"./hr-hr/people-targeting.js":[23585,589167],"./hr-hr/people.js":[80847,489109],"./hr-hr/person.js":[492615,489109],"./hr-hr/phonelink-sms.js":[395282,265562],"./hr-hr/pre-core.js":[null],"./hr-hr/premium-benefits.js":[956733,56384],"./hr-hr/presence.js":[692379,489109],"./hr-hr/queues.js":[307849,632940],"./hr-hr/recurrence.js":[671969,566467],"./hr-hr/rsc-application-permissions.js":[null],"./hr-hr/search.js":[495394,870723],"./hr-hr/semantic-object.js":[32077,471678],"./hr-hr/settings.js":[863314,489109],"./hr-hr/share-in-meetings.js":[null],"./hr-hr/share-to-teams-outlook-addin.js":[null],"./hr-hr/share-to-teams-third-party.js":[null],"./hr-hr/share-to-teams.js":[305436,82749],"./hr-hr/shortcut.js":[182737,489109],"./hr-hr/shortcuts.js":[271781,489109],"./hr-hr/simple-collab.js":[852609,489109],"./hr-hr/smart-device.js":[null],"./hr-hr/survey.js":[707897,182117],"./hr-hr/sv-flyout.js":[221185,489109],"./hr-hr/teams-and-channels.js":[552242,609436],"./hr-hr/teams-insider.js":[270894,489109],"./hr-hr/telemetry.js":[196843,489109],"./hr-hr/tfl-homepage.js":[284752,489109],"./hr-hr/tfl-onboarding.js":[634178,489109],"./hr-hr/toast-notifications.js":[874895,489109],"./hr-hr/trusted-ui.js":[null],"./hr-hr/unified-search.js":[890274,82749],"./hr-hr/unsupported-browser.js":[null],"./hr-hr/url-preview.js":[958494,489109],"./hr-hr/video-capture.js":[651386,793944],"./hr-hr/video-message.js":[697410,612389],"./hr-hr/virtual-consumer-events.js":[381904,17570],"./hr-hr/virtual-events.js":[194332,142325],"./hr-hr/webinar.js":[185866,877869],"./hr-hr/welcome-bot.js":[null],"./hr-hr/whats-new.js":[76353,489109],"./hr-hr/wiki.js":[null],"./hu-hu/activity.js":[904281,320323],"./hu-hu/artifacts-platform.js":[542516,617434],"./hu-hu/audience-view-dialog.js":[703027,919220],"./hu-hu/auth.js":[103993,320323],"./hu-hu/autosuggest.js":[273743,320323],"./hu-hu/avatar.js":[589162,320323],"./hu-hu/biometric-enrollment.js":[429251,314727],"./hu-hu/breakout-rooms.js":[491897,954639],"./hu-hu/broadcast.js":[989321,912671],"./hu-hu/calendar.js":[627163,598805],"./hu-hu/calling.js":[527362,99592],"./hu-hu/campaign-notifications.js":[363803,320323],"./hu-hu/carousel-multi-card.js":[null],"./hu-hu/cast.js":[235279,320323],"./hu-hu/channels.js":[831005,320323],"./hu-hu/chat-list.js":[703405,320323],"./hu-hu/coach-report.js":[338313,788861],"./hu-hu/comment-stream.js":[832126,806278],"./hu-hu/communities.js":[253892,320323],"./hu-hu/compose.js":[615903,320323],"./hu-hu/contacts.js":[637672,320323],"./hu-hu/datepicker.js":[328628,153715],"./hu-hu/desktop.js":[null],"./hu-hu/digital-signage.js":[null],"./hu-hu/discover-surface.js":[66879,405913],"./hu-hu/edu.js":[853212,919458],"./hu-hu/embed.js":[331463,320323],"./hu-hu/errors.js":[568604,320323],"./hu-hu/esp.js":[101303,996449],"./hu-hu/extensibility-ptz-extension.js":[null],"./hu-hu/extensibility-room-remote.js":[null],"./hu-hu/extensibility.js":[878493,320323],"./hu-hu/feedback.js":[972081,987470],"./hu-hu/files.js":[365766,320323],"./hu-hu/framework.js":[99476,320323],"./hu-hu/freemium-upgrade.js":[null],"./hu-hu/funstuff.js":[692889,848934],"./hu-hu/gallery.js":[89249,277527],"./hu-hu/growth.js":[817190,320323],"./hu-hu/guardians.js":[762806,727910],"./hu-hu/health.js":[932208,596269],"./hu-hu/help.js":[null],"./hu-hu/hololens.js":[51030,99592],"./hu-hu/host-controls.js":[703017,907731],"./hu-hu/jana.js":[801426,253690],"./hu-hu/lightbox.js":[834396,320323],"./hu-hu/live-persona-card.js":[708236,320323],"./hu-hu/live-persona-editor.js":[141140,260543],"./hu-hu/lms-integration.js":[null],"./hu-hu/meet-for-work.js":[114121,103972],"./hu-hu/meeting-analytics.js":[664611,137589],"./hu-hu/meeting-apis-app.js":[null],"./hu-hu/meeting-bot.js":[null],"./hu-hu/meeting-collaboration.js":[939127,396211],"./hu-hu/meeting-flyout.js":[380084,320323],"./hu-hu/meeting-meet-app.js":[566856,320323],"./hu-hu/meeting-options.js":[67270,650391],"./hu-hu/meeting-recap.js":[462972,257621],"./hu-hu/meeting-room-console.js":[null],"./hu-hu/meeting-stream-app.js":[null],"./hu-hu/message-escalate-dialog.js":[220001,329367],"./hu-hu/messaging.js":[592174,320323],"./hu-hu/mobile-attach.js":[null],"./hu-hu/mtma-missed-notifications.js":[6596,320323],"./hu-hu/nova.js":[446226,320323],"./hu-hu/people-app.js":[null],"./hu-hu/people-picker.js":[92469,320323],"./hu-hu/people-targeting.js":[588313,302488],"./hu-hu/people.js":[967897,320323],"./hu-hu/person.js":[14930,320323],"./hu-hu/phonelink-sms.js":[88461,835176],"./hu-hu/pre-core.js":[null],"./hu-hu/premium-benefits.js":[654742,294417],"./hu-hu/presence.js":[495337,320323],"./hu-hu/queues.js":[720645,504759],"./hu-hu/recurrence.js":[604825,427269],"./hu-hu/rsc-application-permissions.js":[null],"./hu-hu/search.js":[803125,153715],"./hu-hu/semantic-object.js":[394881,598993],"./hu-hu/settings.js":[317805,320323],"./hu-hu/share-in-meetings.js":[null],"./hu-hu/share-to-teams-outlook-addin.js":[null],"./hu-hu/share-to-teams-third-party.js":[null],"./hu-hu/share-to-teams.js":[684468,578609],"./hu-hu/shortcut.js":[761456,320323],"./hu-hu/shortcuts.js":[885910,320323],"./hu-hu/simple-collab.js":[635877,320323],"./hu-hu/smart-device.js":[null],"./hu-hu/survey.js":[512483,207545],"./hu-hu/sv-flyout.js":[904089,320323],"./hu-hu/teams-and-channels.js":[646870,793241],"./hu-hu/teams-insider.js":[311615,320323],"./hu-hu/telemetry.js":[641951,320323],"./hu-hu/tfl-homepage.js":[785246,320323],"./hu-hu/tfl-onboarding.js":[563337,320323],"./hu-hu/toast-notifications.js":[614100,320323],"./hu-hu/trusted-ui.js":[null],"./hu-hu/unified-search.js":[517904,578609],"./hu-hu/unsupported-browser.js":[null],"./hu-hu/url-preview.js":[334218,320323],"./hu-hu/video-capture.js":[942464,151566],"./hu-hu/video-message.js":[506789,445084],"./hu-hu/virtual-consumer-events.js":[918552,716391],"./hu-hu/virtual-events.js":[185314,172325],"./hu-hu/webinar.js":[751170,206355],"./hu-hu/welcome-bot.js":[null],"./hu-hu/whats-new.js":[196987,320323],"./hu-hu/wiki.js":[null],"./id-id/activity.js":[945925,203846],"./id-id/artifacts-platform.js":[92031,665515],"./id-id/audience-view-dialog.js":[677667,672055],"./id-id/auth.js":[42897,203846],"./id-id/autosuggest.js":[651774,203846],"./id-id/avatar.js":[352273,203846],"./id-id/biometric-enrollment.js":[497856,774896],"./id-id/breakout-rooms.js":[382830,888150],"./id-id/broadcast.js":[88468,403817],"./id-id/calendar.js":[596288,634884],"./id-id/calling.js":[842720,800824],"./id-id/campaign-notifications.js":[391213,203846],"./id-id/carousel-multi-card.js":[null],"./id-id/cast.js":[976031,203846],"./id-id/channels.js":[400717,203846],"./id-id/chat-list.js":[561838,203846],"./id-id/coach-report.js":[188752,143338],"./id-id/comment-stream.js":[924765,126103],"./id-id/communities.js":[470603,203846],"./id-id/compose.js":[586157,203846],"./id-id/contacts.js":[656329,203846],"./id-id/datepicker.js":[535325,384517],"./id-id/desktop.js":[null],"./id-id/digital-signage.js":[null],"./id-id/discover-surface.js":[495061,185541],"./id-id/edu.js":[557966,758737],"./id-id/embed.js":[691120,203846],"./id-id/errors.js":[125996,203846],"./id-id/esp.js":[758262,276370],"./id-id/extensibility-ptz-extension.js":[null],"./id-id/extensibility-room-remote.js":[null],"./id-id/extensibility.js":[916235,203846],"./id-id/feedback.js":[477966,762718],"./id-id/files.js":[313630,203846],"./id-id/framework.js":[977620,203846],"./id-id/freemium-upgrade.js":[null],"./id-id/funstuff.js":[598990,190805],"./id-id/gallery.js":[604464,583059],"./id-id/growth.js":[321287,203846],"./id-id/guardians.js":[89568,545965],"./id-id/health.js":[828412,826354],"./id-id/help.js":[null],"./id-id/hololens.js":[168420,800824],"./id-id/host-controls.js":[861997,233920],"./id-id/jana.js":[408992,908011],"./id-id/lightbox.js":[515570,203846],"./id-id/live-persona-card.js":[417981,203846],"./id-id/live-persona-editor.js":[472135,596175],"./id-id/lms-integration.js":[null],"./id-id/meet-for-work.js":[585962,829955],"./id-id/meeting-analytics.js":[528262,897620],"./id-id/meeting-apis-app.js":[null],"./id-id/meeting-bot.js":[null],"./id-id/meeting-collaboration.js":[614780,653831],"./id-id/meeting-flyout.js":[540518,203846],"./id-id/meeting-meet-app.js":[471160,203846],"./id-id/meeting-options.js":[150396,371993],"./id-id/meeting-recap.js":[91342,351102],"./id-id/meeting-room-console.js":[null],"./id-id/meeting-stream-app.js":[null],"./id-id/message-escalate-dialog.js":[829682,20702],"./id-id/messaging.js":[184210,203846],"./id-id/mobile-attach.js":[null],"./id-id/mtma-missed-notifications.js":[406554,203846],"./id-id/nova.js":[508181,203846],"./id-id/people-app.js":[null],"./id-id/people-picker.js":[486492,203846],"./id-id/people-targeting.js":[393998,101659],"./id-id/people.js":[241700,203846],"./id-id/person.js":[658356,203846],"./id-id/phonelink-sms.js":[906002,780445],"./id-id/pre-core.js":[null],"./id-id/premium-benefits.js":[979177,292947],"./id-id/presence.js":[540661,203846],"./id-id/queues.js":[849816,936614],"./id-id/recurrence.js":[889886,667681],"./id-id/rsc-application-permissions.js":[null],"./id-id/search.js":[263449,384517],"./id-id/semantic-object.js":[680061,989676],"./id-id/settings.js":[740526,203846],"./id-id/share-in-meetings.js":[null],"./id-id/share-to-teams-outlook-addin.js":[null],"./id-id/share-to-teams-third-party.js":[null],"./id-id/share-to-teams.js":[288333,689509],"./id-id/shortcut.js":[106559,203846],"./id-id/shortcuts.js":[860581,203846],"./id-id/simple-collab.js":[190374,203846],"./id-id/smart-device.js":[null],"./id-id/survey.js":[586490,773170],"./id-id/sv-flyout.js":[498364,203846],"./id-id/teams-and-channels.js":[446983,348943],"./id-id/teams-insider.js":[121604,203846],"./id-id/telemetry.js":[478413,203846],"./id-id/tfl-homepage.js":[578523,203846],"./id-id/tfl-onboarding.js":[394735,203846],"./id-id/toast-notifications.js":[333267,203846],"./id-id/trusted-ui.js":[null],"./id-id/unified-search.js":[655984,689509],"./id-id/unsupported-browser.js":[null],"./id-id/url-preview.js":[946876,203846],"./id-id/video-capture.js":[419699,433754],"./id-id/video-message.js":[192688,367261],"./id-id/virtual-consumer-events.js":[772035,853580],"./id-id/virtual-events.js":[381700,386683],"./id-id/webinar.js":[667844,76141],"./id-id/welcome-bot.js":[null],"./id-id/whats-new.js":[39926,203846],"./id-id/wiki.js":[null],"./is-is/activity.js":[52576,953993],"./is-is/artifacts-platform.js":[76760,933139],"./is-is/audience-view-dialog.js":[572578,446631],"./is-is/auth.js":[127835,953993],"./is-is/autosuggest.js":[652800,953993],"./is-is/avatar.js":[84050,953993],"./is-is/biometric-enrollment.js":[116939,945801],"./is-is/breakout-rooms.js":[513181,93296],"./is-is/broadcast.js":[210414,746873],"./is-is/calendar.js":[26375,873312],"./is-is/calling.js":[549134,581706],"./is-is/campaign-notifications.js":[817064,953993],"./is-is/carousel-multi-card.js":[null],"./is-is/cast.js":[77199,953993],"./is-is/channels.js":[142562,953993],"./is-is/chat-list.js":[5169,953993],"./is-is/coach-report.js":[199042,258004],"./is-is/comment-stream.js":[385105,31945],"./is-is/communities.js":[844284,953993],"./is-is/compose.js":[299106,953993],"./is-is/contacts.js":[247664,953993],"./is-is/datepicker.js":[825719,707620],"./is-is/desktop.js":[null],"./is-is/digital-signage.js":[null],"./is-is/discover-surface.js":[753264,466887],"./is-is/edu.js":[901525,559930],"./is-is/embed.js":[773928,953993],"./is-is/errors.js":[991092,953993],"./is-is/esp.js":[444941,423402],"./is-is/extensibility-ptz-extension.js":[null],"./is-is/extensibility-room-remote.js":[null],"./is-is/extensibility.js":[727824,953993],"./is-is/feedback.js":[16e3,946722],"./is-is/files.js":[331673,953993],"./is-is/framework.js":[862425,953993],"./is-is/freemium-upgrade.js":[null],"./is-is/funstuff.js":[632337,449437],"./is-is/gallery.js":[235860,629837],"./is-is/growth.js":[62246,953993],"./is-is/guardians.js":[629994,97596],"./is-is/health.js":[48460,883254],"./is-is/help.js":[null],"./is-is/hololens.js":[107399,581706],"./is-is/host-controls.js":[897566,684114],"./is-is/jana.js":[173357,818945],"./is-is/lightbox.js":[256370,953993],"./is-is/live-persona-card.js":[384842,953993],"./is-is/live-persona-editor.js":[393440,47548],"./is-is/lms-integration.js":[null],"./is-is/meet-for-work.js":[389259,331433],"./is-is/meeting-analytics.js":[402334,506552],"./is-is/meeting-apis-app.js":[null],"./is-is/meeting-bot.js":[null],"./is-is/meeting-collaboration.js":[640489,969345],"./is-is/meeting-flyout.js":[600797,953993],"./is-is/meeting-meet-app.js":[279397,953993],"./is-is/meeting-options.js":[654528,213692],"./is-is/meeting-recap.js":[152746,691195],"./is-is/meeting-room-console.js":[null],"./is-is/meeting-stream-app.js":[null],"./is-is/message-escalate-dialog.js":[612913,582366],"./is-is/messaging.js":[475169,953993],"./is-is/mobile-attach.js":[null],"./is-is/mtma-missed-notifications.js":[121979,953993],"./is-is/nova.js":[896454,953993],"./is-is/people-app.js":[null],"./is-is/people-picker.js":[443950,953993],"./is-is/people-targeting.js":[946242,115078],"./is-is/people.js":[579240,953993],"./is-is/person.js":[605697,953993],"./is-is/phonelink-sms.js":[743569,541872],"./is-is/pre-core.js":[null],"./is-is/premium-benefits.js":[383119,849818],"./is-is/presence.js":[278252,953993],"./is-is/queues.js":[993146,216390],"./is-is/recurrence.js":[705605,713838],"./is-is/rsc-application-permissions.js":[null],"./is-is/search.js":[642507,707620],"./is-is/semantic-object.js":[545366,313507],"./is-is/settings.js":[670322,953993],"./is-is/share-in-meetings.js":[null],"./is-is/share-to-teams-outlook-addin.js":[null],"./is-is/share-to-teams-third-party.js":[null],"./is-is/share-to-teams.js":[593252,380127],"./is-is/shortcut.js":[158948,953993],"./is-is/shortcuts.js":[22427,953993],"./is-is/simple-collab.js":[145973,953993],"./is-is/smart-device.js":[null],"./is-is/survey.js":[851432,723968],"./is-is/sv-flyout.js":[623578,953993],"./is-is/teams-and-channels.js":[274137,793400],"./is-is/teams-insider.js":[608007,953993],"./is-is/telemetry.js":[414911,953993],"./is-is/tfl-homepage.js":[299766,953993],"./is-is/tfl-onboarding.js":[283637,953993],"./is-is/toast-notifications.js":[903385,953993],"./is-is/trusted-ui.js":[null],"./is-is/unified-search.js":[258366,380127],"./is-is/unsupported-browser.js":[null],"./is-is/url-preview.js":[741075,953993],"./is-is/video-capture.js":[515739,697225],"./is-is/video-message.js":[448634,431245],"./is-is/virtual-consumer-events.js":[536666,854311],"./is-is/virtual-events.js":[672974,677496],"./is-is/webinar.js":[421989,764010],"./is-is/welcome-bot.js":[null],"./is-is/whats-new.js":[162238,953993],"./is-is/wiki.js":[null],"./it-it/activity.js":[456881,401983],"./it-it/artifacts-platform.js":[371514,1215],"./it-it/audience-view-dialog.js":[675884,484713],"./it-it/auth.js":[745598,401983],"./it-it/autosuggest.js":[250641,401983],"./it-it/avatar.js":[113258,401983],"./it-it/biometric-enrollment.js":[217654,314095],"./it-it/breakout-rooms.js":[661054,106830],"./it-it/broadcast.js":[398028,962382],"./it-it/calendar.js":[181531,745999],"./it-it/calling.js":[899116,797119],"./it-it/campaign-notifications.js":[846711,401983],"./it-it/carousel-multi-card.js":[null],"./it-it/cast.js":[10294,401983],"./it-it/channels.js":[51845,401983],"./it-it/chat-list.js":[594336,401983],"./it-it/coach-report.js":[220892,369658],"./it-it/comment-stream.js":[213313,531405],"./it-it/communities.js":[799408,401983],"./it-it/compose.js":[561395,401983],"./it-it/contacts.js":[685471,401983],"./it-it/datepicker.js":[776049,476293],"./it-it/desktop.js":[null],"./it-it/digital-signage.js":[null],"./it-it/discover-surface.js":[961735,578857],"./it-it/edu.js":[5866,423870],"./it-it/embed.js":[575899,401983],"./it-it/errors.js":[551820,401983],"./it-it/esp.js":[148165,17984],"./it-it/extensibility-ptz-extension.js":[null],"./it-it/extensibility-room-remote.js":[null],"./it-it/extensibility.js":[963736,401983],"./it-it/feedback.js":[477867,278011],"./it-it/files.js":[173495,401983],"./it-it/framework.js":[426910,401983],"./it-it/freemium-upgrade.js":[null],"./it-it/funstuff.js":[224927,840397],"./it-it/gallery.js":[54677,107215],"./it-it/growth.js":[324260,401983],"./it-it/guardians.js":[601728,903301],"./it-it/health.js":[804199,124572],"./it-it/help.js":[null],"./it-it/hololens.js":[939027,797119],"./it-it/host-controls.js":[692059,965582],"./it-it/jana.js":[875327,637959],"./it-it/lightbox.js":[847917,401983],"./it-it/live-persona-card.js":[490468,401983],"./it-it/live-persona-editor.js":[771340,277450],"./it-it/lms-integration.js":[null],"./it-it/meet-for-work.js":[700282,580570],"./it-it/meeting-analytics.js":[35350,591068],"./it-it/meeting-apis-app.js":[null],"./it-it/meeting-bot.js":[null],"./it-it/meeting-collaboration.js":[847933,91078],"./it-it/meeting-flyout.js":[295002,401983],"./it-it/meeting-meet-app.js":[971177,401983],"./it-it/meeting-options.js":[864705,756864],"./it-it/meeting-recap.js":[7189,241799],"./it-it/meeting-room-console.js":[null],"./it-it/meeting-stream-app.js":[null],"./it-it/message-escalate-dialog.js":[543291,514354],"./it-it/messaging.js":[210444,401983],"./it-it/mobile-attach.js":[null],"./it-it/mtma-missed-notifications.js":[63072,401983],"./it-it/nova.js":[624921,401983],"./it-it/people-app.js":[null],"./it-it/people-picker.js":[388501,401983],"./it-it/people-targeting.js":[875195,261537],"./it-it/people.js":[634997,401983],"./it-it/person.js":[107507,401983],"./it-it/phonelink-sms.js":[575154,456395],"./it-it/pre-core.js":[null],"./it-it/premium-benefits.js":[885448,735533],"./it-it/presence.js":[795240,401983],"./it-it/queues.js":[776307,481505],"./it-it/recurrence.js":[962813,925312],"./it-it/rsc-application-permissions.js":[null],"./it-it/search.js":[745475,476293],"./it-it/semantic-object.js":[775580,848923],"./it-it/settings.js":[421893,401983],"./it-it/share-in-meetings.js":[null],"./it-it/share-to-teams-outlook-addin.js":[null],"./it-it/share-to-teams-third-party.js":[null],"./it-it/share-to-teams.js":[447229,465844],"./it-it/shortcut.js":[314e3,401983],"./it-it/shortcuts.js":[920467,401983],"./it-it/simple-collab.js":[991537,401983],"./it-it/smart-device.js":[null],"./it-it/survey.js":[838575,64279],"./it-it/sv-flyout.js":[722314,401983],"./it-it/teams-and-channels.js":[218005,481933],"./it-it/teams-insider.js":[548566,401983],"./it-it/telemetry.js":[288338,401983],"./it-it/tfl-homepage.js":[140263,401983],"./it-it/tfl-onboarding.js":[861324,401983],"./it-it/toast-notifications.js":[635257,401983],"./it-it/trusted-ui.js":[null],"./it-it/unified-search.js":[134738,465844],"./it-it/unsupported-browser.js":[null],"./it-it/url-preview.js":[702626,401983],"./it-it/video-capture.js":[381812,927946],"./it-it/video-message.js":[386781,786113],"./it-it/virtual-consumer-events.js":[202944,599972],"./it-it/virtual-events.js":[194212,77677],"./it-it/webinar.js":[770361,911969],"./it-it/welcome-bot.js":[null],"./it-it/whats-new.js":[509732,401983],"./it-it/wiki.js":[null],"./ja-jp/activity.js":[847091,904615],"./ja-jp/artifacts-platform.js":[299522,79131],"./ja-jp/audience-view-dialog.js":[814385,376211],"./ja-jp/auth.js":[645352,904615],"./ja-jp/autosuggest.js":[116152,904615],"./ja-jp/avatar.js":[103314,904615],"./ja-jp/biometric-enrollment.js":[438159,620545],"./ja-jp/breakout-rooms.js":[600172,61532],"./ja-jp/broadcast.js":[936844,407783],"./ja-jp/calendar.js":[886239,822423],"./ja-jp/calling.js":[254014,342337],"./ja-jp/campaign-notifications.js":[853053,904615],"./ja-jp/carousel-multi-card.js":[null],"./ja-jp/cast.js":[660853,904615],"./ja-jp/channels.js":[618273,904615],"./ja-jp/chat-list.js":[111241,904615],"./ja-jp/coach-report.js":[94736,134648],"./ja-jp/comment-stream.js":[500166,716918],"./ja-jp/communities.js":[90288,904615],"./ja-jp/compose.js":[994212,904615],"./ja-jp/contacts.js":[487308,904615],"./ja-jp/datepicker.js":[656517,640221],"./ja-jp/desktop.js":[null],"./ja-jp/digital-signage.js":[null],"./ja-jp/discover-surface.js":[7501,90606],"./ja-jp/edu.js":[261419,813403],"./ja-jp/embed.js":[28332,904615],"./ja-jp/errors.js":[783896,904615],"./ja-jp/esp.js":[943975,6373],"./ja-jp/extensibility-ptz-extension.js":[null],"./ja-jp/extensibility-room-remote.js":[null],"./ja-jp/extensibility.js":[626302,904615],"./ja-jp/feedback.js":[418935,640109],"./ja-jp/files.js":[854450,904615],"./ja-jp/framework.js":[482063,904615],"./ja-jp/freemium-upgrade.js":[null],"./ja-jp/funstuff.js":[238081,964264],"./ja-jp/gallery.js":[964809,733603],"./ja-jp/growth.js":[664960,904615],"./ja-jp/guardians.js":[261537,162036],"./ja-jp/health.js":[57477,827593],"./ja-jp/help.js":[null],"./ja-jp/hololens.js":[622894,342337],"./ja-jp/host-controls.js":[42584,70580],"./ja-jp/jana.js":[523209,737065],"./ja-jp/lightbox.js":[28375,904615],"./ja-jp/live-persona-card.js":[748622,904615],"./ja-jp/live-persona-editor.js":[897620,790467],"./ja-jp/lms-integration.js":[null],"./ja-jp/meet-for-work.js":[490420,977090],"./ja-jp/meeting-analytics.js":[281811,816705],"./ja-jp/meeting-apis-app.js":[null],"./ja-jp/meeting-bot.js":[null],"./ja-jp/meeting-collaboration.js":[431923,356939],"./ja-jp/meeting-flyout.js":[446786,904615],"./ja-jp/meeting-meet-app.js":[968318,904615],"./ja-jp/meeting-options.js":[326721,905421],"./ja-jp/meeting-recap.js":[451079,763417],"./ja-jp/meeting-room-console.js":[null],"./ja-jp/meeting-stream-app.js":[null],"./ja-jp/message-escalate-dialog.js":[363373,152793],"./ja-jp/messaging.js":[674781,904615],"./ja-jp/mobile-attach.js":[null],"./ja-jp/mtma-missed-notifications.js":[453088,904615],"./ja-jp/nova.js":[67394,904615],"./ja-jp/people-app.js":[null],"./ja-jp/people-picker.js":[782286,904615],"./ja-jp/people-targeting.js":[980739,320267],"./ja-jp/people.js":[696078,904615],"./ja-jp/person.js":[189935,904615],"./ja-jp/phonelink-sms.js":[552602,308971],"./ja-jp/pre-core.js":[null],"./ja-jp/premium-benefits.js":[150828,25614],"./ja-jp/presence.js":[484361,904615],"./ja-jp/queues.js":[820644,601046],"./ja-jp/recurrence.js":[854420,337458],"./ja-jp/rsc-application-permissions.js":[null],"./ja-jp/search.js":[216316,640221],"./ja-jp/semantic-object.js":[686134,904289],"./ja-jp/settings.js":[484485,904615],"./ja-jp/share-in-meetings.js":[null],"./ja-jp/share-to-teams-outlook-addin.js":[null],"./ja-jp/share-to-teams-third-party.js":[null],"./ja-jp/share-to-teams.js":[966618,99951],"./ja-jp/shortcut.js":[510648,904615],"./ja-jp/shortcuts.js":[591299,904615],"./ja-jp/simple-collab.js":[796156,904615],"./ja-jp/smart-device.js":[null],"./ja-jp/survey.js":[354003,435110],"./ja-jp/sv-flyout.js":[797615,904615],"./ja-jp/teams-and-channels.js":[353520,323891],"./ja-jp/teams-insider.js":[568189,904615],"./ja-jp/telemetry.js":[232678,904615],"./ja-jp/tfl-homepage.js":[476784,904615],"./ja-jp/tfl-onboarding.js":[650448,904615],"./ja-jp/toast-notifications.js":[962841,904615],"./ja-jp/trusted-ui.js":[null],"./ja-jp/unified-search.js":[555706,99951],"./ja-jp/unsupported-browser.js":[null],"./ja-jp/url-preview.js":[743275,904615],"./ja-jp/video-capture.js":[764734,36540],"./ja-jp/video-message.js":[804636,5820],"./ja-jp/virtual-consumer-events.js":[374597,223578],"./ja-jp/virtual-events.js":[178183,873507],"./ja-jp/webinar.js":[877228,644126],"./ja-jp/welcome-bot.js":[null],"./ja-jp/whats-new.js":[225776,904615],"./ja-jp/wiki.js":[null],"./ka-ge/activity.js":[752615,910562],"./ka-ge/artifacts-platform.js":[694446,577122],"./ka-ge/audience-view-dialog.js":[848978,452425],"./ka-ge/auth.js":[734596,910562],"./ka-ge/autosuggest.js":[698484,910562],"./ka-ge/avatar.js":[854187,910562],"./ka-ge/biometric-enrollment.js":[979622,504411],"./ka-ge/breakout-rooms.js":[701408,44037],"./ka-ge/broadcast.js":[942527,838653],"./ka-ge/calendar.js":[440981,487310],"./ka-ge/calling.js":[377770,153613],"./ka-ge/campaign-notifications.js":[625627,910562],"./ka-ge/carousel-multi-card.js":[null],"./ka-ge/cast.js":[420824,910562],"./ka-ge/channels.js":[504426,910562],"./ka-ge/chat-list.js":[315898,910562],"./ka-ge/coach-report.js":[24171,505213],"./ka-ge/comment-stream.js":[165171,521527],"./ka-ge/communities.js":[733174,910562],"./ka-ge/compose.js":[54162,910562],"./ka-ge/contacts.js":[378342,910562],"./ka-ge/datepicker.js":[609074,318026],"./ka-ge/desktop.js":[null],"./ka-ge/digital-signage.js":[null],"./ka-ge/discover-surface.js":[570987,776281],"./ka-ge/edu.js":[266675,374973],"./ka-ge/embed.js":[161539,910562],"./ka-ge/errors.js":[2264,910562],"./ka-ge/esp.js":[999189,122842],"./ka-ge/extensibility-ptz-extension.js":[null],"./ka-ge/extensibility-room-remote.js":[null],"./ka-ge/extensibility.js":[393009,910562],"./ka-ge/feedback.js":[63403,320084],"./ka-ge/files.js":[503075,910562],"./ka-ge/framework.js":[872417,910562],"./ka-ge/freemium-upgrade.js":[null],"./ka-ge/funstuff.js":[609678,606581],"./ka-ge/gallery.js":[114852,102559],"./ka-ge/growth.js":[464072,910562],"./ka-ge/guardians.js":[18825,584197],"./ka-ge/health.js":[913389,204357],"./ka-ge/help.js":[null],"./ka-ge/hololens.js":[119428,153613],"./ka-ge/host-controls.js":[955145,53432],"./ka-ge/jana.js":[674492,300521],"./ka-ge/lightbox.js":[318997,910562],"./ka-ge/live-persona-card.js":[140020,910562],"./ka-ge/live-persona-editor.js":[27519,206948],"./ka-ge/lms-integration.js":[null],"./ka-ge/meet-for-work.js":[992431,606508],"./ka-ge/meeting-analytics.js":[577252,191504],"./ka-ge/meeting-apis-app.js":[null],"./ka-ge/meeting-bot.js":[null],"./ka-ge/meeting-collaboration.js":[76006,165158],"./ka-ge/meeting-flyout.js":[574546,910562],"./ka-ge/meeting-meet-app.js":[336431,910562],"./ka-ge/meeting-options.js":[34332,428256],"./ka-ge/meeting-recap.js":[515789,841746],"./ka-ge/meeting-room-console.js":[null],"./ka-ge/meeting-stream-app.js":[null],"./ka-ge/message-escalate-dialog.js":[623187,365631],"./ka-ge/messaging.js":[856109,910562],"./ka-ge/mobile-attach.js":[null],"./ka-ge/mtma-missed-notifications.js":[61084,910562],"./ka-ge/nova.js":[981111,910562],"./ka-ge/people-app.js":[null],"./ka-ge/people-picker.js":[513957,910562],"./ka-ge/people-targeting.js":[740518,339435],"./ka-ge/people.js":[858825,910562],"./ka-ge/person.js":[115389,910562],"./ka-ge/phonelink-sms.js":[510825,962701],"./ka-ge/pre-core.js":[null],"./ka-ge/premium-benefits.js":[761367,917016],"./ka-ge/presence.js":[494989,910562],"./ka-ge/queues.js":[456604,795898],"./ka-ge/recurrence.js":[853475,198872],"./ka-ge/rsc-application-permissions.js":[null],"./ka-ge/search.js":[496668,318026],"./ka-ge/semantic-object.js":[207404,23169],"./ka-ge/settings.js":[660377,910562],"./ka-ge/share-in-meetings.js":[null],"./ka-ge/share-to-teams-outlook-addin.js":[null],"./ka-ge/share-to-teams-third-party.js":[null],"./ka-ge/share-to-teams.js":[985756,394259],"./ka-ge/shortcut.js":[724956,910562],"./ka-ge/shortcuts.js":[184832,910562],"./ka-ge/simple-collab.js":[295828,910562],"./ka-ge/smart-device.js":[null],"./ka-ge/survey.js":[203471,227954],"./ka-ge/sv-flyout.js":[974982,910562],"./ka-ge/teams-and-channels.js":[725321,703983],"./ka-ge/teams-insider.js":[340855,910562],"./ka-ge/telemetry.js":[624591,910562],"./ka-ge/tfl-homepage.js":[795277,910562],"./ka-ge/tfl-onboarding.js":[230986,910562],"./ka-ge/toast-notifications.js":[283364,910562],"./ka-ge/trusted-ui.js":[null],"./ka-ge/unified-search.js":[24541,394259],"./ka-ge/unsupported-browser.js":[null],"./ka-ge/url-preview.js":[76306,910562],"./ka-ge/video-capture.js":[265605,784497],"./ka-ge/video-message.js":[660584,941193],"./ka-ge/virtual-consumer-events.js":[784327,543178],"./ka-ge/virtual-events.js":[320949,732420],"./ka-ge/webinar.js":[886662,432719],"./ka-ge/welcome-bot.js":[null],"./ka-ge/whats-new.js":[846172,910562],"./ka-ge/wiki.js":[null],"./kk-kz/activity.js":[953432,378456],"./kk-kz/artifacts-platform.js":[469535,792722],"./kk-kz/audience-view-dialog.js":[695022,796317],"./kk-kz/auth.js":[768607,378456],"./kk-kz/autosuggest.js":[398241,378456],"./kk-kz/avatar.js":[644035,378456],"./kk-kz/biometric-enrollment.js":[608197,68597],"./kk-kz/breakout-rooms.js":[747723,469988],"./kk-kz/broadcast.js":[398711,454270],"./kk-kz/calendar.js":[992264,83772],"./kk-kz/calling.js":[986196,939079],"./kk-kz/campaign-notifications.js":[526318,378456],"./kk-kz/carousel-multi-card.js":[null],"./kk-kz/cast.js":[279850,378456],"./kk-kz/channels.js":[44654,378456],"./kk-kz/chat-list.js":[233306,378456],"./kk-kz/coach-report.js":[262379,695885],"./kk-kz/comment-stream.js":[636151,946918],"./kk-kz/communities.js":[200030,378456],"./kk-kz/compose.js":[816436,378456],"./kk-kz/contacts.js":[183124,378456],"./kk-kz/datepicker.js":[565151,688164],"./kk-kz/desktop.js":[null],"./kk-kz/digital-signage.js":[null],"./kk-kz/discover-surface.js":[960823,374972],"./kk-kz/edu.js":[940059,389442],"./kk-kz/embed.js":[915523,378456],"./kk-kz/errors.js":[37591,378456],"./kk-kz/esp.js":[270787,218418],"./kk-kz/extensibility-ptz-extension.js":[null],"./kk-kz/extensibility-room-remote.js":[null],"./kk-kz/extensibility.js":[724784,378456],"./kk-kz/feedback.js":[422152,948473],"./kk-kz/files.js":[610795,378456],"./kk-kz/framework.js":[636806,378456],"./kk-kz/freemium-upgrade.js":[null],"./kk-kz/funstuff.js":[862722,688865],"./kk-kz/gallery.js":[53175,85421],"./kk-kz/growth.js":[680611,378456],"./kk-kz/guardians.js":[853197,24149],"./kk-kz/health.js":[487258,281227],"./kk-kz/help.js":[null],"./kk-kz/hololens.js":[544318,939079],"./kk-kz/host-controls.js":[331897,693158],"./kk-kz/jana.js":[977176,741607],"./kk-kz/lightbox.js":[780100,378456],"./kk-kz/live-persona-card.js":[560367,378456],"./kk-kz/live-persona-editor.js":[118489,816485],"./kk-kz/lms-integration.js":[null],"./kk-kz/meet-for-work.js":[858274,956357],"./kk-kz/meeting-analytics.js":[405663,197282],"./kk-kz/meeting-apis-app.js":[null],"./kk-kz/meeting-bot.js":[null],"./kk-kz/meeting-collaboration.js":[340648,970167],"./kk-kz/meeting-flyout.js":[248562,378456],"./kk-kz/meeting-meet-app.js":[234028,378456],"./kk-kz/meeting-options.js":[71884,697014],"./kk-kz/meeting-recap.js":[589605,877174],"./kk-kz/meeting-room-console.js":[null],"./kk-kz/meeting-stream-app.js":[null],"./kk-kz/message-escalate-dialog.js":[356492,997203],"./kk-kz/messaging.js":[696721,378456],"./kk-kz/mobile-attach.js":[null],"./kk-kz/mtma-missed-notifications.js":[195755,378456],"./kk-kz/nova.js":[749651,378456],"./kk-kz/people-app.js":[null],"./kk-kz/people-picker.js":[479879,378456],"./kk-kz/people-targeting.js":[303664,153267],"./kk-kz/people.js":[10815,378456],"./kk-kz/person.js":[367454,378456],"./kk-kz/phonelink-sms.js":[914553,860333],"./kk-kz/pre-core.js":[null],"./kk-kz/premium-benefits.js":[471878,66772],"./kk-kz/presence.js":[253444,378456],"./kk-kz/queues.js":[413492,647531],"./kk-kz/recurrence.js":[703317,735568],"./kk-kz/rsc-application-permissions.js":[null],"./kk-kz/search.js":[96959,688164],"./kk-kz/semantic-object.js":[245439,902016],"./kk-kz/settings.js":[687300,378456],"./kk-kz/share-in-meetings.js":[null],"./kk-kz/share-to-teams-outlook-addin.js":[null],"./kk-kz/share-to-teams-third-party.js":[null],"./kk-kz/share-to-teams.js":[937697,953228],"./kk-kz/shortcut.js":[135068,378456],"./kk-kz/shortcuts.js":[745906,378456],"./kk-kz/simple-collab.js":[569028,378456],"./kk-kz/smart-device.js":[null],"./kk-kz/survey.js":[280171,89043],"./kk-kz/sv-flyout.js":[708345,378456],"./kk-kz/teams-and-channels.js":[700601,905462],"./kk-kz/teams-insider.js":[180866,378456],"./kk-kz/telemetry.js":[704241,378456],"./kk-kz/tfl-homepage.js":[934205,378456],"./kk-kz/tfl-onboarding.js":[302961,378456],"./kk-kz/toast-notifications.js":[9906,378456],"./kk-kz/trusted-ui.js":[null],"./kk-kz/unified-search.js":[254145,953228],"./kk-kz/unsupported-browser.js":[null],"./kk-kz/url-preview.js":[945944,378456],"./kk-kz/video-capture.js":[395765,150103],"./kk-kz/video-message.js":[570918,742477],"./kk-kz/virtual-consumer-events.js":[577976,573214],"./kk-kz/virtual-events.js":[316610,316290],"./kk-kz/webinar.js":[430398,355192],"./kk-kz/welcome-bot.js":[null],"./kk-kz/whats-new.js":[820284,378456],"./kk-kz/wiki.js":[null],"./ko-kr/activity.js":[290002,867526],"./ko-kr/artifacts-platform.js":[472845,168957],"./ko-kr/audience-view-dialog.js":[837275,860863],"./ko-kr/auth.js":[209236,867526],"./ko-kr/autosuggest.js":[739303,867526],"./ko-kr/avatar.js":[142220,867526],"./ko-kr/biometric-enrollment.js":[172785,931811],"./ko-kr/breakout-rooms.js":[339255,830167],"./ko-kr/broadcast.js":[799877,205400],"./ko-kr/calendar.js":[918398,111943],"./ko-kr/calling.js":[613762,474515],"./ko-kr/campaign-notifications.js":[339028,867526],"./ko-kr/carousel-multi-card.js":[null],"./ko-kr/cast.js":[799895,867526],"./ko-kr/channels.js":[611674,867526],"./ko-kr/chat-list.js":[997333,867526],"./ko-kr/coach-report.js":[176738,876504],"./ko-kr/comment-stream.js":[975464,252421],"./ko-kr/communities.js":[40636,867526],"./ko-kr/compose.js":[533207,867526],"./ko-kr/contacts.js":[776464,867526],"./ko-kr/datepicker.js":[951748,107523],"./ko-kr/desktop.js":[null],"./ko-kr/digital-signage.js":[null],"./ko-kr/discover-surface.js":[371541,538001],"./ko-kr/edu.js":[546534,687045],"./ko-kr/embed.js":[220465,867526],"./ko-kr/errors.js":[227760,867526],"./ko-kr/esp.js":[473811,194658],"./ko-kr/extensibility-ptz-extension.js":[null],"./ko-kr/extensibility-room-remote.js":[null],"./ko-kr/extensibility.js":[893292,867526],"./ko-kr/feedback.js":[972639,558947],"./ko-kr/files.js":[829761,867526],"./ko-kr/framework.js":[539406,867526],"./ko-kr/freemium-upgrade.js":[null],"./ko-kr/funstuff.js":[287325,543492],"./ko-kr/gallery.js":[673912,554223],"./ko-kr/growth.js":[428354,867526],"./ko-kr/guardians.js":[576846,165025],"./ko-kr/health.js":[987158,396435],"./ko-kr/help.js":[null],"./ko-kr/hololens.js":[863448,474515],"./ko-kr/host-controls.js":[902486,559289],"./ko-kr/jana.js":[643957,568384],"./ko-kr/lightbox.js":[129202,867526],"./ko-kr/live-persona-card.js":[38663,867526],"./ko-kr/live-persona-editor.js":[212964,777208],"./ko-kr/lms-integration.js":[null],"./ko-kr/meet-for-work.js":[448434,715657],"./ko-kr/meeting-analytics.js":[963234,167960],"./ko-kr/meeting-apis-app.js":[null],"./ko-kr/meeting-bot.js":[null],"./ko-kr/meeting-collaboration.js":[188827,11189],"./ko-kr/meeting-flyout.js":[45488,867526],"./ko-kr/meeting-meet-app.js":[939531,867526],"./ko-kr/meeting-options.js":[92316,150480],"./ko-kr/meeting-recap.js":[193383,943950],"./ko-kr/meeting-room-console.js":[null],"./ko-kr/meeting-stream-app.js":[null],"./ko-kr/message-escalate-dialog.js":[278019,547296],"./ko-kr/messaging.js":[688132,867526],"./ko-kr/mobile-attach.js":[null],"./ko-kr/mtma-missed-notifications.js":[66204,867526],"./ko-kr/nova.js":[16357,867526],"./ko-kr/people-app.js":[null],"./ko-kr/people-picker.js":[275250,867526],"./ko-kr/people-targeting.js":[390319,502376],"./ko-kr/people.js":[503887,867526],"./ko-kr/person.js":[895336,867526],"./ko-kr/phonelink-sms.js":[152843,321542],"./ko-kr/pre-core.js":[null],"./ko-kr/premium-benefits.js":[821854,153720],"./ko-kr/presence.js":[594781,867526],"./ko-kr/queues.js":[541947,781074],"./ko-kr/recurrence.js":[252254,319856],"./ko-kr/rsc-application-permissions.js":[null],"./ko-kr/search.js":[987897,107523],"./ko-kr/semantic-object.js":[538807,588531],"./ko-kr/settings.js":[547476,867526],"./ko-kr/share-in-meetings.js":[null],"./ko-kr/share-to-teams-outlook-addin.js":[null],"./ko-kr/share-to-teams-third-party.js":[null],"./ko-kr/share-to-teams.js":[419049,755206],"./ko-kr/shortcut.js":[343511,867526],"./ko-kr/shortcuts.js":[444765,867526],"./ko-kr/simple-collab.js":[138721,867526],"./ko-kr/smart-device.js":[null],"./ko-kr/survey.js":[340334,500772],"./ko-kr/sv-flyout.js":[104407,867526],"./ko-kr/teams-and-channels.js":[579635,662763],"./ko-kr/teams-insider.js":[253558,867526],"./ko-kr/telemetry.js":[329122,867526],"./ko-kr/tfl-homepage.js":[367033,867526],"./ko-kr/tfl-onboarding.js":[114433,867526],"./ko-kr/toast-notifications.js":[597969,867526],"./ko-kr/trusted-ui.js":[null],"./ko-kr/unified-search.js":[160176,755206],"./ko-kr/unsupported-browser.js":[null],"./ko-kr/url-preview.js":[806062,867526],"./ko-kr/video-capture.js":[6559,281093],"./ko-kr/video-message.js":[254545,311369],"./ko-kr/virtual-consumer-events.js":[93571,210867],"./ko-kr/virtual-events.js":[902043,478778],"./ko-kr/webinar.js":[452066,267949],"./ko-kr/welcome-bot.js":[null],"./ko-kr/whats-new.js":[212236,867526],"./ko-kr/wiki.js":[null],"./lt-lt/activity.js":[828117,381205],"./lt-lt/artifacts-platform.js":[251259,747049],"./lt-lt/audience-view-dialog.js":[808633,806023],"./lt-lt/auth.js":[885397,381205],"./lt-lt/autosuggest.js":[863435,381205],"./lt-lt/avatar.js":[560712,381205],"./lt-lt/biometric-enrollment.js":[419061,974471],"./lt-lt/breakout-rooms.js":[508157,763991],"./lt-lt/broadcast.js":[382227,919534],"./lt-lt/calendar.js":[759586,564878],"./lt-lt/calling.js":[208768,653247],"./lt-lt/campaign-notifications.js":[596729,381205],"./lt-lt/carousel-multi-card.js":[null],"./lt-lt/cast.js":[894308,381205],"./lt-lt/channels.js":[323301,381205],"./lt-lt/chat-list.js":[144462,381205],"./lt-lt/coach-report.js":[22178,900819],"./lt-lt/comment-stream.js":[322893,596094],"./lt-lt/communities.js":[254554,381205],"./lt-lt/compose.js":[941041,381205],"./lt-lt/contacts.js":[491921,381205],"./lt-lt/datepicker.js":[726576,9014],"./lt-lt/desktop.js":[null],"./lt-lt/digital-signage.js":[null],"./lt-lt/discover-surface.js":[181540,805588],"./lt-lt/edu.js":[381101,37063],"./lt-lt/embed.js":[59817,381205],"./lt-lt/errors.js":[451749,381205],"./lt-lt/esp.js":[183465,733488],"./lt-lt/extensibility-ptz-extension.js":[null],"./lt-lt/extensibility-room-remote.js":[null],"./lt-lt/extensibility.js":[18564,381205],"./lt-lt/feedback.js":[699472,224441],"./lt-lt/files.js":[841429,381205],"./lt-lt/framework.js":[996939,381205],"./lt-lt/freemium-upgrade.js":[null],"./lt-lt/funstuff.js":[30081,808014],"./lt-lt/gallery.js":[676475,693467],"./lt-lt/growth.js":[803185,381205],"./lt-lt/guardians.js":[533745,599710],"./lt-lt/health.js":[902350,157998],"./lt-lt/help.js":[null],"./lt-lt/hololens.js":[239435,653247],"./lt-lt/host-controls.js":[914248,808722],"./lt-lt/jana.js":[66590,562689],"./lt-lt/lightbox.js":[416221,381205],"./lt-lt/live-persona-card.js":[589988,381205],"./lt-lt/live-persona-editor.js":[498113,243857],"./lt-lt/lms-integration.js":[null],"./lt-lt/meet-for-work.js":[26458,861472],"./lt-lt/meeting-analytics.js":[750474,758670],"./lt-lt/meeting-apis-app.js":[null],"./lt-lt/meeting-bot.js":[null],"./lt-lt/meeting-collaboration.js":[879192,818787],"./lt-lt/meeting-flyout.js":[266175,381205],"./lt-lt/meeting-meet-app.js":[654062,381205],"./lt-lt/meeting-options.js":[85676,308735],"./lt-lt/meeting-recap.js":[930534,94954],"./lt-lt/meeting-room-console.js":[null],"./lt-lt/meeting-stream-app.js":[null],"./lt-lt/message-escalate-dialog.js":[570730,717795],"./lt-lt/messaging.js":[807707,381205],"./lt-lt/mobile-attach.js":[null],"./lt-lt/mtma-missed-notifications.js":[407721,381205],"./lt-lt/nova.js":[218133,381205],"./lt-lt/people-app.js":[null],"./lt-lt/people-picker.js":[135602,381205],"./lt-lt/people-targeting.js":[561677,529401],"./lt-lt/people.js":[888631,381205],"./lt-lt/person.js":[253849,381205],"./lt-lt/phonelink-sms.js":[317444,577731],"./lt-lt/pre-core.js":[null],"./lt-lt/premium-benefits.js":[490520,361774],"./lt-lt/presence.js":[432571,381205],"./lt-lt/queues.js":[708840,743061],"./lt-lt/recurrence.js":[18321,735551],"./lt-lt/rsc-application-permissions.js":[null],"./lt-lt/search.js":[631250,9014],"./lt-lt/semantic-object.js":[700448,943505],"./lt-lt/settings.js":[185138,381205],"./lt-lt/share-in-meetings.js":[null],"./lt-lt/share-to-teams-outlook-addin.js":[null],"./lt-lt/share-to-teams-third-party.js":[null],"./lt-lt/share-to-teams.js":[624078,514727],"./lt-lt/shortcut.js":[628153,381205],"./lt-lt/shortcuts.js":[354417,381205],"./lt-lt/simple-collab.js":[845563,381205],"./lt-lt/smart-device.js":[null],"./lt-lt/survey.js":[489045,915522],"./lt-lt/sv-flyout.js":[848575,381205],"./lt-lt/teams-and-channels.js":[747538,492444],"./lt-lt/teams-insider.js":[551721,381205],"./lt-lt/telemetry.js":[408594,381205],"./lt-lt/tfl-homepage.js":[555814,381205],"./lt-lt/tfl-onboarding.js":[93325,381205],"./lt-lt/toast-notifications.js":[371882,381205],"./lt-lt/trusted-ui.js":[null],"./lt-lt/unified-search.js":[381320,514727],"./lt-lt/unsupported-browser.js":[null],"./lt-lt/url-preview.js":[833398,381205],"./lt-lt/video-capture.js":[216140,670103],"./lt-lt/video-message.js":[434840,262860],"./lt-lt/virtual-consumer-events.js":[310888,135734],"./lt-lt/virtual-events.js":[778658,177330],"./lt-lt/webinar.js":[914362,138693],"./lt-lt/welcome-bot.js":[null],"./lt-lt/whats-new.js":[656956,381205],"./lt-lt/wiki.js":[null],"./lv-lv/activity.js":[810778,700926],"./lv-lv/artifacts-platform.js":[406515,579984],"./lv-lv/audience-view-dialog.js":[980082,262851],"./lv-lv/auth.js":[155042,700926],"./lv-lv/autosuggest.js":[602273,700926],"./lv-lv/avatar.js":[890133,700926],"./lv-lv/biometric-enrollment.js":[995924,834869],"./lv-lv/breakout-rooms.js":[508130,540253],"./lv-lv/broadcast.js":[733048,57610],"./lv-lv/calendar.js":[28132,709372],"./lv-lv/calling.js":[93116,817542],"./lv-lv/campaign-notifications.js":[151235,700926],"./lv-lv/carousel-multi-card.js":[null],"./lv-lv/cast.js":[933752,700926],"./lv-lv/channels.js":[444587,700926],"./lv-lv/chat-list.js":[31725,700926],"./lv-lv/coach-report.js":[218590,693594],"./lv-lv/comment-stream.js":[365803,10641],"./lv-lv/communities.js":[445226,700926],"./lv-lv/compose.js":[842524,700926],"./lv-lv/contacts.js":[594108,700926],"./lv-lv/datepicker.js":[99505,558444],"./lv-lv/desktop.js":[null],"./lv-lv/digital-signage.js":[null],"./lv-lv/discover-surface.js":[398832,727202],"./lv-lv/edu.js":[692181,675210],"./lv-lv/embed.js":[74,700926],"./lv-lv/errors.js":[122524,700926],"./lv-lv/esp.js":[913396,846697],"./lv-lv/extensibility-ptz-extension.js":[null],"./lv-lv/extensibility-room-remote.js":[null],"./lv-lv/extensibility.js":[715985,700926],"./lv-lv/feedback.js":[377071,606969],"./lv-lv/files.js":[939108,700926],"./lv-lv/framework.js":[991326,700926],"./lv-lv/freemium-upgrade.js":[null],"./lv-lv/funstuff.js":[669100,961266],"./lv-lv/gallery.js":[122904,500987],"./lv-lv/growth.js":[463905,700926],"./lv-lv/guardians.js":[573703,511908],"./lv-lv/health.js":[704045,96601],"./lv-lv/help.js":[null],"./lv-lv/hololens.js":[837548,817542],"./lv-lv/host-controls.js":[810269,831202],"./lv-lv/jana.js":[806900,743243],"./lv-lv/lightbox.js":[272099,700926],"./lv-lv/live-persona-card.js":[462857,700926],"./lv-lv/live-persona-editor.js":[60117,414013],"./lv-lv/lms-integration.js":[null],"./lv-lv/meet-for-work.js":[797649,89798],"./lv-lv/meeting-analytics.js":[664849,268312],"./lv-lv/meeting-apis-app.js":[null],"./lv-lv/meeting-bot.js":[null],"./lv-lv/meeting-collaboration.js":[499614,762993],"./lv-lv/meeting-flyout.js":[548682,700926],"./lv-lv/meeting-meet-app.js":[937090,700926],"./lv-lv/meeting-options.js":[688730,367977],"./lv-lv/meeting-recap.js":[375729,490842],"./lv-lv/meeting-room-console.js":[null],"./lv-lv/meeting-stream-app.js":[null],"./lv-lv/message-escalate-dialog.js":[828616,661701],"./lv-lv/messaging.js":[647054,700926],"./lv-lv/mobile-attach.js":[null],"./lv-lv/mtma-missed-notifications.js":[693302,700926],"./lv-lv/nova.js":[821981,700926],"./lv-lv/people-app.js":[null],"./lv-lv/people-picker.js":[622496,700926],"./lv-lv/people-targeting.js":[394882,873523],"./lv-lv/people.js":[620533,700926],"./lv-lv/person.js":[540410,700926],"./lv-lv/phonelink-sms.js":[373965,546569],"./lv-lv/pre-core.js":[null],"./lv-lv/premium-benefits.js":[54597,683015],"./lv-lv/presence.js":[911375,700926],"./lv-lv/queues.js":[798857,281237],"./lv-lv/recurrence.js":[841922,648683],"./lv-lv/rsc-application-permissions.js":[null],"./lv-lv/search.js":[69441,558444],"./lv-lv/semantic-object.js":[741570,688901],"./lv-lv/settings.js":[413551,700926],"./lv-lv/share-in-meetings.js":[null],"./lv-lv/share-to-teams-outlook-addin.js":[null],"./lv-lv/share-to-teams-third-party.js":[null],"./lv-lv/share-to-teams.js":[229842,251317],"./lv-lv/shortcut.js":[734538,700926],"./lv-lv/shortcuts.js":[345307,700926],"./lv-lv/simple-collab.js":[189522,700926],"./lv-lv/smart-device.js":[null],"./lv-lv/survey.js":[290285,847282],"./lv-lv/sv-flyout.js":[611120,700926],"./lv-lv/teams-and-channels.js":[951495,708174],"./lv-lv/teams-insider.js":[444901,700926],"./lv-lv/telemetry.js":[903190,700926],"./lv-lv/tfl-homepage.js":[774015,700926],"./lv-lv/tfl-onboarding.js":[447320,700926],"./lv-lv/toast-notifications.js":[695182,700926],"./lv-lv/trusted-ui.js":[null],"./lv-lv/unified-search.js":[213720,251317],"./lv-lv/unsupported-browser.js":[null],"./lv-lv/url-preview.js":[871092,700926],"./lv-lv/video-capture.js":[529535,238957],"./lv-lv/video-message.js":[701829,103568],"./lv-lv/virtual-consumer-events.js":[302983,348340],"./lv-lv/virtual-events.js":[165149,416682],"./lv-lv/webinar.js":[622197,134255],"./lv-lv/welcome-bot.js":[null],"./lv-lv/whats-new.js":[64360,700926],"./lv-lv/wiki.js":[null],"./mk-mk/activity.js":[909191,638437],"./mk-mk/artifacts-platform.js":[494084,130092],"./mk-mk/audience-view-dialog.js":[220869,952157],"./mk-mk/auth.js":[389416,638437],"./mk-mk/autosuggest.js":[133534,638437],"./mk-mk/avatar.js":[317522,638437],"./mk-mk/biometric-enrollment.js":[329561,960100],"./mk-mk/breakout-rooms.js":[941650,267299],"./mk-mk/broadcast.js":[602441,42119],"./mk-mk/calendar.js":[437019,921978],"./mk-mk/calling.js":[720616,600057],"./mk-mk/campaign-notifications.js":[248648,638437],"./mk-mk/carousel-multi-card.js":[null],"./mk-mk/cast.js":[245263,638437],"./mk-mk/channels.js":[361645,638437],"./mk-mk/chat-list.js":[248254,638437],"./mk-mk/coach-report.js":[68753,898701],"./mk-mk/comment-stream.js":[75135,425574],"./mk-mk/communities.js":[155242,638437],"./mk-mk/compose.js":[637823,638437],"./mk-mk/contacts.js":[827809,638437],"./mk-mk/datepicker.js":[673538,673],"./mk-mk/desktop.js":[null],"./mk-mk/digital-signage.js":[null],"./mk-mk/discover-surface.js":[36796,138008],"./mk-mk/edu.js":[180414,230016],"./mk-mk/embed.js":[361096,638437],"./mk-mk/errors.js":[560254,638437],"./mk-mk/esp.js":[127773,270602],"./mk-mk/extensibility-ptz-extension.js":[null],"./mk-mk/extensibility-room-remote.js":[null],"./mk-mk/extensibility.js":[21305,638437],"./mk-mk/feedback.js":[285960,334080],"./mk-mk/files.js":[108999,638437],"./mk-mk/framework.js":[463391,638437],"./mk-mk/freemium-upgrade.js":[null],"./mk-mk/funstuff.js":[972483,376106],"./mk-mk/gallery.js":[635976,121786],"./mk-mk/growth.js":[224439,638437],"./mk-mk/guardians.js":[559779,553277],"./mk-mk/health.js":[429712,495447],"./mk-mk/help.js":[null],"./mk-mk/hololens.js":[723614,600057],"./mk-mk/host-controls.js":[15311,764958],"./mk-mk/jana.js":[692686,926220],"./mk-mk/lightbox.js":[280982,638437],"./mk-mk/live-persona-card.js":[889510,638437],"./mk-mk/live-persona-editor.js":[430161,487239],"./mk-mk/lms-integration.js":[null],"./mk-mk/meet-for-work.js":[724988,677093],"./mk-mk/meeting-analytics.js":[895901,37689],"./mk-mk/meeting-apis-app.js":[null],"./mk-mk/meeting-bot.js":[null],"./mk-mk/meeting-collaboration.js":[926230,108224],"./mk-mk/meeting-flyout.js":[800708,638437],"./mk-mk/meeting-meet-app.js":[691758,638437],"./mk-mk/meeting-options.js":[769873,378334],"./mk-mk/meeting-recap.js":[624722,647812],"./mk-mk/meeting-room-console.js":[null],"./mk-mk/meeting-stream-app.js":[null],"./mk-mk/message-escalate-dialog.js":[905584,997494],"./mk-mk/messaging.js":[742921,638437],"./mk-mk/mobile-attach.js":[null],"./mk-mk/mtma-missed-notifications.js":[920516,638437],"./mk-mk/nova.js":[604625,638437],"./mk-mk/people-app.js":[null],"./mk-mk/people-picker.js":[500598,638437],"./mk-mk/people-targeting.js":[170001,852683],"./mk-mk/people.js":[405451,638437],"./mk-mk/person.js":[293055,638437],"./mk-mk/phonelink-sms.js":[116953,655259],"./mk-mk/pre-core.js":[null],"./mk-mk/premium-benefits.js":[859378,180958],"./mk-mk/presence.js":[14184,638437],"./mk-mk/queues.js":[280934,695366],"./mk-mk/recurrence.js":[757355,681102],"./mk-mk/rsc-application-permissions.js":[null],"./mk-mk/search.js":[431751,673],"./mk-mk/semantic-object.js":[264360,821083],"./mk-mk/settings.js":[513110,638437],"./mk-mk/share-in-meetings.js":[null],"./mk-mk/share-to-teams-outlook-addin.js":[null],"./mk-mk/share-to-teams-third-party.js":[null],"./mk-mk/share-to-teams.js":[298113,829122],"./mk-mk/shortcut.js":[912659,638437],"./mk-mk/shortcuts.js":[88887,638437],"./mk-mk/simple-collab.js":[850482,638437],"./mk-mk/smart-device.js":[null],"./mk-mk/survey.js":[705062,539308],"./mk-mk/sv-flyout.js":[111454,638437],"./mk-mk/teams-and-channels.js":[648120,69177],"./mk-mk/teams-insider.js":[393690,638437],"./mk-mk/telemetry.js":[427155,638437],"./mk-mk/tfl-homepage.js":[460690,638437],"./mk-mk/tfl-onboarding.js":[758879,638437],"./mk-mk/toast-notifications.js":[605459,638437],"./mk-mk/trusted-ui.js":[null],"./mk-mk/unified-search.js":[511422,829122],"./mk-mk/unsupported-browser.js":[null],"./mk-mk/url-preview.js":[77556,638437],"./mk-mk/video-capture.js":[801625,732241],"./mk-mk/video-message.js":[612707,859019],"./mk-mk/virtual-consumer-events.js":[865393,979815],"./mk-mk/virtual-events.js":[170265,105880],"./mk-mk/webinar.js":[682103,787329],"./mk-mk/welcome-bot.js":[null],"./mk-mk/whats-new.js":[379758,638437],"./mk-mk/wiki.js":[null],"./nb-no/activity.js":[435653,4128],"./nb-no/artifacts-platform.js":[761314,712252],"./nb-no/audience-view-dialog.js":[975144,524364],"./nb-no/auth.js":[924385,4128],"./nb-no/autosuggest.js":[88420,4128],"./nb-no/avatar.js":[597638,4128],"./nb-no/biometric-enrollment.js":[757379,897704],"./nb-no/breakout-rooms.js":[946421,829916],"./nb-no/broadcast.js":[859035,422312],"./nb-no/calendar.js":[22512,463054],"./nb-no/calling.js":[789290,144145],"./nb-no/campaign-notifications.js":[8200,4128],"./nb-no/carousel-multi-card.js":[null],"./nb-no/cast.js":[57023,4128],"./nb-no/channels.js":[699907,4128],"./nb-no/chat-list.js":[157447,4128],"./nb-no/coach-report.js":[926014,715442],"./nb-no/comment-stream.js":[341041,490070],"./nb-no/communities.js":[645119,4128],"./nb-no/compose.js":[506129,4128],"./nb-no/contacts.js":[937622,4128],"./nb-no/datepicker.js":[271741,938699],"./nb-no/desktop.js":[null],"./nb-no/digital-signage.js":[null],"./nb-no/discover-surface.js":[239239,381974],"./nb-no/edu.js":[927034,122924],"./nb-no/embed.js":[614720,4128],"./nb-no/errors.js":[759531,4128],"./nb-no/esp.js":[565991,132897],"./nb-no/extensibility-ptz-extension.js":[null],"./nb-no/extensibility-room-remote.js":[null],"./nb-no/extensibility.js":[343131,4128],"./nb-no/feedback.js":[538539,103202],"./nb-no/files.js":[254800,4128],"./nb-no/framework.js":[466244,4128],"./nb-no/freemium-upgrade.js":[null],"./nb-no/funstuff.js":[389772,446150],"./nb-no/gallery.js":[550744,777067],"./nb-no/growth.js":[158986,4128],"./nb-no/guardians.js":[211555,896793],"./nb-no/health.js":[785629,620295],"./nb-no/help.js":[null],"./nb-no/hololens.js":[112147,144145],"./nb-no/host-controls.js":[214797,90751],"./nb-no/jana.js":[666613,696287],"./nb-no/lightbox.js":[676756,4128],"./nb-no/live-persona-card.js":[39571,4128],"./nb-no/live-persona-editor.js":[955620,346978],"./nb-no/lms-integration.js":[null],"./nb-no/meet-for-work.js":[451111,605543],"./nb-no/meeting-analytics.js":[757084,621993],"./nb-no/meeting-apis-app.js":[null],"./nb-no/meeting-bot.js":[null],"./nb-no/meeting-collaboration.js":[160405,635329],"./nb-no/meeting-flyout.js":[140228,4128],"./nb-no/meeting-meet-app.js":[206547,4128],"./nb-no/meeting-options.js":[950514,933346],"./nb-no/meeting-recap.js":[822755,984982],"./nb-no/meeting-room-console.js":[null],"./nb-no/meeting-stream-app.js":[null],"./nb-no/message-escalate-dialog.js":[220621,341687],"./nb-no/messaging.js":[762883,4128],"./nb-no/mobile-attach.js":[null],"./nb-no/mtma-missed-notifications.js":[859489,4128],"./nb-no/nova.js":[660938,4128],"./nb-no/people-app.js":[null],"./nb-no/people-picker.js":[64498,4128],"./nb-no/people-targeting.js":[308676,534279],"./nb-no/people.js":[950932,4128],"./nb-no/person.js":[887542,4128],"./nb-no/phonelink-sms.js":[518350,633424],"./nb-no/pre-core.js":[null],"./nb-no/premium-benefits.js":[892795,997097],"./nb-no/presence.js":[431821,4128],"./nb-no/queues.js":[434571,599581],"./nb-no/recurrence.js":[993668,973142],"./nb-no/rsc-application-permissions.js":[null],"./nb-no/search.js":[91168,938699],"./nb-no/semantic-object.js":[625061,220573],"./nb-no/settings.js":[202856,4128],"./nb-no/share-in-meetings.js":[null],"./nb-no/share-to-teams-outlook-addin.js":[null],"./nb-no/share-to-teams-third-party.js":[null],"./nb-no/share-to-teams.js":[203257,597548],"./nb-no/shortcut.js":[664449,4128],"./nb-no/shortcuts.js":[367953,4128],"./nb-no/simple-collab.js":[46633,4128],"./nb-no/smart-device.js":[null],"./nb-no/survey.js":[742775,626332],"./nb-no/sv-flyout.js":[13086,4128],"./nb-no/teams-and-channels.js":[120451,399617],"./nb-no/teams-insider.js":[53395,4128],"./nb-no/telemetry.js":[319228,4128],"./nb-no/tfl-homepage.js":[759445,4128],"./nb-no/tfl-onboarding.js":[995532,4128],"./nb-no/toast-notifications.js":[894802,4128],"./nb-no/trusted-ui.js":[null],"./nb-no/unified-search.js":[844892,597548],"./nb-no/unsupported-browser.js":[null],"./nb-no/url-preview.js":[73737,4128],"./nb-no/video-capture.js":[76751,638002],"./nb-no/video-message.js":[393337,917692],"./nb-no/virtual-consumer-events.js":[387283,299773],"./nb-no/virtual-events.js":[472281,570152],"./nb-no/webinar.js":[333161,448226],"./nb-no/welcome-bot.js":[null],"./nb-no/whats-new.js":[263126,4128],"./nb-no/wiki.js":[null],"./nl-nl/activity.js":[809043,834652],"./nl-nl/artifacts-platform.js":[301038,848506],"./nl-nl/audience-view-dialog.js":[909057,119050],"./nl-nl/auth.js":[135286,834652],"./nl-nl/autosuggest.js":[792757,834652],"./nl-nl/avatar.js":[84998,834652],"./nl-nl/biometric-enrollment.js":[912494,174801],"./nl-nl/breakout-rooms.js":[390829,679230],"./nl-nl/broadcast.js":[379404,420158],"./nl-nl/calendar.js":[505173,936406],"./nl-nl/calling.js":[624511,482098],"./nl-nl/campaign-notifications.js":[792090,834652],"./nl-nl/carousel-multi-card.js":[null],"./nl-nl/cast.js":[136668,834652],"./nl-nl/channels.js":[116294,834652],"./nl-nl/chat-list.js":[781037,834652],"./nl-nl/coach-report.js":[151299,190625],"./nl-nl/comment-stream.js":[393063,931493],"./nl-nl/communities.js":[191120,834652],"./nl-nl/compose.js":[588338,834652],"./nl-nl/contacts.js":[796181,834652],"./nl-nl/datepicker.js":[197339,439036],"./nl-nl/desktop.js":[null],"./nl-nl/digital-signage.js":[null],"./nl-nl/discover-surface.js":[308421,365745],"./nl-nl/edu.js":[426291,958392],"./nl-nl/embed.js":[319853,834652],"./nl-nl/errors.js":[844726,834652],"./nl-nl/esp.js":[781514,501924],"./nl-nl/extensibility-ptz-extension.js":[null],"./nl-nl/extensibility-room-remote.js":[null],"./nl-nl/extensibility.js":[270966,834652],"./nl-nl/feedback.js":[151046,950703],"./nl-nl/files.js":[891205,834652],"./nl-nl/framework.js":[957889,834652],"./nl-nl/freemium-upgrade.js":[null],"./nl-nl/funstuff.js":[606518,416184],"./nl-nl/gallery.js":[267378,8118],"./nl-nl/growth.js":[236166,834652],"./nl-nl/guardians.js":[773846,306929],"./nl-nl/health.js":[189930,575238],"./nl-nl/help.js":[null],"./nl-nl/hololens.js":[842646,482098],"./nl-nl/host-controls.js":[175929,836865],"./nl-nl/jana.js":[382824,456591],"./nl-nl/lightbox.js":[517741,834652],"./nl-nl/live-persona-card.js":[599794,834652],"./nl-nl/live-persona-editor.js":[277063,541666],"./nl-nl/lms-integration.js":[null],"./nl-nl/meet-for-work.js":[370301,68057],"./nl-nl/meeting-analytics.js":[296833,7850],"./nl-nl/meeting-apis-app.js":[null],"./nl-nl/meeting-bot.js":[null],"./nl-nl/meeting-collaboration.js":[779728,934188],"./nl-nl/meeting-flyout.js":[369413,834652],"./nl-nl/meeting-meet-app.js":[900710,834652],"./nl-nl/meeting-options.js":[271238,506063],"./nl-nl/meeting-recap.js":[121922,297125],"./nl-nl/meeting-room-console.js":[null],"./nl-nl/meeting-stream-app.js":[null],"./nl-nl/message-escalate-dialog.js":[531489,857330],"./nl-nl/messaging.js":[695026,834652],"./nl-nl/mobile-attach.js":[null],"./nl-nl/mtma-missed-notifications.js":[594913,834652],"./nl-nl/nova.js":[406376,834652],"./nl-nl/people-app.js":[null],"./nl-nl/people-picker.js":[597558,834652],"./nl-nl/people-targeting.js":[382970,32085],"./nl-nl/people.js":[496304,834652],"./nl-nl/person.js":[340233,834652],"./nl-nl/phonelink-sms.js":[16604,968304],"./nl-nl/pre-core.js":[null],"./nl-nl/premium-benefits.js":[92819,448819],"./nl-nl/presence.js":[721453,834652],"./nl-nl/queues.js":[107322,996866],"./nl-nl/recurrence.js":[729195,415999],"./nl-nl/rsc-application-permissions.js":[null],"./nl-nl/search.js":[246018,439036],"./nl-nl/semantic-object.js":[258087,645702],"./nl-nl/settings.js":[890448,834652],"./nl-nl/share-in-meetings.js":[null],"./nl-nl/share-to-teams-outlook-addin.js":[null],"./nl-nl/share-to-teams-third-party.js":[null],"./nl-nl/share-to-teams.js":[31033,654569],"./nl-nl/shortcut.js":[703714,834652],"./nl-nl/shortcuts.js":[641280,834652],"./nl-nl/simple-collab.js":[857030,834652],"./nl-nl/smart-device.js":[null],"./nl-nl/survey.js":[997613,573051],"./nl-nl/sv-flyout.js":[449991,834652],"./nl-nl/teams-and-channels.js":[747540,995052],"./nl-nl/teams-insider.js":[822570,834652],"./nl-nl/telemetry.js":[890211,834652],"./nl-nl/tfl-homepage.js":[350194,834652],"./nl-nl/tfl-onboarding.js":[47647,834652],"./nl-nl/toast-notifications.js":[542942,834652],"./nl-nl/trusted-ui.js":[null],"./nl-nl/unified-search.js":[871460,654569],"./nl-nl/unsupported-browser.js":[null],"./nl-nl/url-preview.js":[667828,834652],"./nl-nl/video-capture.js":[356066,218893],"./nl-nl/video-message.js":[936528,660148],"./nl-nl/virtual-consumer-events.js":[118869,52400],"./nl-nl/virtual-events.js":[300498,766793],"./nl-nl/webinar.js":[374272,120397],"./nl-nl/welcome-bot.js":[null],"./nl-nl/whats-new.js":[76880,834652],"./nl-nl/wiki.js":[null],"./nn-no/activity.js":[904742,523190],"./nn-no/artifacts-platform.js":[428297,766186],"./nn-no/audience-view-dialog.js":[213665,335346],"./nn-no/auth.js":[372211,523190],"./nn-no/autosuggest.js":[380266,523190],"./nn-no/avatar.js":[895426,523190],"./nn-no/biometric-enrollment.js":[811554,249241],"./nn-no/breakout-rooms.js":[921195,961057],"./nn-no/broadcast.js":[110069,414712],"./nn-no/calendar.js":[599780,691138],"./nn-no/calling.js":[56636,979355],"./nn-no/campaign-notifications.js":[712134,523190],"./nn-no/carousel-multi-card.js":[null],"./nn-no/cast.js":[216462,523190],"./nn-no/channels.js":[214962,523190],"./nn-no/chat-list.js":[898327,523190],"./nn-no/coach-report.js":[882739,189980],"./nn-no/comment-stream.js":[516640,991242],"./nn-no/communities.js":[158360,523190],"./nn-no/compose.js":[11995,523190],"./nn-no/contacts.js":[212335,523190],"./nn-no/datepicker.js":[64047,566525],"./nn-no/desktop.js":[null],"./nn-no/digital-signage.js":[null],"./nn-no/discover-surface.js":[969330,250241],"./nn-no/edu.js":[792650,339699],"./nn-no/embed.js":[359684,523190],"./nn-no/errors.js":[663008,523190],"./nn-no/esp.js":[64748,992784],"./nn-no/extensibility-ptz-extension.js":[null],"./nn-no/extensibility-room-remote.js":[null],"./nn-no/extensibility.js":[804227,523190],"./nn-no/feedback.js":[794491,570690],"./nn-no/files.js":[758782,523190],"./nn-no/framework.js":[24013,523190],"./nn-no/freemium-upgrade.js":[null],"./nn-no/funstuff.js":[321986,277483],"./nn-no/gallery.js":[24587,385470],"./nn-no/growth.js":[188330,523190],"./nn-no/guardians.js":[141296,504299],"./nn-no/health.js":[130812,36856],"./nn-no/help.js":[null],"./nn-no/hololens.js":[664119,979355],"./nn-no/host-controls.js":[388080,413440],"./nn-no/jana.js":[10474,509307],"./nn-no/lightbox.js":[18645,523190],"./nn-no/live-persona-card.js":[992348,523190],"./nn-no/live-persona-editor.js":[22066,149623],"./nn-no/lms-integration.js":[null],"./nn-no/meet-for-work.js":[147070,828582],"./nn-no/meeting-analytics.js":[330444,861386],"./nn-no/meeting-apis-app.js":[null],"./nn-no/meeting-bot.js":[null],"./nn-no/meeting-collaboration.js":[888735,274121],"./nn-no/meeting-flyout.js":[182268,523190],"./nn-no/meeting-meet-app.js":[678365,523190],"./nn-no/meeting-options.js":[503481,814834],"./nn-no/meeting-recap.js":[359381,704987],"./nn-no/meeting-room-console.js":[null],"./nn-no/meeting-stream-app.js":[null],"./nn-no/message-escalate-dialog.js":[695515,979753],"./nn-no/messaging.js":[439151,523190],"./nn-no/mobile-attach.js":[null],"./nn-no/mtma-missed-notifications.js":[253861,523190],"./nn-no/nova.js":[624348,523190],"./nn-no/people-app.js":[null],"./nn-no/people-picker.js":[622566,523190],"./nn-no/people-targeting.js":[819662,64108],"./nn-no/people.js":[141900,523190],"./nn-no/person.js":[465504,523190],"./nn-no/phonelink-sms.js":[193526,627377],"./nn-no/pre-core.js":[null],"./nn-no/premium-benefits.js":[47503,81660],"./nn-no/presence.js":[113980,523190],"./nn-no/queues.js":[215070,501990],"./nn-no/recurrence.js":[42812,617662],"./nn-no/rsc-application-permissions.js":[null],"./nn-no/search.js":[812534,566525],"./nn-no/semantic-object.js":[251843,274786],"./nn-no/settings.js":[314273,523190],"./nn-no/share-in-meetings.js":[null],"./nn-no/share-to-teams-outlook-addin.js":[null],"./nn-no/share-to-teams-third-party.js":[null],"./nn-no/share-to-teams.js":[778777,896317],"./nn-no/shortcut.js":[173247,523190],"./nn-no/shortcuts.js":[614619,523190],"./nn-no/simple-collab.js":[146641,523190],"./nn-no/smart-device.js":[null],"./nn-no/survey.js":[638835,290189],"./nn-no/sv-flyout.js":[815598,523190],"./nn-no/teams-and-channels.js":[967152,27214],"./nn-no/teams-insider.js":[454670,523190],"./nn-no/telemetry.js":[72691,523190],"./nn-no/tfl-homepage.js":[646655,523190],"./nn-no/tfl-onboarding.js":[799216,523190],"./nn-no/toast-notifications.js":[862443,523190],"./nn-no/trusted-ui.js":[null],"./nn-no/unified-search.js":[872692,896317],"./nn-no/unsupported-browser.js":[null],"./nn-no/url-preview.js":[242629,523190],"./nn-no/video-capture.js":[126574,227810],"./nn-no/video-message.js":[72223,903584],"./nn-no/virtual-consumer-events.js":[499989,684228],"./nn-no/virtual-events.js":[786282,125502],"./nn-no/webinar.js":[988642,460767],"./nn-no/welcome-bot.js":[null],"./nn-no/whats-new.js":[424543,523190],"./nn-no/wiki.js":[null],"./pl-pl/activity.js":[148487,383062],"./pl-pl/artifacts-platform.js":[9598,429453],"./pl-pl/audience-view-dialog.js":[818733,389869],"./pl-pl/auth.js":[813870,383062],"./pl-pl/autosuggest.js":[661808,383062],"./pl-pl/avatar.js":[15265,383062],"./pl-pl/biometric-enrollment.js":[920024,813794],"./pl-pl/breakout-rooms.js":[807319,471158],"./pl-pl/broadcast.js":[719136,688282],"./pl-pl/calendar.js":[807137,860639],"./pl-pl/calling.js":[68270,662245],"./pl-pl/campaign-notifications.js":[685875,383062],"./pl-pl/carousel-multi-card.js":[null],"./pl-pl/cast.js":[17348,383062],"./pl-pl/channels.js":[591371,383062],"./pl-pl/chat-list.js":[40991,383062],"./pl-pl/coach-report.js":[577219,557787],"./pl-pl/comment-stream.js":[666114,344625],"./pl-pl/communities.js":[500461,383062],"./pl-pl/compose.js":[135028,383062],"./pl-pl/contacts.js":[945282,383062],"./pl-pl/datepicker.js":[438941,959860],"./pl-pl/desktop.js":[null],"./pl-pl/digital-signage.js":[null],"./pl-pl/discover-surface.js":[539862,4452],"./pl-pl/edu.js":[298698,549697],"./pl-pl/embed.js":[694069,383062],"./pl-pl/errors.js":[637902,383062],"./pl-pl/esp.js":[76643,989139],"./pl-pl/extensibility-ptz-extension.js":[null],"./pl-pl/extensibility-room-remote.js":[null],"./pl-pl/extensibility.js":[548400,383062],"./pl-pl/feedback.js":[824970,884881],"./pl-pl/files.js":[365233,383062],"./pl-pl/framework.js":[160633,383062],"./pl-pl/freemium-upgrade.js":[null],"./pl-pl/funstuff.js":[347447,933865],"./pl-pl/gallery.js":[195924,266144],"./pl-pl/growth.js":[291277,383062],"./pl-pl/guardians.js":[240128,389903],"./pl-pl/health.js":[202831,231527],"./pl-pl/help.js":[null],"./pl-pl/hololens.js":[114447,662245],"./pl-pl/host-controls.js":[35071,26285],"./pl-pl/jana.js":[707207,667034],"./pl-pl/lightbox.js":[595961,383062],"./pl-pl/live-persona-card.js":[978570,383062],"./pl-pl/live-persona-editor.js":[203634,972451],"./pl-pl/lms-integration.js":[null],"./pl-pl/meet-for-work.js":[901894,223283],"./pl-pl/meeting-analytics.js":[113523,366435],"./pl-pl/meeting-apis-app.js":[null],"./pl-pl/meeting-bot.js":[null],"./pl-pl/meeting-collaboration.js":[771549,350261],"./pl-pl/meeting-flyout.js":[708332,383062],"./pl-pl/meeting-meet-app.js":[310879,383062],"./pl-pl/meeting-options.js":[18731,927030],"./pl-pl/meeting-recap.js":[652853,932610],"./pl-pl/meeting-room-console.js":[null],"./pl-pl/meeting-stream-app.js":[null],"./pl-pl/message-escalate-dialog.js":[406335,370898],"./pl-pl/messaging.js":[802794,383062],"./pl-pl/mobile-attach.js":[null],"./pl-pl/mtma-missed-notifications.js":[599523,383062],"./pl-pl/nova.js":[20681,383062],"./pl-pl/people-app.js":[null],"./pl-pl/people-picker.js":[308929,383062],"./pl-pl/people-targeting.js":[299965,188437],"./pl-pl/people.js":[278926,383062],"./pl-pl/person.js":[581705,383062],"./pl-pl/phonelink-sms.js":[516797,775293],"./pl-pl/pre-core.js":[null],"./pl-pl/premium-benefits.js":[233233,770828],"./pl-pl/presence.js":[771447,383062],"./pl-pl/queues.js":[345646,831730],"./pl-pl/recurrence.js":[393577,120904],"./pl-pl/rsc-application-permissions.js":[null],"./pl-pl/search.js":[425579,959860],"./pl-pl/semantic-object.js":[435149,913418],"./pl-pl/settings.js":[233332,383062],"./pl-pl/share-in-meetings.js":[null],"./pl-pl/share-to-teams-outlook-addin.js":[null],"./pl-pl/share-to-teams-third-party.js":[null],"./pl-pl/share-to-teams.js":[213139,322628],"./pl-pl/shortcut.js":[285433,383062],"./pl-pl/shortcuts.js":[519112,383062],"./pl-pl/simple-collab.js":[759496,383062],"./pl-pl/smart-device.js":[null],"./pl-pl/survey.js":[639840,375519],"./pl-pl/sv-flyout.js":[872659,383062],"./pl-pl/teams-and-channels.js":[976834,162531],"./pl-pl/teams-insider.js":[12457,383062],"./pl-pl/telemetry.js":[195220,383062],"./pl-pl/tfl-homepage.js":[606085,383062],"./pl-pl/tfl-onboarding.js":[45097,383062],"./pl-pl/toast-notifications.js":[130837,383062],"./pl-pl/trusted-ui.js":[null],"./pl-pl/unified-search.js":[125967,322628],"./pl-pl/unsupported-browser.js":[null],"./pl-pl/url-preview.js":[231369,383062],"./pl-pl/video-capture.js":[666752,433418],"./pl-pl/video-message.js":[666998,284926],"./pl-pl/virtual-consumer-events.js":[284280,365501],"./pl-pl/virtual-events.js":[882668,236854],"./pl-pl/webinar.js":[497858,468472],"./pl-pl/welcome-bot.js":[null],"./pl-pl/whats-new.js":[231524,383062],"./pl-pl/wiki.js":[null],"./pt-br/activity.js":[237939,390928],"./pt-br/artifacts-platform.js":[511555,604340],"./pt-br/audience-view-dialog.js":[967927,47761],"./pt-br/auth.js":[464680,390928],"./pt-br/autosuggest.js":[704102,390928],"./pt-br/avatar.js":[658613,390928],"./pt-br/biometric-enrollment.js":[570519,537446],"./pt-br/breakout-rooms.js":[457624,650053],"./pt-br/broadcast.js":[639510,75413],"./pt-br/calendar.js":[798999,863185],"./pt-br/calling.js":[548913,88478],"./pt-br/campaign-notifications.js":[809431,390928],"./pt-br/carousel-multi-card.js":[null],"./pt-br/cast.js":[917282,390928],"./pt-br/channels.js":[21182,390928],"./pt-br/chat-list.js":[653759,390928],"./pt-br/coach-report.js":[779225,470],"./pt-br/comment-stream.js":[322134,783797],"./pt-br/communities.js":[941345,390928],"./pt-br/compose.js":[496313,390928],"./pt-br/contacts.js":[472804,390928],"./pt-br/datepicker.js":[4099,766761],"./pt-br/desktop.js":[null],"./pt-br/digital-signage.js":[null],"./pt-br/discover-surface.js":[457035,16571],"./pt-br/edu.js":[859541,365099],"./pt-br/embed.js":[517869,390928],"./pt-br/errors.js":[314573,390928],"./pt-br/esp.js":[850317,102771],"./pt-br/extensibility-ptz-extension.js":[null],"./pt-br/extensibility-room-remote.js":[null],"./pt-br/extensibility.js":[788446,390928],"./pt-br/feedback.js":[643786,987894],"./pt-br/files.js":[321724,390928],"./pt-br/framework.js":[539618,390928],"./pt-br/freemium-upgrade.js":[null],"./pt-br/funstuff.js":[312557,943391],"./pt-br/gallery.js":[108396,813652],"./pt-br/growth.js":[303507,390928],"./pt-br/guardians.js":[804950,629741],"./pt-br/health.js":[934699,648736],"./pt-br/help.js":[null],"./pt-br/hololens.js":[51957,88478],"./pt-br/host-controls.js":[522736,645465],"./pt-br/jana.js":[232362,347452],"./pt-br/lightbox.js":[942735,390928],"./pt-br/live-persona-card.js":[135158,390928],"./pt-br/live-persona-editor.js":[25972,458567],"./pt-br/lms-integration.js":[null],"./pt-br/meet-for-work.js":[53931,514512],"./pt-br/meeting-analytics.js":[222049,591736],"./pt-br/meeting-apis-app.js":[null],"./pt-br/meeting-bot.js":[null],"./pt-br/meeting-collaboration.js":[280563,378648],"./pt-br/meeting-flyout.js":[102962,390928],"./pt-br/meeting-meet-app.js":[740082,390928],"./pt-br/meeting-options.js":[195102,413680],"./pt-br/meeting-recap.js":[69702,7813],"./pt-br/meeting-room-console.js":[null],"./pt-br/meeting-stream-app.js":[null],"./pt-br/message-escalate-dialog.js":[596066,541707],"./pt-br/messaging.js":[848531,390928],"./pt-br/mobile-attach.js":[null],"./pt-br/mtma-missed-notifications.js":[619653,390928],"./pt-br/nova.js":[554689,390928],"./pt-br/people-app.js":[null],"./pt-br/people-picker.js":[47823,390928],"./pt-br/people-targeting.js":[20714,895768],"./pt-br/people.js":[235049,390928],"./pt-br/person.js":[869224,390928],"./pt-br/phonelink-sms.js":[537823,740779],"./pt-br/pre-core.js":[null],"./pt-br/premium-benefits.js":[396502,662341],"./pt-br/presence.js":[243412,390928],"./pt-br/queues.js":[653439,574329],"./pt-br/recurrence.js":[801452,717293],"./pt-br/rsc-application-permissions.js":[null],"./pt-br/search.js":[299690,766761],"./pt-br/semantic-object.js":[658323,872501],"./pt-br/settings.js":[558634,390928],"./pt-br/share-in-meetings.js":[null],"./pt-br/share-to-teams-outlook-addin.js":[null],"./pt-br/share-to-teams-third-party.js":[null],"./pt-br/share-to-teams.js":[692514,869144],"./pt-br/shortcut.js":[794634,390928],"./pt-br/shortcuts.js":[740335,390928],"./pt-br/simple-collab.js":[459931,390928],"./pt-br/smart-device.js":[null],"./pt-br/survey.js":[242805,798972],"./pt-br/sv-flyout.js":[38778,390928],"./pt-br/teams-and-channels.js":[110995,430242],"./pt-br/teams-insider.js":[708726,390928],"./pt-br/telemetry.js":[880239,390928],"./pt-br/tfl-homepage.js":[160038,390928],"./pt-br/tfl-onboarding.js":[99371,390928],"./pt-br/toast-notifications.js":[17026,390928],"./pt-br/trusted-ui.js":[null],"./pt-br/unified-search.js":[341837,869144],"./pt-br/unsupported-browser.js":[null],"./pt-br/url-preview.js":[183678,390928],"./pt-br/video-capture.js":[52013,118529],"./pt-br/video-message.js":[746346,989465],"./pt-br/virtual-consumer-events.js":[351991,431022],"./pt-br/virtual-events.js":[246722,93413],"./pt-br/webinar.js":[556296,330637],"./pt-br/welcome-bot.js":[null],"./pt-br/whats-new.js":[669971,390928],"./pt-br/wiki.js":[null],"./pt-pt/activity.js":[832975,597828],"./pt-pt/artifacts-platform.js":[345512,302514],"./pt-pt/audience-view-dialog.js":[146149,15257],"./pt-pt/auth.js":[74435,597828],"./pt-pt/autosuggest.js":[741886,597828],"./pt-pt/avatar.js":[98575,597828],"./pt-pt/biometric-enrollment.js":[89021,553460],"./pt-pt/breakout-rooms.js":[808300,674381],"./pt-pt/broadcast.js":[892508,962351],"./pt-pt/calendar.js":[412986,174249],"./pt-pt/calling.js":[846015,552534],"./pt-pt/campaign-notifications.js":[901757,597828],"./pt-pt/carousel-multi-card.js":[null],"./pt-pt/cast.js":[747009,597828],"./pt-pt/channels.js":[799753,597828],"./pt-pt/chat-list.js":[496413,597828],"./pt-pt/coach-report.js":[503262,398635],"./pt-pt/comment-stream.js":[436143,463131],"./pt-pt/communities.js":[382679,597828],"./pt-pt/compose.js":[999750,597828],"./pt-pt/contacts.js":[723809,597828],"./pt-pt/datepicker.js":[226297,646804],"./pt-pt/desktop.js":[null],"./pt-pt/digital-signage.js":[null],"./pt-pt/discover-surface.js":[103526,259999],"./pt-pt/edu.js":[674461,742163],"./pt-pt/embed.js":[987233,597828],"./pt-pt/errors.js":[754746,597828],"./pt-pt/esp.js":[661125,351106],"./pt-pt/extensibility-ptz-extension.js":[null],"./pt-pt/extensibility-room-remote.js":[null],"./pt-pt/extensibility.js":[634363,597828],"./pt-pt/feedback.js":[537068,960840],"./pt-pt/files.js":[3530,597828],"./pt-pt/framework.js":[831538,597828],"./pt-pt/freemium-upgrade.js":[null],"./pt-pt/funstuff.js":[646615,431660],"./pt-pt/gallery.js":[933024,392278],"./pt-pt/growth.js":[132591,597828],"./pt-pt/guardians.js":[713065,961074],"./pt-pt/health.js":[592483,833238],"./pt-pt/help.js":[null],"./pt-pt/hololens.js":[34533,552534],"./pt-pt/host-controls.js":[644712,298951],"./pt-pt/jana.js":[775765,223234],"./pt-pt/lightbox.js":[783176,597828],"./pt-pt/live-persona-card.js":[932134,597828],"./pt-pt/live-persona-editor.js":[261111,926334],"./pt-pt/lms-integration.js":[null],"./pt-pt/meet-for-work.js":[382931,737310],"./pt-pt/meeting-analytics.js":[555926,366894],"./pt-pt/meeting-apis-app.js":[null],"./pt-pt/meeting-bot.js":[null],"./pt-pt/meeting-collaboration.js":[979112,173250],"./pt-pt/meeting-flyout.js":[400487,597828],"./pt-pt/meeting-meet-app.js":[894597,597828],"./pt-pt/meeting-options.js":[884274,808521],"./pt-pt/meeting-recap.js":[933838,341253],"./pt-pt/meeting-room-console.js":[null],"./pt-pt/meeting-stream-app.js":[null],"./pt-pt/message-escalate-dialog.js":[859721,195584],"./pt-pt/messaging.js":[380504,597828],"./pt-pt/mobile-attach.js":[null],"./pt-pt/mtma-missed-notifications.js":[309216,597828],"./pt-pt/nova.js":[411346,597828],"./pt-pt/people-app.js":[null],"./pt-pt/people-picker.js":[706549,597828],"./pt-pt/people-targeting.js":[675764,169380],"./pt-pt/people.js":[239681,597828],"./pt-pt/person.js":[144301,597828],"./pt-pt/phonelink-sms.js":[486212,823799],"./pt-pt/pre-core.js":[null],"./pt-pt/premium-benefits.js":[973569,625850],"./pt-pt/presence.js":[454250,597828],"./pt-pt/queues.js":[601479,752579],"./pt-pt/recurrence.js":[347869,978433],"./pt-pt/rsc-application-permissions.js":[null],"./pt-pt/search.js":[330729,646804],"./pt-pt/semantic-object.js":[730949,261539],"./pt-pt/settings.js":[131151,597828],"./pt-pt/share-in-meetings.js":[null],"./pt-pt/share-to-teams-outlook-addin.js":[null],"./pt-pt/share-to-teams-third-party.js":[null],"./pt-pt/share-to-teams.js":[7677,940042],"./pt-pt/shortcut.js":[202187,597828],"./pt-pt/shortcuts.js":[398960,597828],"./pt-pt/simple-collab.js":[111187,597828],"./pt-pt/smart-device.js":[null],"./pt-pt/survey.js":[513346,239888],"./pt-pt/sv-flyout.js":[123041,597828],"./pt-pt/teams-and-channels.js":[686933,274217],"./pt-pt/teams-insider.js":[908173,597828],"./pt-pt/telemetry.js":[383312,597828],"./pt-pt/tfl-homepage.js":[912072,597828],"./pt-pt/tfl-onboarding.js":[798872,597828],"./pt-pt/toast-notifications.js":[537134,597828],"./pt-pt/trusted-ui.js":[null],"./pt-pt/unified-search.js":[668658,940042],"./pt-pt/unsupported-browser.js":[null],"./pt-pt/url-preview.js":[828316,597828],"./pt-pt/video-capture.js":[99582,180165],"./pt-pt/video-message.js":[480059,363627],"./pt-pt/virtual-consumer-events.js":[111731,662359],"./pt-pt/virtual-events.js":[103251,509902],"./pt-pt/webinar.js":[420379,765065],"./pt-pt/welcome-bot.js":[null],"./pt-pt/whats-new.js":[538578,597828],"./pt-pt/wiki.js":[null],"./ro-ro/activity.js":[750704,351554],"./ro-ro/artifacts-platform.js":[928382,895146],"./ro-ro/audience-view-dialog.js":[358715,698929],"./ro-ro/auth.js":[738746,351554],"./ro-ro/autosuggest.js":[301729,351554],"./ro-ro/avatar.js":[823678,351554],"./ro-ro/biometric-enrollment.js":[676284,113737],"./ro-ro/breakout-rooms.js":[684740,292631],"./ro-ro/broadcast.js":[265880,756679],"./ro-ro/calendar.js":[612622,483107],"./ro-ro/calling.js":[468587,983017],"./ro-ro/campaign-notifications.js":[43532,351554],"./ro-ro/carousel-multi-card.js":[null],"./ro-ro/cast.js":[263684,351554],"./ro-ro/channels.js":[228217,351554],"./ro-ro/chat-list.js":[731310,351554],"./ro-ro/coach-report.js":[175545,836980],"./ro-ro/comment-stream.js":[409444,640606],"./ro-ro/communities.js":[551914,351554],"./ro-ro/compose.js":[937636,351554],"./ro-ro/contacts.js":[533777,351554],"./ro-ro/datepicker.js":[521579,479010],"./ro-ro/desktop.js":[null],"./ro-ro/digital-signage.js":[null],"./ro-ro/discover-surface.js":[785635,81481],"./ro-ro/edu.js":[134068,437038],"./ro-ro/embed.js":[290499,351554],"./ro-ro/errors.js":[394293,351554],"./ro-ro/esp.js":[75637,956633],"./ro-ro/extensibility-ptz-extension.js":[null],"./ro-ro/extensibility-room-remote.js":[null],"./ro-ro/extensibility.js":[266561,351554],"./ro-ro/feedback.js":[246322,397869],"./ro-ro/files.js":[895747,351554],"./ro-ro/framework.js":[295766,351554],"./ro-ro/freemium-upgrade.js":[null],"./ro-ro/funstuff.js":[75189,561860],"./ro-ro/gallery.js":[65073,965041],"./ro-ro/growth.js":[524477,351554],"./ro-ro/guardians.js":[210511,513968],"./ro-ro/health.js":[606446,395939],"./ro-ro/help.js":[null],"./ro-ro/hololens.js":[55806,983017],"./ro-ro/host-controls.js":[160424,177882],"./ro-ro/jana.js":[103668,136389],"./ro-ro/lightbox.js":[870197,351554],"./ro-ro/live-persona-card.js":[737564,351554],"./ro-ro/live-persona-editor.js":[331733,113569],"./ro-ro/lms-integration.js":[null],"./ro-ro/meet-for-work.js":[888130,143535],"./ro-ro/meeting-analytics.js":[548295,196137],"./ro-ro/meeting-apis-app.js":[null],"./ro-ro/meeting-bot.js":[null],"./ro-ro/meeting-collaboration.js":[34282,87607],"./ro-ro/meeting-flyout.js":[264371,351554],"./ro-ro/meeting-meet-app.js":[971064,351554],"./ro-ro/meeting-options.js":[959265,600132],"./ro-ro/meeting-recap.js":[849910,46436],"./ro-ro/meeting-room-console.js":[null],"./ro-ro/meeting-stream-app.js":[null],"./ro-ro/message-escalate-dialog.js":[987059,742842],"./ro-ro/messaging.js":[618390,351554],"./ro-ro/mobile-attach.js":[null],"./ro-ro/mtma-missed-notifications.js":[772385,351554],"./ro-ro/nova.js":[35397,351554],"./ro-ro/people-app.js":[null],"./ro-ro/people-picker.js":[312150,351554],"./ro-ro/people-targeting.js":[341708,878052],"./ro-ro/people.js":[263688,351554],"./ro-ro/person.js":[446886,351554],"./ro-ro/phonelink-sms.js":[172115,712539],"./ro-ro/pre-core.js":[null],"./ro-ro/premium-benefits.js":[407849,159342],"./ro-ro/presence.js":[18430,351554],"./ro-ro/queues.js":[718680,964536],"./ro-ro/recurrence.js":[739585,417418],"./ro-ro/rsc-application-permissions.js":[null],"./ro-ro/search.js":[478226,479010],"./ro-ro/semantic-object.js":[125769,773696],"./ro-ro/settings.js":[824188,351554],"./ro-ro/share-in-meetings.js":[null],"./ro-ro/share-to-teams-outlook-addin.js":[null],"./ro-ro/share-to-teams-third-party.js":[null],"./ro-ro/share-to-teams.js":[869947,161183],"./ro-ro/shortcut.js":[467164,351554],"./ro-ro/shortcuts.js":[462374,351554],"./ro-ro/simple-collab.js":[343583,351554],"./ro-ro/smart-device.js":[null],"./ro-ro/survey.js":[895972,100598],"./ro-ro/sv-flyout.js":[80843,351554],"./ro-ro/teams-and-channels.js":[930783,426447],"./ro-ro/teams-insider.js":[929755,351554],"./ro-ro/telemetry.js":[779960,351554],"./ro-ro/tfl-homepage.js":[882445,351554],"./ro-ro/tfl-onboarding.js":[131082,351554],"./ro-ro/toast-notifications.js":[6911,351554],"./ro-ro/trusted-ui.js":[null],"./ro-ro/unified-search.js":[207718,161183],"./ro-ro/unsupported-browser.js":[null],"./ro-ro/url-preview.js":[10134,351554],"./ro-ro/video-capture.js":[449780,189910],"./ro-ro/video-message.js":[36541,409162],"./ro-ro/virtual-consumer-events.js":[748059,501096],"./ro-ro/virtual-events.js":[456713,862108],"./ro-ro/webinar.js":[390210,905049],"./ro-ro/welcome-bot.js":[null],"./ro-ro/whats-new.js":[659960,351554],"./ro-ro/wiki.js":[null],"./ru-ru/activity.js":[715498,914743],"./ru-ru/artifacts-platform.js":[372835,408632],"./ru-ru/audience-view-dialog.js":[701795,137106],"./ru-ru/auth.js":[122721,914743],"./ru-ru/autosuggest.js":[554041,914743],"./ru-ru/avatar.js":[405055,914743],"./ru-ru/biometric-enrollment.js":[228323,503940],"./ru-ru/breakout-rooms.js":[110455,351780],"./ru-ru/broadcast.js":[617766,978981],"./ru-ru/calendar.js":[683780,950636],"./ru-ru/calling.js":[933397,637754],"./ru-ru/campaign-notifications.js":[348271,914743],"./ru-ru/carousel-multi-card.js":[null],"./ru-ru/cast.js":[457770,914743],"./ru-ru/channels.js":[537241,914743],"./ru-ru/chat-list.js":[219352,914743],"./ru-ru/coach-report.js":[269508,201429],"./ru-ru/comment-stream.js":[42464,302158],"./ru-ru/communities.js":[23197,914743],"./ru-ru/compose.js":[205132,914743],"./ru-ru/contacts.js":[194426,914743],"./ru-ru/datepicker.js":[372548,54180],"./ru-ru/desktop.js":[null],"./ru-ru/digital-signage.js":[null],"./ru-ru/discover-surface.js":[841769,356092],"./ru-ru/edu.js":[100948,880089],"./ru-ru/embed.js":[933868,914743],"./ru-ru/errors.js":[73771,914743],"./ru-ru/esp.js":[773652,71021],"./ru-ru/extensibility-ptz-extension.js":[null],"./ru-ru/extensibility-room-remote.js":[null],"./ru-ru/extensibility.js":[217243,914743],"./ru-ru/feedback.js":[831545,507134],"./ru-ru/files.js":[1804,914743],"./ru-ru/framework.js":[11500,914743],"./ru-ru/freemium-upgrade.js":[null],"./ru-ru/funstuff.js":[736101,52235],"./ru-ru/gallery.js":[101785,823954],"./ru-ru/growth.js":[40964,914743],"./ru-ru/guardians.js":[653887,128254],"./ru-ru/health.js":[60014,999114],"./ru-ru/help.js":[null],"./ru-ru/hololens.js":[859784,637754],"./ru-ru/host-controls.js":[819933,647909],"./ru-ru/jana.js":[96648,563048],"./ru-ru/lightbox.js":[9608,914743],"./ru-ru/live-persona-card.js":[941872,914743],"./ru-ru/live-persona-editor.js":[175891,447217],"./ru-ru/lms-integration.js":[null],"./ru-ru/meet-for-work.js":[610899,165446],"./ru-ru/meeting-analytics.js":[715725,545730],"./ru-ru/meeting-apis-app.js":[null],"./ru-ru/meeting-bot.js":[null],"./ru-ru/meeting-collaboration.js":[556468,76961],"./ru-ru/meeting-flyout.js":[14663,914743],"./ru-ru/meeting-meet-app.js":[513115,914743],"./ru-ru/meeting-options.js":[406126,956641],"./ru-ru/meeting-recap.js":[536066,997071],"./ru-ru/meeting-room-console.js":[null],"./ru-ru/meeting-stream-app.js":[null],"./ru-ru/message-escalate-dialog.js":[290331,388262],"./ru-ru/messaging.js":[100987,914743],"./ru-ru/mobile-attach.js":[null],"./ru-ru/mtma-missed-notifications.js":[683255,914743],"./ru-ru/nova.js":[675443,914743],"./ru-ru/people-app.js":[null],"./ru-ru/people-picker.js":[966786,914743],"./ru-ru/people-targeting.js":[995855,265758],"./ru-ru/people.js":[305130,914743],"./ru-ru/person.js":[821765,914743],"./ru-ru/phonelink-sms.js":[489954,550360],"./ru-ru/pre-core.js":[null],"./ru-ru/premium-benefits.js":[9793,278090],"./ru-ru/presence.js":[326249,914743],"./ru-ru/queues.js":[68981,592475],"./ru-ru/recurrence.js":[842750,806389],"./ru-ru/rsc-application-permissions.js":[null],"./ru-ru/search.js":[268345,54180],"./ru-ru/semantic-object.js":[212536,254122],"./ru-ru/settings.js":[794753,914743],"./ru-ru/share-in-meetings.js":[null],"./ru-ru/share-to-teams-outlook-addin.js":[null],"./ru-ru/share-to-teams-third-party.js":[null],"./ru-ru/share-to-teams.js":[790822,496334],"./ru-ru/shortcut.js":[520327,914743],"./ru-ru/shortcuts.js":[148319,914743],"./ru-ru/simple-collab.js":[592210,914743],"./ru-ru/smart-device.js":[null],"./ru-ru/survey.js":[335117,755340],"./ru-ru/sv-flyout.js":[883504,914743],"./ru-ru/teams-and-channels.js":[452713,261090],"./ru-ru/teams-insider.js":[518951,914743],"./ru-ru/telemetry.js":[971796,914743],"./ru-ru/tfl-homepage.js":[46478,914743],"./ru-ru/tfl-onboarding.js":[503268,914743],"./ru-ru/toast-notifications.js":[771366,914743],"./ru-ru/trusted-ui.js":[null],"./ru-ru/unified-search.js":[920647,496334],"./ru-ru/unsupported-browser.js":[null],"./ru-ru/url-preview.js":[146631,914743],"./ru-ru/video-capture.js":[318322,284862],"./ru-ru/video-message.js":[826779,800274],"./ru-ru/virtual-consumer-events.js":[51714,829325],"./ru-ru/virtual-events.js":[780895,36644],"./ru-ru/webinar.js":[477637,996802],"./ru-ru/welcome-bot.js":[null],"./ru-ru/whats-new.js":[387086,914743],"./ru-ru/wiki.js":[null],"./sk-sk/activity.js":[844208,127199],"./sk-sk/artifacts-platform.js":[238274,758673],"./sk-sk/audience-view-dialog.js":[223159,284063],"./sk-sk/auth.js":[266059,127199],"./sk-sk/autosuggest.js":[237091,127199],"./sk-sk/avatar.js":[388928,127199],"./sk-sk/biometric-enrollment.js":[240670,857441],"./sk-sk/breakout-rooms.js":[195187,302797],"./sk-sk/broadcast.js":[689891,980839],"./sk-sk/calendar.js":[184297,762781],"./sk-sk/calling.js":[498735,812090],"./sk-sk/campaign-notifications.js":[449083,127199],"./sk-sk/carousel-multi-card.js":[null],"./sk-sk/cast.js":[148919,127199],"./sk-sk/channels.js":[429604,127199],"./sk-sk/chat-list.js":[823741,127199],"./sk-sk/coach-report.js":[977121,582439],"./sk-sk/comment-stream.js":[249576,674669],"./sk-sk/communities.js":[540640,127199],"./sk-sk/compose.js":[118387,127199],"./sk-sk/contacts.js":[714898,127199],"./sk-sk/datepicker.js":[126616,202883],"./sk-sk/desktop.js":[null],"./sk-sk/digital-signage.js":[null],"./sk-sk/discover-surface.js":[582241,258357],"./sk-sk/edu.js":[771430,956665],"./sk-sk/embed.js":[809622,127199],"./sk-sk/errors.js":[907092,127199],"./sk-sk/esp.js":[352007,838461],"./sk-sk/extensibility-ptz-extension.js":[null],"./sk-sk/extensibility-room-remote.js":[null],"./sk-sk/extensibility.js":[535243,127199],"./sk-sk/feedback.js":[523456,917441],"./sk-sk/files.js":[941573,127199],"./sk-sk/framework.js":[887181,127199],"./sk-sk/freemium-upgrade.js":[null],"./sk-sk/funstuff.js":[772466,805111],"./sk-sk/gallery.js":[997577,641491],"./sk-sk/growth.js":[985443,127199],"./sk-sk/guardians.js":[980127,371515],"./sk-sk/health.js":[161785,560667],"./sk-sk/help.js":[null],"./sk-sk/hololens.js":[632475,812090],"./sk-sk/host-controls.js":[130354,724904],"./sk-sk/jana.js":[440412,113351],"./sk-sk/lightbox.js":[162779,127199],"./sk-sk/live-persona-card.js":[254117,127199],"./sk-sk/live-persona-editor.js":[332451,51449],"./sk-sk/lms-integration.js":[null],"./sk-sk/meet-for-work.js":[984151,40840],"./sk-sk/meeting-analytics.js":[860698,198167],"./sk-sk/meeting-apis-app.js":[null],"./sk-sk/meeting-bot.js":[null],"./sk-sk/meeting-collaboration.js":[81976,984324],"./sk-sk/meeting-flyout.js":[171654,127199],"./sk-sk/meeting-meet-app.js":[600662,127199],"./sk-sk/meeting-options.js":[370356,744470],"./sk-sk/meeting-recap.js":[636799,72011],"./sk-sk/meeting-room-console.js":[null],"./sk-sk/meeting-stream-app.js":[null],"./sk-sk/message-escalate-dialog.js":[259998,24516],"./sk-sk/messaging.js":[856016,127199],"./sk-sk/mobile-attach.js":[null],"./sk-sk/mtma-missed-notifications.js":[599079,127199],"./sk-sk/nova.js":[465174,127199],"./sk-sk/people-app.js":[null],"./sk-sk/people-picker.js":[71385,127199],"./sk-sk/people-targeting.js":[13684,838806],"./sk-sk/people.js":[810271,127199],"./sk-sk/person.js":[176794,127199],"./sk-sk/phonelink-sms.js":[238926,311420],"./sk-sk/pre-core.js":[null],"./sk-sk/premium-benefits.js":[440425,440267],"./sk-sk/presence.js":[417879,127199],"./sk-sk/queues.js":[935035,281234],"./sk-sk/recurrence.js":[183644,240238],"./sk-sk/rsc-application-permissions.js":[null],"./sk-sk/search.js":[416134,202883],"./sk-sk/semantic-object.js":[166645,165240],"./sk-sk/settings.js":[18207,127199],"./sk-sk/share-in-meetings.js":[null],"./sk-sk/share-to-teams-outlook-addin.js":[null],"./sk-sk/share-to-teams-third-party.js":[null],"./sk-sk/share-to-teams.js":[864323,73826],"./sk-sk/shortcut.js":[653453,127199],"./sk-sk/shortcuts.js":[42926,127199],"./sk-sk/simple-collab.js":[901861,127199],"./sk-sk/smart-device.js":[null],"./sk-sk/survey.js":[361437,438685],"./sk-sk/sv-flyout.js":[982585,127199],"./sk-sk/teams-and-channels.js":[607780,216478],"./sk-sk/teams-insider.js":[890813,127199],"./sk-sk/telemetry.js":[940105,127199],"./sk-sk/tfl-homepage.js":[467899,127199],"./sk-sk/tfl-onboarding.js":[552982,127199],"./sk-sk/toast-notifications.js":[941831,127199],"./sk-sk/trusted-ui.js":[null],"./sk-sk/unified-search.js":[724273,73826],"./sk-sk/unsupported-browser.js":[null],"./sk-sk/url-preview.js":[174514,127199],"./sk-sk/video-capture.js":[26776,147872],"./sk-sk/video-message.js":[901103,742302],"./sk-sk/virtual-consumer-events.js":[180477,980031],"./sk-sk/virtual-events.js":[303476,335479],"./sk-sk/webinar.js":[20889,38021],"./sk-sk/welcome-bot.js":[null],"./sk-sk/whats-new.js":[685589,127199],"./sk-sk/wiki.js":[null],"./sl-si/activity.js":[639390,959151],"./sl-si/artifacts-platform.js":[972402,86416],"./sl-si/audience-view-dialog.js":[479881,200245],"./sl-si/auth.js":[438232,959151],"./sl-si/autosuggest.js":[552821,959151],"./sl-si/avatar.js":[146457,959151],"./sl-si/biometric-enrollment.js":[690237,707015],"./sl-si/breakout-rooms.js":[501549,472385],"./sl-si/broadcast.js":[86739,736856],"./sl-si/calendar.js":[605202,355625],"./sl-si/calling.js":[830794,435588],"./sl-si/campaign-notifications.js":[572668,959151],"./sl-si/carousel-multi-card.js":[null],"./sl-si/cast.js":[626547,959151],"./sl-si/channels.js":[865780,959151],"./sl-si/chat-list.js":[643083,959151],"./sl-si/coach-report.js":[910916,587574],"./sl-si/comment-stream.js":[695869,455159],"./sl-si/communities.js":[26398,959151],"./sl-si/compose.js":[75805,959151],"./sl-si/contacts.js":[543606,959151],"./sl-si/datepicker.js":[314853,725509],"./sl-si/desktop.js":[null],"./sl-si/digital-signage.js":[null],"./sl-si/discover-surface.js":[912781,586754],"./sl-si/edu.js":[736319,834266],"./sl-si/embed.js":[481126,959151],"./sl-si/errors.js":[707293,959151],"./sl-si/esp.js":[327044,143589],"./sl-si/extensibility-ptz-extension.js":[null],"./sl-si/extensibility-room-remote.js":[null],"./sl-si/extensibility.js":[721004,959151],"./sl-si/feedback.js":[798045,881207],"./sl-si/files.js":[413794,959151],"./sl-si/framework.js":[419960,959151],"./sl-si/freemium-upgrade.js":[null],"./sl-si/funstuff.js":[263616,415304],"./sl-si/gallery.js":[256615,89905],"./sl-si/growth.js":[179319,959151],"./sl-si/guardians.js":[833798,731167],"./sl-si/health.js":[375659,520945],"./sl-si/help.js":[null],"./sl-si/hololens.js":[936776,435588],"./sl-si/host-controls.js":[441278,92699],"./sl-si/jana.js":[465197,547900],"./sl-si/lightbox.js":[657826,959151],"./sl-si/live-persona-card.js":[481028,959151],"./sl-si/live-persona-editor.js":[450428,757180],"./sl-si/lms-integration.js":[null],"./sl-si/meet-for-work.js":[975378,305992],"./sl-si/meeting-analytics.js":[898889,206194],"./sl-si/meeting-apis-app.js":[null],"./sl-si/meeting-bot.js":[null],"./sl-si/meeting-collaboration.js":[444508,573801],"./sl-si/meeting-flyout.js":[648439,959151],"./sl-si/meeting-meet-app.js":[15578,959151],"./sl-si/meeting-options.js":[771467,559401],"./sl-si/meeting-recap.js":[769314,123552],"./sl-si/meeting-room-console.js":[null],"./sl-si/meeting-stream-app.js":[null],"./sl-si/message-escalate-dialog.js":[195581,871288],"./sl-si/messaging.js":[20294,959151],"./sl-si/mobile-attach.js":[null],"./sl-si/mtma-missed-notifications.js":[121764,959151],"./sl-si/nova.js":[830605,959151],"./sl-si/people-app.js":[null],"./sl-si/people-picker.js":[408059,959151],"./sl-si/people-targeting.js":[628879,458392],"./sl-si/people.js":[649637,959151],"./sl-si/person.js":[788156,959151],"./sl-si/phonelink-sms.js":[413879,960612],"./sl-si/pre-core.js":[null],"./sl-si/premium-benefits.js":[207396,296878],"./sl-si/presence.js":[263584,959151],"./sl-si/queues.js":[951963,115166],"./sl-si/recurrence.js":[659552,539974],"./sl-si/rsc-application-permissions.js":[null],"./sl-si/search.js":[789091,725509],"./sl-si/semantic-object.js":[956373,678130],"./sl-si/settings.js":[875500,959151],"./sl-si/share-in-meetings.js":[null],"./sl-si/share-to-teams-outlook-addin.js":[null],"./sl-si/share-to-teams-third-party.js":[null],"./sl-si/share-to-teams.js":[568974,614268],"./sl-si/shortcut.js":[608140,959151],"./sl-si/shortcuts.js":[437178,959151],"./sl-si/simple-collab.js":[924552,959151],"./sl-si/smart-device.js":[null],"./sl-si/survey.js":[671737,905188],"./sl-si/sv-flyout.js":[967791,959151],"./sl-si/teams-and-channels.js":[330058,613392],"./sl-si/teams-insider.js":[901842,959151],"./sl-si/telemetry.js":[688856,959151],"./sl-si/tfl-homepage.js":[351520,959151],"./sl-si/tfl-onboarding.js":[74574,959151],"./sl-si/toast-notifications.js":[891485,959151],"./sl-si/trusted-ui.js":[null],"./sl-si/unified-search.js":[724527,614268],"./sl-si/unsupported-browser.js":[null],"./sl-si/url-preview.js":[521807,959151],"./sl-si/video-capture.js":[100617,108418],"./sl-si/video-message.js":[43131,10567],"./sl-si/virtual-consumer-events.js":[530469,79553],"./sl-si/virtual-events.js":[393721,514302],"./sl-si/webinar.js":[104843,688725],"./sl-si/welcome-bot.js":[null],"./sl-si/whats-new.js":[586932,959151],"./sl-si/wiki.js":[null],"./sq-al/activity.js":[218050,961331],"./sq-al/artifacts-platform.js":[64652,640756],"./sq-al/audience-view-dialog.js":[533182,91759],"./sq-al/auth.js":[251715,961331],"./sq-al/autosuggest.js":[496449,961331],"./sq-al/avatar.js":[849476,961331],"./sq-al/biometric-enrollment.js":[401762,799030],"./sq-al/breakout-rooms.js":[683985,130297],"./sq-al/broadcast.js":[598979,250215],"./sq-al/calendar.js":[408264,961543],"./sq-al/calling.js":[118658,703405],"./sq-al/campaign-notifications.js":[622966,961331],"./sq-al/carousel-multi-card.js":[null],"./sq-al/cast.js":[279616,961331],"./sq-al/channels.js":[889190,961331],"./sq-al/chat-list.js":[456280,961331],"./sq-al/coach-report.js":[608883,337784],"./sq-al/comment-stream.js":[928338,614523],"./sq-al/communities.js":[308724,961331],"./sq-al/compose.js":[342515,961331],"./sq-al/contacts.js":[253875,961331],"./sq-al/datepicker.js":[705296,327172],"./sq-al/desktop.js":[null],"./sq-al/digital-signage.js":[null],"./sq-al/discover-surface.js":[565812,393597],"./sq-al/edu.js":[723498,882709],"./sq-al/embed.js":[442128,961331],"./sq-al/errors.js":[896153,961331],"./sq-al/esp.js":[155304,1129],"./sq-al/extensibility-ptz-extension.js":[null],"./sq-al/extensibility-room-remote.js":[null],"./sq-al/extensibility.js":[313457,961331],"./sq-al/feedback.js":[468720,316837],"./sq-al/files.js":[466125,961331],"./sq-al/framework.js":[616396,961331],"./sq-al/freemium-upgrade.js":[null],"./sq-al/funstuff.js":[99063,969214],"./sq-al/gallery.js":[120439,620948],"./sq-al/growth.js":[706090,961331],"./sq-al/guardians.js":[599568,645885],"./sq-al/health.js":[643554,278792],"./sq-al/help.js":[null],"./sq-al/hololens.js":[976293,703405],"./sq-al/host-controls.js":[67625,33951],"./sq-al/jana.js":[948428,877918],"./sq-al/lightbox.js":[390301,961331],"./sq-al/live-persona-card.js":[599445,961331],"./sq-al/live-persona-editor.js":[458499,291874],"./sq-al/lms-integration.js":[null],"./sq-al/meet-for-work.js":[317890,419163],"./sq-al/meeting-analytics.js":[274438,983906],"./sq-al/meeting-apis-app.js":[null],"./sq-al/meeting-bot.js":[null],"./sq-al/meeting-collaboration.js":[159466,630384],"./sq-al/meeting-flyout.js":[850998,961331],"./sq-al/meeting-meet-app.js":[828231,961331],"./sq-al/meeting-options.js":[965149,978537],"./sq-al/meeting-recap.js":[754916,615066],"./sq-al/meeting-room-console.js":[null],"./sq-al/meeting-stream-app.js":[null],"./sq-al/message-escalate-dialog.js":[100205,204484],"./sq-al/messaging.js":[486002,961331],"./sq-al/mobile-attach.js":[null],"./sq-al/mtma-missed-notifications.js":[556078,961331],"./sq-al/nova.js":[309675,961331],"./sq-al/people-app.js":[null],"./sq-al/people-picker.js":[102044,961331],"./sq-al/people-targeting.js":[545943,349663],"./sq-al/people.js":[492338,961331],"./sq-al/person.js":[612353,961331],"./sq-al/phonelink-sms.js":[302424,343106],"./sq-al/pre-core.js":[null],"./sq-al/premium-benefits.js":[782605,669868],"./sq-al/presence.js":[873418,961331],"./sq-al/queues.js":[18060,53222],"./sq-al/recurrence.js":[356012,652708],"./sq-al/rsc-application-permissions.js":[null],"./sq-al/search.js":[464060,327172],"./sq-al/semantic-object.js":[585307,547140],"./sq-al/settings.js":[241518,961331],"./sq-al/share-in-meetings.js":[null],"./sq-al/share-to-teams-outlook-addin.js":[null],"./sq-al/share-to-teams-third-party.js":[null],"./sq-al/share-to-teams.js":[845858,212776],"./sq-al/shortcut.js":[182276,961331],"./sq-al/shortcuts.js":[147271,961331],"./sq-al/simple-collab.js":[776312,961331],"./sq-al/smart-device.js":[null],"./sq-al/survey.js":[387196,860005],"./sq-al/sv-flyout.js":[594012,961331],"./sq-al/teams-and-channels.js":[389095,403034],"./sq-al/teams-insider.js":[806643,961331],"./sq-al/telemetry.js":[481847,961331],"./sq-al/tfl-homepage.js":[548822,961331],"./sq-al/tfl-onboarding.js":[224763,961331],"./sq-al/toast-notifications.js":[276940,961331],"./sq-al/trusted-ui.js":[null],"./sq-al/unified-search.js":[556793,212776],"./sq-al/unsupported-browser.js":[null],"./sq-al/url-preview.js":[781233,961331],"./sq-al/video-capture.js":[520395,46926],"./sq-al/video-message.js":[697841,39840],"./sq-al/virtual-consumer-events.js":[635922,411020],"./sq-al/virtual-events.js":[107021,897327],"./sq-al/webinar.js":[140773,469120],"./sq-al/welcome-bot.js":[null],"./sq-al/whats-new.js":[720163,961331],"./sq-al/wiki.js":[null],"./sr-latn-rs/activity.js":[437497,645285],"./sr-latn-rs/artifacts-platform.js":[795396,303982],"./sr-latn-rs/audience-view-dialog.js":[400539,62713],"./sr-latn-rs/auth.js":[644457,645285],"./sr-latn-rs/autosuggest.js":[754128,645285],"./sr-latn-rs/avatar.js":[201424,645285],"./sr-latn-rs/biometric-enrollment.js":[117127,332426],"./sr-latn-rs/breakout-rooms.js":[11543,202748],"./sr-latn-rs/broadcast.js":[952543,977153],"./sr-latn-rs/calendar.js":[788352,69006],"./sr-latn-rs/calling.js":[146906,92525],"./sr-latn-rs/campaign-notifications.js":[881436,645285],"./sr-latn-rs/carousel-multi-card.js":[null],"./sr-latn-rs/cast.js":[671298,645285],"./sr-latn-rs/channels.js":[924575,645285],"./sr-latn-rs/chat-list.js":[149520,645285],"./sr-latn-rs/coach-report.js":[580144,44292],"./sr-latn-rs/comment-stream.js":[184538,3258],"./sr-latn-rs/communities.js":[418761,645285],"./sr-latn-rs/compose.js":[4031,645285],"./sr-latn-rs/contacts.js":[144896,645285],"./sr-latn-rs/datepicker.js":[511378,775447],"./sr-latn-rs/desktop.js":[null],"./sr-latn-rs/digital-signage.js":[null],"./sr-latn-rs/discover-surface.js":[728683,951582],"./sr-latn-rs/edu.js":[221638,148183],"./sr-latn-rs/embed.js":[473288,645285],"./sr-latn-rs/errors.js":[455591,645285],"./sr-latn-rs/esp.js":[287289,44565],"./sr-latn-rs/extensibility-ptz-extension.js":[null],"./sr-latn-rs/extensibility-room-remote.js":[null],"./sr-latn-rs/extensibility.js":[411333,645285],"./sr-latn-rs/feedback.js":[761251,809293],"./sr-latn-rs/files.js":[699049,645285],"./sr-latn-rs/framework.js":[572242,645285],"./sr-latn-rs/freemium-upgrade.js":[null],"./sr-latn-rs/funstuff.js":[711784,352881],"./sr-latn-rs/gallery.js":[913797,295787],"./sr-latn-rs/growth.js":[251723,645285],"./sr-latn-rs/guardians.js":[935629,774604],"./sr-latn-rs/health.js":[43670,211779],"./sr-latn-rs/help.js":[null],"./sr-latn-rs/hololens.js":[979632,92525],"./sr-latn-rs/host-controls.js":[752738,316783],"./sr-latn-rs/jana.js":[529453,906872],"./sr-latn-rs/lightbox.js":[351808,645285],"./sr-latn-rs/live-persona-card.js":[374260,645285],"./sr-latn-rs/live-persona-editor.js":[915976,644127],"./sr-latn-rs/lms-integration.js":[null],"./sr-latn-rs/meet-for-work.js":[393839,219735],"./sr-latn-rs/meeting-analytics.js":[424236,252354],"./sr-latn-rs/meeting-apis-app.js":[null],"./sr-latn-rs/meeting-bot.js":[null],"./sr-latn-rs/meeting-collaboration.js":[622806,54436],"./sr-latn-rs/meeting-flyout.js":[584422,645285],"./sr-latn-rs/meeting-meet-app.js":[536870,645285],"./sr-latn-rs/meeting-options.js":[996501,619599],"./sr-latn-rs/meeting-recap.js":[446224,89997],"./sr-latn-rs/meeting-room-console.js":[null],"./sr-latn-rs/meeting-stream-app.js":[null],"./sr-latn-rs/message-escalate-dialog.js":[809274,862198],"./sr-latn-rs/messaging.js":[422600,645285],"./sr-latn-rs/mobile-attach.js":[null],"./sr-latn-rs/mtma-missed-notifications.js":[884608,645285],"./sr-latn-rs/nova.js":[186975,645285],"./sr-latn-rs/people-app.js":[null],"./sr-latn-rs/people-picker.js":[613438,645285],"./sr-latn-rs/people-targeting.js":[371646,477747],"./sr-latn-rs/people.js":[40480,645285],"./sr-latn-rs/person.js":[416291,645285],"./sr-latn-rs/phonelink-sms.js":[370897,679045],"./sr-latn-rs/pre-core.js":[null],"./sr-latn-rs/premium-benefits.js":[536681,16448],"./sr-latn-rs/presence.js":[132428,645285],"./sr-latn-rs/queues.js":[262921,797069],"./sr-latn-rs/recurrence.js":[557309,324013],"./sr-latn-rs/rsc-application-permissions.js":[null],"./sr-latn-rs/search.js":[72226,775447],"./sr-latn-rs/semantic-object.js":[944166,94444],"./sr-latn-rs/settings.js":[360984,645285],"./sr-latn-rs/share-in-meetings.js":[null],"./sr-latn-rs/share-to-teams-outlook-addin.js":[null],"./sr-latn-rs/share-to-teams-third-party.js":[null],"./sr-latn-rs/share-to-teams.js":[47943,18846],"./sr-latn-rs/shortcut.js":[714376,645285],"./sr-latn-rs/shortcuts.js":[840466,645285],"./sr-latn-rs/simple-collab.js":[762385,645285],"./sr-latn-rs/smart-device.js":[null],"./sr-latn-rs/survey.js":[194514,975504],"./sr-latn-rs/sv-flyout.js":[47212,645285],"./sr-latn-rs/teams-and-channels.js":[986777,996696],"./sr-latn-rs/teams-insider.js":[776710,645285],"./sr-latn-rs/telemetry.js":[144057,645285],"./sr-latn-rs/tfl-homepage.js":[696796,645285],"./sr-latn-rs/tfl-onboarding.js":[458243,645285],"./sr-latn-rs/toast-notifications.js":[787597,645285],"./sr-latn-rs/trusted-ui.js":[null],"./sr-latn-rs/unified-search.js":[529999,18846],"./sr-latn-rs/unsupported-browser.js":[null],"./sr-latn-rs/url-preview.js":[133875,645285],"./sr-latn-rs/video-capture.js":[122080,661639],"./sr-latn-rs/video-message.js":[600323,530420],"./sr-latn-rs/virtual-consumer-events.js":[270811,107799],"./sr-latn-rs/virtual-events.js":[206528,618997],"./sr-latn-rs/webinar.js":[445407,501612],"./sr-latn-rs/welcome-bot.js":[null],"./sr-latn-rs/whats-new.js":[927927,645285],"./sr-latn-rs/wiki.js":[null],"./sv-se/activity.js":[677710,988681],"./sv-se/artifacts-platform.js":[366996,90109],"./sv-se/audience-view-dialog.js":[377497,297895],"./sv-se/auth.js":[841941,988681],"./sv-se/autosuggest.js":[249954,988681],"./sv-se/avatar.js":[814878,988681],"./sv-se/biometric-enrollment.js":[875637,956010],"./sv-se/breakout-rooms.js":[573026,668452],"./sv-se/broadcast.js":[11405,661922],"./sv-se/calendar.js":[2633,800509],"./sv-se/calling.js":[505313,731374],"./sv-se/campaign-notifications.js":[203197,988681],"./sv-se/carousel-multi-card.js":[null],"./sv-se/cast.js":[337010,988681],"./sv-se/channels.js":[626452,988681],"./sv-se/chat-list.js":[183940,988681],"./sv-se/coach-report.js":[907997,342920],"./sv-se/comment-stream.js":[656379,336592],"./sv-se/communities.js":[461058,988681],"./sv-se/compose.js":[5208,988681],"./sv-se/contacts.js":[403981,988681],"./sv-se/datepicker.js":[921850,146981],"./sv-se/desktop.js":[null],"./sv-se/digital-signage.js":[null],"./sv-se/discover-surface.js":[713095,152177],"./sv-se/edu.js":[950259,575244],"./sv-se/embed.js":[348617,988681],"./sv-se/errors.js":[303117,988681],"./sv-se/esp.js":[331998,154068],"./sv-se/extensibility-ptz-extension.js":[null],"./sv-se/extensibility-room-remote.js":[null],"./sv-se/extensibility.js":[714268,988681],"./sv-se/feedback.js":[712029,968075],"./sv-se/files.js":[866139,988681],"./sv-se/framework.js":[120102,988681],"./sv-se/freemium-upgrade.js":[null],"./sv-se/funstuff.js":[256247,124246],"./sv-se/gallery.js":[939060,655550],"./sv-se/growth.js":[491114,988681],"./sv-se/guardians.js":[69834,470175],"./sv-se/health.js":[590214,749],"./sv-se/help.js":[null],"./sv-se/hololens.js":[181258,731374],"./sv-se/host-controls.js":[468432,771557],"./sv-se/jana.js":[703661,344448],"./sv-se/lightbox.js":[836210,988681],"./sv-se/live-persona-card.js":[606610,988681],"./sv-se/live-persona-editor.js":[507748,762473],"./sv-se/lms-integration.js":[null],"./sv-se/meet-for-work.js":[780844,751921],"./sv-se/meeting-analytics.js":[634955,137472],"./sv-se/meeting-apis-app.js":[null],"./sv-se/meeting-bot.js":[null],"./sv-se/meeting-collaboration.js":[919772,493235],"./sv-se/meeting-flyout.js":[619604,988681],"./sv-se/meeting-meet-app.js":[715044,988681],"./sv-se/meeting-options.js":[352,666073],"./sv-se/meeting-recap.js":[728871,301281],"./sv-se/meeting-room-console.js":[null],"./sv-se/meeting-stream-app.js":[null],"./sv-se/message-escalate-dialog.js":[223203,549087],"./sv-se/messaging.js":[889162,988681],"./sv-se/mobile-attach.js":[null],"./sv-se/mtma-missed-notifications.js":[124078,988681],"./sv-se/nova.js":[80434,988681],"./sv-se/people-app.js":[null],"./sv-se/people-picker.js":[724198,988681],"./sv-se/people-targeting.js":[938185,445270],"./sv-se/people.js":[10696,988681],"./sv-se/person.js":[937123,988681],"./sv-se/phonelink-sms.js":[123775,193209],"./sv-se/pre-core.js":[null],"./sv-se/premium-benefits.js":[824175,852038],"./sv-se/presence.js":[615864,988681],"./sv-se/queues.js":[50114,779458],"./sv-se/recurrence.js":[828493,890565],"./sv-se/rsc-application-permissions.js":[null],"./sv-se/search.js":[83607,146981],"./sv-se/semantic-object.js":[473151,246462],"./sv-se/settings.js":[962806,988681],"./sv-se/share-in-meetings.js":[null],"./sv-se/share-to-teams-outlook-addin.js":[null],"./sv-se/share-to-teams-third-party.js":[null],"./sv-se/share-to-teams.js":[670219,840879],"./sv-se/shortcut.js":[143779,988681],"./sv-se/shortcuts.js":[479870,988681],"./sv-se/simple-collab.js":[675354,988681],"./sv-se/smart-device.js":[null],"./sv-se/survey.js":[465444,807205],"./sv-se/sv-flyout.js":[105210,988681],"./sv-se/teams-and-channels.js":[682173,283400],"./sv-se/teams-insider.js":[52624,988681],"./sv-se/telemetry.js":[808041,988681],"./sv-se/tfl-homepage.js":[557369,988681],"./sv-se/tfl-onboarding.js":[402517,988681],"./sv-se/toast-notifications.js":[954843,988681],"./sv-se/trusted-ui.js":[null],"./sv-se/unified-search.js":[424957,840879],"./sv-se/unsupported-browser.js":[null],"./sv-se/url-preview.js":[771259,988681],"./sv-se/video-capture.js":[841305,473432],"./sv-se/video-message.js":[597550,609679],"./sv-se/virtual-consumer-events.js":[583255,858608],"./sv-se/virtual-events.js":[733636,431304],"./sv-se/webinar.js":[386673,596836],"./sv-se/welcome-bot.js":[null],"./sv-se/whats-new.js":[505342,988681],"./sv-se/wiki.js":[null],"./th-th/activity.js":[652026,876240],"./th-th/artifacts-platform.js":[548027,784434],"./th-th/audience-view-dialog.js":[34178,267989],"./th-th/auth.js":[618711,876240],"./th-th/autosuggest.js":[172200,876240],"./th-th/avatar.js":[236175,876240],"./th-th/biometric-enrollment.js":[189018,66736],"./th-th/breakout-rooms.js":[944235,134403],"./th-th/broadcast.js":[706426,123493],"./th-th/calendar.js":[802119,648451],"./th-th/calling.js":[578920,331963],"./th-th/campaign-notifications.js":[28586,876240],"./th-th/carousel-multi-card.js":[null],"./th-th/cast.js":[510733,876240],"./th-th/channels.js":[645252,876240],"./th-th/chat-list.js":[566880,876240],"./th-th/coach-report.js":[887152,287036],"./th-th/comment-stream.js":[797926,204739],"./th-th/communities.js":[29388,876240],"./th-th/compose.js":[883654,876240],"./th-th/contacts.js":[224156,876240],"./th-th/datepicker.js":[956180,985550],"./th-th/desktop.js":[null],"./th-th/digital-signage.js":[null],"./th-th/discover-surface.js":[566306,422410],"./th-th/edu.js":[488113,688387],"./th-th/embed.js":[929330,876240],"./th-th/errors.js":[804165,876240],"./th-th/esp.js":[748737,537965],"./th-th/extensibility-ptz-extension.js":[null],"./th-th/extensibility-room-remote.js":[null],"./th-th/extensibility.js":[149772,876240],"./th-th/feedback.js":[698462,951678],"./th-th/files.js":[4008,876240],"./th-th/framework.js":[523631,876240],"./th-th/freemium-upgrade.js":[null],"./th-th/funstuff.js":[688322,20633],"./th-th/gallery.js":[103207,160713],"./th-th/growth.js":[647164,876240],"./th-th/guardians.js":[424362,285503],"./th-th/health.js":[131219,264992],"./th-th/help.js":[null],"./th-th/hololens.js":[274414,331963],"./th-th/host-controls.js":[955423,982404],"./th-th/jana.js":[408559,754105],"./th-th/lightbox.js":[767564,876240],"./th-th/live-persona-card.js":[649431,876240],"./th-th/live-persona-editor.js":[143106,781556],"./th-th/lms-integration.js":[null],"./th-th/meet-for-work.js":[350587,971592],"./th-th/meeting-analytics.js":[420284,342182],"./th-th/meeting-apis-app.js":[null],"./th-th/meeting-bot.js":[null],"./th-th/meeting-collaboration.js":[637124,709267],"./th-th/meeting-flyout.js":[32879,876240],"./th-th/meeting-meet-app.js":[53570,876240],"./th-th/meeting-options.js":[386194,795571],"./th-th/meeting-recap.js":[447672,562929],"./th-th/meeting-room-console.js":[null],"./th-th/meeting-stream-app.js":[null],"./th-th/message-escalate-dialog.js":[808708,725606],"./th-th/messaging.js":[139743,876240],"./th-th/mobile-attach.js":[null],"./th-th/mtma-missed-notifications.js":[938992,876240],"./th-th/nova.js":[942201,876240],"./th-th/people-app.js":[null],"./th-th/people-picker.js":[129986,876240],"./th-th/people-targeting.js":[334433,834379],"./th-th/people.js":[340341,876240],"./th-th/person.js":[614603,876240],"./th-th/phonelink-sms.js":[109801,738703],"./th-th/pre-core.js":[null],"./th-th/premium-benefits.js":[991735,835429],"./th-th/presence.js":[757463,876240],"./th-th/queues.js":[527796,186677],"./th-th/recurrence.js":[896828,896650],"./th-th/rsc-application-permissions.js":[null],"./th-th/search.js":[272657,985550],"./th-th/semantic-object.js":[128170,264403],"./th-th/settings.js":[237495,876240],"./th-th/share-in-meetings.js":[null],"./th-th/share-to-teams-outlook-addin.js":[null],"./th-th/share-to-teams-third-party.js":[null],"./th-th/share-to-teams.js":[733234,13752],"./th-th/shortcut.js":[86233,876240],"./th-th/shortcuts.js":[732950,876240],"./th-th/simple-collab.js":[914779,876240],"./th-th/smart-device.js":[null],"./th-th/survey.js":[222671,880956],"./th-th/sv-flyout.js":[941072,876240],"./th-th/teams-and-channels.js":[773966,730783],"./th-th/teams-insider.js":[64889,876240],"./th-th/telemetry.js":[346712,876240],"./th-th/tfl-homepage.js":[739538,876240],"./th-th/tfl-onboarding.js":[635914,876240],"./th-th/toast-notifications.js":[296657,876240],"./th-th/trusted-ui.js":[null],"./th-th/unified-search.js":[132052,13752],"./th-th/unsupported-browser.js":[null],"./th-th/url-preview.js":[755499,876240],"./th-th/video-capture.js":[727971,260744],"./th-th/video-message.js":[489088,26444],"./th-th/virtual-consumer-events.js":[587408,942765],"./th-th/virtual-events.js":[179899,862136],"./th-th/webinar.js":[861e3,710728],"./th-th/welcome-bot.js":[null],"./th-th/whats-new.js":[862944,876240],"./th-th/wiki.js":[null],"./tr-tr/activity.js":[646039,792574],"./tr-tr/artifacts-platform.js":[790394,244480],"./tr-tr/audience-view-dialog.js":[31296,231353],"./tr-tr/auth.js":[810341,792574],"./tr-tr/autosuggest.js":[1011,792574],"./tr-tr/avatar.js":[615204,792574],"./tr-tr/biometric-enrollment.js":[801094,435392],"./tr-tr/breakout-rooms.js":[626132,517097],"./tr-tr/broadcast.js":[231259,994411],"./tr-tr/calendar.js":[962472,978641],"./tr-tr/calling.js":[655526,933611],"./tr-tr/campaign-notifications.js":[448576,792574],"./tr-tr/carousel-multi-card.js":[null],"./tr-tr/cast.js":[298701,792574],"./tr-tr/channels.js":[310152,792574],"./tr-tr/chat-list.js":[264765,792574],"./tr-tr/coach-report.js":[990463,147112],"./tr-tr/comment-stream.js":[570731,867236],"./tr-tr/communities.js":[896467,792574],"./tr-tr/compose.js":[507535,792574],"./tr-tr/contacts.js":[774813,792574],"./tr-tr/datepicker.js":[684477,37514],"./tr-tr/desktop.js":[null],"./tr-tr/digital-signage.js":[null],"./tr-tr/discover-surface.js":[128858,246515],"./tr-tr/edu.js":[220057,42926],"./tr-tr/embed.js":[750966,792574],"./tr-tr/errors.js":[420825,792574],"./tr-tr/esp.js":[869045,828862],"./tr-tr/extensibility-ptz-extension.js":[null],"./tr-tr/extensibility-room-remote.js":[null],"./tr-tr/extensibility.js":[945022,792574],"./tr-tr/feedback.js":[302755,518689],"./tr-tr/files.js":[218560,792574],"./tr-tr/framework.js":[952269,792574],"./tr-tr/freemium-upgrade.js":[null],"./tr-tr/funstuff.js":[161294,791444],"./tr-tr/gallery.js":[140926,135821],"./tr-tr/growth.js":[94638,792574],"./tr-tr/guardians.js":[958927,576118],"./tr-tr/health.js":[942495,256992],"./tr-tr/help.js":[null],"./tr-tr/hololens.js":[17003,933611],"./tr-tr/host-controls.js":[392607,529165],"./tr-tr/jana.js":[831681,638001],"./tr-tr/lightbox.js":[142517,792574],"./tr-tr/live-persona-card.js":[978433,792574],"./tr-tr/live-persona-editor.js":[279274,970470],"./tr-tr/lms-integration.js":[null],"./tr-tr/meet-for-work.js":[949107,642768],"./tr-tr/meeting-analytics.js":[218178,66235],"./tr-tr/meeting-apis-app.js":[null],"./tr-tr/meeting-bot.js":[null],"./tr-tr/meeting-collaboration.js":[160841,638707],"./tr-tr/meeting-flyout.js":[806427,792574],"./tr-tr/meeting-meet-app.js":[108922,792574],"./tr-tr/meeting-options.js":[145723,542944],"./tr-tr/meeting-recap.js":[121724,530977],"./tr-tr/meeting-room-console.js":[null],"./tr-tr/meeting-stream-app.js":[null],"./tr-tr/message-escalate-dialog.js":[762739,307124],"./tr-tr/messaging.js":[938294,792574],"./tr-tr/mobile-attach.js":[null],"./tr-tr/mtma-missed-notifications.js":[575669,792574],"./tr-tr/nova.js":[125223,792574],"./tr-tr/people-app.js":[null],"./tr-tr/people-picker.js":[723176,792574],"./tr-tr/people-targeting.js":[652842,757721],"./tr-tr/people.js":[401389,792574],"./tr-tr/person.js":[953821,792574],"./tr-tr/phonelink-sms.js":[847691,766814],"./tr-tr/pre-core.js":[null],"./tr-tr/premium-benefits.js":[169167,819091],"./tr-tr/presence.js":[951813,792574],"./tr-tr/queues.js":[181728,761949],"./tr-tr/recurrence.js":[267978,424665],"./tr-tr/rsc-application-permissions.js":[null],"./tr-tr/search.js":[544725,37514],"./tr-tr/semantic-object.js":[984903,859746],"./tr-tr/settings.js":[396219,792574],"./tr-tr/share-in-meetings.js":[null],"./tr-tr/share-to-teams-outlook-addin.js":[null],"./tr-tr/share-to-teams-third-party.js":[null],"./tr-tr/share-to-teams.js":[220280,370881],"./tr-tr/shortcut.js":[787468,792574],"./tr-tr/shortcuts.js":[466713,792574],"./tr-tr/simple-collab.js":[983527,792574],"./tr-tr/smart-device.js":[null],"./tr-tr/survey.js":[35707,350439],"./tr-tr/sv-flyout.js":[73704,792574],"./tr-tr/teams-and-channels.js":[887059,962139],"./tr-tr/teams-insider.js":[387249,792574],"./tr-tr/telemetry.js":[565841,792574],"./tr-tr/tfl-homepage.js":[785954,792574],"./tr-tr/tfl-onboarding.js":[732349,792574],"./tr-tr/toast-notifications.js":[619078,792574],"./tr-tr/trusted-ui.js":[null],"./tr-tr/unified-search.js":[229654,370881],"./tr-tr/unsupported-browser.js":[null],"./tr-tr/url-preview.js":[814332,792574],"./tr-tr/video-capture.js":[911505,332653],"./tr-tr/video-message.js":[594144,569790],"./tr-tr/virtual-consumer-events.js":[373366,66832],"./tr-tr/virtual-events.js":[169878,694535],"./tr-tr/webinar.js":[916198,644386],"./tr-tr/welcome-bot.js":[null],"./tr-tr/whats-new.js":[596547,792574],"./tr-tr/wiki.js":[null],"./uk-ua/activity.js":[731419,664618],"./uk-ua/artifacts-platform.js":[775929,602936],"./uk-ua/audience-view-dialog.js":[603067,615837],"./uk-ua/auth.js":[346610,664618],"./uk-ua/autosuggest.js":[341596,664618],"./uk-ua/avatar.js":[229230,664618],"./uk-ua/biometric-enrollment.js":[129867,534250],"./uk-ua/breakout-rooms.js":[783613,477270],"./uk-ua/broadcast.js":[543266,942239],"./uk-ua/calendar.js":[503762,488458],"./uk-ua/calling.js":[223720,442558],"./uk-ua/campaign-notifications.js":[827745,664618],"./uk-ua/carousel-multi-card.js":[null],"./uk-ua/cast.js":[773628,664618],"./uk-ua/channels.js":[851403,664618],"./uk-ua/chat-list.js":[763488,664618],"./uk-ua/coach-report.js":[25134,604184],"./uk-ua/comment-stream.js":[630042,196919],"./uk-ua/communities.js":[50605,664618],"./uk-ua/compose.js":[465639,664618],"./uk-ua/contacts.js":[656535,664618],"./uk-ua/datepicker.js":[225443,123025],"./uk-ua/desktop.js":[null],"./uk-ua/digital-signage.js":[null],"./uk-ua/discover-surface.js":[348051,845241],"./uk-ua/edu.js":[175553,668431],"./uk-ua/embed.js":[79946,664618],"./uk-ua/errors.js":[788553,664618],"./uk-ua/esp.js":[958789,722064],"./uk-ua/extensibility-ptz-extension.js":[null],"./uk-ua/extensibility-room-remote.js":[null],"./uk-ua/extensibility.js":[473901,664618],"./uk-ua/feedback.js":[983525,153351],"./uk-ua/files.js":[882483,664618],"./uk-ua/framework.js":[613932,664618],"./uk-ua/freemium-upgrade.js":[null],"./uk-ua/funstuff.js":[862529,523383],"./uk-ua/gallery.js":[63761,520741],"./uk-ua/growth.js":[776537,664618],"./uk-ua/guardians.js":[555240,959930],"./uk-ua/health.js":[869251,10186],"./uk-ua/help.js":[null],"./uk-ua/hololens.js":[951854,442558],"./uk-ua/host-controls.js":[111785,297062],"./uk-ua/jana.js":[39400,624954],"./uk-ua/lightbox.js":[379117,664618],"./uk-ua/live-persona-card.js":[300715,664618],"./uk-ua/live-persona-editor.js":[109437,81318],"./uk-ua/lms-integration.js":[null],"./uk-ua/meet-for-work.js":[124090,608094],"./uk-ua/meeting-analytics.js":[673591,874906],"./uk-ua/meeting-apis-app.js":[null],"./uk-ua/meeting-bot.js":[null],"./uk-ua/meeting-collaboration.js":[824858,691913],"./uk-ua/meeting-flyout.js":[111983,664618],"./uk-ua/meeting-meet-app.js":[629005,664618],"./uk-ua/meeting-options.js":[9964,690166],"./uk-ua/meeting-recap.js":[883780,230100],"./uk-ua/meeting-room-console.js":[null],"./uk-ua/meeting-stream-app.js":[null],"./uk-ua/message-escalate-dialog.js":[406593,251181],"./uk-ua/messaging.js":[651010,664618],"./uk-ua/mobile-attach.js":[null],"./uk-ua/mtma-missed-notifications.js":[366969,664618],"./uk-ua/nova.js":[8934,664618],"./uk-ua/people-app.js":[null],"./uk-ua/people-picker.js":[155837,664618],"./uk-ua/people-targeting.js":[48988,403979],"./uk-ua/people.js":[1187,664618],"./uk-ua/person.js":[370159,664618],"./uk-ua/phonelink-sms.js":[400510,693802],"./uk-ua/pre-core.js":[null],"./uk-ua/premium-benefits.js":[821753,364984],"./uk-ua/presence.js":[216936,664618],"./uk-ua/queues.js":[711394,135977],"./uk-ua/recurrence.js":[518742,576807],"./uk-ua/rsc-application-permissions.js":[null],"./uk-ua/search.js":[303876,123025],"./uk-ua/semantic-object.js":[803810,280699],"./uk-ua/settings.js":[666072,664618],"./uk-ua/share-in-meetings.js":[null],"./uk-ua/share-to-teams-outlook-addin.js":[null],"./uk-ua/share-to-teams-third-party.js":[null],"./uk-ua/share-to-teams.js":[18758,891643],"./uk-ua/shortcut.js":[376330,664618],"./uk-ua/shortcuts.js":[252298,664618],"./uk-ua/simple-collab.js":[680954,664618],"./uk-ua/smart-device.js":[null],"./uk-ua/survey.js":[855305,595121],"./uk-ua/sv-flyout.js":[486562,664618],"./uk-ua/teams-and-channels.js":[446784,416918],"./uk-ua/teams-insider.js":[811210,664618],"./uk-ua/telemetry.js":[744234,664618],"./uk-ua/tfl-homepage.js":[592125,664618],"./uk-ua/tfl-onboarding.js":[735547,664618],"./uk-ua/toast-notifications.js":[779729,664618],"./uk-ua/trusted-ui.js":[null],"./uk-ua/unified-search.js":[244115,891643],"./uk-ua/unsupported-browser.js":[null],"./uk-ua/url-preview.js":[240361,664618],"./uk-ua/video-capture.js":[374562,536416],"./uk-ua/video-message.js":[729690,371761],"./uk-ua/virtual-consumer-events.js":[593827,20974],"./uk-ua/virtual-events.js":[294069,100834],"./uk-ua/webinar.js":[999832,137378],"./uk-ua/welcome-bot.js":[null],"./uk-ua/whats-new.js":[424867,664618],"./uk-ua/wiki.js":[null],"./vi-vn/activity.js":[742189,569545],"./vi-vn/artifacts-platform.js":[945449,150013],"./vi-vn/audience-view-dialog.js":[606347,810146],"./vi-vn/auth.js":[748300,569545],"./vi-vn/autosuggest.js":[961763,569545],"./vi-vn/avatar.js":[185937,569545],"./vi-vn/biometric-enrollment.js":[16008,854515],"./vi-vn/breakout-rooms.js":[234104,493937],"./vi-vn/broadcast.js":[160050,525110],"./vi-vn/calendar.js":[679304,810284],"./vi-vn/calling.js":[474946,405750],"./vi-vn/campaign-notifications.js":[215154,569545],"./vi-vn/carousel-multi-card.js":[null],"./vi-vn/cast.js":[697324,569545],"./vi-vn/channels.js":[731841,569545],"./vi-vn/chat-list.js":[708717,569545],"./vi-vn/coach-report.js":[445206,942941],"./vi-vn/comment-stream.js":[303975,585776],"./vi-vn/communities.js":[984559,569545],"./vi-vn/compose.js":[353838,569545],"./vi-vn/contacts.js":[262866,569545],"./vi-vn/datepicker.js":[64963,823065],"./vi-vn/desktop.js":[null],"./vi-vn/digital-signage.js":[null],"./vi-vn/discover-surface.js":[42766,556923],"./vi-vn/edu.js":[999803,573266],"./vi-vn/embed.js":[389597,569545],"./vi-vn/errors.js":[585634,569545],"./vi-vn/esp.js":[622426,546584],"./vi-vn/extensibility-ptz-extension.js":[null],"./vi-vn/extensibility-room-remote.js":[null],"./vi-vn/extensibility.js":[461588,569545],"./vi-vn/feedback.js":[647386,220211],"./vi-vn/files.js":[293521,569545],"./vi-vn/framework.js":[350930,569545],"./vi-vn/freemium-upgrade.js":[null],"./vi-vn/funstuff.js":[452065,881647],"./vi-vn/gallery.js":[953437,279957],"./vi-vn/growth.js":[786997,569545],"./vi-vn/guardians.js":[14011,500397],"./vi-vn/health.js":[289923,496968],"./vi-vn/help.js":[null],"./vi-vn/hololens.js":[295299,405750],"./vi-vn/host-controls.js":[966642,531539],"./vi-vn/jana.js":[829497,550985],"./vi-vn/lightbox.js":[689403,569545],"./vi-vn/live-persona-card.js":[737915,569545],"./vi-vn/live-persona-editor.js":[623646,153338],"./vi-vn/lms-integration.js":[null],"./vi-vn/meet-for-work.js":[276010,547869],"./vi-vn/meeting-analytics.js":[843877,929813],"./vi-vn/meeting-apis-app.js":[null],"./vi-vn/meeting-bot.js":[null],"./vi-vn/meeting-collaboration.js":[555645,718031],"./vi-vn/meeting-flyout.js":[357046,569545],"./vi-vn/meeting-meet-app.js":[42250,569545],"./vi-vn/meeting-options.js":[205063,768935],"./vi-vn/meeting-recap.js":[786472,701753],"./vi-vn/meeting-room-console.js":[null],"./vi-vn/meeting-stream-app.js":[null],"./vi-vn/message-escalate-dialog.js":[187170,189560],"./vi-vn/messaging.js":[843458,569545],"./vi-vn/mobile-attach.js":[null],"./vi-vn/mtma-missed-notifications.js":[461476,569545],"./vi-vn/nova.js":[450091,569545],"./vi-vn/people-app.js":[null],"./vi-vn/people-picker.js":[696589,569545],"./vi-vn/people-targeting.js":[796927,156652],"./vi-vn/people.js":[458234,569545],"./vi-vn/person.js":[604072,569545],"./vi-vn/phonelink-sms.js":[720294,815695],"./vi-vn/pre-core.js":[null],"./vi-vn/premium-benefits.js":[103015,189025],"./vi-vn/presence.js":[477589,569545],"./vi-vn/queues.js":[470737,53108],"./vi-vn/recurrence.js":[674312,296387],"./vi-vn/rsc-application-permissions.js":[null],"./vi-vn/search.js":[183911,823065],"./vi-vn/semantic-object.js":[898713,606091],"./vi-vn/settings.js":[832291,569545],"./vi-vn/share-in-meetings.js":[null],"./vi-vn/share-to-teams-outlook-addin.js":[null],"./vi-vn/share-to-teams-third-party.js":[null],"./vi-vn/share-to-teams.js":[681154,84399],"./vi-vn/shortcut.js":[791070,569545],"./vi-vn/shortcuts.js":[286350,569545],"./vi-vn/simple-collab.js":[190392,569545],"./vi-vn/smart-device.js":[null],"./vi-vn/survey.js":[713806,925442],"./vi-vn/sv-flyout.js":[820377,569545],"./vi-vn/teams-and-channels.js":[892760,709940],"./vi-vn/teams-insider.js":[605171,569545],"./vi-vn/telemetry.js":[403962,569545],"./vi-vn/tfl-homepage.js":[81176,569545],"./vi-vn/tfl-onboarding.js":[35442,569545],"./vi-vn/toast-notifications.js":[682092,569545],"./vi-vn/trusted-ui.js":[null],"./vi-vn/unified-search.js":[694155,84399],"./vi-vn/unsupported-browser.js":[null],"./vi-vn/url-preview.js":[856241,569545],"./vi-vn/video-capture.js":[529188,788582],"./vi-vn/video-message.js":[466538,771326],"./vi-vn/virtual-consumer-events.js":[816007,775377],"./vi-vn/virtual-events.js":[440246,771285],"./vi-vn/webinar.js":[890513,791496],"./vi-vn/welcome-bot.js":[null],"./vi-vn/whats-new.js":[804119,569545],"./vi-vn/wiki.js":[null],"./zh-cn/activity.js":[429266,642742],"./zh-cn/artifacts-platform.js":[773451,624764],"./zh-cn/audience-view-dialog.js":[420528,628746],"./zh-cn/auth.js":[457660,642742],"./zh-cn/autosuggest.js":[822146,642742],"./zh-cn/avatar.js":[886898,642742],"./zh-cn/biometric-enrollment.js":[513806,838355],"./zh-cn/breakout-rooms.js":[379667,422535],"./zh-cn/broadcast.js":[64529,75895],"./zh-cn/calendar.js":[719643,584836],"./zh-cn/calling.js":[716281,630291],"./zh-cn/campaign-notifications.js":[689043,642742],"./zh-cn/carousel-multi-card.js":[null],"./zh-cn/cast.js":[272930,642742],"./zh-cn/channels.js":[670970,642742],"./zh-cn/chat-list.js":[304345,642742],"./zh-cn/coach-report.js":[980488,833477],"./zh-cn/comment-stream.js":[922257,19444],"./zh-cn/communities.js":[633379,642742],"./zh-cn/compose.js":[242487,642742],"./zh-cn/contacts.js":[186146,642742],"./zh-cn/datepicker.js":[169918,831506],"./zh-cn/desktop.js":[null],"./zh-cn/digital-signage.js":[null],"./zh-cn/discover-surface.js":[622829,669891],"./zh-cn/edu.js":[946605,478680],"./zh-cn/embed.js":[667041,642742],"./zh-cn/errors.js":[590016,642742],"./zh-cn/esp.js":[457560,174847],"./zh-cn/extensibility-ptz-extension.js":[null],"./zh-cn/extensibility-room-remote.js":[null],"./zh-cn/extensibility.js":[958025,642742],"./zh-cn/feedback.js":[765025,553067],"./zh-cn/files.js":[441773,642742],"./zh-cn/framework.js":[695029,642742],"./zh-cn/freemium-upgrade.js":[null],"./zh-cn/funstuff.js":[32028,814551],"./zh-cn/gallery.js":[900966,627455],"./zh-cn/growth.js":[146519,642742],"./zh-cn/guardians.js":[662570,660273],"./zh-cn/health.js":[195919,433112],"./zh-cn/help.js":[null],"./zh-cn/hololens.js":[688174,630291],"./zh-cn/host-controls.js":[93716,17021],"./zh-cn/jana.js":[681781,380858],"./zh-cn/lightbox.js":[985381,642742],"./zh-cn/live-persona-card.js":[435788,642742],"./zh-cn/live-persona-editor.js":[681031,528650],"./zh-cn/lms-integration.js":[null],"./zh-cn/meet-for-work.js":[645722,895669],"./zh-cn/meeting-analytics.js":[588370,719109],"./zh-cn/meeting-apis-app.js":[null],"./zh-cn/meeting-bot.js":[null],"./zh-cn/meeting-collaboration.js":[348645,441734],"./zh-cn/meeting-flyout.js":[422752,642742],"./zh-cn/meeting-meet-app.js":[819754,642742],"./zh-cn/meeting-options.js":[290677,327217],"./zh-cn/meeting-recap.js":[501069,432673],"./zh-cn/meeting-room-console.js":[null],"./zh-cn/meeting-stream-app.js":[null],"./zh-cn/message-escalate-dialog.js":[357266,527246],"./zh-cn/messaging.js":[693396,642742],"./zh-cn/mobile-attach.js":[null],"./zh-cn/mtma-missed-notifications.js":[462294,642742],"./zh-cn/nova.js":[90116,642742],"./zh-cn/people-app.js":[null],"./zh-cn/people-picker.js":[910892,642742],"./zh-cn/people-targeting.js":[356579,167008],"./zh-cn/people.js":[40091,642742],"./zh-cn/person.js":[76790,642742],"./zh-cn/phonelink-sms.js":[194952,764099],"./zh-cn/pre-core.js":[null],"./zh-cn/premium-benefits.js":[682267,724989],"./zh-cn/presence.js":[854915,642742],"./zh-cn/queues.js":[756108,579947],"./zh-cn/recurrence.js":[534246,877357],"./zh-cn/rsc-application-permissions.js":[null],"./zh-cn/search.js":[816563,831506],"./zh-cn/semantic-object.js":[796499,707368],"./zh-cn/settings.js":[364637,642742],"./zh-cn/share-in-meetings.js":[null],"./zh-cn/share-to-teams-outlook-addin.js":[null],"./zh-cn/share-to-teams-third-party.js":[null],"./zh-cn/share-to-teams.js":[215069,961038],"./zh-cn/shortcut.js":[874867,642742],"./zh-cn/shortcuts.js":[151106,642742],"./zh-cn/simple-collab.js":[613901,642742],"./zh-cn/smart-device.js":[null],"./zh-cn/survey.js":[767507,734882],"./zh-cn/sv-flyout.js":[554649,642742],"./zh-cn/teams-and-channels.js":[846982,333371],"./zh-cn/teams-insider.js":[368391,642742],"./zh-cn/telemetry.js":[943825,642742],"./zh-cn/tfl-homepage.js":[110233,642742],"./zh-cn/tfl-onboarding.js":[887627,642742],"./zh-cn/toast-notifications.js":[38527,642742],"./zh-cn/trusted-ui.js":[null],"./zh-cn/unified-search.js":[385901,961038],"./zh-cn/unsupported-browser.js":[null],"./zh-cn/url-preview.js":[74485,642742],"./zh-cn/video-capture.js":[554348,411158],"./zh-cn/video-message.js":[252011,161747],"./zh-cn/virtual-consumer-events.js":[149795,253883],"./zh-cn/virtual-events.js":[730877,473985],"./zh-cn/webinar.js":[117122,953154],"./zh-cn/welcome-bot.js":[null],"./zh-cn/whats-new.js":[619011,642742],"./zh-cn/wiki.js":[null],"./zh-tw/activity.js":[453726,335921],"./zh-tw/artifacts-platform.js":[145572,130005],"./zh-tw/audience-view-dialog.js":[904400,499112],"./zh-tw/auth.js":[228907,335921],"./zh-tw/autosuggest.js":[85394,335921],"./zh-tw/avatar.js":[429188,335921],"./zh-tw/biometric-enrollment.js":[605248,863732],"./zh-tw/breakout-rooms.js":[873803,369326],"./zh-tw/broadcast.js":[53403,654761],"./zh-tw/calendar.js":[213374,403461],"./zh-tw/calling.js":[531351,386347],"./zh-tw/campaign-notifications.js":[120677,335921],"./zh-tw/carousel-multi-card.js":[null],"./zh-tw/cast.js":[727508,335921],"./zh-tw/channels.js":[940702,335921],"./zh-tw/chat-list.js":[867761,335921],"./zh-tw/coach-report.js":[76508,840697],"./zh-tw/comment-stream.js":[419709,675749],"./zh-tw/communities.js":[667812,335921],"./zh-tw/compose.js":[550178,335921],"./zh-tw/contacts.js":[426859,335921],"./zh-tw/datepicker.js":[348684,427521],"./zh-tw/desktop.js":[null],"./zh-tw/digital-signage.js":[null],"./zh-tw/discover-surface.js":[843958,385299],"./zh-tw/edu.js":[716469,79240],"./zh-tw/embed.js":[207130,335921],"./zh-tw/errors.js":[220705,335921],"./zh-tw/esp.js":[679569,616045],"./zh-tw/extensibility-ptz-extension.js":[null],"./zh-tw/extensibility-room-remote.js":[null],"./zh-tw/extensibility.js":[192149,335921],"./zh-tw/feedback.js":[8008,280265],"./zh-tw/files.js":[702479,335921],"./zh-tw/framework.js":[713717,335921],"./zh-tw/freemium-upgrade.js":[null],"./zh-tw/funstuff.js":[62451,213480],"./zh-tw/gallery.js":[672091,567103],"./zh-tw/growth.js":[682144,335921],"./zh-tw/guardians.js":[256596,508954],"./zh-tw/health.js":[92329,930217],"./zh-tw/help.js":[null],"./zh-tw/hololens.js":[122119,386347],"./zh-tw/host-controls.js":[635309,888418],"./zh-tw/jana.js":[834945,77867],"./zh-tw/lightbox.js":[118871,335921],"./zh-tw/live-persona-card.js":[176190,335921],"./zh-tw/live-persona-editor.js":[448862,332069],"./zh-tw/lms-integration.js":[null],"./zh-tw/meet-for-work.js":[536318,391139],"./zh-tw/meeting-analytics.js":[141160,783226],"./zh-tw/meeting-apis-app.js":[null],"./zh-tw/meeting-bot.js":[null],"./zh-tw/meeting-collaboration.js":[11128,285815],"./zh-tw/meeting-flyout.js":[188527,335921],"./zh-tw/meeting-meet-app.js":[734778,335921],"./zh-tw/meeting-options.js":[701654,789183],"./zh-tw/meeting-recap.js":[693553,658142],"./zh-tw/meeting-room-console.js":[null],"./zh-tw/meeting-stream-app.js":[null],"./zh-tw/message-escalate-dialog.js":[483566,266613],"./zh-tw/messaging.js":[376764,335921],"./zh-tw/mobile-attach.js":[null],"./zh-tw/mtma-missed-notifications.js":[737382,335921],"./zh-tw/nova.js":[276001,335921],"./zh-tw/people-app.js":[null],"./zh-tw/people-picker.js":[946184,335921],"./zh-tw/people-targeting.js":[769922,878981],"./zh-tw/people.js":[301751,335921],"./zh-tw/person.js":[145237,335921],"./zh-tw/phonelink-sms.js":[14079,69973],"./zh-tw/pre-core.js":[null],"./zh-tw/premium-benefits.js":[107755,364367],"./zh-tw/presence.js":[877945,335921],"./zh-tw/queues.js":[663686,810072],"./zh-tw/recurrence.js":[181825,960988],"./zh-tw/rsc-application-permissions.js":[null],"./zh-tw/search.js":[908461,427521],"./zh-tw/semantic-object.js":[359856,219495],"./zh-tw/settings.js":[526279,335921],"./zh-tw/share-in-meetings.js":[null],"./zh-tw/share-to-teams-outlook-addin.js":[null],"./zh-tw/share-to-teams-third-party.js":[null],"./zh-tw/share-to-teams.js":[547527,581783],"./zh-tw/shortcut.js":[271861,335921],"./zh-tw/shortcuts.js":[161944,335921],"./zh-tw/simple-collab.js":[678081,335921],"./zh-tw/smart-device.js":[null],"./zh-tw/survey.js":[115564,519078],"./zh-tw/sv-flyout.js":[664335,335921],"./zh-tw/teams-and-channels.js":[65512,137025],"./zh-tw/teams-insider.js":[296395,335921],"./zh-tw/telemetry.js":[845113,335921],"./zh-tw/tfl-homepage.js":[777600,335921],"./zh-tw/tfl-onboarding.js":[492598,335921],"./zh-tw/toast-notifications.js":[16986,335921],"./zh-tw/trusted-ui.js":[null],"./zh-tw/unified-search.js":[688295,581783],"./zh-tw/unsupported-browser.js":[null],"./zh-tw/url-preview.js":[329381,335921],"./zh-tw/video-capture.js":[192776,77960],"./zh-tw/video-message.js":[738426,232190],"./zh-tw/virtual-consumer-events.js":[907735,344073],"./zh-tw/virtual-events.js":[729745,700632],"./zh-tw/webinar.js":[854344,165238],"./zh-tw/welcome-bot.js":[null],"./zh-tw/whats-new.js":[450443,335921],"./zh-tw/wiki.js":[null]};function a(e){if(!n.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],a=t[0];return Promise.all(t.slice(1).map(n.e)).then((()=>n(a)))}a.keys=()=>Object.keys(i),a.id=122057,e.exports=a},759455:e=>{"use strict";e.exports=JSON.parse('{"clientId":"4b3e8f46-56d3-427f-b1e2-d239b2ea6bca","basePath":"v2","experienceName":"react-web-client","fallbackLocale":"en-us","webAuth":{"cacheLocation":"localStorage","navigateToLoginRequestUrl":true,"top":{"popUp":false},"iframe":{"redirectPath":"auth"}},"ring":{"id":"ring0"},"cdnVersion":4,"enableDevTools":false,"useReactWebClientCoreTasks":true,"windowType":"ReactWebClient","lpcRegion":"","isLPCEnabled":true,"shouldExecuteDefaultCommand":true,"preloadedI18nNamespaces":["activity","auth","autosuggest","avatar","calendar","calling","channels","chatList","communities","compose","contacts","errors","extensibility","files","framework","gallery","lightbox","livePersonaCard","meetingMeetApp","messaging","mtmaMissedNotifications","nova","people","peoplePicker","premiumBenefits","presence","recurrence","settings","teamsAndChannels","telemetry","toastNotifications","urlPreview","meetingCollaboration"],"partitionCacheByExperience":true,"forceUseBrowserHistory":true,"coreTasksTimeoutMs":300000,"supportsAsyncUserContext":true,"postMessageConfig":[],"enableSupermassive":false,"enableRelay":true}')}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/async-entry-142817b05d21b68f.js.map