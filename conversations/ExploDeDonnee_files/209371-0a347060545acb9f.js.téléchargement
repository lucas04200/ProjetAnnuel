"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[209371],{596358:(e,t,i)=>{i.d(t,{ei:()=>S,Pq:()=>v,PO:()=>k,JW:()=>f,hO:()=>E,D7:()=>I,ox:()=>_,pQ:()=>g,Jj:()=>C});var n=i(12978),a=i(686219),r=i(323356),o=i(737874),s=i(233304),c=i(563726),l=i(543491),d=i(610597);const u=["bd9fb5cb-4d02-4cc6-a7f4-52a8a62d30b7","9d17e873-c4c4-424d-869c-67f62a3d3174","77be3f72-7c14-415f-992c-3511dd54a4ae","66aeee93-507d-479a-a3ef-8f494af43945","62554c36-4756-4d4e-b8fb-f4b24875ae0c","2c95977d-f2fb-4df3-ad70-1aece87afe03","98eb9edc-3b11-4950-8780-c6ec73d71571","98eb9edc-3b11-4950-8780-c6ec73d71572","be9c77ca-202c-4f11-9241-b27afd891781","5a22b425-b693-4f86-b668-31baeb3dad6c","b85718a3-6d15-4f59-8fad-b6809c6fc6a9","2c95977d-f2fb-4df3-ad70-1aece87afe00","2c95977d-f2fb-4df3-ad70-1aece87afe01","2c95977d-f2fb-4df3-ad70-1aece87afe02"],p={qna:"5db56dd0-534d-467b-aeda-d622bee2574a"};var h=i(460026);const m="_djb2_msteams_prefix_",g="tab::",S=2,f=(e,t)=>t?.startsWith(m)?t:`${m}${(0,c.E)(`${e}:${t?.replace(/\+/g," ")}`)}`,v=(e,t,i,o,c,l,d,u,p,h,m)=>({entity:{type:n.py.extensions,id:JSON.stringify({appId:e,tabEntityId:l,subEntityId:u}),action:n.uk.view},command:{visibilityState:d?.visibilityState??a.fe.show,stateTransition:t?a.su.new:d?.stateTransition??a.su.flush,correlation:{source:c??r.D.Unknown,startTimestamp:Date.now()}},entityOptions:{entryPoint:o?s.mQ.activityFeed:s.mQ.personalApp,isMultiWindow:t,subEntityId:u,isAppSelected:p,source:c,originalDeeplink:h||void 0,reloadTrigger:i,isFromActivityFeed:o,skipAppCacheRemoveOnReload:m}}),k=(e,t,i,c,l,d,p,h,m)=>{if(y(t)){const i=b(t,c,l,d,m,e,h);if(i)return i}return{entity:{type:n.py.extensions,id:JSON.stringify({appId:t,threadId:i||c,tabId:null,tabEntityId:f(t,p)}),action:n.uk.view,linkedEntity:{id:i?JSON.stringify({channelId:i}):c,type:i?n.py.channels:n.py.chats,action:n.uk.view}},command:{visibilityState:h?.visibilityState??a.fe.show,stateTransition:h?.stateTransition??a.su.forceFlush,correlation:{source:r.D.PlatformTabDeepLink,startTimestamp:Date.now()}},entityOptions:{entryPoint:i?s.mQ.channelTab:s.mQ.chatTab,source:r.D.PlatformTabDeepLink,subEntityId:m,originalDeeplink:e,isAppTeamLevelApp:u.includes(t),...!!c&&{focusOnLoad:o.t.DoNotMove}}}},_={files:"files",photos:"photos",attendancereport:"attendancereport",recordingsandtranscripts:"recordingsandtranscripts",recap:"recap",breakoutrooms:"breakoutrooms",coachReport:"coachReport",qna:"qna"},y=e=>Object.values(p).includes(e),b=(e,t,i,o,c,l,d)=>((0,h.b4)(i,"Non apps platform tab deeplink handling"),o?.cancel(),e===p.qna?{entity:{type:n.py.yammerqna,id:JSON.stringify({chatId:t,subEntityId:c}),action:n.uk.view,linkedEntity:{action:null,id:t,type:n.py.chats}},command:{visibilityState:d?.visibilityState??a.fe.show,stateTransition:d?.stateTransition??a.su.flow,correlation:{source:r.D.PlatformTabDeepLink,startTimestamp:Date.now()}},entityOptions:{conversationId:t,entryPoint:s.mQ.activityFeed,source:r.D.ActivityFeed,subEntityId:c,originalDeeplink:l}}:null),C=(e,t,i,c,d,u,p,h)=>{p?.findScenario(l.RG.PlatformTabDeeplinkHandling)?.cancel();const m=p?.newScenario(l.RG.PlatformTabDeeplinkHandling);m&&p?.hoistScenarioToCore?.(m),m?.appendEventData({"PlatformTabDeeplink.pathname":i.pathname,"PlatformTabDeeplink.search":i.search}),m?.mark("create_deeplink_command");const g="files"===u,S=(e=>{switch(e){case _.files:return n.py.file;case _.photos:return n.py.gallery;case _.attendancereport:return n.py.meetinganalytics;case _.recordingsandtranscripts:return n.py.transcriptcontent;case _.recap:return n.py.meetingrecap;case _.breakoutrooms:return n.py.breakoutrooms;case _.coachReport:return n.py.coachreport;case _.qna:return n.py.yammerqna;default:return n.py.extensions}})(u),f={entityCommand:{entity:{type:S,action:g?n.uk.list:n.uk.view,id:S===n.py.extensions?JSON.stringify({appId:null,threadId:e||t,tabId:u,tabEntityId:null}):null,linkedEntity:{id:e?JSON.stringify({channelId:e}):t,type:e?n.py.channels:n.py.chats,action:n.uk.view}},command:{stateTransition:h?.stateTransition??a.su.flush,visibilityState:h?.visibilityState??a.fe.show},entityOptions:{subEntityId:d?.subEntityId,entryPoint:e?s.mQ.channelTab:s.mQ.chatTab,source:r.D.PlatformTabDeepLink,deeplinkStartedTime:Date.now(),originalDeeplink:i,...S===n.py.coachreport&&{threadId:t},...!!t&&{focusOnLoad:o.t.DoNotMove}}},metadata:{allowAnonymous:!1,tenantId:c}};return m?.mark("return_deeplink_command"),m?.appendEventData({"PlatformTabDeeplink.generatedCommand":f.toString()}),Promise.resolve(f)},I=(e,t,i)=>{const n=t?.baseInfo?.appId??"",a=t?.baseInfo?.id??"";let r="";return"StaticExtensionTab"!==t?.__typename&&"ExtensionTab"!==t?.__typename||!t?.entityId||(r=t?.entityId),{appId:n,threadId:e,tabId:a,tabEntityId:r,messageId:(0,d.eA)(i)?i:void 0}},E=(e,t,i,n,a)=>{const r=t?.baseInfo?.appId??"",o=t?.baseInfo?.id??"";let s="";return"StaticExtensionTab"!==t?.__typename&&"ExtensionTab"!==t?.__typename||!t?.entityId||(s=t?.entityId),n&&a?JSON.stringify(((e,t,i,n,a)=>{const r=("ExtensionTab"===e?.__typename||"StaticExtensionTab"===e?.__typename)&&e?.entityId||null,o=r?`_djb2_msteams_prefix_${(0,c.E)(`${n?e?.baseInfo?.externalAppId:e?.baseInfo?.appId}:${r?.replace(/\+/g," ")}`)}`:null;return i?{appId:r?n?e?.baseInfo?.externalAppId:e?.baseInfo?.appId:null,threadId:t,tabId:r?null:e?.baseInfo?.id,tabEntityId:o,messageId:(0,d.eA)(a)?a:void 0}:{appId:e.baseInfo.appId,threadId:t,tabId:e.baseInfo.id,tabEntityId:r,messageId:(0,d.eA)(a)?a:void 0}})(t,e,n,void 0,i)):JSON.stringify({appId:r,threadId:e,tabId:o,tabEntityId:s,messageId:(0,d.eA)(i)?i:void 0})}},965517:(e,t,i)=>{var n,a,r,o,s;i.d(t,{hO:()=>n,Zw:()=>a,in:()=>r,s_:()=>o,O_:()=>s,e0:()=>c}),function(e){e.POP="pop",e.BEARER="Bearer"}(n||(n={})),function(e){e[e.Skype=0]="Skype",e[e.AAD=1]="AAD",e[e.CAE=2]="CAE"}(a||(a={})),function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Info=2]="Info",e[e.Verbose=3]="Verbose"}(r||(r={})),function(e){e.ag08="ag08",e.ag09="ag09",e.dod="dod",e.gcc="gcc",e.gcchigh="gcchigh",e.life="life",e.prod="prod"}(o||(o={})),function(e){e.LOKI_TFL_AUTH_TOKEN_AUDIENCE="liveprofilecard.access",e.MT="https://api.spaces.skype.com",e.GROUPS_SERVICE="https://groupssvc.fl.teams.microsoft.com/teams.readwrite",e.UNIFIED_CONSENT_WEB_AUTH_URL="https://consentservice.microsoft.com/web/UnifiedUserConsent.ReadWrite",e.UNIFIED_CONSENT_CHECKIN_AUTH_URL="https://consentservice.microsoft.com/checkin/UnifiedUserConsent.Read",e.CSA_PHONELINK_AUTH_URL="https://chatsvcagg-tfl.teams.microsoft.com/user_impersonation",e.FORMS_AUTH_URL="MicrosoftForms.ReadWrite",e.SEARCH_SERVICE_AUTH_RESOURCE="https://searchsvc.fl.teams.microsoft.com/teams.search.readwrite"}(s||(s={}));const c="9188040d-6c67-4c5b-b112-36a304b66dad"},605882:(e,t,i)=>{var n;i.d(t,{x:()=>n}),function(e){e.Perf="perf",e.Scenario="scenarions",e.Logging="loggingns",e.Heartbeat="heartbeatns",e.Http="httpns",e.UserBI="userbins",e.Endpoint="endpointns",e.ClickStream="clickstreamns"}(n||(n={}))},131476:(e,t,i)=>{i.d(t,{ip:()=>d,Yx:()=>u,MI:()=>p,P3:()=>h,aA:()=>m,Rr:()=>g});var n=i(112589),a=i(849803),r=i(736149),o=i(605882),s=i(573571),c=i(37718);const l="heartbeat";class d{constructor(e){this.initialized=!1,this.logger=r.h.default,this.eventDecoratorCallbacks=[],this.flush=()=>this.telemetryProvider.flush(),this.telemetryProvider=e??(0,n.Yf)(),(0,a.Y)((()=>{this.initialized=!1,this.eventDecoratorCallbacks=[]}))}get sessionId(){return this.telemetryProvider.sessionId}initialize(e,t=r.h.default){this.initialized||(this.consoleLogger=e,this.consoleLogger.debug("TelemetrySender initialized."),this.logger=t,this.initialized=!0)}static getInstance(){return this.telemetrySender||(this.telemetrySender=new d),this.telemetrySender}registerEventDecorator(e){this.eventDecoratorCallbacks.push(e)}sendTelemetry(e,t,i={},n,a,r,l=""){if(!this.initialized)return;t=t.replace(/\-/g,"_").toLowerCase();const d=e===o.x.Http?i.resultCode:e===o.x.Endpoint&&i.result&&c.qb[i.result]?c.qb[i.result].toString():e===o.x.Endpoint&&i.hasInnerError?"fail":"success",u=s.H.getInstance().getSampleRate(e,r??t,d);if(u===s.k)return;this.decorateEvent(t,i);const p=this.telemetryProvider.createEvent(e,t,i,n,a,r);p.setProperty("sampleRate",u),this.telemetryProvider.logEvent(this.logger,p,l)}sendScenarioEvent(e,t,i,n,a,r=""){if(!this.initialized)return;const c=e.replace(/\-/g,"_"),l=o.x.Scenario;let d=s.H.getInstance().getSampleRate(l,c,i["Scenario.Status"]);if("Scenario.CrossClientMode"in t&&(d=s.H.getInstance().getCrossClientScenarioSampleRate(i["Scenario.Mode"])??d),d===s.k)return;this.decorateEvent(c,t);const u={...i,...t},p=this.telemetryProvider.createEvent(l,e,u,n,a);p.setProperty("sampleRate",d),this.telemetryProvider.logEvent(this.logger,p,r)}sendHeartbeatEvent(e){if(!this.initialized)return;const t=o.x.Heartbeat;this.decorateEvent(l,e);const i=this.telemetryProvider.createEvent(t,l,e);this.telemetryProvider.logEvent(this.logger,i,void 0)}sendLoggingEvent(e,t,i,n,a,r){if(!this.initialized)return;const c=o.x.Logging,l=s.H.getInstance().getSampleRate(c,i,t.logLevel);if(l===s.k)return;e=e.replace(/\-/g,"_").toLowerCase(),this.decorateEvent(e,t);const d=this.telemetryProvider.createEvent(c,e,t,a,r,i);d.setProperty("sampleRate",l),this.telemetryProvider.logEvent(this.logger,d,n)}decorateEvent(e,t){this.eventDecoratorCallbacks.forEach((i=>i(e,t)))}}function u(e,t,i,n,a,r=""){d.getInstance().sendScenarioEvent(e,t,i,n,a,r)}function p(e,t,i,n,a,r=""){d.getInstance().sendLoggingEvent(e,t,i,r,n,a)}function h(e,t,i,n,a,r,o=""){d.getInstance().sendTelemetry(e,t,i,n,a,r,o)}function m(e){d.getInstance().sendHeartbeatEvent(e)}function g(e){d.getInstance().registerEventDecorator(e)}},217515:(e,t,i)=>{var n;i.d(t,{K:()=>C}),function(e){e.p720="720p",e.p1080="1080p",e.p2k="2k",e.p4k="4k",e.unkown="unkown"}(n||(n={}));const a=2073600,r=3686400,o=8294400;async function s(e){const t={Perf_Screen:void 0};let i;const s=e.screen.availWidth*e.screen?.availHeight;return i=s<a?n.p720:s>=a&&s<r?n.p1080:s>=r&&s<o?n.p2k:s>=o?n.p4k:n.unkown,t.Perf_Screen={width:e.screen?.availWidth,height:e.screen?.availHeight,resolution:i,dpr:e.devicePixelRatio},Promise.resolve(t)}var c=i(726175),l=i(683184),d=i(689626),u=i(131476),p=i(840633),h=i(471323),m=i(949967),g=i(803238);class S{constructor(e,t,i){this.hostCommunicationService=t,this.trackAppCountOnly=i,this.uuidToAppIdMap={},this.cmsObjects=[],this.logger=e.newLogger("PlatformAppsManagementService","core-services-telemetry")}getTelemetry(e){return this.getPlatformAppsStats(e)}async getAppsPerfMetrics(){if(this.hostCommunicationService){const e=await(0,h.K)(this.hostCommunicationService,this.logger,!0);return this.getPlatformAppsStats(e,!0)}}addCacheManagementService(e){return this.cmsObjects.find((t=>t===e))?(this.logger.errorToTelemetry?.("addCacheManagementService: cms exists in appManagementService","platform_app_caching_cms_exists_in_app_management_service",void 0,!0),!1):(this.cmsObjects.push(e),!0)}removeCacheManagementService(e){return this.cmsObjects.splice(this.cmsObjects.indexOf(e),1),!0}addApp(e,t,i){return this.uuidToAppIdMap.hasOwnProperty(e)?(this.logger.errorToTelemetry?.("addApp: App exists in appManagementService","platform_app_exists_in_app_management_service",{"App.Id":t},!0),!1):(this.uuidToAppIdMap[e]={appId:t,managedByCache:i},!0)}removeApp(e){return this.uuidToAppIdMap[e]?(delete this.uuidToAppIdMap[e],!0):(this.logger.errorToTelemetry?.("removeApp: App is not in uuid map","platform_app_missing_in_uuid_map",void 0,!0),!1)}removeLeastRecentlyUsedApp(e){if(this.isInCacheStabilizationPeriod())return void this.logger.log("removeLeastRecentlyUsedApp skipped due to stabilization period");let t;for(const e of this.cmsObjects){const i=e.getLeastRecentlyUsedApp();i&&(i.uuid&&i.timeInCache&&(void 0===t||i.timeInCache<t.timeInCache)&&(t={frameUuid:i.uuid,cmsObject:e,timeInCache:i.timeInCache}))}if(t?.frameUuid){const i=this.uuidToAppIdMap[t.frameUuid];i?.appId&&t.cmsObject.removeByAms(i?.appId,e)}}isInCacheStabilizationPeriod(){return this.cmsObjects.some((e=>e.isInCacheStabilizationPeriod()))}findProcessInfo(e,t){if(!t)return;const i=e.processes.find((e=>e.processId===t));return i?{workingSetSize:i.workingSetSizeKB,commitSize:i.commitSizeKB,cpuCycleTime:i.cpuCycleTime}:void 0}computeSizeOfFrames(e){const{memoryMetrics:t,processVisitedMap:i,isActiveApp:n,appsStats:a,perAppData:r,frames:o,treeLevel:s}=e;for(const c of o){c.platformFrameUuid&&(n?a.activeAppsCount+=1:a.cachedAppsCount+=1);const o=this.findProcessInfo(t,c.processId);if(!o)return;const l=o.workingSetSize||0,d=o.commitSize||0;c.processId&&!i[c.processId]&&(i[c.processId]=c,this.addAppStatsInfo(n,l,d,a)),r.totalWorkingSetSizeKB+=l,r.totalCommitSizeKB+=d,r.maxCpuCycleTime=Math.max(r.maxCpuCycleTime,o.cpuCycleTime),r.frameInfo.push({processId:c.processId,workingSetSizeKB:o.workingSetSize,cpuCycleTime:o.cpuCycleTime,treeLevel:s}),this.computeSizeOfFrames({...e,frames:c.frames,treeLevel:s+1})}}isActiveApp(e){let t=!1;for(const i of this.cmsObjects){const n=i.isAppCached(e);if(void 0!==n&&(t=!n,t))break}return t}getPlatformAppsStats(e,t){const i={activeWorkingSetSizeKB:0,cachedWorkingSetSizeKB:0,activeCommitSizeKB:0,cachedCommitSizeKB:0,activeAppsCount:0,cachedAppsCount:0,appsPlatformStats:[]},n={windows:e.windows,processVisitedMap:{},memoryMetrics:e,appsStats:i,includeFrameUuid:t};if(this.trackAppCountOnly){const{cachedAppsCount:e,activeAppsCount:t}=this.processCachedAppCount();return{...i,cachedAppsCount:e,activeAppsCount:t}}return this.processMemoryInformation({...n,computeActiveApps:!0}),this.processMemoryInformation({...n,computeActiveApps:!1}),i}addAppStatsInfo(e,t,i,n){e?(n.activeWorkingSetSizeKB+=t,n.activeCommitSizeKB+=i):(n.cachedWorkingSetSizeKB+=t,n.cachedCommitSizeKB+=i)}processCachedAppCount(){let e=0,t=0;const i=Object.keys(this.uuidToAppIdMap);for(const n of i){const i=this.uuidToAppIdMap[n];!i?.managedByCache||this.isActiveApp(n)?e+=1:t+=1}return{cachedAppsCount:t,activeAppsCount:e}}processMemoryInformation(e){const{windows:t,computeActiveApps:i,appsStats:n,memoryMetrics:a,processVisitedMap:r,includeFrameUuid:o}=e;for(const e of t)for(const t of e.frames){if(!t.platformFrameUuid)continue;const s=this.uuidToAppIdMap[t.platformFrameUuid],c=!s?.managedByCache||this.isActiveApp(t.platformFrameUuid);if(c===!i)continue;const l={windowId:e.windowId,isCached:!c,totalWorkingSetSizeKB:0,totalCommitSizeKB:0,maxCpuCycleTime:0,frameInfo:[],appId:s?.appId??"",platformFrameUuid:o?t.platformFrameUuid:void 0};this.computeSizeOfFrames({frames:[t],appsStats:n,memoryMetrics:a,perAppData:l,isActiveApp:c,processVisitedMap:r,treeLevel:0}),n.appsPlatformStats.push(l)}}}var f=i(742286),v=i(773427);class k{constructor(e,t,i){this.leakDetectorService=t,this.fallbackHost=i,this.logger=e.newLogger("StyleMetricsService","core-services-telemetry"),this.currentStyles=this.getCurrentStyles()}getTelemetry(){const e=this.getCurrentStyles(),t=e-this.currentStyles;return t>0&&this.logger.warn(`Style count increased by ${t} since last heartbeat. New Style count: ${e}`),this.currentStyles=e,{Style_Count:e,Style_Delta:t}}getPrimaryWindow(){const e=this.leakDetectorService?.getReachableObjects(v.I.UnwrappedWindow);return e&&0!==e.size?Array.from(this.leakDetectorService?.getReachableObjects(v.I.UnwrappedWindow)).find((e=>e.windowLeakInfo?.windowLeakInfoViewportContext===f.R.primary)):this.fallbackHost}getCurrentStyles(){const e=this.getPrimaryWindow();return e?Array.from(e.document.styleSheets).filter((e=>!e.href)).flatMap((e=>Array.from(e.cssRules))).length:0}}const _=[c.pk.LongInactive],y=e=>_.includes(e),b=e=>e.map((e=>e.processId)).concat(...e.map((e=>b(e.frames)))).filter((e=>void 0!==e));class C{constructor(e){this.context=e,this.isRunning=!1,this.timeouts={},this.lastBeatTimes={},this.intervals={},this.granularNativeMetrics=[],this.granularWorkerMetrics=[],this.packedCallingData=new Map,this.peakWorkingSetByProcess=new Map,this.peakUsedJSHeapSize=0,this.granularJSHeapMetrics=[],this.getHeartbeatStandardInterval=()=>this._configuration?.intervalInSeconds??Number.MAX_SAFE_INTEGER,this.getHeartbeatInterval=e=>{const t=this.getHeartbeatStandardInterval(),i=this._configuration?.maxIntervalInSeconds??t,n=Math.max(1,this._configuration?.delayFactor??1),a=this.context.clientState?.getState();return a&&y(a)?Math.min(i,Math.max(e,t)*n):t},this.getMemorySubInterval=()=>this._configuration?.memoryMetricsCollection?.collectionIntervalInSeconds??Number.MAX_SAFE_INTEGER,this.logger=e.loggerFactory.newLogger("Heartbeat","core-services-telemetry");const{enableAppCountTracking:t}=e.coreSettings.get(l.J.Extensibility);this.platformAppsManagementService=new S(e.loggerFactory,e.hostCommunicationService,!!t),this.styleMetricsService=new k(e.loggerFactory,e.leakDetectorService,e.windowProvider)}static getInstance(){return C.instance}get configuration(){return this._configuration}getPlatformAppsService(){return this.platformAppsManagementService}async start(){C.instance||(C.instance=this,this.logger.debug("Starting the monitor..."),this.initializedTime=Date.now(),this.subscribeToCoreSettings(),this.subscribeToClientState(),await this.registerScenarios())}isHeartbeatMonitorRunning(){return this.isRunning}async getMemoryData(e){if(this._configuration?.memoryMetricsCollection?.enabled){if(e)return this.getAverageMemoryMetrics();if(this.isRunning){const{jsHeapMetrics:e,nativeMemoryMetrics:t,hasExtraRenderer:i}=await this.getMemoryAndJSHeapData();return{...e&&(0,p.RQ)(e,this.peakUsedJSHeapSize),...t&&(0,p.Mv)(t.processes,this.peakWorkingSetByProcess,this.mainRendererProcessId),...t&&(0,p.tC)(t.workers),hasExtraRenderer:i}}}return{}}async collectData(){const e=this.getActions().map((async e=>{try{return await e()}catch{return this.logger.errorToTelemetry?.(`call to function '${e}' failed in heartbeat monitor.`,"fundamentals_performance_heartbeat_monitor"),{}}}));return Object.assign.apply(Object,await Promise.all(e))}collectCallingData(e,t){const{enableCallingCDLTrackingNS:i}=this.context.coreSettings.get(l.J.Calling)||{};if(i){const e=JSON.parse(t),i={cdlData:this.context.graphqlOpsCountService?.getLatestDataAndClear()},n=Object.assign(e,i);t=JSON.stringify(n)}this.packedCallingData.set(e,(this.packedCallingData.get(e)??[]).concat(t))}getActions(){const e=[];this._configuration?.memoryMetricsCollection?.enabled&&e.push(this.getAverageMemoryMetrics.bind(this)),this._configuration?.elapsedTimeTracking?.enabled&&e.push(this.getElapsedTime.bind(this)),this._configuration?.screenInfoCollection?.enabled&&e.push(s.bind(this,this.context.windowProvider)),this._configuration?.inpMetricsCollection?.enabled&&e.push(this.getInpMetrics.bind(this)),this._configuration?.ariMetricsCollection?.enabled&&e.push(this.getAriMetrics.bind(this)),this._configuration?.dataClientMetricsCollection?.enabled&&e.push(this.getDataClientMetrics.bind(this)),this._configuration?.windowMetricsCollection?.enabled&&e.push(this.getWindowMetrics.bind(this)),this._configuration?.clientStateMetricsCollection?.enabled&&e.push(this.getClientStateMetrics.bind(this)),this._configuration?.OLDMetricsCollection?.enabled&&e.push(this.getObjectLeakDetectorMetrics.bind(this));const{enableCallingDataCollectionInHeartbeatConfig:t}=this.context.coreSettings?.get(l.J.Calling)||{};return t&&this._configuration?.callingDataCollection?.enabled&&e.push(this.getCallingData.bind(this)),this._configuration?.graphqlStoreMetricsCollection?.enabled&&e.push(this.getGraphQLStoreMetrics.bind(this)),this._configuration?.platformAppMetricsCollection?.enabled&&e.push(this.getPlatformAppsMetrics.bind(this)),this._configuration?.styleMetricsCollection?.enabled&&e.push(this.getStyleMetrics.bind(this)),this._configuration?.vdiMetricsCollection?.enabled&&e.push(this.getVdiMetrics.bind(this)),e}stopHeartbeat(){this.isRunning&&this.logger.debug("stopping heartbeat monitor"),Object.keys(this.timeouts).forEach((e=>{this.context.windowProvider.clearTimeout(this.timeouts[e])})),this.timeouts={},this.isRunning=!1}subscribeToCoreSettings(){const e=this.context.coreSettings.getObservable(l.J.Telemetry);let t=this.context.coreSettings.get(l.J.Telemetry).heartbeatConfiguration;e.subscribe((e=>{const{enableHeartbeatMonitor:i,heartbeatConfiguration:n}=e;n?(this._configuration=n,this.logger.debug("Configuration loaded...",this._configuration)):this.logger.errorToTelemetry?.("'heartbeatConfiguration' not found.","fundamentals_performance_heartbeat_monitor"),i?(this.startHeartbeat(),this._configuration?.memoryMetricsCollection?.enabled||(this.context.windowProvider.clearTimeout(this.timeouts.memory),this.timeouts.memory=void 0)):(this._configuration=void 0,this.stopHeartbeat()),this._configuration?.intervalInSeconds&&t?.intervalInSeconds!==this._configuration?.intervalInSeconds&&this.overrideNextBeat(),t=this._configuration}))}startHeartbeat(){!this.isRunning&&this.logger.debug("starting heartbeat monitor"),this.scheduleNextTimeout("heartbeat",this.isRunning?this.getHeartbeatInterval(0):Math.min(30,this.getHeartbeatInterval(0)),this.beat.bind(this),this.getHeartbeatInterval,!1),this.scheduleNextTimeout("memory",this.isRunning?this.getMemorySubInterval():Math.min(25,this.getMemorySubInterval()),this.collectGranularMemoryAndJSHeapData.bind(this),this.getMemorySubInterval,!1),this.isRunning=!0}overrideNextBeat(){if(!this.isRunning)return;const e=this.getHeartbeatInterval(0)*d.B.second,t=Date.now(),i=((this.lastBeatTimes.heartbeat??this.initializedTime??t)+e-t)/d.B.second;this.scheduleNextTimeout("heartbeat",i>0?i:0,this.beat.bind(this),this.getHeartbeatInterval,!0)}subscribeToClientState(){const{clientState:e}=this.context;if(!e)return void this.context.windowProvider.setTimeout((()=>this.subscribeToClientState()),100);this.logger.log("Client state is available, preparing subscription");const t=e.observe();let i=e.getState();t.subscribe({next:e=>{y(i)&&!y(e)&&this.overrideNextBeat(),i=e}})}scheduleNextTimeout(e,t=Number.MAX_SAFE_INTEGER,i,n,a){const r=t*d.B.second;0<=r&&r<2147483647&&(a&&this.timeouts[e]&&(this.context.windowProvider.clearTimeout(this.timeouts[e]),this.timeouts[e]=void 0),this.timeouts[e]||(this.intervals[e]=t,this.timeouts[e]=this.context.windowProvider.setTimeout((async()=>{this.timeouts[e]=void 0;try{await i()}catch{this.logger.errorToTelemetry?.(`call to function '${i}' failed in heartbeat monitor.`,"fundamentals_performance_heartbeat_monitor")}finally{this.lastBeatTimes[e]=Date.now(),this.scheduleNextTimeout(e,n(t),i,n,!1)}}),r)))}async beat(){const e=await this.collectData();(0,u.aA)(e)}getElapsedTime(){const e=Date.now(),t=this.initializedTime||e;return{elapsed:Math.floor((e-t)/d.B.second)}}getAverageMemoryMetrics(){const e=[];if(this.granularNativeMetrics.length){const t=new Map(this.peakWorkingSetByProcess.entries());this.peakWorkingSetByProcess.clear(),this.granularNativeMetrics.reduce(((e,t)=>{for(const i of t){const{processId:t}=i;e.set(t,(e.get(t)??[]).concat(i))}return e}),new Map).forEach(((i,n)=>{this.peakWorkingSetByProcess.set(n,t.get(n)??0);const a=(0,g.meanBy)(i,(e=>e.workingSetSizeKB)),r=(0,g.meanBy)(i,(e=>e.privateWorkingSetSizeKB)),o=(0,g.meanBy)(i,(e=>e.commitSizeKB)),s={processId:n,name:i[0].name,type:i[0].type,utilitySubType:i[0].utilitySubType,embeddedBrowserWebView:i[0].embeddedBrowserWebView,cpuCycleTime:i[0].cpuCycleTime,workingSetSizeKB:isNaN(a)?void 0:Math.round(a),privateWorkingSetSizeKB:isNaN(r)?void 0:Math.round(r),commitSizeKB:isNaN(o)?void 0:Math.round(o)};e.push(s)}))}const t=[];this.granularWorkerMetrics.length&&this.granularWorkerMetrics.reduce(((e,t)=>{for(const i of t){const{targetSessionId:t}=i;e.set(t,(e.get(t)??[]).concat(i))}return e}),new Map).forEach(((e,i)=>{const n=(0,g.meanBy)(e,(e=>e.totalSizeKB)),a=(0,g.meanBy)(e,(e=>e.usedSizeKB)),r={targetSessionId:i,type:e[0].type,subType:e[0].subType,totalSizeKB:isNaN(n)?void 0:Math.round(n),usedSizeKB:isNaN(a)?void 0:Math.round(a)};t.push(r)}));const i=(0,p.Mv)(e,this.peakWorkingSetByProcess,this.mainRendererProcessId),n=(0,p.tC)(t);let a={};if(this.granularJSHeapMetrics.length){const e={jsHeapSizeLimit:Math.round((0,g.meanBy)(this.granularJSHeapMetrics,(e=>e.jsHeapSizeLimit||0))),totalJSHeapSize:Math.round((0,g.meanBy)(this.granularJSHeapMetrics,(e=>e.totalJSHeapSize||0))),usedJSHeapSize:Math.round((0,g.meanBy)(this.granularJSHeapMetrics,(e=>e.usedJSHeapSize||0)))};a=(0,p.RQ)(e,this.peakUsedJSHeapSize)}const r={...i,...n,...a,hasExtraRenderer:this.hasExtraRenderer};return this.hasExtraRenderer=void 0,r}getInpMetrics(){const e={Perf_Inp:""};if(this.context.interactionToNextPaintService){const t=this.context.interactionToNextPaintService.getTelemetry();e.Perf_Inp=t}return e}getAriMetrics(){const e={Perf_Ari:""};if(this.context.appResponsivenessService){const t=this.context.appResponsivenessService.getTelemetry();e.Perf_Ari=t}return e}getDataClientMetrics(){const e={Perf_ApolloCacheStats:void 0};if(this.context.dataClientTrackingService){const t=this.context.dataClientTrackingService.getTelemetry();e.Perf_ApolloCacheStats=t}return e}getWindowMetrics(){const e={Perf_WindowStats:void 0};if(this.context.windowTrackerService){const t=this.context.windowTrackerService.getTelemetry();e.Perf_WindowStats=t}return e}getObjectLeakDetectorMetrics(){const e={};if(this.context.leakDetectorService){const t=this.context.leakDetectorService.getTelemetry();if(t){const{counts:i,leakStats:n,leaks:a,countsRecord:r,hasWindowLeak:o,hasApolloLeak:s}=t;e.Perf_OLDStats=i,e.Perf_LeakStats=n,e.Perf_Leaks=a,e.Perf_LeaksRecord=r,e.Perf_Leaks_HasWindowLeak=o,e.Perf_Leaks_HasApolloLeak=s}}return e}getClientStateMetrics(){const e={Perf_IsUserInCall:void 0};if(this.context.clientState){const t=this.context.clientState.getState()===c.pk.VeryActive;e.Perf_IsUserInCall=t}return e}getCallingData(){const e={Perf_Calling_Data:void 0};return this.packedCallingData.forEach((t=>{e.Perf_Calling_Data?e.Perf_Calling_Data.push(...t):e.Perf_Calling_Data=t})),this.packedCallingData.clear(),e}getGraphQLStoreMetrics(){const e={};return this.context.graphqlStoreStatsReporterService&&(e.Perf_GraphQLStoreStats=this.context.graphqlStoreStatsReporterService.getTelemetry()),e}getPlatformAppsMetrics(){let e={};if(this.lastMemoryMetrics){const t=this.platformAppsManagementService.getTelemetry(this.lastMemoryMetrics);e={Perf_PlatformApps_Active_WorkingSet:t.activeWorkingSetSizeKB,Perf_PlatformApps_Cached_WorkingSet:t.cachedWorkingSetSizeKB,Perf_PlatformApps_Active_Commit_Size:t.activeCommitSizeKB,Perf_PlatformApps_Cached_Commit_Size:t.cachedCommitSizeKB,Perf_PlatformApps_Count_CachedApps:t.cachedAppsCount,Perf_PlatformApps_Count_ActiveApps:t.activeAppsCount,Perf_PlatformApps_Stats:t.appsPlatformStats}}return e}getStyleMetrics(){return this.styleMetricsService.getTelemetry()}getVdiMetrics(){return{vdiMode:this.context.platformService?.config.vdi?.mode??"0"}}async getMemoryAndJSHeapData(){let e,t,i;if(this.context.hostCommunicationService){e=await(0,h.K)(this.context.hostCommunicationService,this.logger,this._configuration?.workerMetricsCollection?.enabled||!1);const t=[];let n=0;for(const i of e.processes){const{type:e,isMainRenderer:a,processId:r}=i;"renderer"===e.toLowerCase()&&(a&&(n=r),t.push(i))}this.mainRendererProcessId=this.mainRendererProcessId&&t.find((e=>e.processId===this.mainRendererProcessId))?this.mainRendererProcessId:n||t.sort(((e,t)=>(t.workingSetSizeKB??0)-(e.workingSetSizeKB??0)))[0]?.processId;const a=e.windows.flatMap((e=>[e.processId,...b(e.frames)]));i=t.length>0&&!t.every((e=>e.isMainRenderer||a.includes(e.processId)))}else this.logger.errorToTelemetry?.("Invalid hostCommunicationService, cannot get native metrics from Desktop","fundamentals_performance_heartbeat_monitor");return this.context.windowProvider?t=(0,m.P)(this.context.windowProvider):this.logger.errorToTelemetry?.("Invalid windowProvider, cannot get js metrics from window","fundamentals_performance_heartbeat_monitor"),{nativeMemoryMetrics:e,jsHeapMetrics:t,hasExtraRenderer:i}}async collectGranularMemoryAndJSHeapData(){const{nativeMemoryMetrics:e,jsHeapMetrics:t,hasExtraRenderer:i}=await this.getMemoryAndJSHeapData(),n=this.intervals.heartbeat??this.getHeartbeatStandardInterval(),a=Math.max(Math.round(n/this.getMemorySubInterval()),1)||1;if(e){this.lastMemoryMetrics=e,this.granularNativeMetrics=this.granularNativeMetrics.concat([e.processes]).slice(-a),this.granularWorkerMetrics=this.granularWorkerMetrics.concat([e.workers]).slice(-a);for(const t of e.processes){const{processId:e}=t,i=this.peakWorkingSetByProcess.get(e);this.peakWorkingSetByProcess.set(e,Math.max(i||0,t.workingSetSizeKB||0))}}t&&(this.peakUsedJSHeapSize=Math.max(this.peakUsedJSHeapSize,t.usedJSHeapSize||0),this.granularJSHeapMetrics=this.granularJSHeapMetrics.concat(t).slice(-a)),this.hasExtraRenderer||(this.hasExtraRenderer=i)}async registerScenarios(){if(this.context.hostCommunicationService){const e=await this.context.hostCommunicationService.loadModule("heartbeat");if(e?.registerForScenarioStart)try{e.registerForScenarioStart((e=>{}))}catch{this.logger.error("Failed to register for listening to host scenarios starting")}if(e?.registerForScenarioStop)try{e.registerForScenarioStop((e=>{}))}catch{this.logger.error("Failed to register for listening to host scenarios stopping")}}}}C.instance=void 0},562154:(e,t,i)=>{i.d(t,{E:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformAppButtonQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appButtonResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"action"}}]}}]}}]}},65138:(e,t,i)=>{i.d(t,{i:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformBackButtonHandlerStateQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"backButtonHandlerState"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"registered"}}]}}]}}]}},900783:(e,t,i)=>{i.d(t,{L:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformChangeSettingsQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSettingsResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"status"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}}]}}]}}]}},807907:(e,t,i)=>{i.d(t,{N:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformChangeSettingsTriggerQuery"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"changeSettingsTriggerResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}},{kind:"Field",name:{kind:"Name",value:"message"}}]}}]}}]}},472694:(e,t,i)=>{i.d(t,{O:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"DataClientPlatformLocalFrameContextQuery"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"localFrameContext"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"threadId"}},{kind:"Field",name:{kind:"Name",value:"messageId"}},{kind:"Field",name:{kind:"Name",value:"tabId"}},{kind:"Field",name:{kind:"Name",value:"websiteUrl"}},{kind:"Field",name:{kind:"Name",value:"contentUrl"}}]}}]}}]}},159441:(e,t,i)=>{i.d(t,{i:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"mapCoordinateResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mapCoordinateResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"latitude"}},{kind:"Field",name:{kind:"Name",value:"longitude"}},{kind:"Field",name:{kind:"Name",value:"locationApiError"}}]}}]}}]}},124438:(e,t,i)=>{i.d(t,{n:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"messageToChildResult"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"appId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"messageToChildResult"},arguments:[{kind:"Argument",name:{kind:"Name",value:"appId"},value:{kind:"Variable",name:{kind:"Name",value:"appId"}}}],directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"message"}}]}}]}}]}},941237:(e,t,i)=>{i.d(t,{a:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"selectMediaResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectMediaResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectMediaError"}},{kind:"Field",name:{kind:"Name",value:"mediaUrls"}}]}}]}}]}},293213:(e,t,i)=>{i.d(t,{k:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"selectPeoplePickerResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"selectPeoplePickerResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"email"}}]}}]}}]}},628444:(e,t,i)=>{i.d(t,{F:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"showLocationResponse"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"showLocationResponse"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}]}},939010:(e,t,i)=>{i.d(t,{s:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"taskModuleResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"taskModuleResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"card"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}}]}},{kind:"Field",name:{kind:"Name",value:"adaptiveCardTabResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"appIcon"}},{kind:"Field",name:{kind:"Name",value:"appId"}},{kind:"Field",name:{kind:"Name",value:"appName"}},{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"locale"}}]}},{kind:"Field",name:{kind:"Name",value:"text"}},{kind:"Field",name:{kind:"Name",value:"taskModuleId"}},{kind:"Field",name:{kind:"Name",value:"draftId"}},{kind:"Field",name:{kind:"Name",value:"conversationId"}},{kind:"Field",name:{kind:"Name",value:"reason"}},{kind:"Field",name:{kind:"Name",value:"entryPoint"}}]}}]}}]}},645027:(e,t,i)=>{i.d(t,{R:()=>n});const n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"viewImagesResult"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewImagesResult"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewImagesError"}},{kind:"Field",name:{kind:"Name",value:"errorCode"}}]}}]}}]}},899032:(e,t,i)=>{var n;i.d(t,{U3:()=>c,Q0:()=>l,m3:()=>d,Is:()=>u,Bz:()=>p}),function(e){e.StoreDevices="StoreDevices",e.StoreCart="StoreCart",e.StoreCartCheckout="StoreCartCheckout"}(n||(n={}));const a="openDeviceDetailsDialog",r="openStoreCartCheckoutDialog",o="openStoreCartDialog",s="closeStoreCartCheckoutDialog",c={openDeviceDetailsDialog:e=>({originator:n.StoreDevices,type:a,data:()=>({...e})}),openStoreCartDialog:()=>({originator:n.StoreCart,type:o}),openStoreCartCheckoutDialog:e=>({originator:n.StoreCartCheckout,type:r,data:()=>({...e})}),closeStoreCartCheckoutDialog:()=>({originator:n.StoreCartCheckout,type:s})},l=e=>h(e)&&e.type===a,d=e=>h(e)&&e.type===o,u=e=>h(e)&&e.type===r,p=e=>h(e)&&e.type===s,h=e=>Object.keys(n).includes(e.originator)},799571:(e,t,i)=>{i.d(t,{aw:()=>n,ZU:()=>a,Fz:()=>r,l6:()=>o,$N:()=>s,yc:()=>c,DT:()=>l,ku:()=>d,sK:()=>u,G5:()=>p,SM:()=>h,wK:()=>m,_V:()=>g,fL:()=>S,IY:()=>f,rz:()=>v,ru:()=>k,op:()=>_,ej:()=>y,Hw:()=>b,QN:()=>I,gX:()=>E,ex:()=>T,s9:()=>M,uI:()=>D,rF:()=>A,_6:()=>P,zP:()=>w,GA:()=>R,f:()=>x,u1:()=>F,kI:()=>O,lG:()=>U,j:()=>B,Tv:()=>L,$l:()=>z});const n="TflFreProfileCardDisplayed",a="LogoutState",r="authSessionId",o="tmp.previous.silent.signin",s="in-progress",c={nopa:"2"},l={coa:"1"},d="tenantId",u="loginhint",p="login_hint",h={AuthProviderLoadError:"AuthProviderLoadError",ErrorGetUserWhenAnonNotSupported:"ErrorGetUserWhenAnonNotSupported",UserNotLicensed:"Forbidden",UserLicenseNotPresentTrialEligible:"UserLicenseNotPresentTrialEligible",CloudMismatch:"CloudMismatch",CloudMismatchNoMultiCloud:"CloudMismatchNoMultiCloud",MultiMSARoadBlock:"MultiMSARoadBlock",InitFailure:"Core-auth init failure",NoMatchingUserFound:"NoMatchingUserFound",InteractionRequired:"InteractionRequired",UnsupportedAccountType:"UnsupportedAccountType",InvalidScopeResource:"invalid_scope",MultipleUsersPresentWithSpecifiedIdentifier:"MultipleUsersPresentWithSpecifiedIdentifier",NativeAuthModuleNotPresent:"NativeAuthModuleNotPresent",NoAccountFound:"NoAccountFound",RemoteOperationFailed:"RemoteOperationFailed",SignInRestrictions:"SignInRestrictions",SsoFirstAccountFailed:"SsoFirstAccountFailed",NoNetwork:"NoNetwork",MachineAsleep:"MachineAsleep",TenantUnredeemed:"TenantUnredeemed",ErrorCodeMissingForTenantLogin:"ErrorCodeMissingForTenantLogin",UserNotAuthenticated:"UserNotAuthenticated",UserNotFoundError:"User not found",LoginRequired:"login_required",ConsentRequired:"consent_required",PopUpWindowError:"popup_window_error",EmptyResponse:"EmptyResponse",InvalidResponse:"InvalidResponse",InvalidToken:"InvalidToken",InvalidEndpoint:"endpoints_resolution_error",UnsupportedParameter:"UnsupportedParameter",UserAuthOrHomeAccountNotAvailable:"UserAuthOrHomeAccountNotAvailable",MissingRequiredFields:"MissingRequiredFields",CannotUpdateCurrentAccount:"CannotUpdateCurrentAccount",FallbackWithSkypeToken:"FallbackWithSkypeToken",HiddenUserErrorForLogin:"HiddenUserErrorForLogin",MsaUserNotAllowed:"MsaUserNotAllowed",ShowTenantPicker:"ShowTenantPicker",LogOutTriggeredFromCrossCloud:"Log out triggered cross cloud",NoSkypetokenAvailableInResponse:"NoSkypetokenAvailableInResponse",SkypeTokenResponseInvalidJson:"SkypeTokenResponseInvalidJson",AcquireTokenCloudMismatch:"AcquireTokenCloudMismatch",CrossCloudTenantInWeb:"CrossCloudTenantInWeb"},m={NoNetwork:"NoNetwork",ApiContractViolation:"ApiContractViolation",UiAlreadyShowing:"Cannot sign in when UI is showing"},g="https://login.microsoftonline.com/",S=[{cloud:"prod",authority:g},{cloud:"gallatin",authority:"https://login.partner.microsoftonline.cn/"},{cloud:"dod",authority:"https://login.microsoftonline.us/"},{cloud:"gcch",authority:"https://login.microsoftonline.us/"},{cloud:"life",authority:g},{cloud:"airgap09",authority:"https://login.microsoftonline.microsoft.scloud/"},{cloud:"airgap08",authority:"https://login.microsoftonline.eaglex.ic.gov/"}],f="InteractionRequiredAuthError",v="skype-token",k="discover-user-details",_="discover-region-gtm";var y,b;!function(e){e.LOKI_TFL_AUTH_TOKEN_AUDIENCE="liveprofilecard.access",e.MT_AAD_KEY="https://api.spaces.skype.com",e.MT_KEY="middleTier",e.SKYPE_KEY="skype",e.SIGNIN_RESTRICTIONS_KEY="SignInRestrictions",e.AUTHZ_DEFAULT_BASE_URL="https://teams.microsoft.com/api/authsvc/v1.0/authz",e.AUTHZ_DEPRECATED_DEFAULT_BASE_URL="https://authsvc.teams.microsoft.com/v1.0/authz",e.GROUPS_SERVICE="https://groupssvc.fl.teams.microsoft.com/teams.readwrite",e.IC3_GATEWAY_CAE_KEY="https://ic3.teams.office.com",e.IC3_GATEWAY_AAD_KEY="https://ic3-non-cae.teams.office.com",e.IC3_GATEWAY_CAE_KEY_INT="https://ic3-testing.teams.office.com",e.IC3_GATEWAY_AAD_KEY_INT="https://ic3-non-cae-testing.teams.office.com"}(y||(y={})),function(e){e.openId="openId",e.profile="profile"}(b||(b={}));let C=["[auth][authserviceBack][error] Due to current app state '[isOnline=false]' cannot start retry fetch of ADAL tokens","[auth][authservice][error] Due to current app state '[isOnline=false]' cannot start retry fetch of ADAL tokens","[auth][authservice][error] Cannot start retry fetch of ADAL tokens without relogin. Rejecting token request","aborted","A silent sign-in request was sent but none of the currently signed in user(s) match the requested login hint","Cannot start retry fetch of ADAL tokens without relogin. Rejecting token request","Cannot start retry fetch of ADAL tokens, isPassive: false","Cancelling all retries due to: orchestration authenticationService_offline","Cancelling all retries due to: Relogin succeeded. Need to refresh tokens","Due to current app state cannot start retry fetch of ADAL tokens","noAccessForResource","resourceRequiresConsent","resourceDisabled","Seamless single sign on failed for the user. This can happen if the user is unable to access on premises AD or intranet zone is not configured correctly","tokenRevoked","tpmError","Webclient Auth request reached maximum timeout - 60000.","popup_window_error"];const I=e=>(e&&(C=[...C,...e]),C),E=()=>C;let N=[];const T=e=>(e&&(N=[...N,...e]),N),M=e=>N.includes(e);var D,A,P;!function(e){e[e.ONE=1]="ONE",e[e.TWO=2]="TWO",e[e.FOUR=4]="FOUR",e[e.FIVE=5]="FIVE",e[e.TEN=10]="TEN",e[e.FIFTEEN=15]="FIFTEEN",e[e.SIXTEEN=16]="SIXTEEN",e[e.TWENTYFOUR=24]="TWENTYFOUR",e[e.THIRTY=30]="THIRTY",e[e.TWO_HUNDRED_FIFTY_FIVE=255]="TWO_HUNDRED_FIFTY_FIVE"}(D||(D={})),function(e){e[e.SECONDS_PER_MINUTE=60]="SECONDS_PER_MINUTE",e[e.MINUTES_PER_HOUR=60]="MINUTES_PER_HOUR",e[e.MILLI_PER_SECOND=1e3]="MILLI_PER_SECOND",e[e.SECONDS_FIVE_MINUTES=300]="SECONDS_FIVE_MINUTES",e[e.ONE_HOUR=36e5]="ONE_HOUR",e[e.ONE_MINUTE=6e4]="ONE_MINUTE",e[e.ONE_DAY=864e5]="ONE_DAY"}(A||(A={})),function(e){e.services="f8cdef31-a31e-4b4a-93e4-5f571e91255a"}(P||(P={}));const w="9188040d-6c67-4c5b-b112-36a304b66dad",R="wids",x="74ebf54e-8a4c-453c-a5ea-3ff41b70afe6",F="b44d8d43-c828-450b-9b6f-ae3788447705",O="X-MS-Migration",U="X-Ms-Test-User",B=(D.TWO,A.MILLI_PER_SECOND,A.SECONDS_PER_MINUTE,{SKYPE_REQUEST:"skype_request_start",SKYPE_REQUEST_STOP:"skype_request_stop",SKYPE_SEND_REQUEST:"skype_send_request_start",SKYPE_SEND_REQUEST_STOP:"skype_send_request_stop",SKYPE_RECEIVED_RESPONSE:"skype_received_response",SKYPE_SEND_REQUEST_DESKTOP:"skype_send_request_desktop",SKYPE_SEND_REQUEST_WORKER:"skype_send_request_worker",SKYPE_TOKEN_RECEIVED_WORKER:"skype_token_received_worker",RECEIVE_CLAIM:"receive_claim",SKYPE_ONLY_TEAMS_SHARED_DEVICES:"skype_only_teams_shared_devices"}),L={MTO:"MTO"},z={TENANTSV2:"/beta/users/tenantsv2"}},838119:(e,t,i)=>{i.d(t,{q:()=>a});var n=i(965517);const a=new class{constructor(){this.logLevel=n.in.Info,this.localCallback=void 0,this.error=e=>this.logMessage(n.in.Error,e),this.warning=e=>this.logMessage(n.in.Warning,e),this.warn=e=>this.logMessage(n.in.Warning,e),this.info=e=>this.logMessage(n.in.Info,e),this.log=e=>this.logMessage(n.in.Info,e),this.verbose=e=>this.logMessage(n.in.Verbose,e),this.debug=e=>this.logMessage(n.in.Verbose,e)}initialize(e,t=n.in.Verbose){this.localCallback=e,this.logLevel=t}executeCallback(e,t){this.localCallback?this.localCallback(e,t):console&&console.log(t)}logMessage(e,t){if(e>this.logLevel)return;const i=`[Auth]: ${t}`;this.executeCallback(e,i)}}},894638:(e,t,i)=>{i.d(t,{OU:()=>h,F9:()=>p,u:()=>u,cv:()=>S,ld:()=>g,Tu:()=>f});var n=i(838119),a=i(7487),r=i(485510),o=i(581302),s=i(69588);class c{}c._authTelemetryCollection={},c._correlationMap={},c._userBiServiceMap={},c.getUserBiService=e=>c._userBiServiceMap[e]||c._userBiServiceMap.GLOBAL,c.setUserBiService=(e,t)=>{t?c._userBiServiceMap[e]=t:delete c._userBiServiceMap[e]},c.getAuthTelemetry=e=>c._authTelemetryCollection[e],c.setAuthTelemetry=(e,t)=>c._authTelemetryCollection[e]=t,c.delete=e=>{delete c._authTelemetryCollection[e];const t=Object.keys(c._correlationMap);for(const i in t)if(c._correlationMap.hasOwnProperty(t[i])){const n=t[i],a=c._correlationMap[n];a&&(c._correlationMap[n]=a.filter((t=>t!==e)))}},c.getCorrelation=e=>c._correlationMap[e],c.setCorrelation=e=>{if(!e.scenarioName)return;const t=c.getCorrelation(e.scenarioName)||[];-1===t.indexOf(e.id)&&t.push(e.id),c._correlationMap[e.scenarioName]=t};class l{constructor(e,t,i,l,d,u,p,h,m){this._scenarioFactory=e,this._correlation=t,this._asyncAuthCache=i,this._subContext=l,this._shouldCreateScenario=d,this._isBatch=u,this._timeoutMs=p,this._telemetryService=h,this._eventData=[],this._localScenarioEventData={},this._loggingPrefix="",this.appendScenarioEventData=e=>{this._scenario&&this._scenario.appendEventData(e),this._localScenarioEventData={...this._localScenarioEventData,...e}},this.addEventData=e=>{Array.prototype.push.apply(this._eventData,e)},this.getEventData=()=>[...this._eventData],this.addScenarioMark=(e,t={},i)=>{t=this._mapEventData(t,i),this._scenario?this._scenario.mark(e,t,t.status):this.addEventData([`${e}:${t.status}`]),this.logMessage(`${this._loggingPrefix} [${e}][${t.status}][scenarioEventData][${(0,a.u4)(t)}]`)},this.closeScenario=(e={},t,i,a)=>{if(e=this._mapEventData(e,t),i)return e.reason&&this.addEventData([`reason:${e.reason}`]),e.errorCode&&this.addEventData([`errorCode:${e.errorCode}`]),void this.addEventData([`${this._subContext}$:${e.status}`]);if(this._isBatch&&this._correlation.scenarioName&&(this._batchScenarioStartTime&&(e.perfDelta=performance.now()-this._batchScenarioStartTime),e.correlationId=e.correlationId??this._correlation.id,"success"===e.status?(0,o.ft)(this._scenarioFactory,this._asyncAuthCache,this._correlation.scenarioName,e,a):"failure"===e.status?(0,o.EJ)(this._scenarioFactory,this._asyncAuthCache,this._correlation.scenarioName,e,a):(0,o.vB)(this._scenarioFactory,this._asyncAuthCache,this._correlation.scenarioName,e,a)),!this._scenario){const t=this._shouldCreateScenario?n.q.warn:n.q.log,i=this._shouldCreateScenario?"[N/A]":"";return this.logEventData(t,`${this._loggingPrefix} [stop]${i} [scenarioEventData]`,e),void c.delete(this._correlation.id)}switch(e.status){case"incomplete":this._scenario.incomplete(e);break;case"failure":this._scenario.fail(e);break;case"abandoned":this._scenario.cancel(e);break;default:this._scenario.stop(e)}const r="failure"===e.status?n.q.error:n.q.log;this.logEventData(r,`${this._loggingPrefix} [stop][${e.status}] [e]`,e),c.delete(this._correlation.id)},this.createScenario=(e,t,i)=>{this._scenario?this.logMessage(`createScenario called with [${this._subContext}][${(0,a.u4)(this._correlation)}]::${e}, but there is already a scenario with that correltion id`,n.q.warn):(this._createScenario(e,i||this._timeoutMs,{...this._localScenarioEventData,...t}),this.logMessage(`${this._loggingPrefix} [create] - scenario created`))},this.recordAuthUserBiTelemetry=(e,t)=>{const i={panelRegion:r.Ai.main,panelType:r.wh.AuthStart,actionWorkload:r.sz.auth,actionSubworkload:r.eD.sisu,actionScenarioType:r.Yu.appAuth,actionScenario:t.scenario,actionGesture:t.actionGesture||r.uS.auto},a=c.getUserBiService(e||"GLOBAL");a&&a.recordPanelAction(i,n.q)},this.setUserToTelemetryContext=e=>{e&&(this._telemetryService?.setAuthContext(e),this.addScenarioMark(`${this._correlation.scenarioName}_set_user_on_telemetry_context`))},this.setUserDetailsToTelemetryContext=e=>{if(e){const{region:t}=e;void 0!==t&&this._telemetryService?.setCoreContext("UserInfo.Region",t),this.addScenarioMark(`${this._correlation.scenarioName}_set_tenant_details_on_telemetry_context`)}},this._mapEventData=(e,t)=>(e.subContext=e.subContext||this._subContext,(e={...this._localScenarioEventData,...e}).error&&(e.error={...e.error,message:e.error.message,errorMetaData:void 0},e.errorCode=e.error.code??e.error.errorCode,this.addEventData([`errorCode:${e.error.errorCode}`])),!t&&e.error&&(t=(0,s.ZG)(e.error)?"incomplete":"failure"),e.eventData=this._eventData.join(","),e.status=t||"success",e),this._createScenario=(e,t,i)=>{const a=t?{timeoutMs:t}:{};this._scenario=this._scenarioFactory.findScenario(e)??this._scenarioFactory.newScenario(e,a);try{this._scenarioFactory.hoistScenarioToCore?.(this._scenario)}catch(e){n.q.log(`${this._loggingPrefix} ${e.message}`)}this._scenario.appendEventData({secondaryCorrelationId:this._correlation.id,commandSource:this._correlation.source,...i}),this._shouldCreateScenario=!0},this.loggingPrefix=()=>`[Telemetry][${this._correlation.id}][${this._correlation.scenarioName}]`,this.logEventData=(e,t,i)=>{i.error||delete i.error;const n=this.splitStringEqually((0,a.u4)(i));for(const i of n)this.logMessage(`${t}${i}`,e)},this.splitStringEqually=(e,t=300)=>{const i=new RegExp(`.{1,${t}}`,"g"),n=e.match(i);return n||[]},this.logMessage=(e,t)=>{this._isBatch||(t?t(e):n.q.log(e))},this._loggingPrefix=this.loggingPrefix(),this._isBatch&&(this._batchScenarioStartTime=performance.now()),d&&(m?this._scenario=m:this._correlation?.scenarioName&&this._createScenario(this._correlation.scenarioName,this._timeoutMs,void 0)),this.logMessage(`${this._loggingPrefix} [start] - telemetry provider created for ${this._subContext}, source: ${this._correlation.source} with shouldCreateScenario: [${d}]`),this._eventData.push(`^source:${this._correlation.source},fn:${this._subContext}`)}get correlation(){return{...this._correlation}}}class d{constructor(e,t,i){this._scenarioProvider=e,this._asyncAuthCache=t,this._telemetryService=i,this.create=e=>this._createScenario(e,!0),this.createNew=e=>{const t=new l(this._scenarioProvider,e.correlation,this._asyncAuthCache,e.subContext,!0,e.isBatch??!1,e.timeoutMs,this._telemetryService);return e.scenarioEventData&&t.appendScenarioEventData(e.scenarioEventData),t},this.createWithoutScenario=e=>this._createScenario(e,!1),this.getCorrelation=e=>c.getCorrelation(e)||[],this._createScenario=(e,t)=>{const{correlation:i,subContext:n,scenarioEventData:a,timeoutMs:r,scenario:o,isBatch:s}=e;let d=c.getAuthTelemetry(i.id);if(d)d.addEventData([`fn:${n}`]);else{const a=this._telemetryService?.getTelemetryServicesCache().get(e.scenarioEventData?.accountId);d=new l(a?.coreScenarioFactory||this._scenarioProvider,i,this._asyncAuthCache,n,t,s??!1,r,a?.telemetryService||this._telemetryService,o),c.setAuthTelemetry(i.id,d)}return a&&d.appendScenarioEventData(a),c.setCorrelation(i),d}}}const u=(e,t)=>{c.setUserBiService(e||"GLOBAL",t)},p=e=>m({...e,startWithoutScenario:!1}),h=e=>{e.options.correlation={id:e.options.correlation?.id??(0,a.pW)(),scenarioName:e.options.correlation?.scenarioName??e.scenarioName,source:e.options.correlation?.source??e.source};const{options:{correlation:t},...i}=e;return m({correlation:t,...i})},m=e=>{const{correlation:t,subContext:i,scenarioEventData:n,eventData:a,timeoutMs:r,scenario:o,isBatch:s}=e,l=c.getAuthTelemetry(t.id),d=(e.startWithoutScenario||!t.scenarioName?S.createWithoutScenario:S.create)({correlation:t,subContext:i,scenarioEventData:n,timeoutMs:r,scenario:o,isBatch:s});a&&d.addEventData(a);return[d,(e,t,i)=>d.closeScenario(e,t,!!l,i)]},g=e=>S.getCorrelation(e);let S;const f=(e,t,i)=>{S||(S=new d(e,t,i),n.q.log("authTelemetryProvider initialized"))}},581302:(e,t,i)=>{i.d(t,{Q7:()=>c,ft:()=>l,EJ:()=>d,vB:()=>u,mM:()=>p});var n=i(838119),a=i(7487);const r=1e3,o="batch_",s=e=>({typeName:"BatchScenario",user:e});function c(e){const t=e.getAllOfType("User");t?.forEach((t=>{try{const i={user:{tenantId:t.profile.tid,oid:t.profile.oid,accountType:t.type,userName:t.userName,id:t.id},typeName:"BatchScenario"};e.del(i)}catch(e){n.q.log("[deleteAllBatchDataFromStorage] - failed to delete batcScenario from storage")}}))}function l(e,t,i,n,a){h(e,t,`${o}${i}`,(e=>(e.successMetaData=S(n,e.successMetaData),e.successMetaData.batchScenarioCounter)),a)}function d(e,t,i,n,a){h(e,t,`${o}${i}`,(e=>(e.failureMetaData=S(n,e.failureMetaData),e.failureMetaData.batchScenarioCounter)),a)}function u(e,t,i,n,a){h(e,t,`${o}${i}`,(e=>(e.abandonedMetaData=S(n,e.abandonedMetaData),e.abandonedMetaData.batchScenarioCounter)),a)}const p=async(e,t,i)=>{const n=s(i),a=await t.getValue(n);if(a){for(const t in a)if(a[t]){m(e,t,a[t],i.id)}t.del(n)}};function h(e,t,i,a,o){if(!o)return void n.q.log("[updateBatchScenarioCount] Unable to get batch cache key: user is not defined");const c=s(o);t.getValue(c).then((s=>{const l=s?.[i]??{};a(l)>=r?(m(e,i,l,o.id),function(e,t,i,a){try{n.q.log(`[clearBatchScenarioFromCache] scenario: ${i}`),delete a?.[i],e.put(t,a)}catch(e){n.q.log(`[clearBatchScenarioFromCache] ${e?.message}`)}}(t,c,i,s)):function(e,t,i,a,r){try{return r?r[i]=a:r={[i]:a},e.put(t,r),!0}catch(e){return n.q.log(`[setBatchScenarioToAuthCache] ${e?.message}`),!1}}(t,c,i,l,s)}))}function m(e,t,i,n){i?.successMetaData&&g(e,t,i.successMetaData,"success",n),i?.failureMetaData&&g(e,t,i.failureMetaData,"failure",n),i?.abandonedMetaData&&g(e,t,i.abandonedMetaData,"abandoned",n)}function g(e,t,i,r,o){const s=e.newScenario(t),c=(0,a.pW)();n.q.log(`[sendBatchScenario] for ${t}, status: ${r}, correlationId:${c}`);const l={accountId:o,context:"auth-telemetry-helper",secondaryCorrelationId:c,batchScenarioData:i};switch(r){case"success":s.stop(l);break;case"failure":s.fail(l);break;default:s.cancel(l)}}function S(e,t){return t?(t.batchScenarioCounter++,t.batchEventData.push(e)):t={batchScenarioCounter:1,batchEventData:[e]},t}},69588:(e,t,i)=>{i.d(t,{Tr:()=>o,q2:()=>s,MD:()=>c,Yf:()=>l,ZG:()=>d,fj:()=>u});var n=i(799571),a=i(689626),r=i(7487);function o(e){const t=new Error(e.message);return Object.assign(t,{context:e.context,subContext:e.subContext,reason:e.reason,errorCode:e.errorCode,serverResponse:e.serverResponse,correlationId:e.correlationId,isExpected:e.isExpected,innerError:e.innerError})}const s=(e,t,i)=>{switch(e.code){case a.jK.NoNetwork:return c({name:"offlineEndPage",code:e.code,context:"authentication",subContext:"auth-webview2::_loginInternal",message:e.message,correlationId:t,isExpected:e.isExpected||!1,errorCode:e.code,innerError:e.innerError,authSubErrorCode:"OfflineError",errorMetaData:void 0});case a.jK.SignInRestrictions:return c({name:"signInRestrictionEndPage",code:e.code,context:"authentication",subContext:"auth-webview2::_loginInternal",message:e.message,correlationId:t,isExpected:e.isExpected||!1,errorCode:e.code,innerError:e.innerError,authSubErrorCode:"SignInRestriction",errorMetaData:i})}return e};function c(e){const t=new Error(e.message);return Object.assign(t,{authSubErrorCode:e.authSubErrorCode,errorMetaData:e.errorMetaData,context:e.context,subContext:e.subContext,reason:e.reason,errorCode:e.errorCode,serverResponse:e.serverResponse,correlationId:e.correlationId,isExpected:e.isExpected,innerError:e.innerError,message:e.message})}function l(e){return(0,n.gX)().indexOf(e)>=0}function d(e){return e&&(e.isExpected||l(e.errorCode)||!!(t=e.message)&&(0,n.gX)().map((e=>t.indexOf(e)>=0)).filter(Boolean).length>0);var t}function u(e,t,i,o=!0){let s,l,d="";const{name:u,email:p,pictureBlob:h,customError:m,shouldBypassEndPageLogout:g}=e;let S={accountId:i,name:u,email:p,pictureBlob:h,userLoggedIn:o};switch(t){case"LicenseError":s="licenseEndPage",l="show-license-error",d=a.jK.Forbidden;break;case"SignInRestriction":s="signInRestrictionEndPage",l="show-signin-restriction-error",d=a.jK.SignInRestrictions;break;case"MsaUserNotAllowed":s="msaUserNotAllowedEndPage",l="show-msa-user-not-allowed-error",d=n.SM.ShowTenantPicker,S={...S,preventLogout:g||!1};break;default:s="",l=""}return c({authSubErrorCode:t,errorCode:d,errorMetaData:S,name:s,message:m?.message||"",correlationId:m?.correlationId||(0,r.pW)(),context:m?.context||"endPageDataToAuthError",subContext:m?.subContext||l})}},498346:(e,t,i)=>{i.d(t,{Hk:()=>r,Rd:()=>o,By:()=>s});const n=200;function a(e,t){if(!e.startsWith("blob"))return Promise.reject("invalid blob url");const i=new XMLHttpRequest;return i.open("GET",e,!0),i.responseType=t,new Promise(((e,t)=>{i.onload=()=>{i.status===n&&i.response?e(i.response):t(i.status!==n?{status:i.status,statusText:i.statusText}:{status:404,statusText:"no response data"})},i.onerror=()=>{t({status:i.status,statusText:i.statusText})},i.send()}))}async function r(e){return await a(e,"blob")}async function o(e){const t=await a(e,"arraybuffer");return new Uint8Array(t)}async function s(e){return e.then((e=>URL.createObjectURL(e)))}},949967:(e,t,i)=>{i.d(t,{P:()=>a});var n=i(840633);function a(e){const t=e.performance;let i,a,r;const o=t?.memory;return o&&(i=(0,n.kl)(o.jsHeapSizeLimit),a=(0,n.kl)(o.totalJSHeapSize),r=(0,n.kl)(o.usedJSHeapSize)),{jsHeapSizeLimit:i,totalJSHeapSize:a,usedJSHeapSize:r}}},471323:(e,t,i)=>{i.d(t,{K:()=>r});var n=i(840633);const a="heartbeat";async function r(e,t,i){const r={workers:[],processes:[],windows:[]},o=await(e?.loadModule(a));if(!o?.getPerfMetrics)return r;try{let e;if(i&&o.getPerfMetricsAsync){const t=await o.getPerfMetricsAsync();e=t.processes,r.windows=t.windows;for(const e of t.workers)r.workers.push({targetSessionId:e.targetSessionId,type:e.type,subType:e.subType,totalSizeKB:(0,n.kl)(e.totalSizeBytes),usedSizeKB:(0,n.kl)(e.usedSizeBytes)})}else e=await o.getPerfMetrics();for(const t of e)r.processes.push({processId:t.processId,name:t.name,type:t.type,utilitySubType:t.utilitySubType,embeddedBrowserWebView:t.embeddedBrowserWebView,cpuCycleTime:t.cpuCycleTime,workingSetSizeKB:(0,n.kl)(t.workingSetSizeBytes),privateWorkingSetSizeKB:(0,n.kl)(0===t.privateWorkingSetSizeBytes?void 0:t.privateWorkingSetSizeBytes),commitSizeKB:(0,n.kl)(t.pageFileUsageBytes),isMainRenderer:t.isMainRenderer??!1})}catch(e){t.errorToTelemetry?.("get-webview-2-metrics, getMetrics: Failed to get metrics.","fundamentals_performance_get_webview2_metrics")}return r}},840633:(e,t,i)=>{i.d(t,{tC:()=>r,Mv:()=>o,RQ:()=>s,kl:()=>c,ev:()=>l});var n=i(803238);const a=1024;function r(e){const t={},i=[...e];return m(t,"TelemetryWorker",k(i,"TelemetryWorker")),m(t,"CDLWorker",k(i,"CDLWorker")),m(t,"ServiceWorker",k(i,"ServiceWorker")),t.Perf_Total_NumberOfCDLWorkers=v(e,"CDLWorker"),t.Perf_Total_NumberOfServiceWorkers=v(e,"ServiceWorker"),t.Perf_Total_NumberOfTelemetryWorkers=v(e,"TelemetryWorker"),t.Perf_Total_NumberOfWorkers=e.length,t}function o(e,t,i){const n={},a=[...e];g(n,"GPU",f(a,["gpu-process","Gpu"]),t),g(n,"NativeShell",f(a,["nativeShell","NativeShell"]),t),g(n,"CrashpadHandler",f(a,"crashpad-handler"),t),g(n,"Browser",f(a,["browser","Browser"]),t);const r=f(a,["renderer","Renderer"]);n.Perf_Renderer_Count_Processes=r.length,g(n,"Renderer",r,t),g(n,"SlimCore",f(a,["NativeModuleProcess_SlimCore"]),t);const o=f(a,["utility","Utility"]);if(g(n,"Utility",o,t),n.Perf_Utility_Process=[...o],g(n,"Total",e),n.Perf_Total_NumberOfProcesses=e.length,n.Perf_Unknown_Process=a,n.Perf_Unknown_NumberOfProcesses=a.length,n.Perf_Unknown_WorkingSet=u(a),n.Perf_Unknown_PrivateWorkingSet=p(a),n.Perf_Unknown_CommitSize=h(a),i){const a=e.find((e=>e.processId===i));a&&(n.Perf_MainRenderer_WorkingSet=u([a]),n.Perf_MainRenderer_PrivateWorkingSet=p([a]),n.Perf_MainRenderer_CommitSize=h([a]),n.Perf_MainRenderer_PeakWorkingSet=t?.get(i))}return n}function s(e,t){const i={},{totalJSHeapSize:n,jsHeapSizeLimit:a,usedJSHeapSize:r}=e;return n&&(i.Perf_JSHeap_TotalSize=n),a&&(i.Perf_JSHeap_LimitSize=a),r&&(i.Perf_JSHeap_UsedSize=r),t&&(i.Perf_Peak_UsedJSHeapSize=t),i}function c(e){return"number"!=typeof e||isNaN(e)?void 0:Math.round(e/a)}const l=c;function d(e,t){const i=(0,n.sumBy)(e,(e=>e[t]??NaN));return 0===e.length||isNaN(i)?void 0:i}function u(e){return d(e,"workingSetSizeKB")}function p(e){return d(e,"privateWorkingSetSizeKB")}function h(e){return d(e,"commitSizeKB")}function m(e,t,i){e[`Perf_${t}_UsedSize`]=function(e){return d(e,"usedSizeKB")}(i),e[`Perf_${t}_TotalSize`]=function(e){return d(e,"totalSizeKB")}(i)}function g(e,t,i,n){if(e[`Perf_${t}_WorkingSet`]=u(i),e[`Perf_${t}_PrivateWorkingSet`]=p(i),e[`Perf_${t}_CommitSize`]=h(i),"Total"===t)e.Perf_Total_NumberOfProcesses=i.length;else{if(e[`Perf_${t}_Count_Processes`]=i.length,!n||!i.length)return;const a=Math.max(...i.map((e=>n.get(e.processId)||0)));a&&(e[`Perf_${t}_PeakWorkingSet`]=a)}}function S(e,t){let i;const n=[];for(;i=e.findIndex(t),-1!==i;)n.push(e.splice(i,1)[0]);return n}function f(e,t){const i="string"==typeof t?[t]:t;return S(e,(e=>i.includes(e.type)))}const v=(e,t)=>e.filter((e=>e.subType===t)).length;function k(e,t){return S(e,(e=>e.subType.includes(t)))}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/209371-0a347060545acb9f.js.map